var b4=Object.defineProperty;var w4=(t,e,n)=>e in t?b4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Is=(t,e,n)=>(w4(t,typeof e!="symbol"?e+"":e,n),n);function ix(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const u=Object.getOwnPropertyDescriptor(r,s);u&&Object.defineProperty(t,s,u.get?u:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const u of s)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function n(s){const u={};return s.integrity&&(u.integrity=s.integrity),s.referrerPolicy&&(u.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?u.credentials="include":s.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(s){if(s.ep)return;s.ep=!0;const u=n(s);fetch(s.href,u)}})();var qd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function E4(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Km={},T4={get exports(){return Km},set exports(t){Km=t}},sx={},We={},S4={get exports(){return We},set exports(t){We=t}},yn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ig=Symbol.for("react.element"),A4=Symbol.for("react.portal"),C4=Symbol.for("react.fragment"),M4=Symbol.for("react.strict_mode"),P4=Symbol.for("react.profiler"),I4=Symbol.for("react.provider"),R4=Symbol.for("react.context"),k4=Symbol.for("react.forward_ref"),L4=Symbol.for("react.suspense"),O4=Symbol.for("react.memo"),D4=Symbol.for("react.lazy"),VC=Symbol.iterator;function z4(t){return t===null||typeof t!="object"?null:(t=VC&&t[VC]||t["@@iterator"],typeof t=="function"?t:null)}var ok={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ak=Object.assign,lk={};function Lf(t,e,n){this.props=t,this.context=e,this.refs=lk,this.updater=n||ok}Lf.prototype.isReactComponent={};Lf.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Lf.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function ck(){}ck.prototype=Lf.prototype;function xT(t,e,n){this.props=t,this.context=e,this.refs=lk,this.updater=n||ok}var bT=xT.prototype=new ck;bT.constructor=xT;ak(bT,Lf.prototype);bT.isPureReactComponent=!0;var jC=Array.isArray,uk=Object.prototype.hasOwnProperty,wT={current:null},hk={key:!0,ref:!0,__self:!0,__source:!0};function dk(t,e,n){var r,s={},u=null,p=null;if(e!=null)for(r in e.ref!==void 0&&(p=e.ref),e.key!==void 0&&(u=""+e.key),e)uk.call(e,r)&&!hk.hasOwnProperty(r)&&(s[r]=e[r]);var o=arguments.length-2;if(o===1)s.children=n;else if(1<o){for(var v=Array(o),T=0;T<o;T++)v[T]=arguments[T+2];s.children=v}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)s[r]===void 0&&(s[r]=o[r]);return{$$typeof:Ig,type:t,key:u,ref:p,props:s,_owner:wT.current}}function F4(t,e){return{$$typeof:Ig,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function ET(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ig}function N4(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var GC=/\/+/g;function ab(t,e){return typeof t=="object"&&t!==null&&t.key!=null?N4(""+t.key):e.toString(36)}function I0(t,e,n,r,s){var u=typeof t;(u==="undefined"||u==="boolean")&&(t=null);var p=!1;if(t===null)p=!0;else switch(u){case"string":case"number":p=!0;break;case"object":switch(t.$$typeof){case Ig:case A4:p=!0}}if(p)return p=t,s=s(p),t=r===""?"."+ab(p,0):r,jC(s)?(n="",t!=null&&(n=t.replace(GC,"$&/")+"/"),I0(s,e,n,"",function(T){return T})):s!=null&&(ET(s)&&(s=F4(s,n+(!s.key||p&&p.key===s.key?"":(""+s.key).replace(GC,"$&/")+"/")+t)),e.push(s)),1;if(p=0,r=r===""?".":r+":",jC(t))for(var o=0;o<t.length;o++){u=t[o];var v=r+ab(u,o);p+=I0(u,e,n,v,s)}else if(v=z4(t),typeof v=="function")for(t=v.call(t),o=0;!(u=t.next()).done;)u=u.value,v=r+ab(u,o++),p+=I0(u,e,n,v,s);else if(u==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return p}function $y(t,e,n){if(t==null)return t;var r=[],s=0;return I0(t,r,"","",function(u){return e.call(n,u,s++)}),r}function B4(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Qi={current:null},R0={transition:null},U4={ReactCurrentDispatcher:Qi,ReactCurrentBatchConfig:R0,ReactCurrentOwner:wT};yn.Children={map:$y,forEach:function(t,e,n){$y(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return $y(t,function(){e++}),e},toArray:function(t){return $y(t,function(e){return e})||[]},only:function(t){if(!ET(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};yn.Component=Lf;yn.Fragment=C4;yn.Profiler=P4;yn.PureComponent=xT;yn.StrictMode=M4;yn.Suspense=L4;yn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U4;yn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=ak({},t.props),s=t.key,u=t.ref,p=t._owner;if(e!=null){if(e.ref!==void 0&&(u=e.ref,p=wT.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(v in e)uk.call(e,v)&&!hk.hasOwnProperty(v)&&(r[v]=e[v]===void 0&&o!==void 0?o[v]:e[v])}var v=arguments.length-2;if(v===1)r.children=n;else if(1<v){o=Array(v);for(var T=0;T<v;T++)o[T]=arguments[T+2];r.children=o}return{$$typeof:Ig,type:t.type,key:s,ref:u,props:r,_owner:p}};yn.createContext=function(t){return t={$$typeof:R4,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:I4,_context:t},t.Consumer=t};yn.createElement=dk;yn.createFactory=function(t){var e=dk.bind(null,t);return e.type=t,e};yn.createRef=function(){return{current:null}};yn.forwardRef=function(t){return{$$typeof:k4,render:t}};yn.isValidElement=ET;yn.lazy=function(t){return{$$typeof:D4,_payload:{_status:-1,_result:t},_init:B4}};yn.memo=function(t,e){return{$$typeof:O4,type:t,compare:e===void 0?null:e}};yn.startTransition=function(t){var e=R0.transition;R0.transition={};try{t()}finally{R0.transition=e}};yn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};yn.useCallback=function(t,e){return Qi.current.useCallback(t,e)};yn.useContext=function(t){return Qi.current.useContext(t)};yn.useDebugValue=function(){};yn.useDeferredValue=function(t){return Qi.current.useDeferredValue(t)};yn.useEffect=function(t,e){return Qi.current.useEffect(t,e)};yn.useId=function(){return Qi.current.useId()};yn.useImperativeHandle=function(t,e,n){return Qi.current.useImperativeHandle(t,e,n)};yn.useInsertionEffect=function(t,e){return Qi.current.useInsertionEffect(t,e)};yn.useLayoutEffect=function(t,e){return Qi.current.useLayoutEffect(t,e)};yn.useMemo=function(t,e){return Qi.current.useMemo(t,e)};yn.useReducer=function(t,e,n){return Qi.current.useReducer(t,e,n)};yn.useRef=function(t){return Qi.current.useRef(t)};yn.useState=function(t){return Qi.current.useState(t)};yn.useSyncExternalStore=function(t,e,n){return Qi.current.useSyncExternalStore(t,e,n)};yn.useTransition=function(){return Qi.current.useTransition()};yn.version="18.2.0";(function(t){t.exports=yn})(S4);const Bs=E4(We),Aw=ix({__proto__:null,default:Bs},[We]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V4=We,j4=Symbol.for("react.element"),G4=Symbol.for("react.fragment"),W4=Object.prototype.hasOwnProperty,$4=V4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,H4={key:!0,ref:!0,__self:!0,__source:!0};function fk(t,e,n){var r,s={},u=null,p=null;n!==void 0&&(u=""+n),e.key!==void 0&&(u=""+e.key),e.ref!==void 0&&(p=e.ref);for(r in e)W4.call(e,r)&&!H4.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:j4,type:t,key:u,ref:p,props:s,_owner:$4.current}}sx.Fragment=G4;sx.jsx=fk;sx.jsxs=fk;(function(t){t.exports=sx})(T4);const ox=Km.Fragment,Rt=Km.jsx,Sr=Km.jsxs;var Cw={},af={},Z4={get exports(){return af},set exports(t){af=t}},Ws={},Mw={},q4={get exports(){return Mw},set exports(t){Mw=t}},pk={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(wt,Gt){var Ot=wt.length;wt.push(Gt);e:for(;0<Ot;){var bn=Ot-1>>>1,Cn=wt[bn];if(0<s(Cn,Gt))wt[bn]=Gt,wt[Ot]=Cn,Ot=bn;else break e}}function n(wt){return wt.length===0?null:wt[0]}function r(wt){if(wt.length===0)return null;var Gt=wt[0],Ot=wt.pop();if(Ot!==Gt){wt[0]=Ot;e:for(var bn=0,Cn=wt.length,Hr=Cn>>>1;bn<Hr;){var pr=2*(bn+1)-1,ns=wt[pr],Fr=pr+1,Mn=wt[Fr];if(0>s(ns,Ot))Fr<Cn&&0>s(Mn,ns)?(wt[bn]=Mn,wt[Fr]=Ot,bn=Fr):(wt[bn]=ns,wt[pr]=Ot,bn=pr);else if(Fr<Cn&&0>s(Mn,Ot))wt[bn]=Mn,wt[Fr]=Ot,bn=Fr;else break e}}return Gt}function s(wt,Gt){var Ot=wt.sortIndex-Gt.sortIndex;return Ot!==0?Ot:wt.id-Gt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var p=Date,o=p.now();t.unstable_now=function(){return p.now()-o}}var v=[],T=[],I=1,L=null,F=3,j=!1,X=!1,re=!1,de=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function J(wt){for(var Gt=n(T);Gt!==null;){if(Gt.callback===null)r(T);else if(Gt.startTime<=wt)r(T),Gt.sortIndex=Gt.expirationTime,e(v,Gt);else break;Gt=n(T)}}function Ee(wt){if(re=!1,J(wt),!X)if(n(v)!==null)X=!0,ts(ue);else{var Gt=n(T);Gt!==null&&Ci(Ee,Gt.startTime-wt)}}function ue(wt,Gt){X=!1,re&&(re=!1,q(at),at=-1),j=!0;var Ot=F;try{for(J(Gt),L=n(v);L!==null&&(!(L.expirationTime>Gt)||wt&&!Bt());){var bn=L.callback;if(typeof bn=="function"){L.callback=null,F=L.priorityLevel;var Cn=bn(L.expirationTime<=Gt);Gt=t.unstable_now(),typeof Cn=="function"?L.callback=Cn:L===n(v)&&r(v),J(Gt)}else r(v);L=n(v)}if(L!==null)var Hr=!0;else{var pr=n(T);pr!==null&&Ci(Ee,pr.startTime-Gt),Hr=!1}return Hr}finally{L=null,F=Ot,j=!1}}var Fe=!1,Qe=null,at=-1,rt=5,ht=-1;function Bt(){return!(t.unstable_now()-ht<rt)}function Dn(){if(Qe!==null){var wt=t.unstable_now();ht=wt;var Gt=!0;try{Gt=Qe(!0,wt)}finally{Gt?zn():(Fe=!1,Qe=null)}}else Fe=!1}var zn;if(typeof H=="function")zn=function(){H(Dn)};else if(typeof MessageChannel<"u"){var cn=new MessageChannel,jt=cn.port2;cn.port1.onmessage=Dn,zn=function(){jt.postMessage(null)}}else zn=function(){de(Dn,0)};function ts(wt){Qe=wt,Fe||(Fe=!0,zn())}function Ci(wt,Gt){at=de(function(){wt(t.unstable_now())},Gt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(wt){wt.callback=null},t.unstable_continueExecution=function(){X||j||(X=!0,ts(ue))},t.unstable_forceFrameRate=function(wt){0>wt||125<wt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):rt=0<wt?Math.floor(1e3/wt):5},t.unstable_getCurrentPriorityLevel=function(){return F},t.unstable_getFirstCallbackNode=function(){return n(v)},t.unstable_next=function(wt){switch(F){case 1:case 2:case 3:var Gt=3;break;default:Gt=F}var Ot=F;F=Gt;try{return wt()}finally{F=Ot}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(wt,Gt){switch(wt){case 1:case 2:case 3:case 4:case 5:break;default:wt=3}var Ot=F;F=wt;try{return Gt()}finally{F=Ot}},t.unstable_scheduleCallback=function(wt,Gt,Ot){var bn=t.unstable_now();switch(typeof Ot=="object"&&Ot!==null?(Ot=Ot.delay,Ot=typeof Ot=="number"&&0<Ot?bn+Ot:bn):Ot=bn,wt){case 1:var Cn=-1;break;case 2:Cn=250;break;case 5:Cn=1073741823;break;case 4:Cn=1e4;break;default:Cn=5e3}return Cn=Ot+Cn,wt={id:I++,callback:Gt,priorityLevel:wt,startTime:Ot,expirationTime:Cn,sortIndex:-1},Ot>bn?(wt.sortIndex=Ot,e(T,wt),n(v)===null&&wt===n(T)&&(re?(q(at),at=-1):re=!0,Ci(Ee,Ot-bn))):(wt.sortIndex=Cn,e(v,wt),X||j||(X=!0,ts(ue))),wt},t.unstable_shouldYield=Bt,t.unstable_wrapCallback=function(wt){var Gt=F;return function(){var Ot=F;F=Gt;try{return wt.apply(this,arguments)}finally{F=Ot}}}})(pk);(function(t){t.exports=pk})(q4);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mk=We,Gs=Mw;function dt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var gk=new Set,Jm={};function fh(t,e){lf(t,e),lf(t+"Capture",e)}function lf(t,e){for(Jm[t]=e,t=0;t<e.length;t++)gk.add(e[t])}var pl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Pw=Object.prototype.hasOwnProperty,X4=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,WC={},$C={};function Y4(t){return Pw.call($C,t)?!0:Pw.call(WC,t)?!1:X4.test(t)?$C[t]=!0:(WC[t]=!0,!1)}function K4(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function J4(t,e,n,r){if(e===null||typeof e>"u"||K4(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function es(t,e,n,r,s,u,p){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=u,this.removeEmptyString=p}var Ai={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ai[t]=new es(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ai[e]=new es(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ai[t]=new es(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ai[t]=new es(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ai[t]=new es(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ai[t]=new es(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ai[t]=new es(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ai[t]=new es(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ai[t]=new es(t,5,!1,t.toLowerCase(),null,!1,!1)});var TT=/[\-:]([a-z])/g;function ST(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(TT,ST);Ai[e]=new es(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(TT,ST);Ai[e]=new es(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(TT,ST);Ai[e]=new es(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ai[t]=new es(t,1,!1,t.toLowerCase(),null,!1,!1)});Ai.xlinkHref=new es("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ai[t]=new es(t,1,!1,t.toLowerCase(),null,!0,!0)});function AT(t,e,n,r){var s=Ai.hasOwnProperty(e)?Ai[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(J4(e,n,s,r)&&(n=null),r||s===null?Y4(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var El=mk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Hy=Symbol.for("react.element"),kd=Symbol.for("react.portal"),Ld=Symbol.for("react.fragment"),CT=Symbol.for("react.strict_mode"),Iw=Symbol.for("react.profiler"),_k=Symbol.for("react.provider"),yk=Symbol.for("react.context"),MT=Symbol.for("react.forward_ref"),Rw=Symbol.for("react.suspense"),kw=Symbol.for("react.suspense_list"),PT=Symbol.for("react.memo"),uc=Symbol.for("react.lazy"),vk=Symbol.for("react.offscreen"),HC=Symbol.iterator;function um(t){return t===null||typeof t!="object"?null:(t=HC&&t[HC]||t["@@iterator"],typeof t=="function"?t:null)}var Cr=Object.assign,lb;function Cm(t){if(lb===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);lb=e&&e[1]||""}return`
`+lb+t}var cb=!1;function ub(t,e){if(!t||cb)return"";cb=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(T){var r=T}Reflect.construct(t,[],e)}else{try{e.call()}catch(T){r=T}t.call(e.prototype)}else{try{throw Error()}catch(T){r=T}t()}}catch(T){if(T&&r&&typeof T.stack=="string"){for(var s=T.stack.split(`
`),u=r.stack.split(`
`),p=s.length-1,o=u.length-1;1<=p&&0<=o&&s[p]!==u[o];)o--;for(;1<=p&&0<=o;p--,o--)if(s[p]!==u[o]){if(p!==1||o!==1)do if(p--,o--,0>o||s[p]!==u[o]){var v=`
`+s[p].replace(" at new "," at ");return t.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",t.displayName)),v}while(1<=p&&0<=o);break}}}finally{cb=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Cm(t):""}function Q4(t){switch(t.tag){case 5:return Cm(t.type);case 16:return Cm("Lazy");case 13:return Cm("Suspense");case 19:return Cm("SuspenseList");case 0:case 2:case 15:return t=ub(t.type,!1),t;case 11:return t=ub(t.type.render,!1),t;case 1:return t=ub(t.type,!0),t;default:return""}}function Lw(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ld:return"Fragment";case kd:return"Portal";case Iw:return"Profiler";case CT:return"StrictMode";case Rw:return"Suspense";case kw:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case yk:return(t.displayName||"Context")+".Consumer";case _k:return(t._context.displayName||"Context")+".Provider";case MT:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case PT:return e=t.displayName||null,e!==null?e:Lw(t.type)||"Memo";case uc:e=t._payload,t=t._init;try{return Lw(t(e))}catch{}}return null}function eU(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Lw(e);case 8:return e===CT?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Oc(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function xk(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function tU(t){var e=xk(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,u=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(p){r=""+p,u.call(this,p)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(p){r=""+p},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Zy(t){t._valueTracker||(t._valueTracker=tU(t))}function bk(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=xk(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function tv(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ow(t,e){var n=e.checked;return Cr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ZC(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Oc(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function wk(t,e){e=e.checked,e!=null&&AT(t,"checked",e,!1)}function Dw(t,e){wk(t,e);var n=Oc(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?zw(t,e.type,n):e.hasOwnProperty("defaultValue")&&zw(t,e.type,Oc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function qC(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function zw(t,e,n){(e!=="number"||tv(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Mm=Array.isArray;function Xd(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Oc(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Fw(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(dt(91));return Cr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function XC(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(dt(92));if(Mm(n)){if(1<n.length)throw Error(dt(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Oc(n)}}function Ek(t,e){var n=Oc(e.value),r=Oc(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function YC(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Tk(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Nw(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Tk(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var qy,Sk=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(qy=qy||document.createElement("div"),qy.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=qy.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Qm(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Dm={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nU=["Webkit","ms","Moz","O"];Object.keys(Dm).forEach(function(t){nU.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Dm[e]=Dm[t]})});function Ak(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Dm.hasOwnProperty(t)&&Dm[t]?(""+e).trim():e+"px"}function Ck(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Ak(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var rU=Cr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Bw(t,e){if(e){if(rU[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(dt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(dt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(dt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(dt(62))}}function Uw(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vw=null;function IT(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var jw=null,Yd=null,Kd=null;function KC(t){if(t=Lg(t)){if(typeof jw!="function")throw Error(dt(280));var e=t.stateNode;e&&(e=hx(e),jw(t.stateNode,t.type,e))}}function Mk(t){Yd?Kd?Kd.push(t):Kd=[t]:Yd=t}function Pk(){if(Yd){var t=Yd,e=Kd;if(Kd=Yd=null,KC(t),e)for(t=0;t<e.length;t++)KC(e[t])}}function Ik(t,e){return t(e)}function Rk(){}var hb=!1;function kk(t,e,n){if(hb)return t(e,n);hb=!0;try{return Ik(t,e,n)}finally{hb=!1,(Yd!==null||Kd!==null)&&(Rk(),Pk())}}function eg(t,e){var n=t.stateNode;if(n===null)return null;var r=hx(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(dt(231,e,typeof n));return n}var Gw=!1;if(pl)try{var hm={};Object.defineProperty(hm,"passive",{get:function(){Gw=!0}}),window.addEventListener("test",hm,hm),window.removeEventListener("test",hm,hm)}catch{Gw=!1}function iU(t,e,n,r,s,u,p,o,v){var T=Array.prototype.slice.call(arguments,3);try{e.apply(n,T)}catch(I){this.onError(I)}}var zm=!1,nv=null,rv=!1,Ww=null,sU={onError:function(t){zm=!0,nv=t}};function oU(t,e,n,r,s,u,p,o,v){zm=!1,nv=null,iU.apply(sU,arguments)}function aU(t,e,n,r,s,u,p,o,v){if(oU.apply(this,arguments),zm){if(zm){var T=nv;zm=!1,nv=null}else throw Error(dt(198));rv||(rv=!0,Ww=T)}}function ph(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Lk(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function JC(t){if(ph(t)!==t)throw Error(dt(188))}function lU(t){var e=t.alternate;if(!e){if(e=ph(t),e===null)throw Error(dt(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var u=s.alternate;if(u===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===u.child){for(u=s.child;u;){if(u===n)return JC(s),t;if(u===r)return JC(s),e;u=u.sibling}throw Error(dt(188))}if(n.return!==r.return)n=s,r=u;else{for(var p=!1,o=s.child;o;){if(o===n){p=!0,n=s,r=u;break}if(o===r){p=!0,r=s,n=u;break}o=o.sibling}if(!p){for(o=u.child;o;){if(o===n){p=!0,n=u,r=s;break}if(o===r){p=!0,r=u,n=s;break}o=o.sibling}if(!p)throw Error(dt(189))}}if(n.alternate!==r)throw Error(dt(190))}if(n.tag!==3)throw Error(dt(188));return n.stateNode.current===n?t:e}function Ok(t){return t=lU(t),t!==null?Dk(t):null}function Dk(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Dk(t);if(e!==null)return e;t=t.sibling}return null}var zk=Gs.unstable_scheduleCallback,QC=Gs.unstable_cancelCallback,cU=Gs.unstable_shouldYield,uU=Gs.unstable_requestPaint,zr=Gs.unstable_now,hU=Gs.unstable_getCurrentPriorityLevel,RT=Gs.unstable_ImmediatePriority,Fk=Gs.unstable_UserBlockingPriority,iv=Gs.unstable_NormalPriority,dU=Gs.unstable_LowPriority,Nk=Gs.unstable_IdlePriority,ax=null,Oa=null;function fU(t){if(Oa&&typeof Oa.onCommitFiberRoot=="function")try{Oa.onCommitFiberRoot(ax,t,void 0,(t.current.flags&128)===128)}catch{}}var Ho=Math.clz32?Math.clz32:gU,pU=Math.log,mU=Math.LN2;function gU(t){return t>>>=0,t===0?32:31-(pU(t)/mU|0)|0}var Xy=64,Yy=4194304;function Pm(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function sv(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,u=t.pingedLanes,p=n&268435455;if(p!==0){var o=p&~s;o!==0?r=Pm(o):(u&=p,u!==0&&(r=Pm(u)))}else p=n&~s,p!==0?r=Pm(p):u!==0&&(r=Pm(u));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,u=e&-e,s>=u||s===16&&(u&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Ho(e),s=1<<n,r|=t[n],e&=~s;return r}function _U(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yU(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,u=t.pendingLanes;0<u;){var p=31-Ho(u),o=1<<p,v=s[p];v===-1?(!(o&n)||o&r)&&(s[p]=_U(o,e)):v<=e&&(t.expiredLanes|=o),u&=~o}}function $w(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Bk(){var t=Xy;return Xy<<=1,!(Xy&4194240)&&(Xy=64),t}function db(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Rg(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ho(e),t[e]=n}function vU(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Ho(n),u=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~u}}function kT(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Ho(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var er=0;function Uk(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Vk,LT,jk,Gk,Wk,Hw=!1,Ky=[],Ec=null,Tc=null,Sc=null,tg=new Map,ng=new Map,fc=[],xU="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function eM(t,e){switch(t){case"focusin":case"focusout":Ec=null;break;case"dragenter":case"dragleave":Tc=null;break;case"mouseover":case"mouseout":Sc=null;break;case"pointerover":case"pointerout":tg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ng.delete(e.pointerId)}}function dm(t,e,n,r,s,u){return t===null||t.nativeEvent!==u?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:u,targetContainers:[s]},e!==null&&(e=Lg(e),e!==null&&LT(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function bU(t,e,n,r,s){switch(e){case"focusin":return Ec=dm(Ec,t,e,n,r,s),!0;case"dragenter":return Tc=dm(Tc,t,e,n,r,s),!0;case"mouseover":return Sc=dm(Sc,t,e,n,r,s),!0;case"pointerover":var u=s.pointerId;return tg.set(u,dm(tg.get(u)||null,t,e,n,r,s)),!0;case"gotpointercapture":return u=s.pointerId,ng.set(u,dm(ng.get(u)||null,t,e,n,r,s)),!0}return!1}function $k(t){var e=$u(t.target);if(e!==null){var n=ph(e);if(n!==null){if(e=n.tag,e===13){if(e=Lk(n),e!==null){t.blockedOn=e,Wk(t.priority,function(){jk(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function k0(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Zw(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Vw=r,n.target.dispatchEvent(r),Vw=null}else return e=Lg(n),e!==null&&LT(e),t.blockedOn=n,!1;e.shift()}return!0}function tM(t,e,n){k0(t)&&n.delete(e)}function wU(){Hw=!1,Ec!==null&&k0(Ec)&&(Ec=null),Tc!==null&&k0(Tc)&&(Tc=null),Sc!==null&&k0(Sc)&&(Sc=null),tg.forEach(tM),ng.forEach(tM)}function fm(t,e){t.blockedOn===e&&(t.blockedOn=null,Hw||(Hw=!0,Gs.unstable_scheduleCallback(Gs.unstable_NormalPriority,wU)))}function rg(t){function e(s){return fm(s,t)}if(0<Ky.length){fm(Ky[0],t);for(var n=1;n<Ky.length;n++){var r=Ky[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ec!==null&&fm(Ec,t),Tc!==null&&fm(Tc,t),Sc!==null&&fm(Sc,t),tg.forEach(e),ng.forEach(e),n=0;n<fc.length;n++)r=fc[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<fc.length&&(n=fc[0],n.blockedOn===null);)$k(n),n.blockedOn===null&&fc.shift()}var Jd=El.ReactCurrentBatchConfig,ov=!0;function EU(t,e,n,r){var s=er,u=Jd.transition;Jd.transition=null;try{er=1,OT(t,e,n,r)}finally{er=s,Jd.transition=u}}function TU(t,e,n,r){var s=er,u=Jd.transition;Jd.transition=null;try{er=4,OT(t,e,n,r)}finally{er=s,Jd.transition=u}}function OT(t,e,n,r){if(ov){var s=Zw(t,e,n,r);if(s===null)wb(t,e,r,av,n),eM(t,r);else if(bU(s,t,e,n,r))r.stopPropagation();else if(eM(t,r),e&4&&-1<xU.indexOf(t)){for(;s!==null;){var u=Lg(s);if(u!==null&&Vk(u),u=Zw(t,e,n,r),u===null&&wb(t,e,r,av,n),u===s)break;s=u}s!==null&&r.stopPropagation()}else wb(t,e,r,null,n)}}var av=null;function Zw(t,e,n,r){if(av=null,t=IT(r),t=$u(t),t!==null)if(e=ph(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Lk(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return av=t,null}function Hk(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hU()){case RT:return 1;case Fk:return 4;case iv:case dU:return 16;case Nk:return 536870912;default:return 16}default:return 16}}var _c=null,DT=null,L0=null;function Zk(){if(L0)return L0;var t,e=DT,n=e.length,r,s="value"in _c?_c.value:_c.textContent,u=s.length;for(t=0;t<n&&e[t]===s[t];t++);var p=n-t;for(r=1;r<=p&&e[n-r]===s[u-r];r++);return L0=s.slice(t,1<r?1-r:void 0)}function O0(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Jy(){return!0}function nM(){return!1}function $s(t){function e(n,r,s,u,p){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=u,this.target=p,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(u):u[o]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?Jy:nM,this.isPropagationStopped=nM,this}return Cr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Jy)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Jy)},persist:function(){},isPersistent:Jy}),e}var Of={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zT=$s(Of),kg=Cr({},Of,{view:0,detail:0}),SU=$s(kg),fb,pb,pm,lx=Cr({},kg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:FT,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==pm&&(pm&&t.type==="mousemove"?(fb=t.screenX-pm.screenX,pb=t.screenY-pm.screenY):pb=fb=0,pm=t),fb)},movementY:function(t){return"movementY"in t?t.movementY:pb}}),rM=$s(lx),AU=Cr({},lx,{dataTransfer:0}),CU=$s(AU),MU=Cr({},kg,{relatedTarget:0}),mb=$s(MU),PU=Cr({},Of,{animationName:0,elapsedTime:0,pseudoElement:0}),IU=$s(PU),RU=Cr({},Of,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),kU=$s(RU),LU=Cr({},Of,{data:0}),iM=$s(LU),OU={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},DU={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zU={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function FU(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=zU[t])?!!e[t]:!1}function FT(){return FU}var NU=Cr({},kg,{key:function(t){if(t.key){var e=OU[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=O0(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?DU[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:FT,charCode:function(t){return t.type==="keypress"?O0(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?O0(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),BU=$s(NU),UU=Cr({},lx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sM=$s(UU),VU=Cr({},kg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:FT}),jU=$s(VU),GU=Cr({},Of,{propertyName:0,elapsedTime:0,pseudoElement:0}),WU=$s(GU),$U=Cr({},lx,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),HU=$s($U),ZU=[9,13,27,32],NT=pl&&"CompositionEvent"in window,Fm=null;pl&&"documentMode"in document&&(Fm=document.documentMode);var qU=pl&&"TextEvent"in window&&!Fm,qk=pl&&(!NT||Fm&&8<Fm&&11>=Fm),oM=String.fromCharCode(32),aM=!1;function Xk(t,e){switch(t){case"keyup":return ZU.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yk(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Od=!1;function XU(t,e){switch(t){case"compositionend":return Yk(e);case"keypress":return e.which!==32?null:(aM=!0,oM);case"textInput":return t=e.data,t===oM&&aM?null:t;default:return null}}function YU(t,e){if(Od)return t==="compositionend"||!NT&&Xk(t,e)?(t=Zk(),L0=DT=_c=null,Od=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return qk&&e.locale!=="ko"?null:e.data;default:return null}}var KU={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lM(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!KU[t.type]:e==="textarea"}function Kk(t,e,n,r){Mk(r),e=lv(e,"onChange"),0<e.length&&(n=new zT("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Nm=null,ig=null;function JU(t){lL(t,0)}function cx(t){var e=Fd(t);if(bk(e))return t}function QU(t,e){if(t==="change")return e}var Jk=!1;if(pl){var gb;if(pl){var _b="oninput"in document;if(!_b){var cM=document.createElement("div");cM.setAttribute("oninput","return;"),_b=typeof cM.oninput=="function"}gb=_b}else gb=!1;Jk=gb&&(!document.documentMode||9<document.documentMode)}function uM(){Nm&&(Nm.detachEvent("onpropertychange",Qk),ig=Nm=null)}function Qk(t){if(t.propertyName==="value"&&cx(ig)){var e=[];Kk(e,ig,t,IT(t)),kk(JU,e)}}function e5(t,e,n){t==="focusin"?(uM(),Nm=e,ig=n,Nm.attachEvent("onpropertychange",Qk)):t==="focusout"&&uM()}function t5(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return cx(ig)}function n5(t,e){if(t==="click")return cx(e)}function r5(t,e){if(t==="input"||t==="change")return cx(e)}function i5(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ko=typeof Object.is=="function"?Object.is:i5;function sg(t,e){if(Ko(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Pw.call(e,s)||!Ko(t[s],e[s]))return!1}return!0}function hM(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function dM(t,e){var n=hM(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=hM(n)}}function eL(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?eL(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function tL(){for(var t=window,e=tv();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=tv(t.document)}return e}function BT(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function s5(t){var e=tL(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&eL(n.ownerDocument.documentElement,n)){if(r!==null&&BT(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,u=Math.min(r.start,s);r=r.end===void 0?u:Math.min(r.end,s),!t.extend&&u>r&&(s=r,r=u,u=s),s=dM(n,u);var p=dM(n,r);s&&p&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==p.node||t.focusOffset!==p.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),u>r?(t.addRange(e),t.extend(p.node,p.offset)):(e.setEnd(p.node,p.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var o5=pl&&"documentMode"in document&&11>=document.documentMode,Dd=null,qw=null,Bm=null,Xw=!1;function fM(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Xw||Dd==null||Dd!==tv(r)||(r=Dd,"selectionStart"in r&&BT(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Bm&&sg(Bm,r)||(Bm=r,r=lv(qw,"onSelect"),0<r.length&&(e=new zT("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Dd)))}function Qy(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var zd={animationend:Qy("Animation","AnimationEnd"),animationiteration:Qy("Animation","AnimationIteration"),animationstart:Qy("Animation","AnimationStart"),transitionend:Qy("Transition","TransitionEnd")},yb={},nL={};pl&&(nL=document.createElement("div").style,"AnimationEvent"in window||(delete zd.animationend.animation,delete zd.animationiteration.animation,delete zd.animationstart.animation),"TransitionEvent"in window||delete zd.transitionend.transition);function ux(t){if(yb[t])return yb[t];if(!zd[t])return t;var e=zd[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in nL)return yb[t]=e[n];return t}var rL=ux("animationend"),iL=ux("animationiteration"),sL=ux("animationstart"),oL=ux("transitionend"),aL=new Map,pM="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Uc(t,e){aL.set(t,e),fh(e,[t])}for(var vb=0;vb<pM.length;vb++){var xb=pM[vb],a5=xb.toLowerCase(),l5=xb[0].toUpperCase()+xb.slice(1);Uc(a5,"on"+l5)}Uc(rL,"onAnimationEnd");Uc(iL,"onAnimationIteration");Uc(sL,"onAnimationStart");Uc("dblclick","onDoubleClick");Uc("focusin","onFocus");Uc("focusout","onBlur");Uc(oL,"onTransitionEnd");lf("onMouseEnter",["mouseout","mouseover"]);lf("onMouseLeave",["mouseout","mouseover"]);lf("onPointerEnter",["pointerout","pointerover"]);lf("onPointerLeave",["pointerout","pointerover"]);fh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fh("onBeforeInput",["compositionend","keypress","textInput","paste"]);fh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Im="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),c5=new Set("cancel close invalid load scroll toggle".split(" ").concat(Im));function mM(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,aU(r,e,void 0,t),t.currentTarget=null}function lL(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var u=void 0;if(e)for(var p=r.length-1;0<=p;p--){var o=r[p],v=o.instance,T=o.currentTarget;if(o=o.listener,v!==u&&s.isPropagationStopped())break e;mM(s,o,T),u=v}else for(p=0;p<r.length;p++){if(o=r[p],v=o.instance,T=o.currentTarget,o=o.listener,v!==u&&s.isPropagationStopped())break e;mM(s,o,T),u=v}}}if(rv)throw t=Ww,rv=!1,Ww=null,t}function hr(t,e){var n=e[eE];n===void 0&&(n=e[eE]=new Set);var r=t+"__bubble";n.has(r)||(cL(e,t,2,!1),n.add(r))}function bb(t,e,n){var r=0;e&&(r|=4),cL(n,t,r,e)}var e0="_reactListening"+Math.random().toString(36).slice(2);function og(t){if(!t[e0]){t[e0]=!0,gk.forEach(function(n){n!=="selectionchange"&&(c5.has(n)||bb(n,!1,t),bb(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[e0]||(e[e0]=!0,bb("selectionchange",!1,e))}}function cL(t,e,n,r){switch(Hk(e)){case 1:var s=EU;break;case 4:s=TU;break;default:s=OT}n=s.bind(null,e,n,t),s=void 0,!Gw||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function wb(t,e,n,r,s){var u=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var p=r.tag;if(p===3||p===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(p===4)for(p=r.return;p!==null;){var v=p.tag;if((v===3||v===4)&&(v=p.stateNode.containerInfo,v===s||v.nodeType===8&&v.parentNode===s))return;p=p.return}for(;o!==null;){if(p=$u(o),p===null)return;if(v=p.tag,v===5||v===6){r=u=p;continue e}o=o.parentNode}}r=r.return}kk(function(){var T=u,I=IT(n),L=[];e:{var F=aL.get(t);if(F!==void 0){var j=zT,X=t;switch(t){case"keypress":if(O0(n)===0)break e;case"keydown":case"keyup":j=BU;break;case"focusin":X="focus",j=mb;break;case"focusout":X="blur",j=mb;break;case"beforeblur":case"afterblur":j=mb;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=rM;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=CU;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=jU;break;case rL:case iL:case sL:j=IU;break;case oL:j=WU;break;case"scroll":j=SU;break;case"wheel":j=HU;break;case"copy":case"cut":case"paste":j=kU;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=sM}var re=(e&4)!==0,de=!re&&t==="scroll",q=re?F!==null?F+"Capture":null:F;re=[];for(var H=T,J;H!==null;){J=H;var Ee=J.stateNode;if(J.tag===5&&Ee!==null&&(J=Ee,q!==null&&(Ee=eg(H,q),Ee!=null&&re.push(ag(H,Ee,J)))),de)break;H=H.return}0<re.length&&(F=new j(F,X,null,n,I),L.push({event:F,listeners:re}))}}if(!(e&7)){e:{if(F=t==="mouseover"||t==="pointerover",j=t==="mouseout"||t==="pointerout",F&&n!==Vw&&(X=n.relatedTarget||n.fromElement)&&($u(X)||X[ml]))break e;if((j||F)&&(F=I.window===I?I:(F=I.ownerDocument)?F.defaultView||F.parentWindow:window,j?(X=n.relatedTarget||n.toElement,j=T,X=X?$u(X):null,X!==null&&(de=ph(X),X!==de||X.tag!==5&&X.tag!==6)&&(X=null)):(j=null,X=T),j!==X)){if(re=rM,Ee="onMouseLeave",q="onMouseEnter",H="mouse",(t==="pointerout"||t==="pointerover")&&(re=sM,Ee="onPointerLeave",q="onPointerEnter",H="pointer"),de=j==null?F:Fd(j),J=X==null?F:Fd(X),F=new re(Ee,H+"leave",j,n,I),F.target=de,F.relatedTarget=J,Ee=null,$u(I)===T&&(re=new re(q,H+"enter",X,n,I),re.target=J,re.relatedTarget=de,Ee=re),de=Ee,j&&X)t:{for(re=j,q=X,H=0,J=re;J;J=xd(J))H++;for(J=0,Ee=q;Ee;Ee=xd(Ee))J++;for(;0<H-J;)re=xd(re),H--;for(;0<J-H;)q=xd(q),J--;for(;H--;){if(re===q||q!==null&&re===q.alternate)break t;re=xd(re),q=xd(q)}re=null}else re=null;j!==null&&gM(L,F,j,re,!1),X!==null&&de!==null&&gM(L,de,X,re,!0)}}e:{if(F=T?Fd(T):window,j=F.nodeName&&F.nodeName.toLowerCase(),j==="select"||j==="input"&&F.type==="file")var ue=QU;else if(lM(F))if(Jk)ue=r5;else{ue=t5;var Fe=e5}else(j=F.nodeName)&&j.toLowerCase()==="input"&&(F.type==="checkbox"||F.type==="radio")&&(ue=n5);if(ue&&(ue=ue(t,T))){Kk(L,ue,n,I);break e}Fe&&Fe(t,F,T),t==="focusout"&&(Fe=F._wrapperState)&&Fe.controlled&&F.type==="number"&&zw(F,"number",F.value)}switch(Fe=T?Fd(T):window,t){case"focusin":(lM(Fe)||Fe.contentEditable==="true")&&(Dd=Fe,qw=T,Bm=null);break;case"focusout":Bm=qw=Dd=null;break;case"mousedown":Xw=!0;break;case"contextmenu":case"mouseup":case"dragend":Xw=!1,fM(L,n,I);break;case"selectionchange":if(o5)break;case"keydown":case"keyup":fM(L,n,I)}var Qe;if(NT)e:{switch(t){case"compositionstart":var at="onCompositionStart";break e;case"compositionend":at="onCompositionEnd";break e;case"compositionupdate":at="onCompositionUpdate";break e}at=void 0}else Od?Xk(t,n)&&(at="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(at="onCompositionStart");at&&(qk&&n.locale!=="ko"&&(Od||at!=="onCompositionStart"?at==="onCompositionEnd"&&Od&&(Qe=Zk()):(_c=I,DT="value"in _c?_c.value:_c.textContent,Od=!0)),Fe=lv(T,at),0<Fe.length&&(at=new iM(at,t,null,n,I),L.push({event:at,listeners:Fe}),Qe?at.data=Qe:(Qe=Yk(n),Qe!==null&&(at.data=Qe)))),(Qe=qU?XU(t,n):YU(t,n))&&(T=lv(T,"onBeforeInput"),0<T.length&&(I=new iM("onBeforeInput","beforeinput",null,n,I),L.push({event:I,listeners:T}),I.data=Qe))}lL(L,e)})}function ag(t,e,n){return{instance:t,listener:e,currentTarget:n}}function lv(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,u=s.stateNode;s.tag===5&&u!==null&&(s=u,u=eg(t,n),u!=null&&r.unshift(ag(t,u,s)),u=eg(t,e),u!=null&&r.push(ag(t,u,s))),t=t.return}return r}function xd(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function gM(t,e,n,r,s){for(var u=e._reactName,p=[];n!==null&&n!==r;){var o=n,v=o.alternate,T=o.stateNode;if(v!==null&&v===r)break;o.tag===5&&T!==null&&(o=T,s?(v=eg(n,u),v!=null&&p.unshift(ag(n,v,o))):s||(v=eg(n,u),v!=null&&p.push(ag(n,v,o)))),n=n.return}p.length!==0&&t.push({event:e,listeners:p})}var u5=/\r\n?/g,h5=/\u0000|\uFFFD/g;function _M(t){return(typeof t=="string"?t:""+t).replace(u5,`
`).replace(h5,"")}function t0(t,e,n){if(e=_M(e),_M(t)!==e&&n)throw Error(dt(425))}function cv(){}var Yw=null,Kw=null;function Jw(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Qw=typeof setTimeout=="function"?setTimeout:void 0,d5=typeof clearTimeout=="function"?clearTimeout:void 0,yM=typeof Promise=="function"?Promise:void 0,f5=typeof queueMicrotask=="function"?queueMicrotask:typeof yM<"u"?function(t){return yM.resolve(null).then(t).catch(p5)}:Qw;function p5(t){setTimeout(function(){throw t})}function Eb(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),rg(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);rg(e)}function Ac(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function vM(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Df=Math.random().toString(36).slice(2),Pa="__reactFiber$"+Df,lg="__reactProps$"+Df,ml="__reactContainer$"+Df,eE="__reactEvents$"+Df,m5="__reactListeners$"+Df,g5="__reactHandles$"+Df;function $u(t){var e=t[Pa];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ml]||n[Pa]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=vM(t);t!==null;){if(n=t[Pa])return n;t=vM(t)}return e}t=n,n=t.parentNode}return null}function Lg(t){return t=t[Pa]||t[ml],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Fd(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(dt(33))}function hx(t){return t[lg]||null}var tE=[],Nd=-1;function Vc(t){return{current:t}}function fr(t){0>Nd||(t.current=tE[Nd],tE[Nd]=null,Nd--)}function or(t,e){Nd++,tE[Nd]=t.current,t.current=e}var Dc={},ji=Vc(Dc),vs=Vc(!1),rh=Dc;function cf(t,e){var n=t.type.contextTypes;if(!n)return Dc;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},u;for(u in n)s[u]=e[u];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function xs(t){return t=t.childContextTypes,t!=null}function uv(){fr(vs),fr(ji)}function xM(t,e,n){if(ji.current!==Dc)throw Error(dt(168));or(ji,e),or(vs,n)}function uL(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(dt(108,eU(t)||"Unknown",s));return Cr({},n,r)}function hv(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Dc,rh=ji.current,or(ji,t),or(vs,vs.current),!0}function bM(t,e,n){var r=t.stateNode;if(!r)throw Error(dt(169));n?(t=uL(t,e,rh),r.__reactInternalMemoizedMergedChildContext=t,fr(vs),fr(ji),or(ji,t)):fr(vs),or(vs,n)}var ol=null,dx=!1,Tb=!1;function hL(t){ol===null?ol=[t]:ol.push(t)}function _5(t){dx=!0,hL(t)}function jc(){if(!Tb&&ol!==null){Tb=!0;var t=0,e=er;try{var n=ol;for(er=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ol=null,dx=!1}catch(s){throw ol!==null&&(ol=ol.slice(t+1)),zk(RT,jc),s}finally{er=e,Tb=!1}}return null}var Bd=[],Ud=0,dv=null,fv=0,io=[],so=0,ih=null,cl=1,ul="";function Vu(t,e){Bd[Ud++]=fv,Bd[Ud++]=dv,dv=t,fv=e}function dL(t,e,n){io[so++]=cl,io[so++]=ul,io[so++]=ih,ih=t;var r=cl;t=ul;var s=32-Ho(r)-1;r&=~(1<<s),n+=1;var u=32-Ho(e)+s;if(30<u){var p=s-s%5;u=(r&(1<<p)-1).toString(32),r>>=p,s-=p,cl=1<<32-Ho(e)+s|n<<s|r,ul=u+t}else cl=1<<u|n<<s|r,ul=t}function UT(t){t.return!==null&&(Vu(t,1),dL(t,1,0))}function VT(t){for(;t===dv;)dv=Bd[--Ud],Bd[Ud]=null,fv=Bd[--Ud],Bd[Ud]=null;for(;t===ih;)ih=io[--so],io[so]=null,ul=io[--so],io[so]=null,cl=io[--so],io[so]=null}var Us=null,Fs=null,yr=!1,jo=null;function fL(t,e){var n=co(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function wM(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Us=t,Fs=Ac(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Us=t,Fs=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ih!==null?{id:cl,overflow:ul}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=co(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Us=t,Fs=null,!0):!1;default:return!1}}function nE(t){return(t.mode&1)!==0&&(t.flags&128)===0}function rE(t){if(yr){var e=Fs;if(e){var n=e;if(!wM(t,e)){if(nE(t))throw Error(dt(418));e=Ac(n.nextSibling);var r=Us;e&&wM(t,e)?fL(r,n):(t.flags=t.flags&-4097|2,yr=!1,Us=t)}}else{if(nE(t))throw Error(dt(418));t.flags=t.flags&-4097|2,yr=!1,Us=t}}}function EM(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Us=t}function n0(t){if(t!==Us)return!1;if(!yr)return EM(t),yr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Jw(t.type,t.memoizedProps)),e&&(e=Fs)){if(nE(t))throw pL(),Error(dt(418));for(;e;)fL(t,e),e=Ac(e.nextSibling)}if(EM(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(dt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Fs=Ac(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Fs=null}}else Fs=Us?Ac(t.stateNode.nextSibling):null;return!0}function pL(){for(var t=Fs;t;)t=Ac(t.nextSibling)}function uf(){Fs=Us=null,yr=!1}function jT(t){jo===null?jo=[t]:jo.push(t)}var y5=El.ReactCurrentBatchConfig;function Uo(t,e){if(t&&t.defaultProps){e=Cr({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var pv=Vc(null),mv=null,Vd=null,GT=null;function WT(){GT=Vd=mv=null}function $T(t){var e=pv.current;fr(pv),t._currentValue=e}function iE(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Qd(t,e){mv=t,GT=Vd=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(gs=!0),t.firstContext=null)}function po(t){var e=t._currentValue;if(GT!==t)if(t={context:t,memoizedValue:e,next:null},Vd===null){if(mv===null)throw Error(dt(308));Vd=t,mv.dependencies={lanes:0,firstContext:t}}else Vd=Vd.next=t;return e}var Hu=null;function HT(t){Hu===null?Hu=[t]:Hu.push(t)}function mL(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,HT(e)):(n.next=s.next,s.next=n),e.interleaved=n,gl(t,r)}function gl(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var hc=!1;function ZT(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gL(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function dl(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Cc(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,On&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,gl(t,n)}return s=r.interleaved,s===null?(e.next=e,HT(r)):(e.next=s.next,s.next=e),r.interleaved=e,gl(t,n)}function D0(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,kT(t,n)}}function TM(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,u=null;if(n=n.firstBaseUpdate,n!==null){do{var p={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};u===null?s=u=p:u=u.next=p,n=n.next}while(n!==null);u===null?s=u=e:u=u.next=e}else s=u=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:u,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function gv(t,e,n,r){var s=t.updateQueue;hc=!1;var u=s.firstBaseUpdate,p=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var v=o,T=v.next;v.next=null,p===null?u=T:p.next=T,p=v;var I=t.alternate;I!==null&&(I=I.updateQueue,o=I.lastBaseUpdate,o!==p&&(o===null?I.firstBaseUpdate=T:o.next=T,I.lastBaseUpdate=v))}if(u!==null){var L=s.baseState;p=0,I=T=v=null,o=u;do{var F=o.lane,j=o.eventTime;if((r&F)===F){I!==null&&(I=I.next={eventTime:j,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var X=t,re=o;switch(F=e,j=n,re.tag){case 1:if(X=re.payload,typeof X=="function"){L=X.call(j,L,F);break e}L=X;break e;case 3:X.flags=X.flags&-65537|128;case 0:if(X=re.payload,F=typeof X=="function"?X.call(j,L,F):X,F==null)break e;L=Cr({},L,F);break e;case 2:hc=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,F=s.effects,F===null?s.effects=[o]:F.push(o))}else j={eventTime:j,lane:F,tag:o.tag,payload:o.payload,callback:o.callback,next:null},I===null?(T=I=j,v=L):I=I.next=j,p|=F;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;F=o,o=F.next,F.next=null,s.lastBaseUpdate=F,s.shared.pending=null}}while(1);if(I===null&&(v=L),s.baseState=v,s.firstBaseUpdate=T,s.lastBaseUpdate=I,e=s.shared.interleaved,e!==null){s=e;do p|=s.lane,s=s.next;while(s!==e)}else u===null&&(s.shared.lanes=0);oh|=p,t.lanes=p,t.memoizedState=L}}function SM(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(dt(191,s));s.call(r)}}}var _L=new mk.Component().refs;function sE(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Cr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var fx={isMounted:function(t){return(t=t._reactInternals)?ph(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Ji(),s=Pc(t),u=dl(r,s);u.payload=e,n!=null&&(u.callback=n),e=Cc(t,u,s),e!==null&&(Zo(e,t,s,r),D0(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Ji(),s=Pc(t),u=dl(r,s);u.tag=1,u.payload=e,n!=null&&(u.callback=n),e=Cc(t,u,s),e!==null&&(Zo(e,t,s,r),D0(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ji(),r=Pc(t),s=dl(n,r);s.tag=2,e!=null&&(s.callback=e),e=Cc(t,s,r),e!==null&&(Zo(e,t,r,n),D0(e,t,r))}};function AM(t,e,n,r,s,u,p){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,u,p):e.prototype&&e.prototype.isPureReactComponent?!sg(n,r)||!sg(s,u):!0}function yL(t,e,n){var r=!1,s=Dc,u=e.contextType;return typeof u=="object"&&u!==null?u=po(u):(s=xs(e)?rh:ji.current,r=e.contextTypes,u=(r=r!=null)?cf(t,s):Dc),e=new e(n,u),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=fx,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=u),e}function CM(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&fx.enqueueReplaceState(e,e.state,null)}function oE(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs=_L,ZT(t);var u=e.contextType;typeof u=="object"&&u!==null?s.context=po(u):(u=xs(e)?rh:ji.current,s.context=cf(t,u)),s.state=t.memoizedState,u=e.getDerivedStateFromProps,typeof u=="function"&&(sE(t,e,u,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&fx.enqueueReplaceState(s,s.state,null),gv(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function mm(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(dt(309));var r=n.stateNode}if(!r)throw Error(dt(147,t));var s=r,u=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===u?e.ref:(e=function(p){var o=s.refs;o===_L&&(o=s.refs={}),p===null?delete o[u]:o[u]=p},e._stringRef=u,e)}if(typeof t!="string")throw Error(dt(284));if(!n._owner)throw Error(dt(290,t))}return t}function r0(t,e){throw t=Object.prototype.toString.call(e),Error(dt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function MM(t){var e=t._init;return e(t._payload)}function vL(t){function e(q,H){if(t){var J=q.deletions;J===null?(q.deletions=[H],q.flags|=16):J.push(H)}}function n(q,H){if(!t)return null;for(;H!==null;)e(q,H),H=H.sibling;return null}function r(q,H){for(q=new Map;H!==null;)H.key!==null?q.set(H.key,H):q.set(H.index,H),H=H.sibling;return q}function s(q,H){return q=Ic(q,H),q.index=0,q.sibling=null,q}function u(q,H,J){return q.index=J,t?(J=q.alternate,J!==null?(J=J.index,J<H?(q.flags|=2,H):J):(q.flags|=2,H)):(q.flags|=1048576,H)}function p(q){return t&&q.alternate===null&&(q.flags|=2),q}function o(q,H,J,Ee){return H===null||H.tag!==6?(H=Rb(J,q.mode,Ee),H.return=q,H):(H=s(H,J),H.return=q,H)}function v(q,H,J,Ee){var ue=J.type;return ue===Ld?I(q,H,J.props.children,Ee,J.key):H!==null&&(H.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===uc&&MM(ue)===H.type)?(Ee=s(H,J.props),Ee.ref=mm(q,H,J),Ee.return=q,Ee):(Ee=V0(J.type,J.key,J.props,null,q.mode,Ee),Ee.ref=mm(q,H,J),Ee.return=q,Ee)}function T(q,H,J,Ee){return H===null||H.tag!==4||H.stateNode.containerInfo!==J.containerInfo||H.stateNode.implementation!==J.implementation?(H=kb(J,q.mode,Ee),H.return=q,H):(H=s(H,J.children||[]),H.return=q,H)}function I(q,H,J,Ee,ue){return H===null||H.tag!==7?(H=Yu(J,q.mode,Ee,ue),H.return=q,H):(H=s(H,J),H.return=q,H)}function L(q,H,J){if(typeof H=="string"&&H!==""||typeof H=="number")return H=Rb(""+H,q.mode,J),H.return=q,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case Hy:return J=V0(H.type,H.key,H.props,null,q.mode,J),J.ref=mm(q,null,H),J.return=q,J;case kd:return H=kb(H,q.mode,J),H.return=q,H;case uc:var Ee=H._init;return L(q,Ee(H._payload),J)}if(Mm(H)||um(H))return H=Yu(H,q.mode,J,null),H.return=q,H;r0(q,H)}return null}function F(q,H,J,Ee){var ue=H!==null?H.key:null;if(typeof J=="string"&&J!==""||typeof J=="number")return ue!==null?null:o(q,H,""+J,Ee);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case Hy:return J.key===ue?v(q,H,J,Ee):null;case kd:return J.key===ue?T(q,H,J,Ee):null;case uc:return ue=J._init,F(q,H,ue(J._payload),Ee)}if(Mm(J)||um(J))return ue!==null?null:I(q,H,J,Ee,null);r0(q,J)}return null}function j(q,H,J,Ee,ue){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return q=q.get(J)||null,o(H,q,""+Ee,ue);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case Hy:return q=q.get(Ee.key===null?J:Ee.key)||null,v(H,q,Ee,ue);case kd:return q=q.get(Ee.key===null?J:Ee.key)||null,T(H,q,Ee,ue);case uc:var Fe=Ee._init;return j(q,H,J,Fe(Ee._payload),ue)}if(Mm(Ee)||um(Ee))return q=q.get(J)||null,I(H,q,Ee,ue,null);r0(H,Ee)}return null}function X(q,H,J,Ee){for(var ue=null,Fe=null,Qe=H,at=H=0,rt=null;Qe!==null&&at<J.length;at++){Qe.index>at?(rt=Qe,Qe=null):rt=Qe.sibling;var ht=F(q,Qe,J[at],Ee);if(ht===null){Qe===null&&(Qe=rt);break}t&&Qe&&ht.alternate===null&&e(q,Qe),H=u(ht,H,at),Fe===null?ue=ht:Fe.sibling=ht,Fe=ht,Qe=rt}if(at===J.length)return n(q,Qe),yr&&Vu(q,at),ue;if(Qe===null){for(;at<J.length;at++)Qe=L(q,J[at],Ee),Qe!==null&&(H=u(Qe,H,at),Fe===null?ue=Qe:Fe.sibling=Qe,Fe=Qe);return yr&&Vu(q,at),ue}for(Qe=r(q,Qe);at<J.length;at++)rt=j(Qe,q,at,J[at],Ee),rt!==null&&(t&&rt.alternate!==null&&Qe.delete(rt.key===null?at:rt.key),H=u(rt,H,at),Fe===null?ue=rt:Fe.sibling=rt,Fe=rt);return t&&Qe.forEach(function(Bt){return e(q,Bt)}),yr&&Vu(q,at),ue}function re(q,H,J,Ee){var ue=um(J);if(typeof ue!="function")throw Error(dt(150));if(J=ue.call(J),J==null)throw Error(dt(151));for(var Fe=ue=null,Qe=H,at=H=0,rt=null,ht=J.next();Qe!==null&&!ht.done;at++,ht=J.next()){Qe.index>at?(rt=Qe,Qe=null):rt=Qe.sibling;var Bt=F(q,Qe,ht.value,Ee);if(Bt===null){Qe===null&&(Qe=rt);break}t&&Qe&&Bt.alternate===null&&e(q,Qe),H=u(Bt,H,at),Fe===null?ue=Bt:Fe.sibling=Bt,Fe=Bt,Qe=rt}if(ht.done)return n(q,Qe),yr&&Vu(q,at),ue;if(Qe===null){for(;!ht.done;at++,ht=J.next())ht=L(q,ht.value,Ee),ht!==null&&(H=u(ht,H,at),Fe===null?ue=ht:Fe.sibling=ht,Fe=ht);return yr&&Vu(q,at),ue}for(Qe=r(q,Qe);!ht.done;at++,ht=J.next())ht=j(Qe,q,at,ht.value,Ee),ht!==null&&(t&&ht.alternate!==null&&Qe.delete(ht.key===null?at:ht.key),H=u(ht,H,at),Fe===null?ue=ht:Fe.sibling=ht,Fe=ht);return t&&Qe.forEach(function(Dn){return e(q,Dn)}),yr&&Vu(q,at),ue}function de(q,H,J,Ee){if(typeof J=="object"&&J!==null&&J.type===Ld&&J.key===null&&(J=J.props.children),typeof J=="object"&&J!==null){switch(J.$$typeof){case Hy:e:{for(var ue=J.key,Fe=H;Fe!==null;){if(Fe.key===ue){if(ue=J.type,ue===Ld){if(Fe.tag===7){n(q,Fe.sibling),H=s(Fe,J.props.children),H.return=q,q=H;break e}}else if(Fe.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===uc&&MM(ue)===Fe.type){n(q,Fe.sibling),H=s(Fe,J.props),H.ref=mm(q,Fe,J),H.return=q,q=H;break e}n(q,Fe);break}else e(q,Fe);Fe=Fe.sibling}J.type===Ld?(H=Yu(J.props.children,q.mode,Ee,J.key),H.return=q,q=H):(Ee=V0(J.type,J.key,J.props,null,q.mode,Ee),Ee.ref=mm(q,H,J),Ee.return=q,q=Ee)}return p(q);case kd:e:{for(Fe=J.key;H!==null;){if(H.key===Fe)if(H.tag===4&&H.stateNode.containerInfo===J.containerInfo&&H.stateNode.implementation===J.implementation){n(q,H.sibling),H=s(H,J.children||[]),H.return=q,q=H;break e}else{n(q,H);break}else e(q,H);H=H.sibling}H=kb(J,q.mode,Ee),H.return=q,q=H}return p(q);case uc:return Fe=J._init,de(q,H,Fe(J._payload),Ee)}if(Mm(J))return X(q,H,J,Ee);if(um(J))return re(q,H,J,Ee);r0(q,J)}return typeof J=="string"&&J!==""||typeof J=="number"?(J=""+J,H!==null&&H.tag===6?(n(q,H.sibling),H=s(H,J),H.return=q,q=H):(n(q,H),H=Rb(J,q.mode,Ee),H.return=q,q=H),p(q)):n(q,H)}return de}var hf=vL(!0),xL=vL(!1),Og={},Da=Vc(Og),cg=Vc(Og),ug=Vc(Og);function Zu(t){if(t===Og)throw Error(dt(174));return t}function qT(t,e){switch(or(ug,e),or(cg,t),or(Da,Og),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Nw(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Nw(e,t)}fr(Da),or(Da,e)}function df(){fr(Da),fr(cg),fr(ug)}function bL(t){Zu(ug.current);var e=Zu(Da.current),n=Nw(e,t.type);e!==n&&(or(cg,t),or(Da,n))}function XT(t){cg.current===t&&(fr(Da),fr(cg))}var Tr=Vc(0);function _v(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Sb=[];function YT(){for(var t=0;t<Sb.length;t++)Sb[t]._workInProgressVersionPrimary=null;Sb.length=0}var z0=El.ReactCurrentDispatcher,Ab=El.ReactCurrentBatchConfig,sh=0,Ar=null,ni=null,mi=null,yv=!1,Um=!1,hg=0,v5=0;function Fi(){throw Error(dt(321))}function KT(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ko(t[n],e[n]))return!1;return!0}function JT(t,e,n,r,s,u){if(sh=u,Ar=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,z0.current=t===null||t.memoizedState===null?E5:T5,t=n(r,s),Um){u=0;do{if(Um=!1,hg=0,25<=u)throw Error(dt(301));u+=1,mi=ni=null,e.updateQueue=null,z0.current=S5,t=n(r,s)}while(Um)}if(z0.current=vv,e=ni!==null&&ni.next!==null,sh=0,mi=ni=Ar=null,yv=!1,e)throw Error(dt(300));return t}function QT(){var t=hg!==0;return hg=0,t}function Ma(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mi===null?Ar.memoizedState=mi=t:mi=mi.next=t,mi}function mo(){if(ni===null){var t=Ar.alternate;t=t!==null?t.memoizedState:null}else t=ni.next;var e=mi===null?Ar.memoizedState:mi.next;if(e!==null)mi=e,ni=t;else{if(t===null)throw Error(dt(310));ni=t,t={memoizedState:ni.memoizedState,baseState:ni.baseState,baseQueue:ni.baseQueue,queue:ni.queue,next:null},mi===null?Ar.memoizedState=mi=t:mi=mi.next=t}return mi}function dg(t,e){return typeof e=="function"?e(t):e}function Cb(t){var e=mo(),n=e.queue;if(n===null)throw Error(dt(311));n.lastRenderedReducer=t;var r=ni,s=r.baseQueue,u=n.pending;if(u!==null){if(s!==null){var p=s.next;s.next=u.next,u.next=p}r.baseQueue=s=u,n.pending=null}if(s!==null){u=s.next,r=r.baseState;var o=p=null,v=null,T=u;do{var I=T.lane;if((sh&I)===I)v!==null&&(v=v.next={lane:0,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null}),r=T.hasEagerState?T.eagerState:t(r,T.action);else{var L={lane:I,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null};v===null?(o=v=L,p=r):v=v.next=L,Ar.lanes|=I,oh|=I}T=T.next}while(T!==null&&T!==u);v===null?p=r:v.next=o,Ko(r,e.memoizedState)||(gs=!0),e.memoizedState=r,e.baseState=p,e.baseQueue=v,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do u=s.lane,Ar.lanes|=u,oh|=u,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Mb(t){var e=mo(),n=e.queue;if(n===null)throw Error(dt(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,u=e.memoizedState;if(s!==null){n.pending=null;var p=s=s.next;do u=t(u,p.action),p=p.next;while(p!==s);Ko(u,e.memoizedState)||(gs=!0),e.memoizedState=u,e.baseQueue===null&&(e.baseState=u),n.lastRenderedState=u}return[u,r]}function wL(){}function EL(t,e){var n=Ar,r=mo(),s=e(),u=!Ko(r.memoizedState,s);if(u&&(r.memoizedState=s,gs=!0),r=r.queue,eS(AL.bind(null,n,r,t),[t]),r.getSnapshot!==e||u||mi!==null&&mi.memoizedState.tag&1){if(n.flags|=2048,fg(9,SL.bind(null,n,r,s,e),void 0,null),_i===null)throw Error(dt(349));sh&30||TL(n,e,s)}return s}function TL(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ar.updateQueue,e===null?(e={lastEffect:null,stores:null},Ar.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function SL(t,e,n,r){e.value=n,e.getSnapshot=r,CL(e)&&ML(t)}function AL(t,e,n){return n(function(){CL(e)&&ML(t)})}function CL(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ko(t,n)}catch{return!0}}function ML(t){var e=gl(t,1);e!==null&&Zo(e,t,1,-1)}function PM(t){var e=Ma();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:dg,lastRenderedState:t},e.queue=t,t=t.dispatch=w5.bind(null,Ar,t),[e.memoizedState,t]}function fg(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Ar.updateQueue,e===null?(e={lastEffect:null,stores:null},Ar.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function PL(){return mo().memoizedState}function F0(t,e,n,r){var s=Ma();Ar.flags|=t,s.memoizedState=fg(1|e,n,void 0,r===void 0?null:r)}function px(t,e,n,r){var s=mo();r=r===void 0?null:r;var u=void 0;if(ni!==null){var p=ni.memoizedState;if(u=p.destroy,r!==null&&KT(r,p.deps)){s.memoizedState=fg(e,n,u,r);return}}Ar.flags|=t,s.memoizedState=fg(1|e,n,u,r)}function IM(t,e){return F0(8390656,8,t,e)}function eS(t,e){return px(2048,8,t,e)}function IL(t,e){return px(4,2,t,e)}function RL(t,e){return px(4,4,t,e)}function kL(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function LL(t,e,n){return n=n!=null?n.concat([t]):null,px(4,4,kL.bind(null,e,t),n)}function tS(){}function OL(t,e){var n=mo();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&KT(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function DL(t,e){var n=mo();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&KT(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function zL(t,e,n){return sh&21?(Ko(n,e)||(n=Bk(),Ar.lanes|=n,oh|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,gs=!0),t.memoizedState=n)}function x5(t,e){var n=er;er=n!==0&&4>n?n:4,t(!0);var r=Ab.transition;Ab.transition={};try{t(!1),e()}finally{er=n,Ab.transition=r}}function FL(){return mo().memoizedState}function b5(t,e,n){var r=Pc(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},NL(t))BL(e,n);else if(n=mL(t,e,n,r),n!==null){var s=Ji();Zo(n,t,r,s),UL(n,e,r)}}function w5(t,e,n){var r=Pc(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(NL(t))BL(e,s);else{var u=t.alternate;if(t.lanes===0&&(u===null||u.lanes===0)&&(u=e.lastRenderedReducer,u!==null))try{var p=e.lastRenderedState,o=u(p,n);if(s.hasEagerState=!0,s.eagerState=o,Ko(o,p)){var v=e.interleaved;v===null?(s.next=s,HT(e)):(s.next=v.next,v.next=s),e.interleaved=s;return}}catch{}finally{}n=mL(t,e,s,r),n!==null&&(s=Ji(),Zo(n,t,r,s),UL(n,e,r))}}function NL(t){var e=t.alternate;return t===Ar||e!==null&&e===Ar}function BL(t,e){Um=yv=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function UL(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,kT(t,n)}}var vv={readContext:po,useCallback:Fi,useContext:Fi,useEffect:Fi,useImperativeHandle:Fi,useInsertionEffect:Fi,useLayoutEffect:Fi,useMemo:Fi,useReducer:Fi,useRef:Fi,useState:Fi,useDebugValue:Fi,useDeferredValue:Fi,useTransition:Fi,useMutableSource:Fi,useSyncExternalStore:Fi,useId:Fi,unstable_isNewReconciler:!1},E5={readContext:po,useCallback:function(t,e){return Ma().memoizedState=[t,e===void 0?null:e],t},useContext:po,useEffect:IM,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,F0(4194308,4,kL.bind(null,e,t),n)},useLayoutEffect:function(t,e){return F0(4194308,4,t,e)},useInsertionEffect:function(t,e){return F0(4,2,t,e)},useMemo:function(t,e){var n=Ma();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Ma();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=b5.bind(null,Ar,t),[r.memoizedState,t]},useRef:function(t){var e=Ma();return t={current:t},e.memoizedState=t},useState:PM,useDebugValue:tS,useDeferredValue:function(t){return Ma().memoizedState=t},useTransition:function(){var t=PM(!1),e=t[0];return t=x5.bind(null,t[1]),Ma().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Ar,s=Ma();if(yr){if(n===void 0)throw Error(dt(407));n=n()}else{if(n=e(),_i===null)throw Error(dt(349));sh&30||TL(r,e,n)}s.memoizedState=n;var u={value:n,getSnapshot:e};return s.queue=u,IM(AL.bind(null,r,u,t),[t]),r.flags|=2048,fg(9,SL.bind(null,r,u,n,e),void 0,null),n},useId:function(){var t=Ma(),e=_i.identifierPrefix;if(yr){var n=ul,r=cl;n=(r&~(1<<32-Ho(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=hg++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=v5++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},T5={readContext:po,useCallback:OL,useContext:po,useEffect:eS,useImperativeHandle:LL,useInsertionEffect:IL,useLayoutEffect:RL,useMemo:DL,useReducer:Cb,useRef:PL,useState:function(){return Cb(dg)},useDebugValue:tS,useDeferredValue:function(t){var e=mo();return zL(e,ni.memoizedState,t)},useTransition:function(){var t=Cb(dg)[0],e=mo().memoizedState;return[t,e]},useMutableSource:wL,useSyncExternalStore:EL,useId:FL,unstable_isNewReconciler:!1},S5={readContext:po,useCallback:OL,useContext:po,useEffect:eS,useImperativeHandle:LL,useInsertionEffect:IL,useLayoutEffect:RL,useMemo:DL,useReducer:Mb,useRef:PL,useState:function(){return Mb(dg)},useDebugValue:tS,useDeferredValue:function(t){var e=mo();return ni===null?e.memoizedState=t:zL(e,ni.memoizedState,t)},useTransition:function(){var t=Mb(dg)[0],e=mo().memoizedState;return[t,e]},useMutableSource:wL,useSyncExternalStore:EL,useId:FL,unstable_isNewReconciler:!1};function ff(t,e){try{var n="",r=e;do n+=Q4(r),r=r.return;while(r);var s=n}catch(u){s=`
Error generating stack: `+u.message+`
`+u.stack}return{value:t,source:e,stack:s,digest:null}}function Pb(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function aE(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var A5=typeof WeakMap=="function"?WeakMap:Map;function VL(t,e,n){n=dl(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){bv||(bv=!0,_E=r),aE(t,e)},n}function jL(t,e,n){n=dl(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){aE(t,e)}}var u=t.stateNode;return u!==null&&typeof u.componentDidCatch=="function"&&(n.callback=function(){aE(t,e),typeof r!="function"&&(Mc===null?Mc=new Set([this]):Mc.add(this));var p=e.stack;this.componentDidCatch(e.value,{componentStack:p!==null?p:""})}),n}function RM(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new A5;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=U5.bind(null,t,e,n),e.then(t,t))}function kM(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function LM(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=dl(-1,1),e.tag=2,Cc(n,e,1))),n.lanes|=1),t)}var C5=El.ReactCurrentOwner,gs=!1;function Zi(t,e,n,r){e.child=t===null?xL(e,null,n,r):hf(e,t.child,n,r)}function OM(t,e,n,r,s){n=n.render;var u=e.ref;return Qd(e,s),r=JT(t,e,n,r,u,s),n=QT(),t!==null&&!gs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,_l(t,e,s)):(yr&&n&&UT(e),e.flags|=1,Zi(t,e,r,s),e.child)}function DM(t,e,n,r,s){if(t===null){var u=n.type;return typeof u=="function"&&!cS(u)&&u.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=u,GL(t,e,u,r,s)):(t=V0(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(u=t.child,!(t.lanes&s)){var p=u.memoizedProps;if(n=n.compare,n=n!==null?n:sg,n(p,r)&&t.ref===e.ref)return _l(t,e,s)}return e.flags|=1,t=Ic(u,r),t.ref=e.ref,t.return=e,e.child=t}function GL(t,e,n,r,s){if(t!==null){var u=t.memoizedProps;if(sg(u,r)&&t.ref===e.ref)if(gs=!1,e.pendingProps=r=u,(t.lanes&s)!==0)t.flags&131072&&(gs=!0);else return e.lanes=t.lanes,_l(t,e,s)}return lE(t,e,n,r,s)}function WL(t,e,n){var r=e.pendingProps,s=r.children,u=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},or(Gd,Os),Os|=n;else{if(!(n&1073741824))return t=u!==null?u.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,or(Gd,Os),Os|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=u!==null?u.baseLanes:n,or(Gd,Os),Os|=r}else u!==null?(r=u.baseLanes|n,e.memoizedState=null):r=n,or(Gd,Os),Os|=r;return Zi(t,e,s,n),e.child}function $L(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function lE(t,e,n,r,s){var u=xs(n)?rh:ji.current;return u=cf(e,u),Qd(e,s),n=JT(t,e,n,r,u,s),r=QT(),t!==null&&!gs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,_l(t,e,s)):(yr&&r&&UT(e),e.flags|=1,Zi(t,e,n,s),e.child)}function zM(t,e,n,r,s){if(xs(n)){var u=!0;hv(e)}else u=!1;if(Qd(e,s),e.stateNode===null)N0(t,e),yL(e,n,r),oE(e,n,r,s),r=!0;else if(t===null){var p=e.stateNode,o=e.memoizedProps;p.props=o;var v=p.context,T=n.contextType;typeof T=="object"&&T!==null?T=po(T):(T=xs(n)?rh:ji.current,T=cf(e,T));var I=n.getDerivedStateFromProps,L=typeof I=="function"||typeof p.getSnapshotBeforeUpdate=="function";L||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(o!==r||v!==T)&&CM(e,p,r,T),hc=!1;var F=e.memoizedState;p.state=F,gv(e,r,p,s),v=e.memoizedState,o!==r||F!==v||vs.current||hc?(typeof I=="function"&&(sE(e,n,I,r),v=e.memoizedState),(o=hc||AM(e,n,o,r,F,v,T))?(L||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(e.flags|=4194308)):(typeof p.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=v),p.props=r,p.state=v,p.context=T,r=o):(typeof p.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{p=e.stateNode,gL(t,e),o=e.memoizedProps,T=e.type===e.elementType?o:Uo(e.type,o),p.props=T,L=e.pendingProps,F=p.context,v=n.contextType,typeof v=="object"&&v!==null?v=po(v):(v=xs(n)?rh:ji.current,v=cf(e,v));var j=n.getDerivedStateFromProps;(I=typeof j=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(o!==L||F!==v)&&CM(e,p,r,v),hc=!1,F=e.memoizedState,p.state=F,gv(e,r,p,s);var X=e.memoizedState;o!==L||F!==X||vs.current||hc?(typeof j=="function"&&(sE(e,n,j,r),X=e.memoizedState),(T=hc||AM(e,n,T,r,F,X,v)||!1)?(I||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(r,X,v),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(r,X,v)),typeof p.componentDidUpdate=="function"&&(e.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof p.componentDidUpdate!="function"||o===t.memoizedProps&&F===t.memoizedState||(e.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&F===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=X),p.props=r,p.state=X,p.context=v,r=T):(typeof p.componentDidUpdate!="function"||o===t.memoizedProps&&F===t.memoizedState||(e.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&F===t.memoizedState||(e.flags|=1024),r=!1)}return cE(t,e,n,r,u,s)}function cE(t,e,n,r,s,u){$L(t,e);var p=(e.flags&128)!==0;if(!r&&!p)return s&&bM(e,n,!1),_l(t,e,u);r=e.stateNode,C5.current=e;var o=p&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&p?(e.child=hf(e,t.child,null,u),e.child=hf(e,null,o,u)):Zi(t,e,o,u),e.memoizedState=r.state,s&&bM(e,n,!0),e.child}function HL(t){var e=t.stateNode;e.pendingContext?xM(t,e.pendingContext,e.pendingContext!==e.context):e.context&&xM(t,e.context,!1),qT(t,e.containerInfo)}function FM(t,e,n,r,s){return uf(),jT(s),e.flags|=256,Zi(t,e,n,r),e.child}var uE={dehydrated:null,treeContext:null,retryLane:0};function hE(t){return{baseLanes:t,cachePool:null,transitions:null}}function ZL(t,e,n){var r=e.pendingProps,s=Tr.current,u=!1,p=(e.flags&128)!==0,o;if((o=p)||(o=t!==null&&t.memoizedState===null?!1:(s&2)!==0),o?(u=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),or(Tr,s&1),t===null)return rE(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(p=r.children,t=r.fallback,u?(r=e.mode,u=e.child,p={mode:"hidden",children:p},!(r&1)&&u!==null?(u.childLanes=0,u.pendingProps=p):u=_x(p,r,0,null),t=Yu(t,r,n,null),u.return=e,t.return=e,u.sibling=t,e.child=u,e.child.memoizedState=hE(n),e.memoizedState=uE,t):nS(e,p));if(s=t.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return M5(t,e,p,r,o,s,n);if(u){u=r.fallback,p=e.mode,s=t.child,o=s.sibling;var v={mode:"hidden",children:r.children};return!(p&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=v,e.deletions=null):(r=Ic(s,v),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?u=Ic(o,u):(u=Yu(u,p,n,null),u.flags|=2),u.return=e,r.return=e,r.sibling=u,e.child=r,r=u,u=e.child,p=t.child.memoizedState,p=p===null?hE(n):{baseLanes:p.baseLanes|n,cachePool:null,transitions:p.transitions},u.memoizedState=p,u.childLanes=t.childLanes&~n,e.memoizedState=uE,r}return u=t.child,t=u.sibling,r=Ic(u,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function nS(t,e){return e=_x({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function i0(t,e,n,r){return r!==null&&jT(r),hf(e,t.child,null,n),t=nS(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function M5(t,e,n,r,s,u,p){if(n)return e.flags&256?(e.flags&=-257,r=Pb(Error(dt(422))),i0(t,e,p,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(u=r.fallback,s=e.mode,r=_x({mode:"visible",children:r.children},s,0,null),u=Yu(u,s,p,null),u.flags|=2,r.return=e,u.return=e,r.sibling=u,e.child=r,e.mode&1&&hf(e,t.child,null,p),e.child.memoizedState=hE(p),e.memoizedState=uE,u);if(!(e.mode&1))return i0(t,e,p,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,u=Error(dt(419)),r=Pb(u,r,void 0),i0(t,e,p,r)}if(o=(p&t.childLanes)!==0,gs||o){if(r=_i,r!==null){switch(p&-p){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|p)?0:s,s!==0&&s!==u.retryLane&&(u.retryLane=s,gl(t,s),Zo(r,t,s,-1))}return lS(),r=Pb(Error(dt(421))),i0(t,e,p,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=V5.bind(null,t),s._reactRetry=e,null):(t=u.treeContext,Fs=Ac(s.nextSibling),Us=e,yr=!0,jo=null,t!==null&&(io[so++]=cl,io[so++]=ul,io[so++]=ih,cl=t.id,ul=t.overflow,ih=e),e=nS(e,r.children),e.flags|=4096,e)}function NM(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),iE(t.return,e,n)}function Ib(t,e,n,r,s){var u=t.memoizedState;u===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(u.isBackwards=e,u.rendering=null,u.renderingStartTime=0,u.last=r,u.tail=n,u.tailMode=s)}function qL(t,e,n){var r=e.pendingProps,s=r.revealOrder,u=r.tail;if(Zi(t,e,r.children,n),r=Tr.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&NM(t,n,e);else if(t.tag===19)NM(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(or(Tr,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&_v(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Ib(e,!1,s,n,u);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&_v(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Ib(e,!0,n,null,u);break;case"together":Ib(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function N0(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function _l(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),oh|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(dt(153));if(e.child!==null){for(t=e.child,n=Ic(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ic(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function P5(t,e,n){switch(e.tag){case 3:HL(e),uf();break;case 5:bL(e);break;case 1:xs(e.type)&&hv(e);break;case 4:qT(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;or(pv,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(or(Tr,Tr.current&1),e.flags|=128,null):n&e.child.childLanes?ZL(t,e,n):(or(Tr,Tr.current&1),t=_l(t,e,n),t!==null?t.sibling:null);or(Tr,Tr.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return qL(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),or(Tr,Tr.current),r)break;return null;case 22:case 23:return e.lanes=0,WL(t,e,n)}return _l(t,e,n)}var XL,dE,YL,KL;XL=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};dE=function(){};YL=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Zu(Da.current);var u=null;switch(n){case"input":s=Ow(t,s),r=Ow(t,r),u=[];break;case"select":s=Cr({},s,{value:void 0}),r=Cr({},r,{value:void 0}),u=[];break;case"textarea":s=Fw(t,s),r=Fw(t,r),u=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=cv)}Bw(n,r);var p;n=null;for(T in s)if(!r.hasOwnProperty(T)&&s.hasOwnProperty(T)&&s[T]!=null)if(T==="style"){var o=s[T];for(p in o)o.hasOwnProperty(p)&&(n||(n={}),n[p]="")}else T!=="dangerouslySetInnerHTML"&&T!=="children"&&T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(Jm.hasOwnProperty(T)?u||(u=[]):(u=u||[]).push(T,null));for(T in r){var v=r[T];if(o=s!=null?s[T]:void 0,r.hasOwnProperty(T)&&v!==o&&(v!=null||o!=null))if(T==="style")if(o){for(p in o)!o.hasOwnProperty(p)||v&&v.hasOwnProperty(p)||(n||(n={}),n[p]="");for(p in v)v.hasOwnProperty(p)&&o[p]!==v[p]&&(n||(n={}),n[p]=v[p])}else n||(u||(u=[]),u.push(T,n)),n=v;else T==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,o=o?o.__html:void 0,v!=null&&o!==v&&(u=u||[]).push(T,v)):T==="children"?typeof v!="string"&&typeof v!="number"||(u=u||[]).push(T,""+v):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&(Jm.hasOwnProperty(T)?(v!=null&&T==="onScroll"&&hr("scroll",t),u||o===v||(u=[])):(u=u||[]).push(T,v))}n&&(u=u||[]).push("style",n);var T=u;(e.updateQueue=T)&&(e.flags|=4)}};KL=function(t,e,n,r){n!==r&&(e.flags|=4)};function gm(t,e){if(!yr)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ni(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function I5(t,e,n){var r=e.pendingProps;switch(VT(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ni(e),null;case 1:return xs(e.type)&&uv(),Ni(e),null;case 3:return r=e.stateNode,df(),fr(vs),fr(ji),YT(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(n0(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,jo!==null&&(xE(jo),jo=null))),dE(t,e),Ni(e),null;case 5:XT(e);var s=Zu(ug.current);if(n=e.type,t!==null&&e.stateNode!=null)YL(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(dt(166));return Ni(e),null}if(t=Zu(Da.current),n0(e)){r=e.stateNode,n=e.type;var u=e.memoizedProps;switch(r[Pa]=e,r[lg]=u,t=(e.mode&1)!==0,n){case"dialog":hr("cancel",r),hr("close",r);break;case"iframe":case"object":case"embed":hr("load",r);break;case"video":case"audio":for(s=0;s<Im.length;s++)hr(Im[s],r);break;case"source":hr("error",r);break;case"img":case"image":case"link":hr("error",r),hr("load",r);break;case"details":hr("toggle",r);break;case"input":ZC(r,u),hr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!u.multiple},hr("invalid",r);break;case"textarea":XC(r,u),hr("invalid",r)}Bw(n,u),s=null;for(var p in u)if(u.hasOwnProperty(p)){var o=u[p];p==="children"?typeof o=="string"?r.textContent!==o&&(u.suppressHydrationWarning!==!0&&t0(r.textContent,o,t),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(u.suppressHydrationWarning!==!0&&t0(r.textContent,o,t),s=["children",""+o]):Jm.hasOwnProperty(p)&&o!=null&&p==="onScroll"&&hr("scroll",r)}switch(n){case"input":Zy(r),qC(r,u,!0);break;case"textarea":Zy(r),YC(r);break;case"select":case"option":break;default:typeof u.onClick=="function"&&(r.onclick=cv)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{p=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Tk(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=p.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=p.createElement(n,{is:r.is}):(t=p.createElement(n),n==="select"&&(p=t,r.multiple?p.multiple=!0:r.size&&(p.size=r.size))):t=p.createElementNS(t,n),t[Pa]=e,t[lg]=r,XL(t,e,!1,!1),e.stateNode=t;e:{switch(p=Uw(n,r),n){case"dialog":hr("cancel",t),hr("close",t),s=r;break;case"iframe":case"object":case"embed":hr("load",t),s=r;break;case"video":case"audio":for(s=0;s<Im.length;s++)hr(Im[s],t);s=r;break;case"source":hr("error",t),s=r;break;case"img":case"image":case"link":hr("error",t),hr("load",t),s=r;break;case"details":hr("toggle",t),s=r;break;case"input":ZC(t,r),s=Ow(t,r),hr("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Cr({},r,{value:void 0}),hr("invalid",t);break;case"textarea":XC(t,r),s=Fw(t,r),hr("invalid",t);break;default:s=r}Bw(n,s),o=s;for(u in o)if(o.hasOwnProperty(u)){var v=o[u];u==="style"?Ck(t,v):u==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&Sk(t,v)):u==="children"?typeof v=="string"?(n!=="textarea"||v!=="")&&Qm(t,v):typeof v=="number"&&Qm(t,""+v):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Jm.hasOwnProperty(u)?v!=null&&u==="onScroll"&&hr("scroll",t):v!=null&&AT(t,u,v,p))}switch(n){case"input":Zy(t),qC(t,r,!1);break;case"textarea":Zy(t),YC(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Oc(r.value));break;case"select":t.multiple=!!r.multiple,u=r.value,u!=null?Xd(t,!!r.multiple,u,!1):r.defaultValue!=null&&Xd(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=cv)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ni(e),null;case 6:if(t&&e.stateNode!=null)KL(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(dt(166));if(n=Zu(ug.current),Zu(Da.current),n0(e)){if(r=e.stateNode,n=e.memoizedProps,r[Pa]=e,(u=r.nodeValue!==n)&&(t=Us,t!==null))switch(t.tag){case 3:t0(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&t0(r.nodeValue,n,(t.mode&1)!==0)}u&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Pa]=e,e.stateNode=r}return Ni(e),null;case 13:if(fr(Tr),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(yr&&Fs!==null&&e.mode&1&&!(e.flags&128))pL(),uf(),e.flags|=98560,u=!1;else if(u=n0(e),r!==null&&r.dehydrated!==null){if(t===null){if(!u)throw Error(dt(318));if(u=e.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(dt(317));u[Pa]=e}else uf(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ni(e),u=!1}else jo!==null&&(xE(jo),jo=null),u=!0;if(!u)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Tr.current&1?ri===0&&(ri=3):lS())),e.updateQueue!==null&&(e.flags|=4),Ni(e),null);case 4:return df(),dE(t,e),t===null&&og(e.stateNode.containerInfo),Ni(e),null;case 10:return $T(e.type._context),Ni(e),null;case 17:return xs(e.type)&&uv(),Ni(e),null;case 19:if(fr(Tr),u=e.memoizedState,u===null)return Ni(e),null;if(r=(e.flags&128)!==0,p=u.rendering,p===null)if(r)gm(u,!1);else{if(ri!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(p=_v(t),p!==null){for(e.flags|=128,gm(u,!1),r=p.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)u=n,t=r,u.flags&=14680066,p=u.alternate,p===null?(u.childLanes=0,u.lanes=t,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=p.childLanes,u.lanes=p.lanes,u.child=p.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=p.memoizedProps,u.memoizedState=p.memoizedState,u.updateQueue=p.updateQueue,u.type=p.type,t=p.dependencies,u.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return or(Tr,Tr.current&1|2),e.child}t=t.sibling}u.tail!==null&&zr()>pf&&(e.flags|=128,r=!0,gm(u,!1),e.lanes=4194304)}else{if(!r)if(t=_v(p),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),gm(u,!0),u.tail===null&&u.tailMode==="hidden"&&!p.alternate&&!yr)return Ni(e),null}else 2*zr()-u.renderingStartTime>pf&&n!==1073741824&&(e.flags|=128,r=!0,gm(u,!1),e.lanes=4194304);u.isBackwards?(p.sibling=e.child,e.child=p):(n=u.last,n!==null?n.sibling=p:e.child=p,u.last=p)}return u.tail!==null?(e=u.tail,u.rendering=e,u.tail=e.sibling,u.renderingStartTime=zr(),e.sibling=null,n=Tr.current,or(Tr,r?n&1|2:n&1),e):(Ni(e),null);case 22:case 23:return aS(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Os&1073741824&&(Ni(e),e.subtreeFlags&6&&(e.flags|=8192)):Ni(e),null;case 24:return null;case 25:return null}throw Error(dt(156,e.tag))}function R5(t,e){switch(VT(e),e.tag){case 1:return xs(e.type)&&uv(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return df(),fr(vs),fr(ji),YT(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return XT(e),null;case 13:if(fr(Tr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(dt(340));uf()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return fr(Tr),null;case 4:return df(),null;case 10:return $T(e.type._context),null;case 22:case 23:return aS(),null;case 24:return null;default:return null}}var s0=!1,Ui=!1,k5=typeof WeakSet=="function"?WeakSet:Set,kt=null;function jd(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){kr(t,e,r)}else n.current=null}function fE(t,e,n){try{n()}catch(r){kr(t,e,r)}}var BM=!1;function L5(t,e){if(Yw=ov,t=tL(),BT(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,u=r.focusNode;r=r.focusOffset;try{n.nodeType,u.nodeType}catch{n=null;break e}var p=0,o=-1,v=-1,T=0,I=0,L=t,F=null;t:for(;;){for(var j;L!==n||s!==0&&L.nodeType!==3||(o=p+s),L!==u||r!==0&&L.nodeType!==3||(v=p+r),L.nodeType===3&&(p+=L.nodeValue.length),(j=L.firstChild)!==null;)F=L,L=j;for(;;){if(L===t)break t;if(F===n&&++T===s&&(o=p),F===u&&++I===r&&(v=p),(j=L.nextSibling)!==null)break;L=F,F=L.parentNode}L=j}n=o===-1||v===-1?null:{start:o,end:v}}else n=null}n=n||{start:0,end:0}}else n=null;for(Kw={focusedElem:t,selectionRange:n},ov=!1,kt=e;kt!==null;)if(e=kt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,kt=t;else for(;kt!==null;){e=kt;try{var X=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(X!==null){var re=X.memoizedProps,de=X.memoizedState,q=e.stateNode,H=q.getSnapshotBeforeUpdate(e.elementType===e.type?re:Uo(e.type,re),de);q.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var J=e.stateNode.containerInfo;J.nodeType===1?J.textContent="":J.nodeType===9&&J.documentElement&&J.removeChild(J.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(dt(163))}}catch(Ee){kr(e,e.return,Ee)}if(t=e.sibling,t!==null){t.return=e.return,kt=t;break}kt=e.return}return X=BM,BM=!1,X}function Vm(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var u=s.destroy;s.destroy=void 0,u!==void 0&&fE(e,n,u)}s=s.next}while(s!==r)}}function mx(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function pE(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function JL(t){var e=t.alternate;e!==null&&(t.alternate=null,JL(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Pa],delete e[lg],delete e[eE],delete e[m5],delete e[g5])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function QL(t){return t.tag===5||t.tag===3||t.tag===4}function UM(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||QL(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function mE(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=cv));else if(r!==4&&(t=t.child,t!==null))for(mE(t,e,n),t=t.sibling;t!==null;)mE(t,e,n),t=t.sibling}function gE(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(gE(t,e,n),t=t.sibling;t!==null;)gE(t,e,n),t=t.sibling}var Ei=null,Vo=!1;function nc(t,e,n){for(n=n.child;n!==null;)eO(t,e,n),n=n.sibling}function eO(t,e,n){if(Oa&&typeof Oa.onCommitFiberUnmount=="function")try{Oa.onCommitFiberUnmount(ax,n)}catch{}switch(n.tag){case 5:Ui||jd(n,e);case 6:var r=Ei,s=Vo;Ei=null,nc(t,e,n),Ei=r,Vo=s,Ei!==null&&(Vo?(t=Ei,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ei.removeChild(n.stateNode));break;case 18:Ei!==null&&(Vo?(t=Ei,n=n.stateNode,t.nodeType===8?Eb(t.parentNode,n):t.nodeType===1&&Eb(t,n),rg(t)):Eb(Ei,n.stateNode));break;case 4:r=Ei,s=Vo,Ei=n.stateNode.containerInfo,Vo=!0,nc(t,e,n),Ei=r,Vo=s;break;case 0:case 11:case 14:case 15:if(!Ui&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var u=s,p=u.destroy;u=u.tag,p!==void 0&&(u&2||u&4)&&fE(n,e,p),s=s.next}while(s!==r)}nc(t,e,n);break;case 1:if(!Ui&&(jd(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){kr(n,e,o)}nc(t,e,n);break;case 21:nc(t,e,n);break;case 22:n.mode&1?(Ui=(r=Ui)||n.memoizedState!==null,nc(t,e,n),Ui=r):nc(t,e,n);break;default:nc(t,e,n)}}function VM(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new k5),e.forEach(function(r){var s=j5.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Fo(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var u=t,p=e,o=p;e:for(;o!==null;){switch(o.tag){case 5:Ei=o.stateNode,Vo=!1;break e;case 3:Ei=o.stateNode.containerInfo,Vo=!0;break e;case 4:Ei=o.stateNode.containerInfo,Vo=!0;break e}o=o.return}if(Ei===null)throw Error(dt(160));eO(u,p,s),Ei=null,Vo=!1;var v=s.alternate;v!==null&&(v.return=null),s.return=null}catch(T){kr(s,e,T)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)tO(e,t),e=e.sibling}function tO(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Fo(e,t),Ta(t),r&4){try{Vm(3,t,t.return),mx(3,t)}catch(re){kr(t,t.return,re)}try{Vm(5,t,t.return)}catch(re){kr(t,t.return,re)}}break;case 1:Fo(e,t),Ta(t),r&512&&n!==null&&jd(n,n.return);break;case 5:if(Fo(e,t),Ta(t),r&512&&n!==null&&jd(n,n.return),t.flags&32){var s=t.stateNode;try{Qm(s,"")}catch(re){kr(t,t.return,re)}}if(r&4&&(s=t.stateNode,s!=null)){var u=t.memoizedProps,p=n!==null?n.memoizedProps:u,o=t.type,v=t.updateQueue;if(t.updateQueue=null,v!==null)try{o==="input"&&u.type==="radio"&&u.name!=null&&wk(s,u),Uw(o,p);var T=Uw(o,u);for(p=0;p<v.length;p+=2){var I=v[p],L=v[p+1];I==="style"?Ck(s,L):I==="dangerouslySetInnerHTML"?Sk(s,L):I==="children"?Qm(s,L):AT(s,I,L,T)}switch(o){case"input":Dw(s,u);break;case"textarea":Ek(s,u);break;case"select":var F=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!u.multiple;var j=u.value;j!=null?Xd(s,!!u.multiple,j,!1):F!==!!u.multiple&&(u.defaultValue!=null?Xd(s,!!u.multiple,u.defaultValue,!0):Xd(s,!!u.multiple,u.multiple?[]:"",!1))}s[lg]=u}catch(re){kr(t,t.return,re)}}break;case 6:if(Fo(e,t),Ta(t),r&4){if(t.stateNode===null)throw Error(dt(162));s=t.stateNode,u=t.memoizedProps;try{s.nodeValue=u}catch(re){kr(t,t.return,re)}}break;case 3:if(Fo(e,t),Ta(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{rg(e.containerInfo)}catch(re){kr(t,t.return,re)}break;case 4:Fo(e,t),Ta(t);break;case 13:Fo(e,t),Ta(t),s=t.child,s.flags&8192&&(u=s.memoizedState!==null,s.stateNode.isHidden=u,!u||s.alternate!==null&&s.alternate.memoizedState!==null||(sS=zr())),r&4&&VM(t);break;case 22:if(I=n!==null&&n.memoizedState!==null,t.mode&1?(Ui=(T=Ui)||I,Fo(e,t),Ui=T):Fo(e,t),Ta(t),r&8192){if(T=t.memoizedState!==null,(t.stateNode.isHidden=T)&&!I&&t.mode&1)for(kt=t,I=t.child;I!==null;){for(L=kt=I;kt!==null;){switch(F=kt,j=F.child,F.tag){case 0:case 11:case 14:case 15:Vm(4,F,F.return);break;case 1:jd(F,F.return);var X=F.stateNode;if(typeof X.componentWillUnmount=="function"){r=F,n=F.return;try{e=r,X.props=e.memoizedProps,X.state=e.memoizedState,X.componentWillUnmount()}catch(re){kr(r,n,re)}}break;case 5:jd(F,F.return);break;case 22:if(F.memoizedState!==null){GM(L);continue}}j!==null?(j.return=F,kt=j):GM(L)}I=I.sibling}e:for(I=null,L=t;;){if(L.tag===5){if(I===null){I=L;try{s=L.stateNode,T?(u=s.style,typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"):(o=L.stateNode,v=L.memoizedProps.style,p=v!=null&&v.hasOwnProperty("display")?v.display:null,o.style.display=Ak("display",p))}catch(re){kr(t,t.return,re)}}}else if(L.tag===6){if(I===null)try{L.stateNode.nodeValue=T?"":L.memoizedProps}catch(re){kr(t,t.return,re)}}else if((L.tag!==22&&L.tag!==23||L.memoizedState===null||L===t)&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===t)break e;for(;L.sibling===null;){if(L.return===null||L.return===t)break e;I===L&&(I=null),L=L.return}I===L&&(I=null),L.sibling.return=L.return,L=L.sibling}}break;case 19:Fo(e,t),Ta(t),r&4&&VM(t);break;case 21:break;default:Fo(e,t),Ta(t)}}function Ta(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(QL(n)){var r=n;break e}n=n.return}throw Error(dt(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Qm(s,""),r.flags&=-33);var u=UM(t);gE(t,u,s);break;case 3:case 4:var p=r.stateNode.containerInfo,o=UM(t);mE(t,o,p);break;default:throw Error(dt(161))}}catch(v){kr(t,t.return,v)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function O5(t,e,n){kt=t,nO(t)}function nO(t,e,n){for(var r=(t.mode&1)!==0;kt!==null;){var s=kt,u=s.child;if(s.tag===22&&r){var p=s.memoizedState!==null||s0;if(!p){var o=s.alternate,v=o!==null&&o.memoizedState!==null||Ui;o=s0;var T=Ui;if(s0=p,(Ui=v)&&!T)for(kt=s;kt!==null;)p=kt,v=p.child,p.tag===22&&p.memoizedState!==null?WM(s):v!==null?(v.return=p,kt=v):WM(s);for(;u!==null;)kt=u,nO(u),u=u.sibling;kt=s,s0=o,Ui=T}jM(t)}else s.subtreeFlags&8772&&u!==null?(u.return=s,kt=u):jM(t)}}function jM(t){for(;kt!==null;){var e=kt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ui||mx(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ui)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Uo(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var u=e.updateQueue;u!==null&&SM(e,u,r);break;case 3:var p=e.updateQueue;if(p!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}SM(e,p,n)}break;case 5:var o=e.stateNode;if(n===null&&e.flags&4){n=o;var v=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&n.focus();break;case"img":v.src&&(n.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var T=e.alternate;if(T!==null){var I=T.memoizedState;if(I!==null){var L=I.dehydrated;L!==null&&rg(L)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(dt(163))}Ui||e.flags&512&&pE(e)}catch(F){kr(e,e.return,F)}}if(e===t){kt=null;break}if(n=e.sibling,n!==null){n.return=e.return,kt=n;break}kt=e.return}}function GM(t){for(;kt!==null;){var e=kt;if(e===t){kt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,kt=n;break}kt=e.return}}function WM(t){for(;kt!==null;){var e=kt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{mx(4,e)}catch(v){kr(e,n,v)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(v){kr(e,s,v)}}var u=e.return;try{pE(e)}catch(v){kr(e,u,v)}break;case 5:var p=e.return;try{pE(e)}catch(v){kr(e,p,v)}}}catch(v){kr(e,e.return,v)}if(e===t){kt=null;break}var o=e.sibling;if(o!==null){o.return=e.return,kt=o;break}kt=e.return}}var D5=Math.ceil,xv=El.ReactCurrentDispatcher,rS=El.ReactCurrentOwner,ho=El.ReactCurrentBatchConfig,On=0,_i=null,$r=null,Si=0,Os=0,Gd=Vc(0),ri=0,pg=null,oh=0,gx=0,iS=0,jm=null,ms=null,sS=0,pf=1/0,sl=null,bv=!1,_E=null,Mc=null,o0=!1,yc=null,wv=0,Gm=0,yE=null,B0=-1,U0=0;function Ji(){return On&6?zr():B0!==-1?B0:B0=zr()}function Pc(t){return t.mode&1?On&2&&Si!==0?Si&-Si:y5.transition!==null?(U0===0&&(U0=Bk()),U0):(t=er,t!==0||(t=window.event,t=t===void 0?16:Hk(t.type)),t):1}function Zo(t,e,n,r){if(50<Gm)throw Gm=0,yE=null,Error(dt(185));Rg(t,n,r),(!(On&2)||t!==_i)&&(t===_i&&(!(On&2)&&(gx|=n),ri===4&&pc(t,Si)),bs(t,r),n===1&&On===0&&!(e.mode&1)&&(pf=zr()+500,dx&&jc()))}function bs(t,e){var n=t.callbackNode;yU(t,e);var r=sv(t,t===_i?Si:0);if(r===0)n!==null&&QC(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&QC(n),e===1)t.tag===0?_5($M.bind(null,t)):hL($M.bind(null,t)),f5(function(){!(On&6)&&jc()}),n=null;else{switch(Uk(r)){case 1:n=RT;break;case 4:n=Fk;break;case 16:n=iv;break;case 536870912:n=Nk;break;default:n=iv}n=uO(n,rO.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function rO(t,e){if(B0=-1,U0=0,On&6)throw Error(dt(327));var n=t.callbackNode;if(ef()&&t.callbackNode!==n)return null;var r=sv(t,t===_i?Si:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Ev(t,r);else{e=r;var s=On;On|=2;var u=sO();(_i!==t||Si!==e)&&(sl=null,pf=zr()+500,Xu(t,e));do try{N5();break}catch(o){iO(t,o)}while(1);WT(),xv.current=u,On=s,$r!==null?e=0:(_i=null,Si=0,e=ri)}if(e!==0){if(e===2&&(s=$w(t),s!==0&&(r=s,e=vE(t,s))),e===1)throw n=pg,Xu(t,0),pc(t,r),bs(t,zr()),n;if(e===6)pc(t,r);else{if(s=t.current.alternate,!(r&30)&&!z5(s)&&(e=Ev(t,r),e===2&&(u=$w(t),u!==0&&(r=u,e=vE(t,u))),e===1))throw n=pg,Xu(t,0),pc(t,r),bs(t,zr()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(dt(345));case 2:ju(t,ms,sl);break;case 3:if(pc(t,r),(r&130023424)===r&&(e=sS+500-zr(),10<e)){if(sv(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Ji(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Qw(ju.bind(null,t,ms,sl),e);break}ju(t,ms,sl);break;case 4:if(pc(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var p=31-Ho(r);u=1<<p,p=e[p],p>s&&(s=p),r&=~u}if(r=s,r=zr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*D5(r/1960))-r,10<r){t.timeoutHandle=Qw(ju.bind(null,t,ms,sl),r);break}ju(t,ms,sl);break;case 5:ju(t,ms,sl);break;default:throw Error(dt(329))}}}return bs(t,zr()),t.callbackNode===n?rO.bind(null,t):null}function vE(t,e){var n=jm;return t.current.memoizedState.isDehydrated&&(Xu(t,e).flags|=256),t=Ev(t,e),t!==2&&(e=ms,ms=n,e!==null&&xE(e)),t}function xE(t){ms===null?ms=t:ms.push.apply(ms,t)}function z5(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],u=s.getSnapshot;s=s.value;try{if(!Ko(u(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function pc(t,e){for(e&=~iS,e&=~gx,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ho(e),r=1<<n;t[n]=-1,e&=~r}}function $M(t){if(On&6)throw Error(dt(327));ef();var e=sv(t,0);if(!(e&1))return bs(t,zr()),null;var n=Ev(t,e);if(t.tag!==0&&n===2){var r=$w(t);r!==0&&(e=r,n=vE(t,r))}if(n===1)throw n=pg,Xu(t,0),pc(t,e),bs(t,zr()),n;if(n===6)throw Error(dt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ju(t,ms,sl),bs(t,zr()),null}function oS(t,e){var n=On;On|=1;try{return t(e)}finally{On=n,On===0&&(pf=zr()+500,dx&&jc())}}function ah(t){yc!==null&&yc.tag===0&&!(On&6)&&ef();var e=On;On|=1;var n=ho.transition,r=er;try{if(ho.transition=null,er=1,t)return t()}finally{er=r,ho.transition=n,On=e,!(On&6)&&jc()}}function aS(){Os=Gd.current,fr(Gd)}function Xu(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,d5(n)),$r!==null)for(n=$r.return;n!==null;){var r=n;switch(VT(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&uv();break;case 3:df(),fr(vs),fr(ji),YT();break;case 5:XT(r);break;case 4:df();break;case 13:fr(Tr);break;case 19:fr(Tr);break;case 10:$T(r.type._context);break;case 22:case 23:aS()}n=n.return}if(_i=t,$r=t=Ic(t.current,null),Si=Os=e,ri=0,pg=null,iS=gx=oh=0,ms=jm=null,Hu!==null){for(e=0;e<Hu.length;e++)if(n=Hu[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,u=n.pending;if(u!==null){var p=u.next;u.next=s,r.next=p}n.pending=r}Hu=null}return t}function iO(t,e){do{var n=$r;try{if(WT(),z0.current=vv,yv){for(var r=Ar.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}yv=!1}if(sh=0,mi=ni=Ar=null,Um=!1,hg=0,rS.current=null,n===null||n.return===null){ri=1,pg=e,$r=null;break}e:{var u=t,p=n.return,o=n,v=e;if(e=Si,o.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var T=v,I=o,L=I.tag;if(!(I.mode&1)&&(L===0||L===11||L===15)){var F=I.alternate;F?(I.updateQueue=F.updateQueue,I.memoizedState=F.memoizedState,I.lanes=F.lanes):(I.updateQueue=null,I.memoizedState=null)}var j=kM(p);if(j!==null){j.flags&=-257,LM(j,p,o,u,e),j.mode&1&&RM(u,T,e),e=j,v=T;var X=e.updateQueue;if(X===null){var re=new Set;re.add(v),e.updateQueue=re}else X.add(v);break e}else{if(!(e&1)){RM(u,T,e),lS();break e}v=Error(dt(426))}}else if(yr&&o.mode&1){var de=kM(p);if(de!==null){!(de.flags&65536)&&(de.flags|=256),LM(de,p,o,u,e),jT(ff(v,o));break e}}u=v=ff(v,o),ri!==4&&(ri=2),jm===null?jm=[u]:jm.push(u),u=p;do{switch(u.tag){case 3:u.flags|=65536,e&=-e,u.lanes|=e;var q=VL(u,v,e);TM(u,q);break e;case 1:o=v;var H=u.type,J=u.stateNode;if(!(u.flags&128)&&(typeof H.getDerivedStateFromError=="function"||J!==null&&typeof J.componentDidCatch=="function"&&(Mc===null||!Mc.has(J)))){u.flags|=65536,e&=-e,u.lanes|=e;var Ee=jL(u,o,e);TM(u,Ee);break e}}u=u.return}while(u!==null)}aO(n)}catch(ue){e=ue,$r===n&&n!==null&&($r=n=n.return);continue}break}while(1)}function sO(){var t=xv.current;return xv.current=vv,t===null?vv:t}function lS(){(ri===0||ri===3||ri===2)&&(ri=4),_i===null||!(oh&268435455)&&!(gx&268435455)||pc(_i,Si)}function Ev(t,e){var n=On;On|=2;var r=sO();(_i!==t||Si!==e)&&(sl=null,Xu(t,e));do try{F5();break}catch(s){iO(t,s)}while(1);if(WT(),On=n,xv.current=r,$r!==null)throw Error(dt(261));return _i=null,Si=0,ri}function F5(){for(;$r!==null;)oO($r)}function N5(){for(;$r!==null&&!cU();)oO($r)}function oO(t){var e=cO(t.alternate,t,Os);t.memoizedProps=t.pendingProps,e===null?aO(t):$r=e,rS.current=null}function aO(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=R5(n,e),n!==null){n.flags&=32767,$r=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ri=6,$r=null;return}}else if(n=I5(n,e,Os),n!==null){$r=n;return}if(e=e.sibling,e!==null){$r=e;return}$r=e=t}while(e!==null);ri===0&&(ri=5)}function ju(t,e,n){var r=er,s=ho.transition;try{ho.transition=null,er=1,B5(t,e,n,r)}finally{ho.transition=s,er=r}return null}function B5(t,e,n,r){do ef();while(yc!==null);if(On&6)throw Error(dt(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(dt(177));t.callbackNode=null,t.callbackPriority=0;var u=n.lanes|n.childLanes;if(vU(t,u),t===_i&&($r=_i=null,Si=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||o0||(o0=!0,uO(iv,function(){return ef(),null})),u=(n.flags&15990)!==0,n.subtreeFlags&15990||u){u=ho.transition,ho.transition=null;var p=er;er=1;var o=On;On|=4,rS.current=null,L5(t,n),tO(n,t),s5(Kw),ov=!!Yw,Kw=Yw=null,t.current=n,O5(n),uU(),On=o,er=p,ho.transition=u}else t.current=n;if(o0&&(o0=!1,yc=t,wv=s),u=t.pendingLanes,u===0&&(Mc=null),fU(n.stateNode),bs(t,zr()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(bv)throw bv=!1,t=_E,_E=null,t;return wv&1&&t.tag!==0&&ef(),u=t.pendingLanes,u&1?t===yE?Gm++:(Gm=0,yE=t):Gm=0,jc(),null}function ef(){if(yc!==null){var t=Uk(wv),e=ho.transition,n=er;try{if(ho.transition=null,er=16>t?16:t,yc===null)var r=!1;else{if(t=yc,yc=null,wv=0,On&6)throw Error(dt(331));var s=On;for(On|=4,kt=t.current;kt!==null;){var u=kt,p=u.child;if(kt.flags&16){var o=u.deletions;if(o!==null){for(var v=0;v<o.length;v++){var T=o[v];for(kt=T;kt!==null;){var I=kt;switch(I.tag){case 0:case 11:case 15:Vm(8,I,u)}var L=I.child;if(L!==null)L.return=I,kt=L;else for(;kt!==null;){I=kt;var F=I.sibling,j=I.return;if(JL(I),I===T){kt=null;break}if(F!==null){F.return=j,kt=F;break}kt=j}}}var X=u.alternate;if(X!==null){var re=X.child;if(re!==null){X.child=null;do{var de=re.sibling;re.sibling=null,re=de}while(re!==null)}}kt=u}}if(u.subtreeFlags&2064&&p!==null)p.return=u,kt=p;else e:for(;kt!==null;){if(u=kt,u.flags&2048)switch(u.tag){case 0:case 11:case 15:Vm(9,u,u.return)}var q=u.sibling;if(q!==null){q.return=u.return,kt=q;break e}kt=u.return}}var H=t.current;for(kt=H;kt!==null;){p=kt;var J=p.child;if(p.subtreeFlags&2064&&J!==null)J.return=p,kt=J;else e:for(p=H;kt!==null;){if(o=kt,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:mx(9,o)}}catch(ue){kr(o,o.return,ue)}if(o===p){kt=null;break e}var Ee=o.sibling;if(Ee!==null){Ee.return=o.return,kt=Ee;break e}kt=o.return}}if(On=s,jc(),Oa&&typeof Oa.onPostCommitFiberRoot=="function")try{Oa.onPostCommitFiberRoot(ax,t)}catch{}r=!0}return r}finally{er=n,ho.transition=e}}return!1}function HM(t,e,n){e=ff(n,e),e=VL(t,e,1),t=Cc(t,e,1),e=Ji(),t!==null&&(Rg(t,1,e),bs(t,e))}function kr(t,e,n){if(t.tag===3)HM(t,t,n);else for(;e!==null;){if(e.tag===3){HM(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Mc===null||!Mc.has(r))){t=ff(n,t),t=jL(e,t,1),e=Cc(e,t,1),t=Ji(),e!==null&&(Rg(e,1,t),bs(e,t));break}}e=e.return}}function U5(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Ji(),t.pingedLanes|=t.suspendedLanes&n,_i===t&&(Si&n)===n&&(ri===4||ri===3&&(Si&130023424)===Si&&500>zr()-sS?Xu(t,0):iS|=n),bs(t,e)}function lO(t,e){e===0&&(t.mode&1?(e=Yy,Yy<<=1,!(Yy&130023424)&&(Yy=4194304)):e=1);var n=Ji();t=gl(t,e),t!==null&&(Rg(t,e,n),bs(t,n))}function V5(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),lO(t,n)}function j5(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(dt(314))}r!==null&&r.delete(e),lO(t,n)}var cO;cO=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||vs.current)gs=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return gs=!1,P5(t,e,n);gs=!!(t.flags&131072)}else gs=!1,yr&&e.flags&1048576&&dL(e,fv,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;N0(t,e),t=e.pendingProps;var s=cf(e,ji.current);Qd(e,n),s=JT(null,e,r,t,s,n);var u=QT();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,xs(r)?(u=!0,hv(e)):u=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,ZT(e),s.updater=fx,e.stateNode=s,s._reactInternals=e,oE(e,r,t,n),e=cE(null,e,r,!0,u,n)):(e.tag=0,yr&&u&&UT(e),Zi(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(N0(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=W5(r),t=Uo(r,t),s){case 0:e=lE(null,e,r,t,n);break e;case 1:e=zM(null,e,r,t,n);break e;case 11:e=OM(null,e,r,t,n);break e;case 14:e=DM(null,e,r,Uo(r.type,t),n);break e}throw Error(dt(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Uo(r,s),lE(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Uo(r,s),zM(t,e,r,s,n);case 3:e:{if(HL(e),t===null)throw Error(dt(387));r=e.pendingProps,u=e.memoizedState,s=u.element,gL(t,e),gv(e,r,null,n);var p=e.memoizedState;if(r=p.element,u.isDehydrated)if(u={element:r,isDehydrated:!1,cache:p.cache,pendingSuspenseBoundaries:p.pendingSuspenseBoundaries,transitions:p.transitions},e.updateQueue.baseState=u,e.memoizedState=u,e.flags&256){s=ff(Error(dt(423)),e),e=FM(t,e,r,n,s);break e}else if(r!==s){s=ff(Error(dt(424)),e),e=FM(t,e,r,n,s);break e}else for(Fs=Ac(e.stateNode.containerInfo.firstChild),Us=e,yr=!0,jo=null,n=xL(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(uf(),r===s){e=_l(t,e,n);break e}Zi(t,e,r,n)}e=e.child}return e;case 5:return bL(e),t===null&&rE(e),r=e.type,s=e.pendingProps,u=t!==null?t.memoizedProps:null,p=s.children,Jw(r,s)?p=null:u!==null&&Jw(r,u)&&(e.flags|=32),$L(t,e),Zi(t,e,p,n),e.child;case 6:return t===null&&rE(e),null;case 13:return ZL(t,e,n);case 4:return qT(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=hf(e,null,r,n):Zi(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Uo(r,s),OM(t,e,r,s,n);case 7:return Zi(t,e,e.pendingProps,n),e.child;case 8:return Zi(t,e,e.pendingProps.children,n),e.child;case 12:return Zi(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,u=e.memoizedProps,p=s.value,or(pv,r._currentValue),r._currentValue=p,u!==null)if(Ko(u.value,p)){if(u.children===s.children&&!vs.current){e=_l(t,e,n);break e}}else for(u=e.child,u!==null&&(u.return=e);u!==null;){var o=u.dependencies;if(o!==null){p=u.child;for(var v=o.firstContext;v!==null;){if(v.context===r){if(u.tag===1){v=dl(-1,n&-n),v.tag=2;var T=u.updateQueue;if(T!==null){T=T.shared;var I=T.pending;I===null?v.next=v:(v.next=I.next,I.next=v),T.pending=v}}u.lanes|=n,v=u.alternate,v!==null&&(v.lanes|=n),iE(u.return,n,e),o.lanes|=n;break}v=v.next}}else if(u.tag===10)p=u.type===e.type?null:u.child;else if(u.tag===18){if(p=u.return,p===null)throw Error(dt(341));p.lanes|=n,o=p.alternate,o!==null&&(o.lanes|=n),iE(p,n,e),p=u.sibling}else p=u.child;if(p!==null)p.return=u;else for(p=u;p!==null;){if(p===e){p=null;break}if(u=p.sibling,u!==null){u.return=p.return,p=u;break}p=p.return}u=p}Zi(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Qd(e,n),s=po(s),r=r(s),e.flags|=1,Zi(t,e,r,n),e.child;case 14:return r=e.type,s=Uo(r,e.pendingProps),s=Uo(r.type,s),DM(t,e,r,s,n);case 15:return GL(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Uo(r,s),N0(t,e),e.tag=1,xs(r)?(t=!0,hv(e)):t=!1,Qd(e,n),yL(e,r,s),oE(e,r,s,n),cE(null,e,r,!0,t,n);case 19:return qL(t,e,n);case 22:return WL(t,e,n)}throw Error(dt(156,e.tag))};function uO(t,e){return zk(t,e)}function G5(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function co(t,e,n,r){return new G5(t,e,n,r)}function cS(t){return t=t.prototype,!(!t||!t.isReactComponent)}function W5(t){if(typeof t=="function")return cS(t)?1:0;if(t!=null){if(t=t.$$typeof,t===MT)return 11;if(t===PT)return 14}return 2}function Ic(t,e){var n=t.alternate;return n===null?(n=co(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function V0(t,e,n,r,s,u){var p=2;if(r=t,typeof t=="function")cS(t)&&(p=1);else if(typeof t=="string")p=5;else e:switch(t){case Ld:return Yu(n.children,s,u,e);case CT:p=8,s|=8;break;case Iw:return t=co(12,n,e,s|2),t.elementType=Iw,t.lanes=u,t;case Rw:return t=co(13,n,e,s),t.elementType=Rw,t.lanes=u,t;case kw:return t=co(19,n,e,s),t.elementType=kw,t.lanes=u,t;case vk:return _x(n,s,u,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case _k:p=10;break e;case yk:p=9;break e;case MT:p=11;break e;case PT:p=14;break e;case uc:p=16,r=null;break e}throw Error(dt(130,t==null?t:typeof t,""))}return e=co(p,n,e,s),e.elementType=t,e.type=r,e.lanes=u,e}function Yu(t,e,n,r){return t=co(7,t,r,e),t.lanes=n,t}function _x(t,e,n,r){return t=co(22,t,r,e),t.elementType=vk,t.lanes=n,t.stateNode={isHidden:!1},t}function Rb(t,e,n){return t=co(6,t,null,e),t.lanes=n,t}function kb(t,e,n){return e=co(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function $5(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=db(0),this.expirationTimes=db(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=db(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function uS(t,e,n,r,s,u,p,o,v){return t=new $5(t,e,n,o,v),e===1?(e=1,u===!0&&(e|=8)):e=0,u=co(3,null,null,e),t.current=u,u.stateNode=t,u.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ZT(u),t}function H5(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:kd,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function hO(t){if(!t)return Dc;t=t._reactInternals;e:{if(ph(t)!==t||t.tag!==1)throw Error(dt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(xs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(dt(171))}if(t.tag===1){var n=t.type;if(xs(n))return uL(t,n,e)}return e}function dO(t,e,n,r,s,u,p,o,v){return t=uS(n,r,!0,t,s,u,p,o,v),t.context=hO(null),n=t.current,r=Ji(),s=Pc(n),u=dl(r,s),u.callback=e??null,Cc(n,u,s),t.current.lanes=s,Rg(t,s,r),bs(t,r),t}function yx(t,e,n,r){var s=e.current,u=Ji(),p=Pc(s);return n=hO(n),e.context===null?e.context=n:e.pendingContext=n,e=dl(u,p),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Cc(s,e,p),t!==null&&(Zo(t,s,p,u),D0(t,s,p)),p}function Tv(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ZM(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function hS(t,e){ZM(t,e),(t=t.alternate)&&ZM(t,e)}function Z5(){return null}var fO=typeof reportError=="function"?reportError:function(t){console.error(t)};function dS(t){this._internalRoot=t}vx.prototype.render=dS.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(dt(409));yx(t,e,null,null)};vx.prototype.unmount=dS.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ah(function(){yx(null,t,null,null)}),e[ml]=null}};function vx(t){this._internalRoot=t}vx.prototype.unstable_scheduleHydration=function(t){if(t){var e=Gk();t={blockedOn:null,target:t,priority:e};for(var n=0;n<fc.length&&e!==0&&e<fc[n].priority;n++);fc.splice(n,0,t),n===0&&$k(t)}};function fS(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function xx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function qM(){}function q5(t,e,n,r,s){if(s){if(typeof r=="function"){var u=r;r=function(){var T=Tv(p);u.call(T)}}var p=dO(e,r,t,0,null,!1,!1,"",qM);return t._reactRootContainer=p,t[ml]=p.current,og(t.nodeType===8?t.parentNode:t),ah(),p}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var T=Tv(v);o.call(T)}}var v=uS(t,0,!1,null,null,!1,!1,"",qM);return t._reactRootContainer=v,t[ml]=v.current,og(t.nodeType===8?t.parentNode:t),ah(function(){yx(e,v,n,r)}),v}function bx(t,e,n,r,s){var u=n._reactRootContainer;if(u){var p=u;if(typeof s=="function"){var o=s;s=function(){var v=Tv(p);o.call(v)}}yx(e,p,t,s)}else p=q5(n,e,t,s,r);return Tv(p)}Vk=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Pm(e.pendingLanes);n!==0&&(kT(e,n|1),bs(e,zr()),!(On&6)&&(pf=zr()+500,jc()))}break;case 13:ah(function(){var r=gl(t,1);if(r!==null){var s=Ji();Zo(r,t,1,s)}}),hS(t,1)}};LT=function(t){if(t.tag===13){var e=gl(t,134217728);if(e!==null){var n=Ji();Zo(e,t,134217728,n)}hS(t,134217728)}};jk=function(t){if(t.tag===13){var e=Pc(t),n=gl(t,e);if(n!==null){var r=Ji();Zo(n,t,e,r)}hS(t,e)}};Gk=function(){return er};Wk=function(t,e){var n=er;try{return er=t,e()}finally{er=n}};jw=function(t,e,n){switch(e){case"input":if(Dw(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=hx(r);if(!s)throw Error(dt(90));bk(r),Dw(r,s)}}}break;case"textarea":Ek(t,n);break;case"select":e=n.value,e!=null&&Xd(t,!!n.multiple,e,!1)}};Ik=oS;Rk=ah;var X5={usingClientEntryPoint:!1,Events:[Lg,Fd,hx,Mk,Pk,oS]},_m={findFiberByHostInstance:$u,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Y5={bundleType:_m.bundleType,version:_m.version,rendererPackageName:_m.rendererPackageName,rendererConfig:_m.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:El.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Ok(t),t===null?null:t.stateNode},findFiberByHostInstance:_m.findFiberByHostInstance||Z5,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var a0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!a0.isDisabled&&a0.supportsFiber)try{ax=a0.inject(Y5),Oa=a0}catch{}}Ws.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X5;Ws.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fS(e))throw Error(dt(200));return H5(t,e,null,n)};Ws.createRoot=function(t,e){if(!fS(t))throw Error(dt(299));var n=!1,r="",s=fO;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=uS(t,1,!1,null,null,n,!1,r,s),t[ml]=e.current,og(t.nodeType===8?t.parentNode:t),new dS(e)};Ws.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(dt(188)):(t=Object.keys(t).join(","),Error(dt(268,t)));return t=Ok(e),t=t===null?null:t.stateNode,t};Ws.flushSync=function(t){return ah(t)};Ws.hydrate=function(t,e,n){if(!xx(e))throw Error(dt(200));return bx(null,t,e,!0,n)};Ws.hydrateRoot=function(t,e,n){if(!fS(t))throw Error(dt(405));var r=n!=null&&n.hydratedSources||null,s=!1,u="",p=fO;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onRecoverableError!==void 0&&(p=n.onRecoverableError)),e=dO(e,null,t,1,n??null,s,!1,u,p),t[ml]=e.current,og(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new vx(e)};Ws.render=function(t,e,n){if(!xx(e))throw Error(dt(200));return bx(null,t,e,!1,n)};Ws.unmountComponentAtNode=function(t){if(!xx(t))throw Error(dt(40));return t._reactRootContainer?(ah(function(){bx(null,null,t,!1,function(){t._reactRootContainer=null,t[ml]=null})}),!0):!1};Ws.unstable_batchedUpdates=oS;Ws.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!xx(n))throw Error(dt(200));if(t==null||t._reactInternals===void 0)throw Error(dt(38));return bx(t,e,n,!1,r)};Ws.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}e(),t.exports=Ws})(Z4);var XM=af;Cw.createRoot=XM.createRoot,Cw.hydrateRoot=XM.hydrateRoot;/**
 * @remix-run/router v1.5.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function mg(){return mg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},mg.apply(this,arguments)}var vc;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(vc||(vc={}));const YM="popstate";function K5(t){t===void 0&&(t={});function e(r,s){let{pathname:u,search:p,hash:o}=r.location;return bE("",{pathname:u,search:p,hash:o},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:pO(s)}return Q5(e,n,null,t)}function ii(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function pS(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function J5(){return Math.random().toString(36).substr(2,8)}function KM(t,e){return{usr:t.state,key:t.key,idx:e}}function bE(t,e,n,r){return n===void 0&&(n=null),mg({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?zf(e):e,{state:n,key:e&&e.key||r||J5()})}function pO(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function zf(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function Q5(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:u=!1}=r,p=s.history,o=vc.Pop,v=null,T=I();T==null&&(T=0,p.replaceState(mg({},p.state,{idx:T}),""));function I(){return(p.state||{idx:null}).idx}function L(){o=vc.Pop;let de=I(),q=de==null?null:de-T;T=de,v&&v({action:o,location:re.location,delta:q})}function F(de,q){o=vc.Push;let H=bE(re.location,de,q);n&&n(H,de),T=I()+1;let J=KM(H,T),Ee=re.createHref(H);try{p.pushState(J,"",Ee)}catch{s.location.assign(Ee)}u&&v&&v({action:o,location:re.location,delta:1})}function j(de,q){o=vc.Replace;let H=bE(re.location,de,q);n&&n(H,de),T=I();let J=KM(H,T),Ee=re.createHref(H);p.replaceState(J,"",Ee),u&&v&&v({action:o,location:re.location,delta:0})}function X(de){let q=s.location.origin!=="null"?s.location.origin:s.location.href,H=typeof de=="string"?de:pO(de);return ii(q,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,q)}let re={get action(){return o},get location(){return t(s,p)},listen(de){if(v)throw new Error("A history only accepts one active listener");return s.addEventListener(YM,L),v=de,()=>{s.removeEventListener(YM,L),v=null}},createHref(de){return e(s,de)},createURL:X,encodeLocation(de){let q=X(de);return{pathname:q.pathname,search:q.search,hash:q.hash}},push:F,replace:j,go(de){return p.go(de)}};return re}var JM;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(JM||(JM={}));function e6(t,e,n){n===void 0&&(n="/");let r=typeof e=="string"?zf(e):e,s=_O(r.pathname||"/",n);if(s==null)return null;let u=mO(t);t6(u);let p=null;for(let o=0;p==null&&o<u.length;++o)p=u6(u[o],f6(s));return p}function mO(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(u,p,o)=>{let v={relativePath:o===void 0?u.path||"":o,caseSensitive:u.caseSensitive===!0,childrenIndex:p,route:u};v.relativePath.startsWith("/")&&(ii(v.relativePath.startsWith(r),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(r.length));let T=Ku([r,v.relativePath]),I=n.concat(v);u.children&&u.children.length>0&&(ii(u.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+T+'".')),mO(u.children,e,I,T)),!(u.path==null&&!u.index)&&e.push({path:T,score:l6(T,u.index),routesMeta:I})};return t.forEach((u,p)=>{var o;if(u.path===""||!((o=u.path)!=null&&o.includes("?")))s(u,p);else for(let v of gO(u.path))s(u,p,v)}),e}function gO(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),u=n.replace(/\?$/,"");if(r.length===0)return s?[u,""]:[u];let p=gO(r.join("/")),o=[];return o.push(...p.map(v=>v===""?u:[u,v].join("/"))),s&&o.push(...p),o.map(v=>t.startsWith("/")&&v===""?"/":v)}function t6(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:c6(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const n6=/^:\w+$/,r6=3,i6=2,s6=1,o6=10,a6=-2,QM=t=>t==="*";function l6(t,e){let n=t.split("/"),r=n.length;return n.some(QM)&&(r+=a6),e&&(r+=i6),n.filter(s=>!QM(s)).reduce((s,u)=>s+(n6.test(u)?r6:u===""?s6:o6),r)}function c6(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function u6(t,e){let{routesMeta:n}=t,r={},s="/",u=[];for(let p=0;p<n.length;++p){let o=n[p],v=p===n.length-1,T=s==="/"?e:e.slice(s.length)||"/",I=h6({path:o.relativePath,caseSensitive:o.caseSensitive,end:v},T);if(!I)return null;Object.assign(r,I.params);let L=o.route;u.push({params:r,pathname:Ku([s,I.pathname]),pathnameBase:v6(Ku([s,I.pathnameBase])),route:L}),I.pathnameBase!=="/"&&(s=Ku([s,I.pathnameBase]))}return u}function h6(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=d6(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let u=s[0],p=u.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:r.reduce((T,I,L)=>{if(I==="*"){let F=o[L]||"";p=u.slice(0,u.length-F.length).replace(/(.)\/+$/,"$1")}return T[I]=p6(o[L]||"",I),T},{}),pathname:u,pathnameBase:p,pattern:t}}function d6(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),pS(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(p,o)=>(r.push(o),"/([^\\/]+)"));return t.endsWith("*")?(r.push("*"),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function f6(t){try{return decodeURI(t)}catch(e){return pS(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function p6(t,e){try{return decodeURIComponent(t)}catch(n){return pS(!1,'The value for the URL param "'+e+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+n+").")),t}}function _O(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function m6(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?zf(t):t;return{pathname:n?n.startsWith("/")?n:g6(n,e):e,search:x6(r),hash:b6(s)}}function g6(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Lb(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function _6(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function y6(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=zf(t):(s=mg({},t),ii(!s.pathname||!s.pathname.includes("?"),Lb("?","pathname","search",s)),ii(!s.pathname||!s.pathname.includes("#"),Lb("#","pathname","hash",s)),ii(!s.search||!s.search.includes("#"),Lb("#","search","hash",s)));let u=t===""||s.pathname==="",p=u?"/":s.pathname,o;if(r||p==null)o=n;else{let L=e.length-1;if(p.startsWith("..")){let F=p.split("/");for(;F[0]==="..";)F.shift(),L-=1;s.pathname=F.join("/")}o=L>=0?e[L]:"/"}let v=m6(s,o),T=p&&p!=="/"&&p.endsWith("/"),I=(u||p===".")&&n.endsWith("/");return!v.pathname.endsWith("/")&&(T||I)&&(v.pathname+="/"),v}const Ku=t=>t.join("/").replace(/\/\/+/g,"/"),v6=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),x6=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,b6=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function w6(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}/**
 * React Router v6.10.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function E6(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}const T6=typeof Object.is=="function"?Object.is:E6,{useState:S6,useEffect:A6,useLayoutEffect:C6,useDebugValue:M6}=Aw;function P6(t,e,n){const r=e(),[{inst:s},u]=S6({inst:{value:r,getSnapshot:e}});return C6(()=>{s.value=r,s.getSnapshot=e,Ob(s)&&u({inst:s})},[t,r,e]),A6(()=>(Ob(s)&&u({inst:s}),t(()=>{Ob(s)&&u({inst:s})})),[t]),M6(r),r}function Ob(t){const e=t.getSnapshot,n=t.value;try{const r=e();return!T6(n,r)}catch{return!0}}function I6(t,e,n){return e()}const R6=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",k6=!R6,L6=k6?I6:P6;"useSyncExternalStore"in Aw&&(t=>t.useSyncExternalStore)(Aw);const yO=We.createContext(null),mS=We.createContext(null),gS=We.createContext(null),wx=We.createContext(null),Dg=We.createContext({outlet:null,matches:[]}),vO=We.createContext(null);function wE(){return wE=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},wE.apply(this,arguments)}function zg(){return We.useContext(wx)!=null}function Fg(){return zg()||ii(!1),We.useContext(wx).location}function xO(){zg()||ii(!1);let{basename:t,navigator:e}=We.useContext(gS),{matches:n}=We.useContext(Dg),{pathname:r}=Fg(),s=JSON.stringify(_6(n).map(o=>o.pathnameBase)),u=We.useRef(!1);return We.useEffect(()=>{u.current=!0}),We.useCallback(function(o,v){if(v===void 0&&(v={}),!u.current)return;if(typeof o=="number"){e.go(o);return}let T=y6(o,JSON.parse(s),r,v.relative==="path");t!=="/"&&(T.pathname=T.pathname==="/"?t:Ku([t,T.pathname])),(v.replace?e.replace:e.push)(T,v.state,v)},[t,e,s,r])}function O6(t,e){zg()||ii(!1);let{navigator:n}=We.useContext(gS),r=We.useContext(mS),{matches:s}=We.useContext(Dg),u=s[s.length-1],p=u?u.params:{};u&&u.pathname;let o=u?u.pathnameBase:"/";u&&u.route;let v=Fg(),T;if(e){var I;let re=typeof e=="string"?zf(e):e;o==="/"||(I=re.pathname)!=null&&I.startsWith(o)||ii(!1),T=re}else T=v;let L=T.pathname||"/",F=o==="/"?L:L.slice(o.length)||"/",j=e6(t,{pathname:F}),X=N6(j&&j.map(re=>Object.assign({},re,{params:Object.assign({},p,re.params),pathname:Ku([o,n.encodeLocation?n.encodeLocation(re.pathname).pathname:re.pathname]),pathnameBase:re.pathnameBase==="/"?o:Ku([o,n.encodeLocation?n.encodeLocation(re.pathnameBase).pathname:re.pathnameBase])})),s,r||void 0);return e&&X?We.createElement(wx.Provider,{value:{location:wE({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:vc.Pop}},X):X}function D6(){let t=j6(),e=w6(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},u=null;return We.createElement(We.Fragment,null,We.createElement("h2",null,"Unexpected Application Error!"),We.createElement("h3",{style:{fontStyle:"italic"}},e),n?We.createElement("pre",{style:s},n):null,u)}class z6 extends We.Component{constructor(e){super(e),this.state={location:e.location,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location?{error:e.error,location:e.location}:{error:e.error||n.error,location:n.location}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error?We.createElement(Dg.Provider,{value:this.props.routeContext},We.createElement(vO.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function F6(t){let{routeContext:e,match:n,children:r}=t,s=We.useContext(yO);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),We.createElement(Dg.Provider,{value:e},r)}function N6(t,e,n){if(e===void 0&&(e=[]),t==null)if(n!=null&&n.errors)t=n.matches;else return null;let r=t,s=n==null?void 0:n.errors;if(s!=null){let u=r.findIndex(p=>p.route.id&&(s==null?void 0:s[p.route.id]));u>=0||ii(!1),r=r.slice(0,Math.min(r.length,u+1))}return r.reduceRight((u,p,o)=>{let v=p.route.id?s==null?void 0:s[p.route.id]:null,T=null;n&&(p.route.ErrorBoundary?T=We.createElement(p.route.ErrorBoundary,null):p.route.errorElement?T=p.route.errorElement:T=We.createElement(D6,null));let I=e.concat(r.slice(0,o+1)),L=()=>{let F=u;return v?F=T:p.route.Component?F=We.createElement(p.route.Component,null):p.route.element&&(F=p.route.element),We.createElement(F6,{match:p,routeContext:{outlet:u,matches:I},children:F})};return n&&(p.route.ErrorBoundary||p.route.errorElement||o===0)?We.createElement(z6,{location:n.location,component:T,error:v,children:L(),routeContext:{outlet:null,matches:I}}):L()},null)}var eP;(function(t){t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator"})(eP||(eP={}));var Sv;(function(t){t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator"})(Sv||(Sv={}));function B6(t){let e=We.useContext(mS);return e||ii(!1),e}function U6(t){let e=We.useContext(Dg);return e||ii(!1),e}function V6(t){let e=U6(),n=e.matches[e.matches.length-1];return n.route.id||ii(!1),n.route.id}function j6(){var t;let e=We.useContext(vO),n=B6(Sv.UseRouteError),r=V6(Sv.UseRouteError);return e||((t=n.errors)==null?void 0:t[r])}function G6(t){let{to:e,replace:n,state:r,relative:s}=t;zg()||ii(!1);let u=We.useContext(mS),p=xO();return We.useEffect(()=>{u&&u.navigation.state!=="idle"||p(e,{replace:n,state:r,relative:s})}),null}function EE(t){ii(!1)}function W6(t){let{basename:e="/",children:n=null,location:r,navigationType:s=vc.Pop,navigator:u,static:p=!1}=t;zg()&&ii(!1);let o=e.replace(/^\/*/,"/"),v=We.useMemo(()=>({basename:o,navigator:u,static:p}),[o,u,p]);typeof r=="string"&&(r=zf(r));let{pathname:T="/",search:I="",hash:L="",state:F=null,key:j="default"}=r,X=We.useMemo(()=>{let re=_O(T,o);return re==null?null:{location:{pathname:re,search:I,hash:L,state:F,key:j},navigationType:s}},[o,T,I,L,F,j,s]);return X==null?null:We.createElement(gS.Provider,{value:v},We.createElement(wx.Provider,{children:n,value:X}))}function $6(t){let{children:e,location:n}=t,r=We.useContext(yO),s=r&&!e?r.router.routes:TE(e);return O6(s,n)}var tP;(function(t){t[t.pending=0]="pending",t[t.success=1]="success",t[t.error=2]="error"})(tP||(tP={}));new Promise(()=>{});function TE(t,e){e===void 0&&(e=[]);let n=[];return We.Children.forEach(t,(r,s)=>{if(!We.isValidElement(r))return;let u=[...e,s];if(r.type===We.Fragment){n.push.apply(n,TE(r.props.children,u));return}r.type!==EE&&ii(!1),!r.props.index||!r.props.children||ii(!1);let p={id:r.props.id||u.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(p.children=TE(r.props.children,u)),n.push(p)}),n}/**
 * React Router DOM v6.10.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function H6(t){let{basename:e,children:n,window:r}=t,s=We.useRef();s.current==null&&(s.current=K5({window:r,v5Compat:!0}));let u=s.current,[p,o]=We.useState({action:u.action,location:u.location});return We.useLayoutEffect(()=>u.listen(o),[u]),We.createElement(W6,{basename:e,children:n,location:p.location,navigationType:p.action,navigator:u})}var nP;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmitImpl="useSubmitImpl",t.UseFetcher="useFetcher"})(nP||(nP={}));var rP;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(rP||(rP={}));function An(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];throw new Error(typeof t=="number"?"[MobX] minified error nr: "+t+(n.length?" "+n.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+t)}var Z6={};function _S(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:Z6}var bO=Object.assign,Av=Object.getOwnPropertyDescriptor,za=Object.defineProperty,Ng=Object.prototype,SE=[];Object.freeze(SE);var wO={};Object.freeze(wO);var q6=typeof Proxy<"u",X6=Object.toString();function EO(){q6||An("Proxy not available")}function TO(t){var e=!1;return function(){if(!e)return e=!0,t.apply(this,arguments)}}var Wd=function(){};function Jo(t){return typeof t=="function"}function lh(t){var e=typeof t;switch(e){case"string":case"symbol":case"number":return!0}return!1}function Ex(t){return t!==null&&typeof t=="object"}function yl(t){if(!Ex(t))return!1;var e=Object.getPrototypeOf(t);if(e==null)return!0;var n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n.toString()===X6}function SO(t){var e=t==null?void 0:t.constructor;return e?e.name==="GeneratorFunction"||e.displayName==="GeneratorFunction":!1}function Bg(t,e,n){za(t,e,{enumerable:!1,writable:!0,configurable:!0,value:n})}function AO(t,e,n){za(t,e,{enumerable:!1,writable:!1,configurable:!0,value:n})}function Gc(t,e){var n="isMobX"+t;return e.prototype[n]=!0,function(r){return Ex(r)&&r[n]===!0}}function Ff(t){return t instanceof Map}function Ug(t){return t instanceof Set}var CO=typeof Object.getOwnPropertySymbols<"u";function Y6(t){var e=Object.keys(t);if(!CO)return e;var n=Object.getOwnPropertySymbols(t);return n.length?[].concat(e,n.filter(function(r){return Ng.propertyIsEnumerable.call(t,r)})):e}var mf=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:CO?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames;function MO(t){return t===null?null:typeof t=="object"?""+t:t}function fl(t,e){return Ng.hasOwnProperty.call(t,e)}var K6=Object.getOwnPropertyDescriptors||function(e){var n={};return mf(e).forEach(function(r){n[r]=Av(e,r)}),n};function iP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,eV(r.key),r)}}function yS(t,e,n){return e&&iP(t.prototype,e),n&&iP(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function gf(){return gf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},gf.apply(this,arguments)}function PO(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,AE(t,e)}function AE(t,e){return AE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},AE(t,e)}function Db(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function J6(t,e){if(t){if(typeof t=="string")return sP(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sP(t,e)}}function sP(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function $d(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=J6(t))||e&&t&&typeof t.length=="number"){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q6(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function eV(t){var e=Q6(t,"string");return typeof e=="symbol"?e:String(e)}var Ra=Symbol("mobx-stored-annotations");function Fa(t){function e(n,r){Vg(n,r,t)}return Object.assign(e,t)}function Vg(t,e,n){fl(t,Ra)||Bg(t,Ra,gf({},t[Ra])),cV(n)||(t[Ra][e]=n)}function tV(t){return fl(t,Ra)||Bg(t,Ra,gf({},t[Ra])),t[Ra]}var tn=Symbol("mobx administration"),jg=function(){function t(n){n===void 0&&(n="Atom"),this.name_=void 0,this.isPendingUnobservation_=!1,this.isBeingObserved_=!1,this.observers_=new Set,this.diffValue_=0,this.lastAccessedBy_=0,this.lowestObserverState_=Un.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=n}var e=t.prototype;return e.onBO=function(){this.onBOL&&this.onBOL.forEach(function(r){return r()})},e.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(r){return r()})},e.reportObserved=function(){return YO(this)},e.reportChanged=function(){_s(),KO(this),_t.stateVersion=_t.stateVersion<Number.MAX_SAFE_INTEGER?_t.stateVersion+1:Number.MIN_SAFE_INTEGER,ys()},e.toString=function(){return this.name_},t}(),vS=Gc("Atom",jg);function Wm(t,e,n){e===void 0&&(e=Wd),n===void 0&&(n=Wd);var r=new jg(t);return e!==Wd&&aj(r,e),n!==Wd&&sD(r,n),r}function nV(t,e){return t===e}function rV(t,e){return AS(t,e)}function iV(t,e){return AS(t,e,1)}function sV(t,e){return Object.is?Object.is(t,e):t===e?t!==0||1/t===1/e:t!==t&&e!==e}var Cv={identity:nV,structural:rV,default:sV,shallow:iV};function _f(t,e,n){return ES(t)?t:Array.isArray(t)?gi.array(t,{name:n}):yl(t)?gi.object(t,void 0,{name:n}):Ff(t)?gi.map(t,{name:n}):Ug(t)?gi.set(t,{name:n}):typeof t=="function"&&!bS(t)&&!kv(t)?SO(t)?vg(t):yg(n,t):t}function oV(t,e,n){if(t==null||vf(t)||Xg(t)||$c(t)||mh(t))return t;if(Array.isArray(t))return gi.array(t,{name:n,deep:!1});if(yl(t))return gi.object(t,void 0,{name:n,deep:!1});if(Ff(t))return gi.map(t,{name:n,deep:!1});if(Ug(t))return gi.set(t,{name:n,deep:!1})}function Tx(t){return t}function aV(t,e){return AS(t,e)?e:t}var lV="override";function cV(t){return t.annotationType_===lV}function Gg(t,e){return{annotationType_:t,options_:e,make_:uV,extend_:hV}}function uV(t,e,n,r){var s;if((s=this.options_)!=null&&s.bound)return this.extend_(t,e,n,!1)===null?0:1;if(r===t.target_)return this.extend_(t,e,n,!1)===null?0:2;if(bS(n.value))return 1;var u=IO(t,this,e,n,!1);return za(r,e,u),2}function hV(t,e,n,r){var s=IO(t,this,e,n);return t.defineProperty_(e,s,r)}function dV(t,e,n,r){e.annotationType_,r.value}function IO(t,e,n,r,s){var u,p,o,v,T,I,L;s===void 0&&(s=_t.safeDescriptors),dV(t,e,n,r);var F=r.value;if((u=e.options_)!=null&&u.bound){var j;F=F.bind((j=t.proxy_)!=null?j:t.target_)}return{value:yf((p=(o=e.options_)==null?void 0:o.name)!=null?p:n.toString(),F,(v=(T=e.options_)==null?void 0:T.autoAction)!=null?v:!1,(I=e.options_)!=null&&I.bound?(L=t.proxy_)!=null?L:t.target_:void 0),configurable:s?t.isPlainObject_:!0,enumerable:!1,writable:!s}}function RO(t,e){return{annotationType_:t,options_:e,make_:fV,extend_:pV}}function fV(t,e,n,r){var s;if(r===t.target_)return this.extend_(t,e,n,!1)===null?0:2;if((s=this.options_)!=null&&s.bound&&(!fl(t.target_,e)||!kv(t.target_[e]))&&this.extend_(t,e,n,!1)===null)return 0;if(kv(n.value))return 1;var u=kO(t,this,e,n,!1,!1);return za(r,e,u),2}function pV(t,e,n,r){var s,u=kO(t,this,e,n,(s=this.options_)==null?void 0:s.bound);return t.defineProperty_(e,u,r)}function mV(t,e,n,r){e.annotationType_,r.value}function kO(t,e,n,r,s,u){u===void 0&&(u=_t.safeDescriptors),mV(t,e,n,r);var p=r.value;if(kv(p)||(p=vg(p)),s){var o;p=p.bind((o=t.proxy_)!=null?o:t.target_),p.isMobXFlow=!0}return{value:p,configurable:u?t.isPlainObject_:!0,enumerable:!1,writable:!u}}function xS(t,e){return{annotationType_:t,options_:e,make_:gV,extend_:_V}}function gV(t,e,n){return this.extend_(t,e,n,!1)===null?0:1}function _V(t,e,n,r){return yV(t,this,e,n),t.defineComputedProperty_(e,gf({},this.options_,{get:n.get,set:n.set}),r)}function yV(t,e,n,r){e.annotationType_,r.get}function Sx(t,e){return{annotationType_:t,options_:e,make_:vV,extend_:xV}}function vV(t,e,n){return this.extend_(t,e,n,!1)===null?0:1}function xV(t,e,n,r){var s,u;return bV(t,this),t.defineObservableProperty_(e,n.value,(s=(u=this.options_)==null?void 0:u.enhancer)!=null?s:_f,r)}function bV(t,e,n,r){e.annotationType_}var wV="true",EV=LO();function LO(t){return{annotationType_:wV,options_:t,make_:TV,extend_:SV}}function TV(t,e,n,r){var s,u;if(n.get)return Ax.make_(t,e,n,r);if(n.set){var p=yf(e.toString(),n.set);return r===t.target_?t.defineProperty_(e,{configurable:_t.safeDescriptors?t.isPlainObject_:!0,set:p})===null?0:2:(za(r,e,{configurable:!0,set:p}),2)}if(r!==t.target_&&typeof n.value=="function"){var o;if(SO(n.value)){var v,T=(v=this.options_)!=null&&v.autoBind?vg.bound:vg;return T.make_(t,e,n,r)}var I=(o=this.options_)!=null&&o.autoBind?yg.bound:yg;return I.make_(t,e,n,r)}var L=((s=this.options_)==null?void 0:s.deep)===!1?gi.ref:gi;if(typeof n.value=="function"&&(u=this.options_)!=null&&u.autoBind){var F;n.value=n.value.bind((F=t.proxy_)!=null?F:t.target_)}return L.make_(t,e,n,r)}function SV(t,e,n,r){var s,u;if(n.get)return Ax.extend_(t,e,n,r);if(n.set)return t.defineProperty_(e,{configurable:_t.safeDescriptors?t.isPlainObject_:!0,set:yf(e.toString(),n.set)},r);if(typeof n.value=="function"&&(s=this.options_)!=null&&s.autoBind){var p;n.value=n.value.bind((p=t.proxy_)!=null?p:t.target_)}var o=((u=this.options_)==null?void 0:u.deep)===!1?gi.ref:gi;return o.extend_(t,e,n,r)}var AV="observable",CV="observable.ref",MV="observable.shallow",PV="observable.struct",OO={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(OO);function l0(t){return t||OO}var DO=Sx(AV),IV=Sx(CV,{enhancer:Tx}),RV=Sx(MV,{enhancer:oV}),kV=Sx(PV,{enhancer:aV}),zO=Fa(DO);function c0(t){return t.deep===!0?_f:t.deep===!1?Tx:OV(t.defaultDecorator)}function LV(t){var e;return t?(e=t.defaultDecorator)!=null?e:LO(t):void 0}function OV(t){var e,n;return t&&(e=(n=t.options_)==null?void 0:n.enhancer)!=null?e:_f}function FO(t,e,n){if(lh(e)){Vg(t,e,DO);return}return ES(t)?t:yl(t)?gi.object(t,e,n):Array.isArray(t)?gi.array(t,e):Ff(t)?gi.map(t,e):Ug(t)?gi.set(t,e):typeof t=="object"&&t!==null?t:gi.box(t,e)}bO(FO,zO);var DV={box:function(e,n){var r=l0(n);return new Ju(e,c0(r),r.name,!0,r.equals)},array:function(e,n){var r=l0(n);return(_t.useProxies===!1||r.proxy===!1?Oj:Sj)(e,c0(r),r.name)},map:function(e,n){var r=l0(n);return new pD(e,c0(r),r.name)},set:function(e,n){var r=l0(n);return new _D(e,c0(r),r.name)},object:function(e,n,r){return aD(_t.useProxies===!1||(r==null?void 0:r.proxy)===!1?Yg({},r):bj({},r),e,n)},ref:Fa(IV),shallow:Fa(RV),deep:zO,struct:Fa(kV)},gi=bO(FO,DV),NO="computed",zV="computed.struct",BO=xS(NO),FV=xS(zV,{equals:Cv.structural}),Ax=function(e,n){if(lh(n))return Vg(e,n,BO);if(yl(e))return Fa(xS(NO,e));var r=yl(n)?n:{};return r.get=e,r.name||(r.name=e.name||""),new gg(r)};Object.assign(Ax,BO);Ax.struct=Fa(FV);var oP,aP,Mv=0,NV=1,BV=(oP=(aP=Av(function(){},"name"))==null?void 0:aP.configurable)!=null?oP:!1,lP={value:"action",configurable:!0,writable:!1,enumerable:!1};function yf(t,e,n,r){n===void 0&&(n=!1);function s(){return UO(t,n,e,r||this,arguments)}return s.isMobxAction=!0,BV&&(lP.value=t,za(s,"name",lP)),s}function UO(t,e,n,r,s){var u=UV(t,e);try{return n.apply(r,s)}catch(p){throw u.error_=p,p}finally{VV(u)}}function UV(t,e,n,r){var s=!1,u=0,p=_t.trackingDerivation,o=!e||!p;_s();var v=_t.allowStateChanges;o&&(Nf(),v=Wg(!0));var T=Cx(!0),I={runAsAction_:o,prevDerivation_:p,prevAllowStateChanges_:v,prevAllowStateReads_:T,notifySpy_:s,startTime_:u,actionId_:NV++,parentActionId_:Mv};return Mv=I.actionId_,I}function VV(t){Mv!==t.actionId_&&An(30),Mv=t.parentActionId_,t.error_!==void 0&&(_t.suppressReactionErrors=!0),$g(t.prevAllowStateChanges_),tf(t.prevAllowStateReads_),ys(),t.runAsAction_&&Rc(t.prevDerivation_),_t.suppressReactionErrors=!1}function VO(t,e){var n=Wg(t);try{return e()}finally{$g(n)}}function Wg(t){var e=_t.allowStateChanges;return _t.allowStateChanges=t,e}function $g(t){_t.allowStateChanges=t}var jO;jO=Symbol.toPrimitive;var Ju=function(t){PO(e,t);function e(r,s,u,p,o){var v;return u===void 0&&(u="ObservableValue"),o===void 0&&(o=Cv.default),v=t.call(this,u)||this,v.enhancer=void 0,v.name_=void 0,v.equals=void 0,v.hasUnreportedChange_=!1,v.interceptors_=void 0,v.changeListeners_=void 0,v.value_=void 0,v.dehancer=void 0,v.enhancer=s,v.name_=u,v.equals=o,v.value_=s(r,void 0,u),v}var n=e.prototype;return n.dehanceValue=function(s){return this.dehancer!==void 0?this.dehancer(s):s},n.set=function(s){this.value_,s=this.prepareNewValue_(s),s!==_t.UNCHANGED&&this.setNewValue_(s)},n.prepareNewValue_=function(s){if(ao(this)){var u=lo(this,{object:this,type:Na,newValue:s});if(!u)return _t.UNCHANGED;s=u.newValue}return s=this.enhancer(s,this.value_,this.name_),this.equals(this.value_,s)?_t.UNCHANGED:s},n.setNewValue_=function(s){var u=this.value_;this.value_=s,this.reportChanged(),qo(this)&&Xo(this,{type:Na,object:this,newValue:s,oldValue:u})},n.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},n.intercept_=function(s){return Zg(this,s)},n.observe_=function(s,u){return u&&s({observableKind:"value",debugObjectName:this.name_,object:this,type:Na,newValue:this.value_,oldValue:void 0}),qg(this,s)},n.raw=function(){return this.value_},n.toJSON=function(){return this.get()},n.toString=function(){return this.name_+"["+this.value_+"]"},n.valueOf=function(){return MO(this.get())},n[jO]=function(){return this.valueOf()},e}(jg),jV=Gc("ObservableValue",Ju),GO;GO=Symbol.toPrimitive;var gg=function(){function t(n){this.dependenciesState_=Un.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.isBeingObserved_=!1,this.isPendingUnobservation_=!1,this.observers_=new Set,this.diffValue_=0,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=Un.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new Pv(null),this.name_=void 0,this.triggeredBy_=void 0,this.isComputing_=!1,this.isRunningSetter_=!1,this.derivation=void 0,this.setter_=void 0,this.isTracing_=Qu.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,n.get||An(31),this.derivation=n.get,this.name_=n.name||"ComputedValue",n.set&&(this.setter_=yf("ComputedValue-setter",n.set)),this.equals_=n.equals||(n.compareStructural||n.struct?Cv.structural:Cv.default),this.scope_=n.context,this.requiresReaction_=n.requiresReaction,this.keepAlive_=!!n.keepAlive}var e=t.prototype;return e.onBecomeStale_=function(){qV(this)},e.onBO=function(){this.onBOL&&this.onBOL.forEach(function(r){return r()})},e.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(r){return r()})},e.get=function(){if(this.isComputing_&&An(32,this.name_,this.derivation),_t.inBatch===0&&this.observers_.size===0&&!this.keepAlive_)CE(this)&&(this.warnAboutUntrackedRead_(),_s(),this.value_=this.computeValue_(!1),ys());else if(YO(this),CE(this)){var r=_t.trackingContext;this.keepAlive_&&!r&&(_t.trackingContext=this),this.trackAndCompute()&&ZV(this),_t.trackingContext=r}var s=this.value_;if(j0(s))throw s.cause;return s},e.set=function(r){if(this.setter_){this.isRunningSetter_&&An(33,this.name_),this.isRunningSetter_=!0;try{this.setter_.call(this.scope_,r)}finally{this.isRunningSetter_=!1}}else An(34,this.name_)},e.trackAndCompute=function(){var r=this.value_,s=this.dependenciesState_===Un.NOT_TRACKING_,u=this.computeValue_(!0),p=s||j0(r)||j0(u)||!this.equals_(r,u);return p&&(this.value_=u),p},e.computeValue_=function(r){this.isComputing_=!0;var s=Wg(!1),u;if(r)u=WO(this,this.derivation,this.scope_);else if(_t.disableErrorBoundaries===!0)u=this.derivation.call(this.scope_);else try{u=this.derivation.call(this.scope_)}catch(p){u=new Pv(p)}return $g(s),this.isComputing_=!1,u},e.suspend_=function(){this.keepAlive_||(ME(this),this.value_=void 0)},e.observe_=function(r,s){var u=this,p=!0,o=void 0;return wS(function(){var v=u.get();if(!p||s){var T=Nf();r({observableKind:"computed",debugObjectName:u.name_,type:Na,object:u,newValue:v,oldValue:o}),Rc(T)}p=!1,o=v})},e.warnAboutUntrackedRead_=function(){},e.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},e.valueOf=function(){return MO(this.get())},e[GO]=function(){return this.valueOf()},t}(),Hg=Gc("ComputedValue",gg),Un;(function(t){t[t.NOT_TRACKING_=-1]="NOT_TRACKING_",t[t.UP_TO_DATE_=0]="UP_TO_DATE_",t[t.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",t[t.STALE_=2]="STALE_"})(Un||(Un={}));var Qu;(function(t){t[t.NONE=0]="NONE",t[t.LOG=1]="LOG",t[t.BREAK=2]="BREAK"})(Qu||(Qu={}));var Pv=function(e){this.cause=void 0,this.cause=e};function j0(t){return t instanceof Pv}function CE(t){switch(t.dependenciesState_){case Un.UP_TO_DATE_:return!1;case Un.NOT_TRACKING_:case Un.STALE_:return!0;case Un.POSSIBLY_STALE_:{for(var e=Cx(!0),n=Nf(),r=t.observing_,s=r.length,u=0;u<s;u++){var p=r[u];if(Hg(p)){if(_t.disableErrorBoundaries)p.get();else try{p.get()}catch{return Rc(n),tf(e),!0}if(t.dependenciesState_===Un.STALE_)return Rc(n),tf(e),!0}}return HO(t),Rc(n),tf(e),!1}}}function WO(t,e,n){var r=Cx(!0);HO(t),t.newObserving_=new Array(t.observing_.length+100),t.unboundDepsCount_=0,t.runId_=++_t.runId;var s=_t.trackingDerivation;_t.trackingDerivation=t,_t.inBatch++;var u;if(_t.disableErrorBoundaries===!0)u=e.call(n);else try{u=e.call(n)}catch(p){u=new Pv(p)}return _t.inBatch--,_t.trackingDerivation=s,GV(t),tf(r),u}function GV(t){for(var e=t.observing_,n=t.observing_=t.newObserving_,r=Un.UP_TO_DATE_,s=0,u=t.unboundDepsCount_,p=0;p<u;p++){var o=n[p];o.diffValue_===0&&(o.diffValue_=1,s!==p&&(n[s]=o),s++),o.dependenciesState_>r&&(r=o.dependenciesState_)}for(n.length=s,t.newObserving_=null,u=e.length;u--;){var v=e[u];v.diffValue_===0&&qO(v,t),v.diffValue_=0}for(;s--;){var T=n[s];T.diffValue_===1&&(T.diffValue_=0,HV(T,t))}r!==Un.UP_TO_DATE_&&(t.dependenciesState_=r,t.onBecomeStale_())}function ME(t){var e=t.observing_;t.observing_=[];for(var n=e.length;n--;)qO(e[n],t);t.dependenciesState_=Un.NOT_TRACKING_}function $O(t){var e=Nf();try{return t()}finally{Rc(e)}}function Nf(){var t=_t.trackingDerivation;return _t.trackingDerivation=null,t}function Rc(t){_t.trackingDerivation=t}function Cx(t){var e=_t.allowStateReads;return _t.allowStateReads=t,e}function tf(t){_t.allowStateReads=t}function HO(t){if(t.dependenciesState_!==Un.UP_TO_DATE_){t.dependenciesState_=Un.UP_TO_DATE_;for(var e=t.observing_,n=e.length;n--;)e[n].lowestObserverState_=Un.UP_TO_DATE_}}var G0=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0,this.stateVersion=Number.MIN_SAFE_INTEGER},W0=!0,ZO=!1,_t=function(){var t=_S();return t.__mobxInstanceCount>0&&!t.__mobxGlobals&&(W0=!1),t.__mobxGlobals&&t.__mobxGlobals.version!==new G0().version&&(W0=!1),W0?t.__mobxGlobals?(t.__mobxInstanceCount+=1,t.__mobxGlobals.UNCHANGED||(t.__mobxGlobals.UNCHANGED={}),t.__mobxGlobals):(t.__mobxInstanceCount=1,t.__mobxGlobals=new G0):(setTimeout(function(){ZO||An(35)},1),new G0)}();function WV(){if((_t.pendingReactions.length||_t.inBatch||_t.isRunningReactions)&&An(36),ZO=!0,W0){var t=_S();--t.__mobxInstanceCount===0&&(t.__mobxGlobals=void 0),_t=new G0}}function $V(){return _t}function HV(t,e){t.observers_.add(e),t.lowestObserverState_>e.dependenciesState_&&(t.lowestObserverState_=e.dependenciesState_)}function qO(t,e){t.observers_.delete(e),t.observers_.size===0&&XO(t)}function XO(t){t.isPendingUnobservation_===!1&&(t.isPendingUnobservation_=!0,_t.pendingUnobservations.push(t))}function _s(){_t.inBatch++}function ys(){if(--_t.inBatch===0){JO();for(var t=_t.pendingUnobservations,e=0;e<t.length;e++){var n=t[e];n.isPendingUnobservation_=!1,n.observers_.size===0&&(n.isBeingObserved_&&(n.isBeingObserved_=!1,n.onBUO()),n instanceof gg&&n.suspend_())}_t.pendingUnobservations=[]}}function YO(t){var e=_t.trackingDerivation;return e!==null?(e.runId_!==t.lastAccessedBy_&&(t.lastAccessedBy_=e.runId_,e.newObserving_[e.unboundDepsCount_++]=t,!t.isBeingObserved_&&_t.trackingContext&&(t.isBeingObserved_=!0,t.onBO())),t.isBeingObserved_):(t.observers_.size===0&&_t.inBatch>0&&XO(t),!1)}function KO(t){t.lowestObserverState_!==Un.STALE_&&(t.lowestObserverState_=Un.STALE_,t.observers_.forEach(function(e){e.dependenciesState_===Un.UP_TO_DATE_&&e.onBecomeStale_(),e.dependenciesState_=Un.STALE_}))}function ZV(t){t.lowestObserverState_!==Un.STALE_&&(t.lowestObserverState_=Un.STALE_,t.observers_.forEach(function(e){e.dependenciesState_===Un.POSSIBLY_STALE_?e.dependenciesState_=Un.STALE_:e.dependenciesState_===Un.UP_TO_DATE_&&(t.lowestObserverState_=Un.UP_TO_DATE_)}))}function qV(t){t.lowestObserverState_===Un.UP_TO_DATE_&&(t.lowestObserverState_=Un.POSSIBLY_STALE_,t.observers_.forEach(function(e){e.dependenciesState_===Un.UP_TO_DATE_&&(e.dependenciesState_=Un.POSSIBLY_STALE_,e.onBecomeStale_())}))}var _g=function(){function t(n,r,s,u){n===void 0&&(n="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=Un.NOT_TRACKING_,this.diffValue_=0,this.runId_=0,this.unboundDepsCount_=0,this.isDisposed_=!1,this.isScheduled_=!1,this.isTrackPending_=!1,this.isRunning_=!1,this.isTracing_=Qu.NONE,this.name_=n,this.onInvalidate_=r,this.errorHandler_=s,this.requiresObservable_=u}var e=t.prototype;return e.onBecomeStale_=function(){this.schedule_()},e.schedule_=function(){this.isScheduled_||(this.isScheduled_=!0,_t.pendingReactions.push(this),JO())},e.isScheduled=function(){return this.isScheduled_},e.runReaction_=function(){if(!this.isDisposed_){_s(),this.isScheduled_=!1;var r=_t.trackingContext;if(_t.trackingContext=this,CE(this)){this.isTrackPending_=!0;try{this.onInvalidate_()}catch(s){this.reportExceptionInDerivation_(s)}}_t.trackingContext=r,ys()}},e.track=function(r){if(!this.isDisposed_){_s(),this.isRunning_=!0;var s=_t.trackingContext;_t.trackingContext=this;var u=WO(this,r,void 0);_t.trackingContext=s,this.isRunning_=!1,this.isTrackPending_=!1,this.isDisposed_&&ME(this),j0(u)&&this.reportExceptionInDerivation_(u.cause),ys()}},e.reportExceptionInDerivation_=function(r){var s=this;if(this.errorHandler_){this.errorHandler_(r,this);return}if(_t.disableErrorBoundaries)throw r;var u="[mobx] uncaught error in '"+this+"'";_t.suppressReactionErrors||console.error(u,r),_t.globalReactionErrorHandlers.forEach(function(p){return p(r,s)})},e.dispose=function(){this.isDisposed_||(this.isDisposed_=!0,this.isRunning_||(_s(),ME(this),ys()))},e.getDisposer_=function(){var r=this.dispose.bind(this);return r[tn]=this,r},e.toString=function(){return"Reaction["+this.name_+"]"},e.trace=function(r){r===void 0&&(r=!1),yj(this,r)},t}(),XV=100,PE=function(e){return e()};function JO(){_t.inBatch>0||_t.isRunningReactions||PE(YV)}function YV(){_t.isRunningReactions=!0;for(var t=_t.pendingReactions,e=0;t.length>0;){++e===XV&&(console.error("[mobx] cycle in reaction: "+t[0]),t.splice(0));for(var n=t.splice(0),r=0,s=n.length;r<s;r++)n[r].runReaction_()}_t.isRunningReactions=!1}var Iv=Gc("Reaction",_g);function KV(t){var e=PE;PE=function(r){return t(function(){return e(r)})}}function $m(){return!1}function JV(t){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}var QO="action",QV="action.bound",eD="autoAction",ej="autoAction.bound",tD="<unnamed action>",nD=Gg(QO),tj=Gg(QV,{bound:!0}),rD=Gg(eD,{autoAction:!0}),nj=Gg(ej,{autoAction:!0,bound:!0});function iD(t){var e=function(r,s){if(Jo(r))return yf(r.name||tD,r,t);if(Jo(s))return yf(r,s,t);if(lh(s))return Vg(r,s,t?rD:nD);if(lh(r))return Fa(Gg(t?eD:QO,{name:r,autoAction:t}))};return e}var Go=iD(!1);Object.assign(Go,nD);var yg=iD(!0);Object.assign(yg,rD);Go.bound=Fa(tj);yg.bound=Fa(nj);function Rv(t){return UO(t.name||tD,!1,t,this,void 0)}function bS(t){return Jo(t)&&t.isMobxAction===!0}function wS(t,e){var n,r;e===void 0&&(e=wO);var s=(n=(r=e)==null?void 0:r.name)!=null?n:"Autorun",u=!e.scheduler&&!e.delay,p;if(u)p=new _g(s,function(){this.track(T)},e.onError,e.requiresObservable);else{var o=ij(e),v=!1;p=new _g(s,function(){v||(v=!0,o(function(){v=!1,p.isDisposed_||p.track(T)}))},e.onError,e.requiresObservable)}function T(){t(p)}return p.schedule_(),p.getDisposer_()}var rj=function(e){return e()};function ij(t){return t.scheduler?t.scheduler:t.delay?function(e){return setTimeout(e,t.delay)}:rj}var sj="onBO",oj="onBUO";function aj(t,e,n){return oD(sj,t,e,n)}function sD(t,e,n){return oD(oj,t,e,n)}function oD(t,e,n,r){var s=typeof r=="function"?zc(e,n):zc(e),u=Jo(r)?r:n,p=t+"L";return s[p]?s[p].add(u):s[p]=new Set([u]),function(){var o=s[p];o&&(o.delete(u),o.size===0&&delete s[p])}}var lj="never",u0="always",cj="observed";function uj(t){t.isolateGlobalState===!0&&WV();var e=t.useProxies,n=t.enforceActions;if(e!==void 0&&(_t.useProxies=e===u0?!0:e===lj?!1:typeof Proxy<"u"),e==="ifavailable"&&(_t.verifyProxies=!0),n!==void 0){var r=n===u0?u0:n===cj;_t.enforceActions=r,_t.allowStateChanges=!(r===!0||r===u0)}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach(function(s){s in t&&(_t[s]=!!t[s])}),_t.allowStateReads=!_t.observableRequiresReaction,t.reactionScheduler&&KV(t.reactionScheduler)}function aD(t,e,n,r){var s=K6(e),u=Yg(t,r)[tn];_s();try{mf(s).forEach(function(p){u.extend_(p,s[p],n&&p in n?n[p]:!0)})}finally{ys()}return t}function hj(t,e){return lD(zc(t,e))}function lD(t){var e={name:t.name_};return t.observing_&&t.observing_.length>0&&(e.dependencies=dj(t.observing_).map(lD)),e}function dj(t){return Array.from(new Set(t))}var fj=0;function cD(){this.message="FLOW_CANCELLED"}cD.prototype=Object.create(Error.prototype);var cP=RO("flow"),pj=RO("flow.bound",{bound:!0}),vg=Object.assign(function(e,n){if(lh(n))return Vg(e,n,cP);var r=e,s=r.name||"<unnamed flow>",u=function(){var o=this,v=arguments,T=++fj,I=Go(s+" - runid: "+T+" - init",r).apply(o,v),L,F=void 0,j=new Promise(function(X,re){var de=0;L=re;function q(Ee){F=void 0;var ue;try{ue=Go(s+" - runid: "+T+" - yield "+de++,I.next).call(I,Ee)}catch(Fe){return re(Fe)}J(ue)}function H(Ee){F=void 0;var ue;try{ue=Go(s+" - runid: "+T+" - yield "+de++,I.throw).call(I,Ee)}catch(Fe){return re(Fe)}J(ue)}function J(Ee){if(Jo(Ee==null?void 0:Ee.then)){Ee.then(J,re);return}return Ee.done?X(Ee.value):(F=Promise.resolve(Ee.value),F.then(q,H))}q(void 0)});return j.cancel=Go(s+" - runid: "+T+" - cancel",function(){try{F&&uP(F);var X=I.return(void 0),re=Promise.resolve(X.value);re.then(Wd,Wd),uP(re),L(new cD)}catch(de){L(de)}}),j};return u.isMobXFlow=!0,u},cP);vg.bound=Fa(pj);function uP(t){Jo(t.cancel)&&t.cancel()}function kv(t){return(t==null?void 0:t.isMobXFlow)===!0}function mj(t,e){return t?e!==void 0?vf(t)?t[tn].values_.has(e):!1:vf(t)||!!t[tn]||vS(t)||Iv(t)||Hg(t):!1}function ES(t){return mj(t)}function gj(t){if(vf(t))return t[tn].ownKeys_();An(38)}function h0(t,e,n){return t.set(e,n),n}function Id(t,e){if(t==null||typeof t!="object"||t instanceof Date||!ES(t))return t;if(jV(t)||Hg(t))return Id(t.get(),e);if(e.has(t))return e.get(t);if(Xg(t)){var n=h0(e,t,new Array(t.length));return t.forEach(function(p,o){n[o]=Id(p,e)}),n}if(mh(t)){var r=h0(e,t,new Set);return t.forEach(function(p){r.add(Id(p,e))}),r}if($c(t)){var s=h0(e,t,new Map);return t.forEach(function(p,o){s.set(o,Id(p,e))}),s}else{var u=h0(e,t,{});return gj(t).forEach(function(p){Ng.propertyIsEnumerable.call(t,p)&&(u[p]=Id(t[p],e))}),u}}function _j(t,e){return Id(t,new Map)}function yj(){An("trace() is not available in production builds");for(var t=!1,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];typeof n[n.length-1]=="boolean"&&(t=n.pop());var s=vj(n);if(!s)return An("'trace(break?)' can only be used inside a tracked computed value or a Reaction. Consider passing in the computed value or reaction explicitly");s.isTracing_===Qu.NONE&&console.log("[mobx.trace] '"+s.name_+"' tracing enabled"),s.isTracing_=t?Qu.BREAK:Qu.LOG}function vj(t){switch(t.length){case 0:return _t.trackingDerivation;case 1:return zc(t[0]);case 2:return zc(t[0],t[1])}}function al(t,e){e===void 0&&(e=void 0),_s();try{return t.apply(e)}finally{ys()}}function bd(t){return t[tn]}var xj={has:function(e,n){return bd(e).has_(n)},get:function(e,n){return bd(e).get_(n)},set:function(e,n,r){var s;return lh(n)?(s=bd(e).set_(n,r,!0))!=null?s:!0:!1},deleteProperty:function(e,n){var r;return lh(n)?(r=bd(e).delete_(n,!0))!=null?r:!0:!1},defineProperty:function(e,n,r){var s;return(s=bd(e).defineProperty_(n,r))!=null?s:!0},ownKeys:function(e){return bd(e).ownKeys_()},preventExtensions:function(e){An(13)}};function bj(t,e){var n,r;return EO(),t=Yg(t,e),(r=(n=t[tn]).proxy_)!=null?r:n.proxy_=new Proxy(t,xj)}function ao(t){return t.interceptors_!==void 0&&t.interceptors_.length>0}function Zg(t,e){var n=t.interceptors_||(t.interceptors_=[]);return n.push(e),TO(function(){var r=n.indexOf(e);r!==-1&&n.splice(r,1)})}function lo(t,e){var n=Nf();try{for(var r=[].concat(t.interceptors_||[]),s=0,u=r.length;s<u&&(e=r[s](e),e&&!e.type&&An(14),!!e);s++);return e}finally{Rc(n)}}function qo(t){return t.changeListeners_!==void 0&&t.changeListeners_.length>0}function qg(t,e){var n=t.changeListeners_||(t.changeListeners_=[]);return n.push(e),TO(function(){var r=n.indexOf(e);r!==-1&&n.splice(r,1)})}function Xo(t,e){var n=Nf(),r=t.changeListeners_;if(r){r=r.slice();for(var s=0,u=r.length;s<u;s++)r[s](e);Rc(n)}}function wj(t,e,n){var r=Yg(t,n)[tn];_s();try{var s;(s=e)!=null||(e=tV(t)),mf(e).forEach(function(u){return r.make_(u,e[u])})}finally{ys()}return t}var zb=Symbol("mobx-keys");function uD(t,e,n){if(yl(t))return aD(t,t,e,n);var r=Yg(t,n)[tn];if(!t[zb]){var s=Object.getPrototypeOf(t),u=new Set([].concat(mf(t),mf(s)));u.delete("constructor"),u.delete(tn),Bg(s,zb,u)}_s();try{t[zb].forEach(function(p){return r.make_(p,e&&p in e?e[p]:!0)})}finally{ys()}return t}var hP="splice",Na="update",Ej=1e4,Tj={get:function(e,n){var r=e[tn];return n===tn?r:n==="length"?r.getArrayLength_():typeof n=="string"&&!isNaN(n)?r.get_(parseInt(n)):fl(Lv,n)?Lv[n]:e[n]},set:function(e,n,r){var s=e[tn];return n==="length"&&s.setArrayLength_(r),typeof n=="symbol"||isNaN(n)?e[n]=r:s.set_(parseInt(n),r),!0},preventExtensions:function(){An(15)}},TS=function(){function t(n,r,s,u){n===void 0&&(n="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=s,this.legacyMode_=u,this.atom_=new jg(n),this.enhancer_=function(p,o){return r(p,o,"ObservableArray[..]")}}var e=t.prototype;return e.dehanceValue_=function(r){return this.dehancer!==void 0?this.dehancer(r):r},e.dehanceValues_=function(r){return this.dehancer!==void 0&&r.length>0?r.map(this.dehancer):r},e.intercept_=function(r){return Zg(this,r)},e.observe_=function(r,s){return s===void 0&&(s=!1),s&&r({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),qg(this,r)},e.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},e.setArrayLength_=function(r){(typeof r!="number"||isNaN(r)||r<0)&&An("Out of range: "+r);var s=this.values_.length;if(r!==s)if(r>s){for(var u=new Array(r-s),p=0;p<r-s;p++)u[p]=void 0;this.spliceWithArray_(s,0,u)}else this.spliceWithArray_(r,s-r)},e.updateArrayLength_=function(r,s){r!==this.lastKnownLength_&&An(16),this.lastKnownLength_+=s,this.legacyMode_&&s>0&&bD(r+s+1)},e.spliceWithArray_=function(r,s,u){var p=this;this.atom_;var o=this.values_.length;if(r===void 0?r=0:r>o?r=o:r<0&&(r=Math.max(0,o+r)),arguments.length===1?s=o-r:s==null?s=0:s=Math.max(0,Math.min(s,o-r)),u===void 0&&(u=SE),ao(this)){var v=lo(this,{object:this.proxy_,type:hP,index:r,removedCount:s,added:u});if(!v)return SE;s=v.removedCount,u=v.added}if(u=u.length===0?u:u.map(function(L){return p.enhancer_(L,void 0)}),this.legacyMode_){var T=u.length-s;this.updateArrayLength_(o,T)}var I=this.spliceItemsIntoValues_(r,s,u);return(s!==0||u.length!==0)&&this.notifyArraySplice_(r,u,I),this.dehanceValues_(I)},e.spliceItemsIntoValues_=function(r,s,u){if(u.length<Ej){var p;return(p=this.values_).splice.apply(p,[r,s].concat(u))}else{var o=this.values_.slice(r,r+s),v=this.values_.slice(r+s);this.values_.length+=u.length-s;for(var T=0;T<u.length;T++)this.values_[r+T]=u[T];for(var I=0;I<v.length;I++)this.values_[r+u.length+I]=v[I];return o}},e.notifyArrayChildUpdate_=function(r,s,u){var p=!this.owned_&&$m(),o=qo(this),v=o||p?{observableKind:"array",object:this.proxy_,type:Na,debugObjectName:this.atom_.name_,index:r,newValue:s,oldValue:u}:null;this.atom_.reportChanged(),o&&Xo(this,v)},e.notifyArraySplice_=function(r,s,u){var p=!this.owned_&&$m(),o=qo(this),v=o||p?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:hP,index:r,removed:u,added:s,removedCount:u.length,addedCount:s.length}:null;this.atom_.reportChanged(),o&&Xo(this,v)},e.get_=function(r){if(this.legacyMode_&&r>=this.values_.length){console.warn("[mobx] Out of bounds read: "+r);return}return this.atom_.reportObserved(),this.dehanceValue_(this.values_[r])},e.set_=function(r,s){var u=this.values_;if(this.legacyMode_&&r>u.length&&An(17,r,u.length),r<u.length){this.atom_;var p=u[r];if(ao(this)){var o=lo(this,{type:Na,object:this.proxy_,index:r,newValue:s});if(!o)return;s=o.newValue}s=this.enhancer_(s,p);var v=s!==p;v&&(u[r]=s,this.notifyArrayChildUpdate_(r,s,p))}else{for(var T=new Array(r+1-u.length),I=0;I<T.length-1;I++)T[I]=void 0;T[T.length-1]=s,this.spliceWithArray_(u.length,0,T)}},t}();function Sj(t,e,n,r){n===void 0&&(n="ObservableArray"),r===void 0&&(r=!1),EO();var s=new TS(n,e,r,!1);AO(s.values_,tn,s);var u=new Proxy(s.values_,Tj);if(s.proxy_=u,t&&t.length){var p=Wg(!0);s.spliceWithArray_(0,0,t),$g(p)}return u}var Lv={clear:function(){return this.splice(0)},replace:function(e){var n=this[tn];return n.spliceWithArray_(0,n.values_.length,e)},toJSON:function(){return this.slice()},splice:function(e,n){for(var r=arguments.length,s=new Array(r>2?r-2:0),u=2;u<r;u++)s[u-2]=arguments[u];var p=this[tn];switch(arguments.length){case 0:return[];case 1:return p.spliceWithArray_(e);case 2:return p.spliceWithArray_(e,n)}return p.spliceWithArray_(e,n,s)},spliceWithArray:function(e,n,r){return this[tn].spliceWithArray_(e,n,r)},push:function(){for(var e=this[tn],n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e.spliceWithArray_(e.values_.length,0,r),e.values_.length},pop:function(){return this.splice(Math.max(this[tn].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var e=this[tn],n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e.spliceWithArray_(0,0,r),e.values_.length},reverse:function(){return _t.trackingDerivation&&An(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){_t.trackingDerivation&&An(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function(e){var n=this[tn],r=n.dehanceValues_(n.values_).indexOf(e);return r>-1?(this.splice(r,1),!0):!1}};oi("concat",Tl);oi("flat",Tl);oi("includes",Tl);oi("indexOf",Tl);oi("join",Tl);oi("lastIndexOf",Tl);oi("slice",Tl);oi("toString",Tl);oi("toLocaleString",Tl);oi("every",Wc);oi("filter",Wc);oi("find",Wc);oi("findIndex",Wc);oi("flatMap",Wc);oi("forEach",Wc);oi("map",Wc);oi("some",Wc);oi("reduce",hD);oi("reduceRight",hD);function oi(t,e){typeof Array.prototype[t]=="function"&&(Lv[t]=e(t))}function Tl(t){return function(){var e=this[tn];e.atom_.reportObserved();var n=e.dehanceValues_(e.values_);return n[t].apply(n,arguments)}}function Wc(t){return function(e,n){var r=this,s=this[tn];s.atom_.reportObserved();var u=s.dehanceValues_(s.values_);return u[t](function(p,o){return e.call(n,p,o,r)})}}function hD(t){return function(){var e=this,n=this[tn];n.atom_.reportObserved();var r=n.dehanceValues_(n.values_),s=arguments[0];return arguments[0]=function(u,p,o){return s(u,p,o,e)},r[t].apply(r,arguments)}}var Aj=Gc("ObservableArrayAdministration",TS);function Xg(t){return Ex(t)&&Aj(t[tn])}var dD,fD,Cj={},xc="add",Ov="delete";dD=Symbol.iterator;fD=Symbol.toStringTag;var pD=function(){function t(n,r,s){var u=this;r===void 0&&(r=_f),s===void 0&&(s="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[tn]=Cj,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=r,this.name_=s,Jo(Map)||An(18),this.keysAtom_=Wm("ObservableMap.keys()"),this.data_=new Map,this.hasMap_=new Map,VO(!0,function(){u.merge(n)})}var e=t.prototype;return e.has_=function(r){return this.data_.has(r)},e.has=function(r){var s=this;if(!_t.trackingDerivation)return this.has_(r);var u=this.hasMap_.get(r);if(!u){var p=u=new Ju(this.has_(r),Tx,"ObservableMap.key?",!1);this.hasMap_.set(r,p),sD(p,function(){return s.hasMap_.delete(r)})}return u.get()},e.set=function(r,s){var u=this.has_(r);if(ao(this)){var p=lo(this,{type:u?Na:xc,object:this,newValue:s,name:r});if(!p)return this;s=p.newValue}return u?this.updateValue_(r,s):this.addValue_(r,s),this},e.delete=function(r){var s=this;if(this.keysAtom_,ao(this)){var u=lo(this,{type:Ov,object:this,name:r});if(!u)return!1}if(this.has_(r)){var p=$m(),o=qo(this),v=o||p?{observableKind:"map",debugObjectName:this.name_,type:Ov,object:this,oldValue:this.data_.get(r).value_,name:r}:null;return al(function(){var T;s.keysAtom_.reportChanged(),(T=s.hasMap_.get(r))==null||T.setNewValue_(!1);var I=s.data_.get(r);I.setNewValue_(void 0),s.data_.delete(r)}),o&&Xo(this,v),!0}return!1},e.updateValue_=function(r,s){var u=this.data_.get(r);if(s=u.prepareNewValue_(s),s!==_t.UNCHANGED){var p=$m(),o=qo(this),v=o||p?{observableKind:"map",debugObjectName:this.name_,type:Na,object:this,oldValue:u.value_,name:r,newValue:s}:null;u.setNewValue_(s),o&&Xo(this,v)}},e.addValue_=function(r,s){var u=this;this.keysAtom_,al(function(){var T,I=new Ju(s,u.enhancer_,"ObservableMap.key",!1);u.data_.set(r,I),s=I.value_,(T=u.hasMap_.get(r))==null||T.setNewValue_(!0),u.keysAtom_.reportChanged()});var p=$m(),o=qo(this),v=o||p?{observableKind:"map",debugObjectName:this.name_,type:xc,object:this,name:r,newValue:s}:null;o&&Xo(this,v)},e.get=function(r){return this.has(r)?this.dehanceValue_(this.data_.get(r).get()):this.dehanceValue_(void 0)},e.dehanceValue_=function(r){return this.dehancer!==void 0?this.dehancer(r):r},e.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},e.values=function(){var r=this,s=this.keys();return xg({next:function(){var p=s.next(),o=p.done,v=p.value;return{done:o,value:o?void 0:r.get(v)}}})},e.entries=function(){var r=this,s=this.keys();return xg({next:function(){var p=s.next(),o=p.done,v=p.value;return{done:o,value:o?void 0:[v,r.get(v)]}}})},e[dD]=function(){return this.entries()},e.forEach=function(r,s){for(var u=$d(this),p;!(p=u()).done;){var o=p.value,v=o[0],T=o[1];r.call(s,T,v,this)}},e.merge=function(r){var s=this;return $c(r)&&(r=new Map(r)),al(function(){yl(r)?Y6(r).forEach(function(u){return s.set(u,r[u])}):Array.isArray(r)?r.forEach(function(u){var p=u[0],o=u[1];return s.set(p,o)}):Ff(r)?(r.constructor!==Map&&An(19,r),r.forEach(function(u,p){return s.set(p,u)})):r!=null&&An(20,r)}),this},e.clear=function(){var r=this;al(function(){$O(function(){for(var s=$d(r.keys()),u;!(u=s()).done;){var p=u.value;r.delete(p)}})})},e.replace=function(r){var s=this;return al(function(){for(var u=Mj(r),p=new Map,o=!1,v=$d(s.data_.keys()),T;!(T=v()).done;){var I=T.value;if(!u.has(I)){var L=s.delete(I);if(L)o=!0;else{var F=s.data_.get(I);p.set(I,F)}}}for(var j=$d(u.entries()),X;!(X=j()).done;){var re=X.value,de=re[0],q=re[1],H=s.data_.has(de);if(s.set(de,q),s.data_.has(de)){var J=s.data_.get(de);p.set(de,J),H||(o=!0)}}if(!o)if(s.data_.size!==p.size)s.keysAtom_.reportChanged();else for(var Ee=s.data_.keys(),ue=p.keys(),Fe=Ee.next(),Qe=ue.next();!Fe.done;){if(Fe.value!==Qe.value){s.keysAtom_.reportChanged();break}Fe=Ee.next(),Qe=ue.next()}s.data_=p}),this},e.toString=function(){return"[object ObservableMap]"},e.toJSON=function(){return Array.from(this)},e.observe_=function(r,s){return qg(this,r)},e.intercept_=function(r){return Zg(this,r)},yS(t,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:fD,get:function(){return"Map"}}]),t}(),$c=Gc("ObservableMap",pD);function Mj(t){if(Ff(t)||$c(t))return t;if(Array.isArray(t))return new Map(t);if(yl(t)){var e=new Map;for(var n in t)e.set(n,t[n]);return e}else return An(21,t)}var mD,gD,Pj={};mD=Symbol.iterator;gD=Symbol.toStringTag;var _D=function(){function t(n,r,s){r===void 0&&(r=_f),s===void 0&&(s="ObservableSet"),this.name_=void 0,this[tn]=Pj,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=s,Jo(Set)||An(22),this.atom_=Wm(this.name_),this.enhancer_=function(u,p){return r(u,p,s)},n&&this.replace(n)}var e=t.prototype;return e.dehanceValue_=function(r){return this.dehancer!==void 0?this.dehancer(r):r},e.clear=function(){var r=this;al(function(){$O(function(){for(var s=$d(r.data_.values()),u;!(u=s()).done;){var p=u.value;r.delete(p)}})})},e.forEach=function(r,s){for(var u=$d(this),p;!(p=u()).done;){var o=p.value;r.call(s,o,o,this)}},e.add=function(r){var s=this;if(this.atom_,ao(this)){var u=lo(this,{type:xc,object:this,newValue:r});if(!u)return this}if(!this.has(r)){al(function(){s.data_.add(s.enhancer_(r,void 0)),s.atom_.reportChanged()});var p=!1,o=qo(this),v=o||p?{observableKind:"set",debugObjectName:this.name_,type:xc,object:this,newValue:r}:null;o&&Xo(this,v)}return this},e.delete=function(r){var s=this;if(ao(this)){var u=lo(this,{type:Ov,object:this,oldValue:r});if(!u)return!1}if(this.has(r)){var p=!1,o=qo(this),v=o||p?{observableKind:"set",debugObjectName:this.name_,type:Ov,object:this,oldValue:r}:null;return al(function(){s.atom_.reportChanged(),s.data_.delete(r)}),o&&Xo(this,v),!0}return!1},e.has=function(r){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(r))},e.entries=function(){var r=0,s=Array.from(this.keys()),u=Array.from(this.values());return xg({next:function(){var o=r;return r+=1,o<u.length?{value:[s[o],u[o]],done:!1}:{done:!0}}})},e.keys=function(){return this.values()},e.values=function(){this.atom_.reportObserved();var r=this,s=0,u=Array.from(this.data_.values());return xg({next:function(){return s<u.length?{value:r.dehanceValue_(u[s++]),done:!1}:{done:!0}}})},e.replace=function(r){var s=this;return mh(r)&&(r=new Set(r)),al(function(){Array.isArray(r)?(s.clear(),r.forEach(function(u){return s.add(u)})):Ug(r)?(s.clear(),r.forEach(function(u){return s.add(u)})):r!=null&&An("Cannot initialize set from "+r)}),this},e.observe_=function(r,s){return qg(this,r)},e.intercept_=function(r){return Zg(this,r)},e.toJSON=function(){return Array.from(this)},e.toString=function(){return"[object ObservableSet]"},e[mD]=function(){return this.values()},yS(t,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:gD,get:function(){return"Set"}}]),t}(),mh=Gc("ObservableSet",_D),dP=Object.create(null),fP="remove",yD=function(){function t(n,r,s,u){r===void 0&&(r=new Map),u===void 0&&(u=EV),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=n,this.values_=r,this.name_=s,this.defaultAnnotation_=u,this.keysAtom_=new jg("ObservableObject.keys"),this.isPlainObject_=yl(this.target_)}var e=t.prototype;return e.getObservablePropValue_=function(r){return this.values_.get(r).get()},e.setObservablePropValue_=function(r,s){var u=this.values_.get(r);if(u instanceof gg)return u.set(s),!0;if(ao(this)){var p=lo(this,{type:Na,object:this.proxy_||this.target_,name:r,newValue:s});if(!p)return null;s=p.newValue}if(s=u.prepareNewValue_(s),s!==_t.UNCHANGED){var o=qo(this),v=!1,T=o||v?{type:Na,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:u.value_,name:r,newValue:s}:null;u.setNewValue_(s),o&&Xo(this,T)}return!0},e.get_=function(r){return _t.trackingDerivation&&!fl(this.target_,r)&&this.has_(r),this.target_[r]},e.set_=function(r,s,u){return u===void 0&&(u=!1),fl(this.target_,r)?this.values_.has(r)?this.setObservablePropValue_(r,s):u?Reflect.set(this.target_,r,s):(this.target_[r]=s,!0):this.extend_(r,{value:s,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,u)},e.has_=function(r){if(!_t.trackingDerivation)return r in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var s=this.pendingKeys_.get(r);return s||(s=new Ju(r in this.target_,Tx,"ObservableObject.key?",!1),this.pendingKeys_.set(r,s)),s.get()},e.make_=function(r,s){if(s===!0&&(s=this.defaultAnnotation_),s!==!1){if(!(r in this.target_)){var u;if((u=this.target_[Ra])!=null&&u[r])return;An(1,s.annotationType_,this.name_+"."+r.toString())}for(var p=this.target_;p&&p!==Ng;){var o=Av(p,r);if(o){var v=s.make_(this,r,o,p);if(v===0)return;if(v===1)break}p=Object.getPrototypeOf(p)}mP(this,s,r)}},e.extend_=function(r,s,u,p){if(p===void 0&&(p=!1),u===!0&&(u=this.defaultAnnotation_),u===!1)return this.defineProperty_(r,s,p);var o=u.extend_(this,r,s,p);return o&&mP(this,u,r),o},e.defineProperty_=function(r,s,u){u===void 0&&(u=!1);try{_s();var p=this.delete_(r);if(!p)return p;if(ao(this)){var o=lo(this,{object:this.proxy_||this.target_,name:r,type:xc,newValue:s.value});if(!o)return null;var v=o.newValue;s.value!==v&&(s=gf({},s,{value:v}))}if(u){if(!Reflect.defineProperty(this.target_,r,s))return!1}else za(this.target_,r,s);this.notifyPropertyAddition_(r,s.value)}finally{ys()}return!0},e.defineObservableProperty_=function(r,s,u,p){p===void 0&&(p=!1);try{_s();var o=this.delete_(r);if(!o)return o;if(ao(this)){var v=lo(this,{object:this.proxy_||this.target_,name:r,type:xc,newValue:s});if(!v)return null;s=v.newValue}var T=pP(r),I={configurable:_t.safeDescriptors?this.isPlainObject_:!0,enumerable:!0,get:T.get,set:T.set};if(p){if(!Reflect.defineProperty(this.target_,r,I))return!1}else za(this.target_,r,I);var L=new Ju(s,u,"ObservableObject.key",!1);this.values_.set(r,L),this.notifyPropertyAddition_(r,L.value_)}finally{ys()}return!0},e.defineComputedProperty_=function(r,s,u){u===void 0&&(u=!1);try{_s();var p=this.delete_(r);if(!p)return p;if(ao(this)){var o=lo(this,{object:this.proxy_||this.target_,name:r,type:xc,newValue:void 0});if(!o)return null}s.name||(s.name="ObservableObject.key"),s.context=this.proxy_||this.target_;var v=pP(r),T={configurable:_t.safeDescriptors?this.isPlainObject_:!0,enumerable:!1,get:v.get,set:v.set};if(u){if(!Reflect.defineProperty(this.target_,r,T))return!1}else za(this.target_,r,T);this.values_.set(r,new gg(s)),this.notifyPropertyAddition_(r,void 0)}finally{ys()}return!0},e.delete_=function(r,s){if(s===void 0&&(s=!1),!fl(this.target_,r))return!0;if(ao(this)){var u=lo(this,{object:this.proxy_||this.target_,name:r,type:fP});if(!u)return null}try{var p,o;_s();var v=qo(this),T=!1,I=this.values_.get(r),L=void 0;if(!I&&(v||T)){var F;L=(F=Av(this.target_,r))==null?void 0:F.value}if(s){if(!Reflect.deleteProperty(this.target_,r))return!1}else delete this.target_[r];if(I&&(this.values_.delete(r),I instanceof Ju&&(L=I.value_),KO(I)),this.keysAtom_.reportChanged(),(p=this.pendingKeys_)==null||(o=p.get(r))==null||o.set(r in this.target_),v||T){var j={type:fP,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:L,name:r};v&&Xo(this,j)}}finally{ys()}return!0},e.observe_=function(r,s){return qg(this,r)},e.intercept_=function(r){return Zg(this,r)},e.notifyPropertyAddition_=function(r,s){var u,p,o=qo(this),v=!1;if(o||v){var T=o||v?{type:xc,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:r,newValue:s}:null;o&&Xo(this,T)}(u=this.pendingKeys_)==null||(p=u.get(r))==null||p.set(!0),this.keysAtom_.reportChanged()},e.ownKeys_=function(){return this.keysAtom_.reportObserved(),mf(this.target_)},e.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},t}();function Yg(t,e){var n;if(fl(t,tn))return t;var r=(n=e==null?void 0:e.name)!=null?n:"ObservableObject",s=new yD(t,new Map,String(r),LV(e));return Bg(t,tn,s),t}var Ij=Gc("ObservableObjectAdministration",yD);function pP(t){return dP[t]||(dP[t]={get:function(){return this[tn].getObservablePropValue_(t)},set:function(n){return this[tn].setObservablePropValue_(t,n)}})}function vf(t){return Ex(t)?Ij(t[tn]):!1}function mP(t,e,n){var r;(r=t.target_[Ra])==null||delete r[n]}var Rj=xD(0),Fb=0,vD=function(){};function kj(t,e){Object.setPrototypeOf?Object.setPrototypeOf(t.prototype,e):t.prototype.__proto__!==void 0?t.prototype.__proto__=e:t.prototype=e}kj(vD,Array.prototype);var SS=function(t,e,n){PO(r,t);function r(u,p,o,v){var T;o===void 0&&(o="ObservableArray"),v===void 0&&(v=!1),T=t.call(this)||this;var I=new TS(o,p,v,!0);if(I.proxy_=Db(T),AO(Db(T),tn,I),u&&u.length){var L=Wg(!0);T.spliceWithArray(0,0,u),$g(L)}return Object.defineProperty(Db(T),"0",Rj),T}var s=r.prototype;return s.concat=function(){this[tn].atom_.reportObserved();for(var p=arguments.length,o=new Array(p),v=0;v<p;v++)o[v]=arguments[v];return Array.prototype.concat.apply(this.slice(),o.map(function(T){return Xg(T)?T.slice():T}))},s[n]=function(){var u=this,p=0;return xg({next:function(){return p<u.length?{value:u[p++],done:!1}:{done:!0,value:void 0}}})},yS(r,[{key:"length",get:function(){return this[tn].getArrayLength_()},set:function(p){this[tn].setArrayLength_(p)}},{key:e,get:function(){return"Array"}}]),r}(vD,Symbol.toStringTag,Symbol.iterator);Object.entries(Lv).forEach(function(t){var e=t[0],n=t[1];e!=="concat"&&Bg(SS.prototype,e,n)});function xD(t){return{enumerable:!1,configurable:!0,get:function(){return this[tn].get_(t)},set:function(n){this[tn].set_(t,n)}}}function Lj(t){za(SS.prototype,""+t,xD(t))}function bD(t){if(t>Fb){for(var e=Fb;e<t+100;e++)Lj(e);Fb=t}}bD(1e3);function Oj(t,e,n){return new SS(t,e,n)}function zc(t,e){if(typeof t=="object"&&t!==null){if(Xg(t))return e!==void 0&&An(23),t[tn].atom_;if(mh(t))return t.atom_;if($c(t)){if(e===void 0)return t.keysAtom_;var n=t.data_.get(e)||t.hasMap_.get(e);return n||An(25,e,IE(t)),n}if(vf(t)){if(!e)return An(26);var r=t[tn].values_.get(e);return r||An(27,e,IE(t)),r}if(vS(t)||Hg(t)||Iv(t))return t}else if(Jo(t)&&Iv(t[tn]))return t[tn];An(28)}function wD(t,e){if(t||An(29),e!==void 0)return wD(zc(t,e));if(vS(t)||Hg(t)||Iv(t)||$c(t)||mh(t))return t;if(t[tn])return t[tn];An(24,t)}function IE(t,e){var n;if(e!==void 0)n=zc(t,e);else{if(bS(t))return t.name;vf(t)||$c(t)||mh(t)?n=wD(t):n=zc(t)}return n.name_}var gP=Ng.toString;function AS(t,e,n){return n===void 0&&(n=-1),RE(t,e,n)}function RE(t,e,n,r,s){if(t===e)return t!==0||1/t===1/e;if(t==null||e==null)return!1;if(t!==t)return e!==e;var u=typeof t;if(u!=="function"&&u!=="object"&&typeof e!="object")return!1;var p=gP.call(t);if(p!==gP.call(e))return!1;switch(p){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:+t==0?1/+t===1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(t)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":n>=0&&n++;break}t=_P(t),e=_P(e);var o=p==="[object Array]";if(!o){if(typeof t!="object"||typeof e!="object")return!1;var v=t.constructor,T=e.constructor;if(v!==T&&!(Jo(v)&&v instanceof v&&Jo(T)&&T instanceof T)&&"constructor"in t&&"constructor"in e)return!1}if(n===0)return!1;n<0&&(n=-1),r=r||[],s=s||[];for(var I=r.length;I--;)if(r[I]===t)return s[I]===e;if(r.push(t),s.push(e),o){if(I=t.length,I!==e.length)return!1;for(;I--;)if(!RE(t[I],e[I],n-1,r,s))return!1}else{var L=Object.keys(t),F;if(I=L.length,Object.keys(e).length!==I)return!1;for(;I--;)if(F=L[I],!(fl(e,F)&&RE(t[F],e[F],n-1,r,s)))return!1}return r.pop(),s.pop(),!0}function _P(t){return Xg(t)?t.slice():Ff(t)||$c(t)||Ug(t)||mh(t)?Array.from(t.entries()):t}function xg(t){return t[Symbol.iterator]=Dj,t}function Dj(){return this}["Symbol","Map","Set"].forEach(function(t){var e=_S();typeof e[t]>"u"&&An("MobX requires global '"+t+"' to be available or polyfilled")});typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:JV,extras:{getDebugName:IE},$mobx:tn});if(!We.useState)throw new Error("mobx-react-lite requires React with Hooks support");if(!wj)throw new Error("mobx-react-lite@3 requires mobx at least version 6 to be available");function zj(t){t()}function Fj(t){t||(t=zj),uj({reactionScheduler:t})}function Nj(t){return hj(t)}var Bj=1e4,Uj=1e4,Vj=function(){function t(e){var n=this;Object.defineProperty(this,"finalize",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"registrations",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"sweepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sweep",{enumerable:!0,configurable:!0,writable:!0,value:function(r){r===void 0&&(r=Bj),clearTimeout(n.sweepTimeout),n.sweepTimeout=void 0;var s=Date.now();n.registrations.forEach(function(u,p){s-u.registeredAt>=r&&(n.finalize(u.value),n.registrations.delete(p))}),n.registrations.size>0&&n.scheduleSweep()}}),Object.defineProperty(this,"finalizeAllImmediately",{enumerable:!0,configurable:!0,writable:!0,value:function(){n.sweep(0)}})}return Object.defineProperty(t.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(e,n,r){this.registrations.set(r,{value:n,registeredAt:Date.now()}),this.scheduleSweep()}}),Object.defineProperty(t.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.registrations.delete(e)}}),Object.defineProperty(t.prototype,"scheduleSweep",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.sweepTimeout===void 0&&(this.sweepTimeout=setTimeout(this.sweep,Uj))}}),t}(),jj=typeof FinalizationRegistry<"u"?FinalizationRegistry:Vj,bg=new jj(function(t){var e;(e=t.reaction)===null||e===void 0||e.dispose(),t.reaction=null}),kE={},Gj={get exports(){return kE},set exports(t){kE=t}},ED={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xf=We;function Wj(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var $j=typeof Object.is=="function"?Object.is:Wj,Hj=xf.useState,Zj=xf.useEffect,qj=xf.useLayoutEffect,Xj=xf.useDebugValue;function Yj(t,e){var n=e(),r=Hj({inst:{value:n,getSnapshot:e}}),s=r[0].inst,u=r[1];return qj(function(){s.value=n,s.getSnapshot=e,Nb(s)&&u({inst:s})},[t,n,e]),Zj(function(){return Nb(s)&&u({inst:s}),t(function(){Nb(s)&&u({inst:s})})},[t]),Xj(n),n}function Nb(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!$j(t,n)}catch{return!0}}function Kj(t,e){return e()}var Jj=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Kj:Yj;ED.useSyncExternalStore=xf.useSyncExternalStore!==void 0?xf.useSyncExternalStore:Jj;(function(t){t.exports=ED})(Gj);var TD=$V(),SD=typeof TD.globalVersion<"u";function yP(t){t.reaction=new _g("observer".concat(t.name),function(){var e;SD||(t.stateVersion=Symbol()),(e=t.forceUpdate)===null||e===void 0||e.call(t)})}function Qj(t,e){e===void 0&&(e="observed");var n=Bs.useRef(null);if(!n.current){var r={reaction:null,forceUpdate:null,stateVersion:Symbol(),name:e,subscribe:function(o){return bg.unregister(r),r.forceUpdate=o,r.reaction||(yP(r),r.forceUpdate()),function(){var v;r.forceUpdate=null,(v=r.reaction)===null||v===void 0||v.dispose(),r.reaction=null}},getSnapshot:function(){return SD?TD.stateVersion:r.stateVersion}};n.current=r}var s=n.current;s.reaction||(yP(s),bg.register(n,s,s)),Bs.useDebugValue(s.reaction,Nj),kE.useSyncExternalStore(s.subscribe,s.getSnapshot);var u,p;if(s.reaction.track(function(){try{u=t()}catch(o){p=o}}),p)throw p;return u}var AD=typeof Symbol=="function"&&Symbol.for,vP=AD?Symbol.for("react.forward_ref"):typeof We.forwardRef=="function"&&We.forwardRef(function(t){return null}).$$typeof,xP=AD?Symbol.for("react.memo"):typeof We.memo=="function"&&We.memo(function(t){return null}).$$typeof;function e8(t,e){var n;if(xP&&t.$$typeof===xP)throw new Error("[mobx-react-lite] You are trying to use `observer` on a function component wrapped in either another `observer` or `React.memo`. The observer already applies 'React.memo' for you.");var r=(n=e==null?void 0:e.forwardRef)!==null&&n!==void 0?n:!1,s=t,u=t.displayName||t.name;if(vP&&t.$$typeof===vP&&(r=!0,s=t.render,typeof s!="function"))throw new Error("[mobx-react-lite] `render` property of ForwardRef was not a function");var p=function(o,v){return Qj(function(){return s(o,v)},u)};return p.displayName=t.displayName,Object.defineProperty(p,"name",{value:t.name,writable:!0,configurable:!0}),t.contextTypes&&(p.contextTypes=t.contextTypes),r&&(p=We.forwardRef(p)),p=We.memo(p),n8(t,p),p}var t8={$$typeof:!0,render:!0,compare:!0,type:!0,displayName:!0};function n8(t,e){Object.keys(t).forEach(function(n){t8[n]||Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}globalThis&&globalThis.__read;var Bb;Fj(af.unstable_batchedUpdates);Bb=bg.finalizeAllImmediately;function CD(t,e){if(bP(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(var s=0;s<n.length;s++)if(!Object.hasOwnProperty.call(e,n[s])||!bP(t[n[s]],e[n[s]]))return!1;return!0}function bP(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}var wP=Symbol("patchMixins"),MD=Symbol("patchedDefinition");function r8(t,e){var n=t[wP]=t[wP]||{},r=n[e]=n[e]||{};return r.locks=r.locks||0,r.methods=r.methods||[],r}function EP(t,e){for(var n=this,r=arguments.length,s=new Array(r>2?r-2:0),u=2;u<r;u++)s[u-2]=arguments[u];e.locks++;try{var p;return t!=null&&(p=t.apply(this,s)),p}finally{e.locks--,e.locks===0&&e.methods.forEach(function(o){o.apply(n,s)})}}function TP(t,e){var n=function(){for(var s=arguments.length,u=new Array(s),p=0;p<s;p++)u[p]=arguments[p];EP.call.apply(EP,[this,t,e].concat(u))};return n}function SP(t,e,n){var r=r8(t,e);r.methods.indexOf(n)<0&&r.methods.push(n);var s=Object.getOwnPropertyDescriptor(t,e);if(!(s&&s[MD])){var u=t[e],p=PD(t,e,s?s.enumerable:void 0,r,u);Object.defineProperty(t,e,p)}}function PD(t,e,n,r,s){var u,p=TP(s,r);return u={},u[MD]=!0,u.get=function(){return p},u.set=function(v){if(this===t)p=TP(v,r);else{var T=PD(this,e,n,r,v);Object.defineProperty(this,e,T)}},u.configurable=!0,u.enumerable=n,u}var AP=Symbol("ObserverAdministration"),CP=Symbol("isMobXReactObserver");function wg(t){var e;return(e=t[AP])!=null?e:t[AP]={reaction:null,mounted:!1,forceUpdate:null,name:LE(t.constructor),state:void 0,props:void 0,context:void 0,propsAtom:Wm("props"),stateAtom:Wm("state"),contextAtom:Wm("context"),isUpdating:!1}}function i8(t){var e=t.prototype;if(t[CP]){var n=LE(t);console.warn("The provided component class ("+n+`)
                has already been declared as an observer component.`)}else t[CP]=!0;if(e.componentWillReact)throw new Error("The componentWillReact life-cycle event is no longer supported");if(t.__proto__!==We.PureComponent){if(!e.shouldComponentUpdate)e.shouldComponentUpdate=MP;else if(e.shouldComponentUpdate!==MP)throw new Error("It is not allowed to use shouldComponentUpdate in observer based components.")}Object.defineProperties(e,{props:a8,state:l8,context:c8});var r=e.render;if(typeof r!="function"){var s=LE(t);throw new Error("[mobx-react] class component ("+s+") is missing `render` method.\n`observer` requires `render` being a function defined on prototype.\n`render = () => {}` or `render = function() {}` is not supported.")}return e.render=function(){return Object.defineProperty(this,"render",{configurable:!1,writable:!1,value:s8.call(this,r)}),this.render()},SP(e,"componentDidMount",function(){var u=this,p=wg(this);p.mounted=!0,bg.unregister(p),p.forceUpdate=function(){return u.forceUpdate()},p.reaction||p.forceUpdate()}),SP(e,"componentWillUnmount",function(){var u,p=wg(this);(u=p.reaction)==null||u.dispose(),p.reaction=null,p.forceUpdate=null,p.mounted=!1}),t}function LE(t){return t.displayName||t.name||"<component>"}function s8(t){var e=t.bind(this),n=wg(this);function r(){n.reaction||(n.reaction=o8(n),n.mounted||bg.register(this,n,this));var s=void 0,u=void 0;if(n.reaction.track(function(){try{u=VO(!1,e)}catch(p){s=p}}),s)throw s;return u}return r}function o8(t){return new _g(t.name+".render()",function(){if(!t.isUpdating&&t.mounted)try{t.isUpdating=!0,t.forceUpdate==null||t.forceUpdate()}catch{var e;(e=t.reaction)==null||e.dispose(),t.reaction=null}finally{t.isUpdating=!1}})}function MP(t,e){return this.state!==e?!0:!CD(this.props,t)}function CS(t){var e=t+"Atom";return{configurable:!0,enumerable:!0,get:function(){var r=wg(this),s=Cx(!0);return r[e].reportObserved(),tf(s),r[t]},set:function(r){var s=wg(this);!s.isUpdating&&!CD(s[t],r)?(s[t]=r,s.isUpdating=!0,s[e].reportChanged(),s.isUpdating=!1):s[t]=r}}}var a8=CS("props"),l8=CS("state"),c8=CS("context");function ws(t){return t.isMobxInjector===!0&&console.warn("Mobx observer: You are trying to use `observer` on a component that already has `inject`. Please apply `observer` before applying `inject`"),Object.prototype.isPrototypeOf.call(We.Component,t)||Object.prototype.isPrototypeOf.call(We.PureComponent,t)?i8(t):e8(t)}Bs.version.split(".")[0];if(!We.Component)throw new Error("mobx-react requires React to be available");if(!gi)throw new Error("mobx-react requires mobx to be available");var ID={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},PP=Bs.createContext&&Bs.createContext(ID),kc=globalThis&&globalThis.__assign||function(){return kc=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},kc.apply(this,arguments)},u8=globalThis&&globalThis.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n};function RD(t){return t&&t.map(function(e,n){return Bs.createElement(e.tag,kc({key:n},e.attr),RD(e.child))})}function Kg(t){return function(e){return Bs.createElement(h8,kc({attr:kc({},t.attr)},e),RD(t.child))}}function h8(t){var e=function(n){var r=t.attr,s=t.size,u=t.title,p=u8(t,["attr","size","title"]),o=s||n.size||"1em",v;return n.className&&(v=n.className),t.className&&(v=(v?v+" ":"")+t.className),Bs.createElement("svg",kc({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,p,{className:v,style:kc(kc({color:t.color||n.color},n.style),t.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),u&&Bs.createElement("title",null,u),t.children)};return PP!==void 0?Bs.createElement(PP.Consumer,null,function(n){return e(n)}):e(ID)}function d8(t){return Kg({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"}}]})(t)}function f8(t){return Kg({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"}}]})(t)}function p8(t){return Kg({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M349.565 98.783C295.978 98.783 251.721 64 184.348 64c-24.955 0-47.309 4.384-68.045 12.013a55.947 55.947 0 0 0 3.586-23.562C118.117 24.015 94.806 1.206 66.338.048 34.345-1.254 8 24.296 8 56c0 19.026 9.497 35.825 24 45.945V488c0 13.255 10.745 24 24 24h16c13.255 0 24-10.745 24-24v-94.4c28.311-12.064 63.582-22.122 114.435-22.122 53.588 0 97.844 34.783 165.217 34.783 48.169 0 86.667-16.294 122.505-40.858C506.84 359.452 512 349.571 512 339.045v-243.1c0-23.393-24.269-38.87-45.485-29.016-34.338 15.948-76.454 31.854-116.95 31.854z"}}]})(t)}function Dv(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const MS=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),IP=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);IP&&parseFloat(IP[1]);const m8="3.3.2";function vl(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const $0=typeof process!="object"||String(process)!=="[object process]"||process.browser,g8=typeof window<"u"&&typeof window.orientation<"u",RP=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);RP&&parseFloat(RP[1]);function Eg(t){return Eg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Eg(t)}function _8(t,e){if(Eg(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Eg(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function y8(t){var e=_8(t,"string");return Eg(e)==="symbol"?e:String(e)}function K(t,e,n){return e=y8(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class v8{constructor(e,n){K(this,"name",void 0),K(this,"workerThread",void 0),K(this,"isRunning",!0),K(this,"result",void 0),K(this,"_resolve",()=>{}),K(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){vl(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){vl(this.isRunning),this.isRunning=!1,this._reject(e)}}let Ub=class{terminate(){}};const Vb=new Map;function x8(t){vl(t.source&&!t.url||!t.source&&t.url);let e=Vb.get(t.source||t.url);return e||(t.url&&(e=b8(t.url),Vb.set(t.url,e)),t.source&&(e=kD(t.source),Vb.set(t.source,e))),vl(e),e}function b8(t){if(!t.startsWith("http"))return t;const e=w8(t);return kD(e)}function kD(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function w8(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function LD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const r=n||new Set;if(t){if(kP(t))r.add(t);else if(kP(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)LD(t[s],e,r)}}return n===void 0?Array.from(r):[]}function kP(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const jb=()=>{};class OE{static isSupported(){return typeof Worker<"u"&&$0||typeof Ub<"u"&&!$0}constructor(e){K(this,"name",void 0),K(this,"source",void 0),K(this,"url",void 0),K(this,"terminated",!1),K(this,"worker",void 0),K(this,"onMessage",void 0),K(this,"onError",void 0),K(this,"_loadableURL","");const{name:n,source:r,url:s}=e;vl(r||s),this.name=n,this.source=r,this.url=s,this.onMessage=jb,this.onError=u=>console.log(u),this.worker=$0?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=jb,this.onError=jb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||LD(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=x8({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Ub(r,{eval:!1})}else if(this.source)e=new Ub(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class E8{static isSupported(){return OE.isSupported()}constructor(e){K(this,"name","unnamed"),K(this,"source",void 0),K(this,"url",void 0),K(this,"maxConcurrency",1),K(this,"maxMobileConcurrency",1),K(this,"onDebug",()=>{}),K(this,"reuseWorkers",!0),K(this,"props",{}),K(this,"jobQueue",[]),K(this,"idleQueue",[]),K(this,"count",0),K(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(u,p,o)=>u.done(o),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(u,p)=>u.error(p);const s=new Promise(u=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:u}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new v8(n.name,e);e.onMessage=s=>n.onMessage(r,s.type,s.payload),e.onError=s=>n.onError(r,s),n.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new OE({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return g8?this.maxMobileConcurrency:this.maxConcurrency}}const T8={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class ll{static isSupported(){return OE.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ll._workerFarm=ll._workerFarm||new ll({}),ll._workerFarm.setProps(e),ll._workerFarm}constructor(e){K(this,"props",void 0),K(this,"workerPools",new Map),this.props={...T8},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:s}=e;let u=this.workerPools.get(n);return u||(u=new E8({name:n,source:r,url:s}),u.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,u)),u}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}K(ll,"_workerFarm",void 0);const S8="latest";function A8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},r="".concat(t.id,"-worker.js");let s=n.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(s="modules/".concat(t.module,"/dist/").concat(r)),!s){let u=t.version;u==="latest"&&(u=S8);const p=u?"@".concat(u):"";s="https://unpkg.com/@loaders.gl/".concat(t.module).concat(p,"/dist/").concat(r)}return vl(s),s}function C8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:m8;vl(t,"no worker provided");const n=t.version;return!(!e||!n)}function M8(t,e){return!ll.isSupported()||!$0&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function P8(t,e,n,r,s){const u=t.id,p=A8(t,n),v=ll.getWorkerFarm(n).getWorkerPool({name:u,url:p});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const T=await v.startJob("process-on-worker",I8.bind(null,s));return T.postMessage("process",{input:e,options:n,context:r}),await(await T.result).result}async function I8(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:u,options:p}=r;try{const o=await t(u,p);e.postMessage("done",{id:s,result:o})}catch(o){const v=o instanceof Error?o.message:"unknown error";e.postMessage("error",{id:s,error:v})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function R8(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),s=new Uint8Array(e);for(let u=0;u<r.length;++u)if(r[u]!==s[u])return!1;return!0}function k8(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=e.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),s=r.reduce((o,v)=>o+v.byteLength,0),u=new Uint8Array(s);let p=0;for(const o of r)u.set(o,p),p+=o.byteLength;return u.buffer}async function L8(t){const e=[];for await(const n of t)e.push(n);return k8(...e)}function LP(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class OP{constructor(e,n){K(this,"name",void 0),K(this,"type",void 0),K(this,"sampleSize",1),K(this,"time",void 0),K(this,"count",void 0),K(this,"samples",void 0),K(this,"lastTiming",void 0),K(this,"lastSampleTime",void 0),K(this,"lastSampleCount",void 0),K(this,"_count",0),K(this,"_time",0),K(this,"_samples",0),K(this,"_startTime",0),K(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=LP(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(LP()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class PS{constructor(e){K(this,"id",void 0),K(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:r}=e;return this.stats[n]||(e instanceof OP?this.stats[n]=e:this.stats[n]=new OP(n,r)),this.stats[n]}}let O8="";const DP={};function D8(t){for(const e in DP)if(t.startsWith(e)){const n=DP[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(O8).concat(t)),t}function z8(t){return t&&typeof t=="object"&&t.isBuffer}function OD(t){if(z8(t))return(void 0)(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function F8(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const N8=t=>typeof t=="boolean",Hm=t=>typeof t=="function",Jg=t=>t!==null&&typeof t=="object",zP=t=>Jg(t)&&t.constructor==={}.constructor,B8=t=>t&&typeof t[Symbol.iterator]=="function",U8=t=>t&&typeof t[Symbol.asyncIterator]=="function",Bf=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Uf=t=>typeof Blob<"u"&&t instanceof Blob,V8=t=>t&&typeof t=="object"&&t.isBuffer,j8=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Jg(t)&&Hm(t.tee)&&Hm(t.cancel)&&Hm(t.getReader),G8=t=>Jg(t)&&Hm(t.read)&&Hm(t.pipe)&&N8(t.readable),DD=t=>j8(t)||G8(t),W8=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,$8=/^([-\w.]+\/[-\w.+]+)/;function H8(t){const e=$8.exec(t);return e?e[1]:t}function FP(t){const e=W8.exec(t);return e?e[1]:""}const Z8=/\?.*/;function Mx(t){if(Bf(t)){const e=Gb(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:H8(n)||FP(e)}}return Uf(t)?{url:Gb(t.name||""),type:t.type||""}:typeof t=="string"?{url:Gb(t),type:FP(t)}:{url:"",type:""}}function q8(t){return Bf(t)?t.headers["content-length"]||-1:Uf(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Gb(t){return t.replace(Z8,"")}async function zD(t){if(Bf(t))return t;const e={},n=q8(t);n>=0&&(e["content-length"]=String(n));const{url:r,type:s}=Mx(t);s&&(e["content-type"]=s);const u=await K8(t);u&&(e["x-first-bytes"]=u),typeof t=="string"&&(t=new TextEncoder().encode(t));const p=new Response(t,{headers:e});return Object.defineProperty(p,"url",{value:r}),p}async function X8(t){if(!t.ok){const e=await Y8(t);throw new Error(e)}}async function Y8(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let r=t.statusText;n.includes("application/json")&&(r+=" ".concat(await t.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function K8(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const s=new FileReader;s.onload=u=>{var p;return r(u==null||(p=u.target)===null||p===void 0?void 0:p.result)},s.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),r=J8(n);return"data:base64,".concat(r)}return null}function J8(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}async function NP(t,e){if(typeof t=="string"){t=D8(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await zD(t)}function FD(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Sl(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||FD()}const H0={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},d0=H0.window||H0.self||H0.global,ym=H0.process||{},ND=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Sl();const Wb=globalThis;function BD(t){if(!t&&!Sl())return"Node";if(FD(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const r=n.indexOf("MSIE ")!==-1,s=n.indexOf("Trident/")!==-1;return r||s?"IE":Wb.chrome?"Chrome":Wb.safari?"Safari":Wb.mozInnerScreenX?"Firefox":"Unknown"}function Q8(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class eG{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";K(this,"storage",void 0),K(this,"id",void 0),K(this,"config",void 0),this.storage=Q8(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function tG(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function nG(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function $b(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const u=t.width*n,p=t.height*n,o=["font-size:1px;","padding:".concat(Math.floor(p/2),"px ").concat(Math.floor(u/2),"px;"),"line-height:".concat(p,"px;"),"background:url(".concat(s,");"),"background-size:".concat(u,"px ").concat(p,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),o]}let zv;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(zv||(zv={}));function BP(t){return typeof t=="string"?zv[t.toUpperCase()]||zv.WHITE:t}function rG(t,e,n){return!Sl&&typeof t=="string"&&(e&&(e=BP(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=BP(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function iG(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n);for(const s of r)typeof t[s]=="function"&&(e.find(u=>s===u)||(t[s]=t[s].bind(t)))}function Fv(t,e){if(!t)throw new Error(e||"Assertion failed")}function wd(){let t;if(Sl&&"performance"in d0){var e,n;t=d0==null||(e=d0.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in ym){var r;const s=ym==null||(r=ym.hrtime)===null||r===void 0?void 0:r.call(ym);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const Ed={debug:Sl&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},sG={enabled:!0,level:0};function ro(){}const UP={},VP={once:!0};class Qg{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};K(this,"id",void 0),K(this,"VERSION",ND),K(this,"_startTs",wd()),K(this,"_deltaTs",wd()),K(this,"_storage",void 0),K(this,"userData",{}),K(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new eG("__probe-".concat(this.id,"__"),sG),this.timeStamp("".concat(this.id," started")),iG(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wd()-this._startTs).toPrecision(10))}getDelta(){return Number((wd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Fv(e,n)}warn(e){return this._getLogFunction(0,e,Ed.warn,arguments,VP)}error(e){return this._getLogFunction(0,e,Ed.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Ed.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Ed.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var r=arguments.length,s=new Array(r>2?r-2:0),u=2;u<r;u++)s[u-2]=arguments[u];return this._getLogFunction(e,n,Ed.debug||Ed.info,arguments,VP)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||ro,r&&[r],{tag:cG(n)}):ro}image(e){let{logLevel:n,priority:r,image:s,message:u="",scale:p=1}=e;return this._shouldLog(n||r)?Sl?lG({image:s,message:u,scale:p}):aG():ro}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ro)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const s=jP({logLevel:e,message:n,opts:r}),{collapsed:u}=r;return s.method=(u?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ro)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=UD(e)}_getLogFunction(e,n,r,s,u){if(this._shouldLog(e)){u=jP({logLevel:e,message:n,args:s,opts:u}),r=r||u.method,Fv(r),u.total=this.getTotal(),u.delta=this.getDelta(),this._deltaTs=wd();const p=u.tag||u.message;if(u.once)if(!UP[p])UP[p]=wd();else return ro;return n=oG(this.id,u.message,u),r.bind(console,n,...u.args)}return ro}}K(Qg,"VERSION",ND);function UD(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Fv(Number.isFinite(e)&&e>=0),e}function jP(t){const{logLevel:e,message:n}=t;t.logLevel=UD(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return Fv(s==="string"||s==="object"),Object.assign(t,{args:r},t.opts)}function oG(t,e,n){if(typeof e=="string"){const r=n.time?nG(tG(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=rG(e,n.color,n.background)}return e}function aG(t){return console.warn("removed"),ro}function lG(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const u=new Image;return u.onload=()=>{const p=$b(u,n,r);console.log(...p)},u.src=e,ro}const s=e.nodeName||"";if(s.toLowerCase()==="img")return console.log(...$b(e,n,r)),ro;if(s.toLowerCase()==="canvas"){const u=new Image;return u.onload=()=>console.log(...$b(u,n,r)),u.src=e.toDataURL(),ro}return ro}function cG(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const GP=new Qg({id:"loaders.gl"});class uG{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class hG{constructor(){K(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.error.bind(this.console,...n)}}const VD={fetch:null,mimeType:void 0,nothrow:!1,log:new hG,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:MS,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},dG={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function jD(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const GD=()=>{const t=jD();return t.globalOptions=t.globalOptions||{...VD},t.globalOptions};function fG(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],pG(t,n),gG(e,t,r)}function WD(t,e){const n=GD(),r=t||n;return typeof r.fetch=="function"?r.fetch:Jg(r.fetch)?s=>NP(s,r):e!=null&&e.fetch?e==null?void 0:e.fetch:NP}function pG(t,e){WP(t,null,VD,dG,e);for(const n of e){const r=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},u=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};WP(r,n.id,s,u,e)}}function WP(t,e,n,r,s){const u=e||"Top level",p=e?"".concat(e,"."):"";for(const o in t){const v=!e&&Jg(t[o]),T=o==="baseUri"&&!e,I=o==="workerUrl"&&e;if(!(o in n)&&!T&&!I){if(o in r)GP.warn("".concat(u," loader option '").concat(p).concat(o,"' no longer supported, use '").concat(r[o],"'"))();else if(!v){const L=mG(o,s);GP.warn("".concat(u," loader option '").concat(p).concat(o,"' not recognized. ").concat(L))()}}}}function mG(t,e){const n=t.toLowerCase();let r="";for(const s of e)for(const u in s.options){if(t===u)return"Did you mean '".concat(s.id,".").concat(u,"'?");const p=u.toLowerCase();(n.startsWith(p)||p.startsWith(n))&&(r=r||"Did you mean '".concat(s.id,".").concat(u,"'?"))}return r}function gG(t,e,n){const s={...t.options||{}};return _G(s,n),s.log===null&&(s.log=new uG),$P(s,GD()),$P(s,e),s}function $P(t,e){for(const n in e)if(n in e){const r=e[n];zP(r)&&zP(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function _G(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function IS(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function RS(t){var e,n;Dv(t,"null loader"),Dv(IS(t),"invalid loader");let r;return Array.isArray(t)&&(r=t[1],t=t[0],t={...t,options:{...t.options,...r}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const $D=()=>{const t=jD();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function yG(t){const e=$D();t=Array.isArray(t)?t:[t];for(const n of t){const r=RS(n);e.find(s=>r===s)||e.unshift(r)}}function vG(){return $D()}const xG=new Qg({id:"loaders.gl"}),bG=/\.([^.]+)$/;async function wG(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!HD(t))return null;let s=HP(t,e,{...n,nothrow:!0},r);if(s)return s;if(Uf(t)&&(t=await t.slice(0,10).arrayBuffer(),s=HP(t,e,n,r)),!s&&!(n!=null&&n.nothrow))throw new Error(ZD(t));return s}function HP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!HD(t))return null;if(e&&!Array.isArray(e))return RS(e);let s=[];e&&(s=s.concat(e)),n!=null&&n.ignoreRegisteredLoaders||s.push(...vG()),TG(s);const u=EG(t,s,n,r);if(!u&&!(n!=null&&n.nothrow))throw new Error(ZD(t));return u}function EG(t,e,n,r){const{url:s,type:u}=Mx(t),p=s||(r==null?void 0:r.url);let o=null,v="";if(n!=null&&n.mimeType&&(o=Hb(e,n==null?void 0:n.mimeType),v="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),o=o||SG(e,p),v=v||(o?"matched url ".concat(p):""),o=o||Hb(e,u),v=v||(o?"matched MIME type ".concat(u):""),o=o||CG(e,t),v=v||(o?"matched initial data ".concat(qD(t)):""),o=o||Hb(e,n==null?void 0:n.fallbackMimeType),v=v||(o?"matched fallback MIME type ".concat(u):""),v){var T;xG.log(1,"selectLoader selected ".concat((T=o)===null||T===void 0?void 0:T.name,": ").concat(v,"."))}return o}function HD(t){return!(t instanceof Response&&t.status===204)}function ZD(t){const{url:e,type:n}=Mx(t);let r="No valid loader found (";r+=e?"".concat(F8(e),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const s=t?qD(t):"";return r+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",r+=")",r}function TG(t){for(const e of t)RS(e)}function SG(t,e){const n=e&&bG.exec(e),r=n&&n[1];return r?AG(t,r):null}function AG(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Hb(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function CG(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(MG(e,n))return n}else if(ArrayBuffer.isView(e)){if(ZP(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&ZP(e,0,n))return n;return null}function MG(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function ZP(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(s=>PG(t,e,n,s))}function PG(t,e,n,r){if(r instanceof ArrayBuffer)return R8(r,t,r.byteLength);switch(typeof r){case"function":return r(t,n);case"string":const s=DE(t,e,r.length);return r===s;default:return!1}}function qD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?DE(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?DE(t,0,e):""}function DE(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let s="";for(let u=0;u<n;u++)s+=String.fromCharCode(r.getUint8(e+u));return s}const IG=256*1024;function*RG(t,e){const n=(e==null?void 0:e.chunkSize)||IG;let r=0;const s=new TextEncoder;for(;r<t.length;){const u=Math.min(t.length-r,n),p=t.slice(r,r+u);r+=u,yield s.encode(p)}}const kG=256*1024;function*LG(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{chunkSize:n=kG}=e;let r=0;for(;r<t.byteLength;){const s=Math.min(t.byteLength-r,n),u=new ArrayBuffer(s),p=new Uint8Array(t,r,s);new Uint8Array(u).set(p),r+=s,yield u}}const OG=1024*1024;async function*DG(t,e){const n=(e==null?void 0:e.chunkSize)||OG;let r=0;for(;r<t.size;){const s=r+n,u=await t.slice(r,s).arrayBuffer();r=s,yield u}}function qP(t,e){return MS?zG(t,e):FG(t)}async function*zG(t,e){const n=t.getReader();let r;try{for(;;){const s=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:u,value:p}=await s;if(u)return;yield OD(p)}}catch{n.releaseLock()}}async function*FG(t,e){for await(const n of t)yield OD(n)}function NG(t,e){if(typeof t=="string")return RG(t,e);if(t instanceof ArrayBuffer)return LG(t,e);if(Uf(t))return DG(t,e);if(DD(t))return qP(t,e);if(Bf(t))return qP(t.body,e);throw new Error("makeIterator")}const XD="Cannot convert supplied data type";function BG(t,e,n){if(e.text&&typeof t=="string")return t;if(V8(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+s)),r}throw new Error(XD)}async function UG(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return BG(t,e);if(Uf(t)&&(t=await zD(t)),Bf(t)){const s=t;return await X8(s),e.binary?await s.arrayBuffer():await s.text()}if(DD(t)&&(t=NG(t,n)),B8(t)||U8(t))return L8(t);throw new Error(XD)}function VG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(n)return n;const r={fetch:WD(e,t),...t};return Array.isArray(r.loaders)||(r.loaders=null),r}function jG(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:null}async function kS(t,e,n,r){vl(!r||typeof r=="object"),e&&!Array.isArray(e)&&!IS(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:s}=Mx(t),p=jG(e,r),o=await wG(t,p,n);return o?(n=fG(n,o,p,s),r=VG({url:s,parse:kS,loaders:p},n,r),await GG(o,t,n,r)):null}async function GG(t,e,n,r){if(C8(t),Bf(e)){const s=e,{ok:u,redirected:p,status:o,statusText:v,type:T,url:I}=s,L=Object.fromEntries(s.headers.entries());r.response={headers:L,ok:u,redirected:p,status:o,statusText:v,type:T,url:I}}if(e=await UG(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,r,t);if(M8(t,n))return await P8(t,e,n,r,kS);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);throw vl(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function zE(t,e,n,r){!Array.isArray(e)&&!IS(e)&&(n=e,e=void 0);const s=WD(n);let u=t;return typeof t=="string"&&(u=await s(t)),Uf(t)&&(u=await s(t)),await kS(u,e,n)}const WG="3.3.2",{_parseImageNode:$G}=globalThis,FE=typeof Image<"u",NE=typeof ImageBitmap<"u",HG=!!$G,BE=MS?!0:HG;function ZG(t){switch(t){case"auto":return NE||FE||BE;case"imagebitmap":return NE;case"image":return FE;case"data":return BE;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function qG(){if(NE)return"imagebitmap";if(FE)return"image";if(BE)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function XG(t){const e=KG(t);if(!e)throw new Error("Not an image");return e}function YG(t){switch(XG(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function KG(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const JG=/^data:image\/svg\+xml/,QG=/\.svg((\?|#).*)?$/;function LS(t){return t&&(JG.test(t)||QG.test(t))}function e9(t,e){if(LS(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(u){throw new Error(u.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return YD(t,e)}function YD(t,e){if(LS(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function KD(t,e,n){const r=e9(t,n),s=self.URL||self.webkitURL,u=typeof r!="string"&&s.createObjectURL(r);try{return await t9(u||r,e)}finally{u&&s.revokeObjectURL(u)}}async function t9(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,s)=>{try{n.onload=()=>r(n),n.onerror=u=>s(new Error("Could not load image ".concat(t,": ").concat(u)))}catch(u){s(u)}})}const n9={};let XP=!0;async function r9(t,e,n){let r;LS(n)?r=await KD(t,e,n):r=YD(t,n);const s=e&&e.imagebitmap;return await i9(r,s)}async function i9(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((s9(e)||!XP)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),XP=!1}return await createImageBitmap(t)}function s9(t){for(const e in t||n9)return!1;return!0}const Ia=!1,Zm=!0;function JD(t){const e=e_(t);return o9(e)||c9(e)||a9(e)||l9(e)}function o9(t){const e=e_(t);return e.byteLength>=24&&e.getUint32(0,Ia)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Ia),height:e.getUint32(20,Ia)}:null}function a9(t){const e=e_(t);return e.byteLength>=10&&e.getUint32(0,Ia)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Zm),height:e.getUint16(8,Zm)}:null}function l9(t){const e=e_(t);return e.byteLength>=14&&e.getUint16(0,Ia)===16973&&e.getUint32(2,Zm)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Zm),height:e.getUint32(22,Zm)}:null}function c9(t){const e=e_(t);if(!(e.byteLength>=3&&e.getUint16(0,Ia)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:s}=u9();let u=2;for(;u+9<e.byteLength;){const p=e.getUint16(u,Ia);if(s.has(p))return{mimeType:"image/jpeg",height:e.getUint16(u+5,Ia),width:e.getUint16(u+7,Ia)};if(!r.has(p))return null;u+=2,u+=e.getUint16(u,Ia)}return null}function u9(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function e_(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function h9(t,e){const{mimeType:n}=JD(t)||{},r=globalThis._parseImageNode;return Dv(r),await r(t,n)}async function d9(t,e,n){e=e||{};const s=(e.image||{}).type||"auto",{url:u}=n||{},p=f9(s);let o;switch(p){case"imagebitmap":o=await r9(t,e,u);break;case"image":o=await KD(t,e,u);break;case"data":o=await h9(t);break;default:Dv(!1)}return s==="data"&&(o=YG(o)),o}function f9(t){switch(t){case"auto":case"data":return qG();default:return ZG(t),t}}const p9=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],m9=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],g9={image:{type:"auto",decode:!0}},_9={id:"image",module:"images",name:"Images",version:WG,mimeTypes:m9,extensions:p9,parse:d9,tests:[t=>!!JD(new DataView(t))],options:g9},ir=new Qg({id:"deck"});let UE={};function y9(t){UE=t}function qi(t,e,n,r){ir.level>0&&UE[t]&&UE[t].call(null,e,n,r)}function v9(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const x9={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:v9,parseTextSync:JSON.parse};function b9(){const t="8.9.7",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(ir.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ir,_registerLoggers:y9},yG([x9,[_9,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const w9=b9(),Qn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Qn,"IDENTITY",{get:()=>(ir.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ka={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},VE={common:0,meters:1,pixels:2},YP={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Vt=new Qg({id:"luma.gl"});function Xi(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const E9="Invalid WebGLRenderingContext",T9="Requires WebGL2";function Px(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function _n(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function S9(t){return _n(t)?t:null}function Ix(t){return Xi(Px(t),E9),t}function Yi(t){return Xi(_n(t),T9),t}const Rm={};function A9(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function C9(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function M9(t,e){Rm[t]=!0,e!==void 0&&A9(e)}function P9(t){const e=t.getError;t.getError=function(){let r;do r=e.apply(t),r!==0&&(Rm[r]=!0);while(r!==0);for(r in Rm)if(Rm[r])return delete Rm[r],parseInt(r,10);return 0}}const t_=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const s=new t.VertexAttrib(n);this.attribs[r]=s}this.maxAttrib=0};t_.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};t_.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const gh=function(e){const n=this;this.gl=e,P9(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(u){return u===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(u){const p=n.currentVertexArrayObject;p.maxAttrib=Math.max(p.maxAttrib,u);const o=p.attribs[u];return o.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(u){const p=n.currentVertexArrayObject;p.maxAttrib=Math.max(p.maxAttrib,u);const o=p.attribs[u];return o.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(u,p){switch(u){case 34962:n.currentArrayBuffer=p;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=p;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(u,p){const v=n.currentVertexArrayObject.attribs[u];switch(p){case 34975:return v.buffer;case 34338:return v.enabled;case 34339:return v.size;case 34340:return v.stride;case 34341:return v.type;case 34922:return v.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(u,p,o,v,T,I){const L=n.currentVertexArrayObject;L.maxAttrib=Math.max(L.maxAttrib,u);const F=L.attribs[u];return F.buffer=n.currentArrayBuffer,F.size=p,F.type=o,F.normalized=v,F.stride=T,F.offset=I,F.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{C9("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};gh.prototype.VERTEX_ARRAY_BINDING_OES=34229;gh.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new t_(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};gh.prototype.createVertexArrayOES=function(){const e=new t_(this);return this.vertexArrayObjects.push(e),e};gh.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};gh.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof t_&&e.hasBeenBound&&e.ext===this)};gh.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){M9(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,s=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const u=this.currentVertexArrayObject;if(s===u)return;(!s||u.elementArrayBuffer!==s.elementArrayBuffer)&&r.bindBuffer.call(n,34963,u.elementArrayBuffer);let p=this.currentArrayBuffer;const o=Math.max(s?s.maxAttrib:0,u.maxAttrib);for(let v=0;v<=o;v++){const T=u.attribs[v],I=s?s.attribs[v]:null;if((!s||T.enabled!==I.enabled)&&(T.enabled?r.enableVertexAttribArray.call(n,v):r.disableVertexAttribArray.call(n,v)),T.enabled){let L=!1;(!s||T.buffer!==I.buffer)&&(p!==T.buffer&&(r.bindBuffer.call(n,34962,T.buffer),p=T.buffer),L=!0),(L||T.cached!==I.cached)&&r.vertexAttribPointer.call(n,v,T.size,T.type,T.normalized,T.stride,T.offset)}}this.currentArrayBuffer!==p&&r.bindBuffer.call(n,34962,this.currentArrayBuffer)};function I9(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const s=e.call(this)||[];return s.indexOf("OES_vertex_array_object")<0&&s.push("OES_vertex_array_object"),s};const n=t.getExtension;t.getExtension=function(s){const u=n.call(this,s);return u||(s!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new gh(this)),this.__OESVertexArrayObject))}}const KP="OES_element_index",JP="WEBGL_draw_buffers",R9="EXT_disjoint_timer_query",k9="EXT_disjoint_timer_query_webgl2",L9="EXT_texture_filter_anisotropic",QP="WEBGL_debug_renderer_info",O9=35723,D9=4352,z9=36795,F9=34047,N9=37445,B9=37446,sr=t=>_n(t)?void 0:0,U9={[3074]:t=>_n(t)?void 0:36064,[O9]:t=>_n(t)?void 0:D9,[35977]:sr,[32937]:sr,[z9]:(t,e)=>{const n=_n(t)?t.getExtension(k9):t.getExtension(R9);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[N9]:(t,e)=>{const n=t.getExtension(QP);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[B9]:(t,e)=>{const n=t.getExtension(QP);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[F9]:(t,e)=>{const n=t.luma.extensions[L9];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:sr,[35071]:sr,[37447]:sr,[36063]:(t,e)=>{if(!_n(t)){const n=t.getExtension(JP);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:sr,[35374]:sr,[35377]:sr,[34852]:t=>{if(!_n(t)){const e=t.getExtension(JP);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(KP)?2147483647:65535,[33001]:t=>t.getExtension(KP)?16777216:65535,[33e3]:t=>16777216,[37157]:sr,[35373]:sr,[35657]:sr,[36183]:sr,[37137]:sr,[34045]:sr,[35978]:sr,[35979]:sr,[35968]:sr,[35376]:sr,[35375]:sr,[35659]:sr,[37154]:sr,[35371]:sr,[35658]:sr,[35076]:sr,[35077]:sr,[35380]:sr};function V9(t,e,n){const r=U9[n],s=typeof r=="function"?r(t,e,n):r;return s!==void 0?s:e(n)}const j9="OES_vertex_array_object",QD="ANGLE_instanced_arrays",G9="WEBGL_draw_buffers",W9="EXT_disjoint_timer_query",$9="EXT_texture_filter_anisotropic",H9="VertexArray requires WebGL2 or OES_vertex_array_object extension";function Z9(t,e){return{webgl2:_n(t),ext:t.getExtension(e)}}const e3={[j9]:{meta:{suffix:"OES"},createVertexArray:()=>{Xi(!1,H9)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[QD]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Xi(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[G9]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Xi(!1)}},[W9]:{meta:{suffix:"EXT"},createQuery:()=>{Xi(!1)},deleteQuery:()=>{Xi(!1)},beginQuery:()=>{Xi(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},Zb={readBuffer:(t,e,n)=>{_n(t)&&e(n)},getVertexAttrib:(t,e,n,r)=>{const{webgl2:s,ext:u}=Z9(t,QD);let p;switch(r){case 35069:p=s?void 0:!1;break;case 35070:p=!s&&!u?0:void 0;break}return p!==void 0?p:e(n,r)},getProgramParameter:(t,e,n,r)=>{if(!_n(t))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,r)},getInternalformatParameter:(t,e,n,r,s)=>{if(!_n(t))switch(s){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,r,s)},getTexParameter(t,e,n,r){switch(r){case 34046:const{extensions:s}=t.luma,u=s[$9];r=u&&u.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,r)},getParameter:V9,hint(t,e,n,r){return e(n,r)}};function q9(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(I9(t),X9(t),K9(t,e3),Y9(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=q9;function X9(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function Y9(t,e){let{target:n,target2:r}=e;Object.keys(Zb).forEach(s=>{if(typeof Zb[s]=="function"){const u=t[s]?t[s].bind(t):()=>{},p=Zb[s].bind(null,t,u);n[s]=p,r[s]=p}})}function K9(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&J9(t,{extension:n,target:t.luma,target2:t})}function J9(t,e){let{extension:n,target:r,target2:s}=e;const u=e3[n];Xi(u);const{meta:p={}}=u,{suffix:o=""}=p,v=t.getExtension(n);for(const T of Object.keys(u)){const I="".concat(T).concat(o);let L=null;T==="meta"||typeof t[T]=="function"||(v&&typeof v[I]=="function"?L=function(){return v[I](...arguments)}:typeof u[T]=="function"&&(L=u[T].bind(r))),L&&(r[T]=L,s[T]=L)}}const OS={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},rc=(t,e,n)=>e?t.enable(n):t.disable(n),eI=(t,e,n)=>t.hint(n,e),Rs=(t,e,n)=>t.pixelStorei(n,e),Q9=(t,e)=>{const n=_n(t)?36009:36160;return t.bindFramebuffer(n,e)},eW=(t,e)=>t.bindFramebuffer(36008,e);function vm(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const tW={[3042]:rc,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:rc,[2885]:(t,e)=>t.cullFace(e),[2929]:rc,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:rc,[35723]:eI,[36006]:Q9,[2886]:(t,e)=>t.frontFace(e),[33170]:eI,[2849]:(t,e)=>t.lineWidth(e),[32823]:rc,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:rc,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:rc,[3088]:(t,e)=>t.scissor(...e),[2960]:rc,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:Rs,[3317]:Rs,[37440]:Rs,[37441]:Rs,[37443]:Rs,[3330]:Rs,[3332]:Rs,[3331]:Rs,[36010]:eW,[3314]:Rs,[32878]:Rs,[3316]:Rs,[3315]:Rs,[32877]:Rs,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=vm(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=vm(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=vm(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=vm(e)&&e.length===3?[...e,...e]:e;const[n,r,s,u,p,o]=e;t.stencilFuncSeparate(1028,n,r,s),t.stencilFuncSeparate(1029,u,p,o)},stencilOp:(t,e)=>{e=vm(e)&&e.length===3?[...e,...e]:e;const[n,r,s,u,p,o]=e;t.stencilOpSeparate(1028,n,r,s),t.stencilOpSeparate(1029,u,p,o)},viewport:(t,e)=>t.viewport(...e)};function Ir(t,e,n){return e[t]!==void 0?e[t]:n[t]}const nW={blendEquation:(t,e,n)=>t.blendEquationSeparate(Ir(32777,e,n),Ir(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Ir(32969,e,n),Ir(32968,e,n),Ir(32971,e,n),Ir(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Ir(32824,e,n),Ir(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Ir(32938,e,n),Ir(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Ir(2962,e,n),Ir(2967,e,n),Ir(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Ir(34816,e,n),Ir(36003,e,n),Ir(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Ir(2964,e,n),Ir(2965,e,n),Ir(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Ir(34817,e,n),Ir(34818,e,n),Ir(34819,e,n))},tI={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,r,s)=>t({[32773]:new Float32Array([e,n,r,s])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,r,s)=>t({[32969]:e,[32968]:n,[32971]:r,[32970]:s}),clearColor:(t,e,n,r,s)=>t({[3106]:new Float32Array([e,n,r,s])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,r,s)=>t({[3107]:[e,n,r,s]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,r,s)=>t({[3088]:new Int32Array([e,n,r,s])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({[2962]:e,[2967]:n,[2963]:r,[34816]:e,[36003]:n,[36004]:r}),stencilFuncSeparate:(t,e,n,r,s)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:s}),stencilOp:(t,e,n,r)=>t({[2964]:e,[2965]:n,[2966]:r,[34817]:e,[34818]:n,[34819]:r}),stencilOpSeparate:(t,e,n,r,s)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:s}),viewport:(t,e,n,r,s)=>t({[2978]:[e,n,r,s]})},Sa=(t,e)=>t.isEnabled(e),nI={[3042]:Sa,[2884]:Sa,[2929]:Sa,[3024]:Sa,[32823]:Sa,[32926]:Sa,[32928]:Sa,[3089]:Sa,[2960]:Sa,[35977]:Sa};function t3(t){for(const e in t)return!1;return!0}function rW(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}function rI(t,e){const n=t[e].bind(t);t[e]=function(){const s=arguments.length<=0?void 0:arguments[0];return s in t.state.cache?t.state.enable?t.state.cache[s]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function iW(t,e,n){const r=t[e].bind(t);t[e]=function(){for(var u=arguments.length,p=new Array(u),o=0;o<u;o++)p[o]=arguments[o];const{valueChanged:v,oldValue:T}=n(t.state._updateCache,...p);return v&&r(...p),T},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function sW(t){const e=t.useProgram.bind(t);t.useProgram=function(r){t.state.program!==r&&(e(r),t.state.program=r)}}class oW{constructor(e){let{copyState:n=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?lW(e):Object.assign({},OS),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Xi(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];xl(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const s=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const u in e){Xi(u!==void 0);const p=e[u],o=this.cache[u];rW(p,o)||(n=!0,r=o,s&&!(u in s)&&(s[u]=o),this.cache[u]=p)}return{valueChanged:n,oldValue:r}}}function n3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:r}=e;if(Xi(r!==void 0),!t.state){const{polyfillContext:s}=globalThis;s&&s(t),t.state=new oW(t,{copyState:r}),sW(t);for(const u in tI){const p=tI[u];iW(t,u,p)}rI(t,"getParameter"),rI(t,"isEnabled")}return t.state.enable=n,t}function aW(t){t.state||n3(t,{copyState:!1}),t.state.push()}function iI(t){Xi(t.state),t.state.pop()}function xl(t,e){if(Xi(Px(t),"setParameters requires a WebGL context"),t3(e))return;const n={};for(const s in e){const u=Number(s),p=tW[s];p&&(typeof p=="string"?n[p]=!0:p(t,e[s],u))}const r=t.state&&t.state.cache;if(r)for(const s in n){const u=nW[s];u(t,e,r)}}function lW(t,e){if(e=e||OS,typeof e=="number"){const s=e,u=nI[s];return u?u(t,s):t.getParameter(s)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const s of n){const u=nI[s];r[s]=u?u(t,Number(s)):t.getParameter(Number(s))}return r}function cW(t){xl(t,OS)}function Yo(t,e,n){if(t3(e))return n(t);const{nocatch:r=!0}=e;aW(t),xl(t,e);let s;if(r)s=n(t),iI(t);else try{s=n(t)}finally{iI(t)}return s}function bf(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function qb(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=bf(t),s=t.drawingBufferWidth,u=t.drawingBufferHeight;return hW(e,r,s,u,n)}function uW(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function hW(t,e,n,r,s){const u=sI(t[0],e,n);let p=oI(t[1],e,r,s),o=sI(t[0]+1,e,n);const v=o===n-1?o:o-1;o=oI(t[1]+1,e,r,s);let T;return s?(o=o===0?o:o+1,T=p,p=o):T=o===r-1?o:o-1,{x:u,y:p,width:Math.max(v-u+1,1),height:Math.max(T-p+1,1)}}function sI(t,e,n){return Math.min(Math.round(t*e),n-1)}function oI(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const DS=Sl(),dW=DS&&typeof document<"u",r3={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function i3(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Xi(DS,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},r3,t);const{width:e,height:n}=t;function r(o){if(t.throwOnError)throw new Error(o);return console.error(o),null}t.onError=r;let s;const{canvas:u}=t,p=gW({canvas:u,width:e,height:n,onError:r});return s=mW(p,t),s?(s=zS(s,t),_W(s),s):null}function zS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||yW(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},r3,e);const{manageState:n,debug:r}=e;return n&&n3(t,{copyState:!1,log:function(){for(var s=arguments.length,u=new Array(s),p=0;p<s;p++)u[p]=arguments[p];return Vt.log(1,...u)()}}),DS&&r&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Vt.level=Math.max(Vt.level,1)):Vt.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function fW(t){const e=t.getParameter(7936),n=t.getParameter(7937),r=t.getExtension("WEBGL_debug_renderer_info"),s=r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),u=r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:s||e,renderer:u||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function pW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const r=uW(e.useDevicePixels);vW(t,r,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function mW(t,e){const{onError:n}=e;let r=null;const s=v=>r=v.statusMessage||r;t.addEventListener("webglcontextcreationerror",s,!1);const{webgl1:u=!0,webgl2:p=!0}=e;let o=null;return p&&(o=o||t.getContext("webgl2",e),o=o||t.getContext("experimental-webgl2",e)),u&&(o=o||t.getContext("webgl",e),o=o||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",s,!1),o?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),o):n("Failed to create ".concat(p&&!u?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function gW(t){let{canvas:e,width:n=800,height:r=600,onError:s}=t,u;return typeof e=="string"?(dW&&document.readyState==="complete"||s("createGLContext called on canvas '".concat(e,"' before page was loaded")),u=document.getElementById(e)):e?u=e:(u=document.createElement("canvas"),u.id="lumagl-canvas",u.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",u.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(u,document.body.firstChild)),u}function _W(t){const e=_n(t)?"WebGL2":"WebGL1",n=fW(t),r=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",s=t.debug?" debug":"";Vt.info(1,"".concat(e).concat(s," context ").concat(r))()}function yW(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function vW(t,e,n){let r="width"in n?n.width:t.canvas.clientWidth,s="height"in n?n.height:t.canvas.clientHeight;(!r||!s)&&(Vt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=t.canvas.width||1,s=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const u=t.luma.canvasSizeInfo;if(u.clientWidth!==r||u.clientHeight!==s||u.devicePixelRatio!==e){let p=e;const o=Math.floor(r*p),v=Math.floor(s*p);t.canvas.width=o,t.canvas.height=v,(t.drawingBufferWidth!==o||t.drawingBufferHeight!==v)&&(Vt.warn("Device pixel ratio clamped")(),p=Math.min(t.drawingBufferWidth/r,t.drawingBufferHeight/s),t.canvas.width=Math.floor(r*p),t.canvas.height=Math.floor(s*p)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:r,clientHeight:s,devicePixelRatio:e})}}const qm="8.5.19",xW="set luma.log.level=1 (or higher) to trace rendering";class bW{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new PS({id:e})),this.stats.get(e)}}const qu=new bW;if(globalThis.luma&&globalThis.luma.VERSION!==qm)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(qm));globalThis.luma||(Sl()&&Vt.log(1,"luma.gl ".concat(qm," - ").concat(xW))(),globalThis.luma=globalThis.luma||{VERSION:qm,version:qm,log:Vt,stats:qu,globals:{modules:{},nodeIO:{}}});function wW(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function EW(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function Pt(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Xb(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const r=t[e];return Pt(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function Lc(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const Yb={};function Fc(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Yb[t]=Yb[t]||1;const e=Yb[t]++;return"".concat(t,"-").concat(e)}function aI(t){return Pt(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function wf(t){let e=!0;for(const n in t){e=!1;break}return e}function s3(t,e,n,r){const s="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),u=Object.getPrototypeOf(t);r.forEach(p=>{u.methodName||(u[p]=()=>{throw Vt.removed("Calling removed method ".concat(e,".").concat(p,": "),s)(),new Error(p)})})}const Td="Resource subclass must define virtual methods";let Al=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ix(e);const{id:r,userData:s={}}=n;this.gl=e,this.gl2=e,this.id=r||Fc(this[Symbol.toStringTag]),this.userData=s,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Xb(this.gl,e),Pt(e);const s=(this.constructor.PARAMETERS||{})[e];if(s){const u=_n(this.gl);if(!((!("webgl2"in s)||u)&&(!("extension"in s)||this.gl.getExtension(s.extension)))){const o=s.webgl1,v="webgl2"in s?s.webgl2:s.webgl1;return u?v:o}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:r}=e,s=this.constructor.PARAMETERS||{},u=_n(this.gl),p={},o=n||Object.keys(s);for(const v of o){const T=s[v];if(T&&(!("webgl2"in T)||u)&&(!("extension"in T)||this.gl.getExtension(T.extension))){const L=r?Lc(this.gl,v):v;p[L]=this.getParameter(v,e),r&&T.type==="GLenum"&&(p[L]=Lc(this.gl,p[L]))}}return p}setParameter(e,n){e=Xb(this.gl,e),Pt(e);const s=(this.constructor.PARAMETERS||{})[e];if(s){const u=_n(this.gl);if(!((!("webgl2"in s)||u)&&(!("extension"in s)||this.gl.getExtension(s.extension))))throw new Error("Parameter not available on this platform");s.type==="GLenum"&&(n=Xb(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,r){return s3(this,e,n,r)}initialize(e){}_createHandle(){throw new Error(Td)}_deleteHandle(){throw new Error(Td)}_bindHandle(e){throw new Error(Td)}_getOptsFromHandle(){throw new Error(Td)}_getParameter(e,n){throw new Error(Td)}_setParameter(e,n){throw new Error(Td)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=qu.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];qu.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const s=qu.get("Memory Usage".concat(r));s.get("GPU Memory").addCount(e),s.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=qu.get("Memory Usage".concat(n));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const TW="Failed to deduce GL constant from typed array";function jE(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(TW)}}function Tg(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function SW(t){let{data:e,width:n,height:r,bytesPerPixel:s=4,temp:u}=t;const p=n*s;u=u||new Uint8Array(p);for(let o=0;o<r/2;++o){const v=o*p,T=(r-o-1)*p;u.set(e.subarray(v,v+p)),e.copyWithin(v,T,T+p),e.set(u,T)}}function AW(t){let{data:e,width:n,height:r}=t;const s=Math.round(n/2),u=Math.round(r/2),p=new Uint8Array(s*u*4);for(let o=0;o<u;o++)for(let v=0;v<s;v++)for(let T=0;T<4;T++)p[(o*s+v)*4+T]=e[(o*2*n+v*2)*4+T];return{data:p,width:s,height:u}}function GE(t,e,n){const{removedProps:r={},deprecatedProps:s={},replacedProps:u={}}=n;for(const o in r)if(o in e){const T=r[o]?"".concat(t,".").concat(r[o]):"N/A";Vt.removed("".concat(t,".").concat(o),T)()}for(const o in s)if(o in e){const v=s[o];Vt.deprecated("".concat(t,".").concat(o),"".concat(t,".").concat(v))()}let p=null;for(const o in u)if(o in e){const v=u[o];Vt.deprecated("".concat(t,".").concat(o),"".concat(t,".").concat(v))(),p=p||Object.assign({},e),p[v]=e[o],delete p[o]}return p||e}const CW={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},MW={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class zs{static getBytesPerElement(e){return Tg(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Pt(e.size),Tg(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new zs(CW,...n)}constructor(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(s=>this._assign(s)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return zs.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return zs.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=GE("Accessor",e,MW),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const lI=10,o3={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},PW={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:o3},IW={removedProps:o3};class rr extends Al{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/zs.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/zs.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=GE("Buffer",e,PW),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=GE("Buffer",e,IW),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new zs(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:r=0,srcOffset:s=0}=e,u=e.byteLength||e.length;Pt(n);const p=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(p,this.handle),s!==0||u!==void 0?(Yi(this.gl),this.gl.bufferSubData(this.target,r,n,s,u)):this.gl.bufferSubData(p,r,n),this.gl.bindBuffer(p,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:r=0,writeOffset:s=0,size:u}=e;const{gl:p}=this;return Yi(p),p.bindBuffer(36662,n.handle),p.bindBuffer(36663,this.handle),p.copyBufferSubData(36662,36663,r,s,u),p.bindBuffer(36662,null),p.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:r=0,length:s=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Yi(this.gl);const u=Tg(this.accessor.type||5126,{clamped:!1}),p=this._getAvailableElementCount(n),o=r;let v,T;e?(T=e.length,v=T-o):(v=Math.min(p,s||p),T=o+v);const I=Math.min(p,v);return s=s||I,Pt(s<=I),e=e||new u(T),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,r,s),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:r=0,size:s}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?s!==void 0?this.gl.bindBufferRange(e,n,this.handle,r,s):(Pt(r===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(lI,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;Pt(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const s=this._getTarget();this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,this.usage),this.gl.bufferSubData(s,n,e),this.gl.bindBuffer(s,null),this.debugData=e.slice(0,lI),this.bytesUsed=r,this._trackAllocatedMemory(r);const u=jE(e);return Pt(u),this.setAccessor(new zs(this.accessor,{type:u})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Pt(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const s=this._getTarget();return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,n),this.gl.bindBuffer(s,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Tg(this.accessor.type||5126,{clamped:!1}),r=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new zs(this.accessor,{type:jE(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Vt.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Vt.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Vt.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Vt.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new zs(this.accessor,e),this}}const FS={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},a3={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},l3={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function RW(t,e){const n=FS[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const r=_n(t)&&n.gl2||n.gl1;return typeof r=="string"?t.getExtension(r):r}function kW(t,e){const n=FS[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const LW=[9729,9728],cI=globalThis.WebGLBuffer||function(){};class Ef extends Al{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:s}=n;let u=!0;return r&&(u=u&&RW(e,r),u=u&&(!s||kW(e,r))),u}constructor(e,n){const{id:r=Fc("texture"),handle:s,target:u}=n;super(e,{id:r,handle:s}),this.target=u,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(H=>this.initialize(Object.assign({},e,{pixels:H,data:H}))),this;const r=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(r&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:s=null,format:u=6408,border:p=0,recreate:o=!1,parameters:v={},pixelStore:T={},textureUnit:I=void 0}=e;n||(n=s);let{width:L,height:F,dataFormat:j,type:X,compressed:re=!1,mipmaps:de=!0}=e;const{depth:q=0}=e;return{width:L,height:F,compressed:re,dataFormat:j,type:X}=this._deduceParameters({format:u,type:X,dataFormat:j,compressed:re,data:n,width:L,height:F}),this.width=L,this.height=F,this.depth=q,this.format=u,this.type=X,this.dataFormat=j,this.border=p,this.textureUnit=I,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),de&&this._isNPOT()&&(Vt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),de=!1,this._updateForNPOT(v)),this.mipmaps=de,this.setImageData({data:n,width:L,height:F,depth:q,format:u,type:X,dataFormat:j,border:p,mipmaps:de,parameters:T,compressed:re}),de&&this.generateMipmap(),this.setParameters(v),o&&(this.data=n),r&&(this._video={video:n,parameters:v,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:r,mipmaps:s=!1}=e;return r!==this.width||n!==this.height?this.initialize({width:r,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:s}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Vt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Yo(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:r=null,level:s=0,format:u=this.format,border:p=this.border,offset:o=0,parameters:v={}}=e;let{data:T=null,type:I=this.type,width:L=this.width,height:F=this.height,dataFormat:j=this.dataFormat,compressed:X=!1}=e;T||(T=r),{type:I,dataFormat:j,compressed:X,width:L,height:F}=this._deduceParameters({format:u,type:I,dataFormat:j,compressed:X,data:T,width:L,height:F});const{gl:re}=this;re.bindTexture(this.target,this.handle);let de=null;({data:T,dataType:de}=this._getDataType({data:T,compressed:X}));let q,H=0;if(Yo(this.gl,v,()=>{switch(de){case"null":re.texImage2D(n,s,u,L,F,p,j,I,T);break;case"typed-array":re.texImage2D(n,s,u,L,F,p,j,I,T,o);break;case"buffer":q=Yi(re),q.bindBuffer(35052,T.handle||T),q.texImage2D(n,s,u,L,F,p,j,I,o),q.bindBuffer(35052,null);break;case"browser-object":_n(re)?re.texImage2D(n,s,u,L,F,p,j,I,T):re.texImage2D(n,s,u,j,I,T);break;case"compressed":for(const[J,Ee]of T.entries())re.compressedTexImage2D(n,J,Ee.format,Ee.width,Ee.height,p,Ee.data),H+=Ee.levelSize;break;default:Pt(!1,"Unknown image data type")}}),de==="compressed")this._trackAllocatedMemory(H,"Texture");else if(T&&T.byteLength)this._trackAllocatedMemory(T.byteLength,"Texture");else{const J=a3[this.dataFormat]||4,Ee=l3[this.type]||1;this._trackAllocatedMemory(this.width*this.height*J*Ee,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:r=null,data:s=null,x:u=0,y:p=0,width:o=this.width,height:v=this.height,level:T=0,format:I=this.format,type:L=this.type,dataFormat:F=this.dataFormat,compressed:j=!1,offset:X=0,border:re=this.border,parameters:de={}}=e;if({type:L,dataFormat:F,compressed:j,width:o,height:v}=this._deduceParameters({format:I,type:L,dataFormat:F,compressed:j,data:s,width:o,height:v}),Pt(this.depth===0,"texSubImage not supported for 3D textures"),s||(s=r),s&&s.data){const q=s;s=q.data,o=q.shape[0],v=q.shape[1]}s instanceof rr&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),Yo(this.gl,de,()=>{if(j)this.gl.compressedTexSubImage2D(n,T,u,p,o,v,I,s);else if(s===null)this.gl.texSubImage2D(n,T,u,p,o,v,F,L,null);else if(ArrayBuffer.isView(s))this.gl.texSubImage2D(n,T,u,p,o,v,F,L,s,X);else if(s instanceof cI){const q=Yi(this.gl);q.bindBuffer(35052,s),q.texSubImage2D(n,T,u,p,o,v,F,L,X),q.bindBuffer(35052,null)}else _n(this.gl)?Yi(this.gl).texSubImage2D(n,T,u,p,o,v,F,L,s):this.gl.texSubImage2D(n,T,u,p,F,L,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Vt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:r=!1}=e;return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof rr?{data:n.handle,dataType:"buffer"}:n instanceof cI?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:r}=e;let{width:s,height:u,dataFormat:p,type:o,compressed:v}=e;const T=FS[n];return p=p||T&&T.dataFormat,o=o||T&&T.types[0],v=v||T&&T.compressed,{width:s,height:u}=this._deduceImageSize(r,s,u),{dataFormat:p,type:o,compressed:v,width:s,height:u,format:n,data:r}}_deduceImageSize(e,n,r){let s;return typeof ImageData<"u"&&e instanceof ImageData?s={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?s={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?s={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?s={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?s={width:e.videoWidth,height:e.videoHeight}:e?s={width:n,height:r}:s={width:n>=0?n:1,height:r>=0?r:1},Pt(s,"Could not deduced texture size"),Pt(n===void 0||s.width===n,"Deduced texture width does not match supplied width"),Pt(r===void 0||s.height===r,"Deduced texture height does not match supplied height"),s}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:Pt(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return _n(this.gl)||!this.width||!this.height?!1:!aI(this.width)||!aI(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:LW.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let OW="";function DW(t,e){return Pt(typeof t=="string"),t=OW+t,new Promise((n,r)=>{try{const s=new Image;s.onload=()=>n(s),s.onerror=()=>r(new Error("Could not load image ".concat(t,"."))),s.crossOrigin=e&&e.crossOrigin||"anonymous",s.src=t}catch(s){r(s)}})}class Qo extends Ef{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Ef.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ix(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:DW(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const WE=[34069,34070,34071,34072,34073,34074];class c3 extends Ef{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ix(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:n,data:r,x:s=0,y:u=0,mipmapLevel:p=0}=e;return this._subImage({target:n,data:r,x:s,y:u,mipmapLevel:p})}async setCubeMapImageData(e){let{width:n,height:r,pixels:s,data:u,border:p=0,format:o=6408,type:v=5121}=e;const{gl:T}=this,I=s||u,L=await Promise.all(WE.map(F=>{const j=I[F];return Promise.all(Array.isArray(j)?j:[j])}));this.bind(),WE.forEach((F,j)=>{L[j].length>1&&this.opts.mipmaps!==!1&&Vt.warn("".concat(this.id," has mipmap and multiple LODs."))(),L[j].forEach((X,re)=>{n&&r?T.texImage2D(F,re,o,n,r,p,o,v,X):T.texImage2D(F,re,o,o,v,X)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:r,height:s,pixels:u,data:p,border:o=0,format:v=6408,type:T=5121}=e,{gl:I}=this,L=u||p;return this.bind(),L instanceof Promise?L.then(F=>this.setImageDataForFace(Object.assign({},e,{face:n,data:F,pixels:F}))):this.width||this.height?I.texImage2D(n,0,v,r,s,o,v,T,L):I.texImage2D(n,0,v,v,T,L),this}}c3.FACES=WE;class zW extends Ef{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return _n(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Yi(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:r=6408,width:s,height:u,depth:p=1,border:o=0,format:v,type:T=5121,offset:I=0,data:L,parameters:F={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Yo(this.gl,F,()=>{ArrayBuffer.isView(L)&&this.gl.texImage3D(this.target,n,r,s,u,p,o,v,T,L),L instanceof rr&&(this.gl.bindBuffer(35052,L.handle),this.gl.texImage3D(this.target,n,r,s,u,p,o,v,T,I))}),L&&L.byteLength)this._trackAllocatedMemory(L.byteLength,"Texture");else{const j=a3[this.dataFormat]||4,X=l3[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*j*X,"Texture")}return this.loaded=!0,this}}const zu="EXT_color_buffer_float",uI={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:zu,bpp:2},[33327]:{gl2:zu,bpp:4},[34842]:{gl2:zu,bpp:8},[33326]:{gl2:zu,bpp:4},[33328]:{gl2:zu,bpp:8},[34836]:{gl2:zu,bpp:16},[35898]:{gl2:zu,bpp:4}};function FW(t,e,n){const r=n[e];if(!r)return!1;const s=_n(t)&&r.gl2||r.gl1;return typeof s=="string"?t.getExtension(s):s}class Hd extends Al{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||FW(e,n,uI)}static getSamplesForFormat(e,n){let{format:r}=n;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:r=1,height:s=1,samples:u=0}=e;return Pt(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),u!==0&&_n(this.gl)?this.gl.renderbufferStorageMultisample(36161,u,n,r,s):this.gl.renderbufferStorage(36161,n,r,s),this.format=n,this.width=r,this.height=s,this.samples=u,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*uI[this.format].bpp),this}resize(e){let{width:n,height:r}=e;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const NW=256,BW=1024,UW=16384,hI=6144,dI=6145,fI=6146,pI=34041,u3="clear: bad arguments";function NS(t){let{framebuffer:e=null,color:n=null,depth:r=null,stencil:s=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const u={};e&&(u.framebuffer=e);let p=0;n&&(p|=UW,n!==!0&&(u.clearColor=n)),r&&(p|=NW,r!==!0&&(u.clearDepth=r)),s&&(p|=BW,r!==!0&&(u.clearStencil=r)),Pt(p!==0,u3),Yo(t,u,()=>{t.clear(p)})}function VW(t){let{framebuffer:e=null,buffer:n=hI,drawBuffer:r=0,value:s=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Yi(t),Yo(t,{framebuffer:e},()=>{switch(n){case hI:switch(s.constructor){case Int32Array:t.clearBufferiv(n,r,s);break;case Uint32Array:t.clearBufferuiv(n,r,s);break;case Float32Array:default:t.clearBufferfv(n,r,s)}break;case dI:t.clearBufferfv(dI,0,[s]);break;case fI:t.clearBufferiv(fI,0,[s]);break;case pI:const[u,p]=s;t.clearBufferfi(pI,0,u,p);break;default:Pt(!1,u3)}})}function jW(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Pt(!1),0}}function Rx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:r=0,sourceFormat:s=6408}=e;let{sourceAttachment:u=36064,target:p=null,sourceWidth:o,sourceHeight:v,sourceType:T}=e;const{framebuffer:I,deleteFramebuffer:L}=GW(t);Pt(I);const{gl:F,handle:j,attachments:X}=I;o=o||I.width,v=v||I.height,u===36064&&j===null&&(u=1028),Pt(X[u]),T=T||X[u].type,p=WW(p,T,s,o,v),T=T||jE(p);const re=F.bindFramebuffer(36160,j);return F.readPixels(n,r,o,v,s,T,p),F.bindFramebuffer(36160,re||null),L&&I.delete(),p}function mI(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Rx(t,{sourceAttachment:e}),{width:s,height:u}=t;for(;u>n;)({data:r,width:s,height:u}=AW({data:r,width:s,height:u}));SW({data:r,width:s,height:u});const p=document.createElement("canvas");p.width=s,p.height=u;const o=p.getContext("2d"),v=o.createImageData(s,u);return v.data.set(r),o.putImageData(v,0,0),p.toDataURL()}function GW(t){return t instanceof si?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:e$(t),deleteFramebuffer:!0}}function WW(t,e,n,r,s){if(t)return t;e=e||5121;const u=Tg(e,{clamped:!1}),p=jW(n);return new u(r*s*p)}const _r={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function $W(t){const e=new Qo(t,{format:6408,type:5126,dataFormat:6408}),n=new si(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),r=n.getStatus();return e.delete(),n.delete(),r===36053}const h3={[_r.WEBGL2]:[!1,!0],[_r.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[_r.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[_r.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[_r.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[_r.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[_r.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[_r.FLOAT_BLEND]:["EXT_float_blend"],[_r.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[_r.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[_r.TEXTURE_FLOAT]:["OES_texture_float",!0],[_r.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[_r.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[_r.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[_r.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[_r.COLOR_ATTACHMENT_RGBA32F]:[$W,"EXT_color_buffer_float"],[_r.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[_r.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[_r.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[_r.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[_r.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[_r.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},HW=2;function ZW(t,e){return d3(t,e)}function d3(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>f3(t,n))}function qW(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in h3)t.luma.caps[e]===void 0&&(t.luma.caps[e]=f3(t,e));return t.luma.caps}function f3(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=XW(t,e)),t.luma.caps[e]||Vt.log(HW,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function XW(t,e){const n=h3[e];Pt(n,e);let r;const s=_n(t)&&n[1]||n[0];if(typeof s=="function")r=s(t);else if(Array.isArray(s)){r=!0;for(const u of s)r=r&&!!t.getExtension(u)}else typeof s=="string"?r=!!t.getExtension(s):typeof s=="boolean"?r=s:Pt(!1);return r}const gI="Multiple render targets not supported";class si extends Al{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:s}=n;let u=!0;return r&&(u=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),s&&(u=u&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),u}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new si(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Yi(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Yi(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:r=1,attachments:s=null,color:u=!0,depth:p=!0,stencil:o=!1,check:v=!0,readBuffer:T=void 0,drawBuffers:I=void 0}=e;if(Pt(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,s)for(const L in s){const F=s[L];(Array.isArray(F)?F[0]:F).resize({width:n,height:r})}else s=this._createDefaultAttachments(u,p,o,n,r);this.update({clearAttachments:!0,attachments:s,readBuffer:T,drawBuffers:I}),s&&v&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:r,drawBuffers:s,clearAttachments:u=!1,resizeAttachments:p=!0}=e;this.attach(n,{clearAttachments:u,resizeAttachments:p});const{gl:o}=this,v=o.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),s&&this._setDrawBuffers(s),o.bindFramebuffer(36160,v||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:r}=e;if(this.handle===null)return Pt(n===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),n!==this.width&&r!==this.height&&Vt.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(r))();for(const s in this.attachments)this.attachments[s].resize({width:n,height:r});return this.width=n,this.height=r,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};n&&Object.keys(this.attachments).forEach(p=>{s[p]=null}),Object.assign(s,e);const u=this.gl.bindFramebuffer(36160,this.handle);for(const p in s){Pt(p!==void 0,"Misspelled framebuffer binding point?");const o=Number(p),v=s[o];let T=v;if(!T)this._unattach(o);else if(T instanceof Hd)this._attachRenderbuffer({attachment:o,renderbuffer:T});else if(Array.isArray(v)){const[I,L=0,F=0]=v;T=I,this._attachTexture({attachment:o,texture:I,layer:L,level:F})}else this._attachTexture({attachment:o,texture:T,layer:0,level:0});r&&T&&T.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,u||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(p=>!this.attachments[p]).forEach(p=>{delete this.attachments[p]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(KW(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:r,stencil:s,drawBuffers:u=[]}=e,p=this.gl.bindFramebuffer(36160,this.handle);return(n||r||s)&&NS(this.gl,{color:n,depth:r,stencil:s}),u.forEach((o,v)=>{VW(this.gl,{drawBuffer:v,value:o})}),this.gl.bindFramebuffer(36160,p||null),this}readPixels(){return Vt.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Vt.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Vt.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Vt.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Vt.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Vt.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:r=0,y:s=0,width:u,height:p}=e;const o=Yi(this.gl),v=o.bindFramebuffer(36008,this.handle);return r===0&&s===0&&u===void 0&&p===void 0?o.invalidateFramebuffer(36008,n):o.invalidateFramebuffer(36008,n,r,s,u,p),o.bindFramebuffer(36008,v),this}getAttachmentParameter(e,n,r){let s=this._getAttachmentParameterFallback(n);return s===null&&(this.gl.bindFramebuffer(36160,this.handle),s=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),r&&s>1e3&&(s=Lc(this.gl,s)),s}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const s={};for(const u of r){const p=n?Lc(this.gl,u):u;s[p]=this.getAttachmentParameter(e,u,n)}return s}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),r={};for(const s of n){const u=Number(s),p=e?Lc(this.gl,u):u;r[p]=this.getAttachmentParameters(u,e)}return r}show(){return typeof window<"u"&&window.open(mI(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Vt.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const r=mI(this,{targetMaxHeight:100});return Vt.image({logLevel:e,message:n,image:r},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,r,s,u){let p=null;return e&&(p=p||{},p[36064]=new Qo(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:s,height:u,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(p[36064])),n&&r?(p=p||{},p[33306]=new Hd(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:s,height:111}),this.ownResources.push(p[33306])):n?(p=p||{},p[36096]=new Hd(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:s,height:u}),this.ownResources.push(p[36096])):r&&Pt(!1),p}_unattach(e){const n=this.attachments[e];n&&(n instanceof Hd?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:r}=e;const{gl:s}=this;s.framebufferRenderbuffer(36160,n,36161,r.handle),this.attachments[n]=r}_attachTexture(e){let{attachment:n=36064,texture:r,layer:s,level:u}=e;const{gl:p}=this;switch(p.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:Yi(p).framebufferTextureLayer(36160,n,r.target,u,s);break;case 34067:const v=YW(s);p.framebufferTexture2D(36160,n,v,r.handle,u);break;case 3553:p.framebufferTexture2D(36160,n,3553,r.handle,u);break;default:Pt(!1,"Illegal texture type")}p.bindTexture(r.target,null),this.attachments[n]=r}_setReadBuffer(e){const n=S9(this.gl);n?n.readBuffer(e):Pt(e===36064||e===1029,gI),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,r=Yi(n);if(r)r.drawBuffers(e);else{const s=n.getExtension("WEBGL_draw_buffers");s?s.drawBuffersWEBGL(e):Pt(e.length===1&&(e[0]===36064||e[0]===1029),gI)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=qW(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function YW(t){return t<34069?t+34069:t}function KW(t){return(si.STATUS||{})[t]||"Framebuffer error ".concat(t)}const JW=[36049,36048,33296,33298,33299,33300,33301,33302,33303];si.ATTACHMENT_PARAMETERS=JW;function QW(t,e){Pt(t instanceof Qo||t instanceof c3||t instanceof zW);const n=t.constructor,{gl:r,width:s,height:u,format:p,type:o,dataFormat:v,border:T,mipmaps:I}=t,L=Object.assign({width:s,height:u,format:p,type:o,dataFormat:v,border:T,mipmaps:I},e);return new n(r,L)}function e$(t,e){const{gl:n,width:r,height:s,id:u}=t;return new si(n,Object.assign({},e,{id:"framebuffer-for-".concat(u),width:r,height:s,attachments:{[36064]:t}}))}function Z0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=t.match(n);return r?r[1]:e}const t$=35632,n$=35633;function r$(t){switch(t){case t$:return"fragment";case n$:return"vertex";default:return"unknown type"}}function i$(t,e,n,r){const s=t.split(/\r?\n/),u={},p={},o=r||Z0(e)||"(unnamed)",v="".concat(r$(n)," shader ").concat(o);for(let I=0;I<s.length;I++){const L=s[I];if(L.length<=1)continue;const F=L.split(":"),j=F[0],X=parseInt(F[2],10);if(isNaN(X))throw new Error("GLSL compilation error in ".concat(v,": ").concat(t));j!=="WARNING"?u[X]=L:p[X]=L}const T=s$(e);return{shaderName:v,errors:_I(u,T),warnings:_I(p,T)}}function _I(t,e){let n="";for(let r=0;r<e.length;r++){const s=e[r];if(!(!t[r+3]&&!t[r+2]&&!t[r+1])&&(n+="".concat(s,`
`),t[r+1])){const u=t[r+1],p=u.split(":",3),o=p[0],v=parseInt(p[1],10)||0,T=u.substring(p.join(":").length+1).trim();n+=p3("^^^ ".concat(o,": ").concat(T,`

`),v)}}return n}function s$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=t.split(/\r?\n/),s=String(r.length+e-1).length;return r.map((u,p)=>{const o=String(p+e),v=o.length;return p3(o,s-v)+n+u})}function p3(t,e){let n="";for(let r=0;r<e;++r)n+=" ";return"".concat(n).concat(t)}function m3(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const o$="Shader: GLSL source code must be a JavaScript string";class Sg extends Al{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Pt(!1),"unknown"}}constructor(e,n){Ix(e),Pt(typeof n.source=="string",o$);const r=Z0(n.source,null)||n.id||Fc("unnamed ".concat(Sg.getTypeName(n.shaderType)));super(e,{id:r}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const r=Z0(n,null);r&&(this.id=Fc(r)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Sg.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Z0(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:s,errors:u,warnings:p}=i$(r,this.source,this.shaderType,this.id);throw Vt.error("GLSL compilation errors in ".concat(s,`
`).concat(u))(),Vt.warn("GLSL compilation warnings in ".concat(s,`
`).concat(p))(),new Error("GLSL compilation errors in ".concat(s))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Kb extends Sg{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class Jb extends Sg{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const a$={[5126]:ur.bind(null,"uniform1fv",ks,1,Bi),[35664]:ur.bind(null,"uniform2fv",ks,2,Bi),[35665]:ur.bind(null,"uniform3fv",ks,3,Bi),[35666]:ur.bind(null,"uniform4fv",ks,4,Bi),[5124]:ur.bind(null,"uniform1iv",ic,1,Bi),[35667]:ur.bind(null,"uniform2iv",ic,2,Bi),[35668]:ur.bind(null,"uniform3iv",ic,3,Bi),[35669]:ur.bind(null,"uniform4iv",ic,4,Bi),[35670]:ur.bind(null,"uniform1iv",ic,1,Bi),[35671]:ur.bind(null,"uniform2iv",ic,2,Bi),[35672]:ur.bind(null,"uniform3iv",ic,3,Bi),[35673]:ur.bind(null,"uniform4iv",ic,4,Bi),[35674]:ur.bind(null,"uniformMatrix2fv",ks,4,il),[35675]:ur.bind(null,"uniformMatrix3fv",ks,9,il),[35676]:ur.bind(null,"uniformMatrix4fv",ks,16,il),[35678]:wi,[35680]:wi,[5125]:ur.bind(null,"uniform1uiv",f0,1,Bi),[36294]:ur.bind(null,"uniform2uiv",f0,2,Bi),[36295]:ur.bind(null,"uniform3uiv",f0,3,Bi),[36296]:ur.bind(null,"uniform4uiv",f0,4,Bi),[35685]:ur.bind(null,"uniformMatrix2x3fv",ks,6,il),[35686]:ur.bind(null,"uniformMatrix2x4fv",ks,8,il),[35687]:ur.bind(null,"uniformMatrix3x2fv",ks,6,il),[35688]:ur.bind(null,"uniformMatrix3x4fv",ks,12,il),[35689]:ur.bind(null,"uniformMatrix4x2fv",ks,8,il),[35690]:ur.bind(null,"uniformMatrix4x3fv",ks,12,il),[35678]:wi,[35680]:wi,[35679]:wi,[35682]:wi,[36289]:wi,[36292]:wi,[36293]:wi,[36298]:wi,[36299]:wi,[36300]:wi,[36303]:wi,[36306]:wi,[36307]:wi,[36308]:wi,[36311]:wi},l$={},c$={},u$={},yI=[0];function BS(t,e,n,r){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(yI[0]=t,t=yI);const s=t.length;if(s%e&&Vt.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let u=r[s];u||(u=new n(s),r[s]=u);for(let p=0;p<s;p++)u[p]=t[p];return u}function ks(t,e){return BS(t,e,Float32Array,l$)}function ic(t,e){return BS(t,e,Int32Array,c$)}function f0(t,e){return BS(t,e,Uint32Array,u$)}function vI(t,e,n){const r=a$[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}function h$(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function d$(t,e,n){for(const r in t){const s=t[r];if((!n||!!n[r])&&!f$(s))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),s),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function f$(t){return Array.isArray(t)||ArrayBuffer.isView(t)?m$(t):isFinite(t)||t===!0||t===!1||t instanceof Ef||t instanceof Hd?!0:t instanceof si?!!t.texture:!1}function p$(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const r=t[e];for(let s=0,u=n.length;s<u;++s)r[s]=n[s]}else t[e]=n.slice();else t[e]=n}function m$(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function wi(){let t=null;return(e,n,r)=>{const s=t!==r;return s&&(e.uniform1i(n,r),t=r),s}}function ur(t,e,n,r){let s=null,u=null;return(p,o,v)=>{const T=e(v,n),I=T.length;let L=!1;if(s===null)s=new Float32Array(I),u=I,L=!0;else{Pt(u===I,"Uniform length cannot change.");for(let F=0;F<I;++F)if(T[F]!==s[F]){L=!0;break}}return L&&(r(p,t,o,T),s.set(T)),L}}function Bi(t,e,n,r){t[e](n,r)}function il(t,e,n,r){t[e](n,!1,r)}const g$=5120,_$=5121,y$=5122,v$=5123,xI=0,p0=1,x$=2,b$=3,m0=4,w$=5,E$=6,ti=5126,T$=35664,S$=35665,A$=35666,xm=5124,C$=35667,M$=35668,P$=35669,bm=5125,I$=36294,R$=36295,k$=36296,L$=35670,O$=35671,D$=35672,z$=35673,F$=35674,N$=35675,B$=35676,U$=35685,V$=35686,j$=35687,G$=35688,W$=35689,$$=35690,$E={[ti]:[ti,1,"float"],[T$]:[ti,2,"vec2"],[S$]:[ti,3,"vec3"],[A$]:[ti,4,"vec4"],[xm]:[xm,1,"int"],[C$]:[xm,2,"ivec2"],[M$]:[xm,3,"ivec3"],[P$]:[xm,4,"ivec4"],[bm]:[bm,1,"uint"],[I$]:[bm,2,"uvec2"],[R$]:[bm,3,"uvec3"],[k$]:[bm,4,"uvec4"],[L$]:[ti,1,"bool"],[O$]:[ti,2,"bvec2"],[D$]:[ti,3,"bvec3"],[z$]:[ti,4,"bvec4"],[F$]:[ti,8,"mat2"],[U$]:[ti,8,"mat2x3"],[V$]:[ti,8,"mat2x4"],[N$]:[ti,12,"mat3"],[j$]:[ti,12,"mat3x2"],[G$]:[ti,12,"mat3x4"],[B$]:[ti,16,"mat4"],[W$]:[ti,16,"mat4x2"],[$$]:[ti,16,"mat4x3"]};function H$(t){switch(t){case xI:return xI;case p0:return p0;case b$:return p0;case x$:return p0;case m0:return m0;case w$:return m0;case E$:return m0;default:return Pt(!1),0}}function bI(t){const e=$E[t];if(!e)return null;const[n,r]=e;return{type:n,components:r}}function g3(t,e){switch(t){case g$:case _$:case y$:case v$:t=ti;break}for(const n in $E){const[r,s,u]=$E[n];if(r===t&&s===e)return{glType:n,name:u}}return null}class Z${constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,r=n.getProgramParameter(e.handle,35721);for(let s=0;s<r;s++){const{name:u,type:p,size:o}=n.getActiveAttrib(e.handle,s),v=n.getAttribLocation(e.handle,u);v>=0&&this._addAttribute(v,u,p,o)}this.attributeInfos.sort((s,u)=>s.location-u.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!_n(n))return;const r=n.getProgramParameter(e.handle,35971);for(let s=0;s<r;s++){const{name:u,type:p,size:o}=n.getTransformFeedbackVarying(e.handle,s);this._addVarying(s,u,p,o)}this.varyingInfos.sort((s,u)=>s.location-u.location)}_addAttribute(e,n,r,s){const{type:u,components:p}=bI(r),o={type:u,size:s*p};this._inferProperties(e,n,o);const v={location:e,name:n,accessor:new zs(o)};this.attributeInfos.push(v),this.attributeInfosByLocation[e]=v,this.attributeInfosByName[v.name]=v}_inferProperties(e,n,r){/instance/i.test(n)&&(r.divisor=1)}_addVarying(e,n,r,s){const{type:u,components:p}=bI(r),o=new zs({type:u,size:s*p}),v={location:e,name:n,accessor:o};this.varyingInfos.push(v),this.varyingInfosByName[v.name]=v}}const wI=4,q$=35981,X$=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class _3 extends Al{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",X$),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:r,fs:s,varyings:u,bufferMode:p=q$}=e;return this.hash=n||"",this.vs=typeof r=="string"?new Kb(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof s=="string"?new Jb(this.gl,{id:"".concat(e.id,"-fs"),source:s}):s,Pt(this.vs instanceof Kb),Pt(this.fs instanceof Jb),this.uniforms={},this._textureUniforms={},u&&u.length>0&&(Yi(this.gl),this.varyings=u,this.gl2.transformFeedbackVaryings(this.handle,u,p)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new Z$(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:r=4,vertexCount:s,offset:u=0,start:p,end:o,isIndexed:v=!1,indexType:T=5123,instanceCount:I=0,isInstanced:L=I>0,vertexArray:F=null,transformFeedback:j,framebuffer:X,parameters:re={},uniforms:de,samplers:q}=e;if((de||q)&&(Vt.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(de||{})),Vt.priority>=n){const H=X?X.id:"default",J="mode=".concat(Lc(this.gl,r)," verts=").concat(s," ")+"instances=".concat(I," indexType=").concat(Lc(this.gl,T)," ")+"isInstanced=".concat(L," isIndexed=").concat(v," ")+"Framebuffer=".concat(H);Vt.log(n,J)()}return Pt(F),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||s===0||L&&I===0?!1:(F.bindForDraw(s,I,()=>{if(X!==void 0&&(re=Object.assign({},re,{framebuffer:X})),j){const H=H$(r);j.begin(H)}this._bindTextures(),Yo(this.gl,re,()=>{v&&L?this.gl2.drawElementsInstanced(r,s,T,u,I):v&&_n(this.gl)&&!isNaN(p)&&!isNaN(o)?this.gl2.drawRangeElements(r,p,o,s,T,u):v?this.gl.drawElements(r,s,T,u):L?this.gl2.drawArraysInstanced(r,u,s,I):this.gl.drawArrays(r,u,s)}),j&&j.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Vt.priority>=2&&d$(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const r=e[n],s=this._uniformSetters[n];if(s){let u=r,p=!1;if(u instanceof si&&(u=u.texture),u instanceof Ef)if(p=this.uniforms[n]!==r,p){s.textureIndex===void 0&&(s.textureIndex=this._textureIndexCounter++);const o=u,{textureIndex:v}=s;o.bind(v),u=v,this._textureUniforms[n]=o}else u=s.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(s(u)||p)&&p$(this.uniforms,n,r)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const r=this._textureUniforms[n];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),r={};for(const s of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new Kb({handle:s});break;case 35632:r.fs=new Jb({handle:s});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Fc(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Vt.time(wI,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Vt.timeEnd(wI,"linkProgram for ".concat(this._getName()))(),e.debug||Vt.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const r=this.gl.getActiveUniform(this.handle,n),{name:s}=h$(r.name);let u=e.getUniformLocation(this.handle,s);if(this._uniformSetters[s]=vI(e,u,r),r.size>1)for(let p=0;p<r.size;p++)u=e.getUniformLocation(this.handle,"".concat(s,"[").concat(p,"]")),this._uniformSetters["".concat(s,"[").concat(p,"]")]=vI(e,u,r)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const Y$=34918,K$=34919,J$=35007,Q$=36795,e7=35976,t7=35887,n7=36202;class Nv extends Al{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=_n(e),s=d3(e,_r.TIMER_QUERY);let u=r||s;for(const p of n)switch(p){case"queries":u=u&&r;break;case"timers":u=u&&s;break;default:Pt(!1)}return u}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(J$)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?n7:t7)}beginTransformFeedbackQuery(){return this.begin(e7)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,K$);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(Q$)}getResult(){return this.gl2.getQueryParameter(this.handle,Y$)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,s)=>{const u=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(u)};requestAnimationFrame(u)}),this._pollingPromise}_createHandle(){return Nv.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class y3 extends Al{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return _n(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Yi(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,wf(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const r=this._getVaryingIndex(e),{buffer:s,byteSize:u,byteOffset:p}=this._getBufferParams(n);return r<0?(this.unused[e]=s,Vt.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=n,this.bindOnUse||this._bindBuffer(r,s,p,u),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,r,s;return e instanceof rr?s=e:(s=e.buffer,r=e.byteSize,n=e.byteOffset),(n!==void 0||r!==void 0)&&(n=n||0,r=r||s.byteLength-n),{buffer:s,byteOffset:n,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:r,byteOffset:s}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,s,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;const u=n&&n.handle;return!u||s===void 0?this.gl.bindBufferBase(35982,e,u):this.gl.bindBufferRange(35982,e,u,r,s),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let g0=null;function r7(t){return(!g0||g0.byteLength<t)&&(g0=new ArrayBuffer(t)),g0}function i7(t,e){const n=r7(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function s7(t){let{target:e,source:n,start:r=0,count:s=1}=t;const u=n.length,p=s*u;let o=0;for(let v=r;o<u;o++)e[v++]=n[o];for(;o<p;)o<p-o?(e.copyWithin(r+o,r,r+o),o*=2):(e.copyWithin(r+o,r,r+p-o),o=p);return e}const o7="elements must be GL.ELEMENT_ARRAY_BUFFER";class Ls extends Al{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?_n(e)||BD()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Ls(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Ls.MAX_ATTRIBUTES=Ls.MAX_ATTRIBUTES||e.getParameter(34921),Ls.MAX_ATTRIBUTES}static setConstant(e,n,r){switch(r.constructor){case Float32Array:Ls._setConstantFloatArray(e,n,r);break;case Int32Array:Ls._setConstantIntArray(e,n,r);break;case Uint32Array:Ls._setConstantUintArray(e,n,r);break;default:Pt(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Ls.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Pt(!e||e.target===34963,o7),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,r){if(n.target===34963)return this.setElementBuffer(n,r);const{size:s,type:u,stride:p,offset:o,normalized:v,integer:T,divisor:I}=r,{gl:L,gl2:F}=this;return e=Number(e),this.bind(()=>{L.bindBuffer(34962,n.handle),T?(Pt(_n(L)),F.vertexAttribIPointer(e,s,u,p,o)):L.vertexAttribPointer(e,s,u,v,p,o),L.enableVertexAttribArray(e),F.vertexAttribDivisor(e,I||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Ls.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const r=this._normalizeConstantArrayValue(n),s=r.byteLength*e,u=r.length*e;let p=!this.buffer;if(this.buffer=this.buffer||new rr(this.gl,s),p=p||this.buffer.reallocate(s),p=p||!this._compareConstantArrayValues(r,this.bufferValue),p){const o=i7(n.constructor,u);s7({target:o,source:r,start:0,count:u}),this.buffer.subData(o),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==n[r])return!1;return!0}static _setConstantFloatArray(e,n,r){switch(r.length){case 1:e.vertexAttrib1fv(n,r);break;case 2:e.vertexAttrib2fv(n,r);break;case 3:e.vertexAttrib3fv(n,r);break;case 4:e.vertexAttrib4fv(n,r);break;default:Pt(!1)}}static _setConstantIntArray(e,n,r){switch(Pt(_n(e)),r.length){case 1:e.vertexAttribI1iv(n,r);break;case 2:e.vertexAttribI2iv(n,r);break;case 3:e.vertexAttribI3iv(n,r);break;case 4:e.vertexAttribI4iv(n,r);break;default:Pt(!1)}}static _setConstantUintArray(e,n,r){switch(Pt(_n(e)),r.length){case 1:e.vertexAttribI1uiv(n,r);break;case 2:e.vertexAttribI2uiv(n,r);break;case 3:e.vertexAttribI3uiv(n,r);break;case 4:e.vertexAttribI4uiv(n,r);break;default:Pt(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:r}=n;return Pt(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const a7="VertexArray: attributes must be Buffers or constants (i.e. typed array)",l7=/^(.+)__LOCATION_([0-9]+)$/,c7=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class u7{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Ls(e),s3(this,"VertexArray","v6.0",c7),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const r=e[n];this._setAttribute(n,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,r);const{location:s,accessor:u}=this._resolveLocationAndAccessor(e,n,n.accessor,r);return s>=0&&(this.values[s]=n,this.accessors[s]=u,this.clearDrawParams(),this.vertexArrayObject.setBuffer(s,n,u)),this}setConstant(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:s,accessor:u}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},r));return s>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[s]=n,this.accessors[s]=u,this.clearDrawParams(),this.vertexArrayObject.enable(s,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new rr(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof rr&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof rr&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,r){let s;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),s=r()}),s}_resolveLocationAndAccessor(e,n,r,s){const u={location:-1,accessor:null},{location:p,name:o}=this._getAttributeIndex(e);if(!Number.isFinite(p)||p<0)return this.unused[e]=n,Vt.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),u;const v=this._getAttributeInfo(o||p);if(!v)return u;const T=this.accessors[p]||{},I=zs.resolve(v.accessor,T,r,s),{size:L,type:F}=I;return Pt(Number.isFinite(L)&&Number.isFinite(F)),{location:p,accessor:I}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const r=l7.exec(e),s=r?r[1]:e,u=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(s)+u,name:s}:{location:-1}}_setAttribute(e,n){if(n instanceof rr)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof rr){const r=n[0],s=n[1];this.setBuffer(e,r,s)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const r=n;this.setConstant(e,r)}else if(n.buffer instanceof rr){const r=n;this.setBuffer(e,r.buffer,r)}else throw new Error(a7)}_setConstantAttributes(e,n){const r=Math.max(e|0,n|0);let s=this.values[0];ArrayBuffer.isView(s)&&this._setConstantAttributeZero(s,r);for(let u=1;u<this.vertexArrayObject.MAX_ATTRIBUTES;u++)s=this.values[u],ArrayBuffer.isView(s)&&this._setConstantAttribute(u,s)}_setConstantAttributeZero(e,n){if(Ls.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,n){Ls.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const r=this.values[n],s=this.accessors[n];if(!r)return;const{divisor:u}=s,p=u>0;if(e.isInstanced=e.isInstanced||p,r instanceof rr){const o=r;if(p){const v=o.getVertexCount(s);e.instanceCount=Math.min(e.instanceCount,v)}else{const v=o.getVertexCount(s);e.vertexCount=Math.min(e.vertexCount,v)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Vt.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function h7(t,e){const{maxElts:n=16,size:r=1}=e;let s="[";for(let p=0;p<t.length&&p<n;++p)p>0&&(s+=",".concat(p%r===0?" ":"")),s+=Ag(t[p],e);const u=t.length>n?"...":"]";return"".concat(s).concat(u)}function Ag(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return h7(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return r?"0":"0.";if(r||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const s=t.toPrecision(2);return s.indexOf(".0")===s.length-2?s.slice(0,-1):s}function EI(t){let{header:e="Uniforms",program:n,uniforms:r,undefinedOnly:s=!1}=t;Pt(n);const u=".*_.*",p=".*Matrix",o=n._uniformSetters,v={},T=Object.keys(o).sort();let I=0;for(const j of T)!j.match(u)&&!j.match(p)&&Qb({table:v,header:e,uniforms:r,uniformName:j,undefinedOnly:s})&&I++;for(const j of T)j.match(p)&&Qb({table:v,header:e,uniforms:r,uniformName:j,undefinedOnly:s})&&I++;for(const j of T)v[j]||Qb({table:v,header:e,uniforms:r,uniformName:j,undefinedOnly:s})&&I++;let L=0;const F={};if(!s)for(const j in r){const X=r[j];v[j]||(L++,F[j]={Type:"NOT USED: ".concat(X),[e]:Ag(X)})}return{table:v,count:I,unusedTable:F,unusedCount:L}}function Qb(t){let{table:e,header:n,uniforms:r,uniformName:s,undefinedOnly:u}=t;const p=r[s],o=d7(p);return!u||!o?(e[s]={[n]:o?Ag(p):"N/A","Uniform Type":o?p:"NOT PROVIDED"},!0):!1}function d7(t){return t!=null}function f7(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=TI(e,e.elements,null,n));const s=e.values;for(const u in s){const p=e._getAttributeInfo(u);if(p){let o="".concat(u,": ").concat(p.name);const v=e.accessors[p.location];v&&(o="".concat(u,": ").concat(p7(p.name,v))),r[o]=TI(e,s[u],v,n)}}return r}function TI(t,e,n,r){const{gl:s}=t;if(!e)return{[r]:"null","Format ":"N/A"};let u="NOT PROVIDED",p=1,o=0,v=0,T,I,L;if(n&&(u=n.type,p=n.size,u=String(u).replace("Array",""),T=u.indexOf("nt")!==-1),e instanceof rr){const F=e,{data:j,changed:X}=F.getDebugData();I=X?"*":"",L=j,v=F.byteLength,o=v/j.BYTES_PER_ELEMENT/p;let re;if(n){const de=n.divisor>0;re="".concat(de?"I ":"P "," ").concat(o," (x").concat(p,"=").concat(v," bytes ").concat(Lc(s,u),")")}else T=!0,re="".concat(v," bytes");return{[r]:"".concat(I).concat(Ag(L,{size:p,isInteger:T})),"Format ":re}}return L=e,p=e.length,u=String(e.constructor.name).replace("Array",""),T=u.indexOf("nt")!==-1,{[r]:"".concat(Ag(L,{size:p,isInteger:T})," (constant)"),"Format ":"".concat(p,"x").concat(u," (constant)")}}function p7(t,e){const{type:n,size:r}=e,s=g3(n,r);return s?"".concat(t," (").concat(s.name,")"):t}function m7(t){const e={},n="Accessors for ".concat(t.id);for(const r of t.attributeInfos)if(r){const s=SI(r);e["in ".concat(s)]={[n]:JSON.stringify(r.accessor)}}for(const r of t.varyingInfos)if(r){const s=SI(r);e["out ".concat(s)]={[n]:JSON.stringify(r.accessor)}}return e}function SI(t){const{type:e,size:n}=t.accessor,r=g3(e,n);return r?"".concat(r.name," ").concat(t.name):t.name}const AI=Sl()&&typeof document<"u";let g7=0;class _7{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=de=>i3(de),onAddHTML:r=null,onInitialize:s=()=>{},onRender:u=()=>{},onFinalize:p=()=>{},onError:o,gl:v=null,glOptions:T={},debug:I=!1,createFramebuffer:L=!1,autoResizeViewport:F=!0,autoResizeDrawingBuffer:j=!0,stats:X=qu.get("animation-loop-".concat(g7++))}=e;let{useDevicePixels:re=!0}=e;"useDevicePixelRatio"in e&&(Vt.deprecated("useDevicePixelRatio","useDevicePixels")(),re=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:r,onInitialize:s,onRender:u,onFinalize:p,onError:o,gl:v,glOptions:T,debug:I,createFramebuffer:L},this.gl=v,this.needsRedraw=null,this.timeline=null,this.stats=X,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:F,autoResizeDrawingBuffer:j,useDevicePixels:re}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Pt(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Nv.isSupported(this.gl,["timers"])?new Nv(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):n}setViewParameters(){return Vt.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=AI?new Promise((e,n)=>{if(AI&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):EW(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):wW(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?zS(this.props.gl,e):this.onCreateContext(e),!Px(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");cW(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let r=1;const{canvas:s}=this.gl;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&pW(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new si(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const n_="vs",US="fs";function Vs(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const ew={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function y7(t){const e={};for(const n in t){const r=t[n],s=v7(r);e[n]=s}return e}function v7(t){let e=CI(t);return e==="object"?t?"type"in t?Object.assign({},t,ew[t.type]):"value"in t?(e=CI(t.value),Object.assign({type:e},t,ew[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},ew[e])}function CI(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const x7="vs",b7="fs";class MI{constructor(e){let{name:n,vs:r,fs:s,dependencies:u=[],uniforms:p,getUniforms:o,deprecations:v=[],defines:T={},inject:I={},vertexShader:L,fragmentShader:F}=e;Vs(typeof n=="string"),this.name=n,this.vs=r||L,this.fs=s||F,this.getModuleUniforms=o,this.dependencies=u,this.deprecations=this._parseDeprecationDefinitions(v),this.defines=T,this.injections=w7(I),p&&(this.uniforms=y7(p))}getModuleSource(e){let n;switch(e){case x7:n=this.vs||"";break;case b7:n=this.fs||"";break;default:Vs(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},r=this.uniforms;for(const s in r){const u=r[s];s in e&&!u.private?(u.validate&&Vs(u.validate(e[s],u),"".concat(this.name,": invalid ").concat(s)),n[s]=e[s]):n[s]=u.value}return n}}function w7(t){const e={vs:{},fs:{}};for(const n in t){let r=t[n];const s=n.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[s][n]=r}return e}function E7(t){return T7(x3(t))}function T7(t){const e={},n={};return v3({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,s)=>n[s]-n[r]).map(r=>e[r])}function v3(t){let{modules:e,level:n,moduleMap:r,moduleDepth:s}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const u of e)r[u.name]=u,(s[u.name]===void 0||s[u.name]<n)&&(s[u.name]=n);for(const u of e)u.dependencies&&v3({modules:u.dependencies,level:n+1,moduleMap:r,moduleDepth:s})}function x3(t,e){return t.map(n=>(n instanceof MI||(Vs(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),Vs(n.name,"shader module has no name"),n=new MI(n),n.dependencies=x3(n.dependencies)),n))}function S7(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",r=n.indexOf("MSIE ")!==-1,s=n.indexOf("Trident/")!==-1;return r||s}const A7=7936,C7=7937,M7=7938,P7=35724,VS={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Gu={};Object.keys(VS).forEach(t=>{Gu[t]=t});function I7(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function R7(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||A7),r=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||C7);return{gpuVendor:k7(n,r),vendor:n,renderer:r,version:t.getParameter(M7),shadingLanguageVersion:t.getParameter(P7)}}function k7(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const tw={};function PI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=VS[e];if(Vs(r,e),!S7(n))return!0;if(e in tw)return tw[e];const s=r[0],u=n.behavior||"enable",p="#extension GL_".concat(s," : ").concat(u,`
void main(void) {}`),o=t.createShader(35633);t.shaderSource(o,p),t.compileShader(o);const v=t.getShaderParameter(o,35713);return t.deleteShader(o),tw[e]=v,v}function L7(t,e){const n=VS[e];Vs(n,e);const r=I7(t)&&n[1]||n[0],s=typeof r=="string"?!!t.getExtension(r):r;return Vs(s===!1||s===!0),s}function _0(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>L7(t,n))}function O7(t){switch(R7(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function D7(t,e,n){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return _0(t,Gu.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),_0(t,Gu.GLSL_DERIVATIVES)&&PI(t,Gu.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),_0(t,Gu.GLSL_FRAG_DATA)&&PI(t,Gu.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),_0(t,Gu.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const z7=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,F7=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,N7={[n_]:z7,[US]:F7},q0="__LUMA_INJECT_DECLARATIONS__",II=/void\s+main\s*\([^)]*\)\s*\{\n?/,RI=/}\n?[^{}]*$/,nw=[];function kI(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const s=e===n_;for(const u in n){const p=n[u];p.sort((v,T)=>v.order-T.order),nw.length=p.length;for(let v=0,T=p.length;v<T;++v)nw[v]=p[v].injection;const o="".concat(nw.join(`
`),`
`);switch(u){case"vs:#decl":s&&(t=t.replace(q0,o));break;case"vs:#main-start":s&&(t=t.replace(II,v=>v+o));break;case"vs:#main-end":s&&(t=t.replace(RI,v=>o+v));break;case"fs:#decl":s||(t=t.replace(q0,o));break;case"fs:#main-start":s||(t=t.replace(II,v=>v+o));break;case"fs:#main-end":s||(t=t.replace(RI,v=>o+v));break;default:t=t.replace(u,v=>v+o)}}return t=t.replace(q0,""),r&&(t=t.replace(/\}\s*$/,u=>u+N7[e])),t}function HE(t){const e={};return Vs(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const r in n)e[r]=e[r]?"".concat(e[r],`
`).concat(n[r]):n[r]}),e}function Tf(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const b3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],B7=[...b3,[Tf("attribute"),"in $1"],[Tf("varying"),"out $1"]],U7=[...b3,[Tf("varying"),"in $1"]],w3=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],V7=[...w3,[Tf("in"),"attribute $1"],[Tf("out"),"varying $1"]],j7=[...w3,[Tf("in"),"varying $1"]],ZE="gl_FragColor",qE=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,G7=/void\s+main\s*\([^)]*\)\s*\{\n?/;function W7(t,e,n){switch(e){case 300:return n?Bv(t,B7):$7(t);case 100:return n?Bv(t,V7):H7(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Bv(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function $7(t){t=Bv(t,U7);const e=t.match(qE);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(ZE,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(G7,r=>"out vec4 ".concat(n,`;
`).concat(r)).replace(new RegExp("\\b".concat(ZE,"\\b"),"g"),n)}return t}function H7(t){t=Bv(t,j7);const e=t.match(qE);if(e){const n=e[1];t=t.replace(qE,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),ZE)}return t}const Z7=`

`.concat(q0,`

`),E3={[n_]:"vertex",[US]:"fragment"},q7=`precision highp float;

`;function X7(t,e){const{vs:n,fs:r}=e,s=E7(e.modules||[]);return{gl:t,vs:LI(t,Object.assign({},e,{source:n,type:n_,modules:s})),fs:LI(t,Object.assign({},e,{source:r,type:US,modules:s})),getUniforms:Y7(s)}}function LI(t,e){let{id:n,source:r,type:s,modules:u,defines:p={},hookFunctions:o=[],inject:v={},transpileToGLSL100:T=!1,prologue:I=!0,log:L}=e;Vs(typeof r=="string","shader source must be a string");const F=s===n_,j=r.split(`
`);let X=100,re="",de=r;j[0].indexOf("#version ")===0?(X=300,re=j[0],de=j.slice(1).join(`
`)):re="#version ".concat(X);const q={};u.forEach(Qe=>{Object.assign(q,Qe.getDefines())}),Object.assign(q,p);let H=I?"".concat(re,`
`).concat(J7({id:n,source:r,type:s}),`
`).concat(K7({type:s}),`
`).concat(O7(t),`
`).concat(D7(t),`
`).concat(Q7(q),`
`).concat(F?"":q7,`
`):"".concat(re,`
`);const J=tH(o),Ee={},ue={},Fe={};for(const Qe in v){const at=typeof v[Qe]=="string"?{injection:v[Qe],order:0}:v[Qe],rt=Qe.match(/^(v|f)s:(#)?([\w-]+)$/);if(rt){const ht=rt[2],Bt=rt[3];ht?Bt==="decl"?ue[Qe]=[at]:Fe[Qe]=[at]:Ee[Qe]=[at]}else Fe[Qe]=[at]}for(const Qe of u){L&&Qe.checkDeprecations(de,L);const at=Qe.getModuleSource(s,X);H+=at;const rt=Qe.injections[s];for(const ht in rt){const Bt=ht.match(/^(v|f)s:#([\w-]+)$/);if(Bt){const zn=Bt[2]==="decl"?ue:Fe;zn[ht]=zn[ht]||[],zn[ht].push(rt[ht])}else Ee[ht]=Ee[ht]||[],Ee[ht].push(rt[ht])}}return H+=Z7,H=kI(H,s,ue),H+=eH(J[s],Ee),H+=de,H=kI(H,s,Fe),H=W7(H,T?100:X,F),H}function Y7(t){return function(n){const r={};for(const s of t){const u=s.getUniforms(n,r);Object.assign(r,u)}return r}}function K7(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(E3[e].toUpperCase(),`
`)}function J7(t){let{id:e,source:n,type:r}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(E3[r],`

`):""}function Q7(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const r in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const s=t[r];(s||Number.isFinite(s))&&(n+="#define ".concat(r.toUpperCase()," ").concat(t[r],`
`))}return e===0&&(n+=`
`),n}function eH(t,e){let n="";for(const r in t){const s=t[r];if(n+="void ".concat(s.signature,` {
`),s.header&&(n+="  ".concat(s.header)),e[r]){const u=e[r];u.sort((p,o)=>p.order-o.order);for(const p of u)n+="  ".concat(p.injection,`
`)}s.footer&&(n+="  ".concat(s.footer)),n+=`}
`}return n}function tH(t){const e={vs:{},fs:{}};return t.forEach(n=>{let r;typeof n!="string"?(r=n,n=r.hook):r={},n=n.trim();const[s,u]=n.split(":"),p=n.replace(/\(.+/,"");e[s][p]=Object.assign(r,{signature:u})}),e}const nH="void main() {gl_FragColor = vec4(0);}",T3=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,rH=`#version 300 es
`.concat(T3);function S3(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[r,s,u]=n;if(!e.includes(r)||!s||!u)return null;const p=u.split(";")[0];return{qualifier:r,type:s,name:p}}function A3(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:r,output:s}=t;if(!n)return e===300?rH:e>300?"#version ".concat(e,`
`).concat(T3):nH;const u=oH(n,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(n,`;
out vec4 `).concat(s,`;
void main() {
  `).concat(s," = ").concat(u,`;
}`):"varying ".concat(r," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(u,`;
}`)}function iH(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Vs(!1),null}}function sH(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Vs(!1),null}}function oH(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Vs(!1),null}}const aH=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,lH={name:"fp32",vs:aH,fs:null};function OI(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Ns={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function cH(t,{precision:e=Ns.precision}={}){return t=uH(t),"".concat(parseFloat(t.toPrecision(e)))}function Sf(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function bc(t,e,n){return dH(t,r=>Math.max(e,Math.min(n,r)))}function Cg(t,e,n){return Sf(t)?t.map((r,s)=>Cg(r,e[s],n)):n*e+(1-n)*t}function Mg(t,e,n){const r=Ns.EPSILON;n&&(Ns.EPSILON=n);try{if(t===e)return!0;if(Sf(t)&&Sf(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!Mg(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Ns.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Ns.EPSILON=r}}function uH(t){return Math.round(t/Ns.EPSILON)*Ns.EPSILON}function hH(t){return t.clone?t.clone():new Array(t.length)}function dH(t,e,n){if(Sf(t)){const r=t;n=n||hH(r);for(let s=0;s<n.length&&s<r.length;++s)n[s]=e(t[s],s,n);return n}return e(t)}function fH(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class C3 extends fH(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Sf(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ns)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+cH(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Mg(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let s=0;s<this.ELEMENTS;++s){const u=e[s];this[s]=u+r*(n[s]-u)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Ns.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function pH(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ds(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function rw(t,e,n=""){if(Ns.debug&&!pH(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class mH extends C3{get x(){return this[0]}set x(e){this[0]=Ds(e)}get y(){return this[1]}set y(e){this[1]=Ds(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-e[r];n+=s*s}return Ds(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return Ds(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return OI(e>=0&&e<this.ELEMENTS,"index is out of range"),Ds(this[e])}setComponent(e,n){return OI(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var X0=1e-6,Af=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function gH(){var t=new Af(2);return Af!=Float32Array&&(t[0]=0,t[1]=0),t}function XE(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function _H(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function yH(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function vH(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function xH(t,e){return t[0]=-e[0],t[1]=-e[1],t}function M3(t,e,n,r){var s=e[0],u=e[1];return t[0]=s+r*(n[0]-s),t[1]=u+r*(n[1]-u),t}function bH(t,e,n){var r=e[0],s=e[1];return t[0]=n[0]*r+n[4]*s+n[12],t[1]=n[1]*r+n[5]*s+n[13],t}var wH=_H;(function(){var t=gH();return function(e,n,r,s,u,p){var o,v;for(n||(n=2),r||(r=0),s?v=Math.min(s*n+r,e.length):v=e.length,o=r;o<v;o+=n)t[0]=e[o],t[1]=e[o+1],u(t,t,p),e[o]=t[0],e[o+1]=t[1];return e}})();function EH(t,e,n){const r=e[0],s=e[1],u=n[3]*r+n[7]*s||1;return t[0]=(n[0]*r+n[4]*s)/u,t[1]=(n[1]*r+n[5]*s)/u,t}function P3(t,e,n){const r=e[0],s=e[1],u=e[2],p=n[3]*r+n[7]*s+n[11]*u||1;return t[0]=(n[0]*r+n[4]*s+n[8]*u)/p,t[1]=(n[1]*r+n[5]*s+n[9]*u)/p,t[2]=(n[2]*r+n[6]*s+n[10]*u)/p,t}function TH(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[2]*s,t[1]=n[1]*r+n[3]*s,t[2]=e[2],t}function SH(){var t=new Af(3);return Af!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function AH(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function CH(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function MH(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function PH(t,e,n){var r=e[0],s=e[1],u=e[2],p=n[0],o=n[1],v=n[2];return t[0]=s*v-u*o,t[1]=u*p-r*v,t[2]=r*o-s*p,t}function I3(t,e,n){var r=e[0],s=e[1],u=e[2],p=n[3]*r+n[7]*s+n[11]*u+n[15];return p=p||1,t[0]=(n[0]*r+n[4]*s+n[8]*u+n[12])/p,t[1]=(n[1]*r+n[5]*s+n[9]*u+n[13])/p,t[2]=(n[2]*r+n[6]*s+n[10]*u+n[14])/p,t}function IH(t,e,n){var r=e[0],s=e[1],u=e[2];return t[0]=r*n[0]+s*n[3]+u*n[6],t[1]=r*n[1]+s*n[4]+u*n[7],t[2]=r*n[2]+s*n[5]+u*n[8],t}function RH(t,e,n){var r=n[0],s=n[1],u=n[2],p=n[3],o=e[0],v=e[1],T=e[2],I=s*T-u*v,L=u*o-r*T,F=r*v-s*o,j=s*F-u*L,X=u*I-r*F,re=r*L-s*I,de=p*2;return I*=de,L*=de,F*=de,j*=2,X*=2,re*=2,t[0]=o+I+j,t[1]=v+L+X,t[2]=T+F+re,t}function kH(t,e,n,r){var s=[],u=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],u[0]=s[0],u[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),u[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function LH(t,e,n,r){var s=[],u=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],u[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),u[1]=s[1],u[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function OH(t,e,n,r){var s=[],u=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],u[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),u[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),u[2]=s[2],t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function DH(t,e){var n=t[0],r=t[1],s=t[2],u=e[0],p=e[1],o=e[2],v=Math.sqrt(n*n+r*r+s*s),T=Math.sqrt(u*u+p*p+o*o),I=v*T,L=I&&MH(t,e)/I;return Math.acos(Math.min(Math.max(L,-1),1))}var zH=AH;(function(){var t=SH();return function(e,n,r,s,u,p){var o,v;for(n||(n=3),r||(r=0),s?v=Math.min(s*n+r,e.length):v=e.length,o=r;o<v;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],u(t,t,p),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();const iw=[0,0,0];let y0;class Ba extends mH{static get ZERO(){return y0||(y0=new Ba(0,0,0),Object.freeze(y0)),y0}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Sf(e)?this.copy(e):(Ns.debug&&(Ds(e),Ds(n),Ds(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ns.debug&&(Ds(e.x),Ds(e.y),Ds(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ds(e)}angle(e){return DH(this,e)}cross(e){return PH(this,this,e),this.check()}rotateX({radians:e,origin:n=iw}){return kH(this,this,n,e),this.check()}rotateY({radians:e,origin:n=iw}){return LH(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=iw}){return OH(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return I3(this,this,e),this.check()}transformAsVector(e){return P3(this,this,e),this.check()}transformByMatrix3(e){return IH(this,this,e),this.check()}transformByMatrix2(e){return TH(this,this,e),this.check()}transformByQuaternion(e){return RH(this,this,e),this.check()}}class FH extends C3{toString(){let e="[";if(Ns.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=Ds(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)n[s]=this[r+s];return n}setColumn(e,n){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=n[s];return this}}function NH(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function BH(t,e){if(t===e){var n=e[1],r=e[2],s=e[3],u=e[6],p=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=u,t[11]=e[14],t[12]=s,t[13]=p,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function YE(t,e){var n=e[0],r=e[1],s=e[2],u=e[3],p=e[4],o=e[5],v=e[6],T=e[7],I=e[8],L=e[9],F=e[10],j=e[11],X=e[12],re=e[13],de=e[14],q=e[15],H=n*o-r*p,J=n*v-s*p,Ee=n*T-u*p,ue=r*v-s*o,Fe=r*T-u*o,Qe=s*T-u*v,at=I*re-L*X,rt=I*de-F*X,ht=I*q-j*X,Bt=L*de-F*re,Dn=L*q-j*re,zn=F*q-j*de,cn=H*zn-J*Dn+Ee*Bt+ue*ht-Fe*rt+Qe*at;return cn?(cn=1/cn,t[0]=(o*zn-v*Dn+T*Bt)*cn,t[1]=(s*Dn-r*zn-u*Bt)*cn,t[2]=(re*Qe-de*Fe+q*ue)*cn,t[3]=(F*Fe-L*Qe-j*ue)*cn,t[4]=(v*ht-p*zn-T*rt)*cn,t[5]=(n*zn-s*ht+u*rt)*cn,t[6]=(de*Ee-X*Qe-q*J)*cn,t[7]=(I*Qe-F*Ee+j*J)*cn,t[8]=(p*Dn-o*ht+T*at)*cn,t[9]=(r*ht-n*Dn-u*at)*cn,t[10]=(X*Fe-re*Ee+q*H)*cn,t[11]=(L*Ee-I*Fe-j*H)*cn,t[12]=(o*rt-p*Bt-v*at)*cn,t[13]=(n*Bt-r*rt+s*at)*cn,t[14]=(re*J-X*ue-de*H)*cn,t[15]=(I*ue-L*J+F*H)*cn,t):null}function UH(t){var e=t[0],n=t[1],r=t[2],s=t[3],u=t[4],p=t[5],o=t[6],v=t[7],T=t[8],I=t[9],L=t[10],F=t[11],j=t[12],X=t[13],re=t[14],de=t[15],q=e*p-n*u,H=e*o-r*u,J=e*v-s*u,Ee=n*o-r*p,ue=n*v-s*p,Fe=r*v-s*o,Qe=T*X-I*j,at=T*re-L*j,rt=T*de-F*j,ht=I*re-L*X,Bt=I*de-F*X,Dn=L*de-F*re;return q*Dn-H*Bt+J*ht+Ee*rt-ue*at+Fe*Qe}function eh(t,e,n){var r=e[0],s=e[1],u=e[2],p=e[3],o=e[4],v=e[5],T=e[6],I=e[7],L=e[8],F=e[9],j=e[10],X=e[11],re=e[12],de=e[13],q=e[14],H=e[15],J=n[0],Ee=n[1],ue=n[2],Fe=n[3];return t[0]=J*r+Ee*o+ue*L+Fe*re,t[1]=J*s+Ee*v+ue*F+Fe*de,t[2]=J*u+Ee*T+ue*j+Fe*q,t[3]=J*p+Ee*I+ue*X+Fe*H,J=n[4],Ee=n[5],ue=n[6],Fe=n[7],t[4]=J*r+Ee*o+ue*L+Fe*re,t[5]=J*s+Ee*v+ue*F+Fe*de,t[6]=J*u+Ee*T+ue*j+Fe*q,t[7]=J*p+Ee*I+ue*X+Fe*H,J=n[8],Ee=n[9],ue=n[10],Fe=n[11],t[8]=J*r+Ee*o+ue*L+Fe*re,t[9]=J*s+Ee*v+ue*F+Fe*de,t[10]=J*u+Ee*T+ue*j+Fe*q,t[11]=J*p+Ee*I+ue*X+Fe*H,J=n[12],Ee=n[13],ue=n[14],Fe=n[15],t[12]=J*r+Ee*o+ue*L+Fe*re,t[13]=J*s+Ee*v+ue*F+Fe*de,t[14]=J*u+Ee*T+ue*j+Fe*q,t[15]=J*p+Ee*I+ue*X+Fe*H,t}function Uv(t,e,n){var r=n[0],s=n[1],u=n[2],p,o,v,T,I,L,F,j,X,re,de,q;return e===t?(t[12]=e[0]*r+e[4]*s+e[8]*u+e[12],t[13]=e[1]*r+e[5]*s+e[9]*u+e[13],t[14]=e[2]*r+e[6]*s+e[10]*u+e[14],t[15]=e[3]*r+e[7]*s+e[11]*u+e[15]):(p=e[0],o=e[1],v=e[2],T=e[3],I=e[4],L=e[5],F=e[6],j=e[7],X=e[8],re=e[9],de=e[10],q=e[11],t[0]=p,t[1]=o,t[2]=v,t[3]=T,t[4]=I,t[5]=L,t[6]=F,t[7]=j,t[8]=X,t[9]=re,t[10]=de,t[11]=q,t[12]=p*r+I*s+X*u+e[12],t[13]=o*r+L*s+re*u+e[13],t[14]=v*r+F*s+de*u+e[14],t[15]=T*r+j*s+q*u+e[15]),t}function jS(t,e,n){var r=n[0],s=n[1],u=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function VH(t,e,n,r){var s=r[0],u=r[1],p=r[2],o=Math.hypot(s,u,p),v,T,I,L,F,j,X,re,de,q,H,J,Ee,ue,Fe,Qe,at,rt,ht,Bt,Dn,zn,cn,jt;return o<X0?null:(o=1/o,s*=o,u*=o,p*=o,v=Math.sin(n),T=Math.cos(n),I=1-T,L=e[0],F=e[1],j=e[2],X=e[3],re=e[4],de=e[5],q=e[6],H=e[7],J=e[8],Ee=e[9],ue=e[10],Fe=e[11],Qe=s*s*I+T,at=u*s*I+p*v,rt=p*s*I-u*v,ht=s*u*I-p*v,Bt=u*u*I+T,Dn=p*u*I+s*v,zn=s*p*I+u*v,cn=u*p*I-s*v,jt=p*p*I+T,t[0]=L*Qe+re*at+J*rt,t[1]=F*Qe+de*at+Ee*rt,t[2]=j*Qe+q*at+ue*rt,t[3]=X*Qe+H*at+Fe*rt,t[4]=L*ht+re*Bt+J*Dn,t[5]=F*ht+de*Bt+Ee*Dn,t[6]=j*ht+q*Bt+ue*Dn,t[7]=X*ht+H*Bt+Fe*Dn,t[8]=L*zn+re*cn+J*jt,t[9]=F*zn+de*cn+Ee*jt,t[10]=j*zn+q*cn+ue*jt,t[11]=X*zn+H*cn+Fe*jt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function R3(t,e,n){var r=Math.sin(n),s=Math.cos(n),u=e[4],p=e[5],o=e[6],v=e[7],T=e[8],I=e[9],L=e[10],F=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*s+T*r,t[5]=p*s+I*r,t[6]=o*s+L*r,t[7]=v*s+F*r,t[8]=T*s-u*r,t[9]=I*s-p*r,t[10]=L*s-o*r,t[11]=F*s-v*r,t}function jH(t,e,n){var r=Math.sin(n),s=Math.cos(n),u=e[0],p=e[1],o=e[2],v=e[3],T=e[8],I=e[9],L=e[10],F=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*s-T*r,t[1]=p*s-I*r,t[2]=o*s-L*r,t[3]=v*s-F*r,t[8]=u*r+T*s,t[9]=p*r+I*s,t[10]=o*r+L*s,t[11]=v*r+F*s,t}function k3(t,e,n){var r=Math.sin(n),s=Math.cos(n),u=e[0],p=e[1],o=e[2],v=e[3],T=e[4],I=e[5],L=e[6],F=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*s+T*r,t[1]=p*s+I*r,t[2]=o*s+L*r,t[3]=v*s+F*r,t[4]=T*s-u*r,t[5]=I*s-p*r,t[6]=L*s-o*r,t[7]=F*s-v*r,t}function GH(t,e){var n=e[0],r=e[1],s=e[2],u=e[3],p=n+n,o=r+r,v=s+s,T=n*p,I=r*p,L=r*o,F=s*p,j=s*o,X=s*v,re=u*p,de=u*o,q=u*v;return t[0]=1-L-X,t[1]=I+q,t[2]=F-de,t[3]=0,t[4]=I-q,t[5]=1-T-X,t[6]=j+re,t[7]=0,t[8]=F+de,t[9]=j-re,t[10]=1-T-L,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function WH(t,e,n,r,s,u,p){var o=1/(n-e),v=1/(s-r),T=1/(u-p);return t[0]=u*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u*2*v,t[6]=0,t[7]=0,t[8]=(n+e)*o,t[9]=(s+r)*v,t[10]=(p+u)*T,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*u*2*T,t[15]=0,t}function $H(t,e,n,r,s){var u=1/Math.tan(e/2),p;return t[0]=u/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(p=1/(r-s),t[10]=(s+r)*p,t[14]=2*s*r*p):(t[10]=-1,t[14]=-2*r),t}var HH=$H;function ZH(t,e,n,r,s,u,p){var o=1/(e-n),v=1/(r-s),T=1/(u-p);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*T,t[11]=0,t[12]=(e+n)*o,t[13]=(s+r)*v,t[14]=(p+u)*T,t[15]=1,t}var qH=ZH;function XH(t,e,n,r){var s,u,p,o,v,T,I,L,F,j,X=e[0],re=e[1],de=e[2],q=r[0],H=r[1],J=r[2],Ee=n[0],ue=n[1],Fe=n[2];return Math.abs(X-Ee)<X0&&Math.abs(re-ue)<X0&&Math.abs(de-Fe)<X0?NH(t):(I=X-Ee,L=re-ue,F=de-Fe,j=1/Math.hypot(I,L,F),I*=j,L*=j,F*=j,s=H*F-J*L,u=J*I-q*F,p=q*L-H*I,j=Math.hypot(s,u,p),j?(j=1/j,s*=j,u*=j,p*=j):(s=0,u=0,p=0),o=L*p-F*u,v=F*s-I*p,T=I*u-L*s,j=Math.hypot(o,v,T),j?(j=1/j,o*=j,v*=j,T*=j):(o=0,v=0,T=0),t[0]=s,t[1]=o,t[2]=I,t[3]=0,t[4]=u,t[5]=v,t[6]=L,t[7]=0,t[8]=p,t[9]=T,t[10]=F,t[11]=0,t[12]=-(s*X+u*re+p*de),t[13]=-(o*X+v*re+T*de),t[14]=-(I*X+L*re+F*de),t[15]=1,t)}function YH(){var t=new Af(4);return Af!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function KH(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function r_(t,e,n){var r=e[0],s=e[1],u=e[2],p=e[3];return t[0]=n[0]*r+n[4]*s+n[8]*u+n[12]*p,t[1]=n[1]*r+n[5]*s+n[9]*u+n[13]*p,t[2]=n[2]*r+n[6]*s+n[10]*u+n[14]*p,t[3]=n[3]*r+n[7]*s+n[11]*u+n[15]*p,t}(function(){var t=YH();return function(e,n,r,s,u,p){var o,v;for(n||(n=4),r||(r=0),s?v=Math.min(s*n+r,e.length):v=e.length,o=r;o<v;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],u(t,t,p),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();var KE;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(KE||(KE={}));const JH=45*Math.PI/180,QH=1,sw=.1,ow=500,eZ=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ua extends FH{static get IDENTITY(){return nZ()}static get ZERO(){return tZ()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return KE}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,s,u,p,o,v,T,I,L,F,j,X,re,de){return this[0]=e,this[1]=n,this[2]=r,this[3]=s,this[4]=u,this[5]=p,this[6]=o,this[7]=v,this[8]=T,this[9]=I,this[10]=L,this[11]=F,this[12]=j,this[13]=X,this[14]=re,this[15]=de,this.check()}setRowMajor(e,n,r,s,u,p,o,v,T,I,L,F,j,X,re,de){return this[0]=e,this[1]=u,this[2]=T,this[3]=j,this[4]=n,this[5]=p,this[6]=I,this[7]=X,this[8]=r,this[9]=o,this[10]=L,this[11]=re,this[12]=s,this[13]=v,this[14]=F,this[15]=de,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(eZ)}fromObject(e){return this.check()}fromQuaternion(e){return GH(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:s,top:u,near:p=sw,far:o=ow}=e;return o===1/0?rZ(this,n,r,s,u,p):WH(this,n,r,s,u,p,o),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:s=[0,1,0]}=e;return XH(this,n,r,s),this.check()}ortho(e){const{left:n,right:r,bottom:s,top:u,near:p=sw,far:o=ow}=e;return qH(this,n,r,s,u,p,o),this.check()}orthographic(e){const{fovy:n=JH,aspect:r=QH,focalDistance:s=1,near:u=sw,far:p=ow}=e;DI(n);const o=n/2,v=s*Math.tan(o),T=v*r;return this.ortho({left:-T,right:T,bottom:-v,top:v,near:u,far:p})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:s=.1,far:u=500}=e;return DI(n),HH(this,n,r,s,u),this.check()}determinant(){return UH(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),s=1/r[0],u=1/r[1],p=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*u,e[2]=this[2]*p,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*u,e[6]=this[6]*p,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*u,e[10]=this[10]*p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),s=1/r[0],u=1/r[1],p=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*u,e[2]=this[2]*p,e[3]=this[4]*s,e[4]=this[5]*u,e[5]=this[6]*p,e[6]=this[8]*s,e[7]=this[9]*u,e[8]=this[10]*p,e}transpose(){return BH(this,this),this.check()}invert(){return YE(this,this),this.check()}multiplyLeft(e){return eh(this,e,this),this.check()}multiplyRight(e){return eh(this,this,e),this.check()}rotateX(e){return R3(this,this,e),this.check()}rotateY(e){return jH(this,this,e),this.check()}rotateZ(e){return k3(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return VH(this,this,e,n),this.check()}scale(e){return jS(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Uv(this,this,e),this.check()}transform(e,n){return e.length===4?(n=r_(n||[-0,-0,-0,-0],e,this),rw(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let s;switch(r){case 2:s=bH(n||[-0,-0],e,this);break;case 3:s=I3(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rw(s,e.length),s}transformAsVector(e,n){let r;switch(e.length){case 2:r=EH(n||[-0,-0],e,this);break;case 3:r=P3(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rw(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let v0,x0;function tZ(){return v0||(v0=new Ua([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(v0)),v0}function nZ(){return x0||(x0=new Ua,Object.freeze(x0)),x0}function DI(t){if(t>Math.PI*2)throw Error("expected radians")}function rZ(t,e,n,r,s,u){const p=2*u/(n-e),o=2*u/(s-r),v=(n+e)/(n-e),T=(s+r)/(s-r),I=-1,L=-1,F=-2*u;return t[0]=p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=v,t[9]=T,t[10]=I,t[11]=L,t[12]=0,t[13]=0,t[14]=F,t[15]=0,t}const iZ=new Uint8Array([0,255,255,255]),sZ={pickingSelectedColor:null,pickingHighlightColor:iZ,pickingActive:!1,pickingAttribute:!1};function oZ(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sZ;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const aZ=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,lZ=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,cZ={name:"picking",vs:aZ,fs:lZ,getUniforms:oZ},uZ=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,hZ={name:"transform",vs:uZ,fs:null};class i_{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new i_(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:r="",defines:s={},inject:u={},varyings:p=[],bufferMode:o=35981,transpileToGLSL100:v=!1}=e,T=this._getModuleList(e.modules),I=this._getHash(n),L=this._getHash(r),F=T.map(J=>this._getHash(J.name)).sort(),j=p.map(J=>this._getHash(J)),X=Object.keys(s).sort(),re=Object.keys(u).sort(),de=[],q=[];for(const J of X)de.push(this._getHash(J)),de.push(this._getHash(s[J]));for(const J of re)q.push(this._getHash(J)),q.push(this._getHash(u[J]));const H="".concat(I,"/").concat(L,"D").concat(de.join("/"),"M").concat(F.join("/"),"I").concat(q.join("/"),"V").concat(j.join("/"),"H").concat(this.stateHash,"B").concat(o).concat(v?"T":"");if(!this._programCache[H]){const J=X7(this.gl,{vs:n,fs:r,modules:T,inject:u,defines:s,hookFunctions:this._hookFunctions,transpileToGLSL100:v});this._programCache[H]=new _3(this.gl,{hash:H,vs:J.vs,fs:J.fs,varyings:p,bufferMode:o}),this._getUniforms[H]=J.getUniforms||(Ee=>{}),this._useCounts[H]=0}return this._useCounts[H]++,this._programCache[H]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),r={};let s=0;for(let u=0,p=this._defaultModules.length;u<p;++u){const o=this._defaultModules[u],v=o.name;n[s++]=o,r[v]=!0}for(let u=0,p=e.length;u<p;++u){const o=e[u],v=o.name;r[v]||(n[s++]=o,r[v]=!0)}return n.length=s,n}}const dZ={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function fZ(t,e,n){const r={};let s=e.indices;for(const u in e.attributes){const p=e.attributes[u],o=pZ(u,n);if(u==="indices")s=p;else if(p.constant)r[o]=p.value;else{const v=p.value,T={...p};delete T.value,r[o]=[new rr(t,v),T],mZ(u,T)}}if(s){const u=s.value||s;Pt(u instanceof Uint16Array||u instanceof Uint32Array,'attribute array for "indices" must be of integer type');const p={size:1,isIndexed:s.isIndexed===void 0?!0:s.isIndexed};r.indices=[new rr(t,{data:u,target:34963}),p]}return r}function pZ(t,e){const{attributeMap:n=dZ}=e||{};return n&&n[t]||t}function mZ(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}Pt(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Sd=2,gZ=1e4,_Z="Model needs drawMode and vertexCount",zI=()=>{},yZ={};class L3{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=Fc("model")}=n;Pt(Px(e)),this.id=r,this.gl=e,this.id=n.id||Fc("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||i_.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:r,fs:s,modules:u,defines:p,inject:o,varyings:v,bufferMode:T,transpileToGLSL100:I}=e;this.programProps={program:n,vs:r,fs:s,modules:u,defines:p,inject:o,varyings:v,bufferMode:T,transpileToGLSL100:I},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Pt(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),_Z)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:r,fs:s,modules:u,defines:p,inject:o,varyings:v,bufferMode:T,transpileToGLSL100:I}=e;this.programProps={program:n,vs:r,fs:s,modules:u,defines:p,inject:o,varyings:v,bufferMode:T,transpileToGLSL100:I},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Pt(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Pt(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=fZ(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(wf(e))return this;const n={};for(const r in e){const s=e[r];n[r]=s.getValue?s.getValue():s}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return NS(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:r,uniforms:s={},attributes:u={},transformFeedback:p=this.transformFeedback,parameters:o={},vertexArray:v=this.vertexArray}=e;this.setAttributes(u),this.updateModuleSettings(n),this.setUniforms(s);let T;Vt.priority>=Sd&&(T=this._logDrawCallStart(Sd));const I=this.vertexArray.getDrawParams(),{isIndexed:L=I.isIndexed,indexType:F=I.indexType,indexOffset:j=I.indexOffset,vertexArrayInstanced:X=I.isInstanced}=this.props;X&&!this.isInstanced&&Vt.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:re,instanceCount:de}=this,{onBeforeRender:q=zI,onAfterRender:H=zI}=this.props;q(),this.program.setUniforms(this.uniforms);const J=this.program.draw(Object.assign(yZ,e,{logPriority:T,uniforms:null,framebuffer:r,parameters:o,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:v,transformFeedback:p,isIndexed:L,indexType:F,isInstanced:re,instanceCount:de,offset:L?j:0}));return H(),Vt.priority>=Sd&&this._logDrawCallEnd(T,v,r),J}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:r,unbindModels:s=[]}=e;let{parameters:u}=e;r&&this._setFeedbackBuffers(r),n&&(u=Object.assign({},u,{[35977]:n})),s.forEach(p=>p.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:u}))}finally{s.forEach(p=>p.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Vt.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:r,fs:s,modules:u,inject:p,defines:o,varyings:v,bufferMode:T,transpileToGLSL100:I}=this.programProps;n=this.programManager.get({vs:r,fs:s,modules:u,inject:p,defines:o,varyings:v,bufferMode:T,transpileToGLSL100:I}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Pt(n instanceof _3,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new u7(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof rr&&n.delete()}}_setAnimationProps(e){this.animated&&Pt(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(wf(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new y3(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:gZ;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Vt.group(Sd,">>> DRAWING MODEL ".concat(this.id),{collapsed:Vt.level<=2})(),e}_logDrawCallEnd(e,n,r,s){if(e===void 0)return;const u=f7({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:p,unusedTable:o,unusedCount:v}=EI({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:T,count:I}=EI({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});I>0&&Vt.log("MISSING UNIFORMS",Object.keys(T))(),v>0&&Vt.log("UNUSED UNIFORMS",Object.keys(o))();const L=m7(this.vertexArray.configuration);Vt.table(e,u)(),Vt.table(e,p)(),Vt.table(e+1,L)(),s&&s.log({logLevel:Sd,message:"Rendered to ".concat(s.id)}),Vt.groupEnd(Sd)()}}class vZ{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:s}=n;return{attributes:Object.assign({},r,e.attributes),transformFeedback:s}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],r=e?n[e]:null;return r?r instanceof rr?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,r=this.getBuffer(n);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Pt(_n(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const s in this.feedbackMap){const u=this.feedbackMap[s];s in n&&(r[u]=s)}Object.assign(r,e.feedbackBuffers);for(const s in r){const u=r[s];if(typeof u=="string"){const p=n[u],{byteLength:o,usage:v,accessor:T}=p;r[s]=this._createNewBuffer(s,{byteLength:o,usage:v,accessor:T})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:r})}_setupTransformFeedback(e,n){let{model:r}=n;const{program:s}=r;e.transformFeedback=new y3(this.gl,{program:s,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceBuffers:n,feedbackBuffers:r})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const s in this.feedbackMap){const u=this.feedbackMap[s];n[s]=e.feedbackBuffers[u],r[u]=e.sourceBuffers[s],Pt(r[u]instanceof rr)}return{sourceBuffers:n,feedbackBuffers:r}}_createNewBuffer(e,n){const r=new rr(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const xZ="transform_uSampler_",Vv="transform_uSize_",FI="transform_position";function bZ(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:r,targetTexture:s}=t,p=Object.keys(n).length,o=null;const v={};let T=e,I={};if(p>0||r){const L=T.split(`
`),F=L.slice();if(L.forEach((j,X,re)=>{if(p>0){const de=AZ(j,n);if(de){const{updatedLine:q,inject:H}=de;F[X]=q,I=HE([I,H]),Object.assign(v,de.samplerTextureMap),p--}}r&&!o&&(o=SZ(j,r))}),r){Pt(s);const j="".concat(Vv).concat(r),X="uniform vec2 ".concat(j,`;
`),re="     vec2 ".concat(FI," = transform_getPos(").concat(j,`);
     gl_Position = vec4(`).concat(FI,`, 0, 1.);
`);I=HE([I,{"vs:#decl":X,"vs:#main-start":re}])}T=F.join(`
`)}return{vs:T,targetTextureType:o,inject:I,samplerTextureMap:v}}function wZ(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:r}=t;const s={};let u,p;n&&({width:u,height:p}=r,s["".concat(Vv).concat(n)]=[u,p]);for(const o in e)({width:u,height:p}=e[o]),s["".concat(Vv).concat(o)]=[u,p];return s}function EZ(t){return S3(t,["attribute","in"])}function TZ(t){const e="".concat(xZ).concat(t),n="".concat(Vv).concat(t),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:r}}function SZ(t,e){const n=S3(t,["varying","out"]);return n&&n.name===e?n.type:null}function AZ(t,e){const n={},r=EZ(t);if(!r)return null;const{type:s,name:u}=r;if(u&&e[u]){const p="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:o,sizeName:v,uniformDeclerations:T}=TZ(u),I=iH(s),L="  ".concat(s," ").concat(u," = transform_getInput(").concat(o,", ").concat(v,").").concat(I,`;
`);return n[o]=u,{updatedLine:p,inject:{"vs:#decl":T,"vs:#main-start":L},samplerTextureMap:n}}return null}const CZ={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},MZ="transform_output";class PZ{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:r,framebuffer:s,targetTexture:u}=this.bindings[this.currentIndex],p=Object.assign({},n,e.attributes),o=Object.assign({},e.uniforms),v=Object.assign({},e.parameters);let T=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){p.transform_elementID=this.elementIDBuffer;for(const L in this.samplerTextureMap){const F=this.samplerTextureMap[L];o[L]=r[F]}this._setSourceTextureParameters();const I=wZ({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:u});Object.assign(o,I)}return this.hasTargetTexture&&(T=!1,v.viewport=[0,0,s.width,s.height]),{attributes:p,framebuffer:s,uniforms:o,discard:T,parameters:v}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],r=Rx(n);if(!e)return r;const s=r.constructor,u=sH(this.targetTextureType),p=new s(r.length*u/4);let o=0;for(let v=0;v<r.length;v+=4)for(let T=0;T<u;T++)p[o++]=r[v+T];return p}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:r}=e;if(r instanceof Qo)return r;const s=n[r];return s?(this._targetRefTexName=r,this._createNewTexture(s)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:r={},_targetTexture:s}=e,u=this._createTargetTexture({sourceTextures:r,textureOrReference:s});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:r,targetTexture:u}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((r,s,u)=>{u[s]=s}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new rr(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceTextures:n,targetTexture:r})}}_updateBinding(e,n){const{sourceBuffers:r,sourceTextures:s,targetTexture:u}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,s),Object.assign(e.sourceBuffers,r),u){e.targetTexture=u;const{width:p,height:o}=u,{framebuffer:v}=e;v?(v.update({attachments:{[36064]:u},resizeAttachments:!1}),v.resize({width:p,height:o})):e.framebuffer=new si(this.gl,{id:"transform-framebuffer",width:p,height:o,attachments:{[36064]:u}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const r in n)n[r].setParameters(CZ)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:r}}_createNewTexture(e){const n=QW(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:r}=this.bindings[this.currentIndex],{vs:s,uniforms:u,targetTextureType:p,inject:o,samplerTextureMap:v}=bZ({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),T=HE([e.inject||{},o]);this.targetTextureType=p,this.samplerTextureMap=v;const I=e._fs||A3({version:m3(s),input:this.targetTextureVarying,inputType:p,output:MZ}),L=this.hasSourceTextures||this.targetTextureVarying?[hZ].concat(e.modules||[]):e.modules;return{vs:s,fs:I,modules:L,uniforms:u,inject:T}}}class GS{static isSupported(e){return _n(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:r}=this;e&&e.delete(),n&&n.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,r=this._updateDrawOptions(e);n&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)e=e||r.swap();Pt(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n){const s=r.getData(e);if(s)return s}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new L3(n,Object.assign({},e,{fs:e.fs||A3({version:m3(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of r)n=s.updateModelProps(n);return n}_buildResourceTransforms(e,n){IZ(n)&&(this.bufferTransform=new vZ(e,n)),RZ(n)&&(this.textureTransform=new PZ(e,n)),Pt(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of r)n=Object.assign(n,s.getDrawOptions(n));return n}}function IZ(t){return!!(!wf(t.feedbackBuffers)||!wf(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function RZ(t){return!!(!wf(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const NI={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class kZ{static get DRAW_MODE(){return NI}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Fc("geometry"),drawMode:r=NI.TRIANGLES,attributes:s={},indices:u=null,vertexCount:p=null}=e;this.id=n,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(s,u),this.vertexCount=p||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const r in e){let s=e[r];s=ArrayBuffer.isView(s)?{value:s}:s,Pt(ArrayBuffer.isView(s.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!s.size&&(s.size=3),r==="indices"?(Pt(!this.indices),this.indices=s):this.attributes[r]=s}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const s in e){const u=e[s],{value:p,size:o,constant:v}=u;!v&&p&&o>=1&&(r=Math.min(r,p.length/o))}return Pt(Number.isFinite(r)),r}}let LZ=1,OZ=1;class O3{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:s=1,repeat:u=1}=e,p=LZ++,o={time:0,delay:n,duration:r,rate:s,repeat:u};return this._setChannelTime(o,this.time),this.channels.set(p,o),p}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const s of n)this._setChannelTime(s,this.time);const r=this.animations.values();for(const s of r){const{animation:u,channel:p}=s;u.setTime(this.getTime(p))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=OZ++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,s=e.duration*e.repeat;r>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const DZ=[255,255,255],zZ=1;let FZ=0;class NZ{constructor(e={}){K(this,"id",void 0),K(this,"color",void 0),K(this,"intensity",void 0),K(this,"type","ambient");const{color:n=DZ}=e,{intensity:r=zZ}=e;this.id=e.id||"ambient-".concat(FZ++),this.color=n,this.intensity=r}}const BZ=[255,255,255],UZ=1,VZ=[0,0,-1];let jZ=0;class BI{constructor(e={}){K(this,"id",void 0),K(this,"color",void 0),K(this,"intensity",void 0),K(this,"type","directional"),K(this,"direction",void 0),K(this,"shadow",void 0);const{color:n=BZ}=e,{intensity:r=UZ}=e,{direction:s=VZ}=e,{_shadow:u=!1}=e;this.id=e.id||"directional-".concat(jZ++),this.color=n,this.intensity=r,this.type="directional",this.direction=new Ba(s).normalize().toArray(),this.shadow=u}getProjectedLight(e){return this}}class GZ{constructor(e,n={id:"pass"}){K(this,"id",void 0),K(this,"gl",void 0),K(this,"props",void 0);const{id:r}=n;this.id=r,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class WS extends GZ{constructor(...e){super(...e),K(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return xl(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:r,viewports:s,views:u,onViewportActive:p,clearStack:o=!0,clearCanvas:v=!0}=e;e.pass=e.pass||"unknown";const T=this.gl;v&&$Z(T,n),o&&(this._lastRenderIndex=-1);const I=[];for(const L of s){const F=u&&u[L.id];p==null||p(L);const j=this._getDrawLayerParams(L,e),X=L.subViewports||[L];for(const re of X){const de=this._drawLayersInViewport(T,{target:n,moduleParameters:r,viewport:re,view:F,pass:e.pass,layers:e.layers},j);I.push(de)}}return I}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:s=!1,layerFilter:u,cullRect:p,effects:o,moduleParameters:v},T=!1){const I=[],L=D3(this._lastRenderIndex+1),F={layer:n[0],viewport:e,isPicking:s,renderPass:r,cullRect:p},j={};for(let X=0;X<n.length;X++){const re=n[X],de=this._shouldDrawLayer(re,F,u,j),q={shouldDrawLayer:de};de&&!T&&(q.layerRenderIndex=L(re,de),q.moduleParameters=this._getModuleParameters(re,o,r,v),q.layerParameters=this.getLayerParameters(re,X,e)),I[X]=q}return I}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:s,target:u,viewport:p,view:o},v){const T=WZ(e,{moduleParameters:r,target:u,viewport:p});if(o&&o.props.clear){const L=o.props.clear===!0?{color:!0,depth:!0}:o.props.clear;Yo(e,{scissorTest:!0,scissor:T},()=>NS(e,L))}const I={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};xl(e,{viewport:T});for(let L=0;L<n.length;L++){const F=n[L],{shouldDrawLayer:j,layerRenderIndex:X,moduleParameters:re,layerParameters:de}=v[L];if(j&&F.props.pickable&&I.pickableCount++,F.isComposite)I.compositeCount++;else if(j){I.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,X),re.viewport=p;try{F._drawLayer({moduleParameters:re,uniforms:{layerIndex:X},parameters:de})}catch(q){F.raiseError(q,"drawing ".concat(F," to ").concat(s))}}}return I}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let p=e.parent;for(;p;){if(!p.props.visible||!p.filterSubLayer(n))return!1;n.layer=p,p=p.parent}if(r){const o=n.layer.id;if(o in s||(s[o]=r(n)),!s[o])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,s){var u;const p=Object.assign(Object.create(((u=e.internalState)===null||u===void 0?void 0:u.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:bf(this.gl)});if(n)for(const v of n){var o;Object.assign(p,(o=v.getModuleParameters)===null||o===void 0?void 0:o.call(v,e))}return Object.assign(p,this.getModuleParameters(e,n),s)}}function D3(t=0,e={}){const n={},r=(s,u)=>{const p=s.props._offset,o=s.id,v=s.parent&&s.parent.id;let T;if(v&&!(v in e)&&r(s.parent,!1),v in n){const I=n[v]=n[v]||D3(e[v],e);T=I(s,u),n[o]=I}else Number.isFinite(p)?(T=p+(e[v]||0),n[o]=null):T=t;return u&&T>=t&&(t=T+1),e[o]=T,T};return r}function WZ(t,{moduleParameters:e,target:n,viewport:r}){const s=n&&n.id!=="default-framebuffer",u=e&&e.devicePixelRatio||bf(t),p=s?n.height:t.drawingBufferHeight,o=r;return[o.x*u,p-(o.y+o.height)*u,o.width*u,o.height*u]}function $Z(t,e){const n=e?e.width:t.drawingBufferWidth,r=e?e.height:t.drawingBufferHeight;xl(t,{viewport:[0,0,n,r]}),t.clear(16640)}class HZ extends WS{constructor(e,n){super(e,n),K(this,"shadowMap",void 0),K(this,"depthBuffer",void 0),K(this,"fbo",void 0),this.shadowMap=new Qo(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new Hd(e,{format:33189,width:1,height:1}),this.fbo=new si(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;Yo(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],s=bf(this.gl),u=r.width*s,p=r.height*s;(u!==n.width||p!==n.height)&&n.resize({width:u,height:p}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const z3="#define SMOOTH_EDGE_RADIUS 0.5",ZZ=`
`.concat(z3,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),qZ=`
`.concat(z3,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),XZ={name:"geometry",vs:ZZ,fs:qZ},YZ=Object.keys(Qn).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Qn[t],";")).join(""),KZ=Object.keys(ka).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(ka[t],";")).join(""),JZ=Object.keys(VE).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(VE[t],";")).join(""),QZ="".concat(YZ,`
`).concat(KZ,`
`).concat(JZ,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function eq(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function s_(t){let e={},n;return r=>{for(const s in r)if(!eq(r[s],e[s])){n=t(r),e=r;break}return n}}const UI=[0,0,0,0],tq=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],F3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],nq=[0,0,0],N3=[0,0,0],rq=s_(oq);function B3(t,e,n=N3){n.length<3&&(n=[n[0],n[1],0]);let r=n,s,u=!0;switch(e===Qn.LNGLAT_OFFSETS||e===Qn.METER_OFFSETS?s=n:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ka.WEB_MERCATOR:(e===Qn.LNGLAT||e===Qn.CARTESIAN)&&(s=[0,0,0],u=!1);break;case ka.WEB_MERCATOR_AUTO_OFFSET:e===Qn.LNGLAT?r=s:e===Qn.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case ka.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case ka.GLOBE:u=!1,s=null;break;default:u=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:r,offsetMode:u}}function iq(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:s}=t;let{viewMatrix:u,viewProjectionMatrix:p}=t,o=UI,v=UI,T=t.cameraPosition;const{geospatialOrigin:I,shaderCoordinateOrigin:L,offsetMode:F}=B3(t,e,n);return F&&(v=t.projectPosition(I||L),T=[T[0]-v[0],T[1]-v[1],T[2]-v[2]],v[3]=1,o=r_([],v,p),u=r||u,p=eh([],s,u),p=eh([],p,tq)),{viewMatrix:u,viewProjectionMatrix:p,projectionCenter:o,originCommon:v,cameraPosCommon:T,shaderCoordinateOrigin:L,geospatialOrigin:I}}function sq({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=Qn.DEFAULT,coordinateOrigin:s=N3,autoWrapLongitude:u=!1}){r===Qn.DEFAULT&&(r=t.isGeospatial?Qn.LNGLAT:Qn.CARTESIAN);const p=rq({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:s});return p.project_uWrapLongitude=u,p.project_uModelMatrix=n||F3,p}function oq({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:s,viewProjectionMatrix:u,originCommon:p,cameraPosCommon:o,shaderCoordinateOrigin:v,geospatialOrigin:T}=iq(t,n,r),I=t.getDistanceScales(),L=[t.width*e,t.height*e],F=r_([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,j={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:v,project_uCommonOrigin:p.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:L,project_uDevicePixelRatio:e,project_uFocalDistance:F,project_uCommonUnitsPerMeter:I.unitsPerMeter,project_uCommonUnitsPerWorldUnit:I.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:nq,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:u,project_uModelMatrix:F3,project_uCameraPosition:o};if(T){const X=t.getDistanceScales(T);switch(n){case Qn.METER_OFFSETS:j.project_uCommonUnitsPerWorldUnit=X.unitsPerMeter,j.project_uCommonUnitsPerWorldUnit2=X.unitsPerMeter2;break;case Qn.LNGLAT:case Qn.LNGLAT_OFFSETS:t._pseudoMeters||(j.project_uCommonUnitsPerMeter=X.unitsPerMeter),j.project_uCommonUnitsPerWorldUnit=X.unitsPerDegree,j.project_uCommonUnitsPerWorldUnit2=X.unitsPerDegree2;break;case Qn.CARTESIAN:j.project_uCommonUnitsPerWorldUnit=[1,1,X.unitsPerMeter[2]],j.project_uCommonUnitsPerWorldUnit2=[0,0,X.unitsPerMeter2[2]];break}}return j}const aq={};function lq(t=aq){return"viewport"in t?sq(t):{}}const $S={name:"project",dependencies:[lH,XZ],vs:QZ,getUniforms:lq};function cq(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function nf(t,e){const n=r_([],e,t);return KH(n,n,1/n[3]),n}function VI(t,e){const n=t%e;return n<0?e+n:n}function uq(t,e,n){return n*e+(1-n)*t}function JE(t,e,n){return t<e?e:t>n?n:t}function hq(t){return Math.log(t)*Math.LOG2E}const HS=Math.log2||hq;function bl(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Wo=Math.PI,U3=Wo/4,fo=Wo/180,QE=180/Wo,Cf=512,jv=4003e4,b0=85.051129,dq=1.5;function jI(t){return Math.pow(2,t)}function V3(t){return HS(t)}function Mf(t){const[e,n]=t;bl(Number.isFinite(e)),bl(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*fo,s=n*fo,u=Cf*(r+Wo)/(2*Wo),p=Cf*(Wo+Math.log(Math.tan(U3+s*.5)))/(2*Wo);return[u,p]}function ch(t){const[e,n]=t,r=e/Cf*(2*Wo)-Wo,s=2*(Math.atan(Math.exp(n/Cf*(2*Wo)-Wo))-U3);return[r*QE,s*QE]}function fq(t){const{latitude:e}=t;bl(Number.isFinite(e));const n=Math.cos(e*fo);return V3(jv*n)-9}function aw(t){const e=Math.cos(t*fo);return Cf/jv/e}function eT(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;bl(Number.isFinite(e)&&Number.isFinite(n));const s=Cf,u=Math.cos(e*fo),p=s/360,o=p/u,v=s/jv/u,T={unitsPerMeter:[v,v,v],metersPerUnit:[1/v,1/v,1/v],unitsPerDegree:[p,o,v],degreesPerUnit:[1/p,1/o,1/v]};if(r){const I=fo*Math.tan(e*fo)/u,L=p*I/2,F=s/jv*I,j=F/o*v;T.unitsPerDegree2=[0,L,F],T.unitsPerMeter2=[j,0,j]}return T}function j3(t,e){const[n,r,s]=t,[u,p,o]=e,{unitsPerMeter:v,unitsPerMeter2:T}=eT({longitude:n,latitude:r,highPrecision:!0}),I=Mf(t);I[0]+=u*(v[0]+T[0]*p),I[1]+=p*(v[1]+T[1]*p);const L=ch(I),F=(s||0)+(o||0);return Number.isFinite(s)||Number.isFinite(o)?[L[0],L[1],F]:L}function pq(t){const{height:e,pitch:n,bearing:r,altitude:s,scale:u,center:p}=t,o=cq();Uv(o,o,[0,0,-s]),R3(o,o,-n*fo),k3(o,o,r*fo);const v=u/e;return jS(o,o,[v,v,v]),p&&Uv(o,o,CH([],p)),o}function mq(t){const{width:e,height:n,altitude:r,pitch:s=0,offset:u,center:p,scale:o,nearZMultiplier:v=1,farZMultiplier:T=1}=t;let{fovy:I=Gv(dq)}=t;r!==void 0&&(I=Gv(r));const L=I*fo,F=s*fo,j=G3(I);let X=j;p&&(X+=p[2]*o/Math.cos(F)/n);const re=L*(.5+(u?u[1]:0)/n),de=Math.sin(re)*X/Math.sin(JE(Math.PI/2-F-re,.01,Math.PI-.01)),q=Math.sin(F)*de+X,H=X*10,J=Math.min(q*T,H);return{fov:L,aspect:e/n,focalDistance:j,near:v,far:J}}function Gv(t){return 2*Math.atan(.5/t)*QE}function G3(t){return .5/Math.tan(.5*t*fo)}function W3(t,e){const[n,r,s=0]=t;return bl(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(s)),nf(e,[n,r,s,1])}function ZS(t,e,n=0){const[r,s,u]=t;if(bl(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(u))return nf(e,[r,s,u,1]);const p=nf(e,[r,s,0,1]),o=nf(e,[r,s,1,1]),v=p[2],T=o[2],I=v===T?0:((n||0)-v)/(T-v);return M3([],p,o,I)}function gq(t){const{width:e,height:n,bounds:r,minExtent:s=0,maxZoom:u=24,offset:p=[0,0]}=t,[[o,v],[T,I]]=r,L=_q(t.padding),F=Mf([o,JE(I,-b0,b0)]),j=Mf([T,JE(v,-b0,b0)]),X=[Math.max(Math.abs(j[0]-F[0]),s),Math.max(Math.abs(j[1]-F[1]),s)],re=[e-L.left-L.right-Math.abs(p[0])*2,n-L.top-L.bottom-Math.abs(p[1])*2];bl(re[0]>0&&re[1]>0);const de=re[0]/X[0],q=re[1]/X[1],H=(L.right-L.left)/2/de,J=(L.top-L.bottom)/2/q,Ee=[(j[0]+F[0])/2+H,(j[1]+F[1])/2+J],ue=ch(Ee),Fe=Math.min(u,HS(Math.abs(Math.min(de,q))));return bl(Number.isFinite(Fe)),{longitude:ue[0],latitude:ue[1],zoom:Fe}}function _q(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(bl(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const GI=Math.PI/180;function yq(t,e=0){const{width:n,height:r,unproject:s}=t,u={targetZ:e},p=s([0,r],u),o=s([n,r],u);let v,T;const I=t.fovy?.5*t.fovy*GI:Math.atan(.5/t.altitude),L=(90-t.pitch)*GI;return I>L-.01?(v=WI(t,0,e),T=WI(t,n,e)):(v=s([0,0],u),T=s([n,0],u)),[p,o,T,v]}function WI(t,e,n){const{pixelUnprojectionMatrix:r}=t,s=nf(r,[e,0,1,1]),u=nf(r,[e,t.height,1,1]),o=(n*t.distanceScales.unitsPerMeter[2]-s[2])/(u[2]-s[2]),v=M3([],s,u,o),T=ch(v);return T.push(n),T}const $I=512;function vq(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:s,latitude:u,zoom:p,bearing:o=0}=t;(s<-180||s>180)&&(s=VI(s+180,360)-180),(o<-180||o>180)&&(o=VI(o+180,360)-180);const v=HS(n/$I);if(p<=v)p=v,u=0;else{const T=n/2/Math.pow(2,p),I=ch([0,T])[1];if(u<I)u=I;else{const L=ch([0,$I-T])[1];u>L&&(u=L)}}return{width:e,height:n,longitude:s,latitude:u,zoom:p,pitch:r,bearing:o}}const $3=.01,xq=["longitude","latitude","zoom"],H3={curve:1.414,speed:1.2};function bq(t,e,n,r){const{startZoom:s,startCenterXY:u,uDelta:p,w0:o,u1:v,S:T,rho:I,rho2:L,r0:F}=Z3(t,e,r);if(v<$3){const Ee={};for(const ue of xq){const Fe=t[ue],Qe=e[ue];Ee[ue]=uq(Fe,Qe,n)}return Ee}const j=n*T,X=Math.cosh(F)/Math.cosh(F+I*j),re=o*((Math.cosh(F)*Math.tanh(F+I*j)-Math.sinh(F))/L)/v,de=1/X,q=s+V3(de),H=yH([],p,re);XE(H,H,u);const J=ch(H);return{longitude:J[0],latitude:J[1],zoom:q}}function wq(t,e,n){const r={...H3,...n},{screenSpeed:s,speed:u,maxDuration:p}=r,{S:o,rho:v}=Z3(t,e,r),T=1e3*o;let I;return Number.isFinite(s)?I=T/(s/v):I=T/u,Number.isFinite(p)&&I>p?0:I}function Z3(t,e,n){n=Object.assign({},H3,n);const r=n.curve,s=t.zoom,u=[t.longitude,t.latitude],p=jI(s),o=e.zoom,v=[e.longitude,e.latitude],T=jI(o-s),I=Mf(u),L=Mf(v),F=wH([],L,I),j=Math.max(t.width,t.height),X=j/T,re=vH(F)*p,de=Math.max(re,$3),q=r*r,H=(X*X-j*j+q*q*de*de)/(2*j*q*de),J=(X*X-j*j-q*q*de*de)/(2*X*q*de),Ee=Math.log(Math.sqrt(H*H+1)-H),ue=Math.log(Math.sqrt(J*J+1)-J),Fe=(ue-Ee)/r;return{startZoom:s,startCenterXY:I,uDelta:F,w0:j,u1:re,S:Fe,rho:r,rho2:q,r0:Ee,r1:ue}}const Eq=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Tq=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Sq=s_(Iq),Aq=s_(Rq),Cq=[0,0,0,1],Mq=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Pq(t,e){const[n,r,s]=t,u=ZS([n,r,s],e);return Number.isFinite(s)?u:[u[0],u[1],0]}function Iq({viewport:t,center:e}){return new Ua(t.viewProjectionMatrix).invert().transform(e)}function Rq({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,u=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(p=>Pq(p,r));for(const p of e){const o=p.clone().translate(new Ba(t.center).negate()),v=u.map(I=>o.transform(I)),T=new Ua().ortho({left:Math.min(...v.map(I=>I[0])),right:Math.max(...v.map(I=>I[0])),bottom:Math.min(...v.map(I=>I[1])),top:Math.max(...v.map(I=>I[1])),near:Math.min(...v.map(I=>-I[2])),far:Math.max(...v.map(I=>-I[2]))});n.push(T.multiplyRight(p))}return n}function kq(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||Cq,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},s=Sq({viewport:t.viewport,center:e.project_uCenter}),u=[],p=Aq({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let o=0;o<t.shadowMatrices.length;o++){const v=p[o],T=v.clone().translate(new Ba(t.viewport.center).negate());e.project_uCoordinateSystem===Qn.LNGLAT&&e.project_uProjectionMode===ka.WEB_MERCATOR?(p[o]=T,u[o]=s):(p[o]=v.clone().multiplyRight(Mq),u[o]=T.transform(s))}for(let o=0;o<p.length;o++)r["shadow_uViewProjectionMatrices[".concat(o,"]")]=p[o],r["shadow_uProjectCenters[".concat(o,"]")]=u[o],t.shadowMaps&&t.shadowMaps.length>0?r["shadow_uShadowMap".concat(o)]=t.shadowMaps[o]:r["shadow_uShadowMap".concat(o)]=t.dummyShadowMap;return r}const lw={name:"shadow",dependencies:[$S],vs:Eq,fs:Tq,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?kq(t,e):{}},Lq={color:[255,255,255],intensity:1},HI=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Oq=[0,0,0,200/255];class q3{constructor(e={}){K(this,"id","lighting-effect"),K(this,"props",void 0),K(this,"shadowColor",Oq),K(this,"shadow",void 0),K(this,"ambientLight",void 0),K(this,"directionalLights",void 0),K(this,"pointLights",void 0),K(this,"shadowPasses",[]),K(this,"shadowMaps",[]),K(this,"dummyShadowMap",null),K(this,"programManager",void 0),K(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:r,viewports:s,onViewportActive:u,views:p}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=i_.getDefaultProgramManager(e),lw&&this.programManager.addDefaultModule(lw)),this.dummyShadowMap||(this.dummyShadowMap=new Qo(e,{width:1,height:1}));for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:n,layerFilter:r,viewports:s,onViewportActive:u,views:p,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(lw),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Ua().lookAt({eye:new Ba(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new HZ(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new NZ(Lq),this.directionalLights.push(new BI(HI[0]),new BI(HI[1])))}}class Dq{constructor(e={}){K(this,"_pool",[]),K(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:s,padding:u=0,copy:p=!1,initialize:o=!1,maxCount:v}){const T=s||e&&e.constructor||Float32Array,I=n*r+u;if(ArrayBuffer.isView(e)){if(I<=e.length)return e;if(I*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new T(e.buffer,0,I)}let L=1/0;v&&(L=v*r+u);const F=this._allocate(T,I,o,L);return e&&p?F.set(e):o||F.fill(0,0,4),this._release(e),F}release(e){this._release(e)}_allocate(e,n,r,s){let u=Math.max(Math.ceil(n*this.opts.overAlloc),1);u>s&&(u=s);const p=this._pool,o=e.BYTES_PER_ELEMENT*u,v=p.findIndex(T=>T.byteLength>=o);if(v>=0){const T=new e(p.splice(v,1)[0],0,u);return r&&T.fill(0),T}return new e(u)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:s}=r,u=n.findIndex(p=>p.byteLength>=s);u<0?n.push(r):(u>0||n.length<this.opts.poolSize)&&n.splice(u,0,r),n.length>this.opts.poolSize&&n.shift()}}const Pg=new Dq;function km(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function zq(t){return[t[12],t[13],t[14]]}function Fq(t){return{left:Ad(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Ad(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Ad(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Ad(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Ad(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Ad(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const ZI=new Ba;function Ad(t,e,n,r){ZI.set(t,e,n);const s=ZI.len();return{distance:r/s,normal:new Ba(-t/s,-e/s,-n/s)}}function Nq(t){return t-Math.fround(t)}let wm;function cw(t,e){const{size:n=1,startIndex:r=0}=e,s=e.endIndex!==void 0?e.endIndex:t.length,u=(s-r)/n;wm=Pg.allocate(wm,u,{type:Float32Array,size:n*2});let p=r,o=0;for(;p<s;){for(let v=0;v<n;v++){const T=t[p++];wm[o+v]=T,wm[o+v+n]=Nq(T)}o+=n*2}return wm.subarray(0,u*n*2)}function Bq(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const Uq=Math.PI/180,Vq=km(),qI=[0,0,0],jq={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Gq({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:s,padding:u,near:p,far:o}){const v=t/e,T=n?new Ua().orthographic({fovy:r,aspect:v,focalDistance:s,near:p,far:o}):new Ua().perspective({fovy:r,aspect:v,near:p,far:o});if(u){const{left:I=0,right:L=0,top:F=0,bottom:j=0}=u,X=bc((I+t-L)/2,0,t)-t/2,re=bc((F+e-j)/2,0,e)-e/2;T[8]-=X*2/t,T[9]+=re*2/e}return T}class Vf{constructor(e={}){K(this,"id",void 0),K(this,"x",void 0),K(this,"y",void 0),K(this,"width",void 0),K(this,"height",void 0),K(this,"padding",void 0),K(this,"isGeospatial",void 0),K(this,"zoom",void 0),K(this,"focalDistance",void 0),K(this,"position",void 0),K(this,"modelMatrix",void 0),K(this,"distanceScales",void 0),K(this,"scale",void 0),K(this,"center",void 0),K(this,"cameraPosition",void 0),K(this,"projectionMatrix",void 0),K(this,"viewMatrix",void 0),K(this,"viewMatrixUncentered",void 0),K(this,"viewMatrixInverse",void 0),K(this,"viewProjectionMatrix",void 0),K(this,"pixelProjectionMatrix",void 0),K(this,"pixelUnprojectionMatrix",void 0),K(this,"resolution",void 0),K(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||jq,this.focalDistance=e.focalDistance||1,this.position=e.position||qI,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ka.WEB_MERCATOR:ka.WEB_MERCATOR_AUTO_OFFSET:ka.IDENTITY}equals(e){return e instanceof Vf?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Mg(e.projectionMatrix,this.projectionMatrix)&&Mg(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),s=W3(r,this.pixelProjectionMatrix),[u,p]=s,o=n?p:this.height-p;return e.length===2?[u,o]:[u,o,s[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[s,u,p]=e,o=n?u:this.height-u,v=r&&r*this.distanceScales.unitsPerMeter[2],T=ZS([s,o,p],this.pixelUnprojectionMatrix,v),[I,L,F]=this.unprojectPosition(T);return Number.isFinite(p)?[I,L,F]:Number.isFinite(r)?[I,L,r]:[I,L]}projectPosition(e){const[n,r]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,s]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,s]}projectFlat(e){if(this.isGeospatial){const n=Mf(e);return n[1]=bc(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?ch(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),s=this.unproject([this.width,0],n),u=this.unproject([0,this.height],n),p=this.unproject([this.width,this.height],n);return[Math.min(r[0],s[0],u[0],p[0]),Math.min(r[1],s[1],u[1],p[1]),Math.max(r[0],s[0],u[0],p[0]),Math.max(r[1],s[1],u[1],p[1])]}getDistanceScales(e){return e?eT({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:s=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Fq(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=fq({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||eT({latitude:r,longitude:n}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:u,modelMatrix:p}=e;let o=qI;if(u&&(o=p?new Ua(p).transformAsVector(u,[]):u),this.isGeospatial){const v=this.projectPosition([n,r,0]);this.center=new Ba(o).scale(this.distanceScales.unitsPerMeter).add(v)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:n=Vq,projectionMatrix:r=null,orthographic:s=!1,fovyRadians:u,fovy:p=75,near:o=.1,far:v=1e3,padding:T=null,focalDistance:I=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Ua().multiplyRight(n).translate(new Ba(this.center).negate()),this.projectionMatrix=r||Gq({width:this.width,height:this.height,orthographic:s,fovyRadians:u||p*Uq,focalDistance:I,padding:T,near:o,far:v});const L=km();eh(L,L,this.projectionMatrix),eh(L,L,this.viewMatrix),this.viewProjectionMatrix=L,this.viewMatrixInverse=YE([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=zq(this.viewMatrixInverse);const F=km(),j=km();jS(F,F,[this.width/2,-this.height/2,1]),Uv(F,F,[1,-1,0]),eh(j,F,this.viewProjectionMatrix),this.pixelProjectionMatrix=j,this.pixelUnprojectionMatrix=YE(km(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ir.warn("Pixel project matrix not invertible")()}}K(Vf,"displayName","Viewport");class uh extends Vf{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:s=0,pitch:u=0,bearing:p=0,nearZMultiplier:o=.1,farZMultiplier:v=1.01,orthographic:T=!1,projectionMatrix:I,repeat:L=!1,worldOffset:F=0,position:j,padding:X,legacyMeterSizes:re=!1}=e;let{width:de,height:q,altitude:H=1.5}=e;const J=Math.pow(2,s);de=de||1,q=q||1;let Ee,ue=null;if(I)H=I[5]/2,Ee=Gv(H);else{e.fovy?(Ee=e.fovy,H=G3(Ee)):Ee=Gv(H);let Qe;if(X){const{top:at=0,bottom:rt=0}=X;Qe=[0,bc((at+q-rt)/2,0,q)-q/2]}ue=mq({width:de,height:q,scale:J,center:j&&[0,0,j[2]*aw(n)],offset:Qe,pitch:u,fovy:Ee,nearZMultiplier:o,farZMultiplier:v})}let Fe=pq({height:q,pitch:u,bearing:p,scale:J,altitude:H});F&&(Fe=new Ua().translate([512*F,0,0]).multiplyLeft(Fe)),super({...e,width:de,height:q,viewMatrix:Fe,longitude:r,latitude:n,zoom:s,...ue,fovy:Ee,focalDistance:H}),K(this,"longitude",void 0),K(this,"latitude",void 0),K(this,"pitch",void 0),K(this,"bearing",void 0),K(this,"altitude",void 0),K(this,"fovy",void 0),K(this,"orthographic",void 0),K(this,"_subViewports",void 0),K(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=r,this.zoom=s,this.pitch=u,this.bearing=p,this.altitude=H,this.fovy=Ee,this.orthographic=T,this._subViewports=L?[]:null,this._pseudoMeters=re,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let s=n;s<=r;s++){const u=s?new uh({...this,worldOffset:s}):this;this._subViewports.push(u)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),s=(e[2]||0)*aw(e[1]);return[n,r,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),s=(e[2]||0)/aw(r);return[n,r,s]}addMetersToLngLat(e,n){return j3(e,n)}panByPosition(e,n){const r=ZS(n,this.pixelUnprojectionMatrix),s=this.projectFlat(e),u=XE([],s,xH([],r)),p=XE([],this.center,u),[o,v]=this.unprojectFlat(p);return{longitude:o,latitude:v}}getBounds(e={}){const n=yq(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:s}=this,{longitude:u,latitude:p,zoom:o}=gq({width:r,height:s,bounds:e,...n});return new uh({width:r,height:s,longitude:u,latitude:p,zoom:o})}}K(uh,"displayName","WebMercatorViewport");const XI=[0,0,0];function uw(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof uh){const[s,u,p=0]=t,o=e.getDistanceScales([s,u]);r[2]=p*o.unitsPerMeter[2]}return r}function Wq(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:s,fromCoordinateSystem:u,fromCoordinateOrigin:p}=t;return s===Qn.DEFAULT&&(s=e.isGeospatial?Qn.LNGLAT:Qn.CARTESIAN),u===void 0&&(u=s),p===void 0&&(p=r),{viewport:e,coordinateSystem:s,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:u,fromCoordinateOrigin:p}}function X3(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:s,offsetMode:u}){let[p,o,v=0]=t;switch(n&&([p,o,v]=r_([],[p,o,v,1],n)),r){case Qn.LNGLAT:return uw([p,o,v],e,u);case Qn.LNGLAT_OFFSETS:return uw([p+s[0],o+s[1],v+(s[2]||0)],e,u);case Qn.METER_OFFSETS:return uw(j3(s,[p,o,v]),e,u);case Qn.CARTESIAN:default:return e.isGeospatial?[p+s[0],o+s[1],v+s[2]]:e.projectPosition([p,o,v])}}function $q(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:s,modelMatrix:u,fromCoordinateSystem:p,fromCoordinateOrigin:o}=Wq(e),{autoOffset:v=!0}=e,{geospatialOrigin:T=XI,shaderCoordinateOrigin:I=XI,offsetMode:L=!1}=v?B3(n,r,s):{},F=X3(t,{viewport:n,modelMatrix:u,coordinateSystem:p,coordinateOrigin:o,offsetMode:L});if(L){const j=n.projectPosition(T||I);zH(F,F,j)}return F}const YI={blendFunc:[1,0,32771,0],blendEquation:32774};class Y3 extends WS{constructor(...e){super(...e),K(this,"pickZ",void 0),K(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:s,onViewportActive:u,pickingFBO:p,deviceRect:{x:o,y:v,width:T,height:I},cullRect:L,effects:F,pass:j="picking",pickZ:X,moduleParameters:re}){const de=this.gl;this.pickZ=X;const q=this._resetColorEncoder(X),H=Yo(de,{scissorTest:!0,scissor:[o,v,T,I],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...YI,blend:!X},()=>super.render({target:p,layers:e,layerFilter:n,views:r,viewports:s,onViewportActive:u,cullRect:L,effects:F==null?void 0:F.filter(Ee=>Ee.useInPicking),pass:j,isPicking:!0,moduleParameters:re}));return this._colorEncoderState=null,{decodePickingColor:q&&Zq.bind(null,q),stats:H}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,r){const s={...e.props.parameters},{pickable:u,operation:p}=e.props;return this._colorEncoderState?u&&p.includes("draw")&&(Object.assign(s,YI),s.blend=!0,s.blendColor=Hq(this._colorEncoderState,e,r)):s.blend=!1,p.includes("terrain")&&(s.blend=!1),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Hq(t,e,n){const{byLayer:r,byAlpha:s}=t;let u,p=r.get(e);return p?(p.viewports.push(n),u=p.a):(u=r.size+1,u<=255?(p={a:u,layer:e,viewports:[n]},r.set(e,p),s[u]=p):(ir.warn("Too many pickable layers, only picking the first 255")(),u=0)),[0,0,0,u/255]}function Zq(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Rd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Wv=Symbol.for("component"),th=Symbol.for("propTypes"),hw=Symbol.for("deprecatedProps"),rf=Symbol.for("asyncPropDefaults"),hh=Symbol.for("asyncPropOriginal"),wc=Symbol.for("asyncPropResolved");function K3(t,e=()=>!0){return Array.isArray(t)?J3(t,e,[]):e(t)?[t]:[]}function J3(t,e,n){let r=-1;for(;++r<t.length;){const s=t[r];Array.isArray(s)?J3(s,e,n):e(s)&&n.push(s)}return n}function qq({target:t,source:e,start:n=0,count:r=1}){const s=e.length,u=r*s;let p=0;for(let o=n;p<s;p++)t[o++]=e[p];for(;p<u;)p<u-p?(t.copyWithin(n+p,n,n+p),p*=2):(t.copyWithin(n+p,n,n+u-p),p=u);return t}class Xq{constructor(e,n,r){K(this,"id",void 0),K(this,"context",void 0),K(this,"isLoaded",void 0),K(this,"persistent",void 0),K(this,"_loadCount",0),K(this,"_subscribers",new Set),K(this,"_data",void 0),K(this,"_loader",void 0),K(this,"_error",void 0),K(this,"_content",void 0),this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let s=e;typeof e=="string"&&(s=zE(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(u=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=u)}).catch(u=>{this._loadCount===r&&(this.isLoaded=!0,this._error=u||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const u of this._subscribers)u.onChange(this.getData())}}class Yq{constructor({gl:e,protocol:n}){K(this,"protocol",void 0),K(this,"_context",void 0),K(this,"_resources",void 0),K(this,"_consumers",void 0),K(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:s=!0}){let u=this._resources[e];u?u.setData(n,r):(u=new Xq(e,n,this._context),this._resources[e]=u),u.persistent=s}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const s=n[r],u=this._resources[s.resourceId];u&&u.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:s="default"}){const{_resources:u,protocol:p}=this;e.startsWith(p)&&(e=e.replace(p,""),u[e]||this.add({resourceId:e,data:null,persistent:!1}));const o=u[e];if(this._track(r,s,o,n),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,s){const u=this._consumers,p=u[e]=u[e]||{},o=p[n]||{},v=o.resourceId&&this._resources[o.resourceId];v&&(v.unsubscribe(o),this.prune()),r&&(p[n]=o,o.onChange=s,o.resourceId=r.id,r.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const Kq=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Jq={name:"project32",dependencies:[$S],vs:Kq},Qq={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...cZ},eX=[$S],tX=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function nX(t){const e=i_.getDefaultProgramManager(t);for(const n of eX)e.addDefaultModule(n);for(const n of tX)e.addShaderHook(n);return e}const rX="layerManager.setLayers",iX="layerManager.activateViewport";class sX{constructor(e,{deck:n,stats:r,viewport:s,timeline:u}={}){K(this,"layers",void 0),K(this,"context",void 0),K(this,"resourceManager",void 0),K(this,"_lastRenderedLayers",[]),K(this,"_needsRedraw",!1),K(this,"_needsUpdate",!1),K(this,"_nextLayers",null),K(this,"_debug",!1),K(this,"activateViewport",p=>{qi(iX,this,p),p&&(this.context.viewport=p)}),this.layers=[],this.resourceManager=new Yq({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&nX(e),stats:r||new PS({id:"deck.gl"}),viewport:s||new Vf({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:u||new O3,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const s=r.getNeedsRedraw(e);n=n||s}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){qi(rX,this,n,e),this._lastRenderedLayers=e;const r=K3(e,Boolean);for(const s of r)s.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,r){r.raiseError(n,"".concat(e," of ").concat(r))}_updateLayers(e,n){const r={};for(const p of e)r[p.id]?ir.warn("Multiple old layers with same id ".concat(p.id))():r[p.id]=p;const s=[];this._updateSublayersRecursively(n,r,s),this._finalizeOldLayers(r);let u=!1;for(const p of s)if(p.hasUniformTransition()){u="Uniform transition in ".concat(p);break}this._needsUpdate=u,this.layers=s}_updateSublayersRecursively(e,n,r){for(const s of e){s.context=this.context;const u=n[s.id];u===null&&ir.warn("Multiple new layers with same id ".concat(s.id))(),n[s.id]=null;let p=null;try{this._debug&&u!==s&&s.validateProps(),u?(this._transferLayerState(u,s),this._updateLayer(s)):this._initializeLayer(s),r.push(s),p=s.isComposite?s.getSubLayers():null}catch(o){this._handleError("matching",o,s)}p&&this._updateSublayersRecursively(p,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Rd.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Rd.MATCHED,n!==e&&(e.lifecycle=Rd.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Rd.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Rd.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function La(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!La(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(const u of r)if(!e.hasOwnProperty(u)||!La(t[u],e[u],n-1))return!1;return!0}return!1}class oX{constructor(e){K(this,"width",void 0),K(this,"height",void 0),K(this,"views",void 0),K(this,"viewState",void 0),K(this,"controllers",void 0),K(this,"timeline",void 0),K(this,"_viewports",void 0),K(this,"_viewportMap",void 0),K(this,"_isUpdating",void 0),K(this,"_needsRedraw",void 0),K(this,"_needsUpdate",void 0),K(this,"_eventManager",void 0),K(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),s={x:e[0],y:e[1]};for(let u=r.length-1;u>=0;--u){const p=r[u];if(p.containsPixel(s)){const o=e.slice();return o[0]-=p.x,o[1]-=p.y,p.unproject(o,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=K3(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!La(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ir.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:u=>{var p;return(p=this.getView(e.id))===null||p===void 0?void 0:p.makeViewport({viewState:u,width:this.width,height:this.height})}})}_updateController(e,n,r,s){const u=e.controller;if(u){const p={...n,...u,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return s||(s=this._createController(e,p)),s&&s.setProps(p),s}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let s=e.length;s--;){const u=e[s],p=this.getViewState(u),o=u.makeViewport({viewState:p,width:this.width,height:this.height});let v=n[u.id];const T=!!u.controller;T&&!v&&(r=!0),(r||!T)&&v&&(v.finalize(),v=null),this.controllers[u.id]=this._updateController(u,p,o,v),this._viewports.unshift(o)}for(const s in n){const u=n[s];u&&!this.controllers[s]&&u.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,s)=>!e[s].equals(n[s]))}}const aX=/([0-9]+\.?[0-9]*)(%|px)/;function sc(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=aX.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function oc(t,e){return t.relative?Math.round(t.position*e):t.position}function Ti(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Pf{constructor(e){K(this,"id",void 0),K(this,"viewportInstance",void 0),K(this,"_x",void 0),K(this,"_y",void 0),K(this,"_width",void 0),K(this,"_height",void 0),K(this,"_padding",void 0),K(this,"props",void 0);const{id:n,x:r=0,y:s=0,width:u="100%",height:p="100%",padding:o=null,viewportInstance:v}=e||{};Ti(!v||v instanceof Vf),this.viewportInstance=v,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=sc(r),this._y=sc(s),this._width=sc(u),this._height=sc(p),this._padding=o&&{left:sc(o.left||0),right:sc(o.right||0),top:sc(o.top||0),bottom:sc(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&La(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const s=this.getDimensions({width:e,height:n});return new this.ViewportType({...r,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:oc(this._x,e),y:oc(this._y,n),width:oc(this._width,e),height:oc(this._height,n)};return this._padding&&(r.padding={left:oc(this._padding.left,e),top:oc(this._padding.top,n),right:oc(this._padding.right,e),bottom:oc(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class o_{constructor(e){K(this,"_inProgress",void 0),K(this,"_handle",void 0),K(this,"_timeline",void 0),K(this,"time",void 0),K(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(n=(r=this.settings).onStart)===null||n===void 0||n.call(r,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:s}=this;this._handle=r.addChannel({delay:r.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const KI=()=>{},tT={BREAK:1,SNAP_TO_END:2,IGNORE:3},lX=t=>t,cX=tT.BREAK;class uX{constructor(e){K(this,"getControllerState",void 0),K(this,"props",void 0),K(this,"propsInTransition",void 0),K(this,"transition",void 0),K(this,"onViewStateChange",void 0),K(this,"onStateChange",void 0),K(this,"_onTransitionUpdate",n=>{const{time:r,settings:{interpolator:s,startProps:u,endProps:p,duration:o,easing:v}}=n,T=v(r/o),I=s.interpolateProps(u,p,T);this.propsInTransition=this.getControllerState({...this.props,...I}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new o_(e.timeline),this.onViewStateChange=e.onViewStateChange||KI,this.onStateChange=e.onStateChange||KI}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let s=r;if(this.transition.inProgress){const{interruption:u,endProps:p}=this.transition.settings;s={...r,...u===tT.SNAP_TO_END?p:this.propsInTransition||r}}this._triggerTransition(s,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===tT.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),s=this.getControllerState(n).shortestPathFrom(r),u=n.transitionInterpolator,p=u.getDuration?u.getDuration(e,n):n.transitionDuration;if(p===0)return;const o=u.initializeProps(e,s);this.propsInTransition={};const v={duration:p,easing:n.transitionEasing||lX,interpolator:u,interruption:n.transitionInterruption||cX,startProps:o.start,endProps:o.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(v),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class Q3{constructor(e){K(this,"_propsToCompare",void 0),K(this,"_propsToExtract",void 0),K(this,"_requiredProps",void 0);const{compare:n,extract:r,required:s}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=s}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Mg(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},s={};for(const u of this._propsToExtract)(u in e||u in n)&&(r[u]=e[u],s[u]=n[u]);return this._checkRequiredProps(r),this._checkRequiredProps(s),{start:r,end:s}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Ti(Number.isFinite(r)||Array.isArray(r),"".concat(n," is required for transition"))})}}const hX=["longitude","latitude","zoom","bearing","pitch"],dX=["longitude","latitude","zoom"];class ez extends Q3{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:hX,required:dX},super(r.transitionProps),K(this,"opts",void 0),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:s,around:u}=this.opts;if(s&&u){const p=s(e),o=s(n),v=p.unproject(u);r.start.around=u,Object.assign(r.end,{around:o.project(v),aroundPosition:v,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const s={};for(const u of this._propsToExtract)s[u]=Cg(e[u]||0,n[u]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const u=this.opts.makeViewport({...n,...s});Object.assign(s,u.panByPosition(n.aroundPosition,Cg(e.around,n.around,r)))}return s}}const ac={transitionDuration:0},fX=300,w0=t=>1-(1-t)*(1-t),Cd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Fu={};class pX{constructor(e){K(this,"props",void 0),K(this,"state",{}),K(this,"transitionManager",void 0),K(this,"eventManager",void 0),K(this,"onViewStateChange",void 0),K(this,"onStateChange",void 0),K(this,"makeViewport",void 0),K(this,"_controllerState",void 0),K(this,"_events",{}),K(this,"_interactionState",{isDragging:!1}),K(this,"_customEvents",[]),K(this,"_eventStartBlocked",null),K(this,"_panMove",!1),K(this,"invertPan",!1),K(this,"dragMode","rotate"),K(this,"inertia",0),K(this,"scrollZoom",!0),K(this,"dragPan",!0),K(this,"dragRotate",!0),K(this,"doubleClickZoom",!0),K(this,"touchZoom",!0),K(this,"touchRotate",!1),K(this,"keyboard",!0),this.transitionManager=new uX({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:s}=e;return[s.x-n,s.y-r]}isPointInBounds(e,n){const{width:r,height:s}=this.props;if(n&&n.handled)return!1;const u=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=s;return u&&n&&n.stopPropagation(),u}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?fX:0;const{scrollZoom:r=!0,dragPan:s=!0,dragRotate:u=!0,doubleClickZoom:p=!0,touchZoom:o=!0,touchRotate:v=!1,keyboard:T=!0}=e,I=!!this.onViewStateChange;this.toggleEvents(Cd.WHEEL,I&&r),this.toggleEvents(Cd.PAN,I&&(s||u)),this.toggleEvents(Cd.PINCH,I&&(o||v)),this.toggleEvents(Cd.TRIPLE_PAN,I&&v),this.toggleEvents(Cd.DOUBLE_TAP,I&&p),this.toggleEvents(Cd.KEYBOARD,I&&T),this.scrollZoom=r,this.dragPan=s,this.dragRotate=u,this.doubleClickZoom=p,this.touchZoom=o,this.touchRotate=v,this.keyboard=T}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const s={...e.getViewportProps(),...n},u=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),u){const p=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:p})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const s=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(s,ac,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,ac,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],u=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:w0},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,ac,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],u=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:w0},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:r=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:u}=e;let p=2/(1+Math.exp(-Math.abs(u*r)));u<0&&p!==0&&(p=1/p);const o=this.controllerState.zoom({pos:n,scale:p});return this.updateViewport(o,{...this._getTransitionProps({around:n}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,ac,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,ac,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),s=[r[0],r[1]+=e.velocityY*n/2],u=this.controllerState.rotate({pos:s});this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:w0},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Fu._startPinchRotation=e.rotation,Fu._lastPinchEvent=e,this.updateViewport(r,ac,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,s=this.getCenter(e);n=n.zoom({pos:s,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:Fu._startPinchRotation-r})}return this.updateViewport(n,ac,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Fu._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Fu;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const s=this.getCenter(e);let u=this.controllerState.rotateEnd();const p=Math.log2(e.scale),o=(p-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),v=Math.pow(2,p+o*n/2);u=u.zoom({pos:s,scale:v}).zoomEnd(),this.updateViewport(u,{...this._getTransitionProps({around:s}),transitionDuration:n,transitionEasing:w0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Fu._startPinchRotation=null,Fu._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(s,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:s,rotateSpeedX:u,rotateSpeedY:p}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let v;const T={};switch(e.srcEvent.code){case"Minus":v=n?o.zoomOut(r).zoomOut(r):o.zoomOut(r),T.isZooming=!0;break;case"Equal":v=n?o.zoomIn(r).zoomIn(r):o.zoomIn(r),T.isZooming=!0;break;case"ArrowLeft":n?(v=o.rotateLeft(u),T.isRotating=!0):(v=o.moveLeft(s),T.isPanning=!0);break;case"ArrowRight":n?(v=o.rotateRight(u),T.isRotating=!0):(v=o.moveRight(s),T.isPanning=!0);break;case"ArrowUp":n?(v=o.rotateUp(p),T.isRotating=!0):(v=o.moveUp(s),T.isPanning=!0);break;case"ArrowDown":n?(v=o.rotateDown(p),T.isRotating=!0):(v=o.moveDown(s),T.isPanning=!0);break;default:return!1}return this.updateViewport(v,this._getTransitionProps(),T),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?ac:e?{...n,transitionInterpolator:new ez({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class mX{constructor(e,n){K(this,"_viewportProps",void 0),K(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const JI=5,gX=1.2;class _X extends mX{constructor(e){const{width:n,height:r,latitude:s,longitude:u,zoom:p,bearing:o=0,pitch:v=0,altitude:T=1.5,position:I=[0,0,0],maxZoom:L=20,minZoom:F=0,maxPitch:j=60,minPitch:X=0,startPanLngLat:re,startZoomLngLat:de,startRotatePos:q,startBearing:H,startPitch:J,startZoom:Ee,normalize:ue=!0}=e;Ti(Number.isFinite(u)),Ti(Number.isFinite(s)),Ti(Number.isFinite(p)),super({width:n,height:r,latitude:s,longitude:u,zoom:p,bearing:o,pitch:v,altitude:T,maxZoom:L,minZoom:F,maxPitch:j,minPitch:X,normalize:ue,position:I},{startPanLngLat:re,startZoomLngLat:de,startRotatePos:q,startBearing:H,startPitch:J,startZoom:Ee}),K(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const u=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(u)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:s,startBearing:u,startPitch:p}=this.getState();if(!s||u===void 0||p===void 0)return this;let o;return e?o=this._getNewRotation(e,s,p,u):o={bearing:u+n,pitch:p+r},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:s,startZoomLngLat:u}=this.getState();if(u||(s=this.getViewportProps().zoom,u=this._unproject(n)||this._unproject(e)),!u)return this;const{maxZoom:p,minZoom:o}=this.getViewportProps();let v=s+Math.log2(r);v=bc(v,o,p);const T=this.makeViewport({...this.getViewportProps(),zoom:v});return this._getUpdatedState({zoom:v,...T.panByPosition(u,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:s,longitude:u}=r;return Math.abs(s-n.bearing)>180&&(r.bearing=s<0?s+360:s-360),Math.abs(u-n.longitude)>180&&(r.longitude=u<0?u+360:u-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:s}=e;e.zoom=bc(s,r,n);const{maxPitch:u,minPitch:p,pitch:o}=e;e.pitch=bc(o,p,u);const{normalize:v=!0}=e;return v&&Object.assign(e,vq(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,s){const u=e[0]-n[0],p=e[1]-n[1],o=e[1],v=n[1],{width:T,height:I}=this.getViewportProps(),L=u/T;let F=0;p>0?Math.abs(I-v)>JI&&(F=p/(v-I)*gX):p<0&&v>JI&&(F=1-o/v),F=bc(F,-1,1);const{minPitch:j,maxPitch:X}=this.getViewportProps(),re=s+180*L;let de=r;return F>0?de=r+F*(X-r):F<0&&(de=r-F*(j-r)),{pitch:de,bearing:re}}}class yX extends pX{constructor(...e){super(...e),K(this,"ControllerState",_X),K(this,"transition",{transitionDuration:300,transitionInterpolator:new ez({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),K(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class tz extends Pf{get ViewportType(){return uh}get ControllerType(){return yX}}K(tz,"displayName","MapView");const vX=new q3;function xX(t,e){var n,r;const s=(n=t.order)!==null&&n!==void 0?n:1/0,u=(r=e.order)!==null&&r!==void 0?r:1/0;return s-u}class bX{constructor(){K(this,"effects",void 0),K(this,"_resolvedEffects",[]),K(this,"_defaultEffects",[]),K(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(s=>xX(s,e)>0);r<0?n.push(e):n.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(La(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const s of this.effects)n[s.id]=s;const r=[];for(const s of e){const u=n[s.id];u&&u!==s?u.setProps?(u.setProps(s.props),r.push(u)):(u.cleanup(),r.push(s)):r.push(s),delete n[s.id]}for(const s in n)n[s].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(s=>s instanceof q3)||this._resolvedEffects.push(vX),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class wX extends WS{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const EX="deckRenderer.renderLayers";class TX{constructor(e){K(this,"gl",void 0),K(this,"layerFilter",void 0),K(this,"drawPickingColors",void 0),K(this,"drawLayersPass",void 0),K(this,"pickLayersPass",void 0),K(this,"renderCount",void 0),K(this,"_needsRedraw",void 0),K(this,"renderBuffers",void 0),K(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new wX(e),this.pickLayersPass=new Y3(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||si.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const s=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,u=n.render({...r,target:s});r.effects&&this._postRender(r.effects,r),this.renderCount++,qi(EX,this,u,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(this.gl,n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new si(this.gl),new si(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:r}=this,s={...n,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const u of e)if(u.postRender){if(u.id===this.lastPostProcessEffect){s.target=n.target,u.postRender(this.gl,s);break}const p=u.postRender(this.gl,s);s.inputBuffer=p,s.swapBuffer=p===r[0]?r[1]:r[0]}}}const SX={pickedColor:null,pickedObjectIndex:-1};function AX({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:s,deviceRect:u}){const{x:p,y:o,width:v,height:T}=u;let I=s*s,L=-1,F=0;for(let j=0;j<T;j++){const X=j+o-r,re=X*X;if(re>I)F+=4*v;else for(let de=0;de<v;de++){if(t[F+3]-1>=0){const H=de+p-n,J=H*H+re;J<=I&&(I=J,L=F)}F+=4}}if(L>=0){const j=t.slice(L,L+4),X=e(j);if(X){const re=Math.floor(L/4/v),de=L/4-re*v;return{...X,pickedColor:j,pickedX:p+de,pickedY:o+re}}ir.error("Picked non-existent layer. Is picking buffer corrupt?")()}return SX}function CX({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const u=t.slice(r,r+4),p=u.join(",");if(!n.has(p)){const o=e(u);o?n.set(p,{...o,color:u}):ir.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function nz({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:s,z:u}){let p=e[0];e.length>1&&(p=PX((t==null?void 0:t.pickedViewports)||e,{x:r,y:s}));let o;if(p){const v=[r-p.x,s-p.y];u!==void 0&&(v[2]=u),o=p.unproject(v)}return{color:null,layer:null,viewport:p,index:-1,picked:!1,x:r,y:s,pixel:[r,s],coordinate:o,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function MX(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:s}=t,{pickedColor:u,pickedLayer:p,pickedObjectIndex:o}=e,v=p?[p]:[];if(r==="hover"){const L=n.index,F=n.layerId,j=p?p.props.id:null;if(j!==F||o!==L){if(j!==F){const X=s.find(re=>re.props.id===F);X&&v.unshift(X)}n.layerId=j,n.index=o,n.info=null}}const T=nz(t),I=new Map;return I.set(null,T),v.forEach(L=>{let F={...T};L===p&&(F.color=u,F.index=o,F.picked=!0),F=rz({layer:L,info:F,mode:r});const j=F.layer;L===p&&r==="hover"&&(n.info=F),I.set(j.id,F),r==="hover"&&j.updateAutoHighlight(F)}),I}function rz({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function PX(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class IX{constructor(e){K(this,"gl",void 0),K(this,"pickingFBO",void 0),K(this,"depthFBO",void 0),K(this,"pickLayersPass",void 0),K(this,"layerFilter",void 0),K(this,"lastPickedInfo",void 0),K(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new Y3(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:s},u=this.lastPickedInfo.info){const p=u&&u.layer&&u.layer.id,o=u&&u.viewport&&u.viewport.id,v=p?r.find(F=>F.id===p):null,T=o&&s.find(F=>F.id===o)||s[0],I=T&&T.unproject([e-T.x,n-T.y]);return{...u,...{x:e,y:n,viewport:T,coordinate:I,layer:v}}}_resizeBuffer(){var e,n;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new si(r),si.isSupported(r,{colorBufferFloat:!0}))){const s=new si(r);s.attach({[36064]:new Qo(r,{format:_n(r)?34836:6408,type:5126})}),this.depthFBO=s}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:s,y:u,radius:p=0,depth:o=1,mode:v="query",unproject3D:T,onViewportActive:I,effects:L}){const F=this._getPickable(e),j=bf(this.gl);if(!F)return{result:[],emptyInfo:nz({viewports:r,x:s,y:u,pixelRatio:j})};this._resizeBuffer();const X=qb(this.gl,[s,u],!0),re=[X.x+Math.floor(X.width/2),X.y+Math.floor(X.height/2)],de=Math.round(p*j),{width:q,height:H}=this.pickingFBO,J=this._getPickingRect({deviceX:re[0],deviceY:re[1],deviceRadius:de,deviceWidth:q,deviceHeight:H}),Ee={x:s-p,y:u-p,width:p*2+1,height:p*2+1};let ue;const Fe=[],Qe=new Set;for(let at=0;at<o;at++){let rt;if(J){const Bt=this._drawAndSample({layers:F,views:n,viewports:r,onViewportActive:I,deviceRect:J,cullRect:Ee,effects:L,pass:"picking:".concat(v)});rt=AX({...Bt,deviceX:re[0],deviceY:re[1],deviceRadius:de,deviceRect:J})}else rt={pickedColor:null,pickedObjectIndex:-1};let ht;if(rt.pickedLayer&&T&&this.depthFBO){const{pickedColors:Bt}=this._drawAndSample({layers:[rt.pickedLayer],views:n,viewports:r,onViewportActive:I,deviceRect:{x:rt.pickedX,y:rt.pickedY,width:1,height:1},cullRect:Ee,effects:L,pass:"picking:".concat(v,":z")},!0);Bt[3]&&(ht=Bt[0])}rt.pickedLayer&&at+1<o&&(Qe.add(rt.pickedLayer),rt.pickedLayer.disablePickingIndex(rt.pickedObjectIndex)),ue=MX({pickInfo:rt,lastPickedInfo:this.lastPickedInfo,mode:v,layers:F,viewports:r,x:s,y:u,z:ht,pixelRatio:j});for(const Bt of ue.values())Bt.layer&&Fe.push(Bt);if(!rt.pickedColor)break}for(const at of Qe)at.restorePickingColors();return{result:Fe,emptyInfo:ue.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:s,y:u,width:p=1,height:o=1,mode:v="query",maxObjects:T=null,onViewportActive:I,effects:L}){const F=this._getPickable(e);if(!F)return[];this._resizeBuffer();const j=bf(this.gl),X=qb(this.gl,[s,u],!0),re=X.x,de=X.y+X.height,q=qb(this.gl,[s+p,u+o],!0),H=q.x+q.width,J=q.y,Ee={x:re,y:J,width:H-re,height:de-J},ue=this._drawAndSample({layers:F,views:n,viewports:r,onViewportActive:I,deviceRect:Ee,cullRect:{x:s,y:u,width:p,height:o},effects:L,pass:"picking:".concat(v)}),Fe=CX(ue),Qe=new Map,at=Number.isFinite(T);for(let rt=0;rt<Fe.length&&!(at&&T&&Qe.size>=T);rt++){const ht=Fe[rt];let Bt={color:ht.pickedColor,layer:null,index:ht.pickedObjectIndex,picked:!0,x:s,y:u,pixelRatio:j};Bt=rz({layer:ht.pickedLayer,info:Bt,mode:v}),Qe.has(Bt.object)||Qe.set(Bt.object,Bt)}return Array.from(Qe.values())}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:s,deviceRect:u,cullRect:p,effects:o,pass:v},T=!1){const I=T?this.depthFBO:this.pickingFBO,L={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:s,pickingFBO:I,deviceRect:u,cullRect:p,effects:o,pass:v,pickZ:T,preRenderStats:{}};for(const H of o)H.useInPicking&&(L.preRenderStats[H.id]=H.preRender(this.gl,L));const{decodePickingColor:F}=this.pickLayersPass.render(L),{x:j,y:X,width:re,height:de}=u,q=new(T?Float32Array:Uint8Array)(re*de*4);return Rx(I,{sourceX:j,sourceY:X,sourceWidth:re,sourceHeight:de,target:q}),{pickedColors:q,decodePickingColor:F}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:s,deviceHeight:u}){const p=Math.max(0,e-r),o=Math.max(0,n-r),v=Math.min(s,e+r+1)-p,T=Math.min(u,n+r+1)-o;return v<=0||T<=0?null:{x:p,y:o,width:v,height:T}}}const RX={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class kX{constructor(e){K(this,"el",null),K(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,RX),n.appendChild(this.el))}setTooltip(e,n,r){const s=this.el;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className),Object.assign(s.style,e.style);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform="translate(".concat(n,"px, ").concat(r,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var dh={},LX={get exports(){return dh},set exports(t){dh=t}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,s){var u=["","webkit","Moz","MS","ms","o"],p=n.createElement("div"),o="function",v=Math.round,T=Math.abs,I=Date.now;function L(Z,ie,be){return setTimeout(J(Z,be),ie)}function F(Z,ie,be){return Array.isArray(Z)?(j(Z,be[ie],be),!0):!1}function j(Z,ie,be){var Ge;if(Z)if(Z.forEach)Z.forEach(ie,be);else if(Z.length!==s)for(Ge=0;Ge<Z.length;)ie.call(be,Z[Ge],Ge,Z),Ge++;else for(Ge in Z)Z.hasOwnProperty(Ge)&&ie.call(be,Z[Ge],Ge,Z)}function X(Z,ie,be){var Ge="DEPRECATED METHOD: "+ie+`
`+be+` AT 
`;return function(){var ot=new Error("get-stack-trace"),xt=ot&&ot.stack?ot.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Yt=e.console&&(e.console.warn||e.console.log);return Yt&&Yt.call(e.console,Ge,xt),Z.apply(this,arguments)}}var re;typeof Object.assign!="function"?re=function(ie){if(ie===s||ie===null)throw new TypeError("Cannot convert undefined or null to object");for(var be=Object(ie),Ge=1;Ge<arguments.length;Ge++){var ot=arguments[Ge];if(ot!==s&&ot!==null)for(var xt in ot)ot.hasOwnProperty(xt)&&(be[xt]=ot[xt])}return be}:re=Object.assign;var de=X(function(ie,be,Ge){for(var ot=Object.keys(be),xt=0;xt<ot.length;)(!Ge||Ge&&ie[ot[xt]]===s)&&(ie[ot[xt]]=be[ot[xt]]),xt++;return ie},"extend","Use `assign`."),q=X(function(ie,be){return de(ie,be,!0)},"merge","Use `assign`.");function H(Z,ie,be){var Ge=ie.prototype,ot;ot=Z.prototype=Object.create(Ge),ot.constructor=Z,ot._super=Ge,be&&re(ot,be)}function J(Z,ie){return function(){return Z.apply(ie,arguments)}}function Ee(Z,ie){return typeof Z==o?Z.apply(ie&&ie[0]||s,ie):Z}function ue(Z,ie){return Z===s?ie:Z}function Fe(Z,ie,be){j(ht(ie),function(Ge){Z.addEventListener(Ge,be,!1)})}function Qe(Z,ie,be){j(ht(ie),function(Ge){Z.removeEventListener(Ge,be,!1)})}function at(Z,ie){for(;Z;){if(Z==ie)return!0;Z=Z.parentNode}return!1}function rt(Z,ie){return Z.indexOf(ie)>-1}function ht(Z){return Z.trim().split(/\s+/g)}function Bt(Z,ie,be){if(Z.indexOf&&!be)return Z.indexOf(ie);for(var Ge=0;Ge<Z.length;){if(be&&Z[Ge][be]==ie||!be&&Z[Ge]===ie)return Ge;Ge++}return-1}function Dn(Z){return Array.prototype.slice.call(Z,0)}function zn(Z,ie,be){for(var Ge=[],ot=[],xt=0;xt<Z.length;){var Yt=ie?Z[xt][ie]:Z[xt];Bt(ot,Yt)<0&&Ge.push(Z[xt]),ot[xt]=Yt,xt++}return be&&(ie?Ge=Ge.sort(function(vr,Fn){return vr[ie]>Fn[ie]}):Ge=Ge.sort()),Ge}function cn(Z,ie){for(var be,Ge,ot=ie[0].toUpperCase()+ie.slice(1),xt=0;xt<u.length;){if(be=u[xt],Ge=be?be+ot:ie,Ge in Z)return Ge;xt++}return s}var jt=1;function ts(){return jt++}function Ci(Z){var ie=Z.ownerDocument||Z;return ie.defaultView||ie.parentWindow||e}var wt=/mobile|tablet|ip(ad|hone|od)|android/i,Gt="ontouchstart"in e,Ot=cn(e,"PointerEvent")!==s,bn=Gt&&wt.test(navigator.userAgent),Cn="touch",Hr="pen",pr="mouse",ns="kinect",Fr=25,Mn=1,Zr=2,Hn=4,Zn=8,go=1,Vn=2,qr=4,on=8,Xr=16,Lr=Vn|qr,Gi=on|Xr,rs=Lr|Gi,ta=["x","y"],is=["clientX","clientY"];function Or(Z,ie){var be=this;this.manager=Z,this.callback=ie,this.element=Z.element,this.target=Z.options.inputTarget,this.domHandler=function(Ge){Ee(Z.options.enable,[Z])&&be.handler(Ge)},this.init()}Or.prototype={handler:function(){},init:function(){this.evEl&&Fe(this.element,this.evEl,this.domHandler),this.evTarget&&Fe(this.target,this.evTarget,this.domHandler),this.evWin&&Fe(Ci(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Qe(this.element,this.evEl,this.domHandler),this.evTarget&&Qe(this.target,this.evTarget,this.domHandler),this.evWin&&Qe(Ci(this.element),this.evWin,this.domHandler)}};function Wi(Z){var ie,be=Z.options.inputClass;return be?ie=be:Ot?ie=oa:bn?ie=oe:Gt?ie=fe:ie=os,new ie(Z,ss)}function ss(Z,ie,be){var Ge=be.pointers.length,ot=be.changedPointers.length,xt=ie&Mn&&Ge-ot===0,Yt=ie&(Hn|Zn)&&Ge-ot===0;be.isFirst=!!xt,be.isFinal=!!Yt,xt&&(Z.session={}),be.eventType=ie,na(Z,be),Z.emit("hammer.input",be),Z.recognize(be),Z.session.prevInput=be}function na(Z,ie){var be=Z.session,Ge=ie.pointers,ot=Ge.length;be.firstInput||(be.firstInput=Es(ie)),ot>1&&!be.firstMultiple?be.firstMultiple=Es(ie):ot===1&&(be.firstMultiple=!1);var xt=be.firstInput,Yt=be.firstMultiple,tr=Yt?Yt.center:xt.center,vr=ie.center=_o(Ge);ie.timeStamp=I(),ie.deltaTime=ie.timeStamp-xt.timeStamp,ie.angle=xo(tr,vr),ie.distance=Nr(tr,vr),ra(be,ie),ie.offsetDirection=vo(ie.deltaX,ie.deltaY);var Fn=yo(ie.deltaTime,ie.deltaX,ie.deltaY);ie.overallVelocityX=Fn.x,ie.overallVelocityY=Fn.y,ie.overallVelocity=T(Fn.x)>T(Fn.y)?Fn.x:Fn.y,ie.scale=Yt?bo(Yt.pointers,Ge):1,ie.rotation=Yt?Hs(Yt.pointers,Ge):0,ie.maxPointers=be.prevInput?ie.pointers.length>be.prevInput.maxPointers?ie.pointers.length:be.prevInput.maxPointers:ie.pointers.length,Va(be,ie);var vn=Z.element;at(ie.srcEvent.target,vn)&&(vn=ie.srcEvent.target),ie.target=vn}function ra(Z,ie){var be=ie.center,Ge=Z.offsetDelta||{},ot=Z.prevDelta||{},xt=Z.prevInput||{};(ie.eventType===Mn||xt.eventType===Hn)&&(ot=Z.prevDelta={x:xt.deltaX||0,y:xt.deltaY||0},Ge=Z.offsetDelta={x:be.x,y:be.y}),ie.deltaX=ot.x+(be.x-Ge.x),ie.deltaY=ot.y+(be.y-Ge.y)}function Va(Z,ie){var be=Z.lastInterval||ie,Ge=ie.timeStamp-be.timeStamp,ot,xt,Yt,tr;if(ie.eventType!=Zn&&(Ge>Fr||be.velocity===s)){var vr=ie.deltaX-be.deltaX,Fn=ie.deltaY-be.deltaY,vn=yo(Ge,vr,Fn);xt=vn.x,Yt=vn.y,ot=T(vn.x)>T(vn.y)?vn.x:vn.y,tr=vo(vr,Fn),Z.lastInterval=ie}else ot=be.velocity,xt=be.velocityX,Yt=be.velocityY,tr=be.direction;ie.velocity=ot,ie.velocityX=xt,ie.velocityY=Yt,ie.direction=tr}function Es(Z){for(var ie=[],be=0;be<Z.pointers.length;)ie[be]={clientX:v(Z.pointers[be].clientX),clientY:v(Z.pointers[be].clientY)},be++;return{timeStamp:I(),pointers:ie,center:_o(ie),deltaX:Z.deltaX,deltaY:Z.deltaY}}function _o(Z){var ie=Z.length;if(ie===1)return{x:v(Z[0].clientX),y:v(Z[0].clientY)};for(var be=0,Ge=0,ot=0;ot<ie;)be+=Z[ot].clientX,Ge+=Z[ot].clientY,ot++;return{x:v(be/ie),y:v(Ge/ie)}}function yo(Z,ie,be){return{x:ie/Z||0,y:be/Z||0}}function vo(Z,ie){return Z===ie?go:T(Z)>=T(ie)?Z<0?Vn:qr:ie<0?on:Xr}function Nr(Z,ie,be){be||(be=ta);var Ge=ie[be[0]]-Z[be[0]],ot=ie[be[1]]-Z[be[1]];return Math.sqrt(Ge*Ge+ot*ot)}function xo(Z,ie,be){be||(be=ta);var Ge=ie[be[0]]-Z[be[0]],ot=ie[be[1]]-Z[be[1]];return Math.atan2(ot,Ge)*180/Math.PI}function Hs(Z,ie){return xo(ie[1],ie[0],is)+xo(Z[1],Z[0],is)}function bo(Z,ie){return Nr(ie[0],ie[1],is)/Nr(Z[0],Z[1],is)}var ja={mousedown:Mn,mousemove:Zr,mouseup:Hn},ia="mousedown",sa="mousemove mouseup";function os(){this.evEl=ia,this.evWin=sa,this.pressed=!1,Or.apply(this,arguments)}H(os,Or,{handler:function(ie){var be=ja[ie.type];be&Mn&&ie.button===0&&(this.pressed=!0),be&Zr&&ie.which!==1&&(be=Hn),this.pressed&&(be&Hn&&(this.pressed=!1),this.callback(this.manager,be,{pointers:[ie],changedPointers:[ie],pointerType:pr,srcEvent:ie}))}});var Ga={pointerdown:Mn,pointermove:Zr,pointerup:Hn,pointercancel:Zn,pointerout:Zn},wo={2:Cn,3:Hr,4:pr,5:ns},Mi="pointerdown",Zs="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Mi="MSPointerDown",Zs="MSPointerMove MSPointerUp MSPointerCancel");function oa(){this.evEl=Mi,this.evWin=Zs,Or.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}H(oa,Or,{handler:function(ie){var be=this.store,Ge=!1,ot=ie.type.toLowerCase().replace("ms",""),xt=Ga[ot],Yt=wo[ie.pointerType]||ie.pointerType,tr=Yt==Cn,vr=Bt(be,ie.pointerId,"pointerId");xt&Mn&&(ie.button===0||tr)?vr<0&&(be.push(ie),vr=be.length-1):xt&(Hn|Zn)&&(Ge=!0),!(vr<0)&&(be[vr]=ie,this.callback(this.manager,xt,{pointers:be,changedPointers:[ie],pointerType:Yt,srcEvent:ie}),Ge&&be.splice(vr,1))}});var Cl={touchstart:Mn,touchmove:Zr,touchend:Hn,touchcancel:Zn},aa="touchstart",Eo="touchstart touchmove touchend touchcancel";function ai(){this.evTarget=aa,this.evWin=Eo,this.started=!1,Or.apply(this,arguments)}H(ai,Or,{handler:function(ie){var be=Cl[ie.type];if(be===Mn&&(this.started=!0),!!this.started){var Ge=qs.call(this,ie,be);be&(Hn|Zn)&&Ge[0].length-Ge[1].length===0&&(this.started=!1),this.callback(this.manager,be,{pointers:Ge[0],changedPointers:Ge[1],pointerType:Cn,srcEvent:ie})}}});function qs(Z,ie){var be=Dn(Z.touches),Ge=Dn(Z.changedTouches);return ie&(Hn|Zn)&&(be=zn(be.concat(Ge),"identifier",!0)),[be,Ge]}var Ml={touchstart:Mn,touchmove:Zr,touchend:Hn,touchcancel:Zn},To="touchstart touchmove touchend touchcancel";function oe(){this.evTarget=To,this.targetIds={},Or.apply(this,arguments)}H(oe,Or,{handler:function(ie){var be=Ml[ie.type],Ge=B.call(this,ie,be);Ge&&this.callback(this.manager,be,{pointers:Ge[0],changedPointers:Ge[1],pointerType:Cn,srcEvent:ie})}});function B(Z,ie){var be=Dn(Z.touches),Ge=this.targetIds;if(ie&(Mn|Zr)&&be.length===1)return Ge[be[0].identifier]=!0,[be,be];var ot,xt,Yt=Dn(Z.changedTouches),tr=[],vr=this.target;if(xt=be.filter(function(Fn){return at(Fn.target,vr)}),ie===Mn)for(ot=0;ot<xt.length;)Ge[xt[ot].identifier]=!0,ot++;for(ot=0;ot<Yt.length;)Ge[Yt[ot].identifier]&&tr.push(Yt[ot]),ie&(Hn|Zn)&&delete Ge[Yt[ot].identifier],ot++;if(tr.length)return[zn(xt.concat(tr),"identifier",!0),tr]}var G=2500,se=25;function fe(){Or.apply(this,arguments);var Z=J(this.handler,this);this.touch=new oe(this.manager,Z),this.mouse=new os(this.manager,Z),this.primaryTouch=null,this.lastTouches=[]}H(fe,Or,{handler:function(ie,be,Ge){var ot=Ge.pointerType==Cn,xt=Ge.pointerType==pr;if(!(xt&&Ge.sourceCapabilities&&Ge.sourceCapabilities.firesTouchEvents)){if(ot)we.call(this,be,Ge);else if(xt&&Me.call(this,Ge))return;this.callback(ie,be,Ge)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function we(Z,ie){Z&Mn?(this.primaryTouch=ie.changedPointers[0].identifier,Ce.call(this,ie)):Z&(Hn|Zn)&&Ce.call(this,ie)}function Ce(Z){var ie=Z.changedPointers[0];if(ie.identifier===this.primaryTouch){var be={x:ie.clientX,y:ie.clientY};this.lastTouches.push(be);var Ge=this.lastTouches,ot=function(){var xt=Ge.indexOf(be);xt>-1&&Ge.splice(xt,1)};setTimeout(ot,G)}}function Me(Z){for(var ie=Z.srcEvent.clientX,be=Z.srcEvent.clientY,Ge=0;Ge<this.lastTouches.length;Ge++){var ot=this.lastTouches[Ge],xt=Math.abs(ie-ot.x),Yt=Math.abs(be-ot.y);if(xt<=se&&Yt<=se)return!0}return!1}var Se=cn(p.style,"touchAction"),Re=Se!==s,Xe="compute",ft="auto",et="manipulation",Ct="none",St="pan-x",Tt="pan-y",Lt=Dt();function Ht(Z,ie){this.manager=Z,this.set(ie)}Ht.prototype={set:function(Z){Z==Xe&&(Z=this.compute()),Re&&this.manager.element.style&&Lt[Z]&&(this.manager.element.style[Se]=Z),this.actions=Z.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Z=[];return j(this.manager.recognizers,function(ie){Ee(ie.options.enable,[ie])&&(Z=Z.concat(ie.getTouchAction()))}),un(Z.join(" "))},preventDefaults:function(Z){var ie=Z.srcEvent,be=Z.offsetDirection;if(this.manager.session.prevented){ie.preventDefault();return}var Ge=this.actions,ot=rt(Ge,Ct)&&!Lt[Ct],xt=rt(Ge,Tt)&&!Lt[Tt],Yt=rt(Ge,St)&&!Lt[St];if(ot){var tr=Z.pointers.length===1,vr=Z.distance<2,Fn=Z.deltaTime<250;if(tr&&vr&&Fn)return}if(!(Yt&&xt)&&(ot||xt&&be&Lr||Yt&&be&Gi))return this.preventSrc(ie)},preventSrc:function(Z){this.manager.session.prevented=!0,Z.preventDefault()}};function un(Z){if(rt(Z,Ct))return Ct;var ie=rt(Z,St),be=rt(Z,Tt);return ie&&be?Ct:ie||be?ie?St:Tt:rt(Z,et)?et:ft}function Dt(){if(!Re)return!1;var Z={},ie=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(be){Z[be]=ie?e.CSS.supports("touch-action",be):!0}),Z}var dn=1,Kt=2,yi=4,Br=8,je=Br,vi=16,wn=32;function Ur(Z){this.options=re({},this.defaults,Z||{}),this.id=ts(),this.manager=null,this.options.enable=ue(this.options.enable,!0),this.state=dn,this.simultaneous={},this.requireFail=[]}Ur.prototype={defaults:{},set:function(Z){return re(this.options,Z),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Z){if(F(Z,"recognizeWith",this))return this;var ie=this.simultaneous;return Z=Ts(Z,this),ie[Z.id]||(ie[Z.id]=Z,Z.recognizeWith(this)),this},dropRecognizeWith:function(Z){return F(Z,"dropRecognizeWith",this)?this:(Z=Ts(Z,this),delete this.simultaneous[Z.id],this)},requireFailure:function(Z){if(F(Z,"requireFailure",this))return this;var ie=this.requireFail;return Z=Ts(Z,this),Bt(ie,Z)===-1&&(ie.push(Z),Z.requireFailure(this)),this},dropRequireFailure:function(Z){if(F(Z,"dropRequireFailure",this))return this;Z=Ts(Z,this);var ie=Bt(this.requireFail,Z);return ie>-1&&this.requireFail.splice(ie,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Z){return!!this.simultaneous[Z.id]},emit:function(Z){var ie=this,be=this.state;function Ge(ot){ie.manager.emit(ot,Z)}be<Br&&Ge(ie.options.event+Zc(be)),Ge(ie.options.event),Z.additionalEvent&&Ge(Z.additionalEvent),be>=Br&&Ge(ie.options.event+Zc(be))},tryEmit:function(Z){if(this.canEmit())return this.emit(Z);this.state=wn},canEmit:function(){for(var Z=0;Z<this.requireFail.length;){if(!(this.requireFail[Z].state&(wn|dn)))return!1;Z++}return!0},recognize:function(Z){var ie=re({},Z);if(!Ee(this.options.enable,[this,ie])){this.reset(),this.state=wn;return}this.state&(je|vi|wn)&&(this.state=dn),this.state=this.process(ie),this.state&(Kt|yi|Br|vi)&&this.tryEmit(ie)},process:function(Z){},getTouchAction:function(){},reset:function(){}};function Zc(Z){return Z&vi?"cancel":Z&Br?"end":Z&yi?"move":Z&Kt?"start":""}function $i(Z){return Z==Xr?"down":Z==on?"up":Z==Vn?"left":Z==qr?"right":""}function Ts(Z,ie){var be=ie.manager;return be?be.get(Z):Z}function Pi(){Ur.apply(this,arguments)}H(Pi,Ur,{defaults:{pointers:1},attrTest:function(Z){var ie=this.options.pointers;return ie===0||Z.pointers.length===ie},process:function(Z){var ie=this.state,be=Z.eventType,Ge=ie&(Kt|yi),ot=this.attrTest(Z);return Ge&&(be&Zn||!ot)?ie|vi:Ge||ot?be&Hn?ie|Br:ie&Kt?ie|yi:Kt:wn}});function Ss(){Pi.apply(this,arguments),this.pX=null,this.pY=null}H(Ss,Pi,{defaults:{event:"pan",threshold:10,pointers:1,direction:rs},getTouchAction:function(){var Z=this.options.direction,ie=[];return Z&Lr&&ie.push(Tt),Z&Gi&&ie.push(St),ie},directionTest:function(Z){var ie=this.options,be=!0,Ge=Z.distance,ot=Z.direction,xt=Z.deltaX,Yt=Z.deltaY;return ot&ie.direction||(ie.direction&Lr?(ot=xt===0?go:xt<0?Vn:qr,be=xt!=this.pX,Ge=Math.abs(Z.deltaX)):(ot=Yt===0?go:Yt<0?on:Xr,be=Yt!=this.pY,Ge=Math.abs(Z.deltaY))),Z.direction=ot,be&&Ge>ie.threshold&&ot&ie.direction},attrTest:function(Z){return Pi.prototype.attrTest.call(this,Z)&&(this.state&Kt||!(this.state&Kt)&&this.directionTest(Z))},emit:function(Z){this.pX=Z.deltaX,this.pY=Z.deltaY;var ie=$i(Z.direction);ie&&(Z.additionalEvent=this.options.event+ie),this._super.emit.call(this,Z)}});function lt(){Pi.apply(this,arguments)}H(lt,Pi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ct]},attrTest:function(Z){return this._super.attrTest.call(this,Z)&&(Math.abs(Z.scale-1)>this.options.threshold||this.state&Kt)},emit:function(Z){if(Z.scale!==1){var ie=Z.scale<1?"in":"out";Z.additionalEvent=this.options.event+ie}this._super.emit.call(this,Z)}});function Xt(){Ur.apply(this,arguments),this._timer=null,this._input=null}H(Xt,Ur,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ft]},process:function(Z){var ie=this.options,be=Z.pointers.length===ie.pointers,Ge=Z.distance<ie.threshold,ot=Z.deltaTime>ie.time;if(this._input=Z,!Ge||!be||Z.eventType&(Hn|Zn)&&!ot)this.reset();else if(Z.eventType&Mn)this.reset(),this._timer=L(function(){this.state=je,this.tryEmit()},ie.time,this);else if(Z.eventType&Hn)return je;return wn},reset:function(){clearTimeout(this._timer)},emit:function(Z){this.state===je&&(Z&&Z.eventType&Hn?this.manager.emit(this.options.event+"up",Z):(this._input.timeStamp=I(),this.manager.emit(this.options.event,this._input)))}});function Zt(){Pi.apply(this,arguments)}H(Zt,Pi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ct]},attrTest:function(Z){return this._super.attrTest.call(this,Z)&&(Math.abs(Z.rotation)>this.options.threshold||this.state&Kt)}});function Ii(){Pi.apply(this,arguments)}H(Ii,Pi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Lr|Gi,pointers:1},getTouchAction:function(){return Ss.prototype.getTouchAction.call(this)},attrTest:function(Z){var ie=this.options.direction,be;return ie&(Lr|Gi)?be=Z.overallVelocity:ie&Lr?be=Z.overallVelocityX:ie&Gi&&(be=Z.overallVelocityY),this._super.attrTest.call(this,Z)&&ie&Z.offsetDirection&&Z.distance>this.options.threshold&&Z.maxPointers==this.options.pointers&&T(be)>this.options.velocity&&Z.eventType&Hn},emit:function(Z){var ie=$i(Z.offsetDirection);ie&&this.manager.emit(this.options.event+ie,Z),this.manager.emit(this.options.event,Z)}});function as(){Ur.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}H(as,Ur,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[et]},process:function(Z){var ie=this.options,be=Z.pointers.length===ie.pointers,Ge=Z.distance<ie.threshold,ot=Z.deltaTime<ie.time;if(this.reset(),Z.eventType&Mn&&this.count===0)return this.failTimeout();if(Ge&&ot&&be){if(Z.eventType!=Hn)return this.failTimeout();var xt=this.pTime?Z.timeStamp-this.pTime<ie.interval:!0,Yt=!this.pCenter||Nr(this.pCenter,Z.center)<ie.posThreshold;this.pTime=Z.timeStamp,this.pCenter=Z.center,!Yt||!xt?this.count=1:this.count+=1,this._input=Z;var tr=this.count%ie.taps;if(tr===0)return this.hasRequireFailures()?(this._timer=L(function(){this.state=je,this.tryEmit()},ie.interval,this),Kt):je}return wn},failTimeout:function(){return this._timer=L(function(){this.state=wn},this.options.interval,this),wn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==je&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Wt(Z,ie){return ie=ie||{},ie.recognizers=ue(ie.recognizers,Wt.defaults.preset),new Xs(Z,ie)}Wt.VERSION="2.0.7",Wt.defaults={domEvents:!1,touchAction:Xe,enable:!0,inputTarget:null,inputClass:null,preset:[[Zt,{enable:!1}],[lt,{enable:!1},["rotate"]],[Ii,{direction:Lr}],[Ss,{direction:Lr},["swipe"]],[as],[as,{event:"doubletap",taps:2},["tap"]],[Xt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Wa=1,So=2;function Xs(Z,ie){this.options=re({},Wt.defaults,ie||{}),this.options.inputTarget=this.options.inputTarget||Z,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Z,this.input=Wi(this),this.touchAction=new Ht(this,this.options.touchAction),Vr(this,!0),j(this.options.recognizers,function(be){var Ge=this.add(new be[0](be[1]));be[2]&&Ge.recognizeWith(be[2]),be[3]&&Ge.requireFailure(be[3])},this)}Xs.prototype={set:function(Z){return re(this.options,Z),Z.touchAction&&this.touchAction.update(),Z.inputTarget&&(this.input.destroy(),this.input.target=Z.inputTarget,this.input.init()),this},stop:function(Z){this.session.stopped=Z?So:Wa},recognize:function(Z){var ie=this.session;if(!ie.stopped){this.touchAction.preventDefaults(Z);var be,Ge=this.recognizers,ot=ie.curRecognizer;(!ot||ot&&ot.state&je)&&(ot=ie.curRecognizer=null);for(var xt=0;xt<Ge.length;)be=Ge[xt],ie.stopped!==So&&(!ot||be==ot||be.canRecognizeWith(ot))?be.recognize(Z):be.reset(),!ot&&be.state&(Kt|yi|Br)&&(ot=ie.curRecognizer=be),xt++}},get:function(Z){if(Z instanceof Ur)return Z;for(var ie=this.recognizers,be=0;be<ie.length;be++)if(ie[be].options.event==Z)return ie[be];return null},add:function(Z){if(F(Z,"add",this))return this;var ie=this.get(Z.options.event);return ie&&this.remove(ie),this.recognizers.push(Z),Z.manager=this,this.touchAction.update(),Z},remove:function(Z){if(F(Z,"remove",this))return this;if(Z=this.get(Z),Z){var ie=this.recognizers,be=Bt(ie,Z);be!==-1&&(ie.splice(be,1),this.touchAction.update())}return this},on:function(Z,ie){if(Z!==s&&ie!==s){var be=this.handlers;return j(ht(Z),function(Ge){be[Ge]=be[Ge]||[],be[Ge].push(ie)}),this}},off:function(Z,ie){if(Z!==s){var be=this.handlers;return j(ht(Z),function(Ge){ie?be[Ge]&&be[Ge].splice(Bt(be[Ge],ie),1):delete be[Ge]}),this}},emit:function(Z,ie){this.options.domEvents&&Pn(Z,ie);var be=this.handlers[Z]&&this.handlers[Z].slice();if(!(!be||!be.length)){ie.type=Z,ie.preventDefault=function(){ie.srcEvent.preventDefault()};for(var Ge=0;Ge<be.length;)be[Ge](ie),Ge++}},destroy:function(){this.element&&Vr(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Vr(Z,ie){var be=Z.element;if(be.style){var Ge;j(Z.options.cssProps,function(ot,xt){Ge=cn(be.style,xt),ie?(Z.oldCssProps[Ge]=be.style[Ge],be.style[Ge]=ot):be.style[Ge]=Z.oldCssProps[Ge]||""}),ie||(Z.oldCssProps={})}}function Pn(Z,ie){var be=n.createEvent("Event");be.initEvent(Z,!0,!0),be.gesture=ie,ie.target.dispatchEvent(be)}re(Wt,{INPUT_START:Mn,INPUT_MOVE:Zr,INPUT_END:Hn,INPUT_CANCEL:Zn,STATE_POSSIBLE:dn,STATE_BEGAN:Kt,STATE_CHANGED:yi,STATE_ENDED:Br,STATE_RECOGNIZED:je,STATE_CANCELLED:vi,STATE_FAILED:wn,DIRECTION_NONE:go,DIRECTION_LEFT:Vn,DIRECTION_RIGHT:qr,DIRECTION_UP:on,DIRECTION_DOWN:Xr,DIRECTION_HORIZONTAL:Lr,DIRECTION_VERTICAL:Gi,DIRECTION_ALL:rs,Manager:Xs,Input:Or,TouchAction:Ht,TouchInput:oe,MouseInput:os,PointerEventInput:oa,TouchMouseInput:fe,SingleTouchInput:ai,Recognizer:Ur,AttrRecognizer:Pi,Tap:as,Pan:Ss,Swipe:Ii,Pinch:lt,Rotate:Zt,Press:Xt,on:Fe,off:Qe,each:j,merge:q,extend:de,assign:re,inherit:H,bindFn:J,prefixed:cn});var vh=typeof e<"u"?e:typeof self<"u"?self:{};vh.Hammer=Wt,typeof s=="function"&&s.amd?s(function(){return Wt}):t.exports?t.exports=Wt:e[r]=Wt})(window,document,"Hammer")})(LX);const OX=dh,Aa=ix({__proto__:null,default:OX},[dh]),iz=1,sz=2,nT=4,DX={mousedown:iz,mousemove:sz,mouseup:nT};function zX(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function FX(t){const e=t.prototype.handler;t.prototype.handler=function(r){const s=this.store;r.button>0&&r.type==="pointerdown"&&(zX(s,u=>u.pointerId===r.pointerId)||s.push(r)),e.call(this,r)}}function NX(t){t.prototype.handler=function(n){let r=DX[n.type];r&iz&&n.button>=0&&(this.pressed=!0),r&sz&&n.which===0&&(r=nT),this.pressed&&(r&nT&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}FX(dh.PointerEventInput);NX(dh.MouseInput);const BX=dh.Manager;class kx{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const UX=Aa?[[Aa.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Aa.Rotate,{enable:!1}],[Aa.Pinch,{enable:!1}],[Aa.Swipe,{enable:!1}],[Aa.Pan,{threshold:0,enable:!1}],[Aa.Press,{enable:!1}],[Aa.Tap,{event:"doubletap",taps:2,enable:!1}],[Aa.Tap,{event:"anytap",enable:!1}],[Aa.Tap,{enable:!1}]]:null,QI={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},VX={doubletap:["tap"]},jX={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},qS={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},GX={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},eR={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},WX=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Zd=typeof window<"u"?window:global;let rT=!1;try{const t={get passive(){return rT=!0,!0}};Zd.addEventListener("test",null,t),Zd.removeEventListener("test",null)}catch{rT=!1}const $X=WX.indexOf("firefox")!==-1,{WHEEL_EVENTS:HX}=qS,tR="wheel",nR=4.000244140625,ZX=40,qX=.25;class XX extends kx{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{if(!this.options.enable)return;let u=s.deltaY;Zd.WheelEvent&&($X&&s.deltaMode===Zd.WheelEvent.DOM_DELTA_PIXEL&&(u/=Zd.devicePixelRatio),s.deltaMode===Zd.WheelEvent.DOM_DELTA_LINE&&(u*=ZX)),u!==0&&u%nR===0&&(u=Math.floor(u/nR)),s.shiftKey&&u&&(u=u*qX),this.callback({type:tR,center:{x:s.clientX,y:s.clientY},delta:-u,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(HX),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,rT?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===tR&&(this.options.enable=n)}}const{MOUSE_EVENTS:YX}=qS,rR="pointermove",iR="pointerover",sR="pointerout",oR="pointerenter",aR="pointerleave";class KX extends kx{constructor(e,n,r){super(e,n,r),this.handleEvent=u=>{this.handleOverEvent(u),this.handleOutEvent(u),this.handleEnterEvent(u),this.handleLeaveEvent(u),this.handleMoveEvent(u)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(YX),this.events.forEach(u=>e.addEventListener(u,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===rR&&(this.enableMoveEvent=n),e===iR&&(this.enableOverEvent=n),e===sR&&(this.enableOutEvent=n),e===oR&&(this.enableEnterEvent=n),e===aR&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(iR,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(sR,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(oR,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(aR,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(rR,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:JX}=qS,lR="keydown",cR="keyup";class QX extends kx{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{const u=s.target||s.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:lR,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:cR,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(JX),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===lR&&(this.enableDownEvent=n),e===cR&&(this.enableUpEvent=n)}}const uR="contextmenu";class eY extends kx{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.options.enable&&this.callback({type:uR,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===uR&&(this.options.enable=n)}}const iT=1,$v=2,sT=4,tY={pointerdown:iT,pointermove:$v,pointerup:sT,mousedown:iT,mousemove:$v,mouseup:sT},nY=1,rY=2,iY=3,sY=0,oY=1,aY=2,lY=1,cY=2,uY=4;function hY(t){const e=tY[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r,which:s}=t.srcEvent;let u=!1,p=!1,o=!1;return e===sT||e===$v&&!Number.isFinite(n)?(u=s===nY,p=s===rY,o=s===iY):e===$v?(u=!!(n&lY),p=!!(n&uY),o=!!(n&cY)):e===iT&&(u=r===sY,p=r===oY,o=r===aY),{leftButton:u,middleButton:p,rightButton:o}}function dY(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),s=r.width/e.offsetWidth||1,u=r.height/e.offsetHeight||1,p={x:(n.x-r.left-e.clientLeft)/s,y:(n.y-r.top-e.clientTop)/u};return{center:n,offsetCenter:p}}const dw={srcElement:"root",priority:0};class fY{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let s=n.srcEvent.target;for(;s&&s!==r.rootElement;){if(this._emit(r,s),r.handled)return;s=s.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,s=!1,u=!1){const{handlers:p,handlersByElement:o}=this;let v=dw;typeof r=="string"||r&&r.addEventListener?v={...dw,srcElement:r}:r&&(v={...dw,...r});let T=o.get(v.srcElement);T||(T=[],o.set(v.srcElement,T));const I={type:e,handler:n,srcElement:v.srcElement,priority:v.priority};s&&(I.once=!0),u&&(I.passive=!0),p.push(I),this._active=this._active||!I.passive;let L=T.length-1;for(;L>=0&&!(T[L].priority>=I.priority);)L--;T.splice(L+1,0,I)}remove(e,n){const{handlers:r,handlersByElement:s}=this;for(let u=r.length-1;u>=0;u--){const p=r[u];if(p.type===e&&p.handler===n){r.splice(u,1);const o=s.get(p.srcElement);o.splice(o.indexOf(p),1),o.length===0&&s.delete(p.srcElement)}}this._active=r.some(u=>!u.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let s=!1;const u=()=>{e.handled=!0},p=()=>{e.handled=!0,s=!0},o=[];for(let v=0;v<r.length;v++){const{type:T,handler:I,once:L}=r[v];if(I({...e,type:T,stopPropagation:u,stopImmediatePropagation:p}),L&&o.push(r[v]),s)break}for(let v=0;v<o.length;v++){const{type:T,handler:I}=o[v];this.remove(T,I)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...hY(e),...dY(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const pY={events:null,recognizers:null,recognizerOptions:{},Manager:BX,touchAction:"none",tabIndex:0};class mY{constructor(e=null,n){this._onBasicInput=s=>{const{srcEvent:u}=s,p=jX[u.type];p&&this.manager.emit(p,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...pY,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||UX}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(QI).forEach(s=>{const u=this.manager.get(s);u&&QI[s].forEach(p=>{u.recognizeWith(p)})});for(const s in n.recognizerOptions){const u=this.manager.get(s);if(u){const p=n.recognizerOptions[s];delete p.enable,u.set(p)}}this.wheelInput=new XX(e,this._onOtherEvent,{enable:!1}),this.moveInput=new KX(e,this._onOtherEvent,{enable:!1}),this.keyInput=new QX(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new eY(e,this._onOtherEvent,{enable:!1});for(const[s,u]of this.events)u.isEmpty()||(this._toggleRecognizer(u.recognizerName,!0),this.manager.on(s,u.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const s=r.get(e);if(s&&s.options.enable!==n){s.set({enable:n});const u=VX[e];u&&!this.options.recognizers&&u.forEach(p=>{const o=r.get(p);n?(o.requireFailure(e),s.dropRequireFailure(p)):o.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,s,u){if(typeof e!="string"){r=n;for(const I in e)this._addEventHandler(I,e[I],r,s,u);return}const{manager:p,events:o}=this,v=eR[e]||e;let T=o.get(v);T||(T=new fY(this),o.set(v,T),T.recognizerName=GX[v]||v,p&&p.on(v,T.handleEvent)),T.add(e,n,r,s,u),T.isEmpty()||this._toggleRecognizer(T.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const p in e)this._removeEventHandler(p,e[p]);return}const{events:r}=this,s=eR[e]||e,u=r.get(s);if(u&&(u.remove(e,n),u.isEmpty())){const{recognizerName:p}=u;let o=!1;for(const v of r.values())if(v.recognizerName===p&&!v.isEmpty()){o=!0;break}o||this._toggleRecognizer(p,!1)}}}function Nu(){}const gY=({isDragging:t})=>t?"grabbing":"grab",oz={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Nu,onResize:Nu,onViewStateChange:Nu,onInteractionStateChange:Nu,onBeforeRender:Nu,onAfterRender:Nu,onLoad:Nu,onError:t=>ir.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:gY,getTooltip:null,debug:!1,drawPickingColors:!1};class Lx{constructor(e){K(this,"props",void 0),K(this,"width",0),K(this,"height",0),K(this,"userData",{}),K(this,"canvas",null),K(this,"viewManager",null),K(this,"layerManager",null),K(this,"effectManager",null),K(this,"deckRenderer",null),K(this,"deckPicker",null),K(this,"eventManager",null),K(this,"tooltip",null),K(this,"metrics",void 0),K(this,"animationLoop",void 0),K(this,"stats",void 0),K(this,"viewState",void 0),K(this,"cursorState",void 0),K(this,"_needsRedraw",void 0),K(this,"_pickRequest",void 0),K(this,"_lastPointerDownInfo",null),K(this,"_metricsCounter",void 0),K(this,"_onPointerMove",n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const s=n.offsetCenter;if(!s)return;r.x=s.x,r.y=s.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n}),K(this,"_onEvent",n=>{const r=YP[n.type],s=n.offsetCenter;if(!r||!s||!this.layerManager)return;const u=this.layerManager.getLayers(),p=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:u,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:o}=p,v=o&&(o[r.handler]||o.props[r.handler]),T=this.props[r.handler];let I=!1;v&&(I=v.call(o,p,n)),!I&&T&&T(p,n)}),K(this,"_onPointerDown",n=>{const r=n.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo}),this.props={...oz,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&ir.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),BD()==="IE"&&ir.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new PS({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Pg.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,s,u,p,o;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(r=this.effectManager)===null||r===void 0||r.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(u=this.deckPicker)===null||u===void 0||u.finalize(),this.deckPicker=null,(p=this.eventManager)===null||p===void 0||p.destroy(),this.eventManager=null,(o=this.tooltip)===null||o===void 0||o.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var v;(v=this.canvas.parentElement)===null||v===void 0||v.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ir.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ir.removed("onLayerClick","onClick")(),e.initialViewState&&!La(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),u=this.effectManager.needsRedraw(e),p=this.deckRenderer.needsRedraw(e);return n=n||r||s||u||p,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ti(this.viewManager),this.viewManager.views}getViewports(e){return Ti(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,r){Ti(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(n).timeStart();const u=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return s.get(n).timeEnd(),u}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ti(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const u=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=u}if(r||r===0){var s;const u=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((s=e.style)===null||s===void 0?void 0:s.position)||"absolute",this.canvas.style.height=u}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth||e.width,r=e.clientHeight||e.height;if(n!==this.width||r!==this.height){var s;this.width=n,this.height=r,(s=this.viewManager)===null||s===void 0||s.setProps({width:n,height:r}),this.props.onResize({width:n,height:r})}}_createAnimationLoop(e){const{width:n,height:r,gl:s,glOptions:u,debug:p,onError:o,onBeforeRender:v,onAfterRender:T,useDevicePixels:I}=e;return new _7({width:n,height:r,useDevicePixels:I,autoResizeViewport:!1,gl:s,onCreateContext:L=>i3({...u,...L,canvas:this.canvas,debug:p,onContextLost:()=>this._onContextLost()}),onInitialize:L=>this._setGLContext(L.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:v,onAfterRender:T,onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new tz({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:s}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let u=s,p=!1;for(const o of r){var n;u=o,p=((n=o.layer)===null||n===void 0?void 0:n.onHover(o,e.event))||p}if(!p&&this.props.onHover&&this.props.onHover(u,e.event),this.props.getTooltip&&this.tooltip){const o=this.props.getTooltip(u);this.tooltip.setTooltip(o,u.x,u.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,zS(e,{enable:!0,copyState:!0})),this.tooltip=new kX(this.canvas),xl(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new O3;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new mY(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in YP)this.eventManager.on(s,this._onEvent);this.viewManager=new oX({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new sX(e,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new bX,this.deckRenderer=new TX(e),this.deckPicker=new IX(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:r}=this.layerManager.context;xl(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ir.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=qu.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}K(Lx,"defaultProps",oz);K(Lx,"VERSION",w9);class fw{constructor(e,n){K(this,"opts",void 0),K(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:r}=this.source,{size:s}=n;let u=r;if(r&&r.length!==s){u=new Float32Array(s);const p=n.elementOffset||0;for(let o=0;o<s;++o)u[o]=r[p+o]}return u}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function _Y(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Y0(t){return t.stride||t.size*t.bytesPerElement}function az(t,e){e.offset&&ir.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Y0(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,u=r*n+s*t.bytesPerElement+(t.offset||0);return{...e,offset:u,stride:n}}function yY(t,e){const n=az(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class vY{constructor(e,n,r){K(this,"gl",void 0),K(this,"id",void 0),K(this,"size",void 0),K(this,"settings",void 0),K(this,"value",void 0),K(this,"doublePrecision",void 0),K(this,"_buffer",void 0),K(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const s=n.logicalType||n.type,u=s===5130;let{defaultValue:p}=n;p=Number.isFinite(p)?[p]:p||new Array(this.size).fill(0);let o;u?o=5126:!s&&n.isIndexed?o=e&&ZW(e,_r.ELEMENT_INDEX_UINT32)?5125:5123:o=s||5126;let v=_Y(s||o||5126);this.doublePrecision=u,u&&n.fp64===!1&&(v=Float32Array),this.value=null,this.settings={...n,defaultType:v,defaultValue:p,logicalType:s,type:o,size:this.size,bytesPerElement:v.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new rr(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Y0(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Pg.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const r={},s=this.value instanceof Float64Array,u=yY(this.getAccessor(),n||{});return r[e]=new fw(this,u.high),r["".concat(e,"64Low")]=s?new fw(this,u.low):new Float32Array(this.size),r}if(n){const r=az(this.getAccessor(),n);return{[e]:new fw(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:s}=this,u=r*s;if(n&&u&&n.length>=u){const p=new Array(s).fill(1/0),o=new Array(s).fill(-1/0);for(let v=0;v<u;)for(let T=0;T<s;T++){const I=n[v++];I<p[T]&&(p[T]=I),I>o[T]&&(o[T]=I)}e=[p,o]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof rr?r={buffer:e}:r=e;const s={...this.settings,...r};if(n.bufferAccessor=s,n.bounds=null,r.constant){let u=r.value;if(u=this._normalizeValue(u,[],0),this.settings.normalized&&(u=this.normalizeConstant(u)),!(!n.constant||!this._areValuesEqual(u,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=u}else if(r.buffer){const u=r.buffer;n.externalBuffer=u,n.constant=!1,this.value=r.value||null;const p=r.value instanceof Float64Array;s.type=r.type||u.accessor.type,s.bytesPerElement=u.accessor.BYTES_PER_ELEMENT*(p?2:1),s.stride=Y0(s)}else if(r.value){this._checkExternalBuffer(r);let u=r.value;n.externalBuffer=null,n.constant=!1,this.value=u,s.bytesPerElement=u.BYTES_PER_ELEMENT,s.stride=Y0(s);const{buffer:p,byteOffset:o}=this;this.doublePrecision&&u instanceof Float64Array&&(u=cw(u,s));const v=u.byteLength+o+s.stride*2;p.byteLength<v&&p.reallocate(v),p.setAccessor(null),p.subData({data:u,offset:o}),s.type=r.type||p.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:s}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?cw(n,{size:this.size,startIndex:r,endIndex:s}):n.subarray(r,s),offset:r*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:r}=this,s=r.allocatedValue,u=Pg.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=u;const{buffer:p,byteOffset:o}=this;return p.byteLength<u.byteLength+o&&(p.reallocate(u.byteLength+o),n&&s&&p.subData({data:s instanceof Float64Array?cw(s,this):s,offset:o})),r.allocatedValue=u,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=n.BYTES_PER_ELEMENT<4),s)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&ir.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:s,size:u}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let p=u;for(;--p>=0;)n[r+p]=s[p];return n}switch(u){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let p=u;for(;--p>=0;)n[r+p]=Number.isFinite(e[p])?e[p]:s[p]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let s=0;s<r;s++)if(e[s]!==n[s])return!1;return!0}}const hR=[],dR=[];function xY(t,e=0,n=1/0){let r=hR;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(dR.length=t.length,r=dR):r=hR,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),s.index=e-1),{iterable:r,objectInfo:s}}function lz(t){return t&&t[Symbol.asyncIterator]}function bY(t,e){const{size:n,stride:r,offset:s,startIndices:u,nested:p}=e,o=t.BYTES_PER_ELEMENT,v=r?r/o:n,T=s?s/o:0,I=Math.floor((t.length-T)/v);return(L,{index:F,target:j})=>{if(!u){const q=F*v+T;for(let H=0;H<n;H++)j[H]=t[q+H];return j}const X=u[F],re=u[F+1]||I;let de;if(p){de=new Array(re-X);for(let q=X;q<re;q++){const H=q*v+T;j=new Array(n);for(let J=0;J<n;J++)j[J]=t[H+J];de[q-X]=j}}else if(v===n)de=t.subarray(X*n+T,re*n+T);else{de=new t.constructor((re-X)*n);let q=0;for(let H=X;H<re;H++){const J=H*v+T;for(let Ee=0;Ee<n;Ee++)de[q++]=t[J+Ee]}}return de}}const wY=[],K0=[[0,1/0]];function EY(t,e){if(t===K0||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let s=0;for(let u=0;u<r;u++){const p=t[u];p[1]<e[0]?(n.push(p),s=u+1):p[0]>e[1]?n.push(p):e=[Math.min(p[0],e[0]),Math.max(p[1],e[1])]}return n.splice(s,0,e),n}function pw(t){const{source:e,target:n,start:r=0,size:s,getData:u}=t,p=t.end||n.length,o=e.length,v=p-r;if(o>v){n.set(e.subarray(0,v),r);return}if(n.set(e,r),!u)return;let T=o;for(;T<v;){const I=u(T,e);for(let L=0;L<s;L++)n[r+T]=I[L]||0,T++}}function TY({source:t,target:e,size:n,getData:r,sourceStartIndices:s,targetStartIndices:u}){if(!Array.isArray(u))return pw({source:t,target:e,size:n,getData:r}),e;let p=0,o=0;const v=r&&((I,L)=>r(I+o,L)),T=Math.min(s.length,u.length);for(let I=1;I<T;I++){const L=s[I]*n,F=u[I]*n;pw({source:t.subarray(p,L),target:e,start:o,end:F,size:n,getData:v}),p=L,o=F}return o<e.length&&pw({source:[],target:e,start:o,size:n,getData:v}),e}const SY={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function cz(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...SY[n],...e,...t,type:n}}function uz(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function hz(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function dz(t){t.push(t.shift())}function XS(t,e){const{doublePrecision:n,settings:r,value:s,size:u}=t,p=n&&s instanceof Float64Array?2:1;return(r.noAlloc?s.length:e*u)*p}function fz({buffer:t,numInstances:e,attribute:n,fromLength:r,fromStartIndices:s,getData:u=p=>p}){const p=n.doublePrecision&&n.value instanceof Float64Array?2:1,o=n.size*p,v=n.byteOffset,T=n.startIndices,I=s&&T,L=XS(n,e),F=n.isConstant;if(!I&&r>=L)return;const j=F?n.value:n.getBuffer().getData({srcByteOffset:v});if(n.settings.normalized&&!F){const q=u;u=(H,J)=>n.normalizeConstant(q(H,J))}const X=F?(q,H)=>u(j,H):(q,H)=>u(j.subarray(q,q+o),H),re=t.getData({length:r}),de=new Float32Array(L);TY({source:re,target:de,sourceStartIndices:s,targetStartIndices:T,size:o,getData:X}),t.byteLength<de.byteLength+v&&t.reallocate(de.byteLength+v),t.subData({data:de,offset:v})}class YS extends vY{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:K0}),K(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,s=Array.isArray(n)?e[n.find(u=>e[u])]:e[n];return cz(s,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:s=1/0}=n;this.state.updateRanges=EY(this.state.updateRanges,[r,s])}else this.state.updateRanges=K0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=wY}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==K0),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:u},settings:{update:p,noAlloc:o}}=this;let v=!0;if(p){for(const[T,I]of u)p.call(s,this,{data:n,startRow:T,endRow:I,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[T,I]of u){const L=Number.isFinite(T)?this.getVertexOffset(T):0,F=Number.isFinite(I)?this.getVertexOffset(I):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:L,endOffset:F})}this._checkAttributeArray()}else v=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),v}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:s}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),s.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const p=e;Ti(ArrayBuffer.isView(p.value),"invalid ".concat(s.accessor));const o=!!p.size&&p.size!==this.size;return r.binaryAccessor=bY(p.value,{size:p.size||this.size,stride:p.stride,offset:p.offset,startIndices:n,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const r in e)Object.assign(n,super.getShaderAttributes(r,e[r]));return n}_autoUpdater(e,{data:n,startRow:r,endRow:s,props:u,numInstances:p}){if(e.constant)return;const{settings:o,state:v,value:T,size:I,startIndices:L}=e,{accessor:F,transform:j}=o,X=v.binaryAccessor||(typeof F=="function"?F:u[F]);Ti(typeof X=="function",'accessor "'.concat(F,'" is not a function'));let re=e.getVertexOffset(r);const{iterable:de,objectInfo:q}=xY(n,r,s);for(const H of de){q.index++;let J=X(H,q);if(j&&(J=j.call(this,J)),L){const Ee=(q.index<L.length-1?L[q.index+1]:p)-L[q.index];if(J&&Array.isArray(J[0])){let ue=re;for(const Fe of J)e._normalizeValue(Fe,T,ue),ue+=I}else J&&J.length>I?T.set(J,re):(e._normalizeValue(J,q.target,0),qq({target:T,source:q.target,start:re,count:Ee}));re+=Ee*I}else e._normalizeValue(J,T,re),re+=I}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class AY{constructor({gl:e,attribute:n,timeline:r}){K(this,"gl",void 0),K(this,"type","interpolation"),K(this,"attributeInTransition",void 0),K(this,"settings",void 0),K(this,"attribute",void 0),K(this,"transition",void 0),K(this,"currentStartIndices",void 0),K(this,"currentLength",void 0),K(this,"transform",void 0),K(this,"buffers",void 0),this.gl=e,this.transition=new o_(r),this.attribute=n,this.attributeInTransition=new YS(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=MY(e,n);const s={byteLength:0,usage:35050};this.buffers=[new rr(e,s),new rr(e,s)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:s,attribute:u}=this;dz(s);const p={numInstances:n,attribute:u,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const o of s)fz({buffer:o,...p});this.currentStartIndices=u.startIndices,this.currentLength=XS(u,n),this.attributeInTransition.setData({buffer:s[1],value:u.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/u.size),sourceBuffers:{aFrom:s[0],aTo:uz(r,u)},feedbackBuffers:{vCurrent:s[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:r}=this.settings,{time:s}=this.transition;let u=s/n;r&&(u=r(u)),this.transform.run({uniforms:{time:u}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const CY=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function MY(t,e){const n=hz(e.size);return new GS(t,{vs:CY,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class PY{constructor({gl:e,attribute:n,timeline:r}){K(this,"gl",void 0),K(this,"type","spring"),K(this,"attributeInTransition",void 0),K(this,"settings",void 0),K(this,"attribute",void 0),K(this,"transition",void 0),K(this,"currentStartIndices",void 0),K(this,"currentLength",void 0),K(this,"texture",void 0),K(this,"framebuffer",void 0),K(this,"transform",void 0),K(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new o_(r),this.attribute=n,this.attributeInTransition=new YS(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=RY(e),this.framebuffer=kY(e,this.texture),this.transform=IY(e,n,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new rr(e,s),new rr(e,s),new rr(e,s)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:r,buffers:s,attribute:u}=this,p={numInstances:n,attribute:u,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const o of s)fz({buffer:o,...p});this.settings=e,this.currentStartIndices=u.startIndices,this.currentLength=XS(u,n),this.attributeInTransition.setData({buffer:s[1],value:u.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/u.size),sourceBuffers:{aTo:uz(r,u)}})}update(){const{buffers:e,transform:n,framebuffer:r,transition:s}=this;if(!s.update())return!1;const p=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:p.stiffness,damping:p.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),dz(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Rx(r)[0]>0||s.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function IY(t,e,n){const r=hz(e.size);return new GS(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function RY(t){return new Qo(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function kY(t,e){return new si(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const LY={interpolation:AY,spring:PY};class OY{constructor(e,{id:n,timeline:r}){K(this,"id",void 0),K(this,"isSupported",void 0),K(this,"gl",void 0),K(this,"timeline",void 0),K(this,"transitions",void 0),K(this,"needsRedraw",void 0),K(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=GS.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const s in e){const u=e[s],p=u.getTransitionSetting(n);p&&this._updateAttribute(s,u,p)}for(const s in this.transitions){const u=e[s];(!u||!u.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,r){const s=this.transitions[e];let u=!s||s.type!==r.type;if(u){if(!this.isSupported){ir.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}s&&this._removeTransition(e);const p=LY[r.type];p?this.transitions[e]=new p({attribute:n,timeline:this.timeline,gl:this.gl}):(ir.error("unsupported transition type '".concat(r.type,"'"))(),u=!1)}(u||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const fR="attributeManager.invalidate",DY="attributeManager.updateStart",zY="attributeManager.updateEnd",FY="attribute.updateStart",NY="attribute.allocate",BY="attribute.updateEnd";class UY{constructor(e,{id:n="attribute-manager",stats:r,timeline:s}={}){K(this,"id",void 0),K(this,"gl",void 0),K(this,"attributes",void 0),K(this,"updateTriggers",void 0),K(this,"needsRedraw",void 0),K(this,"userData",void 0),K(this,"stats",void 0),K(this,"attributeTransitionManager",void 0),K(this,"mergeBoundsMemoized",s_(Bq)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new OY(e,{id:"".concat(n,"-transitions"),timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);qi(fR,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);qi(fR,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:s,props:u={},buffers:p={},context:o={}}){let v=!1;qi(DY,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const T in this.attributes){const I=this.attributes[T],L=I.settings.accessor;I.startIndices=r,I.numInstances=n,u[T]&&ir.removed("props.".concat(T),"data.attributes.".concat(T))(),I.setExternalBuffer(p[T])||I.setBinaryValue(typeof L=="string"?p[L]:void 0,e.startIndices)||typeof L=="string"&&!p[L]&&I.setConstantValue(u[L])||I.needsUpdate()&&(v=!0,this._updateAttribute({attribute:I,numInstances:n,data:e,props:u,context:o})),this.needsRedraw=this.needsRedraw||I.needsRedraw()}v&&qi(zY,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(r=>{var s;return(s=this.attributes[r])===null||s===void 0?void 0:s.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,s={...r.getAttributes()};for(const u in n){const p=n[u];p.needsRedraw(e)&&!r.hasAttribute(u)&&(s[u]=p)}return s}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const r={};for(const s in e)n[s]||Object.assign(r,e[s].getShaderAttributes());return r}_add(e,n={}){for(const r in e){const s=e[r];this.attributes[r]=this._createAttribute(r,s,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,r){const s={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:r.instanced?1:n.divisor||0};return new YS(this.gl,s)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:s}=this,u=s[e];return u&&u.forEach(p=>{const o=r[p];o&&o.setNeedsUpdate(o.id,n)}),u}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(qi(FY,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&qi(NY,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,qi(BY,n,r))}}class VY extends o_{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:s,easing:u}}=this,p=u(e/s);this._value=Cg(n,r,p)}}const pR=1e-5;function mR(t,e,n,r,s){const u=e-t,o=(n-e)*s,v=-u*r;return o+v+u+e}function jY(t,e,n,r,s){if(Array.isArray(n)){const u=[];for(let p=0;p<n.length;p++)u[p]=mR(t[p],e[p],n[p],r,s);return u}return mR(t,e,n,r,s)}function gR(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const s=t[r]-e[r];n+=s*s}return Math.sqrt(n)}return Math.abs(t-e)}class GY extends o_{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:s}=this.settings,{_prevValue:u=e,_currValue:p=e}=this;let o=jY(u,p,n,r,s);const v=gR(o,n),T=gR(o,p);v<pR&&T<pR&&(o=n,this.end()),this._prevValue=p,this._currValue=o}}const WY={interpolation:VY,spring:GY};class $Y{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,s){const{transitions:u}=this;if(u.has(e)){const v=u.get(e),{value:T=v.settings.fromValue}=v;n=T,this.remove(e)}if(s=cz(s),!s)return;const p=WY[s.type];if(!p){ir.error("unsupported transition type '".concat(s.type,"'"))();return}const o=new p(this.timeline);o.start({...s,fromValue:n,toValue:r}),u.set(e,o)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function HY(t){const e=t[th];for(const n in e){const r=e[n],{validate:s}=r;if(s&&!s(t[n],r))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function ZY(t,e){const n=pz({newProps:t,oldProps:e,propTypes:t[th],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=XY(t,e);let s=!1;return r||(s=YY(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:s,extensionsChanged:KY(t,e),transitionsChanged:qY(t,e)}}function qY(t,e){if(!t.transitions)return!1;const n={},r=t[th];let s=!1;for(const u in t.transitions){const p=r[u],o=p&&p.type;(o==="number"||o==="color"||o==="array")&&oT(t[u],e[u],p)&&(n[u]=!0,s=!0)}return s?n:!1}function pz({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:s="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(s," changed shallowly");for(const u of Object.keys(t))if(!(u in n)){if(!(u in e))return"".concat(s,".").concat(u," added");const p=oT(t[u],e[u],r[u]);if(p)return"".concat(s,".").concat(u," ").concat(p)}for(const u of Object.keys(e))if(!(u in n)){if(!(u in t))return"".concat(s,".").concat(u," dropped");if(!Object.hasOwnProperty.call(t,u)){const p=oT(t[u],e[u],r[u]);if(p)return"".concat(s,".").concat(u," ").concat(p)}}return!1}function oT(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function XY(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:s}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&s&&(n=s(t.data,e.data)||n),n}function YY(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&_R(t,e,"all"))return{all:!0};const n={};let r=!1;for(const s in t.updateTriggers)s!=="all"&&_R(t,e,s)&&(n[s]=!0,r=!0);return r?n:!1}function KY(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let s=0;s<r.length;s++)if(!r[s].equals(n[s]))return!0;return!1}function _R(t,e,n){let r=t.updateTriggers[n];r=r??{};let s=e.updateTriggers[n];return s=s??{},pz({oldProps:s,newProps:r,triggerName:n})}const JY="count(): argument not an object",QY="count(): argument not a container";function eK(t){if(!nK(t))throw new Error(JY);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(tK(t))return Object.keys(t).length;throw new Error(QY)}function tK(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function nK(t){return t!==null&&typeof t=="object"}function rK(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(s=>s.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const s in e.inject)r[s]=(r[s]||"")+e.inject[s];n.inject=r}return n}const iK={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},aT={};function sK(t,e,n){if(e instanceof Qo)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let r=null;e.compressed&&(r={[10241]:e.data.length>1?9985:9729});const s=new Qo(t,{...e,parameters:{...iK,...r,...n}});return aT[s.id]=!0,s}function oK(t){!t||!(t instanceof Qo)||aT[t.id]&&(t.delete(),delete aT[t.id])}const aK={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||lT(t)&&(t.length===3||t.length===4)},equal(t,e,n){return La(t,e,1)}},accessor:{validate(t,e){const n=Hv(t);return n==="function"||n===Hv(e.value)},equal(t,e,n){return typeof e=="function"?!0:La(t,e,1)}},array:{validate(t,e){return e.optional&&!t||lT(t)},equal(t,e,n){const{compare:r}=n,s=Number.isInteger(r)?r:r?1:0;return r?La(t,e,s):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,s=Number.isInteger(r)?r:r?1:0;return r?La(t,e,s):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:r}=n.props;return r&&t?r(t):t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.gl?null:sK(r.gl,t,{...e.parameters,...n.props.textureParameters})},release:t=>{oK(t)}}};function lK(t){const e={},n={},r={};for(const[s,u]of Object.entries(t)){const p=u==null?void 0:u.deprecatedFor;if(p)r[s]=Array.isArray(p)?p:[p];else{const o=cK(s,u);e[s]=o,n[s]=o.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function cK(t,e){switch(Hv(e)){case"object":return Em(t,e);case"array":return Em(t,{type:"array",value:e,compare:!1});case"boolean":return Em(t,{type:"boolean",value:e});case"number":return Em(t,{type:"number",value:e});case"function":return Em(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Em(t,e){return"type"in e?{name:t,...aK[e.type],...e}:"value"in e?{name:t,type:Hv(e.value),...e}:{name:t,type:"object",value:e}}function lT(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Hv(t){return lT(t)?"array":t===null?"null":typeof t}function uK(t,e){let n;for(let u=e.length-1;u>=0;u--){const p=e[u];"extensions"in p&&(n=p.extensions)}const r=cT(t.constructor,n),s=Object.create(r);s[Wv]=t,s[hh]={},s[wc]={};for(let u=0;u<e.length;++u){const p=e[u];for(const o in p)s[o]=p[o]}return Object.freeze(s),s}const hK="_mergedDefaultProps";function cT(t,e){let n=hK;if(e)for(const s of e){const u=s.constructor;u&&(n+=":".concat(u.extensionName||u.name))}const r=mz(t,n);return r||(t[n]=dK(t,e||[]))}function dK(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),s=cT(r),u=mz(t,"defaultProps")||{},p=lK(u),o=Object.assign(Object.create(null),s,p.defaultProps),v=Object.assign(Object.create(null),s==null?void 0:s[th],p.propTypes),T=Object.assign(Object.create(null),s==null?void 0:s[hw],p.deprecatedProps);for(const I of e){const L=cT(I.constructor);L&&(Object.assign(o,L),Object.assign(v,L[th]),Object.assign(T,L[hw]))}return fK(o,t),mK(o,v),pK(o,T),o[th]=v,o[hw]=T,e.length===0&&!KS(t,"_propTypes")&&(t._propTypes=v),o}function fK(t,e){const n=_K(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function pK(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const s="".concat(this.id,": ").concat(n);for(const u of e[n])KS(this,u)||(this[u]=r);ir.deprecated(s,e[n].join("/"))()}})}function mK(t,e){const n={},r={};for(const s in e){const u=e[s],{name:p,value:o}=u;u.async&&(n[p]=o,r[p]=gK(p))}t[rf]=n,t[hh]={},Object.defineProperties(t,r)}function gK(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||lz(e)?this[hh][t]=e:this[wc][t]=e},get(){if(this[wc]){if(t in this[wc])return this[wc][t]||this[rf][t];if(t in this[hh]){const e=this[Wv]&&this[Wv].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[rf][t]}}return this[rf][t]}}}function KS(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function mz(t,e){return KS(t,e)&&t[e]}function _K(t){const e=t.componentName;return e||ir.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let yK=0;class JS{constructor(...e){K(this,"id",void 0),K(this,"props",void 0),K(this,"count",void 0),this.props=uK(this,e),this.id=this.props.id,this.count=yK++}clone(e){const{props:n}=this,r={};for(const s in n[rf])s in n[wc]?r[s]=n[wc][s]:s in n[hh]&&(r[s]=n[hh][s]);return new this.constructor({...n,...r,...e})}}K(JS,"componentName","Component");K(JS,"defaultProps",{});const vK=Object.freeze({});class xK{constructor(e){K(this,"component",void 0),K(this,"onAsyncPropUpdated",void 0),K(this,"asyncProps",void 0),K(this,"oldProps",void 0),K(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||vK}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Wv]||this.component;const n=e[wc]||{},r=e[hh]||e,s=e[rf]||{};for(const u in n){const p=n[u];this._createAsyncPropData(u,s[u]),this._updateAsyncProp(u,p),n[u]=this.getAsyncProp(u)}for(const u in r){const p=r[u];this._createAsyncPropData(u,s[u]),this._updateAsyncProp(u,p)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(lz(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const s=this.asyncProps[e];s&&r>=s.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=n,s.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const s=r.pendingLoadCount;n.then(u=>{this.component&&(u=this._postProcessValue(r,u),this._setAsyncPropValue(e,u,s),this._onResolve(e,u))}).catch(u=>{this._onError(e,u)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const s=r.pendingLoadCount;let u=[],p=0;for await(const o of n){if(!this.component)return;const{dataTransform:v}=this.component.props;v?u=v(o,u):u=u.concat(o),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:p,endRow:u.length}]}),p=u.length,this._setAsyncPropValue(e,u,s)}this._onResolve(e,u)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const s=this.component&&this.component.props[th];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class bK extends xK{constructor({attributeManager:e,layer:n}){super(n),K(this,"attributeManager",void 0),K(this,"needsRedraw",void 0),K(this,"needsUpdate",void 0),K(this,"subLayers",void 0),K(this,"usesPickingColorCache",void 0),K(this,"hasPickingBuffer",void 0),K(this,"changeFlags",void 0),K(this,"viewport",void 0),K(this,"uniformTransitions",void 0),K(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,s=r==null?void 0:r.props.fetch;return s?s(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const s=r.props.onDataLoad;e==="data"&&s&&s(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const wK="layer.changeFlag",EK="layer.initialize",TK="layer.update",SK="layer.finalize",AK="layer.matched",yR=2**24-1,CK=Object.freeze([]),MK=s_(({oldViewport:t,viewport:e})=>t.equals(e));let Ca=new Uint8ClampedArray(0);const PK={data:{type:"data",value:CK,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:s,signal:u})=>{const{resourceManager:p}=n.context;if(s=s||n.getLoadOptions(),r=r||n.props.loaders,u){var o;s={...s,fetch:{...(o=s)===null||o===void 0?void 0:o.fetch,signal:u}}}let v=p.contains(t);return!v&&!s&&(p.add({resourceId:t,data:zE(t,r),persistent:!1}),v=!0),v?p.subscribe({resourceId:t,onChange:T=>{var I;return(I=n.internalState)===null||I===void 0?void 0:I.reloadAsyncProp(e,T)},consumerId:n.id,requestId:e}):zE(t,r,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Qn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ox extends JS{constructor(...e){super(...e),K(this,"internalState",null),K(this,"lifecycle",Rd.NO_STATE),K(this,"context",void 0),K(this,"state",void 0),K(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Ti(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=X3(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,u,p]=W3(r,n.pixelProjectionMatrix);return e.length===2?[s,u]:[s,u,p]}unproject(e){return Ti(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ti(this.internalState);const r=this.internalState.viewport||this.context.viewport;return $q(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Qn.DEFAULT||e===Qn.LNGLAT||e===Qn.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ti(e instanceof Uint8Array);const[n,r,s]=e;return n+r*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:eK(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=rK(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const s of r)n.invalidateAll(s);else n.invalidateAll();if(n){const{props:s}=e,u=this.internalState.hasPickingBuffer,p=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(u!==p){this.internalState.hasPickingBuffer=p;const{pickingColors:o,instancePickingColors:v}=n.attributes,T=o||v;T&&(p&&T.constant&&(T.constant=!1,n.invalidate(T.id)),!T.value&&!p&&(T.constant=!0,T.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,n){var r,s;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((r=(s=this.props).onError)!==null&&r!==void 0&&r.call(s,e))){var u,p;(u=this.context)===null||u===void 0||(p=u.onError)===null||p===void 0||p.call(u,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!MK({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),s=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:s,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const u=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const s in n)Object.defineProperty(r,s,{value:n[s]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Ca.length/3);if(this.internalState.usesPickingColorCache=!0,r<n){n>yR&&ir.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ca=Pg.allocate(Ca,n,{size:3,copy:!0,maxCount:Math.max(n,yR)});const s=Math.floor(Ca.length/3),u=[];for(let p=r;p<s;p++)this.encodePickingColor(p,u),Ca[p*3+0]=u[0],Ca[p*3+1]=u[1],Ca[p*3+2]=u[2]}e.value=Ca.subarray(0,n*3)}_setModelAttributes(e,n){const r=this.getAttributeManager(),s=e.userData.excludeAttributes||{},u=r.getShaderAttributes(n,s);e.setAttributes(u)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,s=n||r;if(!s)return;const u=s.getVertexOffset(e),p=s.getVertexOffset(e+1);s.buffer.subData({data:new Uint8Array(p-u),offset:u})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Ca.buffer&&(r.value=Ca.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Ti(!this.internalState),Ti(Number.isFinite(this.props.coordinateSystem)),qi(EK,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new bK({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ir.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new $Y(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){qi(AK,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(qi(TK,this,e),!e)return;const n=this.props,r=this.context,s=this.internalState,u=r.viewport,p=this._updateUniformTransition();s.propsInTransition=p,r.viewport=s.viewport||u,this.props=p;try{const o=this._getUpdateParams(),v=this.getModels();if(r.gl)this.updateState(o);else try{this.updateState(o)}catch{}for(const I of this.props.extensions)I.updateState.call(this,o,I);const T=this.getModels()[0]!==v[0];this._postUpdate(o,T)}finally{r.viewport=u,this.props=n,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){qi(SK,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const s=this.props,u=this.context;this.props=this.internalState.propsInTransition||s;const p=this.props.opacity;n.opacity=Math.pow(p,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:o}=this.props,v=o&&o(n)||[0,0];xl(u.gl,{polygonOffset:v}),Yo(u.gl,r,()=>{const T={moduleParameters:e,uniforms:n,parameters:r,context:u};for(const I of this.props.extensions)I.draw.call(this,T,I);this.draw(T)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const s in e)if(e[s]){let u=!1;switch(s){case"dataChanged":const p=e[s],o=n[s];p&&Array.isArray(o)&&(n.dataChanged=Array.isArray(p)?o.concat(p):p,u=!0);default:n[s]||(n[s]=e[s],u=!0)}u&&qi(wK,this,s,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const r=ZY(e,n);if(r.updateTriggersChanged)for(const u in r.updateTriggersChanged)r.updateTriggersChanged[u]&&this.invalidateAttribute(u);if(r.transitionsChanged)for(const u in r.transitionsChanged){var s;this.internalState.uniformTransitions.add(u,n[u],e[u],(s=e.transitions)===null||s===void 0?void 0:s[u])}return this.setChangeFlags(r)}validateProps(){HY(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.pickingHighlightColor=r(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new UY(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:u}=this.state;u==null||u.setInstanceCount(this.getNumInstances());const{autoHighlight:p,highlightedObjectIndex:o,highlightColor:v}=r;if(n||s.autoHighlight!==p||s.highlightedObjectIndex!==o||s.highlightColor!==v){const T={};p||(T.pickingSelectedColor=null),Array.isArray(v)&&(T.pickingHighlightColor=v),(n||o!==s.highlightedObjectIndex)&&(T.pickingSelectedColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setModuleParameters(T)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),s=r?r.getNeedsRedraw(e):!1;if(n=n||s,n)for(const u of this.props.extensions)u.onNeedsRedraw.call(this,u);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}K(Ox,"defaultProps",PK);K(Ox,"layerName","Layer");const IK=["bearing","pitch"],RK={speed:1.2,curve:1.414};class kK extends Q3{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}),K(this,"opts",void 0),this.opts={...RK,...e}}interpolateProps(e,n,r){const s=bq(e,n,r,this.opts);for(const u of IK)s[u]=Cg(e[u]||0,n[u]||0,r);return s}getDuration(e,n){let{transitionDuration:r}=n;return r==="auto"&&(r=wq(e,n,this.opts)),r}}function gz(t,e,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function LK(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!vR(t[0])||!vR(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return gz(r,e,n)}function OK(t,e,n){n===void 0&&(n={});for(var r=0,s=t;r<s.length;r++){var u=s[r];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<u[u.length-1].length;p++)if(u[u.length-1][p]!==u[0][p])throw new Error("First and last Position are not equivalent.")}var o={type:"Polygon",coordinates:t};return gz(o,e,n)}function DK(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function vR(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function _z(t,e,n){if(t!==null)for(var r,s,u,p,o,v,T,I=0,L=0,F,j=t.type,X=j==="FeatureCollection",re=j==="Feature",de=X?t.features.length:1,q=0;q<de;q++){T=X?t.features[q].geometry:re?t.geometry:t,F=T?T.type==="GeometryCollection":!1,o=F?T.geometries.length:1;for(var H=0;H<o;H++){var J=0,Ee=0;if(p=F?T.geometries[H]:T,p!==null){v=p.coordinates;var ue=p.type;switch(I=n&&(ue==="Polygon"||ue==="MultiPolygon")?1:0,ue){case null:break;case"Point":if(e(v,L,q,J,Ee)===!1)return!1;L++,J++;break;case"LineString":case"MultiPoint":for(r=0;r<v.length;r++){if(e(v[r],L,q,J,Ee)===!1)return!1;L++,ue==="MultiPoint"&&J++}ue==="LineString"&&J++;break;case"Polygon":case"MultiLineString":for(r=0;r<v.length;r++){for(s=0;s<v[r].length-I;s++){if(e(v[r][s],L,q,J,Ee)===!1)return!1;L++}ue==="MultiLineString"&&J++,ue==="Polygon"&&Ee++}ue==="Polygon"&&J++;break;case"MultiPolygon":for(r=0;r<v.length;r++){for(Ee=0,s=0;s<v[r].length;s++){for(u=0;u<v[r][s].length-I;u++){if(e(v[r][s][u],L,q,J,Ee)===!1)return!1;L++}Ee++}J++}break;case"GeometryCollection":for(r=0;r<p.geometries.length;r++)if(_z(p.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function uT(t){var e=[1/0,1/0,-1/0,-1/0];return _z(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}uT.default=uT;function zK(t,e){e===void 0&&(e={});var n=Number(t[0]),r=Number(t[1]),s=Number(t[2]),u=Number(t[3]);if(t.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var p=[n,r],o=[n,u],v=[s,u],T=[s,r];return OK([[p,T,v,o,p]],e.properties,{bbox:t,id:e.id})}const FK=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(curr, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,NK=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Zv=[0,0,0,255],BK={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:Zv},getTargetColor:{type:"accessor",value:Zv},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class QS extends Ox{constructor(...e){super(...e),K(this,"state",void 0)}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:FK,fs:NK,modules:[Jq,Qq]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:Zv},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:Zv},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:r}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:r,widthMinPixels:s,widthMaxPixels:u,greatCircle:p,wrapLongitude:o}=this.props;this.state.model.setUniforms(e).setUniforms({greatCircle:p,widthUnits:VE[n],widthScale:r,widthMinPixels:s,widthMaxPixels:u,useShortestPath:o}).draw()}_getModel(e){let n=[];for(let u=0;u<50;u++)n=n.concat([u,1,0,u,-1,0]);const s=new L3(e,{...this.getShaders(),id:this.props.id,geometry:new kZ({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0});return s.setUniforms({numSegments:50}),s}}K(QS,"layerName","ArcLayer");K(QS,"defaultProps",BK);const UK=typeof window<"u"?We.useLayoutEffect:We.useEffect,VK=UK;function qv(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const jK={position:"absolute",zIndex:-1};function yz(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>yz(n,e));if(Dx(t)){if(GK(t))return e.style=jK,We.cloneElement(t,e);if(WK(t))return We.cloneElement(t,e)}return t}function Dx(t){return t&&typeof t=="object"&&"type"in t||!1}function GK(t){const e=t.type,n=e&&e.defaultProps;return n&&n.mapStyle}function WK(t){const e=t.type;return e&&e.deckGLViewProps}function hT(t){if(typeof t=="function")return We.createElement(Pf,{},t);if(Array.isArray(t))return t.map(hT);if(Dx(t)){if(t.type===We.Fragment)return hT(t.props.children);if(qv(t.type,Pf))return t}return t}function $K({children:t,layers:e=[],views:n=null}){const r=[],s=[],u={};return We.Children.forEach(hT(t),p=>{if(Dx(p)){const o=p.type;if(qv(o,Ox)){const v=HK(o,p.props);s.push(v)}else r.push(p);if(qv(o,Pf)&&o!==Pf&&p.props.id){const v=new o(p.props);u[v.id]=v}}else p&&r.push(p)}),Object.keys(u).length>0&&(Array.isArray(n)?n.forEach(p=>{u[p.id]=p}):n&&(u[n.id]=n),n=Object.values(u)),e=s.length>0?[...s,...e]:e,{layers:e,children:r,views:n}}function HK(t,e){const n={},r=t.defaultProps||{};for(const s in e)r[s]!==e[s]&&(n[s]=e[s]);return new t(n)}function ZK({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const s={},u=r.views[0].id;for(const p of t){let o=u,v=p;Dx(p)&&qv(p.type,Pf)&&(o=p.props.id||u,v=p.props.children);const T=r.getViewport(o),I=r.getViewState(o);if(T){I.padding=T.padding;const{x:L,y:F,width:j,height:X}=T;v=yz(v,{x:L,y:F,width:j,height:X,viewport:T,viewState:I}),s[o]||(s[o]={viewport:T,children:[]}),s[o].children.push(v)}}return Object.keys(s).map(p=>{const{viewport:o,children:v}=s[p],{x:T,y:I,width:L,height:F}=o,j={position:"absolute",left:T,top:I,width:L,height:F},X="view-".concat(p),re=We.createElement("div",{key:X,id:X,style:j},...v);if(n){const de={viewport:o,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:q=>{q.viewId=p,e._onViewStateChange(q)}};return We.createElement(n,{key:X,value:de},re)}return re})}const qK={mixBlendMode:null};function XK({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},s={left:0,top:0};if(n)for(const u in n)u in qK?s[u]=n[u]:r[u]=n[u];return{containerStyle:r,canvasStyle:s}}function YK(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function vz(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function KK(t,e,n){const r=new e({...n,_customRender:s=>{t.redrawReason=s;const u=r.getViewports();t.lastRenderedViewports!==u?t.forceUpdate():vz(t)}});return r}const xz=We.forwardRef((t,e)=>{const[n,r]=We.useState(0),u=We.useRef({control:null,version:n,forceUpdate:()=>r(ue=>ue+1)}).current,p=We.useRef(null),o=We.useRef(null),v=We.useMemo(()=>$K(t),[t.layers,t.views,t.children]);let T=!0;const I=ue=>{var Fe;return T&&t.viewState?(u.viewStateUpdateRequested=ue,null):(u.viewStateUpdateRequested=null,(Fe=t.onViewStateChange)===null||Fe===void 0?void 0:Fe.call(t,ue))},L=ue=>{if(T)u.interactionStateUpdateRequested=ue;else{var Fe;u.interactionStateUpdateRequested=null,(Fe=t.onInteractionStateChange)===null||Fe===void 0||Fe.call(t,ue)}},F=We.useMemo(()=>{const ue={...t,style:null,width:"100%",height:"100%",parent:p.current,canvas:o.current,layers:v.layers,views:v.views,onViewStateChange:I,onInteractionStateChange:L};return delete ue._customRender,u.deck&&u.deck.setProps(ue),ue},[t]);We.useEffect(()=>{const ue=t.Deck||Lx;return u.deck=KK(u,ue,{...F,parent:p.current,canvas:o.current}),()=>{var Fe;return(Fe=u.deck)===null||Fe===void 0?void 0:Fe.finalize()}},[]),VK(()=>{vz(u);const{viewStateUpdateRequested:ue,interactionStateUpdateRequested:Fe}=u;ue&&I(ue),Fe&&L(Fe)}),We.useImperativeHandle(e,()=>YK(u),[]);const j=u.deck&&u.deck.isInitialized?u.deck.getViewports():void 0,{ContextProvider:X,width:re,height:de,id:q,style:H}=t,{containerStyle:J,canvasStyle:Ee}=We.useMemo(()=>XK({width:re,height:de,style:H}),[re,de,H]);if(!u.viewStateUpdateRequested&&u.lastRenderedViewports===j||u.version!==n){u.lastRenderedViewports=j,u.version=n;const ue=ZK({children:v.children,deck:u.deck,ContextProvider:X}),Fe=We.createElement("canvas",{key:"canvas",id:q||"deckgl-overlay",ref:o,style:Ee});u.control=We.createElement("div",{id:"".concat(q||"deckgl","-wrapper"),ref:p,style:J},[Fe,ue])}return T=!1,u.control});xz.defaultProps=Lx.defaultProps;const JK=xz,dT=t=>t&&t.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),QK=t=>t&&t.replace(/_/g,function(){return" "});class _h extends Error{}class eJ extends _h{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class tJ extends _h{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class nJ extends _h{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class Lm extends _h{}class bz extends _h{constructor(e){super(`Invalid unit ${e}`)}}class oo extends _h{}class lc extends _h{constructor(){super("Zone is an abstract class")}}const Et="numeric",ea="short",js="long",Xv={year:Et,month:Et,day:Et},wz={year:Et,month:ea,day:Et},rJ={year:Et,month:ea,day:Et,weekday:ea},Ez={year:Et,month:js,day:Et},Tz={year:Et,month:js,day:Et,weekday:js},Sz={hour:Et,minute:Et},Az={hour:Et,minute:Et,second:Et},Cz={hour:Et,minute:Et,second:Et,timeZoneName:ea},Mz={hour:Et,minute:Et,second:Et,timeZoneName:js},Pz={hour:Et,minute:Et,hourCycle:"h23"},Iz={hour:Et,minute:Et,second:Et,hourCycle:"h23"},Rz={hour:Et,minute:Et,second:Et,hourCycle:"h23",timeZoneName:ea},kz={hour:Et,minute:Et,second:Et,hourCycle:"h23",timeZoneName:js},Lz={year:Et,month:Et,day:Et,hour:Et,minute:Et},Oz={year:Et,month:Et,day:Et,hour:Et,minute:Et,second:Et},Dz={year:Et,month:ea,day:Et,hour:Et,minute:Et},zz={year:Et,month:ea,day:Et,hour:Et,minute:Et,second:Et},iJ={year:Et,month:ea,day:Et,weekday:ea,hour:Et,minute:Et},Fz={year:Et,month:js,day:Et,hour:Et,minute:Et,timeZoneName:ea},Nz={year:Et,month:js,day:Et,hour:Et,minute:Et,second:Et,timeZoneName:ea},Bz={year:Et,month:js,day:Et,weekday:js,hour:Et,minute:Et,timeZoneName:js},Uz={year:Et,month:js,day:Et,weekday:js,hour:Et,minute:Et,second:Et,timeZoneName:js};class a_{get type(){throw new lc}get name(){throw new lc}get ianaName(){return this.name}get isUniversal(){throw new lc}offsetName(e,n){throw new lc}formatOffset(e,n){throw new lc}offset(e){throw new lc}equals(e){throw new lc}get isValid(){throw new lc}}let mw=null;class zx extends a_{static get instance(){return mw===null&&(mw=new zx),mw}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:n,locale:r}){return jz(e,n,r)}formatOffset(e,n){return Ym(this.offset(e),n)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let J0={};function sJ(t){return J0[t]||(J0[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),J0[t]}const oJ={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function aJ(t,e){const n=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(n),[,s,u,p,o,v,T,I]=r;return[p,s,u,o,v,T,I]}function lJ(t,e){const n=t.formatToParts(e),r=[];for(let s=0;s<n.length;s++){const{type:u,value:p}=n[s],o=oJ[u];u==="era"?r[o]=p:Sn(o)||(r[o]=parseInt(p,10))}return r}let E0={};class wl extends a_{static create(e){return E0[e]||(E0[e]=new wl(e)),E0[e]}static resetCache(){E0={},J0={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=wl.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:n,locale:r}){return jz(e,n,r,this.name)}formatOffset(e,n){return Ym(this.offset(e),n)}offset(e){const n=new Date(e);if(isNaN(n))return NaN;const r=sJ(this.name);let[s,u,p,o,v,T,I]=r.formatToParts?lJ(r,n):aJ(r,n);o==="BC"&&(s=-Math.abs(s)+1);const F=n2({year:s,month:u,day:p,hour:v===24?0:v,minute:T,second:I,millisecond:0});let j=+n;const X=j%1e3;return j-=X>=0?X:1e3+X,(F-j)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let xR={};function cJ(t,e={}){const n=JSON.stringify([t,e]);let r=xR[n];return r||(r=new Intl.ListFormat(t,e),xR[n]=r),r}let fT={};function pT(t,e={}){const n=JSON.stringify([t,e]);let r=fT[n];return r||(r=new Intl.DateTimeFormat(t,e),fT[n]=r),r}let mT={};function uJ(t,e={}){const n=JSON.stringify([t,e]);let r=mT[n];return r||(r=new Intl.NumberFormat(t,e),mT[n]=r),r}let gT={};function hJ(t,e={}){const{base:n,...r}=e,s=JSON.stringify([t,r]);let u=gT[s];return u||(u=new Intl.RelativeTimeFormat(t,e),gT[s]=u),u}let Om=null;function dJ(){return Om||(Om=new Intl.DateTimeFormat().resolvedOptions().locale,Om)}function fJ(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const n=t.indexOf("-u-");if(n===-1)return[t];{let r,s;try{r=pT(t).resolvedOptions(),s=t}catch{const v=t.substring(0,n);r=pT(v).resolvedOptions(),s=v}const{numberingSystem:u,calendar:p}=r;return[s,u,p]}}function pJ(t,e,n){return(n||e)&&(t.includes("-u-")||(t+="-u"),n&&(t+=`-ca-${n}`),e&&(t+=`-nu-${e}`)),t}function mJ(t){const e=[];for(let n=1;n<=12;n++){const r=Qt.utc(2016,n,1);e.push(t(r))}return e}function gJ(t){const e=[];for(let n=1;n<=7;n++){const r=Qt.utc(2016,11,13+n);e.push(t(r))}return e}function T0(t,e,n,r,s){const u=t.listingMode(n);return u==="error"?null:u==="en"?r(e):s(e)}function _J(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class yJ{constructor(e,n,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:u,...p}=r;if(!n||Object.keys(p).length>0){const o={useGrouping:!1,...r};r.padTo>0&&(o.minimumIntegerDigits=r.padTo),this.inf=uJ(e,o)}}format(e){if(this.inf){const n=this.floor?Math.floor(e):e;return this.inf.format(n)}else{const n=this.floor?Math.floor(e):t2(e,3);return Wr(n,this.padTo)}}}class vJ{constructor(e,n,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const p=-1*(e.offset/60),o=p>=0?`Etc/GMT+${p}`:`Etc/GMT${p}`;e.offset!==0&&wl.create(o).valid?(s=o,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const u={...this.opts};u.timeZone=u.timeZone||s,this.dtf=pT(n,u)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(n=>{if(n.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...n,value:r}}else return n}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class xJ{constructor(e,n,r){this.opts={style:"long",...r},!n&&Vz()&&(this.rtf=hJ(e,r))}format(e,n){return this.rtf?this.rtf.format(e,n):FJ(n,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,n){return this.rtf?this.rtf.formatToParts(e,n):[]}}class dr{static fromOpts(e){return dr.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,n,r,s=!1){const u=e||Gr.defaultLocale,p=u||(s?"en-US":dJ()),o=n||Gr.defaultNumberingSystem,v=r||Gr.defaultOutputCalendar;return new dr(p,o,v,u)}static resetCache(){Om=null,fT={},mT={},gT={}}static fromObject({locale:e,numberingSystem:n,outputCalendar:r}={}){return dr.create(e,n,r)}constructor(e,n,r,s){const[u,p,o]=fJ(e);this.locale=u,this.numberingSystem=n||p||null,this.outputCalendar=r||o||null,this.intl=pJ(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=_J(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),n=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&n?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:dr.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,n=!1,r=!0){return T0(this,e,r,$z,()=>{const s=n?{month:e,day:"numeric"}:{month:e},u=n?"format":"standalone";return this.monthsCache[u][e]||(this.monthsCache[u][e]=mJ(p=>this.extract(p,s,"month"))),this.monthsCache[u][e]})}weekdays(e,n=!1,r=!0){return T0(this,e,r,qz,()=>{const s=n?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},u=n?"format":"standalone";return this.weekdaysCache[u][e]||(this.weekdaysCache[u][e]=gJ(p=>this.extract(p,s,"weekday"))),this.weekdaysCache[u][e]})}meridiems(e=!0){return T0(this,void 0,e,()=>Xz,()=>{if(!this.meridiemCache){const n={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Qt.utc(2016,11,13,9),Qt.utc(2016,11,13,19)].map(r=>this.extract(r,n,"dayperiod"))}return this.meridiemCache})}eras(e,n=!0){return T0(this,e,n,Yz,()=>{const r={era:e};return this.eraCache[e]||(this.eraCache[e]=[Qt.utc(-40,1,1),Qt.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[e]})}extract(e,n,r){const s=this.dtFormatter(e,n),u=s.formatToParts(),p=u.find(o=>o.type.toLowerCase()===r);return p?p.value:null}numberFormatter(e={}){return new yJ(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,n={}){return new vJ(e,this.intl,n)}relFormatter(e={}){return new xJ(this.intl,this.isEnglish(),e)}listFormatter(e={}){return cJ(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let gw=null;class Ki extends a_{static get utcInstance(){return gw===null&&(gw=new Ki(0)),gw}static instance(e){return e===0?Ki.utcInstance:new Ki(e)}static parseSpecifier(e){if(e){const n=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(n)return new Ki(Nx(n[1],n[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${Ym(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${Ym(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,n){return Ym(this.fixed,n)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class bJ extends a_{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function mc(t,e){if(Sn(t)||t===null)return e;if(t instanceof a_)return t;if(wJ(t)){const n=t.toLowerCase();return n==="default"?e:n==="local"||n==="system"?zx.instance:n==="utc"||n==="gmt"?Ki.utcInstance:Ki.parseSpecifier(n)||wl.create(t)}else return nh(t)?Ki.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new bJ(t)}let bR=()=>Date.now(),wR="system",ER=null,TR=null,SR=null,AR=60,CR;class Gr{static get now(){return bR}static set now(e){bR=e}static set defaultZone(e){wR=e}static get defaultZone(){return mc(wR,zx.instance)}static get defaultLocale(){return ER}static set defaultLocale(e){ER=e}static get defaultNumberingSystem(){return TR}static set defaultNumberingSystem(e){TR=e}static get defaultOutputCalendar(){return SR}static set defaultOutputCalendar(e){SR=e}static get twoDigitCutoffYear(){return AR}static set twoDigitCutoffYear(e){AR=e%100}static get throwOnInvalid(){return CR}static set throwOnInvalid(e){CR=e}static resetCaches(){dr.resetCache(),wl.resetCache()}}function Sn(t){return typeof t>"u"}function nh(t){return typeof t=="number"}function Fx(t){return typeof t=="number"&&t%1===0}function wJ(t){return typeof t=="string"}function EJ(t){return Object.prototype.toString.call(t)==="[object Date]"}function Vz(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function TJ(t){return Array.isArray(t)?t:[t]}function MR(t,e,n){if(t.length!==0)return t.reduce((r,s)=>{const u=[e(s),s];return r&&n(r[0],u[0])===r[0]?r:u},null)[1]}function SJ(t,e){return e.reduce((n,r)=>(n[r]=t[r],n),{})}function If(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function hl(t,e,n){return Fx(t)&&t>=e&&t<=n}function AJ(t,e){return t-e*Math.floor(t/e)}function Wr(t,e=2){const n=t<0;let r;return n?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function dc(t){if(!(Sn(t)||t===null||t===""))return parseInt(t,10)}function Bu(t){if(!(Sn(t)||t===null||t===""))return parseFloat(t)}function e2(t){if(!(Sn(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function t2(t,e,n=!1){const r=10**e;return(n?Math.trunc:Math.round)(t*r)/r}function l_(t){return t%4===0&&(t%100!==0||t%400===0)}function Xm(t){return l_(t)?366:365}function Yv(t,e){const n=AJ(e-1,12)+1,r=t+(e-n)/12;return n===2?l_(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function n2(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function Kv(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,n=t-1,r=(n+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400))%7;return e===4||r===3?53:52}function _T(t){return t>99?t:t>Gr.twoDigitCutoffYear?1900+t:2e3+t}function jz(t,e,n,r=null){const s=new Date(t),u={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(u.timeZone=r);const p={timeZoneName:e,...u},o=new Intl.DateTimeFormat(n,p).formatToParts(s).find(v=>v.type.toLowerCase()==="timezonename");return o?o.value:null}function Nx(t,e){let n=parseInt(t,10);Number.isNaN(n)&&(n=0);const r=parseInt(e,10)||0,s=n<0||Object.is(n,-0)?-r:r;return n*60+s}function Gz(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new oo(`Invalid unit value ${t}`);return e}function Jv(t,e){const n={};for(const r in t)if(If(t,r)){const s=t[r];if(s==null)continue;n[e(r)]=Gz(s)}return n}function Ym(t,e){const n=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${Wr(n,2)}:${Wr(r,2)}`;case"narrow":return`${s}${n}${r>0?`:${r}`:""}`;case"techie":return`${s}${Wr(n,2)}${Wr(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function Bx(t){return SJ(t,["hour","minute","second","millisecond"])}const CJ=["January","February","March","April","May","June","July","August","September","October","November","December"],Wz=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],MJ=["J","F","M","A","M","J","J","A","S","O","N","D"];function $z(t){switch(t){case"narrow":return[...MJ];case"short":return[...Wz];case"long":return[...CJ];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Hz=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Zz=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],PJ=["M","T","W","T","F","S","S"];function qz(t){switch(t){case"narrow":return[...PJ];case"short":return[...Zz];case"long":return[...Hz];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Xz=["AM","PM"],IJ=["Before Christ","Anno Domini"],RJ=["BC","AD"],kJ=["B","A"];function Yz(t){switch(t){case"narrow":return[...kJ];case"short":return[...RJ];case"long":return[...IJ];default:return null}}function LJ(t){return Xz[t.hour<12?0:1]}function OJ(t,e){return qz(e)[t.weekday-1]}function DJ(t,e){return $z(e)[t.month-1]}function zJ(t,e){return Yz(e)[t.year<0?0:1]}function FJ(t,e,n="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},u=["hours","minutes","seconds"].indexOf(t)===-1;if(n==="auto"&&u){const L=t==="days";switch(e){case 1:return L?"tomorrow":`next ${s[t][0]}`;case-1:return L?"yesterday":`last ${s[t][0]}`;case 0:return L?"today":`this ${s[t][0]}`}}const p=Object.is(e,-0)||e<0,o=Math.abs(e),v=o===1,T=s[t],I=r?v?T[1]:T[2]||T[1]:v?s[t][0]:t;return p?`${o} ${I} ago`:`in ${o} ${I}`}function PR(t,e){let n="";for(const r of t)r.literal?n+=r.val:n+=e(r.val);return n}const NJ={D:Xv,DD:wz,DDD:Ez,DDDD:Tz,t:Sz,tt:Az,ttt:Cz,tttt:Mz,T:Pz,TT:Iz,TTT:Rz,TTTT:kz,f:Lz,ff:Dz,fff:Fz,ffff:Bz,F:Oz,FF:zz,FFF:Nz,FFFF:Uz};class Vi{static create(e,n={}){return new Vi(e,n)}static parseFormat(e){let n=null,r="",s=!1;const u=[];for(let p=0;p<e.length;p++){const o=e.charAt(p);o==="'"?(r.length>0&&u.push({literal:s||/^\s+$/.test(r),val:r}),n=null,r="",s=!s):s||o===n?r+=o:(r.length>0&&u.push({literal:/^\s+$/.test(r),val:r}),r=o,n=o)}return r.length>0&&u.push({literal:s||/^\s+$/.test(r),val:r}),u}static macroTokenToFormatOpts(e){return NJ[e]}constructor(e,n){this.opts=n,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,n){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...n}).format()}formatDateTime(e,n={}){return this.loc.dtFormatter(e,{...this.opts,...n}).format()}formatDateTimeParts(e,n={}){return this.loc.dtFormatter(e,{...this.opts,...n}).formatToParts()}formatInterval(e,n={}){return this.loc.dtFormatter(e.start,{...this.opts,...n}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,n={}){return this.loc.dtFormatter(e,{...this.opts,...n}).resolvedOptions()}num(e,n=0){if(this.opts.forceSimple)return Wr(e,n);const r={...this.opts};return n>0&&(r.padTo=n),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,n){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",u=(j,X)=>this.loc.extract(e,j,X),p=j=>e.isOffsetFixed&&e.offset===0&&j.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,j.format):"",o=()=>r?LJ(e):u({hour:"numeric",hourCycle:"h12"},"dayperiod"),v=(j,X)=>r?DJ(e,j):u(X?{month:j}:{month:j,day:"numeric"},"month"),T=(j,X)=>r?OJ(e,j):u(X?{weekday:j}:{weekday:j,month:"long",day:"numeric"},"weekday"),I=j=>{const X=Vi.macroTokenToFormatOpts(j);return X?this.formatWithSystemDefault(e,X):j},L=j=>r?zJ(e,j):u({era:j},"era"),F=j=>{switch(j){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return p({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return p({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return p({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return o();case"d":return s?u({day:"numeric"},"day"):this.num(e.day);case"dd":return s?u({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return T("short",!0);case"cccc":return T("long",!0);case"ccccc":return T("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return T("short",!1);case"EEEE":return T("long",!1);case"EEEEE":return T("narrow",!1);case"L":return s?u({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?u({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return v("short",!0);case"LLLL":return v("long",!0);case"LLLLL":return v("narrow",!0);case"M":return s?u({month:"numeric"},"month"):this.num(e.month);case"MM":return s?u({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return v("short",!1);case"MMMM":return v("long",!1);case"MMMMM":return v("narrow",!1);case"y":return s?u({year:"numeric"},"year"):this.num(e.year);case"yy":return s?u({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?u({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?u({year:"numeric"},"year"):this.num(e.year,6);case"G":return L("short");case"GG":return L("long");case"GGGGG":return L("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return I(j)}};return PR(Vi.parseFormat(n),F)}formatDurationFromString(e,n){const r=v=>{switch(v[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=v=>T=>{const I=r(T);return I?this.num(v.get(I),T.length):T},u=Vi.parseFormat(n),p=u.reduce((v,{literal:T,val:I})=>T?v:v.concat(I),[]),o=e.shiftTo(...p.map(r).filter(v=>v));return PR(u,s(o))}}class $o{constructor(e,n){this.reason=e,this.explanation=n}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Kz=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function jf(...t){const e=t.reduce((n,r)=>n+r.source,"");return RegExp(`^${e}$`)}function Gf(...t){return e=>t.reduce(([n,r,s],u)=>{const[p,o,v]=u(e,s);return[{...n,...p},o||r,v]},[{},null,1]).slice(0,2)}function Wf(t,...e){if(t==null)return[null,null];for(const[n,r]of e){const s=n.exec(t);if(s)return r(s)}return[null,null]}function Jz(...t){return(e,n)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=dc(e[n+s]);return[r,null,n+s]}}const Qz=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,BJ=`(?:${Qz.source}?(?:\\[(${Kz.source})\\])?)?`,r2=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,eF=RegExp(`${r2.source}${BJ}`),i2=RegExp(`(?:T${eF.source})?`),UJ=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,VJ=/(\d{4})-?W(\d\d)(?:-?(\d))?/,jJ=/(\d{4})-?(\d{3})/,GJ=Jz("weekYear","weekNumber","weekDay"),WJ=Jz("year","ordinal"),$J=/(\d{4})-(\d\d)-(\d\d)/,tF=RegExp(`${r2.source} ?(?:${Qz.source}|(${Kz.source}))?`),HJ=RegExp(`(?: ${tF.source})?`);function sf(t,e,n){const r=t[e];return Sn(r)?n:dc(r)}function ZJ(t,e){return[{year:sf(t,e),month:sf(t,e+1,1),day:sf(t,e+2,1)},null,e+3]}function $f(t,e){return[{hours:sf(t,e,0),minutes:sf(t,e+1,0),seconds:sf(t,e+2,0),milliseconds:e2(t[e+3])},null,e+4]}function c_(t,e){const n=!t[e]&&!t[e+1],r=Nx(t[e+1],t[e+2]),s=n?null:Ki.instance(r);return[{},s,e+3]}function u_(t,e){const n=t[e]?wl.create(t[e]):null;return[{},n,e+1]}const qJ=RegExp(`^T?${r2.source}$`),XJ=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function YJ(t){const[e,n,r,s,u,p,o,v,T]=t,I=e[0]==="-",L=v&&v[0]==="-",F=(j,X=!1)=>j!==void 0&&(X||j&&I)?-j:j;return[{years:F(Bu(n)),months:F(Bu(r)),weeks:F(Bu(s)),days:F(Bu(u)),hours:F(Bu(p)),minutes:F(Bu(o)),seconds:F(Bu(v),v==="-0"),milliseconds:F(e2(T),L)}]}const KJ={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function s2(t,e,n,r,s,u,p){const o={year:e.length===2?_T(dc(e)):dc(e),month:Wz.indexOf(n)+1,day:dc(r),hour:dc(s),minute:dc(u)};return p&&(o.second=dc(p)),t&&(o.weekday=t.length>3?Hz.indexOf(t)+1:Zz.indexOf(t)+1),o}const JJ=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function QJ(t){const[,e,n,r,s,u,p,o,v,T,I,L]=t,F=s2(e,s,r,n,u,p,o);let j;return v?j=KJ[v]:T?j=0:j=Nx(I,L),[F,new Ki(j)]}function eQ(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const tQ=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,nQ=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,rQ=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function IR(t){const[,e,n,r,s,u,p,o]=t;return[s2(e,s,r,n,u,p,o),Ki.utcInstance]}function iQ(t){const[,e,n,r,s,u,p,o]=t;return[s2(e,o,n,r,s,u,p),Ki.utcInstance]}const sQ=jf(UJ,i2),oQ=jf(VJ,i2),aQ=jf(jJ,i2),lQ=jf(eF),nF=Gf(ZJ,$f,c_,u_),cQ=Gf(GJ,$f,c_,u_),uQ=Gf(WJ,$f,c_,u_),hQ=Gf($f,c_,u_);function dQ(t){return Wf(t,[sQ,nF],[oQ,cQ],[aQ,uQ],[lQ,hQ])}function fQ(t){return Wf(eQ(t),[JJ,QJ])}function pQ(t){return Wf(t,[tQ,IR],[nQ,IR],[rQ,iQ])}function mQ(t){return Wf(t,[XJ,YJ])}const gQ=Gf($f);function _Q(t){return Wf(t,[qJ,gQ])}const yQ=jf($J,HJ),vQ=jf(tF),xQ=Gf($f,c_,u_);function bQ(t){return Wf(t,[yQ,nF],[vQ,xQ])}const wQ="Invalid Duration",rF={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},EQ={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...rF},no=146097/400,Md=146097/4800,TQ={years:{quarters:4,months:12,weeks:no/7,days:no,hours:no*24,minutes:no*24*60,seconds:no*24*60*60,milliseconds:no*24*60*60*1e3},quarters:{months:3,weeks:no/28,days:no/4,hours:no*24/4,minutes:no*24*60/4,seconds:no*24*60*60/4,milliseconds:no*24*60*60*1e3/4},months:{weeks:Md/7,days:Md,hours:Md*24,minutes:Md*24*60,seconds:Md*24*60*60,milliseconds:Md*24*60*60*1e3},...rF},Wu=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],SQ=Wu.slice(0).reverse();function cc(t,e,n=!1){const r={values:n?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Ln(r)}function AQ(t){return t<0?Math.floor(t):Math.ceil(t)}function iF(t,e,n,r,s){const u=t[s][n],p=e[n]/u,o=Math.sign(p)===Math.sign(r[s]),v=!o&&r[s]!==0&&Math.abs(p)<=1?AQ(p):Math.trunc(p);r[s]+=v,e[n]-=v*u}function CQ(t,e){SQ.reduce((n,r)=>Sn(e[r])?n:(n&&iF(t,e,n,e,r),r),null)}function MQ(t){const e={};for(const[n,r]of Object.entries(t))r!==0&&(e[n]=r);return e}class Ln{constructor(e){const n=e.conversionAccuracy==="longterm"||!1;let r=n?TQ:EQ;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||dr.create(),this.conversionAccuracy=n?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,n){return Ln.fromObject({milliseconds:e},n)}static fromObject(e,n={}){if(e==null||typeof e!="object")throw new oo(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ln({values:Jv(e,Ln.normalizeUnit),loc:dr.fromObject(n),conversionAccuracy:n.conversionAccuracy,matrix:n.matrix})}static fromDurationLike(e){if(nh(e))return Ln.fromMillis(e);if(Ln.isDuration(e))return e;if(typeof e=="object")return Ln.fromObject(e);throw new oo(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,n){const[r]=mQ(e);return r?Ln.fromObject(r,n):Ln.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,n){const[r]=_Q(e);return r?Ln.fromObject(r,n):Ln.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,n=null){if(!e)throw new oo("need to specify a reason the Duration is invalid");const r=e instanceof $o?e:new $o(e,n);if(Gr.throwOnInvalid)throw new nJ(r);return new Ln({invalid:r})}static normalizeUnit(e){const n={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!n)throw new bz(e);return n}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,n={}){const r={...n,floor:n.round!==!1&&n.floor!==!1};return this.isValid?Vi.create(this.loc,r).formatDurationFromString(this,e):wQ}toHuman(e={}){const n=Wu.map(r=>{const s=this.values[r];return Sn(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(n)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=t2(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const n=this.toMillis();if(n<0||n>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let u=r.toFormat(s);return e.includePrefix&&(u="T"+u),u}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const n=Ln.fromDurationLike(e),r={};for(const s of Wu)(If(n.values,s)||If(this.values,s))&&(r[s]=n.get(s)+this.get(s));return cc(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const n=Ln.fromDurationLike(e);return this.plus(n.negate())}mapUnits(e){if(!this.isValid)return this;const n={};for(const r of Object.keys(this.values))n[r]=Gz(e(this.values[r],r));return cc(this,{values:n},!0)}get(e){return this[Ln.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const n={...this.values,...Jv(e,Ln.normalizeUnit)};return cc(this,{values:n})}reconfigure({locale:e,numberingSystem:n,conversionAccuracy:r,matrix:s}={}){const p={loc:this.loc.clone({locale:e,numberingSystem:n}),matrix:s,conversionAccuracy:r};return cc(this,p)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return CQ(this.matrix,e),cc(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=MQ(this.normalize().shiftToAll().toObject());return cc(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(p=>Ln.normalizeUnit(p));const n={},r={},s=this.toObject();let u;for(const p of Wu)if(e.indexOf(p)>=0){u=p;let o=0;for(const T in r)o+=this.matrix[T][p]*r[T],r[T]=0;nh(s[p])&&(o+=s[p]);const v=Math.trunc(o);n[p]=v,r[p]=(o*1e3-v*1e3)/1e3;for(const T in s)Wu.indexOf(T)>Wu.indexOf(p)&&iF(this.matrix,s,T,n,p)}else nh(s[p])&&(r[p]=s[p]);for(const p in r)r[p]!==0&&(n[u]+=p===u?r[p]:r[p]/this.matrix[u][p]);return cc(this,{values:n},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const n of Object.keys(this.values))e[n]=this.values[n]===0?0:-this.values[n];return cc(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function n(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of Wu)if(!n(this.values[r],e.values[r]))return!1;return!0}}const Pd="Invalid Interval";function PQ(t,e){return!t||!t.isValid?Rr.invalid("missing or invalid start"):!e||!e.isValid?Rr.invalid("missing or invalid end"):e<t?Rr.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Rr{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,n=null){if(!e)throw new oo("need to specify a reason the Interval is invalid");const r=e instanceof $o?e:new $o(e,n);if(Gr.throwOnInvalid)throw new tJ(r);return new Rr({invalid:r})}static fromDateTimes(e,n){const r=Am(e),s=Am(n),u=PQ(r,s);return u??new Rr({start:r,end:s})}static after(e,n){const r=Ln.fromDurationLike(n),s=Am(e);return Rr.fromDateTimes(s,s.plus(r))}static before(e,n){const r=Ln.fromDurationLike(n),s=Am(e);return Rr.fromDateTimes(s.minus(r),s)}static fromISO(e,n){const[r,s]=(e||"").split("/",2);if(r&&s){let u,p;try{u=Qt.fromISO(r,n),p=u.isValid}catch{p=!1}let o,v;try{o=Qt.fromISO(s,n),v=o.isValid}catch{v=!1}if(p&&v)return Rr.fromDateTimes(u,o);if(p){const T=Ln.fromISO(s,n);if(T.isValid)return Rr.after(u,T)}else if(v){const T=Ln.fromISO(r,n);if(T.isValid)return Rr.before(o,T)}}return Rr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const n=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(n,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:n}={}){return this.isValid?Rr.fromDateTimes(e||this.s,n||this.e):this}splitAt(...e){if(!this.isValid)return[];const n=e.map(Am).filter(p=>this.contains(p)).sort(),r=[];let{s}=this,u=0;for(;s<this.e;){const p=n[u]||this.e,o=+p>+this.e?this.e:p;r.push(Rr.fromDateTimes(s,o)),s=o,u+=1}return r}splitBy(e){const n=Ln.fromDurationLike(e);if(!this.isValid||!n.isValid||n.as("milliseconds")===0)return[];let{s:r}=this,s=1,u;const p=[];for(;r<this.e;){const o=this.start.plus(n.mapUnits(v=>v*s));u=+o>+this.e?this.e:o,p.push(Rr.fromDateTimes(r,u)),r=u,s+=1}return p}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const n=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return n>=r?null:Rr.fromDateTimes(n,r)}union(e){if(!this.isValid)return this;const n=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return Rr.fromDateTimes(n,r)}static merge(e){const[n,r]=e.sort((s,u)=>s.s-u.s).reduce(([s,u],p)=>u?u.overlaps(p)||u.abutsStart(p)?[s,u.union(p)]:[s.concat([u]),p]:[s,p],[[],null]);return r&&n.push(r),n}static xor(e){let n=null,r=0;const s=[],u=e.map(v=>[{time:v.s,type:"s"},{time:v.e,type:"e"}]),p=Array.prototype.concat(...u),o=p.sort((v,T)=>v.time-T.time);for(const v of o)r+=v.type==="s"?1:-1,r===1?n=v.time:(n&&+n!=+v.time&&s.push(Rr.fromDateTimes(n,v.time)),n=null);return Rr.merge(s)}difference(...e){return Rr.xor([this].concat(e)).map(n=>this.intersection(n)).filter(n=>n&&!n.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Pd}toLocaleString(e=Xv,n={}){return this.isValid?Vi.create(this.s.loc.clone(n),e).formatInterval(this):Pd}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Pd}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Pd}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Pd}toFormat(e,{separator:n=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${n}${this.e.toFormat(e)}`:Pd}toDuration(e,n){return this.isValid?this.e.diff(this.s,e,n):Ln.invalid(this.invalidReason)}mapEndpoints(e){return Rr.fromDateTimes(e(this.s),e(this.e))}}class S0{static hasDST(e=Gr.defaultZone){const n=Qt.now().setZone(e).set({month:12});return!e.isUniversal&&n.offset!==n.set({month:6}).offset}static isValidIANAZone(e){return wl.isValidZone(e)}static normalizeZone(e){return mc(e,Gr.defaultZone)}static months(e="long",{locale:n=null,numberingSystem:r=null,locObj:s=null,outputCalendar:u="gregory"}={}){return(s||dr.create(n,r,u)).months(e)}static monthsFormat(e="long",{locale:n=null,numberingSystem:r=null,locObj:s=null,outputCalendar:u="gregory"}={}){return(s||dr.create(n,r,u)).months(e,!0)}static weekdays(e="long",{locale:n=null,numberingSystem:r=null,locObj:s=null}={}){return(s||dr.create(n,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:n=null,numberingSystem:r=null,locObj:s=null}={}){return(s||dr.create(n,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return dr.create(e).meridiems()}static eras(e="short",{locale:n=null}={}){return dr.create(n,null,"gregory").eras(e)}static features(){return{relative:Vz()}}}function RR(t,e){const n=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=n(e)-n(t);return Math.floor(Ln.fromMillis(r).as("days"))}function IQ(t,e,n){const r=[["years",(v,T)=>T.year-v.year],["quarters",(v,T)=>T.quarter-v.quarter+(T.year-v.year)*4],["months",(v,T)=>T.month-v.month+(T.year-v.year)*12],["weeks",(v,T)=>{const I=RR(v,T);return(I-I%7)/7}],["days",RR]],s={},u=t;let p,o;for(const[v,T]of r)n.indexOf(v)>=0&&(p=v,s[v]=T(t,e),o=u.plus(s),o>e?(s[v]--,t=u.plus(s)):t=o);return[t,s,o,p]}function RQ(t,e,n,r){let[s,u,p,o]=IQ(t,e,n);const v=e-s,T=n.filter(L=>["hours","minutes","seconds","milliseconds"].indexOf(L)>=0);T.length===0&&(p<e&&(p=s.plus({[o]:1})),p!==s&&(u[o]=(u[o]||0)+v/(p-s)));const I=Ln.fromObject(u,r);return T.length>0?Ln.fromMillis(v,r).shiftTo(...T).plus(I):I}const o2={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},kR={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},kQ=o2.hanidec.replace(/[\[|\]]/g,"").split("");function LQ(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);if(t[n].search(o2.hanidec)!==-1)e+=kQ.indexOf(t[n]);else for(const s in kR){const[u,p]=kR[s];r>=u&&r<=p&&(e+=r-u)}}return parseInt(e,10)}else return e}function No({numberingSystem:t},e=""){return new RegExp(`${o2[t||"latn"]}${e}`)}const OQ="missing Intl.DateTimeFormat.formatToParts support";function $n(t,e=n=>n){return{regex:t,deser:([n])=>e(LQ(n))}}const DQ=String.fromCharCode(160),sF=`[ ${DQ}]`,oF=new RegExp(sF,"g");function zQ(t){return t.replace(/\./g,"\\.?").replace(oF,sF)}function LR(t){return t.replace(/\./g,"").replace(oF," ").toLowerCase()}function Bo(t,e){return t===null?null:{regex:RegExp(t.map(zQ).join("|")),deser:([n])=>t.findIndex(r=>LR(n)===LR(r))+e}}function OR(t,e){return{regex:t,deser:([,n,r])=>Nx(n,r),groups:e}}function A0(t){return{regex:t,deser:([e])=>e}}function FQ(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function NQ(t,e){const n=No(e),r=No(e,"{2}"),s=No(e,"{3}"),u=No(e,"{4}"),p=No(e,"{6}"),o=No(e,"{1,2}"),v=No(e,"{1,3}"),T=No(e,"{1,6}"),I=No(e,"{1,9}"),L=No(e,"{2,4}"),F=No(e,"{4,6}"),j=de=>({regex:RegExp(FQ(de.val)),deser:([q])=>q,literal:!0}),re=(de=>{if(t.literal)return j(de);switch(de.val){case"G":return Bo(e.eras("short",!1),0);case"GG":return Bo(e.eras("long",!1),0);case"y":return $n(T);case"yy":return $n(L,_T);case"yyyy":return $n(u);case"yyyyy":return $n(F);case"yyyyyy":return $n(p);case"M":return $n(o);case"MM":return $n(r);case"MMM":return Bo(e.months("short",!0,!1),1);case"MMMM":return Bo(e.months("long",!0,!1),1);case"L":return $n(o);case"LL":return $n(r);case"LLL":return Bo(e.months("short",!1,!1),1);case"LLLL":return Bo(e.months("long",!1,!1),1);case"d":return $n(o);case"dd":return $n(r);case"o":return $n(v);case"ooo":return $n(s);case"HH":return $n(r);case"H":return $n(o);case"hh":return $n(r);case"h":return $n(o);case"mm":return $n(r);case"m":return $n(o);case"q":return $n(o);case"qq":return $n(r);case"s":return $n(o);case"ss":return $n(r);case"S":return $n(v);case"SSS":return $n(s);case"u":return A0(I);case"uu":return A0(o);case"uuu":return $n(n);case"a":return Bo(e.meridiems(),0);case"kkkk":return $n(u);case"kk":return $n(L,_T);case"W":return $n(o);case"WW":return $n(r);case"E":case"c":return $n(n);case"EEE":return Bo(e.weekdays("short",!1,!1),1);case"EEEE":return Bo(e.weekdays("long",!1,!1),1);case"ccc":return Bo(e.weekdays("short",!0,!1),1);case"cccc":return Bo(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return OR(new RegExp(`([+-]${o.source})(?::(${r.source}))?`),2);case"ZZZ":return OR(new RegExp(`([+-]${o.source})(${r.source})?`),2);case"z":return A0(/[a-z_+-/]{1,256}?/i);case" ":return A0(/[^\S\n\r]/);default:return j(de)}})(t)||{invalidReason:OQ};return re.token=t,re}const BQ={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function UQ(t,e){const{type:n,value:r}=t;if(n==="literal"){const p=/^\s+$/.test(r);return{literal:!p,val:p?" ":r}}const s=e[n];let u=BQ[n];if(typeof u=="object"&&(u=u[s]),u)return{literal:!1,val:u}}function VQ(t){return[`^${t.map(n=>n.regex).reduce((n,r)=>`${n}(${r.source})`,"")}$`,t]}function jQ(t,e,n){const r=t.match(e);if(r){const s={};let u=1;for(const p in n)if(If(n,p)){const o=n[p],v=o.groups?o.groups+1:1;!o.literal&&o.token&&(s[o.token.val[0]]=o.deser(r.slice(u,u+v))),u+=v}return[r,s]}else return[r,{}]}function GQ(t){const e=u=>{switch(u){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let n=null,r;return Sn(t.z)||(n=wl.create(t.z)),Sn(t.Z)||(n||(n=new Ki(t.Z)),r=t.Z),Sn(t.q)||(t.M=(t.q-1)*3+1),Sn(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Sn(t.u)||(t.S=e2(t.u)),[Object.keys(t).reduce((u,p)=>{const o=e(p);return o&&(u[o]=t[p]),u},{}),n,r]}let _w=null;function WQ(){return _w||(_w=Qt.fromMillis(1555555555555)),_w}function $Q(t,e){if(t.literal)return t;const n=Vi.macroTokenToFormatOpts(t.val),r=cF(n,e);return r==null||r.includes(void 0)?t:r}function aF(t,e){return Array.prototype.concat(...t.map(n=>$Q(n,e)))}function lF(t,e,n){const r=aF(Vi.parseFormat(n),t),s=r.map(p=>NQ(p,t)),u=s.find(p=>p.invalidReason);if(u)return{input:e,tokens:r,invalidReason:u.invalidReason};{const[p,o]=VQ(s),v=RegExp(p,"i"),[T,I]=jQ(e,v,o),[L,F,j]=I?GQ(I):[null,null,void 0];if(If(I,"a")&&If(I,"H"))throw new Lm("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:v,rawMatches:T,matches:I,result:L,zone:F,specificOffset:j}}}function HQ(t,e,n){const{result:r,zone:s,specificOffset:u,invalidReason:p}=lF(t,e,n);return[r,s,u,p]}function cF(t,e){return t?Vi.create(e,t).formatDateTimeParts(WQ()).map(s=>UQ(s,t)):null}const uF=[0,31,59,90,120,151,181,212,243,273,304,334],hF=[0,31,60,91,121,152,182,213,244,274,305,335];function uo(t,e){return new $o("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function dF(t,e,n){const r=new Date(Date.UTC(t,e-1,n));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function fF(t,e,n){return n+(l_(t)?hF:uF)[e-1]}function pF(t,e){const n=l_(t)?hF:uF,r=n.findIndex(u=>u<e),s=e-n[r];return{month:r+1,day:s}}function yT(t){const{year:e,month:n,day:r}=t,s=fF(e,n,r),u=dF(e,n,r);let p=Math.floor((s-u+10)/7),o;return p<1?(o=e-1,p=Kv(o)):p>Kv(e)?(o=e+1,p=1):o=e,{weekYear:o,weekNumber:p,weekday:u,...Bx(t)}}function DR(t){const{weekYear:e,weekNumber:n,weekday:r}=t,s=dF(e,1,4),u=Xm(e);let p=n*7+r-s-3,o;p<1?(o=e-1,p+=Xm(o)):p>u?(o=e+1,p-=Xm(e)):o=e;const{month:v,day:T}=pF(o,p);return{year:o,month:v,day:T,...Bx(t)}}function yw(t){const{year:e,month:n,day:r}=t,s=fF(e,n,r);return{year:e,ordinal:s,...Bx(t)}}function zR(t){const{year:e,ordinal:n}=t,{month:r,day:s}=pF(e,n);return{year:e,month:r,day:s,...Bx(t)}}function ZQ(t){const e=Fx(t.weekYear),n=hl(t.weekNumber,1,Kv(t.weekYear)),r=hl(t.weekday,1,7);return e?n?r?!1:uo("weekday",t.weekday):uo("week",t.week):uo("weekYear",t.weekYear)}function qQ(t){const e=Fx(t.year),n=hl(t.ordinal,1,Xm(t.year));return e?n?!1:uo("ordinal",t.ordinal):uo("year",t.year)}function mF(t){const e=Fx(t.year),n=hl(t.month,1,12),r=hl(t.day,1,Yv(t.year,t.month));return e?n?r?!1:uo("day",t.day):uo("month",t.month):uo("year",t.year)}function gF(t){const{hour:e,minute:n,second:r,millisecond:s}=t,u=hl(e,0,23)||e===24&&n===0&&r===0&&s===0,p=hl(n,0,59),o=hl(r,0,59),v=hl(s,0,999);return u?p?o?v?!1:uo("millisecond",s):uo("second",r):uo("minute",n):uo("hour",e)}const vw="Invalid DateTime",FR=864e13;function C0(t){return new $o("unsupported zone",`the zone "${t.name}" is not supported`)}function xw(t){return t.weekData===null&&(t.weekData=yT(t.c)),t.weekData}function Tm(t,e){const n={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Qt({...n,...e,old:n})}function _F(t,e,n){let r=t-e*60*1e3;const s=n.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const u=n.offset(r);return s===u?[r,s]:[t-Math.min(s,u)*60*1e3,Math.max(s,u)]}function NR(t,e){t+=e*60*1e3;const n=new Date(t);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function Q0(t,e,n){return _F(n2(t),e,n)}function BR(t,e){const n=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,u={...t.c,year:r,month:s,day:Math.min(t.c.day,Yv(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},p=Ln.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),o=n2(u);let[v,T]=_F(o,n,t.zone);return p!==0&&(v+=p,T=t.zone.offset(v)),{ts:v,o:T}}function Sm(t,e,n,r,s,u){const{setZone:p,zone:o}=n;if(t&&Object.keys(t).length!==0||e){const v=e||o,T=Qt.fromObject(t,{...n,zone:v,specificOffset:u});return p?T:T.setZone(o)}else return Qt.invalid(new $o("unparsable",`the input "${s}" can't be parsed as ${r}`))}function M0(t,e,n=!0){return t.isValid?Vi.create(dr.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(t,e):null}function bw(t,e){const n=t.c.year>9999||t.c.year<0;let r="";return n&&t.c.year>=0&&(r+="+"),r+=Wr(t.c.year,n?6:4),e?(r+="-",r+=Wr(t.c.month),r+="-",r+=Wr(t.c.day)):(r+=Wr(t.c.month),r+=Wr(t.c.day)),r}function UR(t,e,n,r,s,u){let p=Wr(t.c.hour);return e?(p+=":",p+=Wr(t.c.minute),(t.c.second!==0||!n)&&(p+=":")):p+=Wr(t.c.minute),(t.c.second!==0||!n)&&(p+=Wr(t.c.second),(t.c.millisecond!==0||!r)&&(p+=".",p+=Wr(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!u?p+="Z":t.o<0?(p+="-",p+=Wr(Math.trunc(-t.o/60)),p+=":",p+=Wr(Math.trunc(-t.o%60))):(p+="+",p+=Wr(Math.trunc(t.o/60)),p+=":",p+=Wr(Math.trunc(t.o%60)))),u&&(p+="["+t.zone.ianaName+"]"),p}const yF={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},XQ={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},YQ={ordinal:1,hour:0,minute:0,second:0,millisecond:0},vF=["year","month","day","hour","minute","second","millisecond"],KQ=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],JQ=["year","ordinal","hour","minute","second","millisecond"];function VR(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new bz(t);return e}function jR(t,e){const n=mc(e.zone,Gr.defaultZone),r=dr.fromObject(e),s=Gr.now();let u,p;if(Sn(t.year))u=s;else{for(const T of vF)Sn(t[T])&&(t[T]=yF[T]);const o=mF(t)||gF(t);if(o)return Qt.invalid(o);const v=n.offset(s);[u,p]=Q0(t,v,n)}return new Qt({ts:u,zone:n,loc:r,o:p})}function GR(t,e,n){const r=Sn(n.round)?!0:n.round,s=(p,o)=>(p=t2(p,r||n.calendary?0:2,!0),e.loc.clone(n).relFormatter(n).format(p,o)),u=p=>n.calendary?e.hasSame(t,p)?0:e.startOf(p).diff(t.startOf(p),p).get(p):e.diff(t,p).get(p);if(n.unit)return s(u(n.unit),n.unit);for(const p of n.units){const o=u(p);if(Math.abs(o)>=1)return s(o,p)}return s(t>e?-0:0,n.units[n.units.length-1])}function WR(t){let e={},n;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],n=Array.from(t).slice(0,t.length-1)):n=Array.from(t),[e,n]}class Qt{constructor(e){const n=e.zone||Gr.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new $o("invalid input"):null)||(n.isValid?null:C0(n));this.ts=Sn(e.ts)?Gr.now():e.ts;let s=null,u=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(n))[s,u]=[e.old.c,e.old.o];else{const o=n.offset(this.ts);s=NR(this.ts,o),r=Number.isNaN(s.year)?new $o("invalid input"):null,s=r?null:s,u=r?null:o}this._zone=n,this.loc=e.loc||dr.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=u,this.isLuxonDateTime=!0}static now(){return new Qt({})}static local(){const[e,n]=WR(arguments),[r,s,u,p,o,v,T]=n;return jR({year:r,month:s,day:u,hour:p,minute:o,second:v,millisecond:T},e)}static utc(){const[e,n]=WR(arguments),[r,s,u,p,o,v,T]=n;return e.zone=Ki.utcInstance,jR({year:r,month:s,day:u,hour:p,minute:o,second:v,millisecond:T},e)}static fromJSDate(e,n={}){const r=EJ(e)?e.valueOf():NaN;if(Number.isNaN(r))return Qt.invalid("invalid input");const s=mc(n.zone,Gr.defaultZone);return s.isValid?new Qt({ts:r,zone:s,loc:dr.fromObject(n)}):Qt.invalid(C0(s))}static fromMillis(e,n={}){if(nh(e))return e<-FR||e>FR?Qt.invalid("Timestamp out of range"):new Qt({ts:e,zone:mc(n.zone,Gr.defaultZone),loc:dr.fromObject(n)});throw new oo(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,n={}){if(nh(e))return new Qt({ts:e*1e3,zone:mc(n.zone,Gr.defaultZone),loc:dr.fromObject(n)});throw new oo("fromSeconds requires a numerical input")}static fromObject(e,n={}){e=e||{};const r=mc(n.zone,Gr.defaultZone);if(!r.isValid)return Qt.invalid(C0(r));const s=Gr.now(),u=Sn(n.specificOffset)?r.offset(s):n.specificOffset,p=Jv(e,VR),o=!Sn(p.ordinal),v=!Sn(p.year),T=!Sn(p.month)||!Sn(p.day),I=v||T,L=p.weekYear||p.weekNumber,F=dr.fromObject(n);if((I||o)&&L)throw new Lm("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(T&&o)throw new Lm("Can't mix ordinal dates with month/day");const j=L||p.weekday&&!I;let X,re,de=NR(s,u);j?(X=KQ,re=XQ,de=yT(de)):o?(X=JQ,re=YQ,de=yw(de)):(X=vF,re=yF);let q=!1;for(const at of X){const rt=p[at];Sn(rt)?q?p[at]=re[at]:p[at]=de[at]:q=!0}const H=j?ZQ(p):o?qQ(p):mF(p),J=H||gF(p);if(J)return Qt.invalid(J);const Ee=j?DR(p):o?zR(p):p,[ue,Fe]=Q0(Ee,u,r),Qe=new Qt({ts:ue,zone:r,o:Fe,loc:F});return p.weekday&&I&&e.weekday!==Qe.weekday?Qt.invalid("mismatched weekday",`you can't specify both a weekday of ${p.weekday} and a date of ${Qe.toISO()}`):Qe}static fromISO(e,n={}){const[r,s]=dQ(e);return Sm(r,s,n,"ISO 8601",e)}static fromRFC2822(e,n={}){const[r,s]=fQ(e);return Sm(r,s,n,"RFC 2822",e)}static fromHTTP(e,n={}){const[r,s]=pQ(e);return Sm(r,s,n,"HTTP",n)}static fromFormat(e,n,r={}){if(Sn(e)||Sn(n))throw new oo("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:u=null}=r,p=dr.fromOpts({locale:s,numberingSystem:u,defaultToEN:!0}),[o,v,T,I]=HQ(p,e,n);return I?Qt.invalid(I):Sm(o,v,r,`format ${n}`,e,T)}static fromString(e,n,r={}){return Qt.fromFormat(e,n,r)}static fromSQL(e,n={}){const[r,s]=bQ(e);return Sm(r,s,n,"SQL",e)}static invalid(e,n=null){if(!e)throw new oo("need to specify a reason the DateTime is invalid");const r=e instanceof $o?e:new $o(e,n);if(Gr.throwOnInvalid)throw new eJ(r);return new Qt({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,n={}){const r=cF(e,dr.fromObject(n));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,n={}){return aF(Vi.parseFormat(e),dr.fromObject(n)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?xw(this).weekYear:NaN}get weekNumber(){return this.isValid?xw(this).weekNumber:NaN}get weekday(){return this.isValid?xw(this).weekday:NaN}get ordinal(){return this.isValid?yw(this.c).ordinal:NaN}get monthShort(){return this.isValid?S0.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?S0.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?S0.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?S0.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return l_(this.year)}get daysInMonth(){return Yv(this.year,this.month)}get daysInYear(){return this.isValid?Xm(this.year):NaN}get weeksInWeekYear(){return this.isValid?Kv(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:n,numberingSystem:r,calendar:s}=Vi.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:n,numberingSystem:r,outputCalendar:s}}toUTC(e=0,n={}){return this.setZone(Ki.instance(e),n)}toLocal(){return this.setZone(Gr.defaultZone)}setZone(e,{keepLocalTime:n=!1,keepCalendarTime:r=!1}={}){if(e=mc(e,Gr.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(n||r){const u=e.offset(this.ts),p=this.toObject();[s]=Q0(p,u,e)}return Tm(this,{ts:s,zone:e})}else return Qt.invalid(C0(e))}reconfigure({locale:e,numberingSystem:n,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:n,outputCalendar:r});return Tm(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const n=Jv(e,VR),r=!Sn(n.weekYear)||!Sn(n.weekNumber)||!Sn(n.weekday),s=!Sn(n.ordinal),u=!Sn(n.year),p=!Sn(n.month)||!Sn(n.day),o=u||p,v=n.weekYear||n.weekNumber;if((o||s)&&v)throw new Lm("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(p&&s)throw new Lm("Can't mix ordinal dates with month/day");let T;r?T=DR({...yT(this.c),...n}):Sn(n.ordinal)?(T={...this.toObject(),...n},Sn(n.day)&&(T.day=Math.min(Yv(T.year,T.month),T.day))):T=zR({...yw(this.c),...n});const[I,L]=Q0(T,this.o,this.zone);return Tm(this,{ts:I,o:L})}plus(e){if(!this.isValid)return this;const n=Ln.fromDurationLike(e);return Tm(this,BR(this,n))}minus(e){if(!this.isValid)return this;const n=Ln.fromDurationLike(e).negate();return Tm(this,BR(this,n))}startOf(e){if(!this.isValid)return this;const n={},r=Ln.normalizeUnit(e);switch(r){case"years":n.month=1;case"quarters":case"months":n.day=1;case"weeks":case"days":n.hour=0;case"hours":n.minute=0;case"minutes":n.second=0;case"seconds":n.millisecond=0;break}if(r==="weeks"&&(n.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);n.month=(s-1)*3+1}return this.set(n)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,n={}){return this.isValid?Vi.create(this.loc.redefaultToEN(n)).formatDateTimeFromString(this,e):vw}toLocaleString(e=Xv,n={}){return this.isValid?Vi.create(this.loc.clone(n),e).formatDateTime(this):vw}toLocaleParts(e={}){return this.isValid?Vi.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:n=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:u=!1}={}){if(!this.isValid)return null;const p=e==="extended";let o=bw(this,p);return o+="T",o+=UR(this,p,n,r,s,u),o}toISODate({format:e="extended"}={}){return this.isValid?bw(this,e==="extended"):null}toISOWeekDate(){return M0(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:n=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:u=!1,format:p="extended"}={}){return this.isValid?(s?"T":"")+UR(this,p==="extended",n,e,r,u):null}toRFC2822(){return M0(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return M0(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?bw(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:n=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(n||e)&&(r&&(s+=" "),n?s+="z":e&&(s+="ZZ")),M0(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():vw}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const n={...this.c};return e.includeConfig&&(n.outputCalendar=this.outputCalendar,n.numberingSystem=this.loc.numberingSystem,n.locale=this.loc.locale),n}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,n="milliseconds",r={}){if(!this.isValid||!e.isValid)return Ln.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},u=TJ(n).map(Ln.normalizeUnit),p=e.valueOf()>this.valueOf(),o=p?this:e,v=p?e:this,T=RQ(o,v,u,s);return p?T.negate():T}diffNow(e="milliseconds",n={}){return this.diff(Qt.now(),e,n)}until(e){return this.isValid?Rr.fromDateTimes(this,e):this}hasSame(e,n){if(!this.isValid)return!1;const r=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(n)<=r&&r<=s.endOf(n)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const n=e.base||Qt.fromObject({},{zone:this.zone}),r=e.padding?this<n?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],u=e.unit;return Array.isArray(e.unit)&&(s=e.unit,u=void 0),GR(n,this.plus(r),{...e,numeric:"always",units:s,unit:u})}toRelativeCalendar(e={}){return this.isValid?GR(e.base||Qt.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Qt.isDateTime))throw new oo("min requires all arguments be DateTimes");return MR(e,n=>n.valueOf(),Math.min)}static max(...e){if(!e.every(Qt.isDateTime))throw new oo("max requires all arguments be DateTimes");return MR(e,n=>n.valueOf(),Math.max)}static fromFormatExplain(e,n,r={}){const{locale:s=null,numberingSystem:u=null}=r,p=dr.fromOpts({locale:s,numberingSystem:u,defaultToEN:!0});return lF(p,e,n)}static fromStringExplain(e,n,r={}){return Qt.fromFormatExplain(e,n,r)}static get DATE_SHORT(){return Xv}static get DATE_MED(){return wz}static get DATE_MED_WITH_WEEKDAY(){return rJ}static get DATE_FULL(){return Ez}static get DATE_HUGE(){return Tz}static get TIME_SIMPLE(){return Sz}static get TIME_WITH_SECONDS(){return Az}static get TIME_WITH_SHORT_OFFSET(){return Cz}static get TIME_WITH_LONG_OFFSET(){return Mz}static get TIME_24_SIMPLE(){return Pz}static get TIME_24_WITH_SECONDS(){return Iz}static get TIME_24_WITH_SHORT_OFFSET(){return Rz}static get TIME_24_WITH_LONG_OFFSET(){return kz}static get DATETIME_SHORT(){return Lz}static get DATETIME_SHORT_WITH_SECONDS(){return Oz}static get DATETIME_MED(){return Dz}static get DATETIME_MED_WITH_SECONDS(){return zz}static get DATETIME_MED_WITH_WEEKDAY(){return iJ}static get DATETIME_FULL(){return Fz}static get DATETIME_FULL_WITH_SECONDS(){return Nz}static get DATETIME_HUGE(){return Bz}static get DATETIME_HUGE_WITH_SECONDS(){return Uz}}function Am(t){if(Qt.isDateTime(t))return t;if(t&&t.valueOf&&nh(t.valueOf()))return Qt.fromJSDate(t);if(t&&typeof t=="object")return Qt.fromObject(t);throw new oo(`Unknown datetime argument: ${t}, of type ${typeof t}`)}class Qv{constructor(e){Is(this,"city");Is(this,"state");Is(this,"postalCode");Is(this,"country");Qv.isLocation(e)&&(this.city=dT(e.city),this.state=e.state,this.postalCode=e.postalCode,this.country=dT(e.country))}toString(){return[this.city,this.state,this.country,this.postalCode].filter(Boolean).join(", ")}static isLocation(e){const n=e;return n.city!==void 0||n.country!==void 0||n.postalCode!==void 0||n.state!==void 0}}const $R={3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},QQ=(t=[0,0,0])=>{var n;let e="#";for(let r=0;r<3;r++){let s=(n=t[r])==null?void 0:n.toString(16).split(".")[0];s==="0"&&(s="00"),e+=s}return e},HR=(t="#000000")=>{let e=t.replace("#","");const n=`${e[0]}${e[1]}`,r=`${e[2]}${e[3]}`,s=`${e[4]}${e[5]}`;return[parseInt(n,16),parseInt(r,16),parseInt(s,16),255]},eee=(t,e)=>{let n,r=t>12?12:t;if(r>=3){const u=$R[r][e%r];n={hex:u,rgba:HR(u)}}else{const s=$R[3][e===0?0:2];n={hex:s,rgba:HR(s)}}return n},tee=(t,e)=>{const n=[t.rgba[0]*e,t.rgba[1]*e,t.rgba[2]*e,255];return{hex:QQ(n),rgba:n}},nee="modulepreload",ree=function(t){return"/unboX/"+t},ZR={},xF=function(e,n,r){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(u=>{if(u=ree(u),u in ZR)return;ZR[u]=!0;const p=u.endsWith(".css"),o=p?'[rel="stylesheet"]':"";if(!!r)for(let I=s.length-1;I>=0;I--){const L=s[I];if(L.href===u&&(!p||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${o}`))return;const T=document.createElement("link");if(T.rel=p?"stylesheet":nee,p||(T.as="script",T.crossOrigin=""),T.href=u,document.head.appendChild(T),p)return new Promise((I,L)=>{T.addEventListener("load",I),T.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${u}`)))})})).then(()=>e())};var ex={},iee={get exports(){return ex},set exports(t){ex=t}};(function(t,e){(function(n,r){t.exports=r()})(qd,function(){var n,r,s;function u(o,v){if(!n)n=v;else if(!r)r=v;else{var T="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",I={};n(I),s=v(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(s.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}u(["exports"],function(o){var v=typeof self<"u"?self:{},T="2.13.0";let I;const L={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(I==null){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{I={ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_HOME:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",ANDROID_SDK_ROOT:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",APPDATA:"C:\\Users\\USER\\AppData\\Roaming",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\LOCAL\\crashpad_2396_XQNPDLUZICTAWSPV",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"EZRA",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EFC_5396:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\USER",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\USER",INIT_CWD:"C:\\Users\\USER\\Desktop\\parcel-tracker",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\USER\\AppData\\Local",LOGONSERVER:"\\\\EZRA",NODE:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",NODE_ENV:"production",NODE_PATH:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.pnpm\\node_modules",npm_command:"run-script",npm_config_legacy_peer_deps:"true",npm_config_registry:"https://registry.npmjs.org/",npm_config_store_dir:"C:/Users/USER/AppData/Local/pnpm/store",npm_config_user_agent:"pnpm/8.2.0 npm/? node/v18.1.0 win32 x64",npm_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_lifecycle_event:"build",npm_lifecycle_script:"vite build",npm_node_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_package_dependencies_bulma:"^0.9.4",npm_package_dependencies_bulma_extensions:"^6.2.7",npm_package_dependencies_deck_gl:"^8.9.7",npm_package_dependencies_luxon:"^3.3.0",npm_package_dependencies_mapbox_gl:"^2.13.0",npm_package_dependencies_mobx:"^6.9.0",npm_package_dependencies_mobx_react:"^8.0.0",npm_package_dependencies_mobx_utils:"^6.0.6",npm_package_dependencies_react:"^18.2.0",npm_package_dependencies_react_dom:"^18.2.0",npm_package_dependencies_react_icons:"^4.8.0",npm_package_dependencies_react_map_gl:"^7.0.21",npm_package_dependencies_react_router:"^6.10.0",npm_package_dependencies_react_router_dom:"^6.10.0",npm_package_dependencies_worker_loader:"^3.0.8",npm_package_dependencies__creativebulma_bulma_collapsible:"^1.0.4",npm_package_dependencies__danmarshall_deckgl_typings:"^4.9.28",npm_package_dependencies__deck_gl_core:"^8.9.7",npm_package_dependencies__mapbox_mapbox_sdk:"^0.15.0",npm_package_dependencies__turf_bbox:"^6.5.0",npm_package_dependencies__turf_bbox_polygon:"^6.5.0",npm_package_dependencies__turf_helpers:"^6.5.0",npm_package_dependencies__types_luxon:"^3.3.0",npm_package_dependencies__types_mapbox_gl:"^2.7.10",npm_package_dependencies__types_mapbox__mapbox_sdk:"^0.13.4",npm_package_devDependencies_sass:"^1.61.0",npm_package_devDependencies_typescript:"^4.9.5",npm_package_devDependencies_vite:"^4.2.1",npm_package_devDependencies__types_node:"^18.15.11",npm_package_devDependencies__types_react:"^18.0.33",npm_package_devDependencies__types_react_dom:"^18.0.11",npm_package_devDependencies__vitejs_plugin_react:"^3.1.0",npm_package_name:"parcel-tracker",npm_package_private:"true",npm_package_scripts_build:"vite build",npm_package_scripts_dev:"vite",npm_package_scripts_preview:"vite preview",npm_package_type:"module",npm_package_version:"0.0.0",NUMBER_OF_PROCESSORS:"4",OneDrive:"C:\\Users\\USER\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.bin;C:\\snapshot\\dist\\node-gyp-bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Git\\cmd;C:\\Program Files\\PostgreSQL\\14\\bin;C:\\Program Files\\dotnet\\;C:\\Program Files (x86)\\ADB and Fastboot++;C:\\Users\\USER\\AppData\\Local\\pnpm;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\Scripts\\;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\;C:\\Users\\USER\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\USER\\AppData\\Roaming\\npm;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\cmdline-tools\\latest\\bin;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\emulator;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\platform-tools;",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JSE;.WSF;.WSH;.MSC;.CPL",PNPM_HOME:"C:\\Users\\USER\\AppData\\Local\\pnpm",PNPM_SCRIPT_SRC_DIR:"C:\\Users\\USER\\Desktop\\parcel-tracker",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 69 Stepping 1, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"4501",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\USER\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\USER\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.77.0",TMP:"C:\\Users\\USER\\AppData\\Local\\Temp",USERDOMAIN:"EZRA",USERDOMAIN_ROAMINGPROFILE:"EZRA",USERNAME:"USER",USERPROFILE:"C:\\Users\\USER",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"--ms-enable-electron-run-as-node",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-b0a863057a-sock",VSCODE_INJECTION:"1",windir:"C:\\WINDOWS"}.API_URL_REGEX!=null?new RegExp({ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_HOME:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",ANDROID_SDK_ROOT:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",APPDATA:"C:\\Users\\USER\\AppData\\Roaming",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\LOCAL\\crashpad_2396_XQNPDLUZICTAWSPV",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"EZRA",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EFC_5396:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\USER",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\USER",INIT_CWD:"C:\\Users\\USER\\Desktop\\parcel-tracker",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\USER\\AppData\\Local",LOGONSERVER:"\\\\EZRA",NODE:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",NODE_ENV:"production",NODE_PATH:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.pnpm\\node_modules",npm_command:"run-script",npm_config_legacy_peer_deps:"true",npm_config_registry:"https://registry.npmjs.org/",npm_config_store_dir:"C:/Users/USER/AppData/Local/pnpm/store",npm_config_user_agent:"pnpm/8.2.0 npm/? node/v18.1.0 win32 x64",npm_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_lifecycle_event:"build",npm_lifecycle_script:"vite build",npm_node_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_package_dependencies_bulma:"^0.9.4",npm_package_dependencies_bulma_extensions:"^6.2.7",npm_package_dependencies_deck_gl:"^8.9.7",npm_package_dependencies_luxon:"^3.3.0",npm_package_dependencies_mapbox_gl:"^2.13.0",npm_package_dependencies_mobx:"^6.9.0",npm_package_dependencies_mobx_react:"^8.0.0",npm_package_dependencies_mobx_utils:"^6.0.6",npm_package_dependencies_react:"^18.2.0",npm_package_dependencies_react_dom:"^18.2.0",npm_package_dependencies_react_icons:"^4.8.0",npm_package_dependencies_react_map_gl:"^7.0.21",npm_package_dependencies_react_router:"^6.10.0",npm_package_dependencies_react_router_dom:"^6.10.0",npm_package_dependencies_worker_loader:"^3.0.8",npm_package_dependencies__creativebulma_bulma_collapsible:"^1.0.4",npm_package_dependencies__danmarshall_deckgl_typings:"^4.9.28",npm_package_dependencies__deck_gl_core:"^8.9.7",npm_package_dependencies__mapbox_mapbox_sdk:"^0.15.0",npm_package_dependencies__turf_bbox:"^6.5.0",npm_package_dependencies__turf_bbox_polygon:"^6.5.0",npm_package_dependencies__turf_helpers:"^6.5.0",npm_package_dependencies__types_luxon:"^3.3.0",npm_package_dependencies__types_mapbox_gl:"^2.7.10",npm_package_dependencies__types_mapbox__mapbox_sdk:"^0.13.4",npm_package_devDependencies_sass:"^1.61.0",npm_package_devDependencies_typescript:"^4.9.5",npm_package_devDependencies_vite:"^4.2.1",npm_package_devDependencies__types_node:"^18.15.11",npm_package_devDependencies__types_react:"^18.0.33",npm_package_devDependencies__types_react_dom:"^18.0.11",npm_package_devDependencies__vitejs_plugin_react:"^3.1.0",npm_package_name:"parcel-tracker",npm_package_private:"true",npm_package_scripts_build:"vite build",npm_package_scripts_dev:"vite",npm_package_scripts_preview:"vite preview",npm_package_type:"module",npm_package_version:"0.0.0",NUMBER_OF_PROCESSORS:"4",OneDrive:"C:\\Users\\USER\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.bin;C:\\snapshot\\dist\\node-gyp-bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Git\\cmd;C:\\Program Files\\PostgreSQL\\14\\bin;C:\\Program Files\\dotnet\\;C:\\Program Files (x86)\\ADB and Fastboot++;C:\\Users\\USER\\AppData\\Local\\pnpm;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\Scripts\\;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\;C:\\Users\\USER\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\USER\\AppData\\Roaming\\npm;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\cmdline-tools\\latest\\bin;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\emulator;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\platform-tools;",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JSE;.WSF;.WSH;.MSC;.CPL",PNPM_HOME:"C:\\Users\\USER\\AppData\\Local\\pnpm",PNPM_SCRIPT_SRC_DIR:"C:\\Users\\USER\\Desktop\\parcel-tracker",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 69 Stepping 1, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"4501",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\USER\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\USER\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.77.0",TMP:"C:\\Users\\USER\\AppData\\Local\\Temp",USERDOMAIN:"EZRA",USERDOMAIN_ROAMINGPROFILE:"EZRA",USERNAME:"USER",USERPROFILE:"C:\\Users\\USER",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"--ms-enable-electron-run-as-node",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-b0a863057a-sock",VSCODE_INJECTION:"1",windir:"C:\\WINDOWS"}.API_URL_REGEX):a}catch{I=a}}return I},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},F={supported:!1,testSupport:function(a){!re&&X&&(de?q(a):j=a)}};let j,X,re=!1,de=!1;function q(a){const i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,X),a.isContextLost())return;F.supported=!0}catch{}a.deleteTexture(i),re=!0}v.document&&(X=v.document.createElement("img"),X.onload=function(){j&&q(j),j=null,de=!0},X.onerror=function(){re=!0,j=null},X.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const H="01";var J=Ee;function Ee(a,i,l,h){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=i,this.p2x=l,this.p2y=h}Ee.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,i){if(i===void 0&&(i=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,h=0;h<8;h++){var f=this.sampleCurveX(l)-a;if(Math.abs(f)<i)return l;var g=this.sampleCurveDerivativeX(l);if(Math.abs(g)<1e-6)break;l-=f/g}var y=0,b=1;for(l=a,h=0;h<20&&(f=this.sampleCurveX(l),!(Math.abs(f-a)<i));h++)a>f?y=l:b=l,l=.5*(b-y)+y;return l},solve:function(a,i){return this.sampleCurveY(this.solveCurveX(a,i))}};var ue=Fe;function Fe(a,i){this.x=a,this.y=i}Fe.prototype={clone:function(){return new Fe(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,i){return this.clone()._rotateAround(a,i)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var i=a.x-this.x,l=a.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,i){return Math.atan2(this.x*i-this.y*a,this.x*a+this.y*i)},_matMult:function(a){var i=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=i,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var i=Math.cos(a),l=Math.sin(a),h=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=h,this},_rotateAround:function(a,i){var l=Math.cos(a),h=Math.sin(a),f=i.y+h*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-h*(this.y-i.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fe.convert=function(a){return a instanceof Fe?a:Array.isArray(a)?new Fe(a[0],a[1]):a};const Qe=Math.PI/180,at=180/Math.PI;function rt(a){return a*Qe}function ht(a){return a*at}const Bt=[[0,0],[1,0],[1,1],[0,1]];function Dn(a){if(a<=0)return 0;if(a>=1)return 1;const i=a*a,l=i*a;return 4*(a<.5?l:3*(a-i)+l-.75)}function zn(a,i,l,h){const f=new J(a,i,l,h);return function(g){return f.solve(g)}}const cn=zn(.25,.1,.25,1);function jt(a,i,l){return Math.min(l,Math.max(i,a))}function ts(a,i,l){return(l=jt((l-a)/(i-a),0,1))*l*(3-2*l)}function Ci(a,i,l){const h=l-i,f=((a-i)%h+h)%h+i;return f===i?l:f}function wt(a,i,l){if(!a.length)return l(null,[]);let h=a.length;const f=new Array(a.length);let g=null;a.forEach((y,b)=>{i(y,(E,S)=>{E&&(g=E),f[b]=S,--h==0&&l(g,f)})})}function Gt(a){const i=[];for(const l in a)i.push(a[l]);return i}function Ot(a,...i){for(const l of i)for(const h in l)a[h]=l[h];return a}let bn=1;function Cn(){return bn++}function Hr(){return function a(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function pr(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function ns(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Fr(a,i){a.forEach(l=>{i[l]&&(i[l]=i[l].bind(i))})}function Mn(a,i){return a.indexOf(i,a.length-i.length)!==-1}function Zr(a,i,l){const h={};for(const f in a)h[f]=i.call(l||this,a[f],f,a);return h}function Hn(a,i,l){const h={};for(const f in a)i.call(l||this,a[f],f,a)&&(h[f]=a[f]);return h}function Zn(a){return Array.isArray(a)?a.map(Zn):typeof a=="object"&&a?Zr(a,Zn):a}const go={};function Vn(a){go[a]||(typeof console<"u"&&console.warn(a),go[a]=!0)}function qr(a,i,l){return(l.y-a.y)*(i.x-a.x)>(i.y-a.y)*(l.x-a.x)}function on(a){let i=0;for(let l,h,f=0,g=a.length,y=g-1;f<g;y=f++)l=a[f],h=a[y],i+=(h.x-l.x)*(l.y+h.y);return i}function Xr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Lr(a){const i={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,f,g)=>{const y=f||g;return i[h]=!y||y.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i}let Gi=null;function rs(a){if(Gi==null){const i=a.navigator?a.navigator.userAgent:null;Gi=!!a.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Gi}function ta(a){try{const i=v[a];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function is(a,i){return[a[4*i],a[4*i+1],a[4*i+2],a[4*i+3]]}const Or="mapbox-tiles";let Wi,ss,na=500,ra=50;function Va(){try{return v.caches}catch{}}function Es(){Va()&&!Wi&&(Wi=v.caches.open(Or))}function _o(a){const i=a.indexOf("?");if(i<0)return a;const l=function(f){const g=f.indexOf("?");return g>0?f.slice(g+1).split("&"):[]}(a),h=l.filter(f=>{const g=f.split("=");return g[0]==="language"||g[0]==="worldview"});return h.length?`${a.slice(0,i)}?${h.join("&")}`:a.slice(0,i)}let yo=1/0;const vo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(vo);class Nr extends Error{constructor(i,l,h){l===401&&Zs(h)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xo=Xr()?()=>self.worker&&self.worker.referrer:()=>(v.location.protocol==="blob:"?v.parent:v).location.href,Hs=function(a,i){if(!(/^file:/.test(l=a.url)||/^file:/.test(xo())&&!/^\w+:/.test(l))){if(v.fetch&&v.Request&&v.AbortController&&v.Request.prototype.hasOwnProperty("signal"))return function(h,f){const g=new v.AbortController,y=new v.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:xo(),signal:g.signal});let b=!1,E=!1;const S=(M=y.url).indexOf("sku=")>0&&Zs(M);var M;h.type==="json"&&y.headers.set("Accept","application/json");const R=(z,N,V)=>{if(E)return;if(z&&z.message!=="SecurityError"&&Vn(z),N&&V)return k(N);const Y=Date.now();v.fetch(y).then(ce=>{if(ce.ok){const ge=S?ce.clone():null;return k(ce,ge,Y)}return f(new Nr(ce.statusText,ce.status,h.url))}).catch(ce=>{ce.name!=="AbortError"&&f(new Error(`${ce.message} ${h.url}`))})},k=(z,N,V)=>{(h.type==="arrayBuffer"?z.arrayBuffer():h.type==="json"?z.json():z.text()).then(Y=>{E||(N&&V&&function(ce,ge,ae){if(Es(),!Wi)return;const me={status:ge.status,statusText:ge.statusText,headers:new v.Headers};ge.headers.forEach((De,ke)=>me.headers.set(ke,De));const ve=Lr(ge.headers.get("Cache-Control")||"");if(ve["no-store"])return;ve["max-age"]&&me.headers.set("Expires",new Date(ae+1e3*ve["max-age"]).toUTCString());const _e=me.headers.get("Expires");_e&&(new Date(_e).getTime()-ae<42e4||function(De,ke){if(ss===void 0)try{new Response(new ReadableStream),ss=!0}catch{ss=!1}ss?ke(De.body):De.blob().then(ke)}(ge,De=>{const ke=new v.Response(De,me);Es(),Wi&&Wi.then($e=>$e.put(_o(ce.url),ke)).catch($e=>Vn($e.message))}))}(y,N,V),b=!0,f(null,Y,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(Y=>{E||f(new Error(Y.message))})};return S?function(z,N){if(Es(),!Wi)return N(null);const V=_o(z.url);Wi.then(Y=>{Y.match(V).then(ce=>{const ge=function(ae){if(!ae)return!1;const me=new Date(ae.headers.get("Expires")||0),ve=Lr(ae.headers.get("Cache-Control")||"");return me>Date.now()&&!ve["no-cache"]}(ce);Y.delete(V),ge&&Y.put(V,ce.clone()),N(null,ce,ge)}).catch(N)}).catch(N)}(y,R):R(null,null),{cancel:()=>{E=!0,b||g.abort()}}}(a,i);if(Xr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,i,void 0,!0)}var l;return function(h,f){const g=new v.XMLHttpRequest;g.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const y in h.headers)g.setRequestHeader(y,h.headers[y]);return h.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=h.credentials==="include",g.onerror=()=>{f(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(h.type==="json")try{y=JSON.parse(g.response)}catch(b){return f(b)}f(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else f(new Nr(g.statusText,g.status,h.url))},g.send(h.body),{cancel:()=>g.abort()}}(a,i)},bo=function(a,i){return Hs(Ot(a,{type:"arrayBuffer"}),i)};function ja(a){const i=v.document.createElement("a");return i.href=a,i.protocol===v.document.location.protocol&&i.host===v.document.location.host}const ia="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let sa,os;sa=[],os=0;const Ga=function(a,i){if(F.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),os>=L.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return sa.push(g),g}os++;let l=!1;const h=()=>{if(!l)for(l=!0,os--;sa.length&&os<L.MAX_PARALLEL_IMAGE_REQUESTS;){const g=sa.shift(),{requestParameters:y,callback:b,cancelled:E}=g;E||(g.cancel=Ga(y,b).cancel)}},f=bo(a,(g,y,b,E)=>{h(),g?i(g):y&&(v.createImageBitmap?function(S,M){const R=new v.Blob([new Uint8Array(S)],{type:"image/png"});v.createImageBitmap(R).then(k=>{M(null,k)}).catch(k=>{M(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(S,M)=>i(S,M,b,E)):function(S,M){const R=new v.Image,k=v.URL;R.onload=()=>{M(null,R),k.revokeObjectURL(R.src),R.onload=null,v.requestAnimationFrame(()=>{R.src=ia})},R.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new v.Blob([new Uint8Array(S)],{type:"image/png"});R.src=S.byteLength?k.createObjectURL(z):ia}(y,(S,M)=>i(S,M,b,E)))});return{cancel:()=>{f.cancel(),h()}}},wo="NO_ACCESS_TOKEN";function Mi(a){return a.indexOf("mapbox:")===0}function Zs(a){return L.API_URL_REGEX.test(a)}function oa(a){return L.API_CDN_URL_REGEX.test(a)}function Cl(a){return L.API_STYLE_REGEX.test(a)&&!aa(a)}function aa(a){return L.API_SPRITE_REGEX.test(a)}const Eo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ai(a){const i=a.match(Eo);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function qs(a){const i=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${i}`}function Ml(a){if(!a)return null;const i=a.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(decodeURIComponent(v.atob(i[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class To{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const l=Ml(L.ACCESS_TOKEN);let h="";return h=l&&l.u?v.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,g)=>String.fromCharCode(+("0x"+g)))):L.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${h}`:`mapbox.eventData:${h}`}fetchEventData(){const i=ta("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(i)try{const f=v.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const g=v.localStorage.getItem(h);g&&(this.anonId=g)}catch{Vn("Unable to read from LocalStorage")}}saveEventData(){const i=ta("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(i)try{v.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&v.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{Vn("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,l,h,f){if(!L.EVENTS_URL)return;const g=ai(L.EVENTS_URL);g.params.push(`access_token=${f||L.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(i).toISOString()},b=l?Ot(y,l):y,E={url:qs(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(S,M){return Hs(Ot(S,{method:"POST"}),M)}(E,S=>{this.pendingRequest=null,h(S),this.saveEventData(),this.processRequests(f)})}queueRequest(i,l){this.queue.push(i),this.processRequests(l)}}const oe=new class extends To{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,i){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>Mi(l)||Zs(l))&&this.queueRequest(Date.now(),i)}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Ml(L.ACCESS_TOKEN),l=i?i.u:L.ACCESS_TOKEN;let h=l!==this.eventData.tokenU;ns(this.anonId)||(this.anonId=Hr(),h=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),y=new Date(f),b=(f-this.eventData.lastSuccess)/864e5;h=h||b>=1||b<-1||g.getDate()!==y.getDate()}else h=!0;h?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:H,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a):this.processRequests()}},B=oe.postTurnstileEvent.bind(oe),G=new class extends To{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,i,l,h){this.skuToken=i,this.errorCb=h,L.EVENTS_URL&&(l||L.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(wo)))}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),ns(this.anonId)||(this.anonId=Hr()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:H,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):i&&(this.success[i]=!0)},a))}},se=G.postMapLoadEvent.bind(G),fe=new class extends To{constructor(){super("gljs.performance")}postPerformanceEvent(a,i){L.EVENTS_URL&&(a||L.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},a)}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:l}=this.queue.shift(),h=function(f){const g=v.performance.getEntriesByType("resource"),y=v.performance.getEntriesByType("mark"),b=function(k){const z={};if(k){for(const N in k)if(N!=="other")for(const V of k[N]){const Y=`${N}ResolveRangeMin`,ce=`${N}ResolveRangeMax`,ge=`${N}RequestCount`,ae=`${N}RequestCachedCount`;z[Y]=Math.min(z[Y]||1/0,V.startTime),z[ce]=Math.max(z[ce]||-1/0,V.responseEnd);const me=ve=>{z[ve]===void 0&&(z[ve]=0),++z[ve]};V.transferSize!==void 0&&V.transferSize===0&&me(ae),me(ge)}}return z}(function(k,z){const N={};if(k)for(const V of k){const Y=z(V);N[Y]===void 0&&(N[Y]=[]),N[Y].push(V)}return N}(g,ft)),E=v.devicePixelRatio,S=v.navigator.connection||v.navigator.mozConnection||v.navigator.webkitConnection,M={counters:[],metadata:[],attributes:[]},R=(k,z,N)=>{N!=null&&k.push({name:z,value:N.toString()})};for(const k in b)R(M.counters,k,b[k]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(R(M.counters,"interactionRangeMin",f.interactionRange[0]),R(M.counters,"interactionRangeMax",f.interactionRange[1])),y)for(const k of Object.keys(Re)){const z=Re[k],N=y.find(V=>V.name===z);N&&R(M.counters,z,N.startTime)}return R(M.counters,"visibilityHidden",f.visibilityHidden),R(M.attributes,"style",function(k){if(k)for(const z of k){const N=z.name.split("?")[0];if(Cl(N)){const V=N.split("/").slice(-2);if(V.length===2)return`mapbox://styles/${V[0]}/${V[1]}`}}}(g)),R(M.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),R(M.attributes,"fogEnabled",f.fogEnabled?"true":"false"),R(M.attributes,"projection",f.projection),R(M.attributes,"zoom",f.zoom),R(M.metadata,"devicePixelRatio",E),R(M.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),R(M.metadata,"navigatorUserAgent",v.navigator.userAgent),R(M.metadata,"screenWidth",v.screen.width),R(M.metadata,"screenHeight",v.screen.height),R(M.metadata,"windowWidth",v.innerWidth),R(M.metadata,"windowHeight",v.innerHeight),R(M.metadata,"mapWidth",f.width/E),R(M.metadata,"mapHeight",f.height/E),R(M.metadata,"webglRenderer",f.renderer),R(M.metadata,"webglVendor",f.vendor),R(M.metadata,"sdkVersion",T),R(M.metadata,"sdkIdentifier","mapbox-gl-js"),M}(l);for(const f of h.metadata);for(const f of h.counters);for(const f of h.attributes);this.postEvent(i,h,()=>{},a)}},we=fe.postPerformanceEvent.bind(fe),Ce=new class extends To{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,i,l,h){if(!L.API_URL||!L.SESSION_PATH)return;const f=ai(L.API_URL+L.SESSION_PATH);f.params.push(`sku=${i||""}`),f.params.push(`access_token=${h||L.ACCESS_TOKEN||""}`);const g={url:qs(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(y,b){return Hs(Ot(y,{method:"GET"}),b)}(g,y=>{this.pendingRequest=null,l(y),this.saveEventData(),this.processRequests(h)})}getSessionAPI(a,i,l,h){this.skuToken=i,this.errorCb=h,L.SESSION_PATH&&L.API_URL&&(l||L.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(wo)))}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||this.getSession(l,this.skuToken,h=>{h?this.errorCb(h):i&&(this.success[i]=!0)},a)}},Me=Ce.getSessionAPI.bind(Ce),Se=new Set,Re={create:"create",load:"load",fullLoad:"fullLoad"},Xe={mark(a){v.performance.mark(a)},measure(a,i,l){v.performance.measure(a,i,l)}};function ft(a){const i=a.name.split("?")[0];return oa(i)&&i.includes("mapbox-gl.js")?"javascript":oa(i)&&i.includes("mapbox-gl.css")?"css":function(l){return L.API_FONTS_REGEX.test(l)}(i)?"fontRange":aa(i)?"sprite":Cl(i)?"style":function(l){return L.API_TILEJSON_REGEX.test(l)}(i)?"tilejson":"other"}const et=v.performance;function Ct(a){const i=a?a.url.toString():void 0;return et.getEntriesByName(i)}let St,Tt,Lt,Ht;const un={now:()=>Lt!==void 0?Lt:v.performance.now(),setNow(a){Lt=a},restoreNow(){Lt=void 0},frame(a){const i=v.requestAnimationFrame(a);return{cancel:()=>v.cancelAnimationFrame(i)}},getImageData(a,i=0){const{width:l,height:h}=a;Ht||(Ht=v.document.createElement("canvas"));const f=Ht.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(l>Ht.width||h>Ht.height)&&(Ht.width=l,Ht.height=h),f.clearRect(-i,-i,l+2*i,h+2*i),f.drawImage(a,0,0,l,h),f.getImageData(-i,-i,l+2*i,h+2*i)},resolveURL:a=>(St||(St=v.document.createElement("a")),St.href=a,St.href),get devicePixelRatio(){return v.devicePixelRatio},get prefersReducedMotion(){return!!v.matchMedia&&(Tt==null&&(Tt=v.matchMedia("(prefers-reduced-motion: reduce)")),Tt.matches)}};function Dt(a,i,l){l[a]&&l[a].indexOf(i)!==-1||(l[a]=l[a]||[],l[a].push(i))}function dn(a,i,l){if(l&&l[a]){const h=l[a].indexOf(i);h!==-1&&l[a].splice(h,1)}}class Kt{constructor(i,l={}){Ot(this,l),this.type=i}}class yi extends Kt{constructor(i,l={}){super("error",Ot({error:i},l))}}class Br{on(i,l){return this._listeners=this._listeners||{},Dt(i,l,this._listeners),this}off(i,l){return dn(i,l,this._listeners),dn(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Dt(i,l,this._oneTimeListeners),this):new Promise(h=>this.once(i,h))}fire(i,l){typeof i=="string"&&(i=new Kt(i,l||{}));const h=i.type;if(this.listens(h)){i.target=this;const f=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const b of f)b.call(this,i);const g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const b of g)dn(h,b,this._oneTimeListeners),b.call(this,i);const y=this._eventedParent;y&&(Ot(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(i))}else i instanceof yi&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var je=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function vi(a,...i){for(const l of i)for(const h in l)a[h]=l[h];return a}function wn(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ur(a){if(Array.isArray(a))return a.map(Ur);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const i={};for(const l in a)i[l]=Ur(a[l]);return i}return wn(a)}class Zc extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}var $i=Zc;class Ts{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[h,f]of l)this.bindings[h]=f}concat(i){return new Ts(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var Pi=Ts;const Ss={kind:"null"},lt={kind:"number"},Xt={kind:"string"},Zt={kind:"boolean"},Ii={kind:"color"},as={kind:"object"},Wt={kind:"value"},Wa={kind:"collator"},So={kind:"formatted"},Xs={kind:"resolvedImage"};function Vr(a,i){return{kind:"array",itemType:a,N:i}}function Pn(a){if(a.kind==="array"){const i=Pn(a.itemType);return typeof a.N=="number"?`array<${i}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${i}>`}return a.kind}const vh=[Ss,lt,Xt,Zt,Ii,So,as,Vr(Wt),Xs];function Z(a,i){if(i.kind==="error")return null;if(a.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Z(a.itemType,i.itemType))&&(typeof a.N!="number"||a.N===i.N))return null}else{if(a.kind===i.kind)return null;if(a.kind==="value"){for(const l of vh)if(!Z(l,i))return null}}return`Expected ${Pn(a)} but found ${Pn(i)} instead.`}function ie(a,i){return i.some(l=>l.kind===a.kind)}function be(a,i){return i.some(l=>l==="null"?a===null:l==="array"?Array.isArray(a):l==="object"?a&&!Array.isArray(a)&&typeof a=="object":l===typeof a)}var Ge,ot={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function xt(a){return(a=Math.round(a))<0?0:a>255?255:a}function Yt(a){return xt(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function tr(a){return(i=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:i>1?1:i;var i}function vr(a,i,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(i-a)*l*6:2*l<1?i:3*l<2?a+(i-a)*(2/3-l)*6:a}try{Ge={}.parseCSSColor=function(a){var i,l=a.replace(/ /g,"").toLowerCase();if(l in ot)return ot[l].slice();if(l[0]==="#")return l.length===4?(i=parseInt(l.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:l.length===7&&(i=parseInt(l.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var h=l.indexOf("("),f=l.indexOf(")");if(h!==-1&&f+1===l.length){var g=l.substr(0,h),y=l.substr(h+1,f-(h+1)).split(","),b=1;switch(g){case"rgba":if(y.length!==4)return null;b=tr(y.pop());case"rgb":return y.length!==3?null:[Yt(y[0]),Yt(y[1]),Yt(y[2]),b];case"hsla":if(y.length!==4)return null;b=tr(y.pop());case"hsl":if(y.length!==3)return null;var E=(parseFloat(y[0])%360+360)%360/360,S=tr(y[1]),M=tr(y[2]),R=M<=.5?M*(S+1):M+S-M*S,k=2*M-R;return[xt(255*vr(k,R,E+1/3)),xt(255*vr(k,R,E)),xt(255*vr(k,R,E-1/3)),b];default:return null}}return null}}catch{}class Fn{constructor(i,l,h,f=1){this.r=i,this.g=l,this.b=h,this.a=f}static parse(i){if(!i)return;if(i instanceof Fn)return i;if(typeof i!="string")return;const l=Ge(i);return l?new Fn(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[i,l,h,f]=this.toArray();return`rgba(${Math.round(i)},${Math.round(l)},${Math.round(h)},${f})`}toArray(){const{r:i,g:l,b:h,a:f}=this;return f===0?[0,0,0,0]:[255*i/f,255*l/f,255*h/f,f]}toArray01(){const{r:i,g:l,b:h,a:f}=this;return f===0?[0,0,0,0]:[i/f,l/f,h/f,f]}toArray01PremultipliedAlpha(){const{r:i,g:l,b:h,a:f}=this;return[i,l,h,f]}}Fn.black=new Fn(0,0,0,1),Fn.white=new Fn(1,1,1,1),Fn.transparent=new Fn(0,0,0,0),Fn.red=new Fn(1,0,0,1),Fn.blue=new Fn(0,0,1,1);var vn=Fn;class xh{constructor(i,l,h){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qc{constructor(i,l,h,f,g){this.text=i.normalize?i.normalize():i,this.image=l,this.scale=h,this.fontStack=f,this.textColor=g}}class Ri{constructor(i){this.sections=i}static fromString(i){return new Ri([new qc(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Ri?i:Ri.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const l of this.sections){if(l.image){i.push(["image",l.image.name]);continue}i.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),i.push(h)}return i}}class xi{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new xi({name:i,available:!1}):null}serialize(){return["image",this.name]}}function d_(a,i,l,h){return typeof a=="number"&&a>=0&&a<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[a,i,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[a,i,l,h]:[a,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bh(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof vn||a instanceof xh||a instanceof Ri||a instanceof xi)return!0;if(Array.isArray(a)){for(const i of a)if(!bh(i))return!1;return!0}if(typeof a=="object"){for(const i in a)if(!bh(a[i]))return!1;return!0}return!1}function Mr(a){if(a===null)return Ss;if(typeof a=="string")return Xt;if(typeof a=="boolean")return Zt;if(typeof a=="number")return lt;if(a instanceof vn)return Ii;if(a instanceof xh)return Wa;if(a instanceof Ri)return So;if(a instanceof xi)return Xs;if(Array.isArray(a)){const i=a.length;let l;for(const h of a){const f=Mr(h);if(l){if(l===f)continue;l=Wt;break}l=f}return Vr(l||Wt,i)}return as}function Xc(a){const i=typeof a;return a===null?"":i==="string"||i==="number"||i==="boolean"?String(a):a instanceof vn||a instanceof Ri||a instanceof xi?a.toString():JSON.stringify(a)}class Hf{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!bh(i[1]))return l.error("invalid value");const h=i[1];let f=Mr(h);const g=l.expectedType;return f.kind!=="array"||f.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(f=g),new Hf(f,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vn?["rgba"].concat(this.value.toArray()):this.value instanceof Ri?this.value.serialize():this.value}}var Yc=Hf,Yr=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const wh={string:Xt,number:lt,boolean:Zt,object:as};class Pl{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h,f=1;const g=i[0];if(g==="array"){let b,E;if(i.length>2){const S=i[1];if(typeof S!="string"||!(S in wh)||S==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);b=wh[S],f++}else b=Wt;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);E=i[2],f++}h=Vr(b,E)}else h=wh[g];const y=[];for(;f<i.length;f++){const b=l.parse(i[f],f,Wt);if(!b)return null;y.push(b)}return new Pl(h,y)}evaluate(i){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(i);if(!Z(this.type,Mr(h)))return h;if(l===this.args.length-1)throw new Yr(`Expected value to be of type ${Pn(this.type)}, but found ${Pn(Mr(h))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,l=[i.kind];if(i.kind==="array"){const h=i.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){l.push(h.kind);const f=i.N;(typeof f=="number"||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(h=>h.serialize()))}}var Ao=Pl;class Kc{constructor(i){this.type=So,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const f=[];let g=!1;for(let y=1;y<=i.length-1;++y){const b=i[y];if(g&&typeof b=="object"&&!Array.isArray(b)){g=!1;let E=null;if(b["font-scale"]&&(E=l.parse(b["font-scale"],1,lt),!E))return null;let S=null;if(b["text-font"]&&(S=l.parse(b["text-font"],1,Vr(Xt)),!S))return null;let M=null;if(b["text-color"]&&(M=l.parse(b["text-color"],1,Ii),!M))return null;const R=f[f.length-1];R.scale=E,R.font=S,R.textColor=M}else{const E=l.parse(i[y],1,Wt);if(!E)return null;const S=E.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:E,scale:null,font:null,textColor:null})}}return new Kc(f)}evaluate(i){return new Ri(this.sections.map(l=>{const h=l.content.evaluate(i);return Mr(h)===Xs?new qc("",h,null,null,null):new qc(Xc(h),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const l of this.sections){i.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),i.push(h)}return i}}class Eh{constructor(i){this.type=Xs,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");const h=l.parse(i[1],1,Xt);return h?new Eh(h):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),h=xi.fromString(l);return h&&i.availableImages&&(h.available=i.availableImages.indexOf(l)>-1),h}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Wx={"to-boolean":Zt,"to-color":Ii,"to-number":lt,"to-string":Xt};class Zf{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[0];if((h==="to-boolean"||h==="to-string")&&i.length!==2)return l.error("Expected one argument.");const f=Wx[h],g=[];for(let y=1;y<i.length;y++){const b=l.parse(i[y],y,Wt);if(!b)return null;g.push(b)}return new Zf(f,g)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let l,h;for(const f of this.args){if(l=f.evaluate(i),h=null,l instanceof vn)return l;if(typeof l=="string"){const g=i.parseColor(l);if(g)return g}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:d_(l[0],l[1],l[2],l[3]),!h))return new vn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Yr(h||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const h of this.args){if(l=h.evaluate(i),l===null)return 0;const f=Number(l);if(!isNaN(f))return f}throw new Yr(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?Ri.fromString(Xc(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?xi.fromString(Xc(this.args[0].evaluate(i))):Xc(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Kc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Eh(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(l=>{i.push(l.serialize())}),i}}var Il=Zf;const f_=["Unknown","Point","LineString","Polygon"];var Jc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?f_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*i-a[0])+this.featureDistanceData.bearing[1]*(h*i-a[1])}return 0}parseColor(a){let i=this._parseColorCache[a];return i||(i=this._parseColorCache[a]=vn.parse(a)),i}};class Rl{constructor(i,l,h,f){this.name=i,this.type=l,this._evaluate=h,this.args=f}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,l){const h=i[0],f=Rl.definitions[h];if(!f)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,b=y.filter(([S])=>!Array.isArray(S)||S.length===i.length-1);let E=null;for(const[S,M]of b){E=new Qf(l.registry,l.path,null,l.scope);const R=[];let k=!1;for(let z=1;z<i.length;z++){const N=i[z],V=Array.isArray(S)?S[z-1]:S.type,Y=E.parse(N,1+R.length,V);if(!Y){k=!0;break}R.push(Y)}if(!k)if(Array.isArray(S)&&S.length!==R.length)E.error(`Expected ${S.length} arguments, but found ${R.length} instead.`);else{for(let z=0;z<R.length;z++){const N=Array.isArray(S)?S[z]:S.type,V=R[z];E.concat(z+1).checkSubtype(N,V.type)}if(E.errors.length===0)return new Rl(h,g,M,R)}}if(b.length===1)l.errors.push(...E.errors);else{const S=(b.length?b:y).map(([R])=>{return k=R,Array.isArray(k)?`(${k.map(Pn).join(", ")})`:`(${Pn(k.type)}...)`;var k}).join(" | "),M=[];for(let R=1;R<i.length;R++){const k=l.parse(i[R],1+M.length);if(!k)return null;M.push(Pn(k.type))}l.error(`Expected arguments of type ${S}, but found (${M.join(", ")}) instead.`)}return null}static register(i,l){Rl.definitions=l;for(const h in l)i[h]=Rl}}var la=Rl;class Th{constructor(i,l,h){this.type=Wa,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const h=i[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const f=l.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Zt);if(!f)return null;const g=l.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Zt);if(!g)return null;let y=null;return h.locale&&(y=l.parse(h.locale,1,Xt),!y)?null:new Th(f,g,y)}evaluate(i){return new xh(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const ca=8192;function ls(a,i){a[0]=Math.min(a[0],i[0]),a[1]=Math.min(a[1],i[1]),a[2]=Math.max(a[2],i[0]),a[3]=Math.max(a[3],i[1])}function Qc(a,i){return!(a[0]<=i[0]||a[2]>=i[2]||a[1]<=i[1]||a[3]>=i[3])}function p_(a,i){const l=(180+a[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,i.z);return[Math.round(l*f*ca),Math.round(h*f*ca)]}function m_(a,i,l){const h=a[0]-i[0],f=a[1]-i[1],g=a[0]-l[0],y=a[1]-l[1];return h*y-g*f==0&&h*g<=0&&f*y<=0}function Sh(a,i){let l=!1;for(let y=0,b=i.length;y<b;y++){const E=i[y];for(let S=0,M=E.length;S<M-1;S++){if(m_(a,E[S],E[S+1]))return!1;(f=E[S])[1]>(h=a)[1]!=(g=E[S+1])[1]>h[1]&&h[0]<(g[0]-f[0])*(h[1]-f[1])/(g[1]-f[1])+f[0]&&(l=!l)}}var h,f,g;return l}function g_(a,i){for(let l=0;l<i.length;l++)if(Sh(a,i[l]))return!0;return!1}function qf(a,i,l,h){const f=h[0]-l[0],g=h[1]-l[1],y=(a[0]-l[0])*g-f*(a[1]-l[1]),b=(i[0]-l[0])*g-f*(i[1]-l[1]);return y>0&&b<0||y<0&&b>0}function Xf(a,i,l){for(const S of l)for(let M=0;M<S.length-1;++M)if((b=[(y=S[M+1])[0]-(g=S[M])[0],y[1]-g[1]])[0]*(E=[(f=i)[0]-(h=a)[0],f[1]-h[1]])[1]-b[1]*E[0]!=0&&qf(h,f,g,y)&&qf(g,y,h,f))return!0;var h,f,g,y,b,E;return!1}function kl(a,i){for(let l=0;l<a.length;++l)if(!Sh(a[l],i))return!1;for(let l=0;l<a.length-1;++l)if(Xf(a[l],a[l+1],i))return!1;return!0}function __(a,i){for(let l=0;l<i.length;l++)if(kl(a,i[l]))return!0;return!1}function Ah(a,i,l){const h=[];for(let f=0;f<a.length;f++){const g=[];for(let y=0;y<a[f].length;y++){const b=p_(a[f][y],l);ls(i,b),g.push(b)}h.push(g)}return h}function Ch(a,i,l){const h=[];for(let f=0;f<a.length;f++){const g=Ah(a[f],i,l);h.push(g)}return h}function Yf(a,i,l,h){if(a[0]<l[0]||a[0]>l[2]){const f=.5*h;let g=a[0]-l[0]>f?-h:l[0]-a[0]>f?h:0;g===0&&(g=a[0]-l[2]>f?-h:l[2]-a[0]>f?h:0),a[0]+=g}ls(i,a)}function $a(a,i,l,h){const f=Math.pow(2,h.z)*ca,g=[h.x*ca,h.y*ca],y=[];if(!a)return y;for(const b of a)for(const E of b){const S=[E.x+g[0],E.y+g[1]];Yf(S,i,l,f),y.push(S)}return y}function mn(a,i,l,h){const f=Math.pow(2,h.z)*ca,g=[h.x*ca,h.y*ca],y=[];if(!a)return y;for(const E of a){const S=[];for(const M of E){const R=[M.x+g[0],M.y+g[1]];ls(i,R),S.push(R)}y.push(S)}if(i[2]-i[0]<=f/2){(b=i)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const E of y)for(const S of E)Yf(S,i,l,f)}var b;return y}class eu{constructor(i,l){this.type=Zt,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(bh(i[1])){const h=i[1];if(h.type==="FeatureCollection")for(let f=0;f<h.features.length;++f){const g=h.features[f].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new eu(h,h.features[f].geometry)}else if(h.type==="Feature"){const f=h.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new eu(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new eu(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,h){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if(h.type==="Polygon"){const b=Ah(h.coordinates,g,y),E=$a(l.geometry(),f,g,y);if(!Qc(f,g))return!1;for(const S of E)if(!Sh(S,b))return!1}if(h.type==="MultiPolygon"){const b=Ch(h.coordinates,g,y),E=$a(l.geometry(),f,g,y);if(!Qc(f,g))return!1;for(const S of E)if(!g_(S,b))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,h){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if(h.type==="Polygon"){const b=Ah(h.coordinates,g,y),E=mn(l.geometry(),f,g,y);if(!Qc(f,g))return!1;for(const S of E)if(!kl(S,b))return!1}if(h.type==="MultiPolygon"){const b=Ch(h.coordinates,g,y),E=mn(l.geometry(),f,g,y);if(!Qc(f,g))return!1;for(const S of E)if(!__(S,b))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Kf=eu;function tu(a){if(a instanceof la&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Kf)return!1;let i=!0;return a.eachChild(l=>{i&&!tu(l)&&(i=!1)}),i}function nu(a){if(a instanceof la&&a.name==="feature-state")return!1;let i=!0;return a.eachChild(l=>{i&&!nu(l)&&(i=!1)}),i}function Mh(a,i){if(a instanceof la&&i.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(h=>{l&&!Mh(h,i)&&(l=!1)}),l}class Ph{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=i[1];return l.scope.has(h)?new Ph(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Jf=Ph;class Ih{constructor(i,l=[],h,f=new Pi,g=[]){this.registry=i,this.path=l,this.key=l.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=g,this.expectedType=h}parse(i,l,h,f,g={}){return l?this.concat(l,h,f)._parse(i,g):this._parse(i,g)}_parse(i,l){function h(f,g,y){return y==="assert"?new Ao(g,[f]):y==="coerce"?new Il(g,[f]):f}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=i[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[f];if(g){let y=g.parse(i,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,E=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||E.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string"){if(this.checkSubtype(b,E))return null}else y=h(y,b,l.typeAnnotation||"coerce");else y=h(y,b,l.typeAnnotation||"assert")}if(!(y instanceof Yc)&&y.type.kind!=="resolvedImage"&&ua(y)){const b=new Jc;try{y=new Yc(y.type,y.evaluate(b))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,h){const f=typeof i=="number"?this.path.concat(i):this.path,g=h?this.scope.concat(h):this.scope;return new Ih(this.registry,f,l||null,g,this.errors)}error(i,...l){const h=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new $i(h,i))}checkSubtype(i,l){const h=Z(i,l);return h&&this.error(h),h}}var Qf=Ih;function ua(a){if(a instanceof Jf)return ua(a.boundExpression);if(a instanceof la&&a.name==="error"||a instanceof Th||a instanceof Kf)return!1;const i=a instanceof Il||a instanceof Ao;let l=!0;return a.eachChild(h=>{l=i?l&&ua(h):l&&h instanceof Yc}),!!l&&tu(a)&&Mh(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ha(a,i){const l=a.length-1;let h,f,g=0,y=l,b=0;for(;g<=y;)if(b=Math.floor((g+y)/2),h=a[b],f=a[b+1],h<=i){if(b===l||i<f)return b;g=b+1}else{if(!(h>i))throw new Yr("Input is not a number.");y=b-1}return 0}class Rh{constructor(i,l,h){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[f,g]of h)this.labels.push(f),this.outputs.push(g)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(i[1],1,lt);if(!h)return null;const f=[];let g=null;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);for(let y=1;y<i.length;y+=2){const b=y===1?-1/0:i[y],E=i[y+1],S=y,M=y+1;if(typeof b!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(f.length&&f[f.length-1][0]>=b)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const R=l.parse(E,M,g);if(!R)return null;g=g||R.type,f.push([b,R])}return new Rh(g,h,f)}evaluate(i){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return h[0].evaluate(i);const g=l.length;return f>=l[g-1]?h[g-1].evaluate(i):h[Ha(l,f)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&i.push(this.labels[l]),i.push(this.outputs[l].serialize());return i}}var ep=Rh;function ln(a,i,l){return a*(1-l)+i*l}var ru=Object.freeze({__proto__:null,number:ln,color:function(a,i,l){return new vn(ln(a.r,i.r,l),ln(a.g,i.g,l),ln(a.b,i.b,l),ln(a.a,i.a,l))},array:function(a,i,l){return a.map((h,f)=>ln(h,i[f],l))}});const y_=.95047,v_=1.08883,tp=4/29,np=6/29,rp=3*np*np,x_=Math.PI/180,$x=180/Math.PI;function kh(a){return a>.008856451679035631?Math.pow(a,1/3):a/rp+tp}function ip(a){return a>np?a*a*a:rp*(a-tp)}function Lh(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Oh(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function b_(a){const i=Oh(a.r),l=Oh(a.g),h=Oh(a.b),f=kh((.4124564*i+.3575761*l+.1804375*h)/y_),g=kh((.2126729*i+.7151522*l+.072175*h)/1);return{l:116*g-16,a:500*(f-g),b:200*(g-kh((.0193339*i+.119192*l+.9503041*h)/v_)),alpha:a.a}}function w_(a){let i=(a.l+16)/116,l=isNaN(a.a)?i:i+a.a/500,h=isNaN(a.b)?i:i-a.b/200;return i=1*ip(i),l=y_*ip(l),h=v_*ip(h),new vn(Lh(3.2404542*l-1.5371385*i-.4985314*h),Lh(-.969266*l+1.8760108*i+.041556*h),Lh(.0556434*l-.2040259*i+1.0572252*h),a.alpha)}function Hx(a,i,l){const h=i-a;return a+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const iu={forward:b_,reverse:w_,interpolate:function(a,i,l){return{l:ln(a.l,i.l,l),a:ln(a.a,i.a,l),b:ln(a.b,i.b,l),alpha:ln(a.alpha,i.alpha,l)}}},su={forward:function(a){const{l:i,a:l,b:h}=b_(a),f=Math.atan2(h,l)*$x;return{h:f<0?f+360:f,c:Math.sqrt(l*l+h*h),l:i,alpha:a.a}},reverse:function(a){const i=a.h*x_,l=a.c;return w_({l:a.l,a:Math.cos(i)*l,b:Math.sin(i)*l,alpha:a.alpha})},interpolate:function(a,i,l){return{h:Hx(a.h,i.h,l),c:ln(a.c,i.c,l),l:ln(a.l,i.l,l),alpha:ln(a.alpha,i.alpha,l)}}};var E_=Object.freeze({__proto__:null,lab:iu,hcl:su});class ou{constructor(i,l,h,f,g){this.type=i,this.operator=l,this.interpolation=h,this.input=f,this.labels=[],this.outputs=[];for(const[y,b]of g)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(i,l,h,f){let g=0;if(i.name==="exponential")g=sp(l,i.base,h,f);else if(i.name==="linear")g=sp(l,1,h,f);else if(i.name==="cubic-bezier"){const y=i.controlPoints;g=new J(y[0],y[1],y[2],y[3]).solve(sp(l,1,h,f))}return g}static parse(i,l){let[h,f,g,...y]=i;if(!Array.isArray(f)||f.length===0)return l.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const S=f[1];if(typeof S!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:S}}else{if(f[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const S=f.slice(1);if(S.length!==4||S.some(M=>typeof M!="number"||M<0||M>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:S}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(g=l.parse(g,2,lt),!g)return null;const b=[];let E=null;h==="interpolate-hcl"||h==="interpolate-lab"?E=Ii:l.expectedType&&l.expectedType.kind!=="value"&&(E=l.expectedType);for(let S=0;S<y.length;S+=2){const M=y[S],R=y[S+1],k=S+3,z=S+4;if(typeof M!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(b.length&&b[b.length-1][0]>=M)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const N=l.parse(R,z,E);if(!N)return null;E=E||N.type,b.push([M,N])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new ou(E,h,f,g,b):l.error(`Type ${Pn(E)} is not interpolatable.`)}evaluate(i){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return h[0].evaluate(i);const g=l.length;if(f>=l[g-1])return h[g-1].evaluate(i);const y=Ha(l,f),b=ou.interpolationFactor(this.interpolation,f,l[y],l[y+1]),E=h[y].evaluate(i),S=h[y+1].evaluate(i);return this.operator==="interpolate"?ru[this.type.kind.toLowerCase()](E,S,b):this.operator==="interpolate-hcl"?su.reverse(su.interpolate(su.forward(E),su.forward(S),b)):iu.reverse(iu.interpolate(iu.forward(E),iu.forward(S),b))}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,i,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function sp(a,i,l,h){const f=h-l,g=a-l;return f===0?0:i===1?g/f:(Math.pow(i,g)-1)/(Math.pow(i,f)-1)}var Ys=ou;class op{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let h=null;const f=l.expectedType;f&&f.kind!=="value"&&(h=f);const g=[];for(const b of i.slice(1)){const E=l.parse(b,1+g.length,h,void 0,{typeAnnotation:"omit"});if(!E)return null;h=h||E.type,g.push(E)}const y=f&&g.some(b=>Z(f,b.type));return new op(y?Wt:h,g)}evaluate(i){let l,h=null,f=0;for(const g of this.args){if(f++,h=g.evaluate(i),h&&h instanceof xi&&!h.available&&(l||(l=h),h=null,f===this.args.length))return l;if(h!==null)break}return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(l=>{i.push(l.serialize())}),i}}var T_=op;class Dh{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let g=1;g<i.length-1;g+=2){const y=i[g];if(typeof y!="string")return l.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",g);const b=l.parse(i[g+1],g+1);if(!b)return null;h.push([y,b])}const f=l.parse(i[i.length-1],i.length-1,l.expectedType,h);return f?new Dh(h,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[l,h]of this.bindings)i.push(l,h.serialize());return i.push(this.result.serialize()),i}}var ap=Dh;class zh{constructor(i,l,h){this.type=i,this.index=l,this.input=h}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,lt),f=l.parse(i[2],2,Vr(l.expectedType||Wt));return h&&f?new zh(f.type.itemType,h,f):null}evaluate(i){const l=this.index.evaluate(i),h=this.input.evaluate(i);if(l<0)throw new Yr(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Yr(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Yr(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Zx=zh;class lp{constructor(i,l){this.type=Zt,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Wt),f=l.parse(i[2],2,Wt);return h&&f?ie(h.type,[Zt,Xt,lt,Ss,Wt])?new lp(h,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(h.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(h==null)return!1;if(!be(l,["boolean","string","number","null"]))throw new Yr(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(Mr(l))} instead.`);if(!be(h,["string","array"]))throw new Yr(`Expected second argument to be of type array or string, but found ${Pn(Mr(h))} instead.`);return h.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var S_=lp;class au{constructor(i,l,h){this.type=lt,this.needle=i,this.haystack=l,this.fromIndex=h}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Wt),f=l.parse(i[2],2,Wt);if(!h||!f)return null;if(!ie(h.type,[Zt,Xt,lt,Ss,Wt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(h.type)} instead`);if(i.length===4){const g=l.parse(i[3],3,lt);return g?new au(h,f,g):null}return new au(h,f)}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!be(l,["boolean","string","number","null"]))throw new Yr(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(Mr(l))} instead.`);if(!be(h,["string","array"]))throw new Yr(`Expected second argument to be of type array or string, but found ${Pn(Mr(h))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(i);return h.indexOf(l,f)}return h.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var A_=au;class cp{constructor(i,l,h,f,g,y){this.inputType=i,this.type=l,this.input=h,this.cases=f,this.outputs=g,this.otherwise=y}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let h,f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);const g={},y=[];for(let S=2;S<i.length-1;S+=2){let M=i[S];const R=i[S+1];Array.isArray(M)||(M=[M]);const k=l.concat(S);if(M.length===0)return k.error("Expected at least one branch label.");for(const N of M){if(typeof N!="number"&&typeof N!="string")return k.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return k.error("Numeric branch labels must be integer values.");if(h){if(k.checkSubtype(h,Mr(N)))return null}else h=Mr(N);if(g[String(N)]!==void 0)return k.error("Branch labels must be unique.");g[String(N)]=y.length}const z=l.parse(R,S,f);if(!z)return null;f=f||z.type,y.push(z)}const b=l.parse(i[1],1,Wt);if(!b)return null;const E=l.parse(i[i.length-1],i.length-1,f);return E?b.type.kind!=="value"&&l.concat(1).checkSubtype(h,b.type)?null:new cp(h,f,b,g,y,E):null}evaluate(i){const l=this.input.evaluate(i);return(Mr(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],f={};for(const y of l){const b=f[this.cases[y]];b===void 0?(f[this.cases[y]]=h.length,h.push([this.cases[y],[y]])):h[b][1].push(y)}const g=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,b]of h)i.push(b.length===1?g(b[0]):b.map(g)),i.push(this.outputs[y].serialize());return i.push(this.otherwise.serialize()),i}}var qx=cp;class up{constructor(i,l,h){this.type=i,this.branches=l,this.otherwise=h}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const f=[];for(let y=1;y<i.length-1;y+=2){const b=l.parse(i[y],y,Zt);if(!b)return null;const E=l.parse(i[y+1],y+1,h);if(!E)return null;f.push([b,E]),h=h||E.type}const g=l.parse(i[i.length-1],i.length-1,h);return g?new up(h,f,g):null}evaluate(i){for(const[l,h]of this.branches)if(l.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,h]of this.branches)i(l),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(l=>{i.push(l.serialize())}),i}}var Xx=up;class Za{constructor(i,l,h,f){this.type=i,this.input=l,this.beginIndex=h,this.endIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Wt),f=l.parse(i[2],2,lt);if(!h||!f)return null;if(!ie(h.type,[Vr(Wt),Xt,Wt]))return l.error(`Expected first argument to be of type array or string, but found ${Pn(h.type)} instead`);if(i.length===4){const g=l.parse(i[3],3,lt);return g?new Za(h.type,h,f,g):null}return new Za(h.type,h,f)}evaluate(i){const l=this.input.evaluate(i),h=this.beginIndex.evaluate(i);if(!be(l,["string","array"]))throw new Yr(`Expected first argument to be of type array or string, but found ${Pn(Mr(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(i);return l.slice(h,f)}return l.slice(h)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var C_=Za;function hp(a,i){return a==="=="||a==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function M_(a,i,l,h){return h.compare(i,l)===0}function Ll(a,i,l){const h=a!=="=="&&a!=="!=";return class bF{constructor(g,y,b){this.type=Zt,this.lhs=g,this.rhs=y,this.collator=b,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const b=g[0];let E=y.parse(g[1],1,Wt);if(!E)return null;if(!hp(b,E.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${Pn(E.type)}'.`);let S=y.parse(g[2],2,Wt);if(!S)return null;if(!hp(b,S.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${Pn(S.type)}'.`);if(E.type.kind!==S.type.kind&&E.type.kind!=="value"&&S.type.kind!=="value")return y.error(`Cannot compare types '${Pn(E.type)}' and '${Pn(S.type)}'.`);h&&(E.type.kind==="value"&&S.type.kind!=="value"?E=new Ao(S.type,[E]):E.type.kind!=="value"&&S.type.kind==="value"&&(S=new Ao(E.type,[S])));let M=null;if(g.length===4){if(E.type.kind!=="string"&&S.type.kind!=="string"&&E.type.kind!=="value"&&S.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(M=y.parse(g[3],3,Wa),!M)return null}return new bF(E,S,M)}evaluate(g){const y=this.lhs.evaluate(g),b=this.rhs.evaluate(g);if(h&&this.hasUntypedArgument){const E=Mr(y),S=Mr(b);if(E.kind!==S.kind||E.kind!=="string"&&E.kind!=="number")throw new Yr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${E.kind}, ${S.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const E=Mr(y),S=Mr(b);if(E.kind!=="string"||S.kind!=="string")return i(g,y,b)}return this.collator?l(g,y,b,this.collator.evaluate(g)):i(g,y,b)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const Yx=Ll("==",function(a,i,l){return i===l},M_),P_=Ll("!=",function(a,i,l){return i!==l},function(a,i,l,h){return!M_(0,i,l,h)}),I_=Ll("<",function(a,i,l){return i<l},function(a,i,l,h){return h.compare(i,l)<0}),R_=Ll(">",function(a,i,l){return i>l},function(a,i,l,h){return h.compare(i,l)>0}),dp=Ll("<=",function(a,i,l){return i<=l},function(a,i,l,h){return h.compare(i,l)<=0}),Kx=Ll(">=",function(a,i,l){return i>=l},function(a,i,l,h){return h.compare(i,l)>=0});class fp{constructor(i,l,h,f,g,y){this.type=Xt,this.number=i,this.locale=l,this.currency=h,this.unit=f,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const h=l.parse(i[1],1,lt);if(!h)return null;const f=i[2];if(typeof f!="object"||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=l.parse(f.locale,1,Xt),!g))return null;let y=null;if(f.currency&&(y=l.parse(f.currency,1,Xt),!y))return null;let b=null;if(f.unit&&(b=l.parse(f.unit,1,Xt),!b))return null;let E=null;if(f["min-fraction-digits"]&&(E=l.parse(f["min-fraction-digits"],1,lt),!E))return null;let S=null;return f["max-fraction-digits"]&&(S=l.parse(f["max-fraction-digits"],1,lt),!S)?null:new fp(h,g,y,b,E,S)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class pp{constructor(i){this.type=lt,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=l.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Pn(h.type)} instead.`):new pp(h):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Yr(`Expected value to be of type string or array, but found ${Pn(Mr(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(l=>{i.push(l.serialize())}),i}}const k_={"==":Yx,"!=":P_,">":R_,"<":I_,">=":Kx,"<=":dp,array:Ao,at:Zx,boolean:Ao,case:Xx,coalesce:T_,collator:Th,format:Kc,image:Eh,in:S_,"index-of":A_,interpolate:Ys,"interpolate-hcl":Ys,"interpolate-lab":Ys,length:pp,let:ap,literal:Yc,match:qx,number:Ao,"number-format":fp,object:Ao,slice:C_,step:ep,string:Ao,"to-boolean":Il,"to-color":Il,"to-number":Il,"to-string":Il,var:Jf,within:Kf};function L_(a,[i,l,h,f]){i=i.evaluate(a),l=l.evaluate(a),h=h.evaluate(a);const g=f?f.evaluate(a):1,y=d_(i,l,h,g);if(y)throw new Yr(y);return new vn(i/255*g,l/255*g,h/255*g,g)}function O_(a,i){return a in i}function mp(a,i){const l=i[a];return l===void 0?null:l}function ha(a){return{type:a}}la.register(k_,{error:[{kind:"error"},[Xt],(a,[i])=>{throw new Yr(i.evaluate(a))}],typeof:[Xt,[Wt],(a,[i])=>Pn(Mr(i.evaluate(a)))],"to-rgba":[Vr(lt,4),[Ii],(a,[i])=>i.evaluate(a).toArray()],rgb:[Ii,[lt,lt,lt],L_],rgba:[Ii,[lt,lt,lt,lt],L_],has:{type:Zt,overloads:[[[Xt],(a,[i])=>O_(i.evaluate(a),a.properties())],[[Xt,as],(a,[i,l])=>O_(i.evaluate(a),l.evaluate(a))]]},get:{type:Wt,overloads:[[[Xt],(a,[i])=>mp(i.evaluate(a),a.properties())],[[Xt,as],(a,[i,l])=>mp(i.evaluate(a),l.evaluate(a))]]},"feature-state":[Wt,[Xt],(a,[i])=>mp(i.evaluate(a),a.featureState||{})],properties:[as,[],a=>a.properties()],"geometry-type":[Xt,[],a=>a.geometryType()],id:[Wt,[],a=>a.id()],zoom:[lt,[],a=>a.globals.zoom],pitch:[lt,[],a=>a.globals.pitch||0],"distance-from-center":[lt,[],a=>a.distanceFromCenter()],"heatmap-density":[lt,[],a=>a.globals.heatmapDensity||0],"line-progress":[lt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[lt,[],a=>a.globals.skyRadialProgress||0],accumulated:[Wt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[lt,ha(lt),(a,i)=>{let l=0;for(const h of i)l+=h.evaluate(a);return l}],"*":[lt,ha(lt),(a,i)=>{let l=1;for(const h of i)l*=h.evaluate(a);return l}],"-":{type:lt,overloads:[[[lt,lt],(a,[i,l])=>i.evaluate(a)-l.evaluate(a)],[[lt],(a,[i])=>-i.evaluate(a)]]},"/":[lt,[lt,lt],(a,[i,l])=>i.evaluate(a)/l.evaluate(a)],"%":[lt,[lt,lt],(a,[i,l])=>i.evaluate(a)%l.evaluate(a)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(a,[i,l])=>Math.pow(i.evaluate(a),l.evaluate(a))],sqrt:[lt,[lt],(a,[i])=>Math.sqrt(i.evaluate(a))],log10:[lt,[lt],(a,[i])=>Math.log(i.evaluate(a))/Math.LN10],ln:[lt,[lt],(a,[i])=>Math.log(i.evaluate(a))],log2:[lt,[lt],(a,[i])=>Math.log(i.evaluate(a))/Math.LN2],sin:[lt,[lt],(a,[i])=>Math.sin(i.evaluate(a))],cos:[lt,[lt],(a,[i])=>Math.cos(i.evaluate(a))],tan:[lt,[lt],(a,[i])=>Math.tan(i.evaluate(a))],asin:[lt,[lt],(a,[i])=>Math.asin(i.evaluate(a))],acos:[lt,[lt],(a,[i])=>Math.acos(i.evaluate(a))],atan:[lt,[lt],(a,[i])=>Math.atan(i.evaluate(a))],min:[lt,ha(lt),(a,i)=>Math.min(...i.map(l=>l.evaluate(a)))],max:[lt,ha(lt),(a,i)=>Math.max(...i.map(l=>l.evaluate(a)))],abs:[lt,[lt],(a,[i])=>Math.abs(i.evaluate(a))],round:[lt,[lt],(a,[i])=>{const l=i.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[lt,[lt],(a,[i])=>Math.floor(i.evaluate(a))],ceil:[lt,[lt],(a,[i])=>Math.ceil(i.evaluate(a))],"filter-==":[Zt,[Xt,Wt],(a,[i,l])=>a.properties()[i.value]===l.value],"filter-id-==":[Zt,[Wt],(a,[i])=>a.id()===i.value],"filter-type-==":[Zt,[Xt],(a,[i])=>a.geometryType()===i.value],"filter-<":[Zt,[Xt,Wt],(a,[i,l])=>{const h=a.properties()[i.value],f=l.value;return typeof h==typeof f&&h<f}],"filter-id-<":[Zt,[Wt],(a,[i])=>{const l=a.id(),h=i.value;return typeof l==typeof h&&l<h}],"filter->":[Zt,[Xt,Wt],(a,[i,l])=>{const h=a.properties()[i.value],f=l.value;return typeof h==typeof f&&h>f}],"filter-id->":[Zt,[Wt],(a,[i])=>{const l=a.id(),h=i.value;return typeof l==typeof h&&l>h}],"filter-<=":[Zt,[Xt,Wt],(a,[i,l])=>{const h=a.properties()[i.value],f=l.value;return typeof h==typeof f&&h<=f}],"filter-id-<=":[Zt,[Wt],(a,[i])=>{const l=a.id(),h=i.value;return typeof l==typeof h&&l<=h}],"filter->=":[Zt,[Xt,Wt],(a,[i,l])=>{const h=a.properties()[i.value],f=l.value;return typeof h==typeof f&&h>=f}],"filter-id->=":[Zt,[Wt],(a,[i])=>{const l=a.id(),h=i.value;return typeof l==typeof h&&l>=h}],"filter-has":[Zt,[Wt],(a,[i])=>i.value in a.properties()],"filter-has-id":[Zt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Zt,[Vr(Xt)],(a,[i])=>i.value.indexOf(a.geometryType())>=0],"filter-id-in":[Zt,[Vr(Wt)],(a,[i])=>i.value.indexOf(a.id())>=0],"filter-in-small":[Zt,[Xt,Vr(Wt)],(a,[i,l])=>l.value.indexOf(a.properties()[i.value])>=0],"filter-in-large":[Zt,[Xt,Vr(Wt)],(a,[i,l])=>function(h,f,g,y){for(;g<=y;){const b=g+y>>1;if(f[b]===h)return!0;f[b]>h?y=b-1:g=b+1}return!1}(a.properties()[i.value],l.value,0,l.value.length-1)],all:{type:Zt,overloads:[[[Zt,Zt],(a,[i,l])=>i.evaluate(a)&&l.evaluate(a)],[ha(Zt),(a,i)=>{for(const l of i)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Zt,overloads:[[[Zt,Zt],(a,[i,l])=>i.evaluate(a)||l.evaluate(a)],[ha(Zt),(a,i)=>{for(const l of i)if(l.evaluate(a))return!0;return!1}]]},"!":[Zt,[Zt],(a,[i])=>!i.evaluate(a)],"is-supported-script":[Zt,[Xt],(a,[i])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(i.evaluate(a))}],upcase:[Xt,[Xt],(a,[i])=>i.evaluate(a).toUpperCase()],downcase:[Xt,[Xt],(a,[i])=>i.evaluate(a).toLowerCase()],concat:[Xt,ha(Wt),(a,i)=>i.map(l=>Xc(l.evaluate(a))).join("")],"resolved-locale":[Xt,[Wa],(a,[i])=>i.evaluate(a).resolvedLocale()]});var Ol=k_;function lu(a){return{result:"success",value:a}}function Dl(a){return{result:"error",value:a}}function zl(a){return a["property-type"]==="data-driven"}function Co(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Fh(a){return!!a.expression&&a.expression.interpolated}function an(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Nh(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Jx(a){return a}function gp(a,i){const l=i.type==="color",h=a.stops&&typeof a.stops[0][0]=="object",f=h||!(h||a.property!==void 0),g=a.type||(Fh(i)?"exponential":"interval");if(l&&((a=vi({},a)).stops&&(a.stops=a.stops.map(S=>[S[0],vn.parse(S[1])])),a.default=vn.parse(a.default?a.default:i.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!E_[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let y,b,E;if(g==="exponential")y=Bh;else if(g==="interval")y=D_;else if(g==="categorical"){y=_p,b=Object.create(null);for(const S of a.stops)b[S[0]]=S[1];E=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=z_}if(h){const S={},M=[];for(let z=0;z<a.stops.length;z++){const N=a.stops[z],V=N[0].zoom;S[V]===void 0&&(S[V]={zoom:V,type:a.type,property:a.property,default:a.default,stops:[]},M.push(V)),S[V].stops.push([N[0].value,N[1]])}const R=[];for(const z of M)R.push([S[z].zoom,gp(S[z],i)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Ys.interpolationFactor.bind(void 0,k),zoomStops:R.map(z=>z[0]),evaluate:({zoom:z},N)=>Bh({stops:R,base:a.base},i,z).evaluate(z,N)}}if(f){const S=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Ys.interpolationFactor.bind(void 0,S),zoomStops:a.stops.map(M=>M[0]),evaluate:({zoom:M})=>y(a,i,M,b,E)}}return{kind:"source",evaluate(S,M){const R=M&&M.properties?M.properties[a.property]:void 0;return R===void 0?cu(a.default,i.default):y(a,i,R,b,E)}}}function cu(a,i,l){return a!==void 0?a:i!==void 0?i:l!==void 0?l:void 0}function _p(a,i,l,h,f){return cu(typeof l===f?h[l]:void 0,a.default,i.default)}function D_(a,i,l){if(an(l)!=="number")return cu(a.default,i.default);const h=a.stops.length;if(h===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[h-1][0])return a.stops[h-1][1];const f=Ha(a.stops.map(g=>g[0]),l);return a.stops[f][1]}function Bh(a,i,l){const h=a.base!==void 0?a.base:1;if(an(l)!=="number")return cu(a.default,i.default);const f=a.stops.length;if(f===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const g=Ha(a.stops.map(M=>M[0]),l),y=function(M,R,k,z){const N=z-k,V=M-k;return N===0?0:R===1?V/N:(Math.pow(R,V)-1)/(Math.pow(R,N)-1)}(l,h,a.stops[g][0],a.stops[g+1][0]),b=a.stops[g][1],E=a.stops[g+1][1];let S=ru[i.type]||Jx;if(a.colorSpace&&a.colorSpace!=="rgb"){const M=E_[a.colorSpace];S=(R,k)=>M.reverse(M.interpolate(M.forward(R),M.forward(k),y))}return typeof b.evaluate=="function"?{evaluate(...M){const R=b.evaluate.apply(void 0,M),k=E.evaluate.apply(void 0,M);if(R!==void 0&&k!==void 0)return S(R,k,y)}}:S(b,E,y)}function z_(a,i,l){return i.type==="color"?l=vn.parse(l):i.type==="formatted"?l=Ri.fromString(l.toString()):i.type==="resolvedImage"?l=xi.fromString(l.toString()):an(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0),cu(l,a.default,i.default)}class Uh{constructor(i,l){this.expression=i,this._warningHistory={},this._evaluator=new Jc,this._defaultValue=l?function(h){return h.type==="color"&&(Nh(h.default)||Array.isArray(h.default))?new vn(0,0,0,0):h.type==="color"?vn.parse(h.default)||null:h.default===void 0?null:h.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,h,f,g,y,b,E){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(i,l,h,f,g,y,b,E){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Yr(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function Fl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ol}function Nl(a,i){const l=new Qf(Ol,[],i?function(f){const g={color:Ii,string:Xt,number:lt,enum:Xt,boolean:Zt,formatted:So,resolvedImage:Xs};return f.type==="array"?Vr(g[f.value]||Wt,f.length):g[f.type]}(i):void 0),h=l.parse(a,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?lu(new Uh(h,i)):Dl(l.errors)}class Vh{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!nu(l.expression)}evaluateWithoutErrorHandling(i,l,h,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,f,g,y)}evaluate(i,l,h,f,g,y){return this._styleExpression.evaluate(i,l,h,f,g,y)}}class qa{constructor(i,l,h,f){this.kind=i,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!nu(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(i,l,h,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,f,g,y)}evaluate(i,l,h,f,g,y){return this._styleExpression.evaluate(i,l,h,f,g,y)}interpolationFactor(i,l,h){return this.interpolationType?Ys.interpolationFactor(this.interpolationType,i,l,h):0}}function Xa(a,i){if((a=Nl(a,i)).result==="error")return a;const l=a.value.expression,h=tu(l);if(!h&&!zl(i))return Dl([new $i("","data expressions not supported")]);const f=Mh(l,["zoom","pitch","distance-from-center"]);if(!f&&!Co(i))return Dl([new $i("","zoom expressions not supported")]);const g=hu(l);return g||f?g instanceof $i?Dl([g]):g instanceof Ys&&!Fh(i)?Dl([new $i("",'"interpolate" expressions cannot be used with this property')]):lu(g?new qa(h?"camera":"composite",a.value,g.labels,g instanceof Ys?g.interpolation:void 0):new Vh(h?"constant":"source",a.value)):Dl([new $i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class uu{constructor(i,l){this._parameters=i,this._specification=l,vi(this,gp(this._parameters,this._specification))}static deserialize(i){return new uu(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function hu(a){let i=null;if(a instanceof ap)i=hu(a.result);else if(a instanceof T_){for(const l of a.args)if(i=hu(l),i)break}else(a instanceof ep||a instanceof Ys)&&a.input instanceof la&&a.input.name==="zoom"&&(i=a);return i instanceof $i||a.eachChild(l=>{const h=hu(l);h instanceof $i?i=h:!i&&h?i=new $i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&h&&i!==h&&(i=new $i("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class mt{constructor(i,l,h,f){this.message=(i?`${i}: `:"")+h,f&&(this.identifier=f),l!=null&&l.__line__&&(this.line=l.__line__)}}function cs(a){const i=a.key,l=a.value,h=a.valueSpec||{},f=a.objectElementValidators||{},g=a.style,y=a.styleSpec;let b=[];const E=an(l);if(E!=="object")return[new mt(i,l,`object expected, ${E} found`)];for(const S in l){const M=S.split(".")[0],R=h[M]||h["*"];let k;f[M]?k=f[M]:h[M]?k=li:f["*"]?k=f["*"]:h["*"]&&(k=li),k?b=b.concat(k({key:(i&&`${i}.`)+S,value:l[S],valueSpec:R,style:g,styleSpec:y,object:l,objectKey:S},l)):b.push(new mt(i,l[S],`unknown property "${S}"`))}for(const S in h)f[S]||h[S].required&&h[S].default===void 0&&l[S]===void 0&&b.push(new mt(i,l,`missing required property "${S}"`));return b}function F_(a){const i=a.value,l=a.valueSpec,h=a.style,f=a.styleSpec,g=a.key,y=a.arrayElementValidator||li;if(an(i)!=="array")return[new mt(g,i,`array expected, ${an(i)} found`)];if(l.length&&i.length!==l.length)return[new mt(g,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new mt(g,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let b={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};f.$version<7&&(b.function=l.function),an(l.value)==="object"&&(b=l.value);let E=[];for(let S=0;S<i.length;S++)E=E.concat(y({array:i,arrayIndex:S,value:i[S],valueSpec:b,style:h,styleSpec:f,key:`${g}[${S}]`}));return E}function yp(a){const i=a.key,l=a.value,h=a.valueSpec;let f=an(l);if(f==="number"&&l!=l&&(f="NaN"),f!=="number")return[new mt(i,l,`number expected, ${f} found`)];if("minimum"in h){let g=h.minimum;if(an(h.minimum)==="array"&&(g=h.minimum[a.arrayIndex]),l<g)return[new mt(i,l,`${l} is less than the minimum value ${g}`)]}if("maximum"in h){let g=h.maximum;if(an(h.maximum)==="array"&&(g=h.maximum[a.arrayIndex]),l>g)return[new mt(i,l,`${l} is greater than the maximum value ${g}`)]}return[]}function du(a){const i=a.valueSpec,l=wn(a.value.type);let h,f,g,y={};const b=l!=="categorical"&&a.value.property===void 0,E=!b,S=an(a.value.stops)==="array"&&an(a.value.stops[0])==="array"&&an(a.value.stops[0][0])==="object",M=cs({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(z){if(l==="identity")return[new mt(z.key,z.value,'identity function may not have a "stops" property')];let N=[];const V=z.value;return N=N.concat(F_({key:z.key,value:V,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:R})),an(V)==="array"&&V.length===0&&N.push(new mt(z.key,V,"array must have at least one stop")),N},default:function(z){return li({key:z.key,value:z.value,valueSpec:i,style:z.style,styleSpec:z.styleSpec})}}});return l==="identity"&&b&&M.push(new mt(a.key,a.value,'missing required property "property"')),l==="identity"||a.value.stops||M.push(new mt(a.key,a.value,'missing required property "stops"')),l==="exponential"&&a.valueSpec.expression&&!Fh(a.valueSpec)&&M.push(new mt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(E&&!zl(a.valueSpec)?M.push(new mt(a.key,a.value,"property functions not supported")):b&&!Co(a.valueSpec)&&M.push(new mt(a.key,a.value,"zoom functions not supported"))),l!=="categorical"&&!S||a.value.property!==void 0||M.push(new mt(a.key,a.value,'"property" property is required')),M;function R(z){let N=[];const V=z.value,Y=z.key;if(an(V)!=="array")return[new mt(Y,V,`array expected, ${an(V)} found`)];if(V.length!==2)return[new mt(Y,V,`array length 2 expected, length ${V.length} found`)];if(S){if(an(V[0])!=="object")return[new mt(Y,V,`object expected, ${an(V[0])} found`)];if(V[0].zoom===void 0)return[new mt(Y,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new mt(Y,V,"object stop key must have value")];const ce=wn(V[0].zoom);if(typeof ce!="number")return[new mt(Y,V[0].zoom,"stop zoom values must be numbers")];if(g&&g>ce)return[new mt(Y,V[0].zoom,"stop zoom values must appear in ascending order")];ce!==g&&(g=ce,f=void 0,y={}),N=N.concat(cs({key:`${Y}[0]`,value:V[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:yp,value:k}}))}else N=N.concat(k({key:`${Y}[0]`,value:V[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},V));return Fl(Ur(V[1]))?N.concat([new mt(`${Y}[1]`,V[1],"expressions are not allowed in function stops.")]):N.concat(li({key:`${Y}[1]`,value:V[1],valueSpec:i,style:z.style,styleSpec:z.styleSpec}))}function k(z,N){const V=an(z.value),Y=wn(z.value),ce=z.value!==null?z.value:N;if(h){if(V!==h)return[new mt(z.key,ce,`${V} stop domain type must match previous stop domain type ${h}`)]}else h=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof Y!="number"&&typeof Y!="string"&&typeof Y!="boolean")return[new mt(z.key,ce,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&l!=="categorical"){let ge=`number expected, ${V} found`;return zl(i)&&l===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new mt(z.key,ce,ge)]}return l!=="categorical"||V!=="number"||typeof Y=="number"&&isFinite(Y)&&Math.floor(Y)===Y?l!=="categorical"&&V==="number"&&typeof Y=="number"&&typeof f=="number"&&f!==void 0&&Y<f?[new mt(z.key,ce,"stop domain values must appear in ascending order")]:(f=Y,l==="categorical"&&Y in y?[new mt(z.key,ce,"stop domain values must be unique")]:(y[Y]=!0,[])):[new mt(z.key,ce,`integer expected, found ${String(Y)}`)]}}function Bl(a){const i=(a.expressionContext==="property"?Xa:Nl)(Ur(a.value),a.valueSpec);if(i.result==="error")return i.value.map(h=>new mt(`${a.key}${h.key}`,a.value,h.message));const l=i.value.expression||i.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!l.outputDefined())return[new mt(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!nu(l))return[new mt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter")return N_(l,a);if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Mh(l,["zoom","feature-state"]))return[new mt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!tu(l))return[new mt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function N_(a,i){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const f of i.valueSpec.expression.parameters)l.delete(f);if(l.size===0)return[];const h=[];return a instanceof la&&l.has(a.name)?[new mt(i.key,i.value,`["${a.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(a.eachChild(f=>{h.push(...N_(f,i))}),h)}function jh(a){const i=a.key,l=a.value,h=a.valueSpec,f=[];return Array.isArray(h.values)?h.values.indexOf(wn(l))===-1&&f.push(new mt(i,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(h.values).indexOf(wn(l))===-1&&f.push(new mt(i,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function vp(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const i of a.slice(1))if(!vp(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function Gh(a,i="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};vp(a)||(a=$h(a));const l=a;let h=!0;try{h=function(S){if(!jr(S))return S;let M=Ur(S);return pu(M),M=fu(M),M}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}const f=je[`filter_${i}`],g=Nl(h,f);let y=null;if(g.result==="error")throw new Error(g.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,M,R)=>g.value.evaluate(S,M,{},R);let b=null,E=null;if(h!==l){const S=Nl(l,f);if(S.result==="error")throw new Error(S.value.map(M=>`${M.key}: ${M.message}`).join(", "));b=(M,R,k,z,N)=>S.value.evaluate(M,R,{},k,void 0,void 0,z,N),E=!tu(S.value.expression)}return{filter:y,dynamicFilter:b||void 0,needGeometry:B_(h),needFeature:!!E}}function fu(a){if(!Array.isArray(a))return a;const i=function(l){if(Wh.has(l[0])){for(let h=1;h<l.length;h++)if(jr(l[h]))return!0}return l}(a);return i===!0?i:i.map(l=>fu(l))}function pu(a){let i=!1;const l=[];if(a[0]==="case"){for(let h=1;h<a.length-1;h+=2)i=i||jr(a[h]),l.push(a[h+1]);l.push(a[a.length-1])}else if(a[0]==="match"){i=i||jr(a[1]);for(let h=2;h<a.length-1;h+=2)l.push(a[h+1]);l.push(a[a.length-1])}else if(a[0]==="step"){i=i||jr(a[1]);for(let h=1;h<a.length-1;h+=2)l.push(a[h+1])}i&&(a.length=0,a.push("any",...l));for(let h=1;h<a.length;h++)pu(a[h])}function jr(a){if(!Array.isArray(a))return!1;if((i=a[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let l=1;l<a.length;l++)if(jr(a[l]))return!0;return!1}const Wh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Qx(a,i){return a<i?-1:a>i?1:0}function B_(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let i=1;i<a.length;i++)if(B_(a[i]))return!0;return!1}function $h(a){if(!a)return!0;const i=a[0];return a.length<=1?i!=="any":i==="=="?xp(a[1],a[2],"=="):i==="!="?Ul(xp(a[1],a[2],"==")):i==="<"||i===">"||i==="<="||i===">="?xp(a[1],a[2],i):i==="any"?(l=a.slice(1),["any"].concat(l.map($h))):i==="all"?["all"].concat(a.slice(1).map($h)):i==="none"?["all"].concat(a.slice(1).map($h).map(Ul)):i==="in"?Hh(a[1],a.slice(2)):i==="!in"?Ul(Hh(a[1],a.slice(2))):i==="has"?U_(a[1]):i==="!has"?Ul(U_(a[1])):i!=="within"||a;var l}function xp(a,i,l){switch(a){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,a,i]}}function Hh(a,i){if(i.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",a,["literal",i.sort(Qx)]]:["filter-in-small",a,["literal",i]]}}function U_(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Ul(a){return["!",a]}function bp(a){return vp(Ur(a.value))?Bl(vi({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):V_(a)}function V_(a){const i=a.value,l=a.key;if(an(i)!=="array")return[new mt(l,i,`array expected, ${an(i)} found`)];const h=a.styleSpec;let f,g=[];if(i.length<1)return[new mt(l,i,"filter array must have at least 1 element")];switch(g=g.concat(jh({key:`${l}[0]`,value:i[0],valueSpec:h.filter_operator,style:a.style,styleSpec:a.styleSpec})),wn(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&wn(i[1])==="$type"&&g.push(new mt(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&g.push(new mt(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(f=an(i[1]),f!=="string"&&g.push(new mt(`${l}[1]`,i[1],`string expected, ${f} found`)));for(let y=2;y<i.length;y++)f=an(i[y]),wn(i[1])==="$type"?g=g.concat(jh({key:`${l}[${y}]`,value:i[y],valueSpec:h.geometry_type,style:a.style,styleSpec:a.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&g.push(new mt(`${l}[${y}]`,i[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<i.length;y++)g=g.concat(V_({key:`${l}[${y}]`,value:i[y],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=an(i[1]),i.length!==2?g.push(new mt(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):f!=="string"&&g.push(new mt(`${l}[1]`,i[1],`string expected, ${f} found`));break;case"within":f=an(i[1]),i.length!==2?g.push(new mt(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):f!=="object"&&g.push(new mt(`${l}[1]`,i[1],`object expected, ${f} found`))}return g}function Zh(a,i){const l=a.key,h=a.style,f=a.styleSpec,g=a.value,y=a.objectKey,b=f[`${i}_${a.layerType}`];if(!b)return[];const E=y.match(/^(.*)-transition$/);if(i==="paint"&&E&&b[E[1]]&&b[E[1]].transition)return li({key:l,value:g,valueSpec:f.transition,style:h,styleSpec:f});const S=a.valueSpec||b[y];if(!S)return[new mt(l,g,`unknown property "${y}"`)];let M;if(an(g)==="string"&&zl(S)&&!S.tokens&&(M=/^{([^}]+)}$/.exec(g)))return[new mt(l,g,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const R=[];return a.layerType==="symbol"&&(y==="text-field"&&h&&!h.glyphs&&R.push(new mt(l,g,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Nh(Ur(g))&&wn(g.type)==="identity"&&R.push(new mt(l,g,'"text-font" does not support identity functions'))),R.concat(li({key:a.key,value:g,valueSpec:S,style:h,styleSpec:f,expressionContext:"property",propertyType:i,propertyKey:y}))}function j_(a){return Zh(a,"paint")}function wp(a){return Zh(a,"layout")}function Ep(a){let i=[];const l=a.value,h=a.key,f=a.style,g=a.styleSpec;l.type||l.ref||i.push(new mt(h,l,'either "type" or "ref" is required'));let y=wn(l.type);const b=wn(l.ref);if(l.id){const E=wn(l.id);for(let S=0;S<a.arrayIndex;S++){const M=f.layers[S];wn(M.id)===E&&i.push(new mt(h,l.id,`duplicate layer id "${l.id}", previously used at line ${M.id.__line__}`))}}if("ref"in l){let E;["type","source","source-layer","filter","layout"].forEach(S=>{S in l&&i.push(new mt(h,l[S],`"${S}" is prohibited for ref layers`))}),f.layers.forEach(S=>{wn(S.id)===b&&(E=S)}),E?E.ref?i.push(new mt(h,l.ref,"ref cannot reference another ref layer")):y=wn(E.type):typeof b=="string"&&i.push(new mt(h,l.ref,`ref layer "${b}" not found`))}else if(y!=="background"&&y!=="sky")if(l.source){const E=f.sources&&f.sources[l.source],S=E&&wn(E.type);E?S==="vector"&&y==="raster"?i.push(new mt(h,l.source,`layer "${l.id}" requires a raster source`)):S==="raster"&&y!=="raster"?i.push(new mt(h,l.source,`layer "${l.id}" requires a vector source`)):S!=="vector"||l["source-layer"]?S==="raster-dem"&&y!=="hillshade"?i.push(new mt(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||S==="geojson"&&E.lineMetrics||i.push(new mt(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new mt(h,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new mt(h,l.source,`source "${l.source}" not found`))}else i.push(new mt(h,l,'missing required property "source"'));return i=i.concat(cs({key:h,value:l,valueSpec:g.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>li({key:`${h}.type`,value:l.type,valueSpec:g.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:E=>bp(vi({layerType:y},E)),layout:E=>cs({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":S=>wp(vi({layerType:y},S))}}),paint:E=>cs({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":S=>j_(vi({layerType:y},S))}})}})),i}function Vl(a){const i=a.value,l=a.key,h=an(i);return h!=="string"?[new mt(l,i,`string expected, ${h} found`)]:[]}const qh={promoteId:function({key:a,value:i}){if(an(i)==="string")return Vl({key:a,value:i});{const l=[];for(const h in i)l.push(...Vl({key:`${a}.${h}`,value:i[h]}));return l}}};function mu(a){const i=a.value,l=a.key,h=a.styleSpec,f=a.style;if(!i.type)return[new mt(l,i,'"type" is required')];const g=wn(i.type);let y;switch(g){case"vector":case"raster":case"raster-dem":return y=cs({key:l,value:i,valueSpec:h[`source_${g.replace("-","_")}`],style:a.style,styleSpec:h,objectElementValidators:qh}),y;case"geojson":if(y=cs({key:l,value:i,valueSpec:h.source_geojson,style:f,styleSpec:h,objectElementValidators:qh}),i.cluster)for(const b in i.clusterProperties){const[E,S]=i.clusterProperties[b],M=typeof E=="string"?[E,["accumulated"],["get",b]]:E;y.push(...Bl({key:`${l}.${b}.map`,value:S,expressionContext:"cluster-map"})),y.push(...Bl({key:`${l}.${b}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return y;case"video":return cs({key:l,value:i,valueSpec:h.source_video,style:f,styleSpec:h});case"image":return cs({key:l,value:i,valueSpec:h.source_image,style:f,styleSpec:h});case"canvas":return[new mt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return jh({key:`${l}.type`,value:i.type,valueSpec:{values:G_(h)},style:f,styleSpec:h})}}function G_(a){return a.source.reduce((i,l)=>{const h=a[l];return h.type.type==="enum"&&(i=i.concat(Object.keys(h.type.values))),i},[])}function W_(a){const i=a.value,l=a.styleSpec,h=l.light,f=a.style;let g=[];const y=an(i);if(i===void 0)return g;if(y!=="object")return g=g.concat([new mt("light",i,`object expected, ${y} found`)]),g;for(const b in i){const E=b.match(/^(.*)-transition$/);g=g.concat(E&&h[E[1]]&&h[E[1]].transition?li({key:b,value:i[b],valueSpec:l.transition,style:f,styleSpec:l}):h[b]?li({key:b,value:i[b],valueSpec:h[b],style:f,styleSpec:l}):[new mt(b,i[b],`unknown property "${b}"`)])}return g}function Tp(a){const i=a.value,l=a.key,h=a.style,f=a.styleSpec,g=f.terrain;let y=[];const b=an(i);if(i===void 0)return y;if(b!=="object")return y=y.concat([new mt("terrain",i,`object expected, ${b} found`)]),y;for(const E in i){const S=E.match(/^(.*)-transition$/);y=y.concat(S&&g[S[1]]&&g[S[1]].transition?li({key:E,value:i[E],valueSpec:f.transition,style:h,styleSpec:f}):g[E]?li({key:E,value:i[E],valueSpec:g[E],style:h,styleSpec:f}):[new mt(E,i[E],`unknown property "${E}"`)])}if(i.source){const E=h.sources&&h.sources[i.source],S=E&&wn(E.type);E?S!=="raster-dem"&&y.push(new mt(l,i.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):y.push(new mt(l,i.source,`source "${i.source}" not found`))}else y.push(new mt(l,i,'terrain is missing required property "source"'));return y}function $_(a){const i=a.value,l=a.style,h=a.styleSpec,f=h.fog;let g=[];const y=an(i);if(i===void 0)return g;if(y!=="object")return g=g.concat([new mt("fog",i,`object expected, ${y} found`)]),g;for(const b in i){const E=b.match(/^(.*)-transition$/);g=g.concat(E&&f[E[1]]&&f[E[1]].transition?li({key:b,value:i[b],valueSpec:h.transition,style:l,styleSpec:h}):f[b]?li({key:b,value:i[b],valueSpec:f[b],style:l,styleSpec:h}):[new mt(b,i[b],`unknown property "${b}"`)])}return g}const Xh={"*":()=>[],array:F_,boolean:function(a){const i=a.value,l=a.key,h=an(i);return h!=="boolean"?[new mt(l,i,`boolean expected, ${h} found`)]:[]},number:yp,color:function(a){const i=a.key,l=a.value,h=an(l);return h!=="string"?[new mt(i,l,`color expected, ${h} found`)]:Ge(l)===null?[new mt(i,l,`color expected, "${l}" found`)]:[]},enum:jh,filter:bp,function:du,layer:Ep,object:cs,source:mu,light:W_,terrain:Tp,fog:$_,string:Vl,formatted:function(a){return Vl(a).length===0?[]:Bl(a)},resolvedImage:function(a){return Vl(a).length===0?[]:Bl(a)},projection:function(a){const i=a.value,l=a.styleSpec,h=l.projection,f=a.style;let g=[];const y=an(i);if(y==="object")for(const b in i)g=g.concat(li({key:b,value:i[b],valueSpec:h[b],style:f,styleSpec:l}));else y!=="string"&&(g=g.concat([new mt("projection",i,`object or string expected, ${y} found`)]));return g}};function li(a){const i=a.value,l=a.valueSpec,h=a.styleSpec;return l.expression&&Nh(wn(i))?du(a):l.expression&&Fl(Ur(i))?Bl(a):l.type&&Xh[l.type]?Xh[l.type](a):cs(vi({},a,{valueSpec:l.type?h[l.type]:l}))}function e1(a){const i=a.value,l=a.key,h=Vl(a);return h.length||(i.indexOf("{fontstack}")===-1&&h.push(new mt(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&h.push(new mt(l,i,'"glyphs" url must include a "{range}" token'))),h}function H_(a,i=je){return Mo(li({key:"",value:a,valueSpec:i.$root,styleSpec:i,style:a,objectElementValidators:{glyphs:e1,"*":()=>[]}}))}const t1=a=>Mo(j_(a)),Z_=a=>Mo(wp(a));function Mo(a){return a.slice().sort((i,l)=>i.line&&l.line?i.line-l.line:0)}function q_(a,i){let l=!1;if(i&&i.length)for(const h of i)a.fire(new yi(new Error(h.message))),l=!0;return l}var jl=Ks;function Ks(a,i,l){var h=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(i=f[1])+2*(l=f[2]);for(var g=0;g<this.d*this.d;g++){var y=f[3+g],b=f[3+g+1];h.push(y===b?null:f.subarray(y,b))}var E=f[3+h.length+1];this.keys=f.subarray(f[3+h.length],E),this.bboxes=f.subarray(E),this.insert=this._insertReadonly}else{this.d=i+2*l;for(var S=0;S<this.d*this.d;S++)h.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=a,this.padding=l,this.scale=i/a,this.uid=0;var M=l/i*a;this.min=-M,this.max=a+M}Ks.prototype.insert=function(a,i,l,h,f){this._forEachCell(i,l,h,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(f)},Ks.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ks.prototype._insertCell=function(a,i,l,h,f,g){this.cells[f].push(g)},Ks.prototype.query=function(a,i,l,h,f){var g=this.min,y=this.max;if(a<=g&&i<=g&&y<=l&&y<=h&&!f)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(a,i,l,h,this._queryCell,b,{},f),b},Ks.prototype._queryCell=function(a,i,l,h,f,g,y,b){var E=this.cells[f];if(E!==null)for(var S=this.keys,M=this.bboxes,R=0;R<E.length;R++){var k=E[R];if(y[k]===void 0){var z=4*k;(b?b(M[z+0],M[z+1],M[z+2],M[z+3]):a<=M[z+2]&&i<=M[z+3]&&l>=M[z+0]&&h>=M[z+1])?(y[k]=!0,g.push(S[k])):y[k]=!1}}},Ks.prototype._forEachCell=function(a,i,l,h,f,g,y,b){for(var E=this._convertToCellCoord(a),S=this._convertToCellCoord(i),M=this._convertToCellCoord(l),R=this._convertToCellCoord(h),k=E;k<=M;k++)for(var z=S;z<=R;z++){var N=this.d*z+k;if((!b||b(this._convertFromCellCoord(k),this._convertFromCellCoord(z),this._convertFromCellCoord(k+1),this._convertFromCellCoord(z+1)))&&f.call(this,a,i,l,h,N,g,y,b))return}},Ks.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ks.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ks.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,i=3+this.cells.length+1+1,l=0,h=0;h<this.cells.length;h++)l+=this.cells[h].length;var f=new Int32Array(i+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=i,y=0;y<a.length;y++){var b=a[y];f[3+y]=g,f.set(b,g),g+=b.length}return f[3+a.length]=g,f.set(this.keys,g),f[3+a.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer};const Yh={};function yt(a,i,l={}){Object.defineProperty(a,"_classRegistryKey",{value:i,writeable:!1}),Yh[i]={klass:a,omit:l.omit||[]}}yt(Object,"Object"),jl.serialize=function(a,i){const l=a.toArrayBuffer();return i&&i.push(l),{buffer:l}},jl.deserialize=function(a){return new jl(a.buffer)},Object.defineProperty(jl,"name",{value:"Grid"}),yt(jl,"Grid"),yt(vn,"Color"),yt(Error,"Error"),yt(Nr,"AJAXError"),yt(xi,"ResolvedImage"),yt(uu,"StylePropertyFunction"),yt(Uh,"StyleExpression",{omit:["_evaluator"]}),yt(qa,"ZoomDependentExpression"),yt(Vh,"ZoomConstantExpression"),yt(la,"CompoundExpression",{omit:["_evaluate"]});for(const a in Ol)Yh[Ol[a]._classRegistryKey]||yt(Ol[a],`Expression${a}`);function X_(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function gu(a){return v.ImageBitmap&&a instanceof v.ImageBitmap}function _u(a,i){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(X_(a)||gu(a))return i&&i.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return i&&i.push(l.buffer),l}if(a instanceof v.ImageData)return i&&i.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const h of a)l.push(_u(h,i));return l}if(typeof a=="object"){const l=a.constructor,h=l._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const f=l.serialize?l.serialize(a,i):{};if(!l.serialize){for(const g in a)a.hasOwnProperty(g)&&(Yh[h].omit.indexOf(g)>=0||(f[g]=_u(a[g],i)));a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(f.$name=h),f}throw new Error("can't serialize object of type "+typeof a)}function yu(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||X_(a)||gu(a)||ArrayBuffer.isView(a)||a instanceof v.ImageData)return a;if(Array.isArray(a))return a.map(yu);if(typeof a=="object"){const i=a.$name||"Object",{klass:l}=Yh[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(a);const h=Object.create(l.prototype);for(const f of Object.keys(a))f!=="$name"&&(h[f]=yu(a[f]));return h}throw new Error("can't deserialize object of type "+typeof a)}const vu=a=>a>=1536&&a<=1791,Y_=a=>a>=1872&&a<=1919,Sp=a=>a>=2208&&a<=2303,K_=a=>a>=11904&&a<=12031,Ap=a=>a>=12032&&a<=12255,Cp=a=>a>=12272&&a<=12287,xu=a=>a>=12288&&a<=12351,Kh=a=>a>=12352&&a<=12447,Gl=a=>a>=12448&&a<=12543,Jh=a=>a>=12544&&a<=12591,J_=a=>a>=12704&&a<=12735,Q_=a=>a>=12736&&a<=12783,Mp=a=>a>=12784&&a<=12799,ey=a=>a>=12800&&a<=13055,ty=a=>a>=13056&&a<=13311,ny=a=>a>=13312&&a<=19903,Pp=a=>a>=19968&&a<=40959,ry=a=>a>=40960&&a<=42127,iy=a=>a>=42128&&a<=42191,sy=a=>a>=44032&&a<=55215,oy=a=>a>=63744&&a<=64255,Qh=a=>a>=64336&&a<=65023,bu=a=>a>=65040&&a<=65055,m=a=>a>=65072&&a<=65103,c=a=>a>=65104&&a<=65135,d=a=>a>=65136&&a<=65279,_=a=>a>=65280&&a<=65519;function x(a){for(const i of a)if(C(i.charCodeAt(0)))return!0;return!1}function w(a){for(const i of a)if(!A(i.charCodeAt(0)))return!1;return!0}function A(a){return!(vu(a)||Y_(a)||Sp(a)||Qh(a)||d(a))}function C(a){return!(a!==746&&a!==747&&(a<4352||!(J_(a)||Jh(a)||m(a)&&!(a>=65097&&a<=65103)||oy(a)||ty(a)||K_(a)||Q_(a)||!(!xu(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||ny(a)||Pp(a)||ey(a)||(i=>i>=12592&&i<=12687)(a)||(i=>i>=43360&&i<=43391)(a)||(i=>i>=55216&&i<=55295)(a)||(i=>i>=4352&&i<=4607)(a)||sy(a)||Kh(a)||Cp(a)||(i=>i>=12688&&i<=12703)(a)||Ap(a)||Mp(a)||Gl(a)&&a!==12540||!(!_(a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!c(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(i=>i>=5120&&i<=5759)(a)||(i=>i>=6320&&i<=6399)(a)||bu(a)||(i=>i>=19904&&i<=19967)(a)||ry(a)||iy(a))))}function P(a){return!(C(a)||function(i){return!!((l=>l>=128&&l<=255)(i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||(l=>l>=8192&&l<=8303)(i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||(l=>l>=8448&&l<=8527)(i)||(l=>l>=8528&&l<=8591)(i)||(l=>l>=8960&&l<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||(l=>l>=9216&&l<=9279)(i)&&i!==9251||(l=>l>=9280&&l<=9311)(i)||(l=>l>=9312&&l<=9471)(i)||(l=>l>=9632&&l<=9727)(i)||(l=>l>=9728&&l<=9983)(i)&&!(i>=9754&&i<=9759)||(l=>l>=11008&&l<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||xu(i)||Gl(i)||(l=>l>=57344&&l<=63743)(i)||m(i)||c(i)||_(i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(a))}function O(a){return a>=1424&&a<=2303||Qh(a)||d(a)}function D(a,i){return!(!i&&O(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=>l>=6016&&l<=6143)(a))}function U(a){for(const i of a)if(O(i.charCodeAt(0)))return!0;return!1}const $="deferred",ee="loading",Q="loaded";let te=null,ne="unavailable",W=null;const he=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(ne="error"),te&&te(a)};function le(){pe.fire(new Kt("pluginStateChange",{pluginStatus:ne,pluginURL:W}))}const pe=new Br,xe=function(){return ne},ye=function(){if(ne!==$||!W)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ne=ee,le(),W&&bo({url:W},a=>{a?he(a):(ne=Q,le())})},Te={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ne===Q||Te.applyArabicShaping!=null,isLoading:()=>ne===ee,setState(a){ne=a.pluginStatus,W=a.pluginURL},isParsed:()=>Te.applyArabicShaping!=null&&Te.processBidirectionalText!=null&&Te.processStyledBidirectionalText!=null,getPluginURL:()=>W};class Pe{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(i){return function(l,h){for(const f of l)if(!D(f.charCodeAt(0),h))return!1;return!0}(i,Te.isLoaded())}}class Le{constructor(i,l){this.property=i,this.value=l,this.expression=function(h,f){if(Nh(h))return new uu(h,f);if(Fl(h)){const g=Xa(h,f);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=h;return typeof h=="string"&&f.type==="color"&&(g=vn.parse(h)),{kind:"constant",evaluate:()=>g}}}(l===void 0?i.specification.default:l,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,l,h){return this.property.possiblyEvaluate(this,i,l,h)}}class ze{constructor(i){this.property=i,this.value=new Le(i,void 0)}transitioned(i,l){return new Ie(this.property,this.value,l,Ot({},i.transition,this.transition),i.now)}untransitioned(){return new Ie(this.property,this.value,null,{},0)}}class st{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Zn(this._values[i].value.value)}setValue(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new ze(this._values[i].property)),this._values[i].value=new Le(this._values[i].property,l===null?void 0:Zn(l))}getTransition(i){return Zn(this._values[i].transition)}setTransition(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new ze(this._values[i].property)),this._values[i].transition=Zn(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(i[l]=h);const f=this.getTransition(l);f!==void 0&&(i[`${l}-transition`]=f)}return i}transitioned(i,l){const h=new Ze(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].transitioned(i,l._values[f]);return h}untransitioned(){const i=new Ze(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class Ie{constructor(i,l,h,f,g){const y=f.delay||0,b=f.duration||0;g=g||0,this.property=i,this.value=l,this.begin=g+y,this.end=this.begin+b,i.specification.transition&&(f.delay||f.duration)&&(this.prior=h)}possiblyEvaluate(i,l,h){const f=i.now||0,g=this.value.possiblyEvaluate(i,l,h),y=this.prior;if(y){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return y.possiblyEvaluate(i,l,h);{const b=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(i,l,h),g,Dn(b))}}return g}}class Ze{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,h){const f=new Oe(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(i,l,h);return f}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Ue{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Zn(this._values[i].value)}setValue(i,l){this._values[i]=new Le(this._values[i].property,l===null?void 0:Zn(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(i[l]=h)}return i}possiblyEvaluate(i,l,h){const f=new Oe(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(i,l,h);return f}}class Ke{constructor(i,l,h){this.property=i,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,h,f){return this.property.evaluate(this.value,this.parameters,i,l,h,f)}}class Oe{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Ae{constructor(i){this.specification=i}possiblyEvaluate(i,l){return i.expression.evaluate(l)}interpolate(i,l,h){const f=ru[this.specification.type];return f?f(i,l,h):i}}class Ne{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,h,f){return new Ke(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(l,null,{},h,f)}:i.expression,l)}interpolate(i,l,h){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new Ke(this,{kind:"constant",value:void 0},i.parameters);const f=ru[this.specification.type];return f?new Ke(this,{kind:"constant",value:f(i.value.value,l.value.value,h)},i.parameters):i}evaluate(i,l,h,f,g,y){return i.kind==="constant"?i.value:i.evaluate(l,h,f,g,y)}}class Ye{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,f){return!!i.expression.evaluate(l,null,{},h,f)}interpolate(){return!1}}class tt{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new Pe(0,{});for(const h in i){const f=i[h];f.specification.overridable&&this.overridableProperties.push(h);const g=this.defaultPropertyValues[h]=new Le(f,void 0),y=this.defaultTransitionablePropertyValues[h]=new ze(f);this.defaultTransitioningPropertyValues[h]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=g.possiblyEvaluate(l)}}}function At(a,i){return 256*(a=jt(Math.floor(a),0,255))+jt(Math.floor(i),0,255)}yt(Ne,"DataDrivenProperty"),yt(Ae,"DataConstantProperty"),yt(Ye,"ColorRampProperty");const qt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vt{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Mt(a,i=1){let l=0,h=0;return{members:a.map(f=>{const g=qt[f.type].BYTES_PER_ELEMENT,y=l=nn(l,Math.max(i,g)),b=f.components||1;return h=Math.max(h,g),l+=g*b,{name:f.name,type:f.type,components:b,offset:y}}),size:nn(l,Math.max(h,i)),alignment:i}}function nn(a,i){return Math.ceil(a/i)*i}class It extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const f=2*i;return this.int16[f+0]=l,this.int16[f+1]=h,i}}It.prototype.bytesPerElement=4,yt(It,"StructArrayLayout2i4");class gn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,h)}emplace(i,l,h,f){const g=3*i;return this.int16[g+0]=l,this.int16[g+1]=h,this.int16[g+2]=f,i}}gn.prototype.bytesPerElement=6,yt(gn,"StructArrayLayout3i6");class In extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,h,f)}emplace(i,l,h,f,g){const y=4*i;return this.int16[y+0]=l,this.int16[y+1]=h,this.int16[y+2]=f,this.int16[y+3]=g,i}}In.prototype.bytesPerElement=8,yt(In,"StructArrayLayout4i8");class jn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,i,l,h,f,g,y,b)}emplace(i,l,h,f,g,y,b,E){const S=6*i,M=12*i,R=3*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.uint8[M+4]=f,this.uint8[M+5]=g,this.uint8[M+6]=y,this.uint8[M+7]=b,this.float32[R+2]=E,i}}jn.prototype.bytesPerElement=12,yt(jn,"StructArrayLayout2i4ub1f12");class Nn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,h,f)}emplace(i,l,h,f,g){const y=4*i;return this.float32[y+0]=l,this.float32[y+1]=h,this.float32[y+2]=f,this.float32[y+3]=g,i}}Nn.prototype.bytesPerElement=16,yt(Nn,"StructArrayLayout4f16");class xr extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,h,f,g)}emplace(i,l,h,f,g,y){const b=6*i,E=3*i;return this.uint16[b+0]=l,this.uint16[b+1]=h,this.uint16[b+2]=f,this.uint16[b+3]=g,this.float32[E+2]=y,i}}xr.prototype.bytesPerElement=12,yt(xr,"StructArrayLayout4ui1f12");class ki extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,h,f)}emplace(i,l,h,f,g){const y=4*i;return this.uint16[y+0]=l,this.uint16[y+1]=h,this.uint16[y+2]=f,this.uint16[y+3]=g,i}}ki.prototype.bytesPerElement=8,yt(ki,"StructArrayLayout4ui8");class As extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,h,f,g,y)}emplace(i,l,h,f,g,y,b){const E=6*i;return this.int16[E+0]=l,this.int16[E+1]=h,this.int16[E+2]=f,this.int16[E+3]=g,this.int16[E+4]=y,this.int16[E+5]=b,i}}As.prototype.bytesPerElement=12,yt(As,"StructArrayLayout6i12");class Po extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g,y,b,E,S,M,R,k){const z=this.length;return this.resize(z+1),this.emplace(z,i,l,h,f,g,y,b,E,S,M,R,k)}emplace(i,l,h,f,g,y,b,E,S,M,R,k,z){const N=12*i;return this.int16[N+0]=l,this.int16[N+1]=h,this.int16[N+2]=f,this.int16[N+3]=g,this.uint16[N+4]=y,this.uint16[N+5]=b,this.uint16[N+6]=E,this.uint16[N+7]=S,this.int16[N+8]=M,this.int16[N+9]=R,this.int16[N+10]=k,this.int16[N+11]=z,i}}Po.prototype.bytesPerElement=24,yt(Po,"StructArrayLayout4i4ui4i24");class Kn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,h,f,g,y)}emplace(i,l,h,f,g,y,b){const E=10*i,S=5*i;return this.int16[E+0]=l,this.int16[E+1]=h,this.int16[E+2]=f,this.float32[S+2]=g,this.float32[S+3]=y,this.float32[S+4]=b,i}}Kn.prototype.bytesPerElement=20,yt(Kn,"StructArrayLayout3i3f20");class Bn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Bn.prototype.bytesPerElement=4,yt(Bn,"StructArrayLayout1ul4");class fn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g,y,b,E,S,M,R,k,z){const N=this.length;return this.resize(N+1),this.emplace(N,i,l,h,f,g,y,b,E,S,M,R,k,z)}emplace(i,l,h,f,g,y,b,E,S,M,R,k,z,N){const V=20*i,Y=10*i;return this.int16[V+0]=l,this.int16[V+1]=h,this.int16[V+2]=f,this.int16[V+3]=g,this.int16[V+4]=y,this.float32[Y+3]=b,this.float32[Y+4]=E,this.float32[Y+5]=S,this.float32[Y+6]=M,this.int16[V+14]=R,this.uint32[Y+8]=k,this.uint16[V+18]=z,this.uint16[V+19]=N,i}}fn.prototype.bytesPerElement=40,yt(fn,"StructArrayLayout5i4f1i1ul2ui40");class lr extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,i,l,h,f,g,y,b)}emplace(i,l,h,f,g,y,b,E){const S=8*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.int16[S+2]=f,this.int16[S+4]=g,this.int16[S+5]=y,this.int16[S+6]=b,this.int16[S+7]=E,i}}lr.prototype.bytesPerElement=16,yt(lr,"StructArrayLayout3i2i2i16");class ci extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,h,f,g)}emplace(i,l,h,f,g,y){const b=4*i,E=8*i;return this.float32[b+0]=l,this.float32[b+1]=h,this.float32[b+2]=f,this.int16[E+6]=g,this.int16[E+7]=y,i}}ci.prototype.bytesPerElement=16,yt(ci,"StructArrayLayout2f1f2i16");class qn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,h,f)}emplace(i,l,h,f,g){const y=12*i,b=3*i;return this.uint8[y+0]=l,this.uint8[y+1]=h,this.float32[b+1]=f,this.float32[b+2]=g,i}}qn.prototype.bytesPerElement=12,yt(qn,"StructArrayLayout2ub2f12");class ui extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,h)}emplace(i,l,h,f){const g=3*i;return this.float32[g+0]=l,this.float32[g+1]=h,this.float32[g+2]=f,i}}ui.prototype.bytesPerElement=12,yt(ui,"StructArrayLayout3f12");class hi extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,h)}emplace(i,l,h,f){const g=3*i;return this.uint16[g+0]=l,this.uint16[g+1]=h,this.uint16[g+2]=f,i}}hi.prototype.bytesPerElement=6,yt(hi,"StructArrayLayout3ui6");class da extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g,y,b,E,S,M,R,k,z,N,V,Y,ce,ge,ae,me,ve){const _e=this.length;return this.resize(_e+1),this.emplace(_e,i,l,h,f,g,y,b,E,S,M,R,k,z,N,V,Y,ce,ge,ae,me,ve)}emplace(i,l,h,f,g,y,b,E,S,M,R,k,z,N,V,Y,ce,ge,ae,me,ve,_e){const De=30*i,ke=15*i,$e=60*i;return this.int16[De+0]=l,this.int16[De+1]=h,this.int16[De+2]=f,this.float32[ke+2]=g,this.float32[ke+3]=y,this.uint16[De+8]=b,this.uint16[De+9]=E,this.uint32[ke+5]=S,this.uint32[ke+6]=M,this.uint32[ke+7]=R,this.uint16[De+16]=k,this.uint16[De+17]=z,this.uint16[De+18]=N,this.float32[ke+10]=V,this.float32[ke+11]=Y,this.uint8[$e+48]=ce,this.uint8[$e+49]=ge,this.uint8[$e+50]=ae,this.uint32[ke+13]=me,this.int16[De+28]=ve,this.uint8[$e+58]=_e,i}}da.prototype.bytesPerElement=60,yt(da,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Wl extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g,y,b,E,S,M,R,k,z,N,V,Y,ce,ge,ae,me,ve,_e,De,ke,$e,nt,Be,He,qe,Je){const it=this.length;return this.resize(it+1),this.emplace(it,i,l,h,f,g,y,b,E,S,M,R,k,z,N,V,Y,ce,ge,ae,me,ve,_e,De,ke,$e,nt,Be,He,qe,Je)}emplace(i,l,h,f,g,y,b,E,S,M,R,k,z,N,V,Y,ce,ge,ae,me,ve,_e,De,ke,$e,nt,Be,He,qe,Je,it){const Ve=38*i,ct=19*i;return this.int16[Ve+0]=l,this.int16[Ve+1]=h,this.int16[Ve+2]=f,this.float32[ct+2]=g,this.float32[ct+3]=y,this.int16[Ve+8]=b,this.int16[Ve+9]=E,this.int16[Ve+10]=S,this.int16[Ve+11]=M,this.int16[Ve+12]=R,this.int16[Ve+13]=k,this.uint16[Ve+14]=z,this.uint16[Ve+15]=N,this.uint16[Ve+16]=V,this.uint16[Ve+17]=Y,this.uint16[Ve+18]=ce,this.uint16[Ve+19]=ge,this.uint16[Ve+20]=ae,this.uint16[Ve+21]=me,this.uint16[Ve+22]=ve,this.uint16[Ve+23]=_e,this.uint16[Ve+24]=De,this.uint16[Ve+25]=ke,this.uint16[Ve+26]=$e,this.uint16[Ve+27]=nt,this.uint16[Ve+28]=Be,this.uint32[ct+15]=He,this.float32[ct+16]=qe,this.float32[ct+17]=Je,this.float32[ct+18]=it,i}}Wl.prototype.bytesPerElement=76,yt(Wl,"StructArrayLayout3i2f6i15ui1ul3f76");class Hi extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}Hi.prototype.bytesPerElement=4,yt(Hi,"StructArrayLayout1f4");class us extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,h,f,g)}emplace(i,l,h,f,g,y){const b=5*i;return this.float32[b+0]=l,this.float32[b+1]=h,this.float32[b+2]=f,this.float32[b+3]=g,this.float32[b+4]=y,i}}us.prototype.bytesPerElement=20,yt(us,"StructArrayLayout5f20");class Io extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,h,f)}emplace(i,l,h,f,g){const y=6*i;return this.uint32[3*i+0]=l,this.uint16[y+2]=h,this.uint16[y+3]=f,this.uint16[y+4]=g,i}}Io.prototype.bytesPerElement=12,yt(Io,"StructArrayLayout1ul3ui12");class fa extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const f=2*i;return this.uint16[f+0]=l,this.uint16[f+1]=h,i}}fa.prototype.bytesPerElement=4,yt(fa,"StructArrayLayout2ui4");class pa extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}pa.prototype.bytesPerElement=2,yt(pa,"StructArrayLayout1ui2");class $l extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const f=2*i;return this.float32[f+0]=l,this.float32[f+1]=h,i}}$l.prototype.bytesPerElement=8,yt($l,"StructArrayLayout2f8");class d2 extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}d2.prototype.size=40;class n1 extends fn{get(i){return new d2(this,i)}}yt(n1,"CollisionBoxArray");class f2 extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}f2.prototype.size=60;class p2 extends da{get(i){return new f2(this,i)}}yt(p2,"PlacedSymbolArray");class m2 extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}m2.prototype.size=76;class g2 extends Wl{get(i){return new m2(this,i)}}yt(g2,"SymbolInstanceArray");class _2 extends Hi{getoffsetX(i){return this.float32[1*i+0]}}yt(_2,"GlyphOffsetArray");class y2 extends It{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}yt(y2,"SymbolLineVertexArray");class v2 extends vt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}v2.prototype.size=12;class x2 extends Io{get(i){return new v2(this,i)}}yt(x2,"FeatureIndexArray");class b2 extends fa{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}yt(b2,"FillExtrusionCentroidArray");const ZF=Mt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),qF=Mt([{name:"a_dash",components:4,type:"Uint16"}]);var wu={},XF={get exports(){return wu},set exports(a){wu=a}},r1={};({get exports(){return r1},set exports(a){r1=a}}).exports=function(a,i){var l,h,f,g,y,b,E,S;for(h=a.length-(l=3&a.length),f=i,y=3432918353,b=461845907,S=0;S<h;)E=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24,++S,f=27492+(65535&(g=5*(65535&(f=(f^=E=(65535&(E=(E=(65535&E)*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*b+(((E>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(E=0,l){case 3:E^=(255&a.charCodeAt(S+2))<<16;case 2:E^=(255&a.charCodeAt(S+1))<<8;case 1:f^=E=(65535&(E=(E=(65535&(E^=255&a.charCodeAt(S)))*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*b+(((E>>>16)*b&65535)<<16)&4294967295}return f^=a.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var i1={};({get exports(){return i1},set exports(a){i1=a}}).exports=function(a,i){for(var l,h=a.length,f=i^h,g=0;h>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(g)|(255&a.charCodeAt(++g))<<8|(255&a.charCodeAt(++g))<<16|(255&a.charCodeAt(++g))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++g;switch(h){case 3:f^=(255&a.charCodeAt(g+2))<<16;case 2:f^=(255&a.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&a.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var w2=r1,YF=i1;XF.exports=w2,wu.murmur3=w2,wu.murmur2=YF;class ay{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,h,f){this.ids.push(E2(i)),this.positions.push(l,h,f)}getPositions(i){const l=E2(i);let h=0,f=this.ids.length-1;for(;h<f;){const y=h+f>>1;this.ids[y]>=l?f=y:h=y+1}const g=[];for(;this.ids[h]===l;)g.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return g}static serialize(i,l){const h=new Float64Array(i.ids),f=new Uint32Array(i.positions);return s1(h,f,0,h.length-1),l&&l.push(h.buffer,f.buffer),{ids:h,positions:f}}static deserialize(i){const l=new ay;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function E2(a){const i=+a;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:wu(String(a))}function s1(a,i,l,h){for(;l<h;){const f=a[l+h>>1];let g=l-1,y=h+1;for(;;){do g++;while(a[g]<f);do y--;while(a[y]>f);if(g>=y)break;ly(a,g,y),ly(i,3*g,3*y),ly(i,3*g+1,3*y+1),ly(i,3*g+2,3*y+2)}y-l<h-y?(s1(a,i,l,y),l=y+1):(s1(a,i,y+1,h),h=y)}}function ly(a,i,l){const h=a[i];a[i]=a[l],a[l]=h}yt(ay,"FeaturePositionMap");class Ya{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,l),this.initialized=!0),!!this.location}}class cy extends Ya{constructor(i){super(i),this.current=0}set(i,l,h){this.fetchUniformLocation(i,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class T2 extends Ya{constructor(i){super(i),this.current=[0,0,0,0]}set(i,l,h){this.fetchUniformLocation(i,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class S2 extends Ya{constructor(i){super(i),this.current=vn.transparent}set(i,l,h){this.fetchUniformLocation(i,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const KF=new Float32Array(16),JF=new Float32Array(9),QF=new Float32Array(4);function o1(a){return[At(255*a.r,255*a.g),At(255*a.b,255*a.a)]}class Ip{constructor(i,l,h){this.value=i,this.uniformNames=l.map(f=>`u_${f}`),this.type=h}setUniform(i,l,h,f,g){l.set(i,g,f.constantOr(this.value))}getBinding(i,l){return this.type==="color"?new S2(i):new cy(i)}}class ed{constructor(i,l){this.uniformNames=l.map(h=>`u_${h}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,l,h,f,g){const y=g==="u_pattern"||g==="u_dash"?this.pattern:g==="u_pixel_ratio"?this.pixelRatio:null;y&&l.set(i,g,y)}getBinding(i,l){return l==="u_pattern"||l==="u_dash"?new T2(i):new cy(i)}}class Ka{constructor(i,l,h,f){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(g=>({name:`a_${g}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(i,l,h,f,g,y){const b=this.paintVertexArray.length,E=this.expression.evaluate(new Pe(0),l,{},g,f,y);this.paintVertexArray.resize(i),this._setPaintValue(b,i,E)}updatePaintArray(i,l,h,f,g){const y=this.expression.evaluate({zoom:0},h,f,void 0,g);this._setPaintValue(i,l,y)}_setPaintValue(i,l,h){if(this.type==="color"){const f=o1(h);for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=i;f<l;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ro{constructor(i,l,h,f,g,y){this.expression=i,this.uniformNames=l.map(b=>`u_${b}_t`),this.type=h,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(i,l,h,f,g,y){const b=this.expression.evaluate(new Pe(this.zoom),l,{},g,f,y),E=this.expression.evaluate(new Pe(this.zoom+1),l,{},g,f,y),S=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(S,i,b,E)}updatePaintArray(i,l,h,f,g){const y=this.expression.evaluate({zoom:this.zoom},h,f,void 0,g),b=this.expression.evaluate({zoom:this.zoom+1},h,f,void 0,g);this._setPaintValue(i,l,y,b)}_setPaintValue(i,l,h,f){if(this.type==="color"){const g=o1(h),y=o1(f);for(let b=i;b<l;b++)this.paintVertexArray.emplace(b,g[0],g[1],y[0],y[1])}else{for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,h,f);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l,h,f,g){const y=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,b=jt(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);l.set(i,g,b)}getBinding(i,l){return new cy(i)}}class Hl{constructor(i,l,h,f,g){this.expression=i,this.layerId=g,this.paintVertexAttributes=(h==="array"?qF:ZF).members;for(let y=0;y<l.length;++y);this.paintVertexArray=new f}populatePaintArray(i,l,h){const f=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(f,i,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(i,l,h,f,g,y){this._setPaintValues(i,l,h.patterns&&h.patterns[this.layerId],y)}_setPaintValues(i,l,h,f){if(!f||!h)return;const g=f[h];if(!g)return;const{tl:y,br:b,pixelRatio:E}=g;for(let S=i;S<l;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1],E)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zl{constructor(i,l,h=()=>!0){this.binders={},this._buffers=[];const f=[];for(const g in i.paint._values){if(!h(g))continue;const y=i.paint.get(g);if(!(y instanceof Ke&&zl(y.property.specification)))continue;const b=tN(g,i.type),E=y.value,S=y.property.specification.type,M=y.property.useIntegerZoom,R=g==="line-dasharray"||g.endsWith("pattern"),k=g==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant";if(E.kind!=="constant"||k)if(E.kind==="source"||k||R){const z=A2(g,S,"source");this.binders[g]=R?new Hl(E,b,S,z,i.id):new Ka(E,b,S,z),f.push(`/a_${g}`)}else{const z=A2(g,S,"composite");this.binders[g]=new Ro(E,b,S,M,l,z),f.push(`/z_${g}`)}else this.binders[g]=R?new ed(E.value,b):new Ip(E.value,b,S),f.push(`/u_${g}`)}this.cacheKey=f.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof Ka||l instanceof Ro?l.maxValue:0}populatePaintArrays(i,l,h,f,g,y){for(const b in this.binders){const E=this.binders[b];(E instanceof Ka||E instanceof Ro||E instanceof Hl)&&E.populatePaintArray(i,l,h,f,g,y)}}setConstantPatternPositions(i){for(const l in this.binders){const h=this.binders[l];h instanceof ed&&h.setConstantPatternPositions(i)}}updatePaintArrays(i,l,h,f,g,y){let b=!1;for(const E in i){const S=l.getPositions(E);for(const M of S){const R=h.feature(M.index);for(const k in this.binders){const z=this.binders[k];if((z instanceof Ka||z instanceof Ro||z instanceof Hl)&&z.expression.isStateDependent===!0){const N=f.paint.get(k);z.expression=N.value,z.updatePaintArray(M.start,M.end,R,i[E],g,y),b=!0}}}}return b}defines(){const i=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Ip||h instanceof ed)&&i.push(...h.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Ka||h instanceof Ro||h instanceof Hl)for(let f=0;f<h.paintVertexAttributes.length;f++)i.push(h.paintVertexAttributes[f].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Ip||h instanceof ed||h instanceof Ro)for(const f of h.uniformNames)i.push(f)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const l=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Ip||f instanceof ed||f instanceof Ro)for(const g of f.uniformNames)l.push({name:g,property:h,binding:f.getBinding(i,g)})}return l}setUniforms(i,l,h,f,g){for(const{name:y,property:b,binding:E}of h)this.binders[b].setUniform(i,E,g,f.get(b),y)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const l=this.binders[i];(l instanceof Ka||l instanceof Ro||l instanceof Hl)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(i){for(const l in this.binders){const h=this.binders[l];(h instanceof Ka||h instanceof Ro||h instanceof Hl)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof Ka||l instanceof Ro||l instanceof Hl)&&l.destroy()}}}class Eu{constructor(i,l,h=()=>!0){this.programConfigurations={};for(const f of i)this.programConfigurations[f.id]=new Zl(f,l,h);this.needsUpload=!1,this._featureMap=new ay,this._bufferOffset=0}populatePaintArrays(i,l,h,f,g,y,b){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(i,l,f,g,y,b);l.id!==void 0&&this._featureMap.add(l.id,h,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,h,f,g){for(const y of h)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(i,this._featureMap,l,y,f,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const eN={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function tN(a,i){return eN[a]||[a.replace(`${i}-`,"").replace(/-/g,"_")]}const nN={"line-pattern":{source:xr,composite:xr},"fill-pattern":{source:xr,composite:xr},"fill-extrusion-pattern":{source:xr,composite:xr},"line-dasharray":{source:ki,composite:ki}},rN={color:{source:$l,composite:Nn},number:{source:Hi,composite:$l}};function A2(a,i,l){const h=nN[a];return h&&h[l]||rN[i][l]}yt(Ip,"ConstantBinder"),yt(ed,"PatternConstantBinder"),yt(Ka,"SourceExpressionBinder"),yt(Hl,"PatternCompositeBinder"),yt(Ro,"CompositeExpressionBinder"),yt(Zl,"ProgramConfiguration",{omit:["_buffers"]}),yt(Eu,"ProgramConfigurationSet");const uy="-transition";class ko extends Br{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&i.type!=="sky"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new Ue(l.layout)),l.paint)){this._transitionablePaint=new st(l.paint);for(const h in i.paint)this.setPaintProperty(h,i.paint[h],{validate:!1});for(const h in i.layout)this.setLayoutProperty(h,i.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Oe(l.paint)}}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,h={}){l!=null&&this._validate(Z_,`layers.${this.id}.layout.${i}`,i,l,h)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return Mn(i,uy)?this._transitionablePaint.getTransition(i.slice(0,-uy.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,h={}){if(l!=null&&this._validate(t1,`layers.${this.id}.paint.${i}`,i,l,h))return!1;if(Mn(i,uy))return this._transitionablePaint.setTransition(i.slice(0,-uy.length),l||void 0),!1;{const f=this._transitionablePaint._values[i],g=f.value.isDataDriven(),y=f.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const b=this._transitionablePaint._values[i].value,E=b.isDataDriven(),S=Mn(i,"pattern")||i==="line-dasharray";return E||g||S||this._handleOverridablePaintPropertyUpdate(i,y,b)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,l,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Hn(i,(l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length))}_validate(i,l,h,f,g={}){return(!g||g.validate!==!1)&&q_(this,i.call(H_,{key:l,layerType:this.type,objectKey:h,value:f,styleSpec:je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof Ke&&zl(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Gh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const iN=Mt([{name:"a_pos",components:2,type:"Int16"}],4),sN=Mt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class br{constructor(i=[]){this.segments=i}prepareSegment(i,l,h,f){let g=this.segments[this.segments.length-1];return i>br.MAX_VERTEX_ARRAY_LENGTH&&Vn(`Max vertices per segment is ${br.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!g||g.vertexLength+i>br.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f)&&(g={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},f!==void 0&&(g.sortKey=f),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,h,f){return new br([{vertexOffset:i,primitiveOffset:l,vertexLength:h,primitiveLength:f,vaos:{},sortKey:0}])}}br.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yt(br,"SegmentVector");var Ut=8192;class ql{constructor(i,l){i&&(l?this.setSouthWest(i).setNorthEast(l):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof hn?new hn(i.lng,i.lat):hn.convert(i),this}setSouthWest(i){return this._sw=i instanceof hn?new hn(i.lng,i.lat):hn.convert(i),this}extend(i){const l=this._sw,h=this._ne;let f,g;if(i instanceof hn)f=i,g=i;else{if(!(i instanceof ql))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ql.convert(i)):this.extend(hn.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&i.hasOwnProperty("lon")?this.extend(hn.convert(i)):this;if(f=i._sw,g=i._ne,!f||!g)return this}return l||h?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),h.lng=Math.max(g.lng,h.lng),h.lat=Math.max(g.lat,h.lat)):(this._sw=new hn(f.lng,f.lat),this._ne=new hn(g.lng,g.lat)),this}getCenter(){return new hn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new hn(this.getWest(),this.getNorth())}getSouthEast(){return new hn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:l,lat:h}=hn.convert(i);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(i){return!i||i instanceof ql?i:new ql(i)}}var hy=1e-6,hs=typeof Float32Array<"u"?Float32Array:Array;function C2(){var a=new hs(9);return hs!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function M2(a,i,l){var h=i[0],f=i[1],g=i[2],y=i[3],b=i[4],E=i[5],S=i[6],M=i[7],R=i[8],k=l[0],z=l[1],N=l[2],V=l[3],Y=l[4],ce=l[5],ge=l[6],ae=l[7],me=l[8];return a[0]=k*h+z*y+N*S,a[1]=k*f+z*b+N*M,a[2]=k*g+z*E+N*R,a[3]=V*h+Y*y+ce*S,a[4]=V*f+Y*b+ce*M,a[5]=V*g+Y*E+ce*R,a[6]=ge*h+ae*y+me*S,a[7]=ge*f+ae*b+me*M,a[8]=ge*g+ae*E+me*R,a}function Lo(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function a1(a,i){var l=i[0],h=i[1],f=i[2],g=i[3],y=i[4],b=i[5],E=i[6],S=i[7],M=i[8],R=i[9],k=i[10],z=i[11],N=i[12],V=i[13],Y=i[14],ce=i[15],ge=l*b-h*y,ae=l*E-f*y,me=l*S-g*y,ve=h*E-f*b,_e=h*S-g*b,De=f*S-g*E,ke=M*V-R*N,$e=M*Y-k*N,nt=M*ce-z*N,Be=R*Y-k*V,He=R*ce-z*V,qe=k*ce-z*Y,Je=ge*qe-ae*He+me*Be+ve*nt-_e*$e+De*ke;return Je?(a[0]=(b*qe-E*He+S*Be)*(Je=1/Je),a[1]=(f*He-h*qe-g*Be)*Je,a[2]=(V*De-Y*_e+ce*ve)*Je,a[3]=(k*_e-R*De-z*ve)*Je,a[4]=(E*nt-y*qe-S*$e)*Je,a[5]=(l*qe-f*nt+g*$e)*Je,a[6]=(Y*me-N*De-ce*ae)*Je,a[7]=(M*De-k*me+z*ae)*Je,a[8]=(y*He-b*nt+S*ke)*Je,a[9]=(h*nt-l*He-g*ke)*Je,a[10]=(N*_e-V*me+ce*ge)*Je,a[11]=(R*me-M*_e-z*ge)*Je,a[12]=(b*$e-y*Be-E*ke)*Je,a[13]=(l*Be-h*$e+f*ke)*Je,a[14]=(V*ae-N*ve-Y*ge)*Je,a[15]=(M*ve-R*ae+k*ge)*Je,a):null}function Tu(a,i,l){var h=i[0],f=i[1],g=i[2],y=i[3],b=i[4],E=i[5],S=i[6],M=i[7],R=i[8],k=i[9],z=i[10],N=i[11],V=i[12],Y=i[13],ce=i[14],ge=i[15],ae=l[0],me=l[1],ve=l[2],_e=l[3];return a[0]=ae*h+me*b+ve*R+_e*V,a[1]=ae*f+me*E+ve*k+_e*Y,a[2]=ae*g+me*S+ve*z+_e*ce,a[3]=ae*y+me*M+ve*N+_e*ge,a[4]=(ae=l[4])*h+(me=l[5])*b+(ve=l[6])*R+(_e=l[7])*V,a[5]=ae*f+me*E+ve*k+_e*Y,a[6]=ae*g+me*S+ve*z+_e*ce,a[7]=ae*y+me*M+ve*N+_e*ge,a[8]=(ae=l[8])*h+(me=l[9])*b+(ve=l[10])*R+(_e=l[11])*V,a[9]=ae*f+me*E+ve*k+_e*Y,a[10]=ae*g+me*S+ve*z+_e*ce,a[11]=ae*y+me*M+ve*N+_e*ge,a[12]=(ae=l[12])*h+(me=l[13])*b+(ve=l[14])*R+(_e=l[15])*V,a[13]=ae*f+me*E+ve*k+_e*Y,a[14]=ae*g+me*S+ve*z+_e*ce,a[15]=ae*y+me*M+ve*N+_e*ge,a}function Rp(a,i,l){var h,f,g,y,b,E,S,M,R,k,z,N,V=l[0],Y=l[1],ce=l[2];return i===a?(a[12]=i[0]*V+i[4]*Y+i[8]*ce+i[12],a[13]=i[1]*V+i[5]*Y+i[9]*ce+i[13],a[14]=i[2]*V+i[6]*Y+i[10]*ce+i[14],a[15]=i[3]*V+i[7]*Y+i[11]*ce+i[15]):(f=i[1],g=i[2],y=i[3],b=i[4],E=i[5],S=i[6],M=i[7],R=i[8],k=i[9],z=i[10],N=i[11],a[0]=h=i[0],a[1]=f,a[2]=g,a[3]=y,a[4]=b,a[5]=E,a[6]=S,a[7]=M,a[8]=R,a[9]=k,a[10]=z,a[11]=N,a[12]=h*V+b*Y+R*ce+i[12],a[13]=f*V+E*Y+k*ce+i[13],a[14]=g*V+S*Y+z*ce+i[14],a[15]=y*V+M*Y+N*ce+i[15]),a}function Su(a,i,l){var h=l[0],f=l[1],g=l[2];return a[0]=i[0]*h,a[1]=i[1]*h,a[2]=i[2]*h,a[3]=i[3]*h,a[4]=i[4]*f,a[5]=i[5]*f,a[6]=i[6]*f,a[7]=i[7]*f,a[8]=i[8]*g,a[9]=i[9]*g,a[10]=i[10]*g,a[11]=i[11]*g,a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15],a}function l1(a,i,l){var h=Math.sin(l),f=Math.cos(l),g=i[4],y=i[5],b=i[6],E=i[7],S=i[8],M=i[9],R=i[10],k=i[11];return i!==a&&(a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[3],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[4]=g*f+S*h,a[5]=y*f+M*h,a[6]=b*f+R*h,a[7]=E*f+k*h,a[8]=S*f-g*h,a[9]=M*f-y*h,a[10]=R*f-b*h,a[11]=k*f-E*h,a}function dy(a,i,l){var h=Math.sin(l),f=Math.cos(l),g=i[0],y=i[1],b=i[2],E=i[3],S=i[8],M=i[9],R=i[10],k=i[11];return i!==a&&(a[4]=i[4],a[5]=i[5],a[6]=i[6],a[7]=i[7],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=g*f-S*h,a[1]=y*f-M*h,a[2]=b*f-R*h,a[3]=E*f-k*h,a[8]=g*h+S*f,a[9]=y*h+M*f,a[10]=b*h+R*f,a[11]=E*h+k*f,a}function P2(a,i){return a[0]=i[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=i[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=i[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function I2(a,i,l){var h,f,g,y=l[0],b=l[1],E=l[2],S=Math.hypot(y,b,E);return S<hy?null:(y*=S=1/S,b*=S,E*=S,h=Math.sin(i),f=Math.cos(i),a[0]=y*y*(g=1-f)+f,a[1]=b*y*g+E*h,a[2]=E*y*g-b*h,a[3]=0,a[4]=y*b*g-E*h,a[5]=b*b*g+f,a[6]=E*b*g+y*h,a[7]=0,a[8]=y*E*g+b*h,a[9]=b*E*g-y*h,a[10]=E*E*g+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,i=arguments.length;i--;)a+=arguments[i]*arguments[i];return Math.sqrt(a)});var oN=Tu;function c1(){var a=new hs(3);return hs!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function R2(a){var i=new hs(3);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i}function kp(a){return Math.hypot(a[0],a[1],a[2])}function td(a,i,l){var h=new hs(3);return h[0]=a,h[1]=i,h[2]=l,h}function Ja(a,i,l){return a[0]=i[0]+l[0],a[1]=i[1]+l[1],a[2]=i[2]+l[2],a}function u1(a,i,l){return a[0]=i[0]-l[0],a[1]=i[1]-l[1],a[2]=i[2]-l[2],a}function k2(a,i,l){return a[0]=i[0]*l[0],a[1]=i[1]*l[1],a[2]=i[2]*l[2],a}function Lp(a,i,l){return a[0]=Math.min(i[0],l[0]),a[1]=Math.min(i[1],l[1]),a[2]=Math.min(i[2],l[2]),a}function Op(a,i,l){return a[0]=Math.max(i[0],l[0]),a[1]=Math.max(i[1],l[1]),a[2]=Math.max(i[2],l[2]),a}function Cs(a,i,l){return a[0]=i[0]*l,a[1]=i[1]*l,a[2]=i[2]*l,a}function Dp(a,i,l,h){return a[0]=i[0]+l[0]*h,a[1]=i[1]+l[1]*h,a[2]=i[2]+l[2]*h,a}function Li(a,i){var l=i[0],h=i[1],f=i[2],g=l*l+h*h+f*f;return g>0&&(g=1/Math.sqrt(g)),a[0]=i[0]*g,a[1]=i[1]*g,a[2]=i[2]*g,a}function Js(a,i){return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]}function h1(a,i,l){var h=i[0],f=i[1],g=i[2],y=l[0],b=l[1],E=l[2];return a[0]=f*E-g*b,a[1]=g*y-h*E,a[2]=h*b-f*y,a}function mr(a,i,l){var h=i[0],f=i[1],g=i[2],y=l[3]*h+l[7]*f+l[11]*g+l[15];return a[0]=(l[0]*h+l[4]*f+l[8]*g+l[12])/(y=y||1),a[1]=(l[1]*h+l[5]*f+l[9]*g+l[13])/y,a[2]=(l[2]*h+l[6]*f+l[10]*g+l[14])/y,a}function L2(a,i,l){var h=l[0],f=l[1],g=l[2],y=i[0],b=i[1],E=i[2],S=f*E-g*b,M=g*y-h*E,R=h*b-f*y,k=f*R-g*M,z=g*S-h*R,N=h*M-f*S,V=2*l[3];return M*=V,R*=V,z*=2,N*=2,a[0]=y+(S*=V)+(k*=2),a[1]=b+M+z,a[2]=E+R+N,a}var zp,Oo=u1,aN=k2,lN=kp;function O2(a,i,l){return a[0]=i[0]*l,a[1]=i[1]*l,a[2]=i[2]*l,a[3]=i[3]*l,a}function D2(a,i){var l=i[0],h=i[1],f=i[2],g=i[3],y=l*l+h*h+f*f+g*g;return y>0&&(y=1/Math.sqrt(y)),a[0]=l*y,a[1]=h*y,a[2]=f*y,a[3]=g*y,a}function Au(a,i,l){var h=i[0],f=i[1],g=i[2],y=i[3];return a[0]=l[0]*h+l[4]*f+l[8]*g+l[12]*y,a[1]=l[1]*h+l[5]*f+l[9]*g+l[13]*y,a[2]=l[2]*h+l[6]*f+l[10]*g+l[14]*y,a[3]=l[3]*h+l[7]*f+l[11]*g+l[15]*y,a}function z2(){var a=new hs(4);return hs!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function F2(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function N2(a,i,l){l*=.5;var h=i[0],f=i[1],g=i[2],y=i[3],b=Math.sin(l),E=Math.cos(l);return a[0]=h*E+y*b,a[1]=f*E+g*b,a[2]=g*E-f*b,a[3]=y*E-h*b,a}function B2(a,i,l){l*=.5;var h=i[0],f=i[1],g=i[2],y=i[3],b=Math.sin(l),E=Math.cos(l);return a[0]=h*E-g*b,a[1]=f*E+y*b,a[2]=g*E+h*b,a[3]=y*E-f*b,a}c1(),zp=new hs(4),hs!=Float32Array&&(zp[0]=0,zp[1]=0,zp[2]=0,zp[3]=0);var cN=D2;c1(),td(1,0,0),td(0,1,0),z2(),z2(),C2();const uN=Mt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:U2}=uN,V2=Mt([{name:"a_pos_3",components:3,type:"Int16"}]);var Fp=Mt([{name:"a_pos",type:"Int16",components:2}]);class d1{constructor(i,l){this.pos=i,this.dir=l}intersectsPlane(i,l,h){const f=Js(l,this.dir);if(Math.abs(f)<1e-6)return!1;const g=((i[0]-this.pos[0])*l[0]+(i[1]-this.pos[1])*l[1]+(i[2]-this.pos[2])*l[2])/f;return h[0]=this.pos[0]+this.dir[0]*g,h[1]=this.pos[1]+this.dir[1]*g,h[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(i,l,h){if(function(z,N){var V=z[0],Y=z[1],ce=z[2],ge=N[0],ae=N[1],me=N[2];return Math.abs(V-ge)<=hy*Math.max(1,Math.abs(V),Math.abs(ge))&&Math.abs(Y-ae)<=hy*Math.max(1,Math.abs(Y),Math.abs(ae))&&Math.abs(ce-me)<=hy*Math.max(1,Math.abs(ce),Math.abs(me))}(this.pos,i)||l===0)return h[0]=h[1]=h[2]=0,!1;const[f,g,y]=this.dir,b=this.pos[0]-i[0],E=this.pos[1]-i[1],S=this.pos[2]-i[2],M=f*f+g*g+y*y,R=2*(b*f+E*g+S*y),k=R*R-4*M*(b*b+E*E+S*S-l*l);if(k<0){const z=Math.max(-R/2,0),N=b+f*z,V=E+g*z,Y=S+y*z,ce=Math.hypot(N,V,Y);return h[0]=N*l/ce,h[1]=V*l/ce,h[2]=Y*l/ce,!1}{const z=(-R-Math.sqrt(k))/(2*M);if(z<0){const N=Math.hypot(b,E,S);return h[0]=b*l/N,h[1]=E*l/N,h[2]=S*l/N,!1}return h[0]=b+f*z,h[1]=E+g*z,h[2]=S+y*z,!0}}}class f1{constructor(i,l,h,f,g){this.TL=i,this.TR=l,this.BR=h,this.BL=f,this.horizon=g}static fromInvProjectionMatrix(i,l,h){const f=[-1,1,1],g=[1,1,1],y=[1,-1,1],b=[-1,-1,1],E=mr(f,f,i),S=mr(g,g,i),M=mr(y,y,i),R=mr(b,b,i);return new f1(E,S,M,R,l/h)}}class p1{constructor(i,l){this.points=i,this.planes=l}static fromInvProjectionMatrix(i,l,h,f){const g=Math.pow(2,h),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const S=Au([],E,i),M=1/S[3]/l*g;return function(R,k,z){return R[0]=k[0]*z[0],R[1]=k[1]*z[1],R[2]=k[2]*z[2],R[3]=k[3]*z[3],R}(S,S,[M,M,f?1/S[3]:M,M])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const S=Li([],h1([],Oo([],y[E[0]],y[E[1]]),Oo([],y[E[2]],y[E[1]]))),M=-Js(S,y[E[1]]);return S.concat(M)});return new p1(y,b)}}class Oi{static fromPoints(i){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const f of i)Lp(l,l,f),Op(h,h,f);return new Oi(l,h)}static applyTransform(i,l){const h=i.getCorners();for(let f=0;f<h.length;++f)mr(h[f],h[f],l);return Oi.fromPoints(h)}constructor(i,l){this.min=i,this.max=l,this.center=Cs([],Ja([],this.min,this.max),.5)}quadrant(i){const l=[i%2==0,i<2],h=R2(this.min),f=R2(this.max);for(let g=0;g<l.length;g++)h[g]=l[g]?this.min[g]:this.center[g],f[g]=l[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new Oi(h,f)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,l=this.max;return[[i[0],i[1],i[2]],[l[0],i[1],i[2]],[l[0],l[1],i[2]],[i[0],l[1],i[2]],[i[0],i[1],l[2]],[l[0],i[1],l[2]],[l[0],l[1],l[2]],[i[0],l[1],l[2]]]}intersects(i){const l=this.getCorners();let h=!0;for(let f=0;f<i.planes.length;f++){const g=i.planes[f];let y=0;for(let b=0;b<l.length;b++)y+=Js(g,l[b])+g[3]>=0;if(y===0)return 0;y!==l.length&&(h=!1)}if(h)return 2;for(let f=0;f<3;f++){let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<i.points.length;b++){const E=i.points[b][f]-this.min[f];g=Math.min(g,E),y=Math.max(y,E)}if(y<0||g>this.max[f]-this.min[f])return 0}return 1}}const ma=Ut/Math.PI/2,Cu=64,Np=[Cu,32,16],Qs=-ma,eo=ma,hN=[new Oi([Qs,Qs,Qs],[eo,eo,eo]),new Oi([Qs,Qs,Qs],[0,0,eo]),new Oi([0,Qs,Qs],[eo,0,eo]),new Oi([Qs,0,Qs],[0,eo,eo]),new Oi([0,0,Qs],[eo,eo,eo])];function fy(a){return a*ma/Vp}function j2(a,i,l,h=!0){const f=Cs([],a._camera.position,a.worldSize),g=[i,l,1,1];Au(g,g,a.pixelMatrixInverse),O2(g,g,1/g[3]);const y=Li([],Oo([],g,f)),b=a.globeMatrix,E=[b[12],b[13],b[14]],S=Oo([],E,f),M=kp(S),R=Li([],S),k=a.worldSize/(2*Math.PI),z=Js(R,y),N=Math.asin(k/M);if(N<Math.acos(z)){if(!h)return null;const nt=[],Be=[];Cs(nt,y,M/z),Li(Be,Oo(Be,nt,S)),Li(y,Ja(y,S,Cs(y,Be,Math.tan(N)*M)))}const V=[];new d1(f,y).closestPointOnSphere(E,k,V);const Y=Li([],is(b,0)),ce=Li([],is(b,1)),ge=Li([],is(b,2)),ae=Js(Y,V),me=Js(ce,V),ve=Js(ge,V),_e=ht(Math.asin(-me/k));let De=ht(Math.atan2(ae,ve));De=a.center.lng+function(nt,Be){const He=(Be-nt+180)%360-180;return He<-180?He+360:He}(a.center.lng,De);const ke=_a(De),$e=jt(ya(_e),0,1);return new sd(ke,$e)}class dN{constructor(i,l,h){this.a=Oo([],i,h),this.b=Oo([],l,h),this.center=h;const f=Li([],this.a),g=Li([],this.b);this.angle=Math.acos(Js(f,g))}}function m1(a,i){if(a.angle===0)return null;let l;return l=a.a[i]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[i]/a.a[i]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(h,f,g,y){const b=Math.sin(g);return h*(Math.sin((1-y)*g)/b)+f*(Math.sin(y*g)/b)}(a.a[i],a.b[i],a.angle,jt(l,0,1))+a.center[i]}function ga(a){if(a.z<=1)return hN[a.z+2*a.y+a.x];const i=g1(py(a));return Oi.fromPoints(i)}function Mu(a,i,l){return Cs(a,a,1-l),Dp(a,a,i,l)}function G2(a,i){const l=id(i.zoom);if(l===0)return ga(a);const h=py(a),f=g1(h),g=_a(h.getWest())*i.worldSize,y=_a(h.getEast())*i.worldSize,b=ya(h.getNorth())*i.worldSize,E=ya(h.getSouth())*i.worldSize,S=[g,b,0],M=[y,b,0],R=[g,E,0],k=[y,E,0],z=a1([],i.globeMatrix);return mr(S,S,z),mr(M,M,z),mr(R,R,z),mr(k,k,z),f[0]=Mu(f[0],R,l),f[1]=Mu(f[1],k,l),f[2]=Mu(f[2],M,l),f[3]=Mu(f[3],S,l),Oi.fromPoints(f)}function W2(a,i,l){for(const h of a)mr(h,h,i),Cs(h,h,l)}function fN(a,i,l){const h=i/a.worldSize,f=a.globeMatrix;if(l.z<=1){const ke=ga(l).getCorners();return W2(ke,f,h),Oi.fromPoints(ke)}const g=py(l),y=g1(g);W2(y,f,h);const b=Number.MAX_VALUE,E=[-b,-b,-b],S=[b,b,b];if(g.contains(a.center)){for(const nt of y)Lp(S,S,nt),Op(E,E,nt);E[2]=0;const ke=a.point,$e=[ke.x*h,ke.y*h,0];return Lp(S,S,$e),Op(E,E,$e),new Oi(S,E)}const M=[f[12]*h,f[13]*h,f[14]*h],R=g.getCenter(),k=jt(a.center.lat,-fi,fi),z=jt(R.lat,-fi,fi),N=_a(a.center.lng),V=ya(k);let Y=N-_a(R.lng);const ce=V-ya(z);Y>.5?Y-=1:Y<-.5&&(Y+=1);let ge=0;Math.abs(Y)>Math.abs(ce)?ge=Y>=0?1:3:(ge=ce>=0?0:2,Dp(M,M,[f[4]*h,f[5]*h,f[6]*h],-Math.sin(rt(ce>=0?g.getSouth():g.getNorth()))*ma));const ae=y[ge],me=y[(ge+1)%4],ve=new dN(ae,me,M),_e=[m1(ve,0)||ae[0],m1(ve,1)||ae[1],m1(ve,2)||ae[2]],De=id(a.zoom);if(De>0){const ke=function({x:nt,y:Be,z:He},qe,Je,it,Ve){const ct=1/(1<<He);let zt=nt*ct,pt=zt+ct,bt=Be*ct,ut=bt+ct,Ft=0;const rn=(zt+pt)/2-it;return rn>.5?Ft=-1:rn<-.5&&(Ft=1),zt=((zt+Ft)*qe-(it*=qe))*Je+it,pt=((pt+Ft)*qe-it)*Je+it,bt=(bt*qe-(Ve*=qe))*Je+Ve,ut=(ut*qe-Ve)*Je+Ve,[[zt,ut,0],[pt,ut,0],[pt,bt,0],[zt,bt,0]]}(l,i,a._pixelsPerMercatorPixel,N,V);for(let nt=0;nt<y.length;nt++)Mu(y[nt],ke[nt],De);const $e=Ja([],ke[ge],ke[(ge+1)%4]);Cs($e,$e,.5),Mu(_e,$e,De)}for(const ke of y)Lp(S,S,ke),Op(E,E,ke);return S[2]=Math.min(ae[2],me[2]),Lp(S,S,_e),Op(E,E,_e),new Oi(S,E)}function py({x:a,y:i,z:l}){const h=1/(1<<l),f=new hn(Ms(a*h),di((i+1)*h)),g=new hn(Ms((a+1)*h),di(i*h));return new ql(f,g)}function g1(a){const i=rt(a.getNorth()),l=rt(a.getSouth()),h=Math.cos(i),f=Math.cos(l),g=Math.sin(i),y=Math.sin(l),b=a.getWest(),E=a.getEast();return[nd(f,y,b),nd(f,y,E),nd(h,g,E),nd(h,g,b)]}function nd(a,i,l,h=ma){return l=rt(l),[a*Math.sin(l)*h,-i*h,a*Math.cos(l)*h]}function rd(a,i,l){return nd(Math.cos(rt(a)),Math.sin(rt(a)),i,l)}function Bp(a,i,l,h){const f=1<<l.z,g=(a/Ut+l.x)/f;return rd(di((i/Ut+l.y)/f),Ms(g),h)}function my({min:a,max:i}){return 16383/Math.max(i[0]-a[0],i[1]-a[1],i[2]-a[2])}const $2=new Float64Array(16);function Up(a){const i=my(a),l=P2($2,[i,i,i]);return Rp(l,l,((h=[])[0]=-(f=a.min)[0],h[1]=-f[1],h[2]=-f[2],h));var h,f}function _1(a){const i=(h=a.min,(l=$2)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const f=1/my(a);return Su(i,i,[f,f,f])}function H2(a,i,l,h,f){const g=function(E){const S=Ut/(2*Math.PI);return E/(2*Math.PI)/S}(l),y=[a,i,-l/(2*Math.PI)],b=Lo(new Float64Array(16));return Rp(b,b,y),Su(b,b,[g,g,g]),l1(b,b,rt(-f)),dy(b,b,rt(-h)),b}function id(a){return ts(5,6,a)}function Z2(a,i){const l=rd(i.lat,i.lng),h=function(N){const V=rd(N._center.lat,N._center.lng);let Y=h1([],td(0,1,0),V);const ce=I2([],-N.angle,V);Y=mr(Y,Y,ce),I2(ce,-N._pitch,Y);const ge=Li([],V);return Cs(ge,ge,fy(N.cameraToCenterDistance/N.pixelsPerMeter)),mr(ge,ge,ce),Ja([],V,ge)}(a);return y=(f=u1([],h,l))[0],b=f[1],E=f[2],S=(g=l)[0],M=g[1],R=g[2],z=(k=Math.sqrt(y*y+b*b+E*E)*Math.sqrt(S*S+M*M+R*R))&&Js(f,g)/k,Math.acos(Math.min(Math.max(z,-1),1));var f,g,y,b,E,S,M,R,k,z}function y1(a,i){return Z2(a,i)>Math.PI/2*1.01}const q2=rt(85),pN=Math.cos(q2),mN=Math.sin(q2),Vp=63710088e-1,X2=2*Math.PI*Vp;class hn{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new hn(Ci(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,h=this.lat*l,f=i.lat*l,g=Math.sin(h)*Math.sin(f)+Math.cos(h)*Math.cos(f)*Math.cos((i.lng-this.lng)*l);return Vp*Math.acos(Math.min(g,1))}toBounds(i=0){const l=360*i/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new ql(new hn(this.lng-h,this.lat-l),new hn(this.lng+h,this.lat+l))}toEcef(i){const l=fy(i);return rd(this.lat,this.lng,ma+l)}static convert(i){if(i instanceof hn)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new hn(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new hn(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function v1(a){return X2*Math.cos(a*Math.PI/180)}function _a(a){return(180+a)/360}function ya(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Do(a,i){return a/v1(i)}function Ms(a){return 360*a-180}function di(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Y2(a,i){return a*v1(di(i))}const fi=85.051129;function K2(a){return 1/Math.cos(a*Math.PI/180)}class sd{constructor(i,l,h=0){this.x=+i,this.y=+l,this.z=+h}static fromLngLat(i,l=0){const h=hn.convert(i);return new sd(_a(h.lng),ya(h.lat),Do(l,h.lat))}toLngLat(){return new hn(Ms(this.x),di(this.y))}toAltitude(){return Y2(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/X2*K2(di(this.y))}}function x1(a,i,l,h,f,g,y,b,E){const S=(i+h)/2,M=(l+f)/2,R=new ue(S,M);b(R),function(k,z,N,V,Y,ce){const ge=N-Y,ae=V-ce;return Math.abs((V-z)*ge-(N-k)*ae)/Math.hypot(ge,ae)}(R.x,R.y,g.x,g.y,y.x,y.y)>=E?(x1(a,i,l,S,M,g,R,b,E),x1(a,S,M,h,f,R,y,b,E)):a.push(y)}function J2(a,i,l){let h=a[0],f=h.x,g=h.y;i(h);const y=[h];for(let b=1;b<a.length;b++){const E=a[b],{x:S,y:M}=E;i(E),x1(y,f,g,S,M,h,E,i,l),f=S,g=M,h=E}return y}function b1(a,i,l,h){if(h(i,l)){const f=i.add(l)._mult(.5);b1(a,i,f,h),b1(a,f,l,h)}else a.push(l)}function gN(a,i){let l=a[0];const h=[l];for(let f=1;f<a.length;f++){const g=a[f];b1(h,l,g,i),l=g}return h}const w1=Math.pow(2,14)-1,Q2=-w1-1;function _N(a,i){const l=Math.round(a.x*i),h=Math.round(a.y*i);return a.x=jt(l,Q2,w1),a.y=jt(h,Q2,w1),(l<a.x||l>a.x+1||h<a.y||h>a.y+1)&&Vn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Qa(a,i,l){const h=a.loadGeometry(),f=a.extent,g=Ut/f;if(i&&l&&l.projection.isReprojectedInTileSpace){const y=1<<i.z,{scale:b,x:E,y:S,projection:M}=l,R=k=>{const z=Ms((i.x+k.x/f)/y),N=di((i.y+k.y/f)/y),V=M.project(z,N);k.x=(V.x*b-E)*f,k.y=(V.y*b-S)*f};for(let k=0;k<h.length;k++)if(a.type!==1)h[k]=J2(h[k],R,1);else{const z=[];for(const N of h[k])N.x<0||N.x>=f||N.y<0||N.y>=f||(R(N),z.push(N));h[k]=z}}for(const y of h)for(const b of y)_N(b,g);return h}function Pu(a,i){return{type:a.type,id:a.id,properties:a.properties,geometry:i?Qa(a):[]}}function gy(a,i,l,h,f){a.emplaceBack(2*i+(h+1)/2,2*l+(f+1)/2)}function _y(a,i,l){a.emplaceBack(i.x,i.y,i.z,l[0]*16384,l[1]*16384,l[2]*16384)}class E1{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new It,this.indexArray=new hi,this.segments=new br,this.programConfigurations=new Eu(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h,f){const g=this.layers[0],y=[];let b=null;g.type==="circle"&&(b=g.layout.get("circle-sort-key"));for(const{feature:S,id:M,index:R,sourceLayerIndex:k}of i){const z=this.layers[0]._featureFilter.needGeometry,N=Pu(S,z);if(!this.layers[0]._featureFilter.filter(new Pe(this.zoom),N,h))continue;const V=b?b.evaluate(N,{},h):void 0,Y={id:M,properties:S.properties,type:S.type,sourceLayerIndex:k,index:R,geometry:z?N.geometry:Qa(S,h,f),patterns:{},sortKey:V};y.push(Y)}b&&y.sort((S,M)=>S.sortKey-M.sortKey);let E=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new As,E=f.projection);for(const S of y){const{geometry:M,index:R,sourceLayerIndex:k}=S,z=i[R].feature;this.addFeature(S,M,R,l.availableImages,h,E),l.featureIndex.insert(z,M,R,k,this.index)}}update(i,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,iN.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,sN.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,l,h,f,g,y){for(const b of l)for(const E of b){const S=E.x,M=E.y;if(S<0||S>=Ut||M<0||M>=Ut)continue;if(y){const z=y.projectTilePoint(S,M,g),N=y.upVector(g,S,M),V=this.globeExtVertexArray;_y(V,z,N),_y(V,z,N),_y(V,z,N),_y(V,z,N)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),k=R.vertexLength;gy(this.layoutVertexArray,S,M,-1,-1),gy(this.layoutVertexArray,S,M,1,-1),gy(this.layoutVertexArray,S,M,1,1),gy(this.layoutVertexArray,S,M,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},f,g)}}function eA(a,i){for(let l=0;l<a.length;l++)if(Iu(i,a[l]))return!0;for(let l=0;l<i.length;l++)if(Iu(a,i[l]))return!0;return!!T1(a,i)}function yN(a,i,l){return!!Iu(a,i)||!!S1(i,a,l)}function tA(a,i){if(a.length===1)return rA(i,a[0]);for(let l=0;l<i.length;l++){const h=i[l];for(let f=0;f<h.length;f++)if(Iu(a,h[f]))return!0}for(let l=0;l<a.length;l++)if(rA(i,a[l]))return!0;for(let l=0;l<i.length;l++)if(T1(a,i[l]))return!0;return!1}function vN(a,i,l){if(a.length>1){if(T1(a,i))return!0;for(let h=0;h<i.length;h++)if(S1(i[h],a,l))return!0}for(let h=0;h<a.length;h++)if(S1(a[h],i,l))return!0;return!1}function T1(a,i){if(a.length===0||i.length===0)return!1;for(let l=0;l<a.length-1;l++){const h=a[l],f=a[l+1];for(let g=0;g<i.length-1;g++)if(xN(h,f,i[g],i[g+1]))return!0}return!1}function xN(a,i,l,h){return qr(a,l,h)!==qr(i,l,h)&&qr(a,i,l)!==qr(a,i,h)}function S1(a,i,l){const h=l*l;if(i.length===1)return a.distSqr(i[0])<h;for(let f=1;f<i.length;f++)if(nA(a,i[f-1],i[f])<h)return!0;return!1}function nA(a,i,l){const h=i.distSqr(l);if(h===0)return a.distSqr(i);const f=((a.x-i.x)*(l.x-i.x)+(a.y-i.y)*(l.y-i.y))/h;return a.distSqr(f<0?i:f>1?l:l.sub(i)._mult(f)._add(i))}function rA(a,i){let l,h,f,g=!1;for(let y=0;y<a.length;y++){l=a[y];for(let b=0,E=l.length-1;b<l.length;E=b++)h=l[b],f=l[E],h.y>i.y!=f.y>i.y&&i.x<(f.x-h.x)*(i.y-h.y)/(f.y-h.y)+h.x&&(g=!g)}return g}function Iu(a,i){let l=!1;for(let h=0,f=a.length-1;h<a.length;f=h++){const g=a[h],y=a[f];g.y>i.y!=y.y>i.y&&i.x<(y.x-g.x)*(i.y-g.y)/(y.y-g.y)+g.x&&(l=!l)}return l}function iA(a,i,l,h,f){for(const y of a)if(i<=y.x&&l<=y.y&&h>=y.x&&f>=y.y)return!0;const g=[new ue(i,l),new ue(i,f),new ue(h,f),new ue(h,l)];if(a.length>2){for(const y of g)if(Iu(a,y))return!0}for(let y=0;y<a.length-1;y++)if(bN(a[y],a[y+1],g))return!0;return!1}function bN(a,i,l){const h=l[0],f=l[2];if(a.x<h.x&&i.x<h.x||a.x>f.x&&i.x>f.x||a.y<h.y&&i.y<h.y||a.y>f.y&&i.y>f.y)return!1;const g=qr(a,i,l[0]);return g!==qr(a,i,l[1])||g!==qr(a,i,l[2])||g!==qr(a,i,l[3])}function od(a,i,l){const h=i.paint.get(a).value;return h.kind==="constant"?h.value:l.programConfigurations.get(i.id).getMaxValue(a)}function yy(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function sA(a,i,l,h,f){if(!i[0]&&!i[1])return a;const g=ue.convert(i)._mult(f);l==="viewport"&&g._rotate(-h);const y=[];for(let b=0;b<a.length;b++)y.push(a[b].sub(g));return y}function oA(a,i,l,h){const f=ue.convert(a)._mult(h);return i==="viewport"&&f._rotate(-l),f}yt(E1,"CircleBucket",{omit:["layers"]});const wN=new tt({"circle-sort-key":new Ne(je.layout_circle["circle-sort-key"])});var EN={paint:new tt({"circle-radius":new Ne(je.paint_circle["circle-radius"]),"circle-color":new Ne(je.paint_circle["circle-color"]),"circle-blur":new Ne(je.paint_circle["circle-blur"]),"circle-opacity":new Ne(je.paint_circle["circle-opacity"]),"circle-translate":new Ae(je.paint_circle["circle-translate"]),"circle-translate-anchor":new Ae(je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ae(je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ae(je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ne(je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ne(je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ne(je.paint_circle["circle-stroke-opacity"])}),layout:wN};function aA(a,i,l,h,f,g,y,b,E){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(E*=a.pixelToTileUnitsFactor);const S=a.tileID.canonical,M=l.projection.upVectorScale(S,l.center.lat,l.worldSize).metersToTile;for(const R of i)for(const k of R){const z=k.add(b),N=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(z.x,z.y,!0):0,V=l.projection.projectTilePoint(z.x,z.y,S);if(N>0){const ae=l.projection.upVector(S,z.x,z.y);V.x+=ae[0]*M*N,V.y+=ae[1]*M*N,V.z+=ae[2]*M*N}const Y=g?z:TN(V.x,V.y,V.z,h),ce=g?a.tilespaceRays.map(ae=>AN(ae,N)):a.queryGeometry.screenGeometry,ge=Au([],[V.x,V.y,V.z,1],h);if(!y&&g?E*=ge[3]/l.cameraToCenterDistance:y&&!g&&(E*=l.cameraToCenterDistance/ge[3]),g){const ae=di((k.y/Ut+S.y)/(1<<S.z));E/=l.projection.pixelsPerMeter(ae,1)/Do(1,ae)}if(yN(ce,Y,E))return!0}return!1}function TN(a,i,l,h){const f=Au([],[a,i,l,1],h);return new ue(f[0]/f[3],f[1]/f[3])}const lA=td(0,0,0),SN=td(0,0,1);function AN(a,i){const l=c1();return lA[2]=i,a.intersectsPlane(lA,SN,l),new ue(l[0],l[1])}class cA extends E1{}function uA(a,{width:i,height:l},h,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==i*l*h)throw new RangeError("mismatched image size")}else f=new Uint8Array(i*l*h);return a.width=i,a.height=l,a.data=f,a}function hA(a,i,l){const{width:h,height:f}=i;h===a.width&&f===a.height||(A1(a,i,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,h),height:Math.min(a.height,f)},l),a.width=h,a.height=f,a.data=i.data)}function A1(a,i,l,h,f,g){if(f.width===0||f.height===0)return i;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>i.width||f.height>i.height||h.x>i.width-f.width||h.y>i.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=a.data,b=i.data;for(let E=0;E<f.height;E++){const S=((l.y+E)*a.width+l.x)*g,M=((h.y+E)*i.width+h.x)*g;for(let R=0;R<f.width*g;R++)b[M+R]=y[S+R]}return i}yt(cA,"HeatmapBucket",{omit:["layers"]});class el{constructor(i,l){uA(this,i,1,l)}resize(i){hA(this,new el(i),1)}clone(){return new el({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,f,g){A1(i,l,h,f,g,1)}}class ds{constructor(i,l){uA(this,i,4,l)}resize(i){hA(this,new ds(i),4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,f,g){A1(i,l,h,f,g,4)}}yt(el,"AlphaImage"),yt(ds,"RGBAImage");var CN={paint:new tt({"heatmap-radius":new Ne(je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ne(je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ae(je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ye(je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ae(je.paint_heatmap["heatmap-opacity"])})};function C1(a){const i={},l=a.resolution||256,h=a.clips?a.clips.length:1,f=a.image||new ds({width:l,height:h}),g=(y,b,E)=>{i[a.evaluationKey]=E;const S=a.expression.evaluate(i);f.data[y+b+0]=Math.floor(255*S.r/S.a),f.data[y+b+1]=Math.floor(255*S.g/S.a),f.data[y+b+2]=Math.floor(255*S.b/S.a),f.data[y+b+3]=Math.floor(255*S.a)};if(a.clips)for(let y=0,b=0;y<h;++y,b+=4*l)for(let E=0,S=0;E<l;E++,S+=4){const M=E/(l-1),{start:R,end:k}=a.clips[y];g(b,S,R*(1-M)+k*M)}else for(let y=0,b=0;y<l;y++,b+=4)g(0,b,y/(l-1));return f}var MN={paint:new tt({"hillshade-illumination-direction":new Ae(je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ae(je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ae(je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ae(je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ae(je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ae(je.paint_hillshade["hillshade-accent-color"])})};const PN=Mt([{name:"a_pos",components:2,type:"Int16"}],4),{members:IN}=PN;var ad={};function vy(a,i,l){l=l||2;var h,f,g,y,b,E,S,M=i&&i.length,R=M?i[0]*l:a.length,k=dA(a,0,R,l,!0),z=[];if(!k||k.next===k.prev)return z;if(M&&(k=function(V,Y,ce,ge){var ae,me,ve,_e=[];for(ae=0,me=Y.length;ae<me;ae++)(ve=dA(V,Y[ae]*ge,ae<me-1?Y[ae+1]*ge:V.length,ge,!1))===ve.next&&(ve.steiner=!0),_e.push(NN(ve));for(_e.sort(DN),ae=0;ae<_e.length;ae++)ce=zN(_e[ae],ce);return ce}(a,i,k,l)),a.length>80*l){h=g=a[0],f=y=a[1];for(var N=l;N<R;N+=l)(b=a[N])<h&&(h=b),(E=a[N+1])<f&&(f=E),b>g&&(g=b),E>y&&(y=E);S=(S=Math.max(g-h,y-f))!==0?32767/S:0}return jp(k,z,l,h,f,S,0),z}function dA(a,i,l,h,f){var g,y;if(f===I1(a,i,l,h)>0)for(g=i;g<l;g+=h)y=mA(g,a[g],a[g+1],y);else for(g=l-h;g>=i;g-=h)y=mA(g,a[g],a[g+1],y);return y&&xy(y,y.next)&&(Wp(y),y=y.next),y}function Ru(a,i){if(!a)return a;i||(i=a);var l,h=a;do if(l=!1,h.steiner||!xy(h,h.next)&&wr(h.prev,h,h.next)!==0)h=h.next;else{if(Wp(h),(h=i=h.prev)===h.next)break;l=!0}while(l||h!==i);return i}function jp(a,i,l,h,f,g,y){if(a){!y&&g&&function(M,R,k,z){var N=M;do N.z===0&&(N.z=M1(N.x,N.y,R,k,z)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==M);N.prevZ.nextZ=null,N.prevZ=null,function(V){var Y,ce,ge,ae,me,ve,_e,De,ke=1;do{for(ce=V,V=null,me=null,ve=0;ce;){for(ve++,ge=ce,_e=0,Y=0;Y<ke&&(_e++,ge=ge.nextZ);Y++);for(De=ke;_e>0||De>0&&ge;)_e!==0&&(De===0||!ge||ce.z<=ge.z)?(ae=ce,ce=ce.nextZ,_e--):(ae=ge,ge=ge.nextZ,De--),me?me.nextZ=ae:V=ae,ae.prevZ=me,me=ae;ce=ge}me.nextZ=null,ke*=2}while(ve>1)}(N)}(a,h,f,g);for(var b,E,S=a;a.prev!==a.next;)if(b=a.prev,E=a.next,g?kN(a,h,f,g):RN(a))i.push(b.i/l|0),i.push(a.i/l|0),i.push(E.i/l|0),Wp(a),a=E.next,S=E.next;else if((a=E)===S){y?y===1?jp(a=LN(Ru(a),i,l),i,l,h,f,g,2):y===2&&ON(a,i,l,h,f,g):jp(Ru(a),i,l,h,f,g,1);break}}}function RN(a){var i=a.prev,l=a,h=a.next;if(wr(i,l,h)>=0)return!1;for(var f=i.x,g=l.x,y=h.x,b=i.y,E=l.y,S=h.y,M=f<g?f<y?f:y:g<y?g:y,R=b<E?b<S?b:S:E<S?E:S,k=f>g?f>y?f:y:g>y?g:y,z=b>E?b>S?b:S:E>S?E:S,N=h.next;N!==i;){if(N.x>=M&&N.x<=k&&N.y>=R&&N.y<=z&&ld(f,b,g,E,y,S,N.x,N.y)&&wr(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function kN(a,i,l,h){var f=a.prev,g=a,y=a.next;if(wr(f,g,y)>=0)return!1;for(var b=f.x,E=g.x,S=y.x,M=f.y,R=g.y,k=y.y,z=b<E?b<S?b:S:E<S?E:S,N=M<R?M<k?M:k:R<k?R:k,V=b>E?b>S?b:S:E>S?E:S,Y=M>R?M>k?M:k:R>k?R:k,ce=M1(z,N,i,l,h),ge=M1(V,Y,i,l,h),ae=a.prevZ,me=a.nextZ;ae&&ae.z>=ce&&me&&me.z<=ge;){if(ae.x>=z&&ae.x<=V&&ae.y>=N&&ae.y<=Y&&ae!==f&&ae!==y&&ld(b,M,E,R,S,k,ae.x,ae.y)&&wr(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,me.x>=z&&me.x<=V&&me.y>=N&&me.y<=Y&&me!==f&&me!==y&&ld(b,M,E,R,S,k,me.x,me.y)&&wr(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;ae&&ae.z>=ce;){if(ae.x>=z&&ae.x<=V&&ae.y>=N&&ae.y<=Y&&ae!==f&&ae!==y&&ld(b,M,E,R,S,k,ae.x,ae.y)&&wr(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;me&&me.z<=ge;){if(me.x>=z&&me.x<=V&&me.y>=N&&me.y<=Y&&me!==f&&me!==y&&ld(b,M,E,R,S,k,me.x,me.y)&&wr(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function LN(a,i,l){var h=a;do{var f=h.prev,g=h.next.next;!xy(f,g)&&fA(f,h,h.next,g)&&Gp(f,g)&&Gp(g,f)&&(i.push(f.i/l|0),i.push(h.i/l|0),i.push(g.i/l|0),Wp(h),Wp(h.next),h=a=g),h=h.next}while(h!==a);return Ru(h)}function ON(a,i,l,h,f,g){var y=a;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&BN(y,b)){var E=pA(y,b);return y=Ru(y,y.next),E=Ru(E,E.next),jp(y,i,l,h,f,g,0),void jp(E,i,l,h,f,g,0)}b=b.next}y=y.next}while(y!==a)}function DN(a,i){return a.x-i.x}function zN(a,i){var l=function(f,g){var y,b=g,E=f.x,S=f.y,M=-1/0;do{if(S<=b.y&&S>=b.next.y&&b.next.y!==b.y){var R=b.x+(S-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(R<=E&&R>M&&(M=R,y=b.x<b.next.x?b:b.next,R===E))return y}b=b.next}while(b!==g);if(!y)return null;var k,z=y,N=y.x,V=y.y,Y=1/0;b=y;do E>=b.x&&b.x>=N&&E!==b.x&&ld(S<V?E:M,S,N,V,S<V?M:E,S,b.x,b.y)&&(k=Math.abs(S-b.y)/(E-b.x),Gp(b,f)&&(k<Y||k===Y&&(b.x>y.x||b.x===y.x&&FN(y,b)))&&(y=b,Y=k)),b=b.next;while(b!==z);return y}(a,i);if(!l)return i;var h=pA(l,a);return Ru(h,h.next),Ru(l,l.next)}function FN(a,i){return wr(a.prev,a,i.prev)<0&&wr(i.next,a,a.next)<0}function M1(a,i,l,h,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*f|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function NN(a){var i=a,l=a;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==a);return l}function ld(a,i,l,h,f,g,y,b){return(f-y)*(i-b)>=(a-y)*(g-b)&&(a-y)*(h-b)>=(l-y)*(i-b)&&(l-y)*(g-b)>=(f-y)*(h-b)}function BN(a,i){return a.next.i!==i.i&&a.prev.i!==i.i&&!function(l,h){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==h.i&&f.next.i!==h.i&&fA(f,f.next,l,h))return!0;f=f.next}while(f!==l);return!1}(a,i)&&(Gp(a,i)&&Gp(i,a)&&function(l,h){var f=l,g=!1,y=(l.x+h.x)/2,b=(l.y+h.y)/2;do f.y>b!=f.next.y>b&&f.next.y!==f.y&&y<(f.next.x-f.x)*(b-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next;while(f!==l);return g}(a,i)&&(wr(a.prev,a,i.prev)||wr(a,i.prev,i))||xy(a,i)&&wr(a.prev,a,a.next)>0&&wr(i.prev,i,i.next)>0)}function wr(a,i,l){return(i.y-a.y)*(l.x-i.x)-(i.x-a.x)*(l.y-i.y)}function xy(a,i){return a.x===i.x&&a.y===i.y}function fA(a,i,l,h){var f=wy(wr(a,i,l)),g=wy(wr(a,i,h)),y=wy(wr(l,h,a)),b=wy(wr(l,h,i));return f!==g&&y!==b||!(f!==0||!by(a,l,i))||!(g!==0||!by(a,h,i))||!(y!==0||!by(l,a,h))||!(b!==0||!by(l,i,h))}function by(a,i,l){return i.x<=Math.max(a.x,l.x)&&i.x>=Math.min(a.x,l.x)&&i.y<=Math.max(a.y,l.y)&&i.y>=Math.min(a.y,l.y)}function wy(a){return a>0?1:a<0?-1:0}function Gp(a,i){return wr(a.prev,a,a.next)<0?wr(a,i,a.next)>=0&&wr(a,a.prev,i)>=0:wr(a,i,a.prev)<0||wr(a,a.next,i)<0}function pA(a,i){var l=new P1(a.i,a.x,a.y),h=new P1(i.i,i.x,i.y),f=a.next,g=i.prev;return a.next=i,i.prev=a,l.next=f,f.prev=l,h.next=l,l.prev=h,g.next=h,h.prev=g,h}function mA(a,i,l,h){var f=new P1(a,i,l);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function Wp(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function P1(a,i,l){this.i=a,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I1(a,i,l,h){for(var f=0,g=i,y=l-h;g<l;g+=h)f+=(a[y]-a[g])*(a[g+1]+a[y+1]),y=g;return f}function UN(a,i,l,h,f){gA(a,i,l||0,h||a.length-1,f||VN)}function gA(a,i,l,h,f){for(;h>l;){if(h-l>600){var g=h-l+1,y=i-l+1,b=Math.log(g),E=.5*Math.exp(2*b/3),S=.5*Math.sqrt(b*E*(g-E)/g)*(y-g/2<0?-1:1);gA(a,i,Math.max(l,Math.floor(i-y*E/g+S)),Math.min(h,Math.floor(i+(g-y)*E/g+S)),f)}var M=a[i],R=l,k=h;for($p(a,l,i),f(a[h],M)>0&&$p(a,l,h);R<k;){for($p(a,R,k),R++,k--;f(a[R],M)<0;)R++;for(;f(a[k],M)>0;)k--}f(a[l],M)===0?$p(a,l,k):$p(a,++k,h),k<=i&&(l=k+1),i<=k&&(h=k-1)}}function $p(a,i,l){var h=a[i];a[i]=a[l],a[l]=h}function VN(a,i){return a<i?-1:a>i?1:0}function R1(a,i){const l=a.length;if(l<=1)return[a];const h=[];let f,g;for(let y=0;y<l;y++){const b=on(a[y]);b!==0&&(a[y].area=Math.abs(b),g===void 0&&(g=b<0),g===b<0?(f&&h.push(f),f=[a[y]]):f.push(a[y]))}if(f&&h.push(f),i>1)for(let y=0;y<h.length;y++)h[y].length<=i||(UN(h[y],i,1,h[y].length-1,jN),h[y]=h[y].slice(0,i));return h}function jN(a,i){return i.area-a.area}function k1(a,i,l){const h=l.patternDependencies;let f=!1;for(const g of i){const y=g.paint.get(`${a}-pattern`);y.isConstant()||(f=!0);const b=y.constantOr(null);b&&(f=!0,h[b]=!0)}return f}function L1(a,i,l,h,f){const g=f.patternDependencies;for(const y of i){const b=y.paint.get(`${a}-pattern`).value;if(b.kind!=="constant"){let E=b.evaluate({zoom:h},l,{},f.availableImages);E=E&&E.name?E.name:E,g[E]=!0,l.patterns[y.id]=E}}return l}({get exports(){return ad},set exports(a){ad=a}}).exports=vy,ad.default=vy,vy.deviation=function(a,i,l,h){var f=i&&i.length,g=Math.abs(I1(a,0,f?i[0]*l:a.length,l));if(f)for(var y=0,b=i.length;y<b;y++)g-=Math.abs(I1(a,i[y]*l,y<b-1?i[y+1]*l:a.length,l));var E=0;for(y=0;y<h.length;y+=3){var S=h[y]*l,M=h[y+1]*l,R=h[y+2]*l;E+=Math.abs((a[S]-a[R])*(a[M+1]-a[S+1])-(a[S]-a[M])*(a[R+1]-a[S+1]))}return g===0&&E===0?0:Math.abs((E-g)/g)},vy.flatten=function(a){for(var i=a[0][0].length,l={vertices:[],holes:[],dimensions:i},h=0,f=0;f<a.length;f++){for(var g=0;g<a[f].length;g++)for(var y=0;y<i;y++)l.vertices.push(a[f][g][y]);f>0&&l.holes.push(h+=a[f-1].length)}return l};class Ey{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new It,this.indexArray=new hi,this.indexArray2=new fa,this.programConfigurations=new Eu(i.layers,i.zoom),this.segments=new br,this.segments2=new br,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=i.projection}populate(i,l,h,f){this.hasPattern=k1("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:E,index:S,sourceLayerIndex:M}of i){const R=this.layers[0]._featureFilter.needGeometry,k=Pu(b,R);if(!this.layers[0]._featureFilter.filter(new Pe(this.zoom),k,h))continue;const z=g?g.evaluate(k,{},h,l.availableImages):void 0,N={id:E,properties:b.properties,type:b.type,sourceLayerIndex:M,index:S,geometry:R?k.geometry:Qa(b,h,f),patterns:{},sortKey:z};y.push(N)}g&&y.sort((b,E)=>b.sortKey-E.sortKey);for(const b of y){const{geometry:E,index:S,sourceLayerIndex:M}=b;if(this.hasPattern){const R=L1("fill",this.layers,b,this.zoom,l);this.patternFeatures.push(R)}else this.addFeature(b,E,S,h,{},l.availableImages);l.featureIndex.insert(i[S].feature,E,S,M,this.index)}}update(i,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h,f)}addFeatures(i,l,h,f,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,l,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,IN),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,h,f,g,y=[]){for(const b of R1(l,500)){let E=0;for(const N of b)E+=N.length;const S=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),M=S.vertexLength,R=[],k=[];for(const N of b){if(N.length===0)continue;N!==b[0]&&k.push(R.length/2);const V=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),Y=V.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(Y+N.length-1,Y),R.push(N[0].x),R.push(N[0].y);for(let ce=1;ce<N.length;ce++)this.layoutVertexArray.emplaceBack(N[ce].x,N[ce].y),this.indexArray2.emplaceBack(Y+ce-1,Y+ce),R.push(N[ce].x),R.push(N[ce].y);V.vertexLength+=N.length,V.primitiveLength+=N.length}const z=ad(R,k);for(let N=0;N<z.length;N+=3)this.indexArray.emplaceBack(M+z[N],M+z[N+1],M+z[N+2]);S.vertexLength+=E,S.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,g,y,f)}}yt(Ey,"FillBucket",{omit:["layers","patternFeatures"]});const GN=new tt({"fill-sort-key":new Ne(je.layout_fill["fill-sort-key"])});var WN={paint:new tt({"fill-antialias":new Ae(je.paint_fill["fill-antialias"]),"fill-opacity":new Ne(je.paint_fill["fill-opacity"]),"fill-color":new Ne(je.paint_fill["fill-color"]),"fill-outline-color":new Ne(je.paint_fill["fill-outline-color"]),"fill-translate":new Ae(je.paint_fill["fill-translate"]),"fill-translate-anchor":new Ae(je.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ne(je.paint_fill["fill-pattern"])}),layout:GN};const $N=Mt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),HN=Mt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ZN=Mt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:qN}=$N;var Ty={},XN=ue,_A=cd;function cd(a,i,l,h,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=h,this._values=f,a.readFields(YN,this,i)}function YN(a,i,l){a==1?i.id=l.readVarint():a==2?function(h,f){for(var g=h.readVarint()+h.pos;h.pos<g;){var y=f._keys[h.readVarint()],b=f._values[h.readVarint()];f.properties[y]=b}}(l,i):a==3?i.type=l.readVarint():a==4&&(i._geometry=l.pos)}function KN(a){for(var i,l,h=0,f=0,g=a.length,y=g-1;f<g;y=f++)h+=((l=a[y]).x-(i=a[f]).x)*(i.y+l.y);return h}cd.types=["Unknown","Point","LineString","Polygon"],cd.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var i,l=a.readVarint()+a.pos,h=1,f=0,g=0,y=0,b=[];a.pos<l;){if(f<=0){var E=a.readVarint();h=7&E,f=E>>3}if(f--,h===1||h===2)g+=a.readSVarint(),y+=a.readSVarint(),h===1&&(i&&b.push(i),i=[]),i.push(new XN(g,y));else{if(h!==7)throw new Error("unknown command "+h);i&&i.push(i[0].clone())}}return i&&b.push(i),b},cd.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var i=a.readVarint()+a.pos,l=1,h=0,f=0,g=0,y=1/0,b=-1/0,E=1/0,S=-1/0;a.pos<i;){if(h<=0){var M=a.readVarint();l=7&M,h=M>>3}if(h--,l===1||l===2)(f+=a.readSVarint())<y&&(y=f),f>b&&(b=f),(g+=a.readSVarint())<E&&(E=g),g>S&&(S=g);else if(l!==7)throw new Error("unknown command "+l)}return[y,E,b,S]},cd.prototype.toGeoJSON=function(a,i,l){var h,f,g=this.extent*Math.pow(2,l),y=this.extent*a,b=this.extent*i,E=this.loadGeometry(),S=cd.types[this.type];function M(z){for(var N=0;N<z.length;N++){var V=z[N];z[N]=[360*(V.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+b)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(h=0;h<E.length;h++)R[h]=E[h][0];M(E=R);break;case 2:for(h=0;h<E.length;h++)M(E[h]);break;case 3:for(E=function(z){var N=z.length;if(N<=1)return[z];for(var V,Y,ce=[],ge=0;ge<N;ge++){var ae=KN(z[ge]);ae!==0&&(Y===void 0&&(Y=ae<0),Y===ae<0?(V&&ce.push(V),V=[z[ge]]):V.push(z[ge]))}return V&&ce.push(V),ce}(E),h=0;h<E.length;h++)for(f=0;f<E[h].length;f++)M(E[h][f])}E.length===1?E=E[0]:S="Multi"+S;var k={type:"Feature",geometry:{type:S,coordinates:E},properties:this.properties};return"id"in this&&(k.id=this.id),k};var JN=_A,yA=vA;function vA(a,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(QN,this,i),this.length=this._features.length}function QN(a,i,l){a===15?i.version=l.readVarint():a===1?i.name=l.readString():a===5?i.extent=l.readVarint():a===2?i._features.push(l.pos):a===3?i._keys.push(l.readString()):a===4&&i._values.push(function(h){for(var f=null,g=h.readVarint()+h.pos;h.pos<g;){var y=h.readVarint()>>3;f=y===1?h.readString():y===2?h.readFloat():y===3?h.readDouble():y===4?h.readVarint64():y===5?h.readVarint():y===6?h.readSVarint():y===7?h.readBoolean():null}return f}(l))}vA.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var i=this._pbf.readVarint()+this._pbf.pos;return new JN(this._pbf,i,this.extent,this._keys,this._values)};var eB=yA;function tB(a,i,l){if(a===3){var h=new eB(l,l.readVarint()+l.pos);h.length&&(i[h.name]=h)}}var O1=Ty.VectorTile=function(a,i){this.layers=a.readFields(tB,{},i)},Sy=Ty.VectorTileFeature=_A;function Ay(a,i,l,h){const f=[],g=h===0?(y,b,E,S,M,R)=>{y.push(new ue(R,E+(R-b)/(S-b)*(M-E)))}:(y,b,E,S,M,R)=>{y.push(new ue(b+(R-E)/(M-E)*(S-b),R))};for(const y of a){const b=[];for(const E of y){if(E.length<=2)continue;const S=[];for(let k=0;k<E.length-1;k++){const z=E[k].x,N=E[k].y,V=E[k+1].x,Y=E[k+1].y,ce=h===0?z:N,ge=h===0?V:Y;ce<i?ge>i&&g(S,z,N,V,Y,i):ce>l?ge<l&&g(S,z,N,V,Y,l):S.push(E[k]),ge<i&&ce>=i&&g(S,z,N,V,Y,i),ge>l&&ce<=l&&g(S,z,N,V,Y,l)}let M=E[E.length-1];const R=h===0?M.x:M.y;R>=i&&R<=l&&S.push(M),S.length&&(M=S[S.length-1],S[0].x===M.x&&S[0].y===M.y||S.push(S[0]),b.push(S))}b.length&&f.push(b)}return f}Ty.VectorTileLayer=yA;const nB=Sy.types,rB=Math.pow(2,13);function Hp(a,i,l,h,f,g,y,b){a.emplaceBack((i<<1)+y,(l<<1)+g,(Math.floor(h*rB)<<1)+f,Math.round(b))}function Zp(a,i,l){a.emplaceBack(i.x,i.y,i.z,l[0]*16384,l[1]*16384,l[2]*16384)}class xA{constructor(){this.acc=new ue(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ue(i.x,i.y),this.max=new ue(i.x,i.y))}append(i,l){this.currentPolyCount.edges++,this.acc._add(i);const h=this.min,f=this.max;i.x<h.x?h.x=i.x:i.x>f.x&&(f.x=i.x),i.y<h.y?h.y=i.y:i.y>f.y&&(f.y=i.y),((i.x===0||i.x===Ut)&&i.x===l.x)!=((i.y===0||i.y===Ut)&&i.y===l.y)&&this.processBorderOverlap(i,l),l.x<0!=i.x<0&&this.addBorderIntersection(0,ln(l.y,i.y,(0-l.x)/(i.x-l.x))),l.x>Ut!=i.x>Ut&&this.addBorderIntersection(1,ln(l.y,i.y,(Ut-l.x)/(i.x-l.x))),l.y<0!=i.y<0&&this.addBorderIntersection(2,ln(l.x,i.x,(0-l.y)/(i.y-l.y))),l.y>Ut!=i.y>Ut&&this.addBorderIntersection(3,ln(l.x,i.x,(Ut-l.y)/(i.y-l.y)))}addBorderIntersection(i,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[i];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(i,l){if(i.x===l.x){if(i.y===l.y)return;const h=i.x===0?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,i.y)}else{const h=i.y===0?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,i.x)}}centroid(){const i=this.polyCount.reduce((l,h)=>l+h.edges,0);return i!==0?this.acc.div(i)._round():new ue(0,0)}span(){return new ue(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,l)=>i+ +(l[0]!==Number.MAX_VALUE),0)}}class qp{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new In,this.centroidVertexArray=new b2,this.indexArray=new hi,this.programConfigurations=new Eu(i.layers,i.zoom),this.segments=new br,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=i.enableTerrain}populate(i,l,h,f){this.features=[],this.hasPattern=k1("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const y=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*y/(y*y+1)/Ut/(1<<g.z)}(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:y,index:b,sourceLayerIndex:E}of i){const S=this.layers[0]._featureFilter.needGeometry,M=Pu(g,S);if(!this.layers[0]._featureFilter.filter(new Pe(this.zoom),M,h))continue;const R={id:y,sourceLayerIndex:E,index:b,geometry:S?M.geometry:Qa(g,h,f),properties:g.properties,type:g.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(L1("fill-extrusion",this.layers,R,this.zoom,l)):this.addFeature(R,R.geometry,b,h,{},l.availableImages,f),l.featureIndex.insert(g,R.geometry,b,E,this.index,k)}this.sortBorders()}addFeatures(i,l,h,f,g){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,l,h,f,g)}this.sortBorders()}update(i,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,qN),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,ZN.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,HN.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,h,f,g,y,b){const E=[new ue(0,0),new ue(Ut,Ut)],S=b.projection,M=S.name==="globe",R=this.enableTerrain&&!M?new xA:null,k=nB[i.type]==="Polygon";M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new As);const z=R1(l,500);for(let ce=z.length-1;ce>=0;ce--){const ge=z[ce];(ge.length===0||(N=ge[0]).every(ae=>ae.x<=0)||N.every(ae=>ae.x>=Ut)||N.every(ae=>ae.y<=0)||N.every(ae=>ae.y>=Ut))&&z.splice(ce,1)}var N;let V;if(M)V=CA(z,E,f);else{V=[];for(const ce of z)V.push({polygon:ce,bounds:E})}const Y=k?this.edgeRadius:0;for(const{polygon:ce,bounds:ge}of V){let ae=0,me=0;for(const _e of ce)k&&!_e[0].equals(_e[_e.length-1])&&_e.push(_e[0]),me+=k?_e.length-1:_e.length;const ve=this.segments.prepareSegment((k?5:4)*me,this.layoutVertexArray,this.indexArray);if(k){const _e=[],De=[];ae=ve.vertexLength;for(const $e of ce){let nt,Be;$e.length&&$e!==ce[0]&&De.push(_e.length/2),nt=$e[1].sub($e[0])._perp()._unit();for(let He=1;He<$e.length;He++){const qe=$e[He],Je=$e[He===$e.length-1?1:He+1];let{x:it,y:Ve}=qe;if(Y){Be=Je.sub(qe)._perp()._unit();const ct=nt.add(Be)._unit(),zt=Y*Math.min(4,1/(nt.x*ct.x+nt.y*ct.y));it+=zt*ct.x,Ve+=zt*ct.y,nt=Be}Hp(this.layoutVertexArray,it,Ve,0,0,1,1,0),ve.vertexLength++,_e.push(qe.x,qe.y),M&&Zp(this.layoutVertexExtArray,S.projectTilePoint(it,Ve,f),S.upVector(f,it,Ve))}}const ke=ad(_e,De);for(let $e=0;$e<ke.length;$e+=3)this.indexArray.emplaceBack(ae+ke[$e],ae+ke[$e+2],ae+ke[$e+1]),ve.primitiveLength++}for(const _e of ce){R&&_e.length&&R.startRing(_e[0]);let De,ke,$e,nt=_e.length>4&&TA(_e[_e.length-2],_e[0],_e[1]),Be=Y?iB(_e[_e.length-2],_e[0],_e[1],Y):0;ke=_e[1].sub(_e[0])._perp()._unit();let He=!0;for(let qe=1,Je=0;qe<_e.length;qe++){let it=_e[qe-1],Ve=_e[qe];const ct=_e[qe===_e.length-1?1:qe+1];if(R&&k&&R.currentPolyCount.top++,EA(Ve,it,ge)){Y&&(ke=ct.sub(Ve)._perp()._unit(),He=!He);continue}R&&R.append(Ve,it);const zt=Ve.sub(it)._perp(),pt=zt.x/(Math.abs(zt.x)+Math.abs(zt.y)),bt=zt.y>0?1:0,ut=it.dist(Ve);if(Je+ut>32768&&(Je=0),Y){$e=ct.sub(Ve)._perp()._unit();let Jt=wA(it,Ve,ct,bA(ke,$e),Y);isNaN(Jt)&&(Jt=0);const Nt=Ve.sub(it)._unit();it=it.add(Nt.mult(Be))._round(),Ve=Ve.add(Nt.mult(-Jt))._round(),Be=Jt,ke=$e}const Ft=ve.vertexLength,rn=_e.length>4&&TA(it,Ve,ct);let en=SA(Je,nt,He);if(Hp(this.layoutVertexArray,it.x,it.y,pt,bt,0,0,en),Hp(this.layoutVertexArray,it.x,it.y,pt,bt,0,1,en),Je+=ut,en=SA(Je,rn,!He),nt=rn,Hp(this.layoutVertexArray,Ve.x,Ve.y,pt,bt,0,0,en),Hp(this.layoutVertexArray,Ve.x,Ve.y,pt,bt,0,1,en),ve.vertexLength+=4,this.indexArray.emplaceBack(Ft+0,Ft+1,Ft+2),this.indexArray.emplaceBack(Ft+1,Ft+3,Ft+2),ve.primitiveLength+=2,Y){const Jt=ae+(qe===1?_e.length-2:qe-2),Nt=qe===1?ae:Jt+1;if(this.indexArray.emplaceBack(Ft+1,Jt,Ft+3),this.indexArray.emplaceBack(Jt,Nt,Ft+3),ve.primitiveLength+=2,De===void 0&&(De=Ft),!EA(ct,_e[qe],ge)){const En=qe===_e.length-1?De:ve.vertexLength;this.indexArray.emplaceBack(Ft+2,Ft+3,En),this.indexArray.emplaceBack(Ft+3,En+1,En),this.indexArray.emplaceBack(Ft+3,Nt,En+1),ve.primitiveLength+=3}He=!He}if(M){const Jt=this.layoutVertexExtArray,Nt=S.projectTilePoint(it.x,it.y,f),En=S.projectTilePoint(Ve.x,Ve.y,f),$t=S.upVector(f,it.x,it.y),sn=S.upVector(f,Ve.x,Ve.y);Zp(Jt,Nt,$t),Zp(Jt,Nt,$t),Zp(Jt,En,sn),Zp(Jt,En,sn)}}k&&(ae+=_e.length-1)}}if(R&&R.polyCount.length>0){if(R.borders){R.vertexArrayOffset=this.centroidVertexArray.length;const ce=R.borders,ge=this.featuresOnBorder.push(R)-1;for(let ae=0;ae<4;ae++)ce[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(ge)}this.encodeCentroid(R.borders?void 0:R.centroid(),R)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,g,y,f)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((l,h)=>this.featuresOnBorder[l].borders[i][0]-this.featuresOnBorder[h].borders[i][0])}encodeCentroid(i,l,h=!0){let f,g;if(i)if(i.y!==0){const b=l.span()._mult(this.tileToMeter);f=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(b.x/10)),g=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else f=Math.ceil(7*(i.x+450)),g=0;else f=0,g=+h;let y=h?this.centroidVertexArray.length:l.vertexArrayOffset;for(const b of l.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let E=0;E<b.top;E++)this.centroidVertexArray.emplace(y++,f,g);for(let E=0;E<2*b.edges;E++)this.centroidVertexArray.emplace(y++,0,g),this.centroidVertexArray.emplace(y++,f,g)}}}function bA(a,i){const l=a.add(i)._unit();return a.x*l.x+a.y*l.y}function iB(a,i,l,h){const f=i.sub(a)._perp()._unit(),g=l.sub(i)._perp()._unit();return wA(a,i,l,bA(f,g),h)}function wA(a,i,l,h,f){const g=Math.sqrt(1-h*h);return Math.min(a.dist(i)/3,i.dist(l)/3,f*g/h)}function EA(a,i,l){return a.x<l[0].x&&i.x<l[0].x||a.x>l[1].x&&i.x>l[1].x||a.y<l[0].y&&i.y<l[0].y||a.y>l[1].y&&i.y>l[1].y}function TA(a,i,l){if(a.x<0||a.x>=Ut||i.x<0||i.x>=Ut||l.x<0||l.x>=Ut)return!1;const h=l.sub(i),f=h.perp(),g=a.sub(i);return(h.x*g.x+h.y*g.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(g.x*g.x+g.y*g.y))>-.866&&f.x*g.x+f.y*g.y<0}function SA(a,i,l){const h=i?2|a:-3&a;return l?1|h:-2&h}function AA(){const a=Math.PI/32,i=Math.tan(a),l=Vp;return l*Math.sqrt(1+2*i*i)-l}function CA(a,i,l){const h=1<<l.z,f=Ms(l.x/h),g=Ms((l.x+1)/h),y=di(l.y/h),b=di((l.y+1)/h);return function(E,S,M,R,k=0,z){const N=[];if(!E.length||!M||!R)return N;const V=(_e,De)=>{for(const ke of _e)N.push({polygon:ke,bounds:De})},Y=Math.ceil(Math.log2(M)),ce=Math.ceil(Math.log2(R)),ge=Y-ce,ae=[];for(let _e=0;_e<Math.abs(ge);_e++)ae.push(ge>0?0:1);for(let _e=0;_e<Math.min(Y,ce);_e++)ae.push(0),ae.push(1);let me=E;if(me=Ay(me,S[0].y-k,S[1].y+k,1),me=Ay(me,S[0].x-k,S[1].x+k,0),!me.length)return N;const ve=[];for(ae.length?ve.push({polygons:me,bounds:S,depth:0}):V(me,S);ve.length;){const _e=ve.pop(),De=_e.depth,ke=ae[De],$e=_e.bounds[0],nt=_e.bounds[1],Be=ke===0?$e.x:$e.y,He=ke===0?nt.x:nt.y,qe=z?z(ke,Be,He):.5*(Be+He),Je=Ay(_e.polygons,Be-k,qe+k,ke),it=Ay(_e.polygons,qe-k,He+k,ke);if(Je.length){const Ve=[$e,new ue(ke===0?qe:nt.x,ke===1?qe:nt.y)];ae.length>De+1?ve.push({polygons:Je,bounds:Ve,depth:De+1}):V(Je,Ve)}if(it.length){const Ve=[new ue(ke===0?qe:$e.x,ke===1?qe:$e.y),nt];ae.length>De+1?ve.push({polygons:it,bounds:Ve,depth:De+1}):V(it,Ve)}}return N}(a,i,Math.ceil((g-f)/11.25),Math.ceil((y-b)/11.25),1,(E,S,M)=>{if(E===0)return .5*(S+M);{const R=di((l.y+S/Ut)/h);return(ya(.5*(di((l.y+M/Ut)/h)+R))*h-l.y)*Ut}})}yt(qp,"FillExtrusionBucket",{omit:["layers","features"]}),yt(xA,"PartMetadata");const sB=new tt({"fill-extrusion-edge-radius":new Ae(je["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var oB={paint:new tt({"fill-extrusion-opacity":new Ae(je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ne(je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ae(je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ae(je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ne(je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ne(je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ne(je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ae(je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ae(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ae(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:sB};function MA(a,i,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[a*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}class Cy{constructor(i,l,h){this.z=i,this.x=l,this.y=h,this.key=Xp(0,i,i,l,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l){const h=function(g,y,b){var E=MA(256*g,256*(y=Math.pow(2,b)-y-1),b),S=MA(256*(g+1),256*(y+1),b);return E[0]+","+E[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),f=function(g,y,b){let E,S="";for(let M=g;M>0;M--)E=1<<M-1,S+=(y&E?1:0)+(b&E?2:0);return S}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class PA{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Xp(i,l.z,l.z,l.x,l.y)}}class Di{constructor(i,l,h,f,g){this.overscaledZ=i,this.wrap=l,this.canonical=new Cy(h,+f,+g),this.key=l===0&&i===h?this.canonical.key:Xp(l,i,h,f,g)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const l=this.canonical.z-i;return i>this.canonical.z?new Di(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Di(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l=!0){if(this.overscaledZ===i&&l)return this.key;if(i>this.canonical.z)return Xp(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-i;return Xp(this.wrap*+l,i,i,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new Di(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,f=2*this.canonical.y;return[new Di(l,this.wrap,l,h,f),new Di(l,this.wrap,l,h+1,f),new Di(l,this.wrap,l,h,f+1),new Di(l,this.wrap,l,h+1,f+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Di(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Di(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new PA(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xp(a,i,l,h,f){const g=1<<Math.min(l,22);let y=g*(f%g)+h%g;return a&&l<22&&(y+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*y+l)+(i-l)}yt(Cy,"CanonicalTileID"),yt(Di,"OverscaledTileID",{omit:["projMatrix"]});class ud extends ue{constructor(i,l,h){super(i,l),this.z=h}}function Yp(a,i){return a.x*i.x+a.y*i.y}function IA(a,i){if(a.length===1){let l=0;const h=i[l++];let f;for(;!f||h.equals(f);)if(f=i[l++],!f)return 1/0;for(;l<i.length;l++){const g=i[l],y=a[0],b=f.sub(h),E=g.sub(h),S=y.sub(h),M=Yp(b,b),R=Yp(b,E),k=Yp(E,E),z=Yp(S,b),N=Yp(S,E),V=M*k-R*R,Y=(k*z-R*N)/V,ce=(M*N-R*z)/V,ge=h.z*(1-Y-ce)+f.z*Y+g.z*ce;if(isFinite(ge))return ge}return 1/0}{let l=1/0;for(const h of i)l=Math.min(l,h.z);return l}}function RA(a,i,l,h,f,g,y,b){const E=y*f.getElevationAt(a,i,!0,!0),S=g[0]!==0,M=S?g[1]===0?y*(g[0]/7-450):y*function(R,k,z){const N=Math.floor(k[0]/8),V=Math.floor(k[1]/8),Y=10*(k[0]-8*N),ce=10*(k[1]-8*V),ge=R.getElevationAt(N,V,!0,!0),ae=R.getMeterToDEM(z),me=Math.floor(.5*(Y*ae-1)),ve=Math.floor(.5*(ce*ae-1)),_e=R.tileCoordToPixel(N,V),De=2*me+1,ke=2*ve+1,$e=function(it,Ve,ct,zt,pt){return[it.getElevationAtPixel(Ve,ct,!0),it.getElevationAtPixel(Ve+pt,ct,!0),it.getElevationAtPixel(Ve,ct+pt,!0),it.getElevationAtPixel(Ve+zt,ct+pt,!0)]}(R,_e.x-me,_e.y-ve,De,ke),nt=Math.abs($e[0]-$e[1]),Be=Math.abs($e[2]-$e[3]),He=Math.abs($e[0]-$e[2])+Math.abs($e[1]-$e[3]),qe=Math.min(.25,.5*ae*(nt+Be)/De),Je=Math.min(.25,.5*ae*He/ke);return ge+Math.max(qe*Y,Je*ce)}(f,g,b):E;return{base:E+(l===0)?-1:l,top:S?Math.max(M+h,E+l+2):E+h}}const aB=Mt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:lB}=aB,cB=Mt([{name:"a_packed",components:4,type:"Float32"}]),{members:uB}=cB,hB=Sy.types,dB=Math.cos(Math.PI/180*37.5);class My{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new jn,this.layoutVertexArray2=new Nn,this.indexArray=new hi,this.programConfigurations=new Eu(i.layers,i.zoom),this.segments=new br,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h,f){this.hasPattern=k1("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:M,id:R,index:k,sourceLayerIndex:z}of i){const N=this.layers[0]._featureFilter.needGeometry,V=Pu(M,N);if(!this.layers[0]._featureFilter.filter(new Pe(this.zoom),V,h))continue;const Y=g?g.evaluate(V,{},h):void 0,ce={id:R,properties:M.properties,type:M.type,sourceLayerIndex:z,index:k,geometry:N?V.geometry:Qa(M,h,f),patterns:{},sortKey:Y};y.push(ce)}g&&y.sort((M,R)=>M.sortKey-R.sortKey);const{lineAtlas:b,featureIndex:E}=l,S=this.addConstantDashes(b);for(const M of y){const{geometry:R,index:k,sourceLayerIndex:z}=M;if(S&&this.addFeatureDashes(M,b),this.hasPattern){const N=L1("line",this.layers,M,this.zoom,l);this.patternFeatures.push(N)}else this.addFeature(M,R,k,h,b.positions,l.availableImages);E.insert(i[k].feature,R,k,z,this.index)}}addConstantDashes(i){let l=!1;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(f.kind!=="constant"||g.kind!=="constant")l=!0;else{const y=g.value,b=f.value;if(!b)continue;i.addDash(b,y)}}return l}addFeatureDashes(i,l){const h=this.zoom;for(const f of this.layers){const g=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if(g.kind==="constant"&&y.kind==="constant")continue;let b,E;if(g.kind==="constant"){if(b=g.value,!b)continue}else b=g.evaluate({zoom:h},i);E=y.kind==="constant"?y.value:y.evaluate({zoom:h},i),l.addDash(b,E),i.patterns[f.id]=l.getKey(b,E)}}update(i,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h,f)}addFeatures(i,l,h,f,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,l,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,uB)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,lB),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,h,f,g,y){const b=this.layers[0].layout,E=b.get("line-join").evaluate(i,{}),S=b.get("line-cap").evaluate(i,{}),M=b.get("line-miter-limit"),R=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const k of l)this.addLine(k,i,E,S,M,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,g,y,f)}addLine(i,l,h,f,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ce=0;ce<i.length-1;ce++)this.totalDistance+=i[ce].dist(i[ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=hB[l.type]==="Polygon";let E=i.length;for(;E>=2&&i[E-1].equals(i[E-2]);)E--;let S=0;for(;S<E-1&&i[S].equals(i[S+1]);)S++;if(E<(b?3:2))return;h==="bevel"&&(g=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,R=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let k,z,N,V,Y;this.e1=this.e2=-1,b&&(k=i[E-2],Y=i[S].sub(k)._unit()._perp());for(let ce=S;ce<E;ce++){if(N=ce===E-1?b?i[S+1]:void 0:i[ce+1],N&&i[ce].equals(N))continue;Y&&(V=Y),k&&(z=k),k=i[ce],Y=N?N.sub(k)._unit()._perp():V,V=V||Y;let ge=V.add(Y);ge.x===0&&ge.y===0||ge._unit();const ae=V.x*Y.x+V.y*Y.y,me=ge.x*Y.x+ge.y*Y.y,ve=me!==0?1/me:1/0,_e=2*Math.sqrt(2-2*me),De=me<dB&&z&&N,ke=V.x*Y.y-V.y*Y.x>0;if(De&&ce>S){const Be=k.dist(z);if(Be>2*M){const He=k.sub(k.sub(z)._mult(M/Be)._round());this.updateDistance(z,He),this.addCurrentVertex(He,V,0,0,R),z=He}}const $e=z&&N;let nt=$e?h:b?"butt":f;if($e&&nt==="round"&&(ve<y?nt="miter":ve<=2&&(nt="fakeround")),nt==="miter"&&ve>g&&(nt="bevel"),nt==="bevel"&&(ve>2&&(nt="flipbevel"),ve<g&&(nt="miter")),z&&this.updateDistance(z,k),nt==="miter")ge._mult(ve),this.addCurrentVertex(k,ge,0,0,R);else if(nt==="flipbevel"){if(ve>100)ge=Y.mult(-1);else{const Be=ve*V.add(Y).mag()/V.sub(Y).mag();ge._perp()._mult(Be*(ke?-1:1))}this.addCurrentVertex(k,ge,0,0,R),this.addCurrentVertex(k,ge.mult(-1),0,0,R)}else if(nt==="bevel"||nt==="fakeround"){const Be=-Math.sqrt(ve*ve-1),He=ke?Be:0,qe=ke?0:Be;if(z&&this.addCurrentVertex(k,V,He,qe,R),nt==="fakeround"){const Je=Math.round(180*_e/Math.PI/20);for(let it=1;it<Je;it++){let Ve=it/Je;if(Ve!==.5){const zt=Ve-.5;Ve+=Ve*zt*(Ve-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*zt*zt+(.848013+ae*(.215638*ae-1.06021)))}const ct=Y.sub(V)._mult(Ve)._add(V)._unit()._mult(ke?-1:1);this.addHalfVertex(k,ct.x,ct.y,!1,ke,0,R)}}N&&this.addCurrentVertex(k,Y,-He,-qe,R)}else if(nt==="butt")this.addCurrentVertex(k,ge,0,0,R);else if(nt==="square"){const Be=z?1:-1;z||this.addCurrentVertex(k,ge,Be,Be,R),this.addCurrentVertex(k,ge,0,0,R),z&&this.addCurrentVertex(k,ge,Be,Be,R)}else nt==="round"&&(z&&(this.addCurrentVertex(k,V,0,0,R),this.addCurrentVertex(k,V,1,1,R,!0)),N&&(this.addCurrentVertex(k,Y,-1,-1,R,!0),this.addCurrentVertex(k,Y,0,0,R)));if(De&&ce<E-1){const Be=k.dist(N);if(Be>2*M){const He=k.add(N.sub(k)._mult(M/Be)._round());this.updateDistance(k,He),this.addCurrentVertex(He,Y,0,0,R),k=He}}}}addCurrentVertex(i,l,h,f,g,y=!1){const b=l.y*f-l.x,E=-l.y-l.x*f;this.addHalfVertex(i,l.x+l.y*h,l.y-l.x*h,y,!1,h,g),this.addHalfVertex(i,b,E,y,!0,-f,g)}addHalfVertex({x:i,y:l},h,f,g,y,b,E){this.layoutVertexArray.emplaceBack((i<<1)+(g?1:0),(l<<1)+(y?1:0),Math.round(63*h)+128,Math.round(63*f)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),E.primitiveLength++),y?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}yt(My,"LineBucket",{omit:["layers","patternFeatures"]});const fB=new tt({"line-cap":new Ne(je.layout_line["line-cap"]),"line-join":new Ne(je.layout_line["line-join"]),"line-miter-limit":new Ae(je.layout_line["line-miter-limit"]),"line-round-limit":new Ae(je.layout_line["line-round-limit"]),"line-sort-key":new Ne(je.layout_line["line-sort-key"])});var kA={paint:new tt({"line-opacity":new Ne(je.paint_line["line-opacity"]),"line-color":new Ne(je.paint_line["line-color"]),"line-translate":new Ae(je.paint_line["line-translate"]),"line-translate-anchor":new Ae(je.paint_line["line-translate-anchor"]),"line-width":new Ne(je.paint_line["line-width"]),"line-gap-width":new Ne(je.paint_line["line-gap-width"]),"line-offset":new Ne(je.paint_line["line-offset"]),"line-blur":new Ne(je.paint_line["line-blur"]),"line-dasharray":new Ne(je.paint_line["line-dasharray"]),"line-pattern":new Ne(je.paint_line["line-pattern"]),"line-gradient":new Ye(je.paint_line["line-gradient"]),"line-trim-offset":new Ae(je.paint_line["line-trim-offset"])}),layout:fB};const LA=new class extends Ne{possiblyEvaluate(a,i){return i=new Pe(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(a,i)}evaluate(a,i,l,h){return i=Ot({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(a,i,l,h)}}(kA.paint.properties["line-width"].specification);function OA(a,i){return i>0?i+2*a:a}LA.useIntegerZoom=!0;const pB=Mt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),mB=Mt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),gB=Mt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Mt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const _B=Mt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),yB=Mt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const DA=Mt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vB=Mt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mt([{name:"triangle",components:3,type:"Uint16"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mt([{type:"Float32",name:"offsetX"}]),Mt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var pi=24;const va=128;function D1(a,i){const{expression:l}=i;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Pe(a+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:f}=l;let g=0;for(;g<h.length&&h[g]<=a;)g++;g=Math.max(0,g-1);let y=g;for(;y<h.length&&h[y]<a+1;)y++;y=Math.min(h.length-1,y);const b=h[g],E=h[y];return l.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:b,maxZoom:E,minSize:l.evaluate(new Pe(b)),maxSize:l.evaluate(new Pe(E)),interpolationType:f}}}function Py(a,{uSize:i,uSizeT:l},{lowerSize:h,upperSize:f}){return a.kind==="source"?h/va:a.kind==="composite"?ln(h/va,f/va,l):i}function hd(a,i){let l=0,h=0;if(a.kind==="constant")h=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:f,minZoom:g,maxZoom:y}=a,b=f?jt(Ys.interpolationFactor(f,i,g,y),0,1):0;a.kind==="camera"?h=ln(a.minSize,a.maxSize,b):l=b}return{uSizeT:l,uSize:h}}var xB=Object.freeze({__proto__:null,getSizeData:D1,evaluateSizeForFeature:Py,evaluateSizeForZoom:hd,SIZE_PACK_FACTOR:va});function bB(a,i,l){return a.sections.forEach(h=>{h.text=function(f,g,y){const b=g.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?f=f.toLocaleUpperCase():b==="lowercase"&&(f=f.toLocaleLowerCase()),Te.applyArabicShaping&&(f=Te.applyArabicShaping(f)),f}(h.text,i,l)}),a}const Kp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function wB(a){return a==="︶"||a==="﹈"||a==="︸"||a==="﹄"||a==="﹂"||a==="︾"||a==="︼"||a==="︺"||a==="︘"||a==="﹀"||a==="︐"||a==="︓"||a==="︔"||a==="｀"||a==="￣"||a==="︑"||a==="︒"}function EB(a){return a==="︵"||a==="﹇"||a==="︷"||a==="﹃"||a==="﹁"||a==="︽"||a==="︻"||a==="︹"||a==="︗"||a==="︿"}var Jp=Gn,zA=function(a,i,l,h,f){var g,y,b=8*f-h-1,E=(1<<b)-1,S=E>>1,M=-7,R=l?f-1:0,k=l?-1:1,z=a[i+R];for(R+=k,g=z&(1<<-M)-1,z>>=-M,M+=b;M>0;g=256*g+a[i+R],R+=k,M-=8);for(y=g&(1<<-M)-1,g>>=-M,M+=h;M>0;y=256*y+a[i+R],R+=k,M-=8);if(g===0)g=1-S;else{if(g===E)return y?NaN:1/0*(z?-1:1);y+=Math.pow(2,h),g-=S}return(z?-1:1)*y*Math.pow(2,g-h)},FA=function(a,i,l,h,f,g){var y,b,E,S=8*g-f-1,M=(1<<S)-1,R=M>>1,k=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=h?0:g-1,N=h?1:-1,V=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(b=isNaN(i)?1:0,y=M):(y=Math.floor(Math.log(i)/Math.LN2),i*(E=Math.pow(2,-y))<1&&(y--,E*=2),(i+=y+R>=1?k/E:k*Math.pow(2,1-R))*E>=2&&(y++,E/=2),y+R>=M?(b=0,y=M):y+R>=1?(b=(i*E-1)*Math.pow(2,f),y+=R):(b=i*Math.pow(2,R-1)*Math.pow(2,f),y=0));f>=8;a[l+z]=255&b,z+=N,b/=256,f-=8);for(y=y<<f|b,S+=f;S>0;a[l+z]=255&y,z+=N,y/=256,S-=8);a[l+z-N]|=128*V};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Gn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Gn.Varint=0,Gn.Fixed64=1,Gn.Bytes=2,Gn.Fixed32=5;var z1=4294967296,NA=1/z1,BA=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function tl(a){return a.type===Gn.Bytes?a.readVarint()+a.pos:a.pos+1}function dd(a,i,l){return l?4294967296*i+(a>>>0):4294967296*(i>>>0)+(a>>>0)}function UA(a,i,l){var h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(h);for(var f=l.pos-1;f>=a;f--)l.buf[f+h]=l.buf[f]}function TB(a,i){for(var l=0;l<a.length;l++)i.writeVarint(a[l])}function SB(a,i){for(var l=0;l<a.length;l++)i.writeSVarint(a[l])}function AB(a,i){for(var l=0;l<a.length;l++)i.writeFloat(a[l])}function CB(a,i){for(var l=0;l<a.length;l++)i.writeDouble(a[l])}function MB(a,i){for(var l=0;l<a.length;l++)i.writeBoolean(a[l])}function PB(a,i){for(var l=0;l<a.length;l++)i.writeFixed32(a[l])}function IB(a,i){for(var l=0;l<a.length;l++)i.writeSFixed32(a[l])}function RB(a,i){for(var l=0;l<a.length;l++)i.writeFixed64(a[l])}function kB(a,i){for(var l=0;l<a.length;l++)i.writeSFixed64(a[l])}function Iy(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+16777216*a[i+3]}function fd(a,i,l){a[l]=i,a[l+1]=i>>>8,a[l+2]=i>>>16,a[l+3]=i>>>24}function VA(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+(a[i+3]<<24)}function LB(a,i,l){i.glyphs=[],a===1&&l.readMessage(OB,i)}function OB(a,i,l){if(a===3){const{id:h,bitmap:f,width:g,height:y,left:b,top:E,advance:S}=l.readMessage(DB,{});i.glyphs.push({id:h,bitmap:new el({width:g+6,height:y+6},f),metrics:{width:g,height:y,left:b,top:E,advance:S}})}else a===4?i.ascender=l.readSVarint():a===5&&(i.descender=l.readSVarint())}function DB(a,i,l){a===1?i.id=l.readVarint():a===2?i.bitmap=l.readBytes():a===3?i.width=l.readVarint():a===4?i.height=l.readVarint():a===5?i.left=l.readSVarint():a===6?i.top=l.readSVarint():a===7&&(i.advance=l.readVarint())}function F1(a){let i=0,l=0;for(const y of a)i+=y.w*y.h,l=Math.max(l,y.w);a.sort((y,b)=>b.h-y.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let f=0,g=0;for(const y of a)for(let b=h.length-1;b>=0;b--){const E=h[b];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,g=Math.max(g,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===E.w&&y.h===E.h){const S=h.pop();b<h.length&&(h[b]=S)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(h.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:f,h:g,fill:i/(f*g)||0}}Gn.prototype={destroy:function(){this.buf=null},readFields:function(a,i,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),f=h>>3,g=this.pos;this.type=7&h,a(f,i,this),this.pos===g&&this.skip(h)}return i},readMessage:function(a,i){return this.readFields(a,i,this.readVarint()+this.pos)},readFixed32:function(){var a=Iy(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=VA(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Iy(this.buf,this.pos)+Iy(this.buf,this.pos+4)*z1;return this.pos+=8,a},readSFixed64:function(){var a=Iy(this.buf,this.pos)+VA(this.buf,this.pos+4)*z1;return this.pos+=8,a},readFloat:function(){var a=zA(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=zA(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var i,l,h=this.buf;return i=127&(l=h[this.pos++]),l<128?i:(i|=(127&(l=h[this.pos++]))<<7,l<128?i:(i|=(127&(l=h[this.pos++]))<<14,l<128?i:(i|=(127&(l=h[this.pos++]))<<21,l<128?i:function(f,g,y){var b,E,S=y.buf;if(b=(112&(E=S[y.pos++]))>>4,E<128||(b|=(127&(E=S[y.pos++]))<<3,E<128)||(b|=(127&(E=S[y.pos++]))<<10,E<128)||(b|=(127&(E=S[y.pos++]))<<17,E<128)||(b|=(127&(E=S[y.pos++]))<<24,E<128)||(b|=(1&(E=S[y.pos++]))<<31,E<128))return dd(f,b,g);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=h[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,i=this.pos;return this.pos=a,a-i>=12&&BA?function(l,h,f){return BA.decode(l.subarray(h,f))}(this.buf,i,a):function(l,h,f){for(var g="",y=h;y<f;){var b,E,S,M=l[y],R=null,k=M>239?4:M>223?3:M>191?2:1;if(y+k>f)break;k===1?M<128&&(R=M):k===2?(192&(b=l[y+1]))==128&&(R=(31&M)<<6|63&b)<=127&&(R=null):k===3?(E=l[y+2],(192&(b=l[y+1]))==128&&(192&E)==128&&((R=(15&M)<<12|(63&b)<<6|63&E)<=2047||R>=55296&&R<=57343)&&(R=null)):k===4&&(E=l[y+2],S=l[y+3],(192&(b=l[y+1]))==128&&(192&E)==128&&(192&S)==128&&((R=(15&M)<<18|(63&b)<<12|(63&E)<<6|63&S)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,k=1):R>65535&&(R-=65536,g+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),g+=String.fromCharCode(R),y+=k}return g}(this.buf,i,a)},readBytes:function(){var a=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,a);return this.pos=a,i},readPackedVarint:function(a,i){if(this.type!==Gn.Bytes)return a.push(this.readVarint(i));var l=tl(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(i));return a},readPackedSVarint:function(a){if(this.type!==Gn.Bytes)return a.push(this.readSVarint());var i=tl(this);for(a=a||[];this.pos<i;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Gn.Bytes)return a.push(this.readBoolean());var i=tl(this);for(a=a||[];this.pos<i;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Gn.Bytes)return a.push(this.readFloat());var i=tl(this);for(a=a||[];this.pos<i;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Gn.Bytes)return a.push(this.readDouble());var i=tl(this);for(a=a||[];this.pos<i;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Gn.Bytes)return a.push(this.readFixed32());var i=tl(this);for(a=a||[];this.pos<i;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Gn.Bytes)return a.push(this.readSFixed32());var i=tl(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Gn.Bytes)return a.push(this.readFixed64());var i=tl(this);for(a=a||[];this.pos<i;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Gn.Bytes)return a.push(this.readSFixed64());var i=tl(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed64());return a},skip:function(a){var i=7&a;if(i===Gn.Varint)for(;this.buf[this.pos++]>127;);else if(i===Gn.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Gn.Fixed32)this.pos+=4;else{if(i!==Gn.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(a,i){this.writeVarint(a<<3|i)},realloc:function(a){for(var i=this.length||16;i<this.pos+a;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),fd(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),fd(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),fd(this.buf,-1&a,this.pos),fd(this.buf,Math.floor(a*NA),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),fd(this.buf,-1&a,this.pos),fd(this.buf,Math.floor(a*NA),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(i,l){var h,f;if(i>=0?(h=i%4294967296|0,f=i/4294967296|0):(f=~(-i/4294967296),4294967295^(h=~(-i%4294967296))?h=h+1|0:(h=0,f=f+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(g,y,b){b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,b.buf[b.pos]=127&(g>>>=7)}(h,0,l),function(g,y){var b=(7&g)<<4;y.buf[y.pos++]|=b|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var i=this.pos;this.pos=function(h,f,g){for(var y,b,E=0;E<f.length;E++){if((y=f.charCodeAt(E))>55295&&y<57344){if(!b){y>56319||E+1===f.length?(h[g++]=239,h[g++]=191,h[g++]=189):b=y;continue}if(y<56320){h[g++]=239,h[g++]=191,h[g++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(h[g++]=239,h[g++]=191,h[g++]=189,b=null);y<128?h[g++]=y:(y<2048?h[g++]=y>>6|192:(y<65536?h[g++]=y>>12|224:(h[g++]=y>>18|240,h[g++]=y>>12&63|128),h[g++]=y>>6&63|128),h[g++]=63&y|128)}return g}(this.buf,a,this.pos);var l=this.pos-i;l>=128&&UA(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),FA(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),FA(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var i=a.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,i){this.pos++;var l=this.pos;a(i,this);var h=this.pos-l;h>=128&&UA(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(a,i,l){this.writeTag(a,Gn.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(a,i){i.length&&this.writeMessage(a,TB,i)},writePackedSVarint:function(a,i){i.length&&this.writeMessage(a,SB,i)},writePackedBoolean:function(a,i){i.length&&this.writeMessage(a,MB,i)},writePackedFloat:function(a,i){i.length&&this.writeMessage(a,AB,i)},writePackedDouble:function(a,i){i.length&&this.writeMessage(a,CB,i)},writePackedFixed32:function(a,i){i.length&&this.writeMessage(a,PB,i)},writePackedSFixed32:function(a,i){i.length&&this.writeMessage(a,IB,i)},writePackedFixed64:function(a,i){i.length&&this.writeMessage(a,RB,i)},writePackedSFixed64:function(a,i){i.length&&this.writeMessage(a,kB,i)},writeBytesField:function(a,i){this.writeTag(a,Gn.Bytes),this.writeBytes(i)},writeFixed32Field:function(a,i){this.writeTag(a,Gn.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(a,i){this.writeTag(a,Gn.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(a,i){this.writeTag(a,Gn.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(a,i){this.writeTag(a,Gn.Fixed64),this.writeSFixed64(i)},writeVarintField:function(a,i){this.writeTag(a,Gn.Varint),this.writeVarint(i)},writeSVarintField:function(a,i){this.writeTag(a,Gn.Varint),this.writeSVarint(i)},writeStringField:function(a,i){this.writeTag(a,Gn.Bytes),this.writeString(i)},writeFloatField:function(a,i){this.writeTag(a,Gn.Fixed32),this.writeFloat(i)},writeDoubleField:function(a,i){this.writeTag(a,Gn.Fixed64),this.writeDouble(i)},writeBooleanField:function(a,i){this.writeVarintField(a,!!i)}};class N1{constructor(i,{pixelRatio:l,version:h,stretchX:f,stretchY:g,content:y}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=f,this.stretchY=g,this.content=y,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class jA{constructor(i,l){const h={},f={};this.haveRenderCallbacks=[];const g=[];this.addImages(i,h,g),this.addImages(l,f,g);const{w:y,h:b}=F1(g),E=new ds({width:y||1,height:b||1});for(const S in i){const M=i[S],R=h[S].paddedRect;ds.copy(M.data,E,{x:0,y:0},{x:R.x+1,y:R.y+1},M.data)}for(const S in l){const M=l[S],R=f[S].paddedRect,k=R.x+1,z=R.y+1,N=M.data.width,V=M.data.height;ds.copy(M.data,E,{x:0,y:0},{x:k,y:z},M.data),ds.copy(M.data,E,{x:0,y:V-1},{x:k,y:z-1},{width:N,height:1}),ds.copy(M.data,E,{x:0,y:0},{x:k,y:z+V},{width:N,height:1}),ds.copy(M.data,E,{x:N-1,y:0},{x:k-1,y:z},{width:1,height:V}),ds.copy(M.data,E,{x:0,y:0},{x:k+N,y:z},{width:1,height:V})}this.image=E,this.iconPositions=h,this.patternPositions=f}addImages(i,l,h){for(const f in i){const g=i[f],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};h.push(y),l[f]=new N1(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(i,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>i.hasImage(h)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in i.updatedImages)this.patchUpdatedImage(this.iconPositions[h],i.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],i.getImage(h),l)}patchUpdatedImage(i,l,h){if(!i||!l||i.version===l.version)return;i.version=l.version;const[f,g]=i.tl;h.update(l.data,void 0,{x:f,y:g})}}yt(N1,"ImagePosition"),yt(jA,"ImageAtlas");const Ps={horizontal:1,vertical:2,horizontalOnly:3};class Qp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const h=new Qp;return h.scale=i||1,h.fontStack=l,h}static forImage(i){const l=new Qp;return l.imageName=i,l}}class pd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const h=new pd;for(let f=0;f<i.sections.length;f++){const g=i.sections[f];g.image?h.addImageSection(g):h.addTextSection(g,l)}return h}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(l,h){let f="";for(let g=0;g<l.length;g++){const y=l.charCodeAt(g+1)||null,b=l.charCodeAt(g-1)||null;f+=!h&&(y&&P(y)&&!Kp[l[g+1]]||b&&P(b)&&!Kp[l[g-1]])||!Kp[l[g]]?l[g]:Kp[l[g]]}return f}(this.text,i)}trim(){let i=0;for(let h=0;h<this.text.length&&Ry[this.text.charCodeAt(h)];h++)i++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&Ry[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const h=new pd;return h.text=this.text.substring(i,l),h.sectionIndex=this.sectionIndex.slice(i,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(Qp.forText(i.scale,i.fontStack||l));const h=this.sections.length-1;for(let f=0;f<i.text.length;++f)this.sectionIndex.push(h)}addImageSection(i){const l=i.image?i.image.name:"";if(l.length===0)return void Vn("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Qp.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Vn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function B1(a,i,l,h,f,g,y,b,E,S,M,R,k,z,N){const V=pd.fromFeature(a,f);R===Ps.vertical&&V.verticalizePunctuation(k);let Y=[];const ce=function(_e,De,ke,$e,nt,Be){if(!_e)return[];const He=[],qe=function(ct,zt,pt,bt,ut,Ft){let rn=0;for(let en=0;en<ct.length();en++){const Jt=ct.getSection(en);rn+=GA(ct.getCharCode(en),Jt,bt,ut,zt,Ft)}return rn/Math.max(1,Math.ceil(rn/pt))}(_e,De,ke,$e,nt,Be),Je=_e.text.indexOf("​")>=0;let it=0;for(let ct=0;ct<_e.length();ct++){const zt=_e.getSection(ct),pt=_e.getCharCode(ct);if(Ry[pt]||(it+=GA(pt,zt,$e,nt,De,Be)),ct<_e.length()-1){const bt=!((Ve=pt)<11904||!(J_(Ve)||Jh(Ve)||m(Ve)||oy(Ve)||ty(Ve)||K_(Ve)||Q_(Ve)||xu(Ve)||ny(Ve)||Pp(Ve)||ey(Ve)||_(Ve)||Kh(Ve)||Cp(Ve)||Ap(Ve)||Mp(Ve)||Gl(Ve)||bu(Ve)||iy(Ve)||ry(Ve)));(zB[pt]||bt||zt.imageName)&&He.push($A(ct+1,it,qe,He,FB(pt,_e.getCharCode(ct+1),bt&&Je),!1))}}var Ve;return HA($A(_e.length(),it,qe,He,0,!0))}(V,S,g,i,h,z),{processBidirectionalText:ge,processStyledBidirectionalText:ae}=Te;if(ge&&V.sections.length===1){const _e=ge(V.toString(),ce);for(const De of _e){const ke=new pd;ke.text=De,ke.sections=V.sections;for(let $e=0;$e<De.length;$e++)ke.sectionIndex.push(0);Y.push(ke)}}else if(ae){const _e=ae(V.text,V.sectionIndex,ce);for(const De of _e){const ke=new pd;ke.text=De[0],ke.sectionIndex=De[1],ke.sections=V.sections,Y.push(ke)}}else Y=function(_e,De){const ke=[],$e=_e.text;let nt=0;for(const Be of De)ke.push(_e.substring(nt,Be)),nt=Be;return nt<$e.length&&ke.push(_e.substring(nt,$e.length)),ke}(V,ce);const me=[],ve={positionedLines:me,text:V.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(_e,De,ke,$e,nt,Be,He,qe,Je,it,Ve,ct){let zt=0,pt=0,bt=0;const ut=qe==="right"?1:qe==="left"?0:.5;let Ft=!1;for(const $t of nt){const sn=$t.getSections();for(const Rn of sn){if(Rn.imageName)continue;const Xn=De[Rn.fontStack];if(Xn&&(Ft=Xn.ascender!==void 0&&Xn.descender!==void 0,!Ft))break}if(!Ft)break}let rn=0;for(const $t of nt){$t.trim();const sn=$t.getMaxScale(),Rn=(sn-1)*pi,Xn={positionedGlyphs:[],lineOffset:0};_e.positionedLines[rn]=Xn;const Wn=Xn.positionedGlyphs;let Yn=0;if(!$t.length()){pt+=Be,++rn;continue}let Jn=0,cr=0;for(let Tn=0;Tn<$t.length();Tn++){const Pr=$t.getSection(Tn),Er=$t.getSectionIndex(Tn),pn=$t.getCharCode(Tn);let nr=Pr.scale,Dr=null,kn=null,gr=null,bi=pi,Jr=0;const Qr=!(Je===Ps.horizontal||!Ve&&!C(pn)||Ve&&(Ry[pn]||(en=pn,vu(en)||Y_(en)||Sp(en)||Qh(en)||d(en))));if(Pr.imageName){const zi=$e[Pr.imageName];if(!zi)continue;gr=Pr.imageName,_e.iconsInText=_e.iconsInText||!0,kn=zi.paddedRect;const ei=zi.displaySize;nr=nr*pi/ct,Dr={width:ei[0],height:ei[1],left:1,top:-3,advance:Qr?ei[1]:ei[0],localGlyph:!1},Jr=Ft?-Dr.height*nr:sn*pi-17-ei[1]*nr,bi=Dr.advance;const rl=(Qr?ei[0]:ei[1])*nr-pi*sn;rl>0&&rl>Yn&&(Yn=rl)}else{const zi=ke[Pr.fontStack];if(!zi)continue;zi[pn]&&(kn=zi[pn]);const ei=De[Pr.fontStack];if(!ei)continue;const rl=ei.glyphs[pn];if(!rl)continue;if(Dr=rl.metrics,bi=pn!==8203?pi:0,Ft){const vd=ei.ascender!==void 0?Math.abs(ei.ascender):0,am=ei.descender!==void 0?Math.abs(ei.descender):0,lm=(vd+am)*nr;Jn<lm&&(Jn=lm,cr=(vd-am)/2*nr),Jr=-vd*nr}else Jr=(sn-nr)*pi-17}Qr?(_e.verticalizable=!0,Wn.push({glyph:pn,imageName:gr,x:zt,y:pt+Jr,vertical:Qr,scale:nr,localGlyph:Dr.localGlyph,fontStack:Pr.fontStack,sectionIndex:Er,metrics:Dr,rect:kn}),zt+=bi*nr+it):(Wn.push({glyph:pn,imageName:gr,x:zt,y:pt+Jr,vertical:Qr,scale:nr,localGlyph:Dr.localGlyph,fontStack:Pr.fontStack,sectionIndex:Er,metrics:Dr,rect:kn}),zt+=Dr.advance*nr+it)}Wn.length!==0&&(bt=Math.max(zt-it,bt),Ft?ZA(Wn,ut,Yn,cr,Be*sn/2):ZA(Wn,ut,Yn,0,Be/2)),zt=0;const Kr=Be*sn+Yn;Xn.lineOffset=Math.max(Yn,Rn),pt+=Kr,++rn}var en;const Jt=pt,{horizontalAlign:Nt,verticalAlign:En}=U1(He);(function($t,sn,Rn,Xn,Wn,Yn){const Jn=(sn-Rn)*Wn,cr=-Yn*Xn;for(const Kr of $t)for(const Tn of Kr.positionedGlyphs)Tn.x+=Jn,Tn.y+=cr})(_e.positionedLines,ut,Nt,En,bt,Jt),_e.top+=-En*Jt,_e.bottom=_e.top+Jt,_e.left+=-Nt*bt,_e.right=_e.left+bt,_e.hasBaseline=Ft}(ve,i,l,h,Y,y,b,E,R,S,k,N),!function(_e){for(const De of _e)if(De.positionedGlyphs.length!==0)return!1;return!0}(me)&&ve}const Ry={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zB={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function GA(a,i,l,h,f,g){if(i.imageName){const y=h[i.imageName];return y?y.displaySize[0]*i.scale*pi/g+f:0}{const y=l[i.fontStack],b=y&&y.glyphs[a];return b?b.metrics.advance*i.scale+f:0}}function WA(a,i,l,h){const f=Math.pow(a-i,2);return h?a<i?f/2:2*f:f+Math.abs(l)*l}function FB(a,i,l){let h=0;return a===10&&(h-=1e4),l&&(h+=150),a!==40&&a!==65288||(h+=50),i!==41&&i!==65289||(h+=50),h}function $A(a,i,l,h,f,g){let y=null,b=WA(i,l,f,g);for(const E of h){const S=WA(i-E.x,l,f,g)+E.badness;S<=b&&(y=E,b=S)}return{index:a,x:i,priorBreak:y,badness:b}}function HA(a){return a?HA(a.priorBreak).concat(a.index):[]}function U1(a){let i=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function ZA(a,i,l,h,f){if(!(i||l||h||f))return;const g=a.length-1,y=a[g],b=(y.x+y.metrics.advance*y.scale)*i;for(let E=0;E<=g;E++)a[E].x-=b,a[E].y+=l+h+f}function NB(a,i,l){const{horizontalAlign:h,verticalAlign:f}=U1(l),g=i[0]-a.displaySize[0]*h,y=i[1]-a.displaySize[1]*f;return{image:a,top:y,bottom:y+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function qA(a,i,l,h,f,g){const y=a.image;let b;if(y.content){const Y=y.content,ce=y.pixelRatio||1;b=[Y[0]/ce,Y[1]/ce,y.displaySize[0]-Y[2]/ce,y.displaySize[1]-Y[3]/ce]}const E=i.left*g,S=i.right*g;let M,R,k,z;l==="width"||l==="both"?(z=f[0]+E-h[3],R=f[0]+S+h[1]):(z=f[0]+(E+S-y.displaySize[0])/2,R=z+y.displaySize[0]);const N=i.top*g,V=i.bottom*g;return l==="height"||l==="both"?(M=f[1]+N-h[0],k=f[1]+V+h[2]):(M=f[1]+(N+V-y.displaySize[1])/2,k=M+y.displaySize[1]),{image:y,top:M,right:R,bottom:k,left:z,collisionPadding:b}}class nl extends ue{constructor(i,l,h,f,g){super(i,l),this.angle=f,this.z=h,g!==void 0&&(this.segment=g)}clone(){return new nl(this.x,this.y,this.z,this.angle,this.segment)}}function XA(a,i,l,h,f){if(i.segment===void 0)return!0;let g=i,y=i.segment+1,b=0;for(;b>-l/2;){if(y--,y<0)return!1;b-=a[y].dist(g),g=a[y]}b+=a[y].dist(a[y+1]),y++;const E=[];let S=0;for(;b<l/2;){const M=a[y],R=a[y+1];if(!R)return!1;let k=a[y-1].angleTo(M)-M.angleTo(R);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:b,angleDelta:k}),S+=k;b-E[0].distance>h;)S-=E.shift().angleDelta;if(S>f)return!1;y++,b+=M.dist(R)}return!0}function YA(a){let i=0;for(let l=0;l<a.length-1;l++)i+=a[l].dist(a[l+1]);return i}function KA(a,i,l){return a?.6*i*l:0}function JA(a,i){return Math.max(a?a.right-a.left:0,i?i.right-i.left:0)}function BB(a,i,l,h,f,g){const y=KA(l,f,g),b=JA(l,h)*g;let E=0;const S=YA(a)/2;for(let M=0;M<a.length-1;M++){const R=a[M],k=a[M+1],z=R.dist(k);if(E+z>S){const N=(S-E)/z,V=ln(R.x,k.x,N),Y=ln(R.y,k.y,N),ce=new nl(V,Y,0,k.angleTo(R),M);return!y||XA(a,ce,b,y,i)?ce:void 0}E+=z}}function UB(a,i,l,h,f,g,y,b,E){const S=KA(h,g,y),M=JA(h,f),R=M*y,k=a[0].x===0||a[0].x===E||a[0].y===0||a[0].y===E;return i-R<i/4&&(i=R+i/4),QA(a,k?i/2*b%i:(M/2+2*g)*y*b%i,i,S,l,R,k,!1,E)}function QA(a,i,l,h,f,g,y,b,E){const S=g/2,M=YA(a);let R=0,k=i-l,z=[];for(let N=0;N<a.length-1;N++){const V=a[N],Y=a[N+1],ce=V.dist(Y),ge=Y.angleTo(V);for(;k+l<R+ce;){k+=l;const ae=(k-R)/ce,me=ln(V.x,Y.x,ae),ve=ln(V.y,Y.y,ae);if(me>=0&&me<E&&ve>=0&&ve<E&&k-S>=0&&k+S<=M){const _e=new nl(me,ve,0,ge,N);_e._round(),h&&!XA(a,_e,g,h,f)||z.push(_e)}}R+=ce}return b||z.length||y||(z=QA(a,R/2,l,h,f,g,y,!0,E)),z}function eC(a,i,l,h,f){const g=[];for(let y=0;y<a.length;y++){const b=a[y];let E;for(let S=0;S<b.length-1;S++){let M=b[S],R=b[S+1];M.x<i&&R.x<i||(M.x<i?M=new ue(i,M.y+(i-M.x)/(R.x-M.x)*(R.y-M.y))._round():R.x<i&&(R=new ue(i,M.y+(i-M.x)/(R.x-M.x)*(R.y-M.y))._round()),M.y<l&&R.y<l||(M.y<l?M=new ue(M.x+(l-M.y)/(R.y-M.y)*(R.x-M.x),l)._round():R.y<l&&(R=new ue(M.x+(l-M.y)/(R.y-M.y)*(R.x-M.x),l)._round()),M.x>=h&&R.x>=h||(M.x>=h?M=new ue(h,M.y+(h-M.x)/(R.x-M.x)*(R.y-M.y))._round():R.x>=h&&(R=new ue(h,M.y+(h-M.x)/(R.x-M.x)*(R.y-M.y))._round()),M.y>=f&&R.y>=f||(M.y>=f?M=new ue(M.x+(f-M.y)/(R.y-M.y)*(R.x-M.x),f)._round():R.y>=f&&(R=new ue(M.x+(f-M.y)/(R.y-M.y)*(R.x-M.x),f)._round()),E&&M.equals(E[E.length-1])||(E=[M],g.push(E)),E.push(R)))))}}return g}yt(nl,"Anchor");const em=1e20;function tC(a,i,l,h,f,g,y,b,E){for(let S=i;S<i+h;S++)nC(a,l*g+S,g,f,y,b,E);for(let S=l;S<l+f;S++)nC(a,S*g+i,1,h,y,b,E)}function nC(a,i,l,h,f,g,y){g[0]=0,y[0]=-em,y[1]=em,f[0]=a[i];for(let b=1,E=0,S=0;b<h;b++){f[b]=a[i+b*l];const M=b*b;do{const R=g[E];S=(f[b]-f[R]+M-R*R)/(b-R)/2}while(S<=y[E]&&--E>-1);E++,g[E]=b,y[E]=S,y[E+1]=em}for(let b=0,E=0;b<h;b++){for(;y[E+1]<b;)E++;const S=g[E],M=b-S;a[i+b*l]=f[S]+M*M}}const V1={none:0,ideographs:1,all:2};class md{constructor(i,l,h){this.requestManager=i,this.localGlyphMode=l,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,l){const h=[];for(const f in i)for(const g of i[f])h.push({stack:f,id:g});wt(h,({stack:f,id:g},y)=>{let b=this.entries[f];b||(b=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=b.glyphs[g];if(E!==void 0)return void y(null,{stack:f,id:g,glyph:E});if(E=this._tinySDF(b,f,g),E)return b.glyphs[g]=E,void y(null,{stack:f,id:g,glyph:E});const S=Math.floor(g/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[S])return void y(null,{stack:f,id:g,glyph:E});let M=b.requests[S];M||(M=b.requests[S]=[],md.loadGlyphRange(f,S,this.url,this.requestManager,(R,k)=>{if(k){b.ascender=k.ascender,b.descender=k.descender;for(const z in k.glyphs)this._doesCharSupportLocalGlyph(+z)||(b.glyphs[+z]=k.glyphs[+z]);b.ranges[S]=!0}for(const z of M)z(R,k);delete b.requests[S]})),M.push((R,k)=>{R?y(R):k&&y(null,{stack:f,id:g,glyph:k.glyphs[g]||null})})},(f,g)=>{if(f)l(f);else if(g){const y={};for(const{stack:b,id:E,glyph:S}of g)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[E]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;l(null,y)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==V1.none&&(this.localGlyphMode===V1.all?!!this.localFontFamily:!!this.localFontFamily&&(Pp(i)||sy(i)||Kh(i)||Gl(i)||xu(i)))}_tinySDF(i,l,h){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let g=i.tinySDF;if(!g){let V="400";/bold/i.test(l)?V="900":/medium/i.test(l)?V="500":/light/i.test(l)&&(V="200"),g=i.tinySDF=new md.TinySDF({fontFamily:f,fontWeight:V,fontSize:48,buffer:6,radius:16}),g.fontWeight=V}if(this.localGlyphs[g.fontWeight][h])return this.localGlyphs[g.fontWeight][h];const y=String.fromCharCode(h),{data:b,width:E,height:S,glyphWidth:M,glyphHeight:R,glyphLeft:k,glyphTop:z,glyphAdvance:N}=g.draw(y);return this.localGlyphs[g.fontWeight][h]={id:h,bitmap:new el({width:E,height:S},b),metrics:{width:M/2,height:R/2,left:k/2,top:z/2-27,advance:N/2,localGlyph:!0}}}}function rC(a,i,l,h){const f=[],g=a.image,y=g.pixelRatio,b=g.paddedRect.w-2,E=g.paddedRect.h-2,S=a.right-a.left,M=a.bottom-a.top,R=g.stretchX||[[0,b]],k=g.stretchY||[[0,E]],z=(Be,He)=>Be+He[1]-He[0],N=R.reduce(z,0),V=k.reduce(z,0),Y=b-N,ce=E-V;let ge=0,ae=N,me=0,ve=V,_e=0,De=Y,ke=0,$e=ce;if(g.content&&h){const Be=g.content;ge=ky(R,0,Be[0]),me=ky(k,0,Be[1]),ae=ky(R,Be[0],Be[2]),ve=ky(k,Be[1],Be[3]),_e=Be[0]-ge,ke=Be[1]-me,De=Be[2]-Be[0]-ae,$e=Be[3]-Be[1]-ve}const nt=(Be,He,qe,Je)=>{const it=Ly(Be.stretch-ge,ae,S,a.left),Ve=Oy(Be.fixed-_e,De,Be.stretch,N),ct=Ly(He.stretch-me,ve,M,a.top),zt=Oy(He.fixed-ke,$e,He.stretch,V),pt=Ly(qe.stretch-ge,ae,S,a.left),bt=Oy(qe.fixed-_e,De,qe.stretch,N),ut=Ly(Je.stretch-me,ve,M,a.top),Ft=Oy(Je.fixed-ke,$e,Je.stretch,V),rn=new ue(it,ct),en=new ue(pt,ct),Jt=new ue(pt,ut),Nt=new ue(it,ut),En=new ue(Ve/y,zt/y),$t=new ue(bt/y,Ft/y),sn=i*Math.PI/180;if(sn){const Wn=Math.sin(sn),Yn=Math.cos(sn),Jn=[Yn,-Wn,Wn,Yn];rn._matMult(Jn),en._matMult(Jn),Nt._matMult(Jn),Jt._matMult(Jn)}const Rn=Be.stretch+Be.fixed,Xn=He.stretch+He.fixed;return{tl:rn,tr:en,bl:Nt,br:Jt,tex:{x:g.paddedRect.x+1+Rn,y:g.paddedRect.y+1+Xn,w:qe.stretch+qe.fixed-Rn,h:Je.stretch+Je.fixed-Xn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:En,pixelOffsetBR:$t,minFontScaleX:De/y/S,minFontScaleY:$e/y/M,isSDF:l}};if(h&&(g.stretchX||g.stretchY)){const Be=iC(R,Y,N),He=iC(k,ce,V);for(let qe=0;qe<Be.length-1;qe++){const Je=Be[qe],it=Be[qe+1];for(let Ve=0;Ve<He.length-1;Ve++)f.push(nt(Je,He[Ve],it,He[Ve+1]))}}else f.push(nt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:E+1}));return f}function ky(a,i,l){let h=0;for(const f of a)h+=Math.max(i,Math.min(l,f[1]))-Math.max(i,Math.min(l,f[0]));return h}function iC(a,i,l){const h=[{fixed:-1,stretch:0}];for(const[f,g]of a){const y=h[h.length-1];h.push({fixed:f-y.stretch,stretch:y.stretch}),h.push({fixed:f-y.stretch,stretch:y.stretch+(g-f)})}return h.push({fixed:i+1,stretch:l}),h}function Ly(a,i,l,h){return a/i*l+h}function Oy(a,i,l,h){return a-i*l/h}function VB(a,i,l,h){const f=i+a.positionedLines[h].lineOffset;return h===0?l+f/2:l+(f+(i+a.positionedLines[h-1].lineOffset))/2}md.loadGlyphRange=function(a,i,l,h,f){const g=256*i,y=g+255,b=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${g}-${y}`),vo.Glyphs);bo(b,(E,S)=>{if(E)f(E);else if(S){const M={},R=function(k){return new Jp(k).readFields(LB,{})}(S);for(const k of R.glyphs)M[k.id]=k;f(null,{glyphs:M,ascender:R.ascender,descender:R.descender})}})},md.TinySDF=class{constructor({fontSize:a=24,buffer:i=3,radius:l=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}={}){this.buffer=i,this.cutoff=h,this.radius=l;const b=this.size=a+4*i,E=this._createCanvas(b),S=this.ctx=E.getContext("2d",{willReadFrequently:!0});S.font=`${y} ${g} ${a}px ${f}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(a){const i=document.createElement("canvas");return i.width=i.height=a,i}draw(a){const{width:i,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(a),y=Math.ceil(l),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-f))),E=Math.min(this.size-this.buffer,y+Math.ceil(h)),S=b+2*this.buffer,M=E+2*this.buffer,R=Math.max(S*M,0),k=new Uint8ClampedArray(R),z={data:k,width:S,height:M,glyphWidth:b,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:i};if(b===0||E===0)return z;const{ctx:N,buffer:V,gridInner:Y,gridOuter:ce}=this;N.clearRect(V,V,b,E),N.fillText(a,V,V+y);const ge=N.getImageData(V,V,b,E);ce.fill(em,0,R),Y.fill(0,0,R);for(let ae=0;ae<E;ae++)for(let me=0;me<b;me++){const ve=ge.data[4*(ae*b+me)+3]/255;if(ve===0)continue;const _e=(ae+V)*S+me+V;if(ve===1)ce[_e]=0,Y[_e]=em;else{const De=.5-ve;ce[_e]=De>0?De*De:0,Y[_e]=De<0?De*De:0}}tC(ce,0,0,S,M,S,this.f,this.v,this.z),tC(Y,V,V,b,E,S,this.f,this.v,this.z);for(let ae=0;ae<R;ae++){const me=Math.sqrt(ce[ae])-Math.sqrt(Y[ae]);k[ae]=Math.round(255-255*(me/this.radius+this.cutoff))}return z}};class jB{constructor(i=[],l=GB){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:h}=this,f=l[i];for(;i>0;){const g=i-1>>1,y=l[g];if(h(f,y)>=0)break;l[i]=y,i=g}l[i]=f}_down(i){const{data:l,compare:h}=this,f=this.length>>1,g=l[i];for(;i<f;){let y=1+(i<<1),b=l[y];const E=y+1;if(E<this.length&&h(l[E],b)<0&&(y=E,b=l[E]),h(b,g)>=0)break;l[i]=b,i=y}l[i]=g}}function GB(a,i){return a<i?-1:a>i?1:0}function WB(a,i=1,l=!1){let h=1/0,f=1/0,g=-1/0,y=-1/0;const b=a[0];for(let z=0;z<b.length;z++){const N=b[z];(!z||N.x<h)&&(h=N.x),(!z||N.y<f)&&(f=N.y),(!z||N.x>g)&&(g=N.x),(!z||N.y>y)&&(y=N.y)}const E=Math.min(g-h,y-f);let S=E/2;const M=new jB([],$B);if(E===0)return new ue(h,f);for(let z=h;z<g;z+=E)for(let N=f;N<y;N+=E)M.push(new gd(z+S,N+S,S,a));let R=function(z){let N=0,V=0,Y=0;const ce=z[0];for(let ge=0,ae=ce.length,me=ae-1;ge<ae;me=ge++){const ve=ce[ge],_e=ce[me],De=ve.x*_e.y-_e.x*ve.y;V+=(ve.x+_e.x)*De,Y+=(ve.y+_e.y)*De,N+=3*De}return new gd(V/N,Y/N,0,z)}(a),k=M.length;for(;M.length;){const z=M.pop();(z.d>R.d||!R.d)&&(R=z,l&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,k)),z.max-R.d<=i||(S=z.h/2,M.push(new gd(z.p.x-S,z.p.y-S,S,a)),M.push(new gd(z.p.x+S,z.p.y-S,S,a)),M.push(new gd(z.p.x-S,z.p.y+S,S,a)),M.push(new gd(z.p.x+S,z.p.y+S,S,a)),k+=4)}return l&&(console.log(`num probes: ${k}`),console.log(`best distance: ${R.d}`)),R.p}function $B(a,i){return i.max-a.max}function gd(a,i,l,h){this.p=new ue(a,i),this.h=l,this.d=function(f,g){let y=!1,b=1/0;for(let E=0;E<g.length;E++){const S=g[E];for(let M=0,R=S.length,k=R-1;M<R;k=M++){const z=S[M],N=S[k];z.y>f.y!=N.y>f.y&&f.x<(N.x-z.x)*(f.y-z.y)/(N.y-z.y)+z.x&&(y=!y),b=Math.min(b,nA(f,z,N))}}return(y?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}const j1=Number.POSITIVE_INFINITY,HB=Math.sqrt(2);function sC(a,[i,l]){let h=0,f=0;if(l===j1){i<0&&(i=0);const g=i/HB;switch(a){case"top-right":case"top-left":f=g-7;break;case"bottom-right":case"bottom-left":f=7-g;break;case"bottom":f=7-i;break;case"top":f=i-7}switch(a){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=i;break;case"right":h=-i}}else{switch(i=Math.abs(i),l=Math.abs(l),a){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(a){case"top-right":case"bottom-right":case"right":h=-i;break;case"top-left":case"bottom-left":case"left":h=i}}return[h,f]}function ZB(a,i,l,h,f,g,y,b,E,S){a.createArrays(),a.tilePixelRatio=Ut/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const M=a.layers[0].layout,R=a.layers[0]._unevaluatedLayout._values,k={};if(a.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:Y}=a.textSizeData;k.compositeTextSizes=[R["text-size"].possiblyEvaluate(new Pe(V),b),R["text-size"].possiblyEvaluate(new Pe(Y),b)]}if(a.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:Y}=a.iconSizeData;k.compositeIconSizes=[R["icon-size"].possiblyEvaluate(new Pe(V),b),R["icon-size"].possiblyEvaluate(new Pe(Y),b)]}k.layoutTextSize=R["text-size"].possiblyEvaluate(new Pe(E+1),b),k.layoutIconSize=R["icon-size"].possiblyEvaluate(new Pe(E+1),b),k.textMaxSize=R["text-size"].possiblyEvaluate(new Pe(18),b);const z=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",N=M.get("text-size");for(const V of a.features){const Y=M.get("text-font").evaluate(V,{},b).join(","),ce=N.evaluate(V,{},b),ge=k.layoutTextSize.evaluate(V,{},b),ae=(k.layoutIconSize.evaluate(V,{},b),{horizontal:{},vertical:void 0}),me=V.text;let ve,_e=[0,0];if(me){const $e=me.toString(),nt=M.get("text-letter-spacing").evaluate(V,{},b)*pi,Be=M.get("text-line-height").evaluate(V,{},b)*pi,He=w($e)?nt:0,qe=M.get("text-anchor").evaluate(V,{},b),Je=M.get("text-variable-anchor");if(!Je){const pt=M.get("text-radial-offset").evaluate(V,{},b);_e=pt?sC(qe,[pt*pi,j1]):M.get("text-offset").evaluate(V,{},b).map(bt=>bt*pi)}let it=z?"center":M.get("text-justify").evaluate(V,{},b);const Ve=M.get("symbol-placement")==="point",ct=Ve?M.get("text-max-width").evaluate(V,{},b)*pi:1/0,zt=pt=>{a.allowVerticalPlacement&&x($e)&&(ae.vertical=B1(me,i,l,f,Y,ct,Be,qe,pt,He,_e,Ps.vertical,!0,ge,ce))};if(!z&&Je){const pt=it==="auto"?Je.map(ut=>G1(ut)):[it];let bt=!1;for(let ut=0;ut<pt.length;ut++){const Ft=pt[ut];if(!ae.horizontal[Ft])if(bt)ae.horizontal[Ft]=ae.horizontal[0];else{const rn=B1(me,i,l,f,Y,ct,Be,"center",Ft,He,_e,Ps.horizontal,!1,ge,ce);rn&&(ae.horizontal[Ft]=rn,bt=rn.positionedLines.length===1)}}zt("left")}else{if(it==="auto"&&(it=G1(qe)),Ve||M.get("text-writing-mode").indexOf("horizontal")>=0||!x($e)){const pt=B1(me,i,l,f,Y,ct,Be,qe,it,He,_e,Ps.horizontal,!1,ge,ce);pt&&(ae.horizontal[it]=pt)}zt(Ve?"left":it)}}let De=!1;if(V.icon&&V.icon.name){const $e=h[V.icon.name];$e&&(ve=NB(f[V.icon.name],M.get("icon-offset").evaluate(V,{},b),M.get("icon-anchor").evaluate(V,{},b)),De=$e.sdf,a.sdfIcons===void 0?a.sdfIcons=$e.sdf:a.sdfIcons!==$e.sdf&&Vn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($e.pixelRatio!==a.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}const ke=aC(ae.horizontal)||ae.vertical;a.iconsInText||(a.iconsInText=!!ke&&ke.iconsInText),(ke||ve)&&qB(a,V,ae,ve,h,k,ge,0,_e,De,y,b,S)}g&&a.generateCollisionDebugBuffers(E,a.collisionBoxArray)}function G1(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qB(a,i,l,h,f,g,y,b,E,S,M,R,k){let z=g.textMaxSize.evaluate(i,{},R);z===void 0&&(z=y);const N=a.layers[0].layout,V=N.get("icon-offset").evaluate(i,{},R),Y=aC(l.horizontal)||l.vertical,ce=k.name==="globe",ge=y/24,ae=a.tilePixelRatio*z/24,me=(He=a.overscaling,a.zoom>18&&He>2&&(He>>=1),Math.max(Ut/(512*He),1)*N.get("symbol-spacing")),ve=N.get("text-padding")*a.tilePixelRatio,_e=N.get("icon-padding")*a.tilePixelRatio,De=rt(N.get("text-max-angle")),ke=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",$e=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",nt=N.get("symbol-placement"),Be=me/2;var He;const qe=N.get("icon-text-fit");let Je;h&&qe!=="none"&&(a.allowVerticalPlacement&&l.vertical&&(Je=qA(h,l.vertical,qe,N.get("icon-text-fit-padding"),V,ge)),Y&&(h=qA(h,Y,qe,N.get("icon-text-fit-padding"),V,ge)));const it=(Ve,ct,zt)=>{if(ct.x<0||ct.x>=Ut||ct.y<0||ct.y>=Ut)return;let pt=null;if(ce){const{x:bt,y:ut,z:Ft}=k.projectTilePoint(ct.x,ct.y,zt);pt={anchor:new nl(bt,ut,Ft,0,void 0),up:k.upVector(zt,ct.x,ct.y)}}(function(bt,ut,Ft,rn,en,Jt,Nt,En,$t,sn,Rn,Xn,Wn,Yn,Jn,cr,Kr,Tn,Pr,Er,pn,nr,Dr,kn,gr){const bi=bt.addToLineVertexArray(ut,rn);let Jr,Qr,zi,ei,rl,vd,am,lm=0,zC=0,FC=0,NC=0,tb=-1,nb=-1;const Ea={};let BC=wu("");const Ou=Ft?Ft.anchor:ut;let rb=0,ib=0;if($t._unevaluatedLayout.getValue("text-radial-offset")===void 0?[rb,ib]=$t.layout.get("text-offset").evaluate(pn,{},gr).map(fs=>fs*pi):(rb=$t.layout.get("text-radial-offset").evaluate(pn,{},gr)*pi,ib=j1),bt.allowVerticalPlacement&&en.vertical){const fs=en.vertical;if(Jn)vd=W1(fs),En&&(am=W1(En));else{const ps=$t.layout.get("text-rotate").evaluate(pn,{},gr)+90;zi=Dy(sn,Ou,ut,Rn,Xn,Wn,fs,Yn,ps,cr),En&&(ei=Dy(sn,Ou,ut,Rn,Xn,Wn,En,Tn,ps))}}if(Jt){const fs=$t.layout.get("icon-rotate").evaluate(pn,{},gr),ps=$t.layout.get("icon-text-fit")!=="none",cm=rC(Jt,fs,Dr,ps),ob=En?rC(En,fs,Dr,ps):void 0;Qr=Dy(sn,Ou,ut,Rn,Xn,Wn,Jt,Tn,fs),lm=4*cm.length;const UC=bt.iconSizeData;let Du=null;UC.kind==="source"?(Du=[va*$t.layout.get("icon-size").evaluate(pn,{},gr)],Du[0]>Xl&&Vn(`${bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):UC.kind==="composite"&&(Du=[va*nr.compositeIconSizes[0].evaluate(pn,{},gr),va*nr.compositeIconSizes[1].evaluate(pn,{},gr)],(Du[0]>Xl||Du[1]>Xl)&&Vn(`${bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),bt.addSymbols(bt.icon,cm,Du,Er,Pr,pn,!1,Ft,ut,bi.lineStartIndex,bi.lineLength,-1,kn,gr),tb=bt.icon.placedSymbolArray.length-1,ob&&(zC=4*ob.length,bt.addSymbols(bt.icon,ob,Du,Er,Pr,pn,Ps.vertical,Ft,ut,bi.lineStartIndex,bi.lineLength,-1,kn,gr),nb=bt.icon.placedSymbolArray.length-1)}for(const fs in en.horizontal){const ps=en.horizontal[fs];Jr||(BC=wu(ps.text),Jn?rl=W1(ps):Jr=Dy(sn,Ou,ut,Rn,Xn,Wn,ps,Yn,$t.layout.get("text-rotate").evaluate(pn,{},gr),cr));const cm=ps.positionedLines.length===1;if(FC+=oC(bt,Ft,ut,ps,Nt,$t,Jn,pn,cr,bi,en.vertical?Ps.horizontal:Ps.horizontalOnly,cm?Object.keys(en.horizontal):[fs],Ea,tb,nr,kn,gr),cm)break}en.vertical&&(NC+=oC(bt,Ft,ut,en.vertical,Nt,$t,Jn,pn,cr,bi,Ps.vertical,["vertical"],Ea,nb,nr,kn,gr));let tc=-1;const sb=(fs,ps)=>fs?Math.max(fs,ps):ps;tc=sb(rl,tc),tc=sb(vd,tc),tc=sb(am,tc);const x4=tc>-1?1:0;bt.glyphOffsetArray.length>=Kl.MAX_GLYPHS&&Vn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),pn.sortKey!==void 0&&bt.addToSortKeyRanges(bt.symbolInstances.length,pn.sortKey),bt.symbolInstances.emplaceBack(Ou.x,Ou.y,Ou.z,ut.x,ut.y,Ea.right>=0?Ea.right:-1,Ea.center>=0?Ea.center:-1,Ea.left>=0?Ea.left:-1,Ea.vertical>=0?Ea.vertical:-1,tb,nb,BC,Jr!==void 0?Jr:bt.collisionBoxArray.length,Jr!==void 0?Jr+1:bt.collisionBoxArray.length,zi!==void 0?zi:bt.collisionBoxArray.length,zi!==void 0?zi+1:bt.collisionBoxArray.length,Qr!==void 0?Qr:bt.collisionBoxArray.length,Qr!==void 0?Qr+1:bt.collisionBoxArray.length,ei||bt.collisionBoxArray.length,ei?ei+1:bt.collisionBoxArray.length,Rn,FC,NC,lm,zC,x4,0,rb,ib,tc)})(a,ct,pt,Ve,l,h,f,Je,a.layers[0],a.collisionBoxArray,i.index,i.sourceLayerIndex,a.index,ve,ke,E,0,_e,$e,V,i,g,S,M,R)};if(nt==="line")for(const Ve of eC(i.geometry,0,0,Ut,Ut)){const ct=UB(Ve,me,De,l.vertical||Y,h,24,ae,a.overscaling,Ut);for(const zt of ct){const pt=Y;pt&&XB(a,pt.text,Be,zt)||it(Ve,zt,R)}}else if(nt==="line-center"){for(const Ve of i.geometry)if(Ve.length>1){const ct=BB(Ve,De,l.vertical||Y,h,24,ae);ct&&it(Ve,ct,R)}}else if(i.type==="Polygon")for(const Ve of R1(i.geometry,0)){const ct=WB(Ve,16);it(Ve[0],new nl(ct.x,ct.y,0,0,void 0),R)}else if(i.type==="LineString")for(const Ve of i.geometry)it(Ve,new nl(Ve[0].x,Ve[0].y,0,0,void 0),R);else if(i.type==="Point")for(const Ve of i.geometry)for(const ct of Ve)it([ct],new nl(ct.x,ct.y,0,0,void 0),R)}const Xl=32640;function oC(a,i,l,h,f,g,y,b,E,S,M,R,k,z,N,V,Y){const ce=function(me,ve,_e,De,ke,$e,nt,Be){const He=[];if(ve.positionedLines.length===0)return He;const qe=De.layout.get("text-rotate").evaluate($e,{})*Math.PI/180,Je=function(pt){const bt=pt[0],ut=pt[1],Ft=bt*ut;return Ft>0?[bt,-ut]:Ft<0?[-bt,ut]:bt===0?[ut,bt]:[ut,-bt]}(_e);let it=Math.abs(ve.top-ve.bottom);for(const pt of ve.positionedLines)it-=pt.lineOffset;const Ve=ve.positionedLines.length,ct=it/Ve;let zt=ve.top-_e[1];for(let pt=0;pt<Ve;++pt){const bt=ve.positionedLines[pt];zt=VB(ve,ct,zt,pt);for(const ut of bt.positionedGlyphs){if(!ut.rect)continue;const Ft=ut.rect||{};let rn=4,en=!0,Jt=1,Nt=0;if(ut.imageName){const kn=nt[ut.imageName];if(!kn)continue;if(kn.sdf){Vn("SDF images are not supported in formatted text and will be ignored.");continue}en=!1,Jt=kn.pixelRatio,rn=1/Jt}const En=(ke||Be)&&ut.vertical,$t=ut.metrics.advance*ut.scale/2,sn=ut.metrics,Rn=ut.rect;if(Rn===null)continue;Be&&ve.verticalizable&&(Nt=ut.imageName?$t-ut.metrics.width*ut.scale/2:0);const Xn=ke?[ut.x+$t,ut.y]:[0,0];let Wn=[0,0],Yn=[0,0],Jn=!1;ke||(En?(Yn=[ut.x+$t+Je[0],ut.y+Je[1]-Nt],Jn=!0):Wn=[ut.x+$t+_e[0],ut.y+_e[1]-Nt]);const cr=Rn.w*ut.scale/(Jt*(ut.localGlyph?2:1)),Kr=Rn.h*ut.scale/(Jt*(ut.localGlyph?2:1));let Tn,Pr,Er,pn;if(En){const kn=ut.y-zt,gr=new ue(-$t,$t-kn),bi=-Math.PI/2,Jr=new ue(...Yn);Tn=new ue(-$t+Wn[0],Wn[1]),Tn._rotateAround(bi,gr)._add(Jr),Tn.x+=-kn+$t,Tn.y-=(sn.left-rn)*ut.scale;const Qr=ut.imageName?sn.advance*ut.scale:pi*ut.scale,zi=String.fromCharCode(ut.glyph);wB(zi)?Tn.x+=(1-rn)*ut.scale:EB(zi)?Tn.x+=Qr-sn.height*ut.scale+(-rn-1)*ut.scale:Tn.x+=ut.imageName||sn.width+2*rn===Rn.w&&sn.height+2*rn===Rn.h?(Qr-Kr)/2:(Qr-(sn.height+2*rn)*ut.scale)/2,Pr=new ue(Tn.x,Tn.y-cr),Er=new ue(Tn.x+Kr,Tn.y),pn=new ue(Tn.x+Kr,Tn.y-cr)}else{const kn=(sn.left-rn)*ut.scale-$t+Wn[0],gr=(-sn.top-rn)*ut.scale+Wn[1],bi=kn+cr,Jr=gr+Kr;Tn=new ue(kn,gr),Pr=new ue(bi,gr),Er=new ue(kn,Jr),pn=new ue(bi,Jr)}if(qe){let kn;kn=ke?new ue(0,0):Jn?new ue(Je[0],Je[1]):new ue(_e[0],_e[1]),Tn._rotateAround(qe,kn),Pr._rotateAround(qe,kn),Er._rotateAround(qe,kn),pn._rotateAround(qe,kn)}const nr=new ue(0,0),Dr=new ue(0,0);He.push({tl:Tn,tr:Pr,bl:Er,br:pn,tex:Ft,writingMode:ve.writingMode,glyphOffset:Xn,sectionIndex:ut.sectionIndex,isSDF:en,pixelOffsetTL:nr,pixelOffsetBR:Dr,minFontScaleX:0,minFontScaleY:0})}}return He}(0,h,E,g,y,b,f,a.allowVerticalPlacement),ge=a.textSizeData;let ae=null;ge.kind==="source"?(ae=[va*g.layout.get("text-size").evaluate(b,{},Y)],ae[0]>Xl&&Vn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ge.kind==="composite"&&(ae=[va*N.compositeTextSizes[0].evaluate(b,{},Y),va*N.compositeTextSizes[1].evaluate(b,{},Y)],(ae[0]>Xl||ae[1]>Xl)&&Vn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,ce,ae,E,y,b,M,i,l,S.lineStartIndex,S.lineLength,z,V,Y);for(const me of R)k[me]=a.text.placedSymbolArray.length-1;return 4*ce.length}function aC(a){for(const i in a)return a[i];return null}function Dy(a,i,l,h,f,g,y,b,E,S){let M=y.top,R=y.bottom,k=y.left,z=y.right;const N=y.collisionPadding;if(N&&(k-=N[0],M-=N[1],z+=N[2],R+=N[3]),E){const V=new ue(k,M),Y=new ue(z,M),ce=new ue(k,R),ge=new ue(z,R),ae=rt(E);let me=new ue(0,0);S&&(me=new ue(S[0],S[1])),V._rotateAround(ae,me),Y._rotateAround(ae,me),ce._rotateAround(ae,me),ge._rotateAround(ae,me),k=Math.min(V.x,Y.x,ce.x,ge.x),z=Math.max(V.x,Y.x,ce.x,ge.x),M=Math.min(V.y,Y.y,ce.y,ge.y),R=Math.max(V.y,Y.y,ce.y,ge.y)}return a.emplaceBack(i.x,i.y,i.z,l.x,l.y,k,M,z,R,b,h,f,g),a.length-1}function W1(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const i=a.bottom-a.top;return i>0?Math.max(10,i):null}function XB(a,i,l,h){const f=a.compareText;if(i in f){const g=f[i];for(let y=g.length-1;y>=0;y--)if(h.dist(g[y])<l)return!0}else f[i]=[];return f[i].push(h),!1}function lC(a,i){const l=a.fovAboveCenter,h=a.elevation?a.elevation.getMinElevationBelowMSL()*i:0,f=(a._camera.position[2]*a.worldSize-h)/Math.cos(a._pitch),g=Math.sin(l)*f/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),y=Math.sin(a._pitch)*g+f;return Math.min(1.01*y,f*(1/a._horizonShift))}function ku(a,i){if(!i.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:i};const l=Math.pow(2,-a.z),h=a.x*l,f=(a.x+1)*l,g=a.y*l,y=(a.y+1)*l,b=Ms(h),E=Ms(f),S=di(g),M=di(y),R=i.project(b,S),k=i.project(E,S),z=i.project(E,M),N=i.project(b,M);let V=Math.min(R.x,k.x,z.x,N.x),Y=Math.min(R.y,k.y,z.y,N.y),ce=Math.max(R.x,k.x,z.x,N.x),ge=Math.max(R.y,k.y,z.y,N.y);const ae=l/16;function me(_e,De,ke,$e,nt,Be){const He=(ke+nt)/2,qe=($e+Be)/2,Je=i.project(Ms(He),di(qe)),it=Math.max(0,V-Je.x,Y-Je.y,Je.x-ce,Je.y-ge);V=Math.min(V,Je.x),ce=Math.max(ce,Je.x),Y=Math.min(Y,Je.y),ge=Math.max(ge,Je.y),it>ae&&(me(_e,Je,ke,$e,He,qe),me(Je,De,He,qe,nt,Be))}me(R,k,h,g,f,g),me(k,z,f,g,f,y),me(z,N,f,y,h,y),me(N,R,h,y,h,g),V-=ae,Y-=ae,ce+=ae,ge+=ae;const ve=1/Math.max(ce-V,ge-Y);return{scale:ve,x:V*ve,y:Y*ve,x2:ce*ve,y2:ge*ve,projection:i}}const YB=Lo(new Float32Array(16));class Yl{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,l){return{x:0,y:0,z:0}}unproject(i,l){return new hn(0,0)}projectTilePoint(i,l,h){return{x:i,y:l,z:0}}locationPoint(i,l,h=!0){return i._coordinatePoint(i.locationCoordinate(l),h)}pixelsPerMeter(i,l){return Do(1,i)*l}pixelSpaceConversion(i,l,h){return 1}farthestPixelDistance(i){return lC(i,i.pixelsPerMeter)}pointCoordinate(i,l,h,f){const g=i.horizonLineFromTop(!1),y=new ue(l,Math.max(g,h));return i.rayIntersectionCoordinate(i.pointRayIntersection(y,f))}pointCoordinate3D(i,l,h){const f=new ue(l,h);if(i.elevation)return i.elevation.pointCoordinate(f);{const g=this.pointCoordinate(i,f.x,f.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(i,l){if(i.elevation)return!this.pointCoordinate3D(i,l.x,l.y);const h=i.horizonLineFromTop();return l.y<h}createInversionMatrix(i,l){return YB}createTileMatrix(i,l,h){let f,g,y;const b=h.canonical,E=Lo(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=ku(b,this);f=1,g=S.x+h.wrap*S.scale,y=S.y,Su(E,E,[f/S.scale,f/S.scale,i.pixelsPerMeter/l])}else f=l/i.zoomScale(b.z),g=(b.x+Math.pow(2,b.z)*h.wrap)*f,y=b.y*f;return Rp(E,E,[g,y,0]),Su(E,E,[f/Ut,f/Ut,1]),E}upVector(i,l,h){return[0,0,1]}upVectorScale(i,l,h){return{metersToTile:1}}}class KB extends Yl{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[l,h]=this.parallels=i.parallels||[29.5,45.5],f=Math.sin(rt(l));this.n=(f+Math.sin(rt(h)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(i,l){const{n:h,c:f,r0:g}=this,y=rt(i-this.center[0]),b=rt(l),E=Math.sqrt(f-2*h*Math.sin(b))/h;return{x:E*Math.sin(y*h),y:E*Math.cos(y*h)-g,z:0}}unproject(i,l){const{n:h,c:f,r0:g}=this,y=g+l;let b=Math.atan2(i,Math.abs(y))*Math.sign(y);y*h<0&&(b-=Math.PI*Math.sign(i)*Math.sign(y));const E=rt(this.center[0])*h;b=Ci(b,-Math.PI-E,Math.PI-E);const S=jt(ht(b/h)+this.center[0],-180,180),M=Math.asin(jt((f-(i*i+y*y)*h*h)/(2*h),-1,1)),R=jt(ht(M),-fi,fi);return new hn(S,R)}}const tm=1.340264,nm=-.081106,rm=893e-6,im=.003796,zy=Math.sqrt(3)/2;class JB extends Yl{project(i,l){l=l/180*Math.PI,i=i/180*Math.PI;const h=Math.asin(zy*Math.sin(l)),f=h*h,g=f*f*f;return{x:.5*(i*Math.cos(h)/(zy*(tm+3*nm*f+g*(7*rm+9*im*f)))/Math.PI+.5),y:1-.5*(h*(tm+nm*f+g*(rm+im*f))/Math.PI+1),z:0}}unproject(i,l){i=(2*i-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,f=h*h,g=f*f*f;for(let M,R,k,z=0;z<12&&(R=h*(tm+nm*f+g*(rm+im*f))-l,k=tm+3*nm*f+g*(7*rm+9*im*f),M=R/k,h=jt(h-M,-Math.PI/3,Math.PI/3),f=h*h,g=f*f*f,!(Math.abs(M)<1e-12));++z);const y=zy*i*(tm+3*nm*f+g*(7*rm+9*im*f))/Math.cos(h),b=Math.asin(Math.sin(h)/zy),E=jt(180*y/Math.PI,-180,180),S=jt(180*b/Math.PI,-fi,fi);return new hn(E,S)}}class QB extends Yl{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,l){return{x:.5+i/360,y:.5-l/360,z:0}}unproject(i,l){const h=360*(i-.5),f=jt(360*(.5-l),-fi,fi);return new hn(h,f)}}const _d=Math.PI/2;function Fy(a){return Math.tan((_d+a)/2)}class e4 extends Yl{constructor(i){super(i),this.center=i.center||[0,30];const[l,h]=this.parallels=i.parallels||[30,30];let f=rt(l),g=rt(h);this.southernCenter=f+g<0,this.southernCenter&&(f=-f,g=-g);const y=Math.cos(f),b=Fy(f);this.n=f===g?Math.sin(f):Math.log(y/Math.cos(g))/Math.log(Fy(g)/b),this.f=y*Math.pow(Fy(f),this.n)/this.n}project(i,l){l=rt(l),this.southernCenter&&(l=-l),i=rt(i-this.center[0]);const h=1e-6,{n:f,f:g}=this;g>0?l<-_d+h&&(l=-_d+h):l>_d-h&&(l=_d-h);const y=g/Math.pow(Fy(l),f);let b=y*Math.sin(f*i),E=g-y*Math.cos(f*i);return b=.5*(b/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:b,y:this.southernCenter?E:1-E,z:0}}unproject(i,l){i=(2*i-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f}=this,g=f-l,y=Math.sign(g),b=Math.sign(h)*Math.sqrt(i*i+g*g);let E=Math.atan2(i,Math.abs(g))*y;g*h<0&&(E-=Math.PI*Math.sign(i)*y);const S=jt(ht(E/h)+this.center[0],-180,180),M=jt(ht(2*Math.atan(Math.pow(f/b,1/h))-_d),-fi,fi);return new hn(S,this.southernCenter?-M:M)}}class cC extends Yl{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,l){return{x:_a(i),y:ya(l),z:0}}unproject(i,l){const h=Ms(i),f=di(l);return new hn(h,f)}}const uC=rt(fi);class t4 extends Yl{project(i,l){const h=(l=rt(l))*l,f=h*h;return{x:.5*((i=rt(i))*(.8707-.131979*h+f*(f*(.003971*h-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+f*(.028874*h-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(i,l){i=(2*i-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,f=25,g=0,y=h*h;do{y=h*h;const S=y*y;g=(h*(1.007226+y*(.015085+S*(.028874*y-.044475-.005916*S)))-l)/(1.007226+y*(.045255+S*(.259866*y-.311325-.005916*11*S))),h=jt(h-g,-uC,uC)}while(Math.abs(g)>1e-6&&--f>0);y=h*h;const b=jt(ht(i/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=ht(h);return new hn(b,E)}}const hC=rt(fi);class n4 extends Yl{project(i,l){l=rt(l),i=rt(i);const h=Math.cos(l),f=2/Math.PI,g=Math.acos(h*Math.cos(i/2)),y=Math.sin(g)/g,b=.5*(i*f+2*h*Math.sin(i/2)/y)||0,E=.5*(l+Math.sin(l)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(i,l){let h=i=(2*i-.5)*Math.PI,f=l=(2*(1-l)-1)*Math.PI,g=25;const y=1e-6;let b=0,E=0;do{const S=Math.cos(f),M=Math.sin(f),R=2*M*S,k=M*M,z=S*S,N=Math.cos(h/2),V=Math.sin(h/2),Y=2*N*V,ce=V*V,ge=1-z*N*N,ae=ge?1/ge:0,me=ge?Math.acos(S*N)*Math.sqrt(1/ge):0,ve=.5*(2*me*S*V+2*h/Math.PI)-i,_e=.5*(me*M+f)-l,De=.5*ae*(z*ce+me*S*N*k)+1/Math.PI,ke=ae*(Y*R/4-me*M*V),$e=.125*ae*(R*V-me*M*z*Y),nt=.5*ae*(k*N+me*ce*S)+.5,Be=ke*$e-nt*De;b=(_e*ke-ve*nt)/Be,E=(ve*$e-_e*De)/Be,h=jt(h-b,-Math.PI,Math.PI),f=jt(f-E,-hC,hC)}while((Math.abs(b)>y||Math.abs(E)>y)&&--g>0);return new hn(ht(h),ht(f))}}class dC extends Yl{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(rt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,l){const{scale:h,cosPhi:f}=this;return{x:rt(i)*f*h+.5,y:-Math.sin(rt(l))/f*h+.5,z:0}}unproject(i,l){const{scale:h,cosPhi:f}=this,g=-(l-.5)/h,y=jt(ht((i-.5)/h)/f,-180,180),b=Math.asin(jt(g*f,-1,1)),E=jt(ht(b),-fi,fi);return new hn(y,E)}}class r4 extends cC{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,l,h){const f=Bp(i,l,h);return mr(f,f,Up(ga(h))),{x:f[0],y:f[1],z:f[2]}}locationPoint(i,l){const h=rd(l.lat,l.lng),f=Li([],h),g=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(l),i._centerAltitude):i._centerAltitude;Dp(h,h,f,Do(1,0)*Ut*g);const y=Lo(new Float64Array(16));return Tu(y,i.pixelMatrix,i.globeMatrix),mr(h,h,y),new ue(h[0],h[1])}pixelsPerMeter(i,l){return Do(1,0)*l}pixelSpaceConversion(i,l,h){const f=Do(1,i)*l,g=ln(Do(1,45)*l,f,h);return this.pixelsPerMeter(i,l)/g}createTileMatrix(i,l,h){const f=_1(ga(h.canonical));return Tu(new Float64Array(16),i.globeMatrix,f)}createInversionMatrix(i,l){const{center:h}=i,f=Up(ga(l));return dy(f,f,rt(h.lng)),l1(f,f,rt(h.lat)),Su(f,f,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(i,l,h,f){return j2(i,l,h,!0)||new sd(0,0)}pointCoordinate3D(i,l,h){const f=this.pointCoordinate(i,l,h,0);return[f.x,f.y,f.z]}isPointAboveHorizon(i,l){return!j2(i,l.x,l.y,!1)}farthestPixelDistance(i){const l=function(f,g){const y=f.cameraToCenterDistance,b=f._centerAltitude*g,E=f._camera,S=f._camera.forward(),M=Ja([],Cs([],S,-y),[0,0,b]),R=f.worldSize/(2*Math.PI),k=[0,0,-R],z=f.width/f.height,N=Math.tan(f.fovAboveCenter),V=Cs([],E.up(),N),Y=Cs([],E.right(),N*z),ce=Li([],Ja([],Ja([],S,V),Y)),ge=[];let ae;if(new d1(M,ce).closestPointOnSphere(k,R,ge)){const me=Ja([],ge,k),ve=Oo([],me,M);ae=Math.cos(f.fovAboveCenter)*kp(ve)}else{const me=Oo([],M,k),ve=Oo([],k,M);Li(ve,ve);const _e=kp(me)-R;ae=Math.sqrt(_e*(_e+2*R));const De=Math.acos(ae/(R+_e))-Math.acos(Js(S,ve));ae*=Math.cos(De)}return 1.01*ae}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),h=id(i.zoom);if(h>0){const f=lC(i,Do(1,i.center.lat)*i.worldSize),g=i.worldSize/(2*Math.PI),y=Math.max(i.width,i.height)/i.worldSize*Math.PI;return ln(l,f+g*(1-Math.cos(y)),Math.pow(h,10))}return l}upVector(i,l,h){return Bp(l,h,i,1)}upVectorScale(i){return{metersToTile:fy(my(ga(i)))}}}function fC(a){const i=a.parallels,l=!!i&&Math.abs(i[0]+i[1])<.01;switch(a.name){case"mercator":return new cC(a);case"equirectangular":return new QB(a);case"naturalEarth":return new t4(a);case"equalEarth":return new JB(a);case"winkelTripel":return new n4(a);case"albers":return l?new dC(a):new KB(a);case"lambertConformalConic":return l?new dC(a):new e4(a);case"globe":return new r4(a)}throw new Error(`Invalid projection name: ${a.name}`)}const i4=Sy.types,s4=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ny(a,i,l,h,f,g,y,b,E,S,M,R,k){const z=b?Math.min(Xl,Math.round(b[0])):0,N=b?Math.min(Xl,Math.round(b[1])):0;a.emplaceBack(i,l,Math.round(32*h),Math.round(32*f),g,y,(z<<1)+(E?1:0),N,16*S,16*M,256*R,256*k)}function By(a,i,l,h,f,g,y){a.emplaceBack(i,l,h,f,g,y)}function Uy(a,i,l,h,f){a.emplaceBack(i,l,h,f),a.emplaceBack(i,l,h,f),a.emplaceBack(i,l,h,f),a.emplaceBack(i,l,h,f)}function o4(a){for(const i of a.sections)if(U(i.text))return!0;return!1}class $1{constructor(i){this.layoutVertexArray=new Po,this.indexArray=new hi,this.programConfigurations=i,this.segments=new br,this.dynamicLayoutVertexArray=new Nn,this.opacityVertexArray=new Bn,this.placedSymbolArray=new p2,this.globeExtVertexArray=new Kn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,l,h,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,pB.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,gB.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,s4,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,mB.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||f)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}yt($1,"SymbolBuffers");class H1{constructor(i,l,h){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new h,this.segments=new br,this.collisionVertexArray=new qn,this.collisionVertexArrayExt=new ui}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,_B.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,yB.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yt(H1,"CollisionBuffers");class Kl{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(y=>y.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Lo([]),this.placementViewportMatrix=Lo([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=D1(this.zoom,l["text-size"]),this.iconSizeData=D1(this.zoom,l["icon-size"]);const h=this.layers[0].layout,f=h.get("symbol-sort-key"),g=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(y=>Ps[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new $1(new Eu(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new $1(new Eu(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new _2,this.lineVertexArray=new y2,this.symbolInstances=new g2}calculateGlyphDependencies(i,l,h,f,g){for(let y=0;y<i.length;y++)if(l[i.charCodeAt(y)]=!0,f&&g){const b=Kp[i.charAt(y)];b&&(l[b.charCodeAt(0)]=!0)}}populate(i,l,h,f){const g=this.layers[0],y=g.layout,b=this.projection.name==="globe",E=y.get("text-font"),S=y.get("text-field"),M=y.get("icon-image"),R=(S.value.kind!=="constant"||S.value.value instanceof Ri&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),k=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,z=y.get("symbol-sort-key");if(this.features=[],!R&&!k)return;const N=l.iconDependencies,V=l.glyphDependencies,Y=l.availableImages,ce=new Pe(this.zoom);for(const{feature:ge,id:ae,index:me,sourceLayerIndex:ve}of i){const _e=g._featureFilter.needGeometry,De=Pu(ge,_e);if(!g._featureFilter.filter(ce,De,h))continue;if(_e||(De.geometry=Qa(ge,h,f)),b&&ge.type!==1&&h.z<=5){const Be=De.geometry,He=.98078528056,qe=(Je,it)=>Js(Bp(Je.x,Je.y,h,1),Bp(it.x,it.y,h,1))<He;for(let Je=0;Je<Be.length;Je++)Be[Je]=gN(Be[Je],qe)}let ke,$e;if(R){const Be=g.getValueAndResolveTokens("text-field",De,h,Y),He=Ri.factory(Be);o4(He)&&(this.hasRTLText=!0),(!this.hasRTLText||xe()==="unavailable"||this.hasRTLText&&Te.isParsed())&&(ke=bB(He,g,De))}if(k){const Be=g.getValueAndResolveTokens("icon-image",De,h,Y);$e=Be instanceof xi?Be:xi.fromString(Be)}if(!ke&&!$e)continue;const nt=this.sortFeaturesByKey?z.evaluate(De,{},h):void 0;if(this.features.push({id:ae,text:ke,icon:$e,index:me,sourceLayerIndex:ve,geometry:De.geometry,properties:ge.properties,type:i4[ge.type],sortKey:nt}),$e&&(N[$e.name]=!0),ke){const Be=E.evaluate(De,{},h).join(","),He=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ps.vertical)>=0;for(const qe of ke.sections)if(qe.image)N[qe.image.name]=!0;else{const Je=x(ke.toString()),it=qe.fontStack||Be,Ve=V[it]=V[it]||{};this.calculateGlyphDependencies(qe.text,Ve,He,this.allowVerticalPlacement,Je)}}}y.get("symbol-placement")==="line"&&(this.features=function(ge){const ae={},me={},ve=[];let _e=0;function De(Be){ve.push(ge[Be]),_e++}function ke(Be,He,qe){const Je=me[Be];return delete me[Be],me[He]=Je,ve[Je].geometry[0].pop(),ve[Je].geometry[0]=ve[Je].geometry[0].concat(qe[0]),Je}function $e(Be,He,qe){const Je=ae[He];return delete ae[He],ae[Be]=Je,ve[Je].geometry[0].shift(),ve[Je].geometry[0]=qe[0].concat(ve[Je].geometry[0]),Je}function nt(Be,He,qe){const Je=qe?He[0][He[0].length-1]:He[0][0];return`${Be}:${Je.x}:${Je.y}`}for(let Be=0;Be<ge.length;Be++){const He=ge[Be],qe=He.geometry,Je=He.text?He.text.toString():null;if(!Je){De(Be);continue}const it=nt(Je,qe),Ve=nt(Je,qe,!0);if(it in me&&Ve in ae&&me[it]!==ae[Ve]){const ct=$e(it,Ve,qe),zt=ke(it,Ve,ve[ct].geometry);delete ae[it],delete me[Ve],me[nt(Je,ve[zt].geometry,!0)]=zt,ve[ct].geometry=null}else it in me?ke(it,Ve,qe):Ve in ae?$e(it,Ve,qe):(De(Be),ae[it]=_e-1,me[Ve]=_e-1)}return ve.filter(Be=>Be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,ae)=>ge.sortKey-ae.sortKey)}update(i,l,h,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,h,f),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,h,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=fC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const h=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:f,y:g}of l)this.lineVertexArray.emplaceBack(f,g);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,l,h,f,g,y,b,E,S,M,R,k,z,N){const V=i.indexArray,Y=i.layoutVertexArray,ce=i.globeExtVertexArray,ge=i.segments.prepareSegment(4*l.length,Y,V,this.canOverlap?y.sortKey:void 0),ae=this.glyphOffsetArray.length,me=ge.vertexLength,ve=this.allowVerticalPlacement&&b===Ps.vertical?Math.PI/2:0,_e=y.text&&y.text.sections;for(let ke=0;ke<l.length;ke++){const{tl:$e,tr:nt,bl:Be,br:He,tex:qe,pixelOffsetTL:Je,pixelOffsetBR:it,minFontScaleX:Ve,minFontScaleY:ct,glyphOffset:zt,isSDF:pt,sectionIndex:bt}=l[ke],ut=ge.vertexLength,Ft=zt[1];if(Ny(Y,S.x,S.y,$e.x,Ft+$e.y,qe.x,qe.y,h,pt,Je.x,Je.y,Ve,ct),Ny(Y,S.x,S.y,nt.x,Ft+nt.y,qe.x+qe.w,qe.y,h,pt,it.x,Je.y,Ve,ct),Ny(Y,S.x,S.y,Be.x,Ft+Be.y,qe.x,qe.y+qe.h,h,pt,Je.x,it.y,Ve,ct),Ny(Y,S.x,S.y,He.x,Ft+He.y,qe.x+qe.w,qe.y+qe.h,h,pt,it.x,it.y,Ve,ct),E){const{x:rn,y:en,z:Jt}=E.anchor,[Nt,En,$t]=E.up;By(ce,rn,en,Jt,Nt,En,$t),By(ce,rn,en,Jt,Nt,En,$t),By(ce,rn,en,Jt,Nt,En,$t),By(ce,rn,en,Jt,Nt,En,$t),Uy(i.dynamicLayoutVertexArray,rn,en,Jt,ve)}else Uy(i.dynamicLayoutVertexArray,S.x,S.y,S.z,ve);V.emplaceBack(ut,ut+1,ut+2),V.emplaceBack(ut+1,ut+2,ut+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zt[0]),ke!==l.length-1&&bt===l[ke+1].sectionIndex||i.programConfigurations.populatePaintArrays(Y.length,y,y.index,{},z,N,_e&&_e[bt])}const De=E?E.anchor:S;i.placedSymbolArray.emplaceBack(De.x,De.y,De.z,S.x,S.y,ae,this.glyphOffsetArray.length-ae,me,M,R,S.segment,h?h[0]:0,h?h[1]:0,f[0],f[1],b,0,!1,0,k,0)}_commitLayoutVertex(i,l,h,f,g,y,b){i.emplaceBack(l,h,f,g,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(i,l,h,f,g,y,b){const E=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),S=E.vertexLength,M=b.tileAnchorX,R=b.tileAnchorY;for(let z=0;z<4;z++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(l,-i.padding,-i.padding),h.collisionVertexArrayExt.emplaceBack(l,i.padding,-i.padding),h.collisionVertexArrayExt.emplaceBack(l,i.padding,i.padding),h.collisionVertexArrayExt.emplaceBack(l,-i.padding,i.padding),this._commitLayoutVertex(h.layoutVertexArray,f,g,y,M,R,new ue(i.x1,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,g,y,M,R,new ue(i.x2,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,g,y,M,R,new ue(i.x2,i.y2)),this._commitLayoutVertex(h.layoutVertexArray,f,g,y,M,R,new ue(i.x1,i.y2)),E.vertexLength+=4;const k=h.indexArray;k.emplaceBack(S,S+1),k.emplaceBack(S+1,S+2),k.emplaceBack(S+2,S+3),k.emplaceBack(S+3,S),E.primitiveLength+=4}_addTextDebugCollisionBoxes(i,l,h,f,g,y){for(let b=f;b<g;b++){const E=h.get(b),S=this.getSymbolInstanceTextSize(i,y,l,b);this._addCollisionDebugVertices(E,S,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(i,l,h,f,g,y){for(let b=f;b<g;b++){const E=h.get(b),S=this.getSymbolInstanceIconSize(i,l,y.placedIconSymbolIndex);this._addCollisionDebugVertices(E,S,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(i,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new H1(lr,DA.members,fa),this.iconCollisionBox=new H1(lr,DA.members,fa);const h=hd(this.iconSizeData,i),f=hd(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(f,i,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,i,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(h,i,l,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(h,i,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(i,l,h,f){const g=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),y=Py(this.textSizeData,i,g)/pi;return this.tilePixelRatio*y}getSymbolInstanceIconSize(i,l,h){const f=this.icon.placedSymbolArray.get(h),g=Py(this.iconSizeData,i,f);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(i,l,h){i.emplaceBack(l,-h,-h),i.emplaceBack(l,h,-h),i.emplaceBack(l,h,h),i.emplaceBack(l,-h,h)}_updateTextDebugCollisionBoxes(i,l,h,f,g,y){for(let b=f;b<g;b++){const E=h.get(b),S=this.getSymbolInstanceTextSize(i,y,l,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,E.padding)}}_updateIconDebugCollisionBoxes(i,l,h,f,g,y){for(let b=f;b<g;b++){const E=h.get(b),S=this.getSymbolInstanceIconSize(i,l,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,E.padding)}}updateCollisionDebugBuffers(i,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=hd(this.iconSizeData,i),f=hd(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,i,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,i,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(h,i,l,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,i,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,l,h,f,g,y,b,E,S){const M={};if(l<h){const{x1:R,y1:k,x2:z,y2:N,padding:V,projectedAnchorX:Y,projectedAnchorY:ce,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:me,featureIndex:ve}=i.get(l);M.textBox={x1:R,y1:k,x2:z,y2:N,padding:V,projectedAnchorX:Y,projectedAnchorY:ce,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:me},M.textFeatureIndex=ve}if(f<g){const{x1:R,y1:k,x2:z,y2:N,padding:V,projectedAnchorX:Y,projectedAnchorY:ce,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:me,featureIndex:ve}=i.get(f);M.verticalTextBox={x1:R,y1:k,x2:z,y2:N,padding:V,projectedAnchorX:Y,projectedAnchorY:ce,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:me},M.verticalTextFeatureIndex=ve}if(y<b){const{x1:R,y1:k,x2:z,y2:N,padding:V,projectedAnchorX:Y,projectedAnchorY:ce,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:me,featureIndex:ve}=i.get(y);M.iconBox={x1:R,y1:k,x2:z,y2:N,padding:V,projectedAnchorX:Y,projectedAnchorY:ce,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:me},M.iconFeatureIndex=ve}if(E<S){const{x1:R,y1:k,x2:z,y2:N,padding:V,projectedAnchorX:Y,projectedAnchorY:ce,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:me,featureIndex:ve}=i.get(E);M.verticalIconBox={x1:R,y1:k,x2:z,y2:N,padding:V,projectedAnchorX:Y,projectedAnchorY:ce,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:me},M.verticalIconFeatureIndex=ve}return M}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const h=i.placedSymbolArray.get(l),f=h.vertexStartIndex+4*h.numGlyphs;for(let g=h.vertexStartIndex;g<f;g+=4)i.indexArray.emplaceBack(g,g+1,g+2),i.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),h=Math.cos(i),f=[],g=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const E=this.symbolInstances.get(b);f.push(0|Math.round(l*E.tileAnchorX+h*E.tileAnchorY)),g.push(E.featureIndex)}return y.sort((b,E)=>f[b]-f[E]||g[E]-g[b]),y}addToSortKeyRanges(i,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:S}=h;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&g!==f&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==f&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}yt(Kl,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Kl.MAX_GLYPHS=65535,Kl.addDynamicAttributes=Uy;const a4=new tt({"symbol-placement":new Ae(je.layout_symbol["symbol-placement"]),"symbol-spacing":new Ae(je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ae(je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ne(je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ae(je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ae(je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ae(je.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ae(je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ae(je.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ne(je.layout_symbol["icon-size"]),"icon-text-fit":new Ae(je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ae(je.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ne(je.layout_symbol["icon-image"]),"icon-rotate":new Ne(je.layout_symbol["icon-rotate"]),"icon-padding":new Ae(je.layout_symbol["icon-padding"]),"icon-keep-upright":new Ae(je.layout_symbol["icon-keep-upright"]),"icon-offset":new Ne(je.layout_symbol["icon-offset"]),"icon-anchor":new Ne(je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ae(je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ae(je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ae(je.layout_symbol["text-rotation-alignment"]),"text-field":new Ne(je.layout_symbol["text-field"]),"text-font":new Ne(je.layout_symbol["text-font"]),"text-size":new Ne(je.layout_symbol["text-size"]),"text-max-width":new Ne(je.layout_symbol["text-max-width"]),"text-line-height":new Ne(je.layout_symbol["text-line-height"]),"text-letter-spacing":new Ne(je.layout_symbol["text-letter-spacing"]),"text-justify":new Ne(je.layout_symbol["text-justify"]),"text-radial-offset":new Ne(je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ae(je.layout_symbol["text-variable-anchor"]),"text-anchor":new Ne(je.layout_symbol["text-anchor"]),"text-max-angle":new Ae(je.layout_symbol["text-max-angle"]),"text-writing-mode":new Ae(je.layout_symbol["text-writing-mode"]),"text-rotate":new Ne(je.layout_symbol["text-rotate"]),"text-padding":new Ae(je.layout_symbol["text-padding"]),"text-keep-upright":new Ae(je.layout_symbol["text-keep-upright"]),"text-transform":new Ne(je.layout_symbol["text-transform"]),"text-offset":new Ne(je.layout_symbol["text-offset"]),"text-allow-overlap":new Ae(je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ae(je.layout_symbol["text-ignore-placement"]),"text-optional":new Ae(je.layout_symbol["text-optional"])});var Z1={paint:new tt({"icon-opacity":new Ne(je.paint_symbol["icon-opacity"]),"icon-color":new Ne(je.paint_symbol["icon-color"]),"icon-halo-color":new Ne(je.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ne(je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ne(je.paint_symbol["icon-halo-blur"]),"icon-translate":new Ae(je.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ae(je.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ne(je.paint_symbol["text-opacity"]),"text-color":new Ne(je.paint_symbol["text-color"],{runtimeType:Ii,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Ne(je.paint_symbol["text-halo-color"]),"text-halo-width":new Ne(je.paint_symbol["text-halo-width"]),"text-halo-blur":new Ne(je.paint_symbol["text-halo-blur"]),"text-translate":new Ae(je.paint_symbol["text-translate"]),"text-translate-anchor":new Ae(je.paint_symbol["text-translate-anchor"])}),layout:a4};class pC{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Ss,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yt(pC,"FormatSectionOverride",{omit:["defaultValue"]});class Vy extends ko{constructor(i){super(i,Z1)}recalculate(i,l){super.recalculate(i,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const f=[];for(const g of h)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,l,h,f){const g=this.layout.get(i).evaluate(l,{},h,f),y=this._unevaluatedLayout._values[i];return y.isDataDriven()||Fl(y.value)||!g?g:function(b,E){return E.replace(/{([^{}]+)}/g,(S,M)=>M in b?String(b[M]):"")}(l.properties,g)}createBucket(i){return new Kl(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Z1.paint.overridableProperties){if(!Vy.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),h=new pC(l),f=new Uh(h,l.property.specification);let g=null;g=l.value.kind==="constant"||l.value.kind==="source"?new Vh("source",f):new qa("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[i]=new Ke(l.property,g,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&Vy.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const h=i.get("text-field"),f=Z1.paint.properties[l];let g=!1;const y=b=>{for(const E of b)if(f.overrides&&f.overrides.hasOverride(E))return void(g=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Ri)y(h.value.value.sections);else if(h.value.kind==="source"){const b=S=>{g||(S instanceof Yc&&Mr(S.value)===So?y(S.value.sections):S instanceof Kc?y(S.sections):S.eachChild(b))},E=h.value;E._styleExpression&&b(E._styleExpression.expression)}return g}getProgramConfiguration(i){return new Zl(this,i)}}var l4={paint:new tt({"background-color":new Ae(je.paint_background["background-color"]),"background-pattern":new Ae(je.paint_background["background-pattern"]),"background-opacity":new Ae(je.paint_background["background-opacity"])})},c4={paint:new tt({"raster-opacity":new Ae(je.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ae(je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ae(je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ae(je.paint_raster["raster-brightness-max"]),"raster-saturation":new Ae(je.paint_raster["raster-saturation"]),"raster-contrast":new Ae(je.paint_raster["raster-contrast"]),"raster-resampling":new Ae(je.paint_raster["raster-resampling"]),"raster-fade-duration":new Ae(je.paint_raster["raster-fade-duration"])})};class u4 extends ko{constructor(i){super(i,{}),this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var h4={paint:new tt({"sky-type":new Ae(je.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ae(je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ae(je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ae(je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ae(je.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ye(je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ae(je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ae(je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ae(je.paint_sky["sky-opacity"])})};function q1(a,i,l){const h=[0,0,1],f=F2([]);return B2(f,f,l?-rt(a)+Math.PI:rt(a)),N2(f,f,-rt(i)),L2(h,h,f),Li(h,h)}const d4={circle:class extends ko{constructor(a){super(a,EN)}createBucket(a){return new E1(a)}queryRadius(a){const i=a;return od("circle-radius",this,i)+od("circle-stroke-width",this,i)+yy(this.paint.get("circle-translate"))}queryIntersectsFeature(a,i,l,h,f,g,y,b){const E=oA(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(i,l)+this.paint.get("circle-stroke-width").evaluate(i,l);return aA(a,h,g,y,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,S)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Zl(this,a)}},heatmap:class extends ko{createBucket(a){return new cA(a)}constructor(a){super(a,CN),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=C1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return od("heatmap-radius",this,a)}queryIntersectsFeature(a,i,l,h,f,g,y,b){const E=this.paint.get("heatmap-radius").evaluate(i,l);return aA(a,h,g,y,b,!0,!0,new ue(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Zl(this,a)}},hillshade:class extends ko{constructor(a){super(a,MN)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ko{constructor(a){super(a,WN)}getProgramIds(){const a=this.paint.get("fill-pattern"),i=a&&a.constantOr(1),l=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new Zl(this,a)}recalculate(a,i){super.recalculate(a,i);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Ey(a)}queryRadius(){return yy(this.paint.get("fill-translate"))}queryIntersectsFeature(a,i,l,h,f,g){return!a.queryGeometry.isAboveHorizon&&tA(sA(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends ko{constructor(a){super(a,oB)}createBucket(a){return new qp(a)}queryRadius(){return yy(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Zl(this,a)}queryIntersectsFeature(a,i,l,h,f,g,y,b,E){const S=oA(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(i,l),R=this.paint.get("fill-extrusion-base").evaluate(i,l),k=[0,0],z=b&&g.elevation,N=g.elevation?g.elevation.exaggeration():1,V=a.tile.getBucket(this);if(z&&V instanceof qp){const me=V.centroidVertexArray,ve=E+1;ve<me.length&&(k[0]=me.geta_centroid_pos0(ve),k[1]=me.geta_centroid_pos1(ve))}if(k[0]===0&&k[1]===1)return!1;g.projection.name==="globe"&&(h=CA([h],[new ue(0,0),new ue(Ut,Ut)],a.tileID.canonical).map(me=>me.polygon).flat());const Y=z?b:null,[ce,ge]=function(me,ve,_e,De,ke,$e,nt,Be,He,qe,Je){return me.projection.name==="globe"?function(it,Ve,ct,zt,pt,bt,ut,Ft,rn,en,Jt){const Nt=[],En=[],$t=it.projection.upVectorScale(Jt,it.center.lat,it.worldSize).metersToTile,sn=[0,0,0,1],Rn=[0,0,0,1],Xn=(Yn,Jn,cr,Kr)=>{Yn[0]=Jn,Yn[1]=cr,Yn[2]=Kr,Yn[3]=1},Wn=AA();ct>0&&(ct+=Wn),zt+=Wn;for(const Yn of Ve){const Jn=[],cr=[];for(const Kr of Yn){const Tn=Kr.x+pt.x,Pr=Kr.y+pt.y,Er=it.projection.projectTilePoint(Tn,Pr,Jt),pn=it.projection.upVector(Jt,Kr.x,Kr.y);let nr=ct,Dr=zt;if(ut){const kn=RA(Tn,Pr,ct,zt,ut,Ft,rn,en);nr+=kn.base,Dr+=kn.top}ct!==0?Xn(sn,Er.x+pn[0]*$t*nr,Er.y+pn[1]*$t*nr,Er.z+pn[2]*$t*nr):Xn(sn,Er.x,Er.y,Er.z),Xn(Rn,Er.x+pn[0]*$t*Dr,Er.y+pn[1]*$t*Dr,Er.z+pn[2]*$t*Dr),mr(sn,sn,bt),mr(Rn,Rn,bt),Jn.push(new ud(sn[0],sn[1],sn[2])),cr.push(new ud(Rn[0],Rn[1],Rn[2]))}Nt.push(Jn),En.push(cr)}return[Nt,En]}(me,ve,_e,De,ke,$e,nt,Be,He,qe,Je):nt?function(it,Ve,ct,zt,pt,bt,ut,Ft,rn){const en=[],Jt=[],Nt=[0,0,0,1];for(const En of it){const $t=[],sn=[];for(const Rn of En){const Xn=Rn.x+zt.x,Wn=Rn.y+zt.y,Yn=RA(Xn,Wn,Ve,ct,bt,ut,Ft,rn);Nt[0]=Xn,Nt[1]=Wn,Nt[2]=Yn.base,Nt[3]=1,Au(Nt,Nt,pt),Nt[3]=Math.max(Nt[3],1e-5);const Jn=new ud(Nt[0]/Nt[3],Nt[1]/Nt[3],Nt[2]/Nt[3]);Nt[0]=Xn,Nt[1]=Wn,Nt[2]=Yn.top,Nt[3]=1,Au(Nt,Nt,pt),Nt[3]=Math.max(Nt[3],1e-5);const cr=new ud(Nt[0]/Nt[3],Nt[1]/Nt[3],Nt[2]/Nt[3]);$t.push(Jn),sn.push(cr)}en.push($t),Jt.push(sn)}return[en,Jt]}(ve,_e,De,ke,$e,nt,Be,He,qe):function(it,Ve,ct,zt,pt){const bt=[],ut=[],Ft=pt[8]*Ve,rn=pt[9]*Ve,en=pt[10]*Ve,Jt=pt[11]*Ve,Nt=pt[8]*ct,En=pt[9]*ct,$t=pt[10]*ct,sn=pt[11]*ct;for(const Rn of it){const Xn=[],Wn=[];for(const Yn of Rn){const Jn=Yn.x+zt.x,cr=Yn.y+zt.y,Kr=pt[0]*Jn+pt[4]*cr+pt[12],Tn=pt[1]*Jn+pt[5]*cr+pt[13],Pr=pt[2]*Jn+pt[6]*cr+pt[14],Er=pt[3]*Jn+pt[7]*cr+pt[15],pn=Kr+Ft,nr=Tn+rn,Dr=Pr+en,kn=Math.max(Er+Jt,1e-5),gr=Kr+Nt,bi=Tn+En,Jr=Pr+$t,Qr=Math.max(Er+sn,1e-5);Xn.push(new ud(pn/kn,nr/kn,Dr/kn)),Wn.push(new ud(gr/Qr,bi/Qr,Jr/Qr))}bt.push(Xn),ut.push(Wn)}return[bt,ut]}(ve,_e,De,ke,$e)}(g,h,R,M,S,y,Y,k,N,g.center.lat,a.tileID.canonical),ae=a.queryGeometry;return function(me,ve,_e){let De=1/0;tA(_e,ve)&&(De=IA(_e,ve[0]));for(let ke=0;ke<ve.length;ke++){const $e=ve[ke],nt=me[ke];for(let Be=0;Be<$e.length-1;Be++){const He=$e[Be],qe=[He,$e[Be+1],nt[Be+1],nt[Be],He];eA(_e,qe)&&(De=Math.min(De,IA(_e,qe)))}}return De!==1/0&&De}(ce,ge,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends ko{constructor(a){super(a,kA),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof ep,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,i){super.recalculate(a,i),this.paint._values["line-floorwidth"]=LA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new My(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Zl(this,a)}queryRadius(a){const i=a,l=OA(od("line-width",this,i),od("line-gap-width",this,i)),h=od("line-offset",this,i);return l/2+Math.abs(h)+yy(this.paint.get("line-translate"))}queryIntersectsFeature(a,i,l,h,f,g){if(a.queryGeometry.isAboveHorizon)return!1;const y=sA(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),b=a.pixelToTileUnitsFactor/2*OA(this.paint.get("line-width").evaluate(i,l),this.paint.get("line-gap-width").evaluate(i,l)),E=this.paint.get("line-offset").evaluate(i,l);return E&&(h=function(S,M){const R=[],k=new ue(0,0);for(let z=0;z<S.length;z++){const N=S[z],V=[];for(let Y=0;Y<N.length;Y++){const ce=N[Y-1],ge=N[Y],ae=N[Y+1],me=Y===0?k:ge.sub(ce)._unit()._perp(),ve=Y===N.length-1?k:ae.sub(ge)._unit()._perp(),_e=me._add(ve)._unit();_e._mult(1/(_e.x*ve.x+_e.y*ve.y)),V.push(_e._mult(M)._add(ge))}R.push(V)}return R}(h,E*a.pixelToTileUnitsFactor)),function(S,M,R){for(let k=0;k<M.length;k++){const z=M[k];if(S.length>=3){for(let N=0;N<z.length;N++)if(Iu(S,z[N]))return!0}if(vN(S,z,R))return!0}return!1}(y,h,b)}isTileClipped(){return!0}},symbol:Vy,background:class extends ko{constructor(a){super(a,l4)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ko{constructor(a){super(a,c4)}getProgramIds(){return["raster"]}},sky:class extends ko{constructor(a){super(a,h4),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=C1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(a,i){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),f=!h,g=a.style.light,y=g.properties.get("position");return f&&g.properties.get("anchor")==="viewport"&&Vn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?q1(y.azimuthal,90-y.polar,i):q1(h[0],90-h[1],i)}const l=this.paint.get("sky-gradient-center");return q1(l[0],90-l[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}}};class sm{constructor(i,l,h,f){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(l,f)}update(i,l,h){const{width:f,height:g}=i,{context:y}=this,{gl:b}=y,{HTMLImageElement:E,HTMLCanvasElement:S,HTMLVideoElement:M,ImageData:R,ImageBitmap:k}=v;if(b.bindTexture(b.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!l||l.premultiply!==!1)),h||this.size&&this.size[0]===f&&this.size[1]===g){const{x:z,y:N}=h||{x:0,y:0};i instanceof E||i instanceof S||i instanceof M||i instanceof R||k&&i instanceof k?b.texSubImage2D(b.TEXTURE_2D,0,z,N,b.RGBA,b.UNSIGNED_BYTE,i):b.texSubImage2D(b.TEXTURE_2D,0,z,N,f,g,b.RGBA,b.UNSIGNED_BYTE,i.data)}else this.size=[f,g],i instanceof E||i instanceof S||i instanceof M||i instanceof R||k&&i instanceof k?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,i):b.texImage2D(b.TEXTURE_2D,0,this.format,f,g,0,this.format,b.UNSIGNED_BYTE,i.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(i,l){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?i===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:i),this.filter=i),l!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class f4{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class p4{constructor(){this.tasks={},this.taskQueue=[],Fr(["process"],this),this.invoker=new f4(this.process),this.nextId=0}add(i,l){const h=this.nextId++,f=function({type:g,isSymbolTile:y,zoom:b}){return b=b||0,g==="message"?0:g!=="maybePrepare"||y?g!=="parseTile"||y?g==="parseTile"&&y?300-b:g==="maybePrepare"&&y?400-b:500:200-b:100-b}(l);if(f===0){Xr();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:i,metadata:l,priority:f,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){Xr();try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const l=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let i=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const g=this.tasks[this.taskQueue[f]];g.priority<l&&(l=g.priority,i=f)}if(i===null)return null;const h=this.taskQueue[i];return this.taskQueue.splice(i,1),h}remove(){this.invoker.remove()}}class mC{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const h=i[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const m4=["tile","layer","source","sourceLayer","state"];class gC{constructor(i,l,h,f,g){this.type="Feature",this._vectorTileFeature=i,this._z=l,this._x=h,this._y=f,this.properties=i.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(i.id=this.id);for(const l of m4)this[l]!==void 0&&(i[l]=this[l]);return i}}const to=32,xa=33,Jl=new Uint16Array(8184);for(let a=0;a<2046;a++){let i=a+2,l=0,h=0,f=0,g=0,y=0,b=0;for(1&i?f=g=y=to:l=h=b=to;(i>>=1)>1;){const S=l+f>>1,M=h+g>>1;1&i?(f=l,g=h,l=y,h=b):(l=f,h=g,f=y,g=b),y=S,b=M}const E=4*a;Jl[E+0]=l,Jl[E+1]=h,Jl[E+2]=f,Jl[E+3]=g}const ba=new Uint16Array(2178),Ql=new Uint8Array(1089),jy=new Uint16Array(1089);function _C(a){return a===0?-.03125:a===32?.03125:0}var yC=Mt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const vC={type:2,extent:Ut,loadGeometry:()=>[[new ue(0,0),new ue(8193,0),new ue(8193,8193),new ue(0,8193),new ue(0,0)]]};class X1{constructor(i,l,h,f,g){this.tileID=i,this.uid=Cn(),this.uses=0,this.tileSize=l,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(i){const l=i+this.timeAdded;l<un.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=ku(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,l,h){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(f,g){const y={};if(!g)return y;for(const b of f){const E=b.layerIds.map(S=>g.getLayer(S)).filter(Boolean);if(E.length!==0){b.layers=E,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(S=>E.filter(M=>M.id===S)[0]));for(const S of E)y[S.id]=b}}return y}(i.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof Kl){if(this.hasSymbolBuckets=!0,!h)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof Kl&&g.hasRTLText){this.hasRTLText=!0,Te.isLoading()||Te.isLoaded()||xe()!=="deferred"||ye();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(g))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new n1}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(i)}const l=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new sm(i,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new sm(i,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new sm(i,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,l,h,f,g,y,b,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:b,transform:y,params:g,tileTransform:this.tileTransform},i,l,h):{}}querySourceFeatures(i,l){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const f=h.loadVTLayers(),g=l?l.sourceLayer:"",y=f._geojsonTileLayer||f[g];if(!y)return;const b=Gh(l&&l.filter),{z:E,x:S,y:M}=this.tileID.canonical,R={z:E,x:S,y:M};for(let k=0;k<y.length;k++){const z=y.feature(k);if(b.needGeometry){const Y=Pu(z,!0);if(!b.filter(new Pe(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!b.filter(new Pe(this.tileID.overscaledZ),z))continue;const N=h.getId(z,g),V=new gC(z,E,S,M,N);V.tile=R,i.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const l=this.expirationTime;if(i.cacheControl){const h=Lr(i.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const h=Date.now();let f=!1;if(this.expirationTime>h)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const g=this.expirationTime-l;g?this.expirationTime=h+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0||!l)return;const h=this.latestFeatureIndex.loadVTLayers(),f=l.style.listImages();for(const g in this.buckets){if(!l.style.hasLayer(g))continue;const y=this.buckets[g],b=y.layers[0].sourceLayer||"_geojsonTileLayer",E=h[b],S=i[b];if(!E||!S||Object.keys(S).length===0)continue;if(y.update(S,E,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof My||y instanceof Ey){const R=l.style._getSourceCache(y.layers[0].source);l._terrain&&l._terrain.enabled&&R&&y.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(R.id,this.tileID)}const M=l&&l.style&&l.style.getLayer(g);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<un.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=un.now()+i}setTexture(i,l){const h=l.context,f=h.gl;this.texture=this.texture||l.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new sm(h,i,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),h.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax))}setDependencies(i,l){const h={};for(const f of l)h[f]=!0;this.dependencies[i]=h}hasDependency(i,l){for(const h of i){const f=this.dependencies[h];if(f){for(const g of l)if(f[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const h=Qa(vC,this.tileID.canonical,this.tileTransform)[0],f=new It,g=new pa;for(let y=0;y<h.length;y++){const{x:b,y:E}=h[y];f.emplaceBack(b,E),g.emplaceBack(y)}g.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(g),this._tileDebugBuffer=i.createVertexBuffer(f,Fp.members),this._tileDebugSegments=br.simpleSegment(0,0,f.length,g.length)}_makeTileBoundsBuffers(i,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const h=Qa(vC,this.tileID.canonical,this.tileTransform)[0];let f,g;if(this.isRaster){const y=function(b,E){const S=ku(b,E),M=Math.pow(2,b.z);for(let Y=0;Y<xa;Y++)for(let ce=0;ce<xa;ce++){const ge=Ms((b.x+(ce+_C(ce))/to)/M),ae=di((b.y+(Y+_C(Y))/to)/M),me=E.project(ge,ae),ve=Y*xa+ce;ba[2*ve+0]=Math.round((me.x*S.scale-S.x)*Ut),ba[2*ve+1]=Math.round((me.y*S.scale-S.y)*Ut)}Ql.fill(0),jy.fill(0);for(let Y=2045;Y>=0;Y--){const ce=4*Y,ge=Jl[ce+0],ae=Jl[ce+1],me=Jl[ce+2],ve=Jl[ce+3],_e=ge+me>>1,De=ae+ve>>1,ke=_e+De-ae,$e=De+ge-_e,nt=ae*xa+ge,Be=ve*xa+me,He=De*xa+_e,qe=Math.hypot((ba[2*nt+0]+ba[2*Be+0])/2-ba[2*He+0],(ba[2*nt+1]+ba[2*Be+1])/2-ba[2*He+1])>=16;if(Ql[He]=Ql[He]||(qe?1:0),Y<1022){const Je=(ae+$e>>1)*xa+(ge+ke>>1),it=(ve+$e>>1)*xa+(me+ke>>1);Ql[He]=Ql[He]||Ql[Je]||Ql[it]}}const R=new In,k=new hi;let z=0;function N(Y,ce){const ge=ce*xa+Y;return jy[ge]===0&&(R.emplaceBack(ba[2*ge+0],ba[2*ge+1],Y*Ut/to,ce*Ut/to),jy[ge]=++z),jy[ge]-1}function V(Y,ce,ge,ae,me,ve){const _e=Y+ge>>1,De=ce+ae>>1;if(Math.abs(Y-me)+Math.abs(ce-ve)>1&&Ql[De*xa+_e])V(me,ve,Y,ce,_e,De),V(ge,ae,me,ve,_e,De);else{const ke=N(Y,ce),$e=N(ge,ae),nt=N(me,ve);k.emplaceBack(ke,$e,nt)}}return V(0,0,to,to,to,0),V(to,to,0,0,0,to),{vertices:R,indices:k}}(this.tileID.canonical,l);f=y.vertices,g=y.indices}else{f=new In,g=new hi;for(const{x:b,y:E}of h)f.emplaceBack(b,E,0,0);const y=ad(f.int16,void 0,4);for(let b=0;b<y.length;b+=3)g.emplaceBack(y[b],y[b+1],y[b+2])}this._tileBoundsBuffer=i.createVertexBuffer(f,yC.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(g),this._tileBoundsSegments=br.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugBuffers(i,l){const h=l.projection;if(!h||h.name!=="globe"||l.freezeTileCoverage)return;const f=this.tileID.canonical,g=Up(G2(f,l)),y=id(l.zoom);let b;y>0&&(b=a1(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,f,l,g,b,y),this._makeGlobeTileDebugTextBuffer(i,f,l,g,b,y)}_globePoint(i,l,h,f,g,y,b){let E=Bp(i,l,h);if(y){const S=1<<h.z,M=_a(f.center.lng),R=ya(f.center.lat),k=(h.x+.5)/S-M;let z=0;k>.5?z=-1:k<-.5&&(z=1);let N=(i/Ut+h.x)/S+z,V=(l/Ut+h.y)/S;N=(N-M)*f._pixelsPerMercatorPixel+M,V=(V-R)*f._pixelsPerMercatorPixel+R;const Y=[N*f.worldSize,V*f.worldSize,0];mr(Y,Y,y),E=Mu(E,Y,b)}return mr(E,E,g)}_makeGlobeTileDebugBorderBuffer(i,l,h,f,g,y){const b=new It,E=new pa,S=new gn,M=(k,z,N,V,Y)=>{const ce=(N-k)/(Y-1),ge=(V-z)/(Y-1),ae=b.length;for(let me=0;me<Y;me++){const ve=k+me*ce,_e=z+me*ge;b.emplaceBack(ve,_e);const De=this._globePoint(ve,_e,l,h,f,g,y);S.emplaceBack(De[0],De[1],De[2]),E.emplaceBack(ae+me)}},R=Ut;M(0,0,R,0,16),M(R,0,R,R,16),M(R,R,0,R,16),M(0,R,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(E),this._tileDebugBuffer=i.createVertexBuffer(b,Fp.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(S,V2.members),this._tileDebugSegments=br.simpleSegment(0,0,b.length,E.length)}_makeGlobeTileDebugTextBuffer(i,l,h,f,g,y){const b=new It,E=new hi,S=new gn,M=25;E.reserve(32),b.reserve(M),S.reserve(M);const R=(k,z)=>M*k+z;for(let k=0;k<M;k++){const z=2048*k;for(let N=0;N<M;N++){const V=2048*N;b.emplaceBack(V,z);const Y=this._globePoint(V,z,l,h,f,g,y);S.emplaceBack(Y[0],Y[1],Y[2])}}for(let k=0;k<4;k++)for(let z=0;z<4;z++){const N=R(k,z),V=R(k,z+1),Y=R(k+1,z),ce=R(k+1,z+1);E.emplaceBack(N,V,Y),E.emplaceBack(Y,V,ce)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(E),this._tileDebugTextBuffer=i.createVertexBuffer(b,Fp.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(S,V2.members),this._tileDebugTextSegments=br.simpleSegment(0,0,M,32)}}class g4{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,l,h){const f=String(l);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][f]=this.stateChanges[i][f]||{},Ot(this.stateChanges[i][f],h),this.deletedStates[i]===null){this.deletedStates[i]={};for(const g in this.state[i])g!==f&&(this.deletedStates[i][g]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][f]===null){this.deletedStates[i][f]={};for(const g in this.state[i][f])h[g]||(this.deletedStates[i][f][g]=null)}else for(const g in h)this.deletedStates[i]&&this.deletedStates[i][f]&&this.deletedStates[i][f][g]===null&&delete this.deletedStates[i][f][g]}removeFeatureState(i,l,h){if(this.deletedStates[i]===null)return;const f=String(l);if(this.deletedStates[i]=this.deletedStates[i]||{},h&&l!==void 0)this.deletedStates[i][f]!==null&&(this.deletedStates[i][f]=this.deletedStates[i][f]||{},this.deletedStates[i][f][h]=null);else if(l!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][f])for(h in this.deletedStates[i][f]={},this.stateChanges[i][f])this.deletedStates[i][f][h]=null;else this.deletedStates[i][f]=null;else this.deletedStates[i]=null}getState(i,l){const h=String(l),f=Ot({},(this.state[i]||{})[h],(this.stateChanges[i]||{})[h]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const g=this.deletedStates[i][l];if(g===null)return{};for(const y in g)delete f[y]}return f}initializeTileState(i,l){i.setFeatureState(this.state,l)}coalesceChanges(i,l){const h={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),Ot(this.state[f][y],this.stateChanges[f][y]),g[y]=this.state[f][y];h[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(this.deletedStates[f]===null)for(const y in this.state[f])g[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(this.deletedStates[f][y]===null)this.state[f][y]={};else if(this.state[f][y])for(const b of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][b];g[y]=this.state[f][y]}h[f]=h[f]||{},Ot(h[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const f in i)i[f].setFeatureState(h,l)}}class xC{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,l){const h=this.toIdx(i,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(i,l){return this.leaves[this.toIdx(i,l)]}toIdx(i,l){return l*this.size+i}}function bC(a,i,l,h){let f=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(h[y])<1e-15){if(l[y]<a[y]||l[y]>i[y])return null}else{const b=1/h[y];let E=(a[y]-l[y])*b,S=(i[y]-l[y])*b;if(E>S){const M=E;E=S,S=M}if(E>f&&(f=E),S<g&&(g=S),f>g)return null}return f}function wC(a,i,l,h,f,g,y,b,E,S,M){const R=h-a,k=f-i,z=g-l,N=y-a,V=b-i,Y=E-l,ce=M[1]*Y-M[2]*V,ge=M[2]*N-M[0]*Y,ae=M[0]*V-M[1]*N,me=R*ce+k*ge+z*ae;if(Math.abs(me)<1e-15)return null;const ve=1/me,_e=S[0]-a,De=S[1]-i,ke=S[2]-l,$e=(_e*ce+De*ge+ke*ae)*ve;if($e<0||$e>1)return null;const nt=De*z-ke*k,Be=ke*R-_e*z,He=_e*k-De*R,qe=(M[0]*nt+M[1]*Be+M[2]*He)*ve;return qe<0||$e+qe>1?null:(N*nt+V*Be+Y*He)*ve}function EC(a,i,l){return(a-i)/(l-i)}function TC(a,i,l,h,f,g,y,b,E){const S=1<<l,M=g-h,R=y-f,k=(a+1)/S*M+h,z=(i+0)/S*R+f,N=(i+1)/S*R+f;b[0]=(a+0)/S*M+h,b[1]=z,E[0]=k,E[1]=N}class SC{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(g){const y=Math.ceil(Math.log2(g.dim/8)),b=[];let E=Math.ceil(Math.pow(2,y));const S=1/E,M=(z,N,V,Y,ce)=>{const ge=Y?1:0,ae=(z+1)*V-ge,me=N*V,ve=(N+1)*V-ge;ce[0]=z*V,ce[1]=me,ce[2]=ae,ce[3]=ve};let R=new xC(E);const k=[];for(let z=0;z<E*E;z++){M(z%E,Math.floor(z/E),S,!1,k);const N=ec(k[0],k[1],g),V=ec(k[2],k[1],g),Y=ec(k[2],k[3],g),ce=ec(k[0],k[3],g);R.minimums.push(Math.min(N,V,Y,ce)),R.maximums.push(Math.max(N,V,Y,ce)),R.leaves.push(1)}for(b.push(R),E/=2;E>=1;E/=2){const z=b[b.length-1];R=new xC(E);for(let N=0;N<E*E;N++){M(N%E,Math.floor(N/E),2,!0,k);const V=z.getElevation(k[0],k[1]),Y=z.getElevation(k[2],k[1]),ce=z.getElevation(k[2],k[3]),ge=z.getElevation(k[0],k[3]),ae=z.isLeaf(k[0],k[1]),me=z.isLeaf(k[2],k[1]),ve=z.isLeaf(k[2],k[3]),_e=z.isLeaf(k[0],k[3]),De=Math.min(V.min,Y.min,ce.min,ge.min),ke=Math.max(V.max,Y.max,ce.max,ge.max),$e=ae&&me&&ve&&_e;R.maximums.push(ke),R.minimums.push(De),R.leaves.push(ke-De<=5&&$e?1:0)}b.push(R)}return b}(this.dem),h=l.length-1,f=l[h];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(i,l,h,f,g,y,b=1){return bC([i,l,-100],[h,f,this.maximums[0]*b],g,y)}raycast(i,l,h,f,g,y,b=1){if(!this.nodeCount)return null;const E=this.raycastRoot(i,l,h,f,g,y,b);if(E==null)return null;const S=[],M=[],R=[],k=[],z=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:N,t:V,nodex:Y,nodey:ce,depth:ge}=z.pop();if(this.leaves[N]){TC(Y,ce,ge,i,l,h,f,R,k);const me=1<<ge,ve=(Y+0)/me,_e=(Y+1)/me,De=(ce+0)/me,ke=(ce+1)/me,$e=ec(ve,De,this.dem)*b,nt=ec(_e,De,this.dem)*b,Be=ec(_e,ke,this.dem)*b,He=ec(ve,ke,this.dem)*b,qe=wC(R[0],R[1],$e,k[0],R[1],nt,k[0],k[1],Be,g,y),Je=wC(k[0],k[1],Be,R[0],k[1],He,R[0],R[1],$e,g,y),it=Math.min(qe!==null?qe:Number.MAX_VALUE,Je!==null?Je:Number.MAX_VALUE);if(it!==Number.MAX_VALUE)return it;{const Ve=Dp([],g,y,V);if(AC($e,nt,He,Be,EC(Ve[0],R[0],k[0]),EC(Ve[1],R[1],k[1]))>=Ve[2])return V}continue}let ae=0;for(let me=0;me<this._siblingOffset.length;me++){TC((Y<<1)+this._siblingOffset[me][0],(ce<<1)+this._siblingOffset[me][1],ge+1,i,l,h,f,R,k),R[2]=-100,k[2]=this.maximums[this.childOffsets[N]+me]*b;const ve=bC(R,k,g,y);if(ve!=null){const _e=ve;S[me]=_e;let De=!1;for(let ke=0;ke<ae&&!De;ke++)_e>=S[M[ke]]&&(M.splice(ke,0,me),De=!0);De||(M[ae]=me),ae++}}for(let me=0;me<ae;me++){const ve=M[me];z.push({idx:this.childOffsets[N]+ve,t:S[ve],nodex:(Y<<1)+this._siblingOffset[ve][0],nodey:(ce<<1)+this._siblingOffset[ve][1],depth:ge+1})}}return null}_addNode(i,l,h){return this.minimums.push(i),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(i,l,h,f,g){if(i[f].isLeaf(l,h)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=f-1,b=i[y];let E=0,S=0;for(let M=0;M<this._siblingOffset.length;M++){const R=2*l+this._siblingOffset[M][0],k=2*h+this._siblingOffset[M][1],z=b.getElevation(R,k),N=b.isLeaf(R,k),V=this._addNode(z.min,z.max,N);N&&(E|=1<<M),S||(S=V)}for(let M=0;M<this._siblingOffset.length;M++)E&1<<M||this._construct(i,2*l+this._siblingOffset[M][0],2*h+this._siblingOffset[M][1],y,S+M)}}function AC(a,i,l,h,f,g){return ln(ln(a,l,g),ln(i,h,g),f)}function ec(a,i,l){const h=l.dim,f=jt(a*h-.5,0,h-1),g=jt(i*h-.5,0,h-1),y=Math.floor(f),b=Math.floor(g),E=Math.min(y+1,h-1),S=Math.min(b+1,h-1);return AC(l.get(y,b),l.get(E,b),l.get(y,S),l.get(E,S),f-y,g-b)}const CC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Gy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,l,h,f=!1,g=!1){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return Vn(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const y=this.dim=l.height-2,b=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=h||"mapbox",this.borderReady=f,!f){for(let E=0;E<y;E++)b[this._idx(-1,E)]=b[this._idx(0,E)],b[this._idx(y,E)]=b[this._idx(y-1,E)],b[this._idx(E,-1)]=b[this._idx(E,0)],b[this._idx(E,y)]=b[this._idx(E,y-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(y,-1)]=b[this._idx(y-1,0)],b[this._idx(-1,y)]=b[this._idx(0,y-1)],b[this._idx(y,y)]=b[this._idx(y-1,y-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new SC(this)}get(i,l,h=!1){h&&(i=jt(i,-1,this.dim),l=jt(l,-1,this.dim));const f=4*this._idx(i,l);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(i){return CC[i]}get unpackVector(){return CC[this.encoding]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}_unpackMapbox(i,l,h){return(256*i*256+256*l+h)/10-1e4}_unpackTerrarium(i,l,h){return 256*i+l+h/256-32768}static pack(i,l){const h=[0,0,0,0],f=Gy.getUnpackVector(l);let g=Math.floor((i+f[3])/f[2]);return h[2]=g%256,g=Math.floor(g/256),h[1]=g%256,g=Math.floor(g/256),h[0]=g,h}getPixels(){return new ds({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,l,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,g=l*this.dim+this.dim,y=h*this.dim,b=h*this.dim+this.dim;switch(l){case-1:f=g-1;break;case 1:g=f+1}switch(h){case-1:y=b-1;break;case 1:b=y+1}const E=-l*this.dim,S=-h*this.dim;for(let M=y;M<b;M++)for(let R=f;R<g;R++){const k=4*this._idx(R,M),z=4*this._idx(R+E,M+S);this.pixels[k+0]=i.pixels[z+0],this.pixels[k+1]=i.pixels[z+1],this.pixels[k+2]=i.pixels[z+2],this.pixels[k+3]=i.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}yt(Gy,"DEMData"),yt(SC,"DemMinMaxQuadTree",{omit:["dem"]});class _4{constructor(i,l){this.max=i,this.onRemove=l,this.reset()}reset(){for(const i in this.data)for(const l of this.data[i])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(i,l,h){const f=i.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const g={value:l,timeout:void 0};if(h!==void 0&&(g.timeout=setTimeout(()=>{this.remove(i,g)},h)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const l=this.data[i].shift();return l.timeout&&clearTimeout(l.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),l.value}getByKey(i){const l=this.data[i];return l?l[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,l){if(!this.has(i))return this;const h=i.wrapped().key,f=l===void 0?0:this.data[h].indexOf(l),g=this.data[h][f];return this.data[h].splice(f,1),g.timeout&&clearTimeout(g.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(g.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(i){const l=[];for(const h in this.data)for(const f of this.data[h])i(f.value)||l.push(f);for(const h of l)this.remove(h.value.tileID,h)}}class yd{constructor(i,l,h){this.func=i,this.mask=l,this.range=h}}yd.ReadOnly=!1,yd.ReadWrite=!0,yd.disabled=new yd(519,yd.ReadOnly,[0,1]);const Y1=7680;class K1{constructor(i,l,h,f,g,y){this.test=i,this.ref=l,this.mask=h,this.fail=f,this.depthFail=g,this.pass=y}}K1.disabled=new K1({func:519,mask:0},0,0,Y1,Y1,Y1);class wa{constructor(i,l,h){this.blendFunction=i,this.blendColor=l,this.mask=h}}wa.Replace=[1,0],wa.disabled=new wa(wa.Replace,vn.transparent,[!1,!1,!1,!1]),wa.unblended=new wa(wa.Replace,vn.transparent,[!0,!0,!0,!0]),wa.alphaBlended=new wa([1,771],vn.transparent,[!0,!0,!0,!0]);const J1=1029,Q1=2305;class zo{constructor(i,l,h){this.enable=i,this.mode=l,this.frontFace=h}}zo.disabled=new zo(!1,J1,Q1),zo.backCCW=new zo(!0,J1,Q1),zo.backCW=new zo(!0,J1,2304),zo.frontCW=new zo(!0,1028,2304),zo.frontCCW=new zo(!0,1028,Q1);class Lu extends Br{constructor(i,l,h){super(),this.id=i,this._onlySymbols=h,l.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new _4(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new g4,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const l=this._tiles[i];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,l){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,l)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const h=this._tiles[l];h.upload(i),h.prepare(this.map.style.imageManager)}}getIds(){return Gt(this._tiles).map(i=>i.tileID).sort(MC).map(i=>i.key)}getRenderableIds(i){const l=[];for(const h in this._tiles)this._isIdRenderable(+h,i)&&l.push(this._tiles[h]);return i?l.sort((h,f)=>{const g=h.tileID,y=f.tileID,b=new ue(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),E=new ue(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-y.overscaledZ||E.y-b.y||E.x-b.x}).map(h=>h.tileID.key):l.map(h=>h.tileID).sort(MC).map(h=>h.key)}hasRenderableParent(i){const l=this.findLoadedParent(i,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(i,l){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(l||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,l){const h=this._tiles[i];h&&(h.state!=="loading"&&(h.state=l),this._loadTile(h,this._tileLoaded.bind(this,h,i,l)))}_tileLoaded(i,l,h,f){if(f)if(i.state="errored",f.status!==404)this._source.fire(new yi(f,{tile:i}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=un.now(),h==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(l,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Kt("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const g=l[f];if(i.neighboringTiles&&i.neighboringTiles[g]){const y=this.getTileByID(g);h(i,y),h(y,i)}}function h(f,g){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=g.tileID.canonical.x-f.tileID.canonical.x;const b=g.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),S=g.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+E)===1?y+=E:Math.abs(y-E)===1&&(y-=E)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,y,b),f.neighboringTiles&&f.neighboringTiles[S]&&(f.neighboringTiles[S].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,l,h,f){for(const g in this._tiles){let y=this._tiles[g];if(f[g]||!y.hasData()||y.tileID.overscaledZ<=l||y.tileID.overscaledZ>h)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>l+1;){const S=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[S.key],y&&y.hasData()&&(b=S)}let E=b;for(;E.overscaledZ>l;)if(E=E.scaledTo(E.overscaledZ-1),i[E.key]){f[b.key]=b;break}}}findLoadedParent(i,l){if(i.key in this._loadedParentTiles){const h=this._loadedParentTiles[i.key];return h&&h.tileID.overscaledZ>=l?h:null}for(let h=i.overscaledZ-1;h>=l;h--){const f=i.scaledTo(h),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(i){const l=this._tiles[i.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,l){l=l||this._source.tileSize;const h=Math.ceil(i.width/l)+1,f=Math.ceil(i.height/l)+1,g=Math.floor(h*f*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(b)}handleWrapJump(i){const l=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,l){const h={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+l),h[g.tileID.key]=g}this._tiles=h;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(i,l,h){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let f;this.updateCacheSize(i,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new Di(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(f=i.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(b=>this._source.hasTile(b)))):f=[];const g=this._updateRetainedTiles(f);if(PC(this._source.type)&&f.length!==0){const b={},E={},S=Object.keys(g);for(const R of S){const k=g[R],z=this._tiles[R];if(!z||z.fadeEndTime&&z.fadeEndTime<=un.now())continue;const N=this.findLoadedParent(k,Math.max(k.overscaledZ-Lu.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),b[N.tileID.key]=N.tileID),E[R]=k}const M=f[f.length-1].overscaledZ;for(const R in this._tiles){const k=this._tiles[R];if(g[R]||!k.hasData())continue;let z=k.tileID;for(;z.overscaledZ>M;){z=z.scaledTo(z.overscaledZ-1);const N=this._tiles[z.key];if(N&&N.hasData()&&E[z.key]){g[R]=k.tileID;break}}}for(const R in b)g[R]||(this._coveredTiles[R]=!0,g[R]=b[R])}for(const b in g)this._tiles[b].clearFadeHold();const y=function(b,E){const S=[];for(const M in b)M in E||S.push(M);return S}(this._tiles,g);for(const b of y){const E=this._tiles[b];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const l={};if(i.length===0)return l;const h={},f=i.reduce((S,M)=>Math.min(S,M.overscaledZ),1/0),g=i[0].overscaledZ,y=Math.max(g-Lu.maxOverzooming,this._source.minzoom),b=Math.max(g+Lu.maxUnderzooming,this._source.minzoom),E={};for(const S of i){const M=this._addTile(S);l[S.key]=S,M.hasData()||f<this._source.maxzoom&&(E[S.key]=S)}this._retainLoadedChildren(E,f,b,l);for(const S of i){let M=this._tiles[S.key];if(M.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const k=S.children(this._source.maxzoom)[0],z=this.getTile(k);if(z&&z.hasData()){l[k.key]=k;continue}}else{const k=S.children(this._source.maxzoom);if(l[k[0].key]&&l[k[1].key]&&l[k[2].key]&&l[k[3].key])continue}let R=M.wasRequested();for(let k=S.overscaledZ-1;k>=y;--k){const z=S.scaledTo(k);if(h[z.key]||(h[z.key]=!0,M=this.getTile(z),!M&&R&&(M=this._addTile(z)),M&&(l[z.key]=z,R=M.wasRequested(),M.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const l=[];let h,f=this._tiles[i].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}l.push(f.key);const g=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(g),h)break;f=g}for(const g of l)this._loadedParentTiles[g]=h}}_addTile(i){let l=this._tiles[i.key];if(l)return l;l=this._cache.getAndRemove(i),l&&(this._setTileReloadTimer(i.key,l),l.tileID=i,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,l)));const h=!!l;if(!h){const f=this.map?this.map.painter:null;l=new X1(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,i.key,l.state))}return l?(l.uses++,this._tiles[i.key]=l,h||this._source.fire(new Kt("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(i,l){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const h=l.getExpiryTimeout();h&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},h))}_removeTile(i){const l=this._tiles[i];l&&(l.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,l,h){const f=[],g=this.transform;if(!g)return f;const y=g.projection.name==="globe",b=_a(g.center.lng);for(const E in this._tiles){const S=this._tiles[E];if(h&&S.clearQueryDebugViz(),S.holdingForFade())continue;let M;if(y){const R=S.tileID.canonical;if(R.z===0){const k=[Math.abs(jt(b,...om(R,-1))-b),Math.abs(jt(b,...om(R,1))-b)];M=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(jt(b,...om(R,-1))-b),Math.abs(jt(b,...om(R,0))-b),Math.abs(jt(b,...om(R,1))-b)];M=[k.indexOf(Math.min(...k))-1]}}else M=[0];for(const R of M){const k=i.containsTile(S,g,l,R);k&&f.push(k)}}return f}getVisibleCoordinates(i){const l=this.getRenderableIds(i).map(h=>this._tiles[h].tileID);for(const h of l)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(PC(this._source.type))for(const i in this._tiles){const l=this._tiles[i];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=un.now())return!0}return!1}setFeatureState(i,l,h){this._state.updateState(i=i||"_geojsonTileLayer",l,h)}removeFeatureState(i,l,h){this._state.removeFeatureState(i=i||"_geojsonTileLayer",l,h)}getFeatureState(i,l){return this._state.getState(i=i||"_geojsonTileLayer",l)}setDependencies(i,l,h){const f=this._tiles[i];f&&f.setDependencies(l,h)}reloadTilesForDependencies(i,l){for(const h in this._tiles)this._tiles[h].hasDependency(i,l)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(i,l))}_preloadTiles(i,l){const h=new Map,f=Array.isArray(i)?i:[i],g=this.map.painter.terrain,y=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const b of f){const E=b.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of E)h.set(S.key,S);this.usedForTerrain&&b.updateElevation(!1)}wt(Array.from(h.values()),(b,E)=>{const S=new X1(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,M=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),E(M,S)})},l)}}function MC(a,i){const l=Math.abs(2*a.wrap)-+(a.wrap<0),h=Math.abs(2*i.wrap)-+(i.wrap<0);return a.overscaledZ-i.overscaledZ||h-l||i.canonical.y-a.canonical.y||i.canonical.x-a.canonical.x}function PC(a){return a==="raster"||a==="image"||a==="video"||a==="custom"}function om(a,i){const l=1<<a.z;return[a.x/l+i,(a.x+1)/l+i]}Lu.maxOverzooming=10,Lu.maxUnderzooming=3;class Wy{constructor(i,l,h){this._demTile=i,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(i,l,h){const f=h||i.findDEMTileFor(l);if(!f||!f.dem)return;const g=f.dem,y=f.tileID,b=1<<l.canonical.z-y.canonical.z;return new Wy(f,f.tileSize/Ut/b,[(l.canonical.x/b-y.canonical.x)*g.dim,(l.canonical.y/b-y.canonical.y)*g.dim])}tileCoordToPixel(i,l){const h=l*this._scale+this._offset[1],f=Math.floor(i*this._scale+this._offset[0]),g=Math.floor(h);return new ue(f,g)}getElevationAt(i,l,h,f){const g=i*this._scale+this._offset[0],y=l*this._scale+this._offset[1],b=Math.floor(g),E=Math.floor(y),S=this._dem;return f=!!f,h?ln(ln(S.get(b,E,f),S.get(b,E+1,f),y-E),ln(S.get(b+1,E,f),S.get(b+1,E+1,f),y-E),g-b):S.get(b,E,f)}getElevationAtPixel(i,l,h){return this._dem.get(i,l,!!h)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Do(1,i)*this._dem.stride}}class IC{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new jl(Ut,16,0),this.featureIndexArray=new x2,this.promoteId=l}insert(i,l,h,f,g,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,f,g,y);const E=this.grid;for(let S=0;S<l.length;S++){const M=l[S],R=[1/0,1/0,-1/0,-1/0];for(let k=0;k<M.length;k++){const z=M[k];R[0]=Math.min(R[0],z.x),R[1]=Math.min(R[1],z.y),R[2]=Math.max(R[2],z.x),R[3]=Math.max(R[3],z.y)}R[0]<Ut&&R[1]<Ut&&R[2]>=0&&R[3]>=0&&E.insert(b,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new O1(new Jp(this.rawTileData)).layers,this.sourceLayerCoder=new mC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,l,h,f){this.loadVTLayers();const g=i.params||{},y=Gh(g.filter),b=i.tileResult,E=i.transform,S=b.bufferedTilespaceBounds,M=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(N,V,Y,ce)=>iA(b.bufferedTilespaceGeometry,N,V,Y,ce));M.sort(y4);let R=null;E.elevation&&M.length>0&&(R=Wy.create(E.elevation,this.tileID));const k={};let z;for(let N=0;N<M.length;N++){const V=M[N];if(V===z)continue;z=V;const Y=this.featureIndexArray.get(V);let ce=null;this.loadMatchingFeature(k,Y,y,g.layers,g.availableImages,l,h,f,(ge,ae,me,ve=0)=>(ce||(ce=Qa(ge,this.tileID.canonical,i.tileTransform)),ae.queryIntersectsFeature(b,ge,me,ce,this.z,i.transform,i.pixelPosMatrix,R,ve)))}return k}loadMatchingFeature(i,l,h,f,g,y,b,E,S){const{featureIndex:M,bucketIndex:R,sourceLayerIndex:k,layoutVertexArrayOffset:z}=l,N=this.bucketLayerIDs[R];if(f&&!function(ge,ae){for(let me=0;me<ge.length;me++)if(ae.indexOf(ge[me])>=0)return!0;return!1}(f,N))return;const V=this.sourceLayerCoder.decode(k),Y=this.vtLayers[V].feature(M);if(h.needGeometry){const ge=Pu(Y,!0);if(!h.filter(new Pe(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!h.filter(new Pe(this.tileID.overscaledZ),Y))return;const ce=this.getId(Y,V);for(let ge=0;ge<N.length;ge++){const ae=N[ge];if(f&&f.indexOf(ae)<0)continue;const me=y[ae];if(!me)continue;let ve={};ce!==void 0&&E&&(ve=E.getState(me.sourceLayer||"_geojsonTileLayer",ce));const _e=Ot({},b[ae]);_e.paint=RC(_e.paint,me.paint,Y,ve,g),_e.layout=RC(_e.layout,me.layout,Y,ve,g);const De=!S||S(Y,me,ve,z);if(!De)continue;const ke=new gC(Y,this.z,this.x,this.y,ce);ke.layer=_e;let $e=i[ae];$e===void 0&&($e=i[ae]=[]),$e.push({featureIndex:M,feature:ke,intersectionZ:De})}}lookupSymbolFeatures(i,l,h,f,g,y,b,E){const S={};this.loadVTLayers();const M=Gh(g);for(const R of i)this.loadMatchingFeature(S,{bucketIndex:h,sourceLayerIndex:f,featureIndex:R,layoutVertexArrayOffset:0},M,y,b,E,l);return S}loadFeature(i){const{featureIndex:l,sourceLayerIndex:h}=i;this.loadVTLayers();const f=this.sourceLayerCoder.decode(h),g=this.vtFeatures[f];if(g[l])return g[l];const y=this.vtLayers[f].feature(l);return g[l]=y,y}hasLayer(i){for(const l of this.bucketLayerIDs)for(const h of l)if(i===h)return!0;return!1}getId(i,l){let h=i.id;if(this.promoteId){const f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[l];f!=null&&(h=i.properties[f]),typeof h=="boolean"&&(h=Number(h))}return h}}function RC(a,i,l,h,f){return Zr(a,(g,y)=>{const b=i instanceof Oe?i.get(y):null;return b&&b.evaluate?b.evaluate(l,h,f):b})}function y4(a,i){return i-a}yt(IC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class kC{constructor(i,l){this.width=i,this.height=l,this.nextRow=0,this.image=new el({width:i,height:l}),this.positions={},this.uploaded=!1}getDash(i,l){const h=this.getKey(i,l);return this.positions[h]}trim(){const i=this.width,l=this.height=pr(this.nextRow);this.image.resize({width:i,height:l})}getKey(i,l){return i.join(",")+l}getDashRanges(i,l,h){const f=[];let g=i.length%2==1?-i[i.length-1]*h:0,y=i[0]*h,b=!0;f.push({left:g,right:y,isDash:b,zeroLength:i[0]===0});let E=i[0];for(let S=1;S<i.length;S++){b=!b;const M=i[S];g=E*h,E+=M,y=E*h,f.push({left:g,right:y,isDash:b,zeroLength:M===0})}return f}addRoundDash(i,l,h){const f=l/2;for(let g=-h;g<=h;g++){const y=this.width*(this.nextRow+h+g);let b=0,E=i[b];for(let S=0;S<this.width;S++){S/E.right>1&&(E=i[++b]);const M=Math.abs(S-E.left),R=Math.abs(S-E.right),k=Math.min(M,R);let z;const N=g/h*(f+1);if(E.isDash){const V=f-Math.abs(N);z=Math.sqrt(k*k+V*V)}else z=f-Math.sqrt(k*k+N*N);this.image.data[y+S]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(i,l){for(let E=i.length-1;E>=0;--E){const S=i[E],M=i[E+1];S.zeroLength?i.splice(E,1):M&&M.isDash===S.isDash&&(M.left=S.left,i.splice(E,1))}const h=i[0],f=i[i.length-1];h.isDash===f.isDash&&(h.left=f.left-this.width,f.right=h.right+this.width);const g=this.width*this.nextRow;let y=0,b=i[y];for(let E=0;E<this.width;E++){E/b.right>1&&(b=i[++y]);const S=Math.abs(E-b.left),M=Math.abs(E-b.right),R=Math.min(S,M);this.image.data[g+E]=Math.max(0,Math.min(255,(b.isDash?R:-R)+l+128))}}addDash(i,l){const h=this.getKey(i,l);if(this.positions[h])return this.positions[h];const f=l==="round",g=f?7:0,y=2*g+1;if(this.nextRow+y>this.height)return Vn("LineAtlas out of space"),null;i.length===0&&i.push(1);let b=0;for(let M=0;M<i.length;M++)i[M]<0&&(Vn("Negative value is found in line dasharray, replacing values with 0"),i[M]=0),b+=i[M];if(b!==0){const M=this.width/b,R=this.getDashRanges(i,this.width,M);f?this.addRoundDash(R,M,g):this.addRegularDash(R,l==="square"?.5*M:0)}const E=this.nextRow+g;this.nextRow+=y;const S={tl:[E,g],br:[b,0]};return this.positions[h]=S,S}}yt(kC,"LineAtlas");class LC{constructor(i){const l={},h=[];for(const b in i){const E=i[b],S=l[b]={};for(const M in E.glyphs){const R=E.glyphs[+M];if(!R||R.bitmap.width===0||R.bitmap.height===0)continue;const k=R.metrics.localGlyph?2:1,z={x:0,y:0,w:R.bitmap.width+2*k,h:R.bitmap.height+2*k};h.push(z),S[M]=z}}const{w:f,h:g}=F1(h),y=new el({width:f||1,height:g||1});for(const b in i){const E=i[b];for(const S in E.glyphs){const M=E.glyphs[+S];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const R=l[b][S],k=M.metrics.localGlyph?2:1;el.copy(M.bitmap,y,{x:0,y:0},{x:R.x+k,y:R.y+k},M.bitmap)}}this.image=y,this.positions=l}}yt(LC,"GlyphAtlas");class v4{constructor(i){this.tileID=new Di(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=ku(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,l,h,f,g){this.status="parsing",this.data=i,this.collisionBoxArray=new n1;const y=new mC(Object.keys(i.layers).sort()),b=new IC(this.tileID,this.promoteId);b.bucketLayerIDs=[];const E={},S=new kC(256,256),M={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:h},R=l.familiesBySource[this.source];for(const ve in R){const _e=i.layers[ve];if(!_e)continue;let De=!1,ke=!1;for(const Be of R[ve])Be[0].type==="symbol"?De=!0:ke=!0;if(this.isSymbolTile===!0&&!De||this.isSymbolTile===!1&&!ke)continue;_e.version===1&&Vn(`Vector tile source "${this.source}" layer "${ve}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const $e=y.encode(ve),nt=[];for(let Be=0;Be<_e.length;Be++){const He=_e.feature(Be),qe=b.getId(He,ve);nt.push({feature:He,id:qe,index:Be,sourceLayerIndex:$e})}for(const Be of R[ve]){const He=Be[0];this.isSymbolTile!==void 0&&He.type==="symbol"!==this.isSymbolTile||He.minzoom&&this.zoom<Math.floor(He.minzoom)||He.maxzoom&&this.zoom>=He.maxzoom||He.visibility!=="none"&&(eb(Be,this.zoom,h),(E[He.id]=He.createBucket({index:b.bucketLayerIDs.length,layers:Be,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$e,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate(nt,M,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(Be.map(qe=>qe.id)))}}let k,z,N,V;S.trim();const Y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ce=Zr(M.glyphDependencies,ve=>Object.keys(ve).map(Number));Object.keys(ce).length?f.send("getGlyphs",{uid:this.uid,stacks:ce},(ve,_e)=>{k||(k=ve,z=_e,me.call(this))},void 0,!1,Y):z={};const ge=Object.keys(M.iconDependencies);ge.length?f.send("getImages",{icons:ge,source:this.source,tileID:this.tileID,type:"icons"},(ve,_e)=>{k||(k=ve,N=_e,me.call(this))},void 0,!1,Y):N={};const ae=Object.keys(M.patternDependencies);function me(){if(k)return g(k);if(z&&N&&V){const ve=new LC(z),_e=new jA(N,V);for(const De in E){const ke=E[De];ke instanceof Kl?(eb(ke.layers,this.zoom,h),ZB(ke,z,ve.positions,N,_e.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):ke.hasPattern&&(ke instanceof My||ke instanceof Ey||ke instanceof qp)&&(eb(ke.layers,this.zoom,h),ke.addFeatures(M,this.tileID.canonical,_e.patternPositions,h,this.tileTransform))}this.status="done",g(null,{buckets:Gt(E).filter(De=>!De.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ve.image,lineAtlas:S,imageAtlas:_e,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?ve.positions:null})}}ae.length?f.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"patterns"},(ve,_e)=>{k||(k=ve,V=_e,me.call(this))},void 0,!1,Y):V={},me.call(this)}}function eb(a,i,l){const h=new Pe(i);for(const f of a)f.recalculate(h,l)}class OC{constructor(i){this.entries={},this.scheduler=i}request(i,l,h,f){const g=this.entries[i]=this.entries[i]||{callbacks:[]};if(g.result){const[y,b]=g.result;return this.scheduler?this.scheduler.add(()=>{f(y,b)},l):f(y,b),()=>{}}return g.callbacks.push(f),g.cancel||(g.cancel=h((y,b)=>{g.result=[y,b];for(const E of g.callbacks)this.scheduler?this.scheduler.add(()=>{E(y,b)},l):E(y,b);setTimeout(()=>delete this.entries[i],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(y=>y!==f),g.callbacks.length||(g.cancel(),delete this.entries[i]))}}}function DC(a,i,l){const h=JSON.stringify(a.request);return a.data&&(this.deduped.entries[h]={result:[null,a.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const g=bo(a.request,(y,b,E,S)=>{y?f(y):b&&f(null,{vectorTile:l?void 0:new O1(new Jp(b)),rawData:b,cacheControl:E,expires:S})});return()=>{g.cancel(),f()}},i)}o.ARRAY_TYPE=hs,o.AUTH_ERR_MSG=wo,o.Aabb=Oi,o.Actor=class{constructor(a,i,l){this.target=a,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Fr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Xr()?a:v,this.scheduler=new p4}send(a,i,l,h,f=!1,g){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=g,this.callbacks[y]=l);const b=rs(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:a,hasCallback:!!l,targetMapId:h,mustQueue:f,sourceMapId:this.mapId,data:_u(i,b)},b),{cancel:()=>{l&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(a){const i=a.data,l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(i.mustQueue||Xr()){const h=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,i),h&&h.metadata||{type:"message"})}else this.processTask(l,i)}processTask(a,i){if(i.type==="<response>"){const l=this.callbacks[a];delete this.callbacks[a],l&&(i.error?l(yu(i.error)):l(null,yu(i.data)))}else{const l=rs(this.globalScope)?void 0:[],h=i.hasCallback?(g,y)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:g?_u(g):null,data:_u(y,l)},l)}:g=>{},f=yu(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,h);else if(this.parent.getWorkerSource){const g=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,g[0],f.source)[g[1]](f,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Cy,o.Color=vn,o.ColorMode=wa,o.CullFaceMode=zo,o.DEMData=Gy,o.DataConstantProperty=Ae,o.DedupedRequest=OC,o.DepthMode=yd,o.EXTENT=Ut,o.Elevation=class{isDataAvailableAtPoint(a){const i=this._source();if(this.isUsingMockSource()||!i||a.y<0||a.y>1)return!1;const l=i.getSource().maxzoom,h=1<<l,f=Math.floor(a.x),g=Math.floor((a.x-f)*h),y=Math.floor(a.y*h),b=this.findDEMTileFor(new Di(l,f,l,g,y));return!(!b||!b.dem)}getAtPointOrZero(a,i=0){return this.getAtPoint(a,i)||0}getAtPoint(a,i,l=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const h=this._source();if(!h||a.y<0||a.y>1)return i;const f=h.getSource().maxzoom,g=1<<f,y=Math.floor(a.x),b=a.x-y,E=new Di(f,y,f,Math.floor(b*g),Math.floor(a.y*g)),S=this.findDEMTileFor(E);if(!S||!S.dem)return i;const M=S.dem,R=1<<S.tileID.canonical.z,k=(b*R-S.tileID.canonical.x)*M.dim,z=(a.y*R-S.tileID.canonical.y)*M.dim,N=Math.floor(k),V=Math.floor(z);return(l?this.exaggeration():1)*ln(ln(M.get(N,V),M.get(N,V+1),z-V),ln(M.get(N+1,V),M.get(N+1,V+1),z-V),k-N)}getAtTileOffset(a,i,l){const h=1<<a.canonical.z;return this.getAtPointOrZero(new sd(a.wrap+(a.canonical.x+i/Ut)/h,(a.canonical.y+l/Ut)/h))}getAtTileOffsetFunc(a,i,l,h){return f=>{const g=this.getAtTileOffset(a,f.x,f.y),y=h.upVector(a.canonical,f.x,f.y);return Cs(y,y,g*h.upVectorScale(a.canonical,i,l).metersToTile),y}}getForTilePoints(a,i,l,h){if(this.isUsingMockSource())return!1;const f=Wy.create(this,a,h);return!!f&&(i.forEach(g=>{g[2]=this.exaggeration()*f.getElevationAt(g[0],g[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(a);if(!i||!i.dem)return null;const l=i.dem.tree,h=i.tileID,f=1<<a.canonical.z-h.canonical.z;let g=a.canonical.x/f-h.canonical.x,y=a.canonical.y/f-h.canonical.y,b=0;for(let E=0;E<a.canonical.z-h.canonical.z&&!l.leaves[b];E++){g*=2,y*=2;const S=2*Math.floor(y)+Math.floor(g);b=l.childOffsets[b]+S,g%=1,y%=1}return{min:this.exaggeration()*l.minimums[b],max:this.exaggeration()*l.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,i,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=yi,o.EvaluationParameters=Pe,o.Event=Kt,o.Evented=Br,o.FillExtrusionBucket=qp,o.Frustum=p1,o.FrustumCorners=f1,o.GLOBE_RADIUS=ma,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,i){const l=new It,h=new hi,f=[],g=a+1+2,y=i[0]+1,b=i[0]+1+(1+i.length),E=(S,M,R)=>{let k=S===g-1?S-2:S===0?S:S-1;return k+=R?24575:0,[k,M]};for(let S=0;S<g;++S)l.emplaceBack(...E(S,0,!0));for(let S=0;S<y;++S)for(let M=0;M<g;++M)l.emplaceBack(...E(M,S,(M===0||M===g-1)&&!0));for(let S=0;S<i.length;++S){const M=i[S];for(let R=0;R<g;++R)l.emplaceBack(...E(R,M,!0))}for(let S=0;S<i.length;++S){const M=h.length,R=i[S]+1+2,k=new hi;for(let V=0;V<R-1;V++){const Y=V===R-2,ce=Y?g*(b-i.length+S-V):g;for(let ge=0;ge<g-1;ge++){const ae=V*g+ge;V===0||Y||ge===0||ge===g-2?(k.emplaceBack(ae+1,ae,ae+ce),k.emplaceBack(ae+ce,ae+ce+1,ae+1)):(h.emplaceBack(ae+1,ae,ae+ce),h.emplaceBack(ae+ce,ae+ce+1,ae+1))}}const z=br.simpleSegment(0,M,l.length,h.length-M);for(let V=0;V<k.uint16.length;V+=3)h.emplaceBack(k.uint16[V],k.uint16[V+1],k.uint16[V+2]);const N=br.simpleSegment(0,M,l.length,h.length-M);f.push({withoutSkirts:z,withSkirts:N})}return{vertices:l,indices:h,segments:f}}_createGrid(a){const i=this._fillGridMeshWithLods(Cu,Np);this._gridSegments=i.segments,this._gridBuffer=a.createVertexBuffer(i.vertices,Fp.members),this._gridIndexBuffer=a.createIndexBuffer(i.indices,!0)}_createPoles(a){const i=new hi;for(let f=0;f<=Cu;f++)i.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=a.createIndexBuffer(i,!0);const l=new us,h=new us;this._poleSegments=[];for(let f=0,g=0;f<5;f++){const y=360/(1<<f);l.emplaceBack(0,-ma,0,.5,0),h.emplaceBack(0,-ma,0,.5,1);for(let b=0;b<=Cu;b++){const E=b/Cu,S=ln(0,y,E),[M,R,k]=nd(pN,mN,S,ma);l.emplaceBack(M,R,k,E,0),h.emplaceBack(M,R,k,E,1)}this._poleSegments.push(br.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,U2,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(h,U2,!1)}getGridBuffers(a,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,i){if(!this._wireframeSegments){const l=new fa,h=Cu,f=h+1+2,g=1;this._wireframeSegments=[];for(let y=0,b=0;y<Np.length;y++){const E=Np[y];for(let M=g;M<E+g;M++)for(let R=g;R<h+g;R++){const k=M*f+R;l.emplaceBack(k,k+1),l.emplaceBack(k,k+f),l.emplaceBack(k,k+f+1)}const S=E*h*3;this._wireframeSegments.push(br.simpleSegment(0,b,(E+1)*f,S)),b+=S}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},o.GlyphManager=md,o.ImagePosition=N1,o.LivePerformanceUtils=Xe,o.LngLat=hn,o.LngLatBounds=ql,o.LocalGlyphMode=V1,o.MAX_MERCATOR_LATITUDE=fi,o.MercatorCoordinate=sd,o.ONE_EM=pi,o.OverscaledTileID=Di,o.PerformanceMarkers=Re,o.Properties=tt,o.RGBAImage=ds,o.Ray=d1,o.RequestManager=class{constructor(a,i,l){this._transformRequestFn=a,this._customAccessToken=i,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let i="";for(let l=0;l<10;l++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",H,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,i){return this._transformRequestFn&&this._transformRequestFn(a,i)||{url:a}}normalizeStyleURL(a,i){if(!Mi(a))return a;const l=ai(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||i)}normalizeGlyphsURL(a,i){if(!Mi(a))return a;const l=ai(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||i)}normalizeSourceURL(a,i,l,h){if(!Mi(a))return a;const f=ai(a);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),l&&f.params.push(`language=${l}`),h&&f.params.push(`worldview=${h}`),this._makeAPIURL(f,this._customAccessToken||i)}normalizeSpriteURL(a,i,l,h){const f=ai(a);return Mi(a)?(f.path=`/styles/v1${f.path}/sprite${i}${l}`,this._makeAPIURL(f,this._customAccessToken||h)):(f.path+=`${i}${l}`,qs(f))}normalizeTileURL(a,i,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Mi(a))return a;const h=ai(a);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||l&&h.authority!=="raster"&&l===512?"@2x":""}${F.supported?".webp":"$1"}`),h.authority==="raster"?h.path=`/${L.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${L.TILE_URL_VERSION}${h.path}`);const f=this._customAccessToken||function(g){for(const y of g){const b=y.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(h.params)||L.ACCESS_TOKEN;return L.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,f)}canonicalizeTileURL(a,i){const l=ai(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let h="mapbox://";l.path.match(/^\/raster\/v1\//)?h+=`raster/${l.path.replace(`/${L.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${l.path.replace(`/${L.TILE_URL_VERSION}/`,"")}`;let f=l.params;return i&&(f=f.filter(g=>!g.match(/^access_token=/))),f.length&&(h+=`?${f.join("&")}`),h}canonicalizeTileset(a,i){const l=!!i&&Mi(i),h=[];for(const f of a.tiles||[])Zs(f)?h.push(this.canonicalizeTileURL(f,l)):h.push(f);return h}_makeAPIURL(a,i){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",h=ai(L.API_URL);if(a.protocol=h.protocol,a.authority=h.authority,a.protocol==="http"){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if(h.path!=="/"&&(a.path=`${h.path}${a.path}`),!L.REQUIRE_ACCESS_TOKEN)return qs(a);if(i=i||L.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>f.indexOf("access_token")===-1),a.params.push(`access_token=${i||""}`),qs(a)}},o.ResourceType=vo,o.SegmentVector=br,o.SourceCache=Lu,o.StencilMode=K1,o.StructArrayLayout1ui2=pa,o.StructArrayLayout2f1f2i16=ci,o.StructArrayLayout2i4=It,o.StructArrayLayout2ui4=fa,o.StructArrayLayout3f12=ui,o.StructArrayLayout3ui6=hi,o.StructArrayLayout4i8=In,o.StructArrayLayout5f20=us,o.Texture=sm,o.Tile=X1,o.Transitionable=st,o.Uniform1f=cy,o.Uniform1i=class extends Ya{constructor(a){super(a),this.current=0}set(a,i,l){this.fetchUniformLocation(a,i)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},o.Uniform2f=class extends Ya{constructor(a){super(a),this.current=[0,0]}set(a,i,l){this.fetchUniformLocation(a,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},o.Uniform3f=class extends Ya{constructor(a){super(a),this.current=[0,0,0]}set(a,i,l){this.fetchUniformLocation(a,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},o.Uniform4f=T2,o.UniformColor=S2,o.UniformMatrix2f=class extends Ya{constructor(a){super(a),this.current=QF}set(a,i,l){if(this.fetchUniformLocation(a,i)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}},o.UniformMatrix3f=class extends Ya{constructor(a){super(a),this.current=JF}set(a,i,l){if(this.fetchUniformLocation(a,i)){for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},o.UniformMatrix4f=class extends Ya{constructor(a){super(a),this.current=KF}set(a,i,l){if(this.fetchUniformLocation(a,i)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},o.UnwrappedTileID=PA,o.ValidationError=mt,o.VectorTileFeature=Sy,o.VectorTileWorkerSource=class extends Br{constructor(a,i,l,h,f){super(),this.actor=a,this.layerIndex=i,this.availableImages=l,this.loadVectorData=f||DC,this.loading={},this.loaded={},this.deduped=new OC(a.scheduler),this.isSpriteLoaded=h,this.scheduler=a.scheduler}loadTile(a,i){const l=a.uid,h=a&&a.request,f=h&&h.collectResourceTiming,g=this.loading[l]=new v4(a);g.abort=this.loadVectorData(a,(y,b)=>{const E=!this.loading[l];if(delete this.loading[l],E||y||!b)return g.status="done",E||(this.loaded[l]=g),i(y);const S=b.rawData,M={};b.expires&&(M.expires=b.expires),b.cacheControl&&(M.cacheControl=b.cacheControl),g.vectorTile=b.vectorTile||new O1(new Jp(S));const R=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,z)=>{if(k||!z)return i(k);const N={};if(f){const V=Ct(h);V.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify(V)))}i(null,Ot({rawTileData:S.slice(0)},z,M,N))})};this.isSpriteLoaded?R():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(R,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):R()}),this.loaded=this.loaded||{},this.loaded[l]=g})}reloadTile(a,i){const l=this.loaded,h=a.uid,f=this;if(l&&l[h]){const g=l[h];g.showCollisionBoxes=a.showCollisionBoxes,g.enableTerrain=!!a.enableTerrain,g.projection=a.projection,g.tileTransform=ku(a.tileID.canonical,a.projection);const y=(b,E)=>{const S=g.reloadCallback;S&&(delete g.reloadCallback,g.parse(g.vectorTile,f.layerIndex,this.availableImages,f.actor,S)),i(b,E)};g.status==="parsing"?g.reloadCallback=y:g.status==="done"&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(a,i){const l=a.uid,h=this.loading[l];h&&(h.abort&&h.abort(),delete this.loading[l]),i()}removeTile(a,i){const l=this.loaded,h=a.uid;l&&l[h]&&delete l[h],i()}},o.WritingMode=Ps,o.ZoomDependentExpression=qa,o.add=Ja,o.addDynamicAttributes=Uy,o.adjoint=function(a,i){var l=i[0],h=i[1],f=i[2],g=i[3],y=i[4],b=i[5],E=i[6],S=i[7],M=i[8];return a[0]=y*M-b*S,a[1]=f*S-h*M,a[2]=h*b-f*y,a[3]=b*E-g*M,a[4]=l*M-f*E,a[5]=f*g-l*b,a[6]=g*S-y*E,a[7]=h*E-l*S,a[8]=l*y-h*g,a},o.asyncAll=wt,o.bezier=zn,o.bindAll=Fr,o.boundsAttributes=yC,o.bufferConvexPolygon=function(a,i){const l=[];for(let h=0;h<a.length;h++){const f=Ci(h-1,-1,a.length-1),g=Ci(h+1,-1,a.length-1),y=a[h],b=a[g],E=a[f].sub(y).unit(),S=b.sub(y).unit(),M=S.angleWithSep(E.x,E.y),R=E.add(S).unit().mult(-1*i/Math.sin(M/2));l.push(y.add(R))}return l},o.cacheEntryPossiblyAdded=function(a){yo++,yo>ra&&(a.getActor().send("enforceCacheSizeLimit",na),yo=0)},o.calculateGlobeLabelMatrix=function(a,i){const{x:l,y:h}=a.point,f=H2(l,h,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Tu(f,f,_1(ga(i)))},o.calculateGlobeMatrix=function(a){const{x:i,y:l}=a.point,{lng:h,lat:f}=a._center;return H2(i,l,a.worldSize,h,f)},o.calculateGlobeMercatorMatrix=function(a){const i=a.pixelsPerMeter,l=i/Do(1,a.center.lat),h=Lo(new Float64Array(16));return Rp(h,h,[a.point.x,a.point.y,0]),Su(h,h,[l,l,i]),Float32Array.from(h)},o.circumferenceAtLatitude=v1,o.clamp=jt,o.clearTileCache=function(a){if(!Va())return;const i=v.caches.delete(Or);a&&i.catch(a).then(()=>a())},o.clipLine=eC,o.clone=function(a){var i=new hs(16);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i[4]=a[4],i[5]=a[5],i[6]=a[6],i[7]=a[7],i[8]=a[8],i[9]=a[9],i[10]=a[10],i[11]=a[11],i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15],i},o.clone$1=Zn,o.collisionCircleLayout=vB,o.config=L,o.conjugate=function(a,i){return a[0]=-i[0],a[1]=-i[1],a[2]=-i[2],a[3]=i[3],a},o.create=function(){var a=new hs(16);return hs!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},o.create$1=C2,o.createExpression=Nl,o.createLayout=Mt,o.createStyleLayer=function(a){return a.type==="custom"?new u4(a):new d4[a.type](a)},o.cross=h1,o.degToRad=rt,o.distance=function(a,i){return Math.hypot(i[0]-a[0],i[1]-a[1],i[2]-a[2])},o.div=function(a,i,l){return a[0]=i[0]/l[0],a[1]=i[1]/l[1],a[2]=i[2]/l[2],a},o.dot=Js,o.earthRadius=Vp,o.ease=cn,o.easeCubicInOut=Dn,o.ecefToLatLng=function([a,i,l]){const h=Math.hypot(a,i,l),f=Math.atan2(a,l),g=.5*Math.PI-Math.acos(-i/h);return new hn(ht(f),ht(g))},o.emitValidationErrors=q_,o.endsWith=Mn,o.enforceCacheSizeLimit=function(a){Es(),Wi&&Wi.then(i=>{i.keys().then(l=>{for(let h=0;h<l.length-a;h++)i.delete(l[h])})})},o.evaluateSizeForFeature=Py,o.evaluateSizeForZoom=hd,o.evaluateVariableOffset=sC,o.evented=pe,o.exactEquals=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]&&a[3]===i[3]},o.exactEquals$1=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]},o.exported=un,o.exported$1=F,o.extend=Ot,o.extend$1=vi,o.fillExtrusionHeightLift=AA,o.filterObject=Hn,o.fromMat4=function(a,i){return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[4],a[4]=i[5],a[5]=i[6],a[6]=i[8],a[7]=i[9],a[8]=i[10],a},o.fromQuat=function(a,i){var l=i[0],h=i[1],f=i[2],g=i[3],y=l+l,b=h+h,E=f+f,S=l*y,M=h*y,R=h*b,k=f*y,z=f*b,N=f*E,V=g*y,Y=g*b,ce=g*E;return a[0]=1-R-N,a[1]=M+ce,a[2]=k-Y,a[3]=0,a[4]=M-ce,a[5]=1-S-N,a[6]=z+V,a[7]=0,a[8]=k+Y,a[9]=z-V,a[10]=1-S-R,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},o.fromRotation=function(a,i){var l=Math.sin(i),h=Math.cos(i);return a[0]=h,a[1]=l,a[2]=0,a[3]=-l,a[4]=h,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.fromScaling=P2,o.furthestTileCorner=function(a){const i=Math.round((a+45+360)%360/90)%4;return Bt[i]},o.getAABBPointSquareDist=function(a,i,l){let h=0;for(let f=0;f<2;++f){const g=l?l[f]:0;a[f]>g&&(h+=(a[f]-g)*(a[f]-g)),i[f]<g&&(h+=(g-i[f])*(g-i[f]))}return h},o.getAnchorAlignment=U1,o.getAnchorJustification=G1,o.getBounds=function(a){let i=1/0,l=1/0,h=-1/0,f=-1/0;for(const g of a)i=Math.min(i,g.x),l=Math.min(l,g.y),h=Math.max(h,g.x),f=Math.max(f,g.y);return{min:new ue(i,l),max:new ue(h,f)}},o.getColumn=is,o.getGridMatrix=function(a,i,l,h){const f=i.getNorth(),g=i.getSouth(),y=i.getWest(),b=i.getEast(),E=1<<a.z,S=b-y,M=f-g,R=S/Cu,k=-M/Np[l],z=[0,R,0,k,0,0,f,y,0];if(a.z>0){const N=180/h;M2(z,z,[N/S+1,0,0,0,N/M+1,0,-.5*N/R,.5*N/k,1])}return z[2]=E,z[5]=a.x,z[8]=a.y,z},o.getImage=Ga,o.getJSON=function(a,i){return Hs(Ot(a,{type:"json"}),i)},o.getLatitudinalLod=function(a){const i=fi-5;a=jt(a,-i,i)/i*90;const l=Math.pow(Math.abs(Math.sin(rt(a))),3);return Math.round(l*(Np.length-1))},o.getMapSessionAPI=Me,o.getPerformanceMeasurement=Ct,o.getProjection=fC,o.getRTLTextPluginStatus=xe,o.getReferrer=xo,o.getTilePoint=function(a,{x:i,y:l},h=0){return new ue(((i-h)*a.scale-a.x)*Ut,(l*a.scale-a.y)*Ut)},o.getTileVec3=function(a,i,l=0){return td(((i.x-l)*a.scale-a.x)*Ut,(i.y*a.scale-a.y)*Ut,Y2(i.z,i.y))},o.getVideo=function(a,i){const l=v.document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let h=0;h<a.length;h++){const f=v.document.createElement("source");ja(a[h])||(l.crossOrigin="Anonymous"),f.src=a[h],l.appendChild(f)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(a){const i=[0,0,0],l=Lo(new Float64Array(16));return Tu(l,a.pixelMatrix,a.globeMatrix),mr(i,i,l),new ue(i[0],i[1])},o.globeDenormalizeECEF=_1,o.globeECEFOrigin=function(a,i){const l=[0,0,0];return mr(l,l,Up(ga(i.canonical))),mr(l,l,a),l},o.globeMetersToEcef=fy,o.globeNormalizeECEF=Up,o.globePixelsToTileUnits=function(a,i){return Ut/(512*Math.pow(2,a))*my(ga(i))},o.globePoleMatrixForTile=function(a,i,l){const h=Lo(new Float64Array(16)),f=(i/(1<<a)-.5)*Math.PI*2;return dy(h,l.globeMatrix,f),Float32Array.from(h)},o.globeTileBounds=ga,o.globeTiltAtLngLat=Z2,o.globeToMercatorTransition=id,o.globeUseCustomAntiAliasing=function(a,i,l){const h=id(l.zoom),f=a.style.map._antialias,g=!!i.extStandardDerivatives,y=i.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return h===0&&!f&&!y&&g},o.identity=Lo,o.identity$1=F2,o.invert=a1,o.isFullscreen=function(){return!!v.document.fullscreenElement||!!v.document.webkitFullscreenElement},o.isLngLatBehindGlobe=y1,o.isMapAuthenticated=function(a){return Se.has(a)},o.isMapboxURL=Mi,o.isSafariWithAntialiasingBug=function(a){const i=a.navigator?a.navigator.userAgent:null;return!!rs(a)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=di,o.latLngToECEF=rd,o.len=lN,o.length=kp,o.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},o.lngFromMercatorX=Ms,o.loadVectorTile=DC,o.makeRequest=Hs,o.mapValue=function(a,i,l,h,f){return jt((a-i)/(l-i)*(f-h)+h,h,f)},o.mercatorScale=K2,o.mercatorXfromLng=_a,o.mercatorYfromLat=ya,o.mercatorZfromAltitude=Do,o.mul=oN,o.mul$1=aN,o.multiply=Tu,o.multiply$1=M2,o.multiply$2=k2,o.nextPowerOfTwo=pr,o.normalize=Li,o.normalize$1=cN,o.normalize$2=D2,o.number=ln,o.ortho=function(a,i,l,h,f,g,y){var b=1/(i-l),E=1/(h-f),S=1/(g-y);return a[0]=-2*b,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*S,a[11]=0,a[12]=(i+l)*b,a[13]=(f+h)*E,a[14]=(y+g)*S,a[15]=1,a},o.pbf=Jp,o.perspective=function(a,i,l,h,f){var g,y=1/Math.tan(i/2);return a[0]=y/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=y,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,f!=null&&f!==1/0?(a[10]=(f+h)*(g=1/(h-f)),a[14]=2*f*h*g):(a[10]=-1,a[14]=-2*h),a},o.pick=function(a,i){const l={};for(let h=0;h<i.length;h++){const f=i[h];f in a&&(l[f]=a[f])}return l},o.plugin=Te,o.pointGeometry=ue,o.polesInViewport=function(a){const i=Lo(new Float64Array(16));Tu(i,a.pixelMatrix,a.globeMatrix);const l=[0,Qs,0],h=[0,eo,0];return mr(l,l,i),mr(h,h,i),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!y1(a,new hn(a.center.lat,90)),h[0]>0&&h[0]<=a.width&&h[1]>0&&h[1]<=a.height&&!y1(a,new hn(a.center.lat,-90))]},o.polygonContainsPoint=Iu,o.polygonIntersectsBox=iA,o.polygonIntersectsPolygon=eA,o.polygonizeBounds=function(a,i,l=0,h=!0){const f=new ue(l,l),g=a.sub(f),y=i.add(f),b=[g,new ue(y.x,g.y),y,new ue(g.x,y.y)];return h&&b.push(g.clone()),b},o.posAttributes=Fp,o.postMapLoadEvent=se,o.postPerformanceEvent=we,o.postTurnstileEvent=B,o.potpack=F1,o.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},o.radToDeg=ht,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(a){return a({pluginStatus:ne,pluginURL:W}),pe.on("pluginStateChange",a),a},o.removeAuthState=function(a){Se.delete(a)},o.renderColorRamp=C1,o.resample=J2,o.rotateX=l1,o.rotateX$1=N2,o.rotateY=dy,o.rotateY$1=B2,o.rotateZ=function(a,i,l){var h=Math.sin(l),f=Math.cos(l),g=i[0],y=i[1],b=i[2],E=i[3],S=i[4],M=i[5],R=i[6],k=i[7];return i!==a&&(a[8]=i[8],a[9]=i[9],a[10]=i[10],a[11]=i[11],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=g*f+S*h,a[1]=y*f+M*h,a[2]=b*f+R*h,a[3]=E*f+k*h,a[4]=S*f-g*h,a[5]=M*f-y*h,a[6]=R*f-b*h,a[7]=k*f-E*h,a},o.rotateZ$1=function(a,i,l){l*=.5;var h=i[0],f=i[1],g=i[2],y=i[3],b=Math.sin(l),E=Math.cos(l);return a[0]=h*E+f*b,a[1]=f*E-h*b,a[2]=g*E+y*b,a[3]=y*E-g*b,a},o.scale=Su,o.scale$1=O2,o.scale$2=Cs,o.scaleAndAdd=Dp,o.set=function(a,i,l,h){return a[0]=i,a[1]=l,a[2]=h,a},o.setCacheLimits=function(a,i){na=a,ra=i},o.setColumn=function(a,i,l){a[4*i+0]=l[0],a[4*i+1]=l[1],a[4*i+2]=l[2],a[4*i+3]=l[3]},o.setRTLTextPlugin=function(a,i,l=!1){if(ne===$||ne===ee||ne===Q)throw new Error("setRTLTextPlugin cannot be called multiple times.");W=un.resolveURL(a),ne=$,te=i,le(),l||ye()},o.smoothstep=ts,o.spec=je,o.squaredLength=function(a){var i=a[0],l=a[1],h=a[2];return i*i+l*l+h*h},o.storeAuthState=function(a,i){i?Se.add(a):Se.delete(a)},o.sub=Oo,o.subtract=u1,o.symbolSize=xB,o.tileAABB=function(a,i,l,h,f,g,y,b,E){if(E.name==="globe")return fN(a,i,new Cy(l,h,f));const S=ku({z:l,x:h,y:f},E);return new Oi([(g+S.x/S.scale)*i,i*(S.y/S.scale),y],[(g+S.x2/S.scale)*i,i*(S.y2/S.scale),b])},o.tileCornersToBounds=py,o.tileTransform=ku,o.transformMat3=function(a,i,l){var h=i[0],f=i[1],g=i[2];return a[0]=h*l[0]+f*l[3]+g*l[6],a[1]=h*l[1]+f*l[4]+g*l[7],a[2]=h*l[2]+f*l[5]+g*l[8],a},o.transformMat4=mr,o.transformMat4$1=Au,o.transformQuat=L2,o.transitionTileAABBinECEF=G2,o.translate=Rp,o.transpose=function(a,i){if(a===i){var l=i[1],h=i[2],f=i[5];a[1]=i[3],a[2]=i[6],a[3]=l,a[5]=i[7],a[6]=h,a[7]=f}else a[0]=i[0],a[1]=i[3],a[2]=i[6],a[3]=i[1],a[4]=i[4],a[5]=i[7],a[6]=i[2],a[7]=i[5],a[8]=i[8];return a},o.triggerPluginCompletionEvent=he,o.uniqueId=Cn,o.updateGlobeVertexNormal=function(a,i,l,h,f){const g=5*i+2;a.float32[g+0]=l,a.float32[g+1]=h,a.float32[g+2]=f},o.validateCustomStyleLayer=function(a){const i=[],l=a.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),a.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},o.validateFilter=a=>Mo(bp(a)),o.validateFog=a=>Mo($_(a)),o.validateLayer=a=>Mo(Ep(a)),o.validateLight=a=>Mo(W_(a)),o.validateSource=a=>Mo(mu(a)),o.validateStyle=H_,o.validateTerrain=a=>Mo(Tp(a)),o.values=Gt,o.vectorTile=Ty,o.version=T,o.warnOnce=Vn,o.window=v,o.wrap=Ci}),u(["./shared"],function(o){function v(oe){if(typeof oe=="number"||typeof oe=="boolean"||typeof oe=="string"||oe==null)return JSON.stringify(oe);if(Array.isArray(oe)){let G="[";for(const se of oe)G+=`${v(se)},`;return`${G}]`}let B="{";for(const G of Object.keys(oe).sort())B+=`${G}:${v(oe[G])},`;return`${B}}`}function T(oe){let B="";for(const G of o.refProperties)B+=`/${v(oe[G])}`;return B}class I{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,G){for(const fe of B)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=o.createStyleLayer(fe)).compileFilter(),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(const fe of G)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const se=function(fe,we){const Ce={};for(let Se=0;Se<fe.length;Se++){const Re=we&&we[fe[Se].id]||T(fe[Se]);we&&(we[fe[Se].id]=Re);let Xe=Ce[Re];Xe||(Xe=Ce[Re]=[]),Xe.push(fe[Se])}const Me=[];for(const Se in Ce)Me.push(Ce[Se]);return Me}(o.values(this._layerConfigs),this.keyCache);for(const fe of se){const we=fe.map(ft=>this._layers[ft.id]),Ce=we[0];if(Ce.visibility==="none")continue;const Me=Ce.source||"";let Se=this.familiesBySource[Me];Se||(Se=this.familiesBySource[Me]={});const Re=Ce.sourceLayer||"_geojsonTileLayer";let Xe=Se[Re];Xe||(Xe=Se[Re]=[]),Xe.push(we)}}}class L{loadTile(B,G){const{uid:se,encoding:fe,rawImageData:we,padding:Ce,buildQuadTree:Me}=B,Se=o.window.ImageBitmap&&we instanceof o.window.ImageBitmap?this.getImageData(we,Ce):we;G(null,new o.DEMData(se,Se,fe,Ce<1,Me))}getImageData(B,G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const se=this.offscreenCanvasContext.getImageData(-G,-G,B.width+2*G,B.height+2*G);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),se}}var F=function oe(B,G){var se,fe=B&&B.type;if(fe==="FeatureCollection")for(se=0;se<B.features.length;se++)oe(B.features[se],G);else if(fe==="GeometryCollection")for(se=0;se<B.geometries.length;se++)oe(B.geometries[se],G);else if(fe==="Feature")oe(B.geometry,G);else if(fe==="Polygon")j(B.coordinates,G);else if(fe==="MultiPolygon")for(se=0;se<B.coordinates.length;se++)j(B.coordinates[se],G);return B};function j(oe,B){if(oe.length!==0){X(oe[0],B);for(var G=1;G<oe.length;G++)X(oe[G],!B)}}function X(oe,B){for(var G=0,se=0,fe=0,we=oe.length,Ce=we-1;fe<we;Ce=fe++){var Me=(oe[fe][0]-oe[Ce][0])*(oe[Ce][1]+oe[fe][1]),Se=G+Me;se+=Math.abs(G)>=Math.abs(Me)?G-Se+Me:Me-Se+G,G=Se}G+se>=0!=!!B&&oe.reverse()}const re=o.VectorTileFeature.prototype.toGeoJSON;class de{constructor(B){this._feature=B,this.extent=o.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const G of this._feature.geometry)B.push([new o.pointGeometry(G[0],G[1])]);return B}{const B=[];for(const G of this._feature.geometry){const se=[];for(const fe of G)se.push(new o.pointGeometry(fe[0],fe[1]));B.push(se)}return B}}toGeoJSON(B,G,se){return re.call(this,B,G,se)}}class q{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=B.length,this._features=B}feature(B){return new de(this._features[B])}}var H={},J={get exports(){return H},set exports(oe){H=oe}},Ee=o.pointGeometry,ue=o.vectorTile.VectorTileFeature,Fe=Qe;function Qe(oe,B){this.options=B||{},this.features=oe,this.length=oe.length}function at(oe,B){this.id=typeof oe.id=="number"?oe.id:void 0,this.type=oe.type,this.rawGeometry=oe.type===1?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=B||4096}Qe.prototype.feature=function(oe){return new at(this.features[oe],this.options.extent)},at.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var B=0;B<oe.length;B++){for(var G=oe[B],se=[],fe=0;fe<G.length;fe++)se.push(new Ee(G[fe][0],G[fe][1]));this.geometry.push(se)}return this.geometry},at.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,B=1/0,G=-1/0,se=1/0,fe=-1/0,we=0;we<oe.length;we++)for(var Ce=oe[we],Me=0;Me<Ce.length;Me++){var Se=Ce[Me];B=Math.min(B,Se.x),G=Math.max(G,Se.x),se=Math.min(se,Se.y),fe=Math.max(fe,Se.y)}return[B,se,G,fe]},at.prototype.toGeoJSON=ue.prototype.toGeoJSON;var rt=o.pbf,ht=Fe;function Bt(oe){var B=new rt;return function(G,se){for(var fe in G.layers)se.writeMessage(3,Dn,G.layers[fe])}(oe,B),B.finish()}function Dn(oe,B){var G;B.writeVarintField(15,oe.version||1),B.writeStringField(1,oe.name||""),B.writeVarintField(5,oe.extent||4096);var se={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<oe.length;G++)se.feature=oe.feature(G),B.writeMessage(2,zn,se);var fe=se.keys;for(G=0;G<fe.length;G++)B.writeStringField(3,fe[G]);var we=se.values;for(G=0;G<we.length;G++)B.writeMessage(4,wt,we[G])}function zn(oe,B){var G=oe.feature;G.id!==void 0&&B.writeVarintField(1,G.id),B.writeMessage(2,cn,oe),B.writeVarintField(3,G.type),B.writeMessage(4,Ci,G)}function cn(oe,B){var G=oe.feature,se=oe.keys,fe=oe.values,we=oe.keycache,Ce=oe.valuecache;for(var Me in G.properties){var Se=G.properties[Me],Re=we[Me];if(Se!==null){Re===void 0&&(se.push(Me),we[Me]=Re=se.length-1),B.writeVarint(Re);var Xe=typeof Se;Xe!=="string"&&Xe!=="boolean"&&Xe!=="number"&&(Se=JSON.stringify(Se));var ft=Xe+":"+Se,et=Ce[ft];et===void 0&&(fe.push(Se),Ce[ft]=et=fe.length-1),B.writeVarint(et)}}}function jt(oe,B){return(B<<3)+(7&oe)}function ts(oe){return oe<<1^oe>>31}function Ci(oe,B){for(var G=oe.loadGeometry(),se=oe.type,fe=0,we=0,Ce=G.length,Me=0;Me<Ce;Me++){var Se=G[Me],Re=1;se===1&&(Re=Se.length),B.writeVarint(jt(1,Re));for(var Xe=se===3?Se.length-1:Se.length,ft=0;ft<Xe;ft++){ft===1&&se!==1&&B.writeVarint(jt(2,Xe-1));var et=Se[ft].x-fe,Ct=Se[ft].y-we;B.writeVarint(ts(et)),B.writeVarint(ts(Ct)),fe+=et,we+=Ct}se===3&&B.writeVarint(jt(7,1))}}function wt(oe,B){var G=typeof oe;G==="string"?B.writeStringField(1,oe):G==="boolean"?B.writeBooleanField(7,oe):G==="number"&&(oe%1!=0?B.writeDoubleField(3,oe):oe<0?B.writeSVarintField(6,oe):B.writeVarintField(5,oe))}function Gt(oe,B,G,se,fe,we){if(fe-se<=G)return;const Ce=se+fe>>1;Ot(oe,B,Ce,se,fe,we%2),Gt(oe,B,G,se,Ce-1,we+1),Gt(oe,B,G,Ce+1,fe,we+1)}function Ot(oe,B,G,se,fe,we){for(;fe>se;){if(fe-se>600){const Re=fe-se+1,Xe=G-se+1,ft=Math.log(Re),et=.5*Math.exp(2*ft/3),Ct=.5*Math.sqrt(ft*et*(Re-et)/Re)*(Xe-Re/2<0?-1:1);Ot(oe,B,G,Math.max(se,Math.floor(G-Xe*et/Re+Ct)),Math.min(fe,Math.floor(G+(Re-Xe)*et/Re+Ct)),we)}const Ce=B[2*G+we];let Me=se,Se=fe;for(bn(oe,B,se,G),B[2*fe+we]>Ce&&bn(oe,B,se,fe);Me<Se;){for(bn(oe,B,Me,Se),Me++,Se--;B[2*Me+we]<Ce;)Me++;for(;B[2*Se+we]>Ce;)Se--}B[2*se+we]===Ce?bn(oe,B,se,Se):(Se++,bn(oe,B,Se,fe)),Se<=G&&(se=Se+1),G<=Se&&(fe=Se-1)}}function bn(oe,B,G,se){Cn(oe,G,se),Cn(B,2*G,2*se),Cn(B,2*G+1,2*se+1)}function Cn(oe,B,G){const se=oe[B];oe[B]=oe[G],oe[G]=se}function Hr(oe,B,G,se){const fe=oe-G,we=B-se;return fe*fe+we*we}J.exports=Bt,H.fromVectorTileJs=Bt,H.fromGeojsonVt=function(oe,B){B=B||{};var G={};for(var se in oe)G[se]=new ht(oe[se].features,B),G[se].name=se,G[se].version=B.version,G[se].extent=B.extent;return Bt({layers:G})},H.GeoJSONWrapper=ht;const pr=oe=>oe[0],ns=oe=>oe[1];class Fr{constructor(B,G=pr,se=ns,fe=64,we=Float64Array){this.nodeSize=fe,this.points=B;const Ce=B.length<65536?Uint16Array:Uint32Array,Me=this.ids=new Ce(B.length),Se=this.coords=new we(2*B.length);for(let Re=0;Re<B.length;Re++)Me[Re]=Re,Se[2*Re]=G(B[Re]),Se[2*Re+1]=se(B[Re]);Gt(Me,Se,fe,0,Me.length-1,0)}range(B,G,se,fe){return function(we,Ce,Me,Se,Re,Xe,ft){const et=[0,we.length-1,0],Ct=[];let St,Tt;for(;et.length;){const Lt=et.pop(),Ht=et.pop(),un=et.pop();if(Ht-un<=ft){for(let Kt=un;Kt<=Ht;Kt++)St=Ce[2*Kt],Tt=Ce[2*Kt+1],St>=Me&&St<=Re&&Tt>=Se&&Tt<=Xe&&Ct.push(we[Kt]);continue}const Dt=Math.floor((un+Ht)/2);St=Ce[2*Dt],Tt=Ce[2*Dt+1],St>=Me&&St<=Re&&Tt>=Se&&Tt<=Xe&&Ct.push(we[Dt]);const dn=(Lt+1)%2;(Lt===0?Me<=St:Se<=Tt)&&(et.push(un),et.push(Dt-1),et.push(dn)),(Lt===0?Re>=St:Xe>=Tt)&&(et.push(Dt+1),et.push(Ht),et.push(dn))}return Ct}(this.ids,this.coords,B,G,se,fe,this.nodeSize)}within(B,G,se){return function(fe,we,Ce,Me,Se,Re){const Xe=[0,fe.length-1,0],ft=[],et=Se*Se;for(;Xe.length;){const Ct=Xe.pop(),St=Xe.pop(),Tt=Xe.pop();if(St-Tt<=Re){for(let dn=Tt;dn<=St;dn++)Hr(we[2*dn],we[2*dn+1],Ce,Me)<=et&&ft.push(fe[dn]);continue}const Lt=Math.floor((Tt+St)/2),Ht=we[2*Lt],un=we[2*Lt+1];Hr(Ht,un,Ce,Me)<=et&&ft.push(fe[Lt]);const Dt=(Ct+1)%2;(Ct===0?Ce-Se<=Ht:Me-Se<=un)&&(Xe.push(Tt),Xe.push(Lt-1),Xe.push(Dt)),(Ct===0?Ce+Se>=Ht:Me+Se>=un)&&(Xe.push(Lt+1),Xe.push(St),Xe.push(Dt))}return ft}(this.ids,this.coords,B,G,se,this.nodeSize)}}const Mn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},Zr=Math.fround||(Hn=new Float32Array(1),oe=>(Hn[0]=+oe,Hn[0]));var Hn;class Zn{constructor(B){this.options=rs(Object.create(Mn),B),this.trees=new Array(this.options.maxZoom+1)}load(B){const{log:G,minZoom:se,maxZoom:fe,nodeSize:we}=this.options;G&&console.time("total time");const Ce=`prepare ${B.length} points`;G&&console.time(Ce),this.points=B;let Me=[];for(let Se=0;Se<B.length;Se++)B[Se].geometry&&Me.push(Vn(B[Se],Se));this.trees[fe+1]=new Fr(Me,ta,is,we,Float32Array),G&&console.timeEnd(Ce);for(let Se=fe;Se>=se;Se--){const Re=+Date.now();Me=this._cluster(Me,Se),this.trees[Se]=new Fr(Me,ta,is,we,Float32Array),G&&console.log("z%d: %d clusters in %dms",Se,Me.length,+Date.now()-Re)}return G&&console.timeEnd("total time"),this}getClusters(B,G){let se=((B[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,B[1]));let we=B[2]===180?180:((B[2]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)se=-180,we=180;else if(se>we){const Xe=this.getClusters([se,fe,180,Ce],G),ft=this.getClusters([-180,fe,we,Ce],G);return Xe.concat(ft)}const Me=this.trees[this._limitZoom(G)],Se=Me.range(Xr(se),Lr(Ce),Xr(we),Lr(fe)),Re=[];for(const Xe of Se){const ft=Me.points[Xe];Re.push(ft.numPoints?qr(ft):this.points[ft.index])}return Re}getChildren(B){const G=this._getOriginId(B),se=this._getOriginZoom(B),fe="No cluster with the specified id.",we=this.trees[se];if(!we)throw new Error(fe);const Ce=we.points[G];if(!Ce)throw new Error(fe);const Me=this.options.radius/(this.options.extent*Math.pow(2,se-1)),Se=we.within(Ce.x,Ce.y,Me),Re=[];for(const Xe of Se){const ft=we.points[Xe];ft.parentId===B&&Re.push(ft.numPoints?qr(ft):this.points[ft.index])}if(Re.length===0)throw new Error(fe);return Re}getLeaves(B,G,se){const fe=[];return this._appendLeaves(fe,B,G=G||10,se=se||0,0),fe}getTile(B,G,se){const fe=this.trees[this._limitZoom(B)],we=Math.pow(2,B),{extent:Ce,radius:Me}=this.options,Se=Me/Ce,Re=(se-Se)/we,Xe=(se+1+Se)/we,ft={features:[]};return this._addTileFeatures(fe.range((G-Se)/we,Re,(G+1+Se)/we,Xe),fe.points,G,se,we,ft),G===0&&this._addTileFeatures(fe.range(1-Se/we,Re,1,Xe),fe.points,we,se,we,ft),G===we-1&&this._addTileFeatures(fe.range(0,Re,Se/we,Xe),fe.points,-1,se,we,ft),ft.features.length?ft:null}getClusterExpansionZoom(B){let G=this._getOriginZoom(B)-1;for(;G<=this.options.maxZoom;){const se=this.getChildren(B);if(G++,se.length!==1)break;B=se[0].properties.cluster_id}return G}_appendLeaves(B,G,se,fe,we){const Ce=this.getChildren(G);for(const Me of Ce){const Se=Me.properties;if(Se&&Se.cluster?we+Se.point_count<=fe?we+=Se.point_count:we=this._appendLeaves(B,Se.cluster_id,se,fe,we):we<fe?we++:B.push(Me),B.length===se)break}return we}_addTileFeatures(B,G,se,fe,we,Ce){for(const Me of B){const Se=G[Me],Re=Se.numPoints;let Xe,ft,et;if(Re)Xe=on(Se),ft=Se.x,et=Se.y;else{const Tt=this.points[Se.index];Xe=Tt.properties,ft=Xr(Tt.geometry.coordinates[0]),et=Lr(Tt.geometry.coordinates[1])}const Ct={type:1,geometry:[[Math.round(this.options.extent*(ft*we-se)),Math.round(this.options.extent*(et*we-fe))]],tags:Xe};let St;Re?St=Se.id:this.options.generateId?St=Se.index:this.points[Se.index].id&&(St=this.points[Se.index].id),St!==void 0&&(Ct.id=St),Ce.features.push(Ct)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,G){const se=[],{radius:fe,extent:we,reduce:Ce,minPoints:Me}=this.options,Se=fe/(we*Math.pow(2,G));for(let Re=0;Re<B.length;Re++){const Xe=B[Re];if(Xe.zoom<=G)continue;Xe.zoom=G;const ft=this.trees[G+1],et=ft.within(Xe.x,Xe.y,Se),Ct=Xe.numPoints||1;let St=Ct;for(const Tt of et){const Lt=ft.points[Tt];Lt.zoom>G&&(St+=Lt.numPoints||1)}if(St>Ct&&St>=Me){let Tt=Xe.x*Ct,Lt=Xe.y*Ct,Ht=Ce&&Ct>1?this._map(Xe,!0):null;const un=(Re<<5)+(G+1)+this.points.length;for(const Dt of et){const dn=ft.points[Dt];if(dn.zoom<=G)continue;dn.zoom=G;const Kt=dn.numPoints||1;Tt+=dn.x*Kt,Lt+=dn.y*Kt,dn.parentId=un,Ce&&(Ht||(Ht=this._map(Xe,!0)),Ce(Ht,this._map(dn)))}Xe.parentId=un,se.push(go(Tt/St,Lt/St,un,St,Ht))}else if(se.push(Xe),St>1)for(const Tt of et){const Lt=ft.points[Tt];Lt.zoom<=G||(Lt.zoom=G,se.push(Lt))}}return se}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,G){if(B.numPoints)return G?rs({},B.properties):B.properties;const se=this.points[B.index].properties,fe=this.options.map(se);return G&&fe===se?rs({},fe):fe}}function go(oe,B,G,se,fe){return{x:Zr(oe),y:Zr(B),zoom:1/0,id:G,parentId:-1,numPoints:se,properties:fe}}function Vn(oe,B){const[G,se]=oe.geometry.coordinates;return{x:Zr(Xr(G)),y:Zr(Lr(se)),zoom:1/0,index:B,parentId:-1}}function qr(oe){return{type:"Feature",id:oe.id,properties:on(oe),geometry:{type:"Point",coordinates:[(B=oe.x,360*(B-.5)),Gi(oe.y)]}};var B}function on(oe){const B=oe.numPoints,G=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return rs(rs({},oe.properties),{cluster:!0,cluster_id:oe.id,point_count:B,point_count_abbreviated:G})}function Xr(oe){return oe/360+.5}function Lr(oe){const B=Math.sin(oe*Math.PI/180),G=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return G<0?0:G>1?1:G}function Gi(oe){const B=(180-360*oe)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function rs(oe,B){for(const G in B)oe[G]=B[G];return oe}function ta(oe){return oe.x}function is(oe){return oe.y}function Or(oe,B,G,se){for(var fe,we=se,Ce=G-B>>1,Me=G-B,Se=oe[B],Re=oe[B+1],Xe=oe[G],ft=oe[G+1],et=B+3;et<G;et+=3){var Ct=Wi(oe[et],oe[et+1],Se,Re,Xe,ft);if(Ct>we)fe=et,we=Ct;else if(Ct===we){var St=Math.abs(et-Ce);St<Me&&(fe=et,Me=St)}}we>se&&(fe-B>3&&Or(oe,B,fe,se),oe[fe+2]=we,G-fe>3&&Or(oe,fe,G,se))}function Wi(oe,B,G,se,fe,we){var Ce=fe-G,Me=we-se;if(Ce!==0||Me!==0){var Se=((oe-G)*Ce+(B-se)*Me)/(Ce*Ce+Me*Me);Se>1?(G=fe,se=we):Se>0&&(G+=Ce*Se,se+=Me*Se)}return(Ce=oe-G)*Ce+(Me=B-se)*Me}function ss(oe,B,G,se){var fe={id:oe===void 0?null:oe,type:B,geometry:G,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(we){var Ce=we.geometry,Me=we.type;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")na(we,Ce);else if(Me==="Polygon"||Me==="MultiLineString")for(var Se=0;Se<Ce.length;Se++)na(we,Ce[Se]);else if(Me==="MultiPolygon")for(Se=0;Se<Ce.length;Se++)for(var Re=0;Re<Ce[Se].length;Re++)na(we,Ce[Se][Re])}(fe),fe}function na(oe,B){for(var G=0;G<B.length;G+=3)oe.minX=Math.min(oe.minX,B[G]),oe.minY=Math.min(oe.minY,B[G+1]),oe.maxX=Math.max(oe.maxX,B[G]),oe.maxY=Math.max(oe.maxY,B[G+1])}function ra(oe,B,G,se){if(B.geometry){var fe=B.geometry.coordinates,we=B.geometry.type,Ce=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),Me=[],Se=B.id;if(G.promoteId?Se=B.properties[G.promoteId]:G.generateId&&(Se=se||0),we==="Point")Va(fe,Me);else if(we==="MultiPoint")for(var Re=0;Re<fe.length;Re++)Va(fe[Re],Me);else if(we==="LineString")Es(fe,Me,Ce,!1);else if(we==="MultiLineString"){if(G.lineMetrics){for(Re=0;Re<fe.length;Re++)Es(fe[Re],Me=[],Ce,!1),oe.push(ss(Se,"LineString",Me,B.properties));return}_o(fe,Me,Ce,!1)}else if(we==="Polygon")_o(fe,Me,Ce,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(Re=0;Re<B.geometry.geometries.length;Re++)ra(oe,{id:Se,geometry:B.geometry.geometries[Re],properties:B.properties},G,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Re=0;Re<fe.length;Re++){var Xe=[];_o(fe[Re],Xe,Ce,!0),Me.push(Xe)}}oe.push(ss(Se,we,Me,B.properties))}}function Va(oe,B){B.push(yo(oe[0])),B.push(vo(oe[1])),B.push(0)}function Es(oe,B,G,se){for(var fe,we,Ce=0,Me=0;Me<oe.length;Me++){var Se=yo(oe[Me][0]),Re=vo(oe[Me][1]);B.push(Se),B.push(Re),B.push(0),Me>0&&(Ce+=se?(fe*Re-Se*we)/2:Math.sqrt(Math.pow(Se-fe,2)+Math.pow(Re-we,2))),fe=Se,we=Re}var Xe=B.length-3;B[2]=1,Or(B,0,Xe,G),B[Xe+2]=1,B.size=Math.abs(Ce),B.start=0,B.end=B.size}function _o(oe,B,G,se){for(var fe=0;fe<oe.length;fe++){var we=[];Es(oe[fe],we,G,se),B.push(we)}}function yo(oe){return oe/360+.5}function vo(oe){var B=Math.sin(oe*Math.PI/180),G=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return G<0?0:G>1?1:G}function Nr(oe,B,G,se,fe,we,Ce,Me){if(se/=B,we>=(G/=B)&&Ce<se)return oe;if(Ce<G||we>=se)return null;for(var Se=[],Re=0;Re<oe.length;Re++){var Xe=oe[Re],ft=Xe.geometry,et=Xe.type,Ct=fe===0?Xe.minX:Xe.minY,St=fe===0?Xe.maxX:Xe.maxY;if(Ct>=G&&St<se)Se.push(Xe);else if(!(St<G||Ct>=se)){var Tt=[];if(et==="Point"||et==="MultiPoint")xo(ft,Tt,G,se,fe);else if(et==="LineString")Hs(ft,Tt,G,se,fe,!1,Me.lineMetrics);else if(et==="MultiLineString")ja(ft,Tt,G,se,fe,!1);else if(et==="Polygon")ja(ft,Tt,G,se,fe,!0);else if(et==="MultiPolygon")for(var Lt=0;Lt<ft.length;Lt++){var Ht=[];ja(ft[Lt],Ht,G,se,fe,!0),Ht.length&&Tt.push(Ht)}if(Tt.length){if(Me.lineMetrics&&et==="LineString"){for(Lt=0;Lt<Tt.length;Lt++)Se.push(ss(Xe.id,et,Tt[Lt],Xe.tags));continue}et!=="LineString"&&et!=="MultiLineString"||(Tt.length===1?(et="LineString",Tt=Tt[0]):et="MultiLineString"),et!=="Point"&&et!=="MultiPoint"||(et=Tt.length===3?"Point":"MultiPoint"),Se.push(ss(Xe.id,et,Tt,Xe.tags))}}}return Se.length?Se:null}function xo(oe,B,G,se,fe){for(var we=0;we<oe.length;we+=3){var Ce=oe[we+fe];Ce>=G&&Ce<=se&&(B.push(oe[we]),B.push(oe[we+1]),B.push(oe[we+2]))}}function Hs(oe,B,G,se,fe,we,Ce){for(var Me,Se,Re=bo(oe),Xe=fe===0?sa:os,ft=oe.start,et=0;et<oe.length-3;et+=3){var Ct=oe[et],St=oe[et+1],Tt=oe[et+2],Lt=oe[et+3],Ht=oe[et+4],un=fe===0?Ct:St,Dt=fe===0?Lt:Ht,dn=!1;Ce&&(Me=Math.sqrt(Math.pow(Ct-Lt,2)+Math.pow(St-Ht,2))),un<G?Dt>G&&(Se=Xe(Re,Ct,St,Lt,Ht,G),Ce&&(Re.start=ft+Me*Se)):un>se?Dt<se&&(Se=Xe(Re,Ct,St,Lt,Ht,se),Ce&&(Re.start=ft+Me*Se)):ia(Re,Ct,St,Tt),Dt<G&&un>=G&&(Se=Xe(Re,Ct,St,Lt,Ht,G),dn=!0),Dt>se&&un<=se&&(Se=Xe(Re,Ct,St,Lt,Ht,se),dn=!0),!we&&dn&&(Ce&&(Re.end=ft+Me*Se),B.push(Re),Re=bo(oe)),Ce&&(ft+=Me)}var Kt=oe.length-3;Ct=oe[Kt],St=oe[Kt+1],Tt=oe[Kt+2],(un=fe===0?Ct:St)>=G&&un<=se&&ia(Re,Ct,St,Tt),Kt=Re.length-3,we&&Kt>=3&&(Re[Kt]!==Re[0]||Re[Kt+1]!==Re[1])&&ia(Re,Re[0],Re[1],Re[2]),Re.length&&B.push(Re)}function bo(oe){var B=[];return B.size=oe.size,B.start=oe.start,B.end=oe.end,B}function ja(oe,B,G,se,fe,we){for(var Ce=0;Ce<oe.length;Ce++)Hs(oe[Ce],B,G,se,fe,we,!1)}function ia(oe,B,G,se){oe.push(B),oe.push(G),oe.push(se)}function sa(oe,B,G,se,fe,we){var Ce=(we-B)/(se-B);return oe.push(we),oe.push(G+(fe-G)*Ce),oe.push(1),Ce}function os(oe,B,G,se,fe,we){var Ce=(we-G)/(fe-G);return oe.push(B+(se-B)*Ce),oe.push(we),oe.push(1),Ce}function Ga(oe,B){for(var G=[],se=0;se<oe.length;se++){var fe,we=oe[se],Ce=we.type;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")fe=wo(we.geometry,B);else if(Ce==="MultiLineString"||Ce==="Polygon"){fe=[];for(var Me=0;Me<we.geometry.length;Me++)fe.push(wo(we.geometry[Me],B))}else if(Ce==="MultiPolygon")for(fe=[],Me=0;Me<we.geometry.length;Me++){for(var Se=[],Re=0;Re<we.geometry[Me].length;Re++)Se.push(wo(we.geometry[Me][Re],B));fe.push(Se)}G.push(ss(we.id,Ce,fe,we.tags))}return G}function wo(oe,B){var G=[];G.size=oe.size,oe.start!==void 0&&(G.start=oe.start,G.end=oe.end);for(var se=0;se<oe.length;se+=3)G.push(oe[se]+B,oe[se+1],oe[se+2]);return G}function Mi(oe,B){if(oe.transformed)return oe;var G,se,fe,we=1<<oe.z,Ce=oe.x,Me=oe.y;for(G=0;G<oe.features.length;G++){var Se=oe.features[G],Re=Se.geometry,Xe=Se.type;if(Se.geometry=[],Xe===1)for(se=0;se<Re.length;se+=2)Se.geometry.push(Zs(Re[se],Re[se+1],B,we,Ce,Me));else for(se=0;se<Re.length;se++){var ft=[];for(fe=0;fe<Re[se].length;fe+=2)ft.push(Zs(Re[se][fe],Re[se][fe+1],B,we,Ce,Me));Se.geometry.push(ft)}}return oe.transformed=!0,oe}function Zs(oe,B,G,se,fe,we){return[Math.round(G*(oe*se-fe)),Math.round(G*(B*se-we))]}function oa(oe,B,G,se,fe){for(var we=B===fe.maxZoom?0:fe.tolerance/((1<<B)*fe.extent),Ce={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:se,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Me=0;Me<oe.length;Me++){Ce.numFeatures++,Cl(Ce,oe[Me],we,fe);var Se=oe[Me].minX,Re=oe[Me].minY,Xe=oe[Me].maxX,ft=oe[Me].maxY;Se<Ce.minX&&(Ce.minX=Se),Re<Ce.minY&&(Ce.minY=Re),Xe>Ce.maxX&&(Ce.maxX=Xe),ft>Ce.maxY&&(Ce.maxY=ft)}return Ce}function Cl(oe,B,G,se){var fe=B.geometry,we=B.type,Ce=[];if(we==="Point"||we==="MultiPoint")for(var Me=0;Me<fe.length;Me+=3)Ce.push(fe[Me]),Ce.push(fe[Me+1]),oe.numPoints++,oe.numSimplified++;else if(we==="LineString")aa(Ce,fe,oe,G,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(Me=0;Me<fe.length;Me++)aa(Ce,fe[Me],oe,G,we==="Polygon",Me===0);else if(we==="MultiPolygon")for(var Se=0;Se<fe.length;Se++){var Re=fe[Se];for(Me=0;Me<Re.length;Me++)aa(Ce,Re[Me],oe,G,!0,Me===0)}if(Ce.length){var Xe=B.tags||null;if(we==="LineString"&&se.lineMetrics){for(var ft in Xe={},B.tags)Xe[ft]=B.tags[ft];Xe.mapbox_clip_start=fe.start/fe.size,Xe.mapbox_clip_end=fe.end/fe.size}var et={geometry:Ce,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:Xe};B.id!==null&&(et.id=B.id),oe.features.push(et)}}function aa(oe,B,G,se,fe,we){var Ce=se*se;if(se>0&&B.size<(fe?Ce:se))G.numPoints+=B.length/3;else{for(var Me=[],Se=0;Se<B.length;Se+=3)(se===0||B[Se+2]>Ce)&&(G.numSimplified++,Me.push(B[Se]),Me.push(B[Se+1])),G.numPoints++;fe&&function(Re,Xe){for(var ft=0,et=0,Ct=Re.length,St=Ct-2;et<Ct;St=et,et+=2)ft+=(Re[et]-Re[St])*(Re[et+1]+Re[St+1]);if(ft>0===Xe)for(et=0,Ct=Re.length;et<Ct/2;et+=2){var Tt=Re[et],Lt=Re[et+1];Re[et]=Re[Ct-2-et],Re[et+1]=Re[Ct-1-et],Re[Ct-2-et]=Tt,Re[Ct-1-et]=Lt}}(Me,we),oe.push(Me)}}function Eo(oe,B){var G=(B=this.options=function(fe,we){for(var Ce in we)fe[Ce]=we[Ce];return fe}(Object.create(this.options),B)).debug;if(G&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var se=function(fe,we){var Ce=[];if(fe.type==="FeatureCollection")for(var Me=0;Me<fe.features.length;Me++)ra(Ce,fe.features[Me],we,Me);else ra(Ce,fe.type==="Feature"?fe:{geometry:fe},we);return Ce}(oe,B);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),se=function(fe,we){var Ce=we.buffer/we.extent,Me=fe,Se=Nr(fe,1,-1-Ce,Ce,0,-1,2,we),Re=Nr(fe,1,1-Ce,2+Ce,0,-1,2,we);return(Se||Re)&&(Me=Nr(fe,1,-Ce,1+Ce,0,-1,2,we)||[],Se&&(Me=Ga(Se,1).concat(Me)),Re&&(Me=Me.concat(Ga(Re,-1)))),Me}(se,B),se.length&&this.splitTile(se,0,0,0),G&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ai(oe,B,G){return 32*((1<<oe)*G+B)+oe}function qs(oe,B){const G=oe.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const se=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!se)return B(null,null);const fe=new q(se.features);let we=H(fe);we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),B(null,{vectorTile:fe,rawData:we.buffer})}Eo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Eo.prototype.splitTile=function(oe,B,G,se,fe,we,Ce){for(var Me=[oe,B,G,se],Se=this.options,Re=Se.debug;Me.length;){se=Me.pop(),G=Me.pop(),B=Me.pop(),oe=Me.pop();var Xe=1<<B,ft=ai(B,G,se),et=this.tiles[ft];if(!et&&(Re>1&&console.time("creation"),et=this.tiles[ft]=oa(oe,B,G,se,Se),this.tileCoords.push({z:B,x:G,y:se}),Re)){Re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,G,se,et.numFeatures,et.numPoints,et.numSimplified),console.timeEnd("creation"));var Ct="z"+B;this.stats[Ct]=(this.stats[Ct]||0)+1,this.total++}if(et.source=oe,fe){if(B===Se.maxZoom||B===fe)continue;var St=1<<fe-B;if(G!==Math.floor(we/St)||se!==Math.floor(Ce/St))continue}else if(B===Se.indexMaxZoom||et.numPoints<=Se.indexMaxPoints)continue;if(et.source=null,oe.length!==0){Re>1&&console.time("clipping");var Tt,Lt,Ht,un,Dt,dn,Kt=.5*Se.buffer/Se.extent,yi=.5-Kt,Br=.5+Kt,je=1+Kt;Tt=Lt=Ht=un=null,Dt=Nr(oe,Xe,G-Kt,G+Br,0,et.minX,et.maxX,Se),dn=Nr(oe,Xe,G+yi,G+je,0,et.minX,et.maxX,Se),oe=null,Dt&&(Tt=Nr(Dt,Xe,se-Kt,se+Br,1,et.minY,et.maxY,Se),Lt=Nr(Dt,Xe,se+yi,se+je,1,et.minY,et.maxY,Se),Dt=null),dn&&(Ht=Nr(dn,Xe,se-Kt,se+Br,1,et.minY,et.maxY,Se),un=Nr(dn,Xe,se+yi,se+je,1,et.minY,et.maxY,Se),dn=null),Re>1&&console.timeEnd("clipping"),Me.push(Tt||[],B+1,2*G,2*se),Me.push(Lt||[],B+1,2*G,2*se+1),Me.push(Ht||[],B+1,2*G+1,2*se),Me.push(un||[],B+1,2*G+1,2*se+1)}}},Eo.prototype.getTile=function(oe,B,G){var se=this.options,fe=se.extent,we=se.debug;if(oe<0||oe>24)return null;var Ce=1<<oe,Me=ai(oe,B=(B%Ce+Ce)%Ce,G);if(this.tiles[Me])return Mi(this.tiles[Me],fe);we>1&&console.log("drilling down to z%d-%d-%d",oe,B,G);for(var Se,Re=oe,Xe=B,ft=G;!Se&&Re>0;)Re--,Xe=Math.floor(Xe/2),ft=Math.floor(ft/2),Se=this.tiles[ai(Re,Xe,ft)];return Se&&Se.source?(we>1&&console.log("found parent tile z%d-%d-%d",Re,Xe,ft),we>1&&console.time("drilling down"),this.splitTile(Se.source,Re,Xe,ft,oe,B,G),we>1&&console.timeEnd("drilling down"),this.tiles[Me]?Mi(this.tiles[Me],fe):null):null};class Ml extends o.VectorTileWorkerSource{constructor(B,G,se,fe,we){super(B,G,se,fe,qs),we&&(this.loadGeoJSON=we)}loadData(B,G){const se=B&&B.request,fe=se&&se.collectResourceTiming;this.loadGeoJSON(B,(we,Ce)=>{if(we||!Ce)return G(we);if(typeof Ce!="object")return G(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{F(Ce,!0);try{if(B.filter){const Se=o.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));Ce={type:"FeatureCollection",features:Ce.features.filter(Xe=>Se.value.evaluate({zoom:0},Xe))}}this._geoJSONIndex=B.cluster?new Zn(function({superclusterOptions:Se,clusterProperties:Re}){if(!Re||!Se)return Se;const Xe={},ft={},et={accumulated:null,zoom:0},Ct={properties:null},St=Object.keys(Re);for(const Tt of St){const[Lt,Ht]=Re[Tt],un=o.createExpression(Ht),Dt=o.createExpression(typeof Lt=="string"?[Lt,["accumulated"],["get",Tt]]:Lt);Xe[Tt]=un.value,ft[Tt]=Dt.value}return Se.map=Tt=>{Ct.properties=Tt;const Lt={};for(const Ht of St)Lt[Ht]=Xe[Ht].evaluate(et,Ct);return Lt},Se.reduce=(Tt,Lt)=>{Ct.properties=Lt;for(const Ht of St)et.accumulated=Tt[Ht],Tt[Ht]=ft[Ht].evaluate(et,Ct)},Se}(B)).load(Ce.features):function(Se,Re){return new Eo(Se,Re)}(Ce,B.geojsonVtOptions)}catch(Se){return G(Se)}this.loaded={};const Me={};if(fe){const Se=o.getPerformanceMeasurement(se);Se&&(Me.resourceTiming={},Me.resourceTiming[B.source]=JSON.parse(JSON.stringify(Se)))}G(null,Me)}})}reloadTile(B,G){const se=this.loaded;return se&&se[B.uid]?super.reloadTile(B,G):this.loadTile(B,G)}loadGeoJSON(B,G){if(B.request)o.getJSON(B.request,G);else{if(typeof B.data!="string")return G(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return G(null,JSON.parse(B.data))}catch{return G(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(se){G(se)}}getClusterChildren(B,G){try{G(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(se){G(se)}}getClusterLeaves(B,G){try{G(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(se){G(se)}}}class To{constructor(B){this.self=B,this.actor=new o.Actor(B,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Ml},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(G,se)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=se},this.self.registerRTLTextPlugin=G=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=G.applyArabicShaping,o.plugin.processBidirectionalText=G.processBidirectionalText,o.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}}clearCaches(B,G,se){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B],se()}checkIfReady(B,G,se){se()}setReferrer(B,G){this.referrer=G}spriteLoaded(B,G){this.isSpriteLoaded[B]=G;for(const se in this.workerSources[B]){const fe=this.workerSources[B][se];for(const we in fe)fe[we]instanceof o.VectorTileWorkerSource&&(fe[we].isSpriteLoaded=G,fe[we].fire(new o.Event("isSpriteLoaded")))}}setImages(B,G,se){this.availableImages[B]=G;for(const fe in this.workerSources[B]){const we=this.workerSources[B][fe];for(const Ce in we)we[Ce].availableImages=G}se()}enableTerrain(B,G,se){this.terrain=G,se()}setProjection(B,G){this.projections[B]=o.getProjection(G)}setLayers(B,G,se){this.getLayerIndex(B).replace(G),se()}updateLayers(B,G,se){this.getLayerIndex(B).update(G.layers,G.removedIds),se()}loadTile(B,G,se){const fe=this.enableTerrain?o.extend({enableTerrain:this.terrain},G):G;fe.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,G.type,G.source).loadTile(fe,se)}loadDEMTile(B,G,se){const fe=this.enableTerrain?o.extend({buildQuadTree:this.terrain},G):G;this.getDEMWorkerSource(B,G.source).loadTile(fe,se)}reloadTile(B,G,se){const fe=this.enableTerrain?o.extend({enableTerrain:this.terrain},G):G;fe.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,G.type,G.source).reloadTile(fe,se)}abortTile(B,G,se){this.getWorkerSource(B,G.type,G.source).abortTile(G,se)}removeTile(B,G,se){this.getWorkerSource(B,G.type,G.source).removeTile(G,se)}removeSource(B,G,se){if(!this.workerSources[B]||!this.workerSources[B][G.type]||!this.workerSources[B][G.type][G.source])return;const fe=this.workerSources[B][G.type][G.source];delete this.workerSources[B][G.type][G.source],fe.removeSource!==void 0?fe.removeSource(G,se):se()}loadWorkerSource(B,G,se){try{this.self.importScripts(G.url),se()}catch(fe){se(fe.toString())}}syncRTLPluginState(B,G,se){try{o.plugin.setState(G);const fe=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&fe!=null){this.self.importScripts(fe);const we=o.plugin.isParsed();se(we?void 0:new Error(`RTL Text Plugin failed to import scripts from ${fe}`),we)}}catch(fe){se(fe.toString())}}getAvailableImages(B){let G=this.availableImages[B];return G||(G=[]),G}getLayerIndex(B){let G=this.layerIndexes[B];return G||(G=this.layerIndexes[B]=new I),G}getWorkerSource(B,G,se){if(this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][G]||(this.workerSources[B][G]={}),!this.workerSources[B][G][se]){const fe={send:(we,Ce,Me,Se,Re,Xe)=>{this.actor.send(we,Ce,Me,B,Re,Xe)},scheduler:this.actor.scheduler};this.workerSources[B][G][se]=new this.workerSourceTypes[G](fe,this.getLayerIndex(B),this.getAvailableImages(B),this.isSpriteLoaded[B])}return this.workerSources[B][G][se]}getDEMWorkerSource(B,G){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][G]||(this.demWorkerSources[B][G]=new L),this.demWorkerSources[B][G]}enforceCacheSizeLimit(B,G){o.enforceCacheSizeLimit(G)}getWorkerPerformanceMetrics(B,G,se){se(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new To(self)),To}),u(["./shared"],function(o){function v(m,c){if(Array.isArray(m)){if(!Array.isArray(c)||m.length!==c.length)return!1;for(let d=0;d<m.length;d++)if(!v(m[d],c[d]))return!1;return!0}if(typeof m=="object"&&m!==null&&c!==null){if(typeof c!="object"||Object.keys(m).length!==Object.keys(c).length)return!1;for(const d in m)if(!v(m[d],c[d]))return!1;return!0}return m===c}var T=I;function I(m){return!function(c){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,w=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(w);try{x=new Worker(A),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(A),_}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===_.width}()?(L[d=c&&c.failIfMajorPerformanceCaveat]===void 0&&(L[d]=function(_){var x,w=function(A){var C=document.createElement("canvas"),P=Object.create(I.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=A,C.getContext("webgl",P)||C.getContext("experimental-webgl",P)}(_);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)}(d)),L[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var d}(m)}var L={};function F(m,c,d){const _=o.window.document.createElement(m);return c!==void 0&&(_.className=c),d&&d.appendChild(_),_}function j(m,c,d){const _=o.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(c))_.setAttributeNS(null,x,c[x]);return d&&d.appendChild(_),_}I.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const X=o.window.document&&o.window.document.documentElement.style,re=X&&X.userSelect!==void 0?"userSelect":"WebkitUserSelect";let de;function q(){X&&re&&(de=X[re],X[re]="none")}function H(){X&&re&&(X[re]=de)}function J(m){m.preventDefault(),m.stopPropagation(),o.window.removeEventListener("click",J,!0)}function Ee(){o.window.addEventListener("click",J,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",J,!0)},0)}function ue(m,c){const d=m.getBoundingClientRect();return at(m,d,c)}function Fe(m,c){const d=m.getBoundingClientRect(),_=[];for(let x=0;x<c.length;x++)_.push(at(m,d,c[x]));return _}function Qe(m){return o.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function at(m,c,d){const _=m.offsetWidth===c.width?1:m.offsetWidth/c.width;return new o.pointGeometry((d.clientX-c.left)*_,(d.clientY-c.top)*_)}function rt(m,c){var d=c[0],_=c[1],x=c[2],w=c[3],A=d*w-x*_;return A?(m[0]=w*(A=1/A),m[1]=-_*A,m[2]=-x*A,m[3]=d*A,m):null}function ht(m){const{userImage:c}=m;return!!(c&&c.render&&c.render())&&(m.data.replace(new Uint8Array(c.data.buffer)),!0)}class Bt extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,d){this._validate(c,d)&&(this.images[c]=d)}_validate(c,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new o.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),_=!1),_}_validateStretch(c,d){if(!c)return!0;let _=0;for(const x of c){if(x[0]<_||x[1]<x[0]||d<x[1])return!1;_=x[1]}return!0}_validateContent(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0}removeImage(c){const d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,d){let _=!0;if(!this.isLoaded())for(const x of c)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(c,d):this.requestors.push({ids:c,callback:d})}_notify(c,d){const _={};for(const x of c){this.images[x]||this.fire(new o.Event("styleimagemissing",{id:x}));const w=this.images[x];w?_[x]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:o.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){const{width:c,height:d}=this.atlasImage;return{width:c,height:d}}getPattern(c){const d=this.patterns[c],_=this.getImage(c);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new o.ImagePosition(x,_);this.patterns[c]={bin:x,position:w}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const w in this.patterns)c.push(this.patterns[w].bin);const{w:d,h:_}=o.potpack(c),x=this.atlasImage;x.resize({width:d||1,height:_||1});for(const w in this.patterns){const{bin:A}=this.patterns[w],C=A.x+1,P=A.y+1,O=this.images[w].data,D=O.width,U=O.height;o.RGBAImage.copy(O,x,{x:0,y:0},{x:C,y:P},{width:D,height:U}),o.RGBAImage.copy(O,x,{x:0,y:U-1},{x:C,y:P-1},{width:D,height:1}),o.RGBAImage.copy(O,x,{x:0,y:0},{x:C,y:P+U},{width:D,height:1}),o.RGBAImage.copy(O,x,{x:D-1,y:0},{x:C-1,y:P},{width:1,height:U}),o.RGBAImage.copy(O,x,{x:0,y:0},{x:C+D,y:P},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const d of c){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.images[d];ht(_)&&this.updateImage(d,_)}}}const Dn=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(m,c){return function([d,_,x]){const w=o.degToRad(_+90),A=o.degToRad(x);return{x:d*Math.cos(w)*Math.sin(A),y:d*Math.sin(w)*Math.sin(A),z:d*Math.cos(A),azimuthal:_,polar:x}}(m.expression.evaluate(c))}interpolate(m,c,d){return{x:o.number(m.x,c.x,d),y:o.number(m.y,c.y,d),z:o.number(m.z,c.z,d),azimuthal:o.number(m.azimuthal,c.azimuthal,d),polar:o.number(m.polar,c.polar,d)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),zn="-transition";class cn extends o.Evented{constructor(c){super(),this._transitionable=new o.Transitionable(Dn),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,d={}){if(!this._validate(o.validateLight,c,d))for(const _ in c){const x=c[_];o.endsWith(_,zn)?this._transitionable.setTransition(_.slice(0,-zn.length),x):this._transitionable.setValue(_,x)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,_){return(!_||_.validate!==!1)&&o.emitValidationErrors(this,c.call(o.validateStyle,o.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const jt=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),ts="-transition";class Ci extends o.Evented{constructor(c,d){super(),this._transitionable=new o.Transitionable(jt),this.set(c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d}get(){return this._transitionable.serialize()}set(c){for(const d in c){const _=c[d];o.endsWith(d,ts)?this._transitionable.setTransition(d.slice(0,-ts.length),_):this._transitionable.setValue(d,_)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}}function wt(m,c,d,_){const x=o.smoothstep(45,65,d),[w,A]=Gt(m,_),C=o.length(c);let P=1-Math.min(1,Math.exp((C-w)/(A-w)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*x*m.alpha}function Gt(m,c){const d=.5/Math.tan(.5*c);return[m.range[0]+d,m.range[1]+d]}const Ot=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),bn="-transition";class Cn extends o.Evented{constructor(c,d){super(),this._transitionable=new o.Transitionable(Ot),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){const c=this._transform,d=c.projection.name==="globe",_=o.globeToMercatorTransition(c.zoom),x=this.properties.get("range"),w=[.5,3];return{range:d?[o.number(w[0],x[0],_),o.number(w[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,d={}){if(!this._validate(o.validateFog,c,d)){for(const _ of Object.keys(o.spec.fog))c&&c[_]===void 0&&(c[_]=o.spec.fog[_].default);for(const _ in c){const x=c[_];o.endsWith(_,bn)?this._transitionable.setTransition(_.slice(0,-bn.length),x):this._transitionable.setValue(_,x)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,c))*d.a}getOpacityAtLatLng(c,d){return this._transform.projection.supportsFog?function(_,x,w){const A=o.MercatorCoordinate.fromLngLat(x),C=w.elevation?w.elevation.getAtPointOrZero(A):0,P=[A.x,A.y,C];return o.transformMat4(P,P,w.mercatorFogMatrix),wt(_,P,w.pitch,w._fov)}(this.state,c,d):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Gt(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,_){return(!_||_.validate!==!1)&&o.emitValidationErrors(this,c.call(o.validateStyle,o.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Hr{constructor(c,d){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const w=new Hr.Actor(_[x],d,this.id);w.name=`Worker ${x}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,d,_){o.asyncAll(this.actors,(x,w)=>{x.send(c,d,w)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function pr(m,c,d){return c*(o.EXTENT/(m.tileSize*Math.pow(2,d-m.tileID.overscaledZ)))}Hr.Actor=o.Actor;class ns{constructor(c,d,_,x){this.screenBounds=c,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(c,d){let _,x;if(c instanceof o.pointGeometry||typeof c[0]=="number"){const w=o.pointGeometry.convert(c);_=[w],x=d.isPointAboveHorizon(w)}else{const w=o.pointGeometry.convert(c[0]),A=o.pointGeometry.convert(c[1]);_=[w,A],x=o.polygonizeBounds(w,A).every(C=>d.isPointAboveHorizon(C))}return new ns(_,d.getCameraPoint(),x,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(c){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const d=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],x=o.polygonizeBounds(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(x[3]=this.cameraPoint)),o.bufferConvexPolygon(x,c)}bufferedCameraGeometryGlobe(c){const d=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],x=o.polygonizeBounds(d,_,c),w=this.cameraPoint.clone();switch(3*((w.y>d.y)+(w.y>_.y))+((w.x>d.x)+(w.x>_.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(c,d,_,x=0){const w=c.queryPadding/d._pixelsPerMercatorPixel+1,A=_?this._bufferedCameraMercator(w,d):this._bufferedScreenMercator(w,d);let C=c.tileID.wrap+(A.unwrapped?x:0);const P=A.polygon.map(ne=>o.getTilePoint(c.tileTransform,ne,C));if(!o.polygonIntersectsBox(P,0,0,o.EXTENT,o.EXTENT))return;C=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const O=this.screenGeometryMercator.polygon.map(ne=>o.getTileVec3(c.tileTransform,ne,C)),D=O.map(ne=>new o.pointGeometry(ne[0],ne[1])),U=d.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),$=o.getTileVec3(c.tileTransform,U,C),ee=O.map(ne=>{const W=o.sub(ne,ne,$);return o.normalize(W,W),new o.Ray($,W)}),Q=pr(c,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:ee,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(te=o.getBounds(P),te.min.x=o.clamp(te.min.x,0,o.EXTENT),te.min.y=o.clamp(te.min.y,0,o.EXTENT),te.max.x=o.clamp(te.max.x,0,o.EXTENT),te.max.y=o.clamp(te.max.y,0,o.EXTENT),te),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:Q};var te}_bufferedScreenMercator(c,d){const _=Zr(c);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(c),d):{polygon:this.bufferedScreenGeometry(c).map(w=>d.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(c,d){const _=Zr(c);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),d):{polygon:this.bufferedCameraGeometry(c).map(w=>d.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(c,d){const _=function(w,A){const C=o.multiply([],A.pixelMatrix,A.globeMatrix),P=[0,-o.GLOBE_RADIUS,0,1],O=[0,o.GLOBE_RADIUS,0,1],D=[0,0,0,1];o.transformMat4$1(P,P,C),o.transformMat4$1(O,O,C),o.transformMat4$1(D,D,C);const U=new o.pointGeometry(P[0]/P[3],P[1]/P[3]),$=new o.pointGeometry(O[0]/O[3],O[1]/O[3]),ee=o.polygonContainsPoint(w,U)&&P[3]<D[3],Q=o.polygonContainsPoint(w,$)&&O[3]<D[3];if(!ee&&!Q)return null;const te=function(Te,Pe,Le){for(let ze=1;ze<Te.length;ze++){const st=Mn(Pe.pointCoordinate3D(Te[ze-1]).x),Ie=Mn(Pe.pointCoordinate3D(Te[ze]).x);if(Le<0){if(st<Ie)return{idx:ze,t:-st/(Ie-1-st)}}else if(Ie<st)return{idx:ze,t:(1-st)/(Ie+1-st)}}return null}(w,A,ee?-1:1);if(!te)return null;const{idx:ne,t:W}=te;let he=ne>1?Fr(w.slice(0,ne),A):[],le=ne<w.length?Fr(w.slice(ne),A):[];he=he.map(Te=>new o.pointGeometry(Mn(Te.x),Te.y)),le=le.map(Te=>new o.pointGeometry(Mn(Te.x),Te.y));const pe=[...he];pe.length===0&&pe.push(le[le.length-1]);const xe=o.number(pe[pe.length-1].y,(le.length===0?he[0]:le[0]).y,W);let ye;return ye=ee?[new o.pointGeometry(0,xe),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,xe)]:[new o.pointGeometry(1,xe),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,xe)],pe.push(...ye),le.length===0?pe.push(he[0]):pe.push(...le),{polygon:pe.map(Te=>new o.MercatorCoordinate(Te.x,Te.y)),unwrapped:!1}}(c,d);if(_)return _;const x=function(w,A){let C=!1,P=-1/0,O=0;for(let U=0;U<w.length-1;U++)w[U].x>P&&(P=w[U].x,O=U);for(let U=0;U<w.length-1;U++){const $=(O+U)%(w.length-1),ee=w[$],Q=w[$+1];Math.abs(ee.x-Q.x)>.5&&(ee.x<Q.x?(ee.x+=1,$===0&&(w[w.length-1].x+=1)):(Q.x+=1,$+1===w.length-1&&(w[0].x+=1)),C=!0)}const D=o.mercatorXfromLng(A.center.lng);return C&&D<Math.abs(D-1)&&w.forEach(U=>{U.x-=1}),{polygon:w,unwrapped:C}}(Fr(c,d).map(w=>new o.pointGeometry(Mn(w.x),w.y)),d);return{polygon:x.polygon.map(w=>new o.MercatorCoordinate(w.x,w.y)),unwrapped:x.unwrapped}}}function Fr(m,c){return o.resample(m,d=>{const _=c.pointCoordinate3D(d);d.x=_.x,d.y=_.y},1/256)}function Mn(m){return m<0?1+m%1:m%1}function Zr(m){return 100*m|0}function Hn(m,c,d,_,x){const w=function(A,C){if(A)return x(A);if(C){m.url&&C.tiles&&m.tiles&&delete m.tiles;const P=o.pick(o.extend(C,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(P.vectorLayers=C.vector_layers,P.vectorLayerIds=P.vectorLayers.map(O=>O.id)),P.tiles=c.canonicalizeTileset(P,m.url),x(null,P)}};return m.url?o.getJSON(c.transformRequest(c.normalizeSourceURL(m.url,null,d,_),o.ResourceType.Source),w):o.exported.frame(()=>w(null,m))}class Zn{constructor(c,d,_){this.bounds=o.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const d=Math.pow(2,c.z),_=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*d),x=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*d),A=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*d);return c.x>=_&&c.x<w&&c.y>=x&&c.y<A}}class go{constructor(c,d,_){this.context=c;const x=c.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qr{constructor(c,d,_,x){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=x,this.context=c;const w=c.gl;this.buffer=w.createBuffer(),c.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,d){for(let _=0;_<this.attributes.length;_++){const x=d.attributes[this.attributes[_].name];x!==void 0&&c.enableVertexAttribArray(x)}}setVertexAttribPointers(c,d,_){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],A=d.attributes[w.name];A!==void 0&&c.vertexAttribPointer(A,w.components,c[Vn[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class on{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xr extends on{getDefault(){return o.Color.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Lr extends on{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Gi extends on{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class rs extends on{getDefault(){return[!0,!0,!0,!0]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class ta extends on{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class is extends on{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Or extends on{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Wi extends on{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class ss extends on{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}}class na extends on{getDefault(){return[0,1]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class ra extends on{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}}class Va extends on{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Es extends on{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}}class _o extends on{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class yo extends on{getDefault(){return o.Color.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class vo extends on{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class Nr extends on{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}}class xo extends on{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class Hs extends on{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class bo extends on{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class ja extends on{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class ia extends on{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class sa extends on{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class os extends on{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Ga extends on{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class wo extends on{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Mi extends on{getDefault(){return null}set(c){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Zs extends on{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class oa extends on{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Cl extends on{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class aa extends on{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Eo extends on{constructor(c,d){super(c),this.context=c,this.parent=d}getDefault(){return null}}class ai extends Eo{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class qs extends Eo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Ml extends qs{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class To{constructor(c,d,_,x){this.context=c,this.width=d,this.height=_;const w=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new ai(c,w),x&&(this.depthAttachment=new qs(c,w))}destroy(){const c=this.context.gl,d=this.colorAttachment.get();if(d&&c.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&c.deleteRenderbuffer(_)}c.deleteFramebuffer(this.framebuffer)}}class oe{constructor(c,d=!1){if(this.gl=c,this.isWebGL2=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),d){const _=c;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(c),deleteVertexArrayOES:_.deleteVertexArray.bind(c),bindVertexArrayOES:_.bindVertexArray.bind(c)}}this.clearColor=new Xr(this),this.clearDepth=new Lr(this),this.clearStencil=new Gi(this),this.colorMask=new rs(this),this.depthMask=new ta(this),this.stencilMask=new is(this),this.stencilFunc=new Or(this),this.stencilOp=new Wi(this),this.stencilTest=new ss(this),this.depthRange=new na(this),this.depthTest=new ra(this),this.depthFunc=new Va(this),this.blend=new Es(this),this.blendFunc=new _o(this),this.blendColor=new yo(this),this.blendEquation=new vo(this),this.cullFace=new Nr(this),this.cullFaceSide=new xo(this),this.frontFace=new Hs(this),this.program=new bo(this),this.activeTexture=new ja(this),this.viewport=new ia(this),this.bindFramebuffer=new sa(this),this.bindRenderbuffer=new os(this),this.bindTexture=new Ga(this),this.bindVertexBuffer=new wo(this),this.bindElementBuffer=new Mi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Zs(this),this.pixelStoreUnpack=new oa(this),this.pixelStoreUnpackPremultiplyAlpha=new Cl(this),this.pixelStoreUnpackFlipY=new aa(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),d||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(d||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=d||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,d){return new go(this,c,d)}createVertexBuffer(c,d,_){return new qr(this,c,d,_)}createRenderbuffer(c,d,_){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,c,d,_),this.bindRenderbuffer.set(null),w}createFramebuffer(c,d,_){return new To(this,c,d,_)}clear({color:c,depth:d,stencil:_}){const x=this.gl;let w=0;c&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),_!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(w)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){v(c.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class B extends o.Evented{constructor(c,d,_,x){if(super(),this.id=c,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(d,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(c){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Hn(this._options,this.map._requestManager,d,_,(x,w)=>{this._tileJSONRequest=null,this._loaded=!0,x?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new o.ErrorEvent(x))):w&&(o.extend(this,w),w.bounds&&(this.tileBounds=new Zn(w.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(w.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(x)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(c,d){const _=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(_,o.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",x,w.bind(this));else if(c.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",x,w.bind(this),void 0,!0);else{const A=o.loadVectorTile.call({deduped:this._deduped},x,(C,P)=>{C||!P?w.call(this,C):(x.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},c.actor&&c.actor.send("loadTile",x,w.bind(this),void 0,!0))},!0);c.request={cancel:A}}function w(A,C){return delete c.request,c.aborted?d(null):A&&A.status!==404?d(A):(C&&C.resourceTiming&&(c.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&c.setExpiryData(C),c.loadVectorData(C,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class G extends o.Evented{constructor(c,d,_,x){super(),this.id=c,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},d),o.extend(this,o.pick(d,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Hn(this._options,this.map._requestManager,null,null,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new o.ErrorEvent(d)):_&&(o.extend(this,_),_.bounds&&(this.tileBounds=new Zn(_.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(_.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(d)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,d){const _=o.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);c.request=o.getImage(this.map._requestManager.transformRequest(x,o.ResourceType.Tile),(w,A,C,P)=>(delete c.request,c.aborted?(c.state="unloaded",d(null)):w?(c.state="errored",d(w)):A?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:C,expires:P}),c.setTexture(A,this.map.painter),c.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(c,d,_){c.setTexture(d,_)}static unloadTileData(c,d){c.texture&&d.saveTileTexture(c.texture)}abortTile(c,d){c.request&&(c.request.cancel(),delete c.request),d()}unloadTile(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let se;function fe(m,c,d,_,x,w,A,C){const P=[m,d,x,c,_,w,1,1,1],O=[A,C,1],D=o.adjoint([],P),[U,$,ee]=o.transformMat3(O,O,o.transpose(D,D));return o.multiply$1(P,[U,0,0,0,$,0,0,0,ee],P)}class we extends o.Evented{constructor(c,d,_,x){super(),this.id=c,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=d,this._dirty=!1}load(c,d){this._loaded=d||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(_,x)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new o.ErrorEvent(_));else if(x){const{HTMLImageElement:w}=o.window;this.image=x instanceof w?o.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const d=c.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,w=1/0,A=-1/0,C=-1/0;for(const U of _)x=Math.min(x,U.x),w=Math.min(w,U.y),A=Math.max(A,U.x),C=Math.max(C,U.y);const P=Math.max(A-x,C-w),O=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),D=Math.pow(2,O);return new o.CanonicalTileID(O,Math.floor((x+A)/2*D),Math.floor((w+C)/2*D))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const P in this.tiles){const O=this.tiles[P];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const d=o.tileTransform(this.tileID,this.map.transform.projection),[_,x,w,A]=this.coordinates.map(P=>{const O=d.projection.project(P[0],P[1]);return o.getTilePoint(d,O)._round()});this.perspectiveTransform=function(P,O,D,U,$,ee,Q,te,ne,W){const he=fe(0,0,P,0,0,O,P,O),le=fe(D,U,$,ee,Q,te,ne,W);return o.multiply$1(le,o.adjoint(he,he),le),[le[6]/le[8]*P/o.EXTENT,le[7]/le[8]*O/o.EXTENT]}(this.width,this.height,_.x,_.y,x.x,x.y,A.x,A.y,w.x,w.y);const C=this._boundsArray=new o.StructArrayLayout4i8;C.emplaceBack(_.x,_.y,0,0),C.emplaceBack(x.x,x.y,o.EXTENT,0),C.emplaceBack(A.x,A.y,0,o.EXTENT),C.emplaceBack(w.x,w.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(C,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const c=this.map.painter.context,d=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ce={vector:B,raster:G,"raster-dem":class extends G{constructor(m,c,d,_){super(m,c,d,_),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(m,c){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,w){x&&(m.state="errored",c(x)),w&&(m.dem=w,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",c(null))}m.request=o.getImage(this.map._requestManager.transformRequest(d,o.ResourceType.Tile),function(x,w,A,C){if(delete m.request,m.aborted)m.state="unloaded",c(null);else if(x)m.state="errored",c(x);else if(w){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:A,expires:C});const P=o.window.ImageBitmap&&w instanceof o.window.ImageBitmap&&(se==null&&(se=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),se),O=1-(w.width-o.prevPowerOfTwo(w.width))/2;O<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const D=P?w:o.exported.getImageData(w,O),U={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:D,encoding:this.encoding,padding:O};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",U,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const c=m.canonical,d=Math.pow(2,c.z),_=(c.x-1+d)%d,x=c.x===0?m.wrap-1:m.wrap,w=(c.x+1+d)%d,A=c.x+1===d?m.wrap+1:m.wrap,C={};return C[new o.OverscaledTileID(m.overscaledZ,x,c.z,_,c.y).key]={backfilled:!1},C[new o.OverscaledTileID(m.overscaledZ,A,c.z,w,c.y).key]={backfilled:!1},c.y>0&&(C[new o.OverscaledTileID(m.overscaledZ,x,c.z,_,c.y-1).key]={backfilled:!1},C[new o.OverscaledTileID(m.overscaledZ,m.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},C[new o.OverscaledTileID(m.overscaledZ,A,c.z,w,c.y-1).key]={backfilled:!1}),c.y+1<d&&(C[new o.OverscaledTileID(m.overscaledZ,x,c.z,_,c.y+1).key]={backfilled:!1},C[new o.OverscaledTileID(m.overscaledZ,m.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},C[new o.OverscaledTileID(m.overscaledZ,A,c.z,w,c.y+1).key]={backfilled:!1}),C}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends o.Evented{constructor(m,c,d,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=c.data,this._options=o.extend({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const x=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*x,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*x,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:o.EXTENT,radius:(c.clusterRadius!==void 0?c.clusterRadius:50)*x,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},c),this}getClusterChildren(m,c){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},c),this}getClusterLeaves(m,c,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:c,offset:d},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=o.extend({},this.workerOptions),c=this._data;typeof c=="string"?(m.request=this.map._requestManager.transformRequest(o.exported.resolveURL(c),o.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new o.ErrorEvent(d));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new o.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,c){const d=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(d,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete m.request,m.unloadVectorData(),m.aborted?c(null):_?c(_):(m.loadVectorData(x,this.map.painter,d==="reloadTile"),c(null))),void 0,d==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends we{constructor(m,c,d,_){super(m,c,d,_),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const c of m.urls)this.urls.push(this.map._requestManager.transformRequest(c,o.ResourceType.Source).url);o.getVideo(this.urls,(c,d)=>{this._loaded=!0,c?this.fire(new o.ErrorEvent(c)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const c=this.video.seekable;m<c.start(0)||m>c.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,c=m.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(m,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:we,canvas:class extends we{constructor(m,c,d,_){super(m,c,d,_),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends o.Evented{constructor(m,c,d,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=c,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Zn(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:c,y:d,z:_}=m.canonical;return this._implementation.hasTile({x:c,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,c){const{x:d,y:_,z:x}=m.tileID.canonical,w=new o.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:d,y:_,z:x},{signal:w.signal})).then(function(A){return delete m.request,m.aborted?(m.state="unloaded",c(null)):A===void 0?(m.state="errored",c(null)):A===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",c(null)):function(C){return C instanceof o.window.ImageData||C instanceof o.window.HTMLCanvasElement||C instanceof o.window.ImageBitmap||C instanceof o.window.HTMLImageElement}(A)?(this.loadTileData(m,A),m.state="loaded",void c(null)):(m.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(A=>{A.code!==20&&(m.state="errored",c(A))}),m.request.cancel=()=>w.abort()}loadTileData(m,c){G.loadTileData(m,c,this._map.painter)}unloadTileData(m){G.unloadTileData(m,this._map.painter)}unloadTile(m,c){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:d,y:_,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:x})}c()}abortTile(m,c){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Me=function(m,c,d,_){const x=new Ce[c.type](m,c,d,_);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],x),x};function Se(m,c){const d=o.identity([]);return o.scale(d,d,[.5*m.width,.5*-m.height,1]),o.translate(d,d,[1,-1,0]),o.multiply(d,d,m.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(d)}function Re(m,c,d,_,x,w,A,C=!1){const P=m.tilesIn(_,A,C);P.sort(ft);const O=[];for(const U of P)O.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(c,d,m._state,U,x,w,Se(m.transform,U.tile.tileID),C)});const D=function(U){const $={},ee={};for(const Q of U){const te=Q.queryResults,ne=Q.wrappedTileID,W=ee[ne]=ee[ne]||{};for(const he in te){const le=te[he],pe=W[he]=W[he]||{},xe=$[he]=$[he]||[];for(const ye of le)pe[ye.featureIndex]||(pe[ye.featureIndex]=!0,xe.push(ye))}}return $}(O);for(const U in D)D[U].forEach($=>{const ee=$.feature,Q=ee.layer;Q&&Q.type!=="background"&&Q.type!=="sky"&&(ee.source=Q.source,Q["source-layer"]&&(ee.sourceLayer=Q["source-layer"]),ee.state=ee.id!==void 0?m.getFeatureState(Q["source-layer"],ee.id):{})});return D}function Xe(m,c){const d=m.getRenderableIds().map(w=>m.getTileByID(w)),_=[],x={};for(let w=0;w<d.length;w++){const A=d[w],C=A.tileID.canonical.key;x[C]||(x[C]=!0,A.querySourceFeatures(_,c))}return _}function ft(m,c){const d=m.tileID,_=c.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function et(){return bu.workerClass!=null?new bu.workerClass:new o.window.Worker(bu.workerUrl)}const Ct="mapboxgl_preloaded_worker_pool";class St{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<St.workerCount;)this.workers.push(new et);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ct]}numActive(){return Object.keys(this.active).length}}let Tt;function Lt(){return Tt||(Tt=new St),Tt}function Ht(m,c){const d={};for(const _ in m)_!=="ref"&&(d[_]=m[_]);return o.refProperties.forEach(_=>{_ in c&&(d[_]=c[_])}),d}function un(m){m=m.slice();const c=Object.create(null);for(let d=0;d<m.length;d++)c[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=Ht(m[d],c[m[d].ref]));return m}St.workerCount=2;const Dt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function dn(m,c,d){d.push({command:Dt.addSource,args:[m,c[m]]})}function Kt(m,c,d){c.push({command:Dt.removeSource,args:[m]}),d[m]=!0}function yi(m,c,d,_){Kt(m,d,_),dn(m,c,d)}function Br(m,c,d){let _;for(_ in m[d])if(m[d].hasOwnProperty(_)&&_!=="data"&&!v(m[d][_],c[d][_]))return!1;for(_ in c[d])if(c[d].hasOwnProperty(_)&&_!=="data"&&!v(m[d][_],c[d][_]))return!1;return!0}function je(m,c,d,_,x,w){let A;for(A in c=c||{},m=m||{})m.hasOwnProperty(A)&&(v(m[A],c[A])||d.push({command:w,args:[_,A,c[A],x]}));for(A in c)c.hasOwnProperty(A)&&!m.hasOwnProperty(A)&&(v(m[A],c[A])||d.push({command:w,args:[_,A,c[A],x]}))}function vi(m){return m.id}function wn(m,c){return m[c.id]=c,m}class Ur{constructor(c,d){this.reset(c,d)}reset(c,d){this.points=c||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=o.clamp(c,0,1);let d=1,_=this._distances[d];const x=c*this.paddedLength+this.padding;for(;_<x&&d<this._distances.length;)_=this._distances[++d];const w=d-1,A=this._distances[w],C=_-A,P=C>0?(x-A)/C:0;return this.points[w].mult(1-P).add(this.points[d].mult(P))}}class Zc{constructor(c,d,_){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(c/_),this.yCellCount=Math.ceil(d/_);for(let A=0;A<this.xCellCount*this.yCellCount;A++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=d,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,d,_,x,w){this._forEachCell(d,_,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(c,d,_,x){this._forEachCell(d-x,_-x,d+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(d),this.circles.push(_),this.circles.push(x)}_insertBoxCell(c,d,_,x,w,A){this.boxCells[w].push(A)}_insertCircleCell(c,d,_,x,w,A){this.circleCells[w].push(A)}_query(c,d,_,x,w,A){if(_<0||c>this.width||x<0||d>this.height)return!w&&[];const C=[];if(c<=0&&d<=0&&this.width<=_&&this.height<=x){if(w)return!0;for(let P=0;P<this.boxKeys.length;P++)C.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const O=this.circles[3*P],D=this.circles[3*P+1],U=this.circles[3*P+2];C.push({key:this.circleKeys[P],x1:O-U,y1:D-U,x2:O+U,y2:D+U})}return A?C.filter(A):C}return this._forEachCell(c,d,_,x,this._queryCell,C,{hitTest:w,seenUids:{box:{},circle:{}}},A),w?C.length>0:C}_queryCircle(c,d,_,x,w){const A=c-_,C=c+_,P=d-_,O=d+_;if(C<0||A>this.width||O<0||P>this.height)return!x&&[];const D=[];return this._forEachCell(A,P,C,O,this._queryCellCircle,D,{hitTest:x,circle:{x:c,y:d,radius:_},seenUids:{box:{},circle:{}}},w),x?D.length>0:D}query(c,d,_,x,w){return this._query(c,d,_,x,!1,w)}hitTest(c,d,_,x,w){return this._query(c,d,_,x,!0,w)}hitTestCircle(c,d,_,x){return this._queryCircle(c,d,_,!0,x)}_queryCell(c,d,_,x,w,A,C,P){const O=C.seenUids,D=this.boxCells[w];if(D!==null){const $=this.bboxes;for(const ee of D)if(!O.box[ee]){O.box[ee]=!0;const Q=4*ee;if(c<=$[Q+2]&&d<=$[Q+3]&&_>=$[Q+0]&&x>=$[Q+1]&&(!P||P(this.boxKeys[ee]))){if(C.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[ee],x1:$[Q],y1:$[Q+1],x2:$[Q+2],y2:$[Q+3]})}}}const U=this.circleCells[w];if(U!==null){const $=this.circles;for(const ee of U)if(!O.circle[ee]){O.circle[ee]=!0;const Q=3*ee;if(this._circleAndRectCollide($[Q],$[Q+1],$[Q+2],c,d,_,x)&&(!P||P(this.circleKeys[ee]))){if(C.hitTest)return A.push(!0),!0;{const te=$[Q],ne=$[Q+1],W=$[Q+2];A.push({key:this.circleKeys[ee],x1:te-W,y1:ne-W,x2:te+W,y2:ne+W})}}}}}_queryCellCircle(c,d,_,x,w,A,C,P){const O=C.circle,D=C.seenUids,U=this.boxCells[w];if(U!==null){const ee=this.bboxes;for(const Q of U)if(!D.box[Q]){D.box[Q]=!0;const te=4*Q;if(this._circleAndRectCollide(O.x,O.y,O.radius,ee[te+0],ee[te+1],ee[te+2],ee[te+3])&&(!P||P(this.boxKeys[Q])))return A.push(!0),!0}}const $=this.circleCells[w];if($!==null){const ee=this.circles;for(const Q of $)if(!D.circle[Q]){D.circle[Q]=!0;const te=3*Q;if(this._circlesCollide(ee[te],ee[te+1],ee[te+2],O.x,O.y,O.radius)&&(!P||P(this.circleKeys[Q])))return A.push(!0),!0}}}_forEachCell(c,d,_,x,w,A,C,P){const O=this._convertToXCellCoord(c),D=this._convertToYCellCoord(d),U=this._convertToXCellCoord(_),$=this._convertToYCellCoord(x);for(let ee=O;ee<=U;ee++)for(let Q=D;Q<=$;Q++)if(w.call(this,c,d,_,x,this.xCellCount*Q+ee,A,C,P))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,d,_,x,w,A){const C=x-c,P=w-d,O=_+A;return O*O>C*C+P*P}_circleAndRectCollide(c,d,_,x,w,A,C){const P=(A-x)/2,O=Math.abs(c-(x+P));if(O>P+_)return!1;const D=(C-w)/2,U=Math.abs(d-(w+D));if(U>D+_)return!1;if(O<=P||U<=D)return!0;const $=O-P,ee=U-D;return $*$+ee*ee<=_*_}}const $i=Math.tan(85*Math.PI/180);function Ts(m,c,d,_,x,w,A){const C=o.create();if(d)if(w.name==="globe"){const P=o.calculateGlobeLabelMatrix(x,c);o.multiply(C,C,P)}else{const P=rt([],A);C[0]=P[0],C[1]=P[1],C[4]=P[2],C[5]=P[3],_||o.rotateZ(C,C,x.angle)}else o.multiply(C,x.labelPlaneMatrix,m);return C}function Pi(m,c,d,_,x,w,A){const C=Ts(m,c,d,_,x,w,A);return w.name==="globe"&&d||(C[2]=C[6]=C[10]=C[14]=0),C}function Ss(m,c,d,_,x,w,A){if(d){if(w.name==="globe"){const C=Ts(m,c,d,_,x,w,A);return o.invert(C,C),o.multiply(C,m,C),C}{const C=o.clone(m),P=o.identity([]);return P[0]=A[0],P[1]=A[1],P[4]=A[2],P[5]=A[3],o.multiply(C,C,P),_||o.rotateZ(C,C,-x.angle),C}}return x.glCoordMatrix}function lt(m,c,d,_){const x=[m,c,d,1];d?o.transformMat4$1(x,x,_):vh(x,x,_);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function Xt(m,c){return Math.min(.5+m/c*.5,1.5)}function Zt(m,c){const d=m[0]/m[3],_=m[1]/m[3];return d>=-c[0]&&d<=c[0]&&_>=-c[1]&&_<=c[1]}function Ii(m,c,d,_,x,w,A,C,P,O){const D=d.transform,U=_?m.textSizeData:m.iconSizeData,$=o.evaluateSizeForZoom(U,d.transform.zoom),ee=D.projection.name==="globe",Q=[256/d.width*2+1,256/d.height*2+1],te=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;te.clear();let ne=null;ee&&(ne=_?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const W=m.lineVertexArray,he=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,le=d.transform.width/d.transform.height;let pe,xe=!1;for(let ye=0;ye<he.length;ye++){const Te=he.get(ye),{numGlyphs:Pe,writingMode:Le}=Te;if(Le!==o.WritingMode.vertical||xe||pe===o.WritingMode.horizontal||(xe=!0),pe=Le,(Te.hidden||Le===o.WritingMode.vertical)&&!xe){Pn(Pe,te);continue}xe=!1;const ze=new o.pointGeometry(Te.tileAnchorX,Te.tileAnchorY);let{x:st,y:Ie,z:Ze}=D.projection.projectTilePoint(ze.x,ze.y,O.canonical);if(P){const[qt,vt,gt]=P(ze);st+=qt,Ie+=vt,Ze+=gt}const Ue=[st,Ie,Ze,1];if(o.transformMat4$1(Ue,Ue,c),!Zt(Ue,Q)){Pn(Pe,te);continue}const Ke=Xt(d.transform.cameraToCenterDistance,Ue[3]),Oe=o.evaluateSizeForFeature(U,$,Te),Ae=A?Oe/Ke:Oe*Ke,Ne=lt(st,Ie,Ze,x);if(Ne[3]<=0){Pn(Pe,te);continue}let Ye={};const tt=A?null:P,At=Wa(Te,Ae,!1,C,c,x,w,m.glyphOffsetArray,W,te,ne,Ne,ze,Ye,le,tt,D.projection,O,A);xe=At.useVertical,tt&&At.needsFlipping&&(Ye={}),(At.notEnoughRoom||xe||At.needsFlipping&&Wa(Te,Ae,!0,C,c,x,w,m.glyphOffsetArray,W,te,ne,Ne,ze,Ye,le,tt,D.projection,O,A).notEnoughRoom)&&Pn(Pe,te)}_?(m.text.dynamicLayoutVertexBuffer.updateData(te),ne&&m.text.globeExtVertexBuffer.updateData(ne)):(m.icon.dynamicLayoutVertexBuffer.updateData(te),ne&&m.icon.globeExtVertexBuffer.updateData(ne))}function as(m,c,d,_,x,w,A,C,P,O,D,U,$,ee,Q,te){const{lineStartIndex:ne,glyphStartIndex:W,segment:he}=C,le=W+C.numGlyphs,pe=ne+C.lineLength,xe=c.getoffsetX(W),ye=c.getoffsetX(le-1),Te=Vr(m*xe,d,_,x,w,A,he,ne,pe,P,O,D,U,$,!0,ee,Q,te);if(!Te)return null;const Pe=Vr(m*ye,d,_,x,w,A,he,ne,pe,P,O,D,U,$,!0,ee,Q,te);return Pe?{first:Te,last:Pe}:null}function Wt(m,c,d,_){return m===o.WritingMode.horizontal&&Math.abs(_)>Math.abs(d)?{useVertical:!0}:m===o.WritingMode.vertical?_>0?{needsFlipping:!0}:null:c!==0&&function(x,w){return x===0||Math.abs(w/x)>$i}(d,_)?c===1?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function Wa(m,c,d,_,x,w,A,C,P,O,D,U,$,ee,Q,te,ne,W,he){const le=c/24,pe=m.lineOffsetX*le,xe=m.lineOffsetY*le,{lineStartIndex:ye,glyphStartIndex:Te,numGlyphs:Pe,segment:Le,writingMode:ze,flipState:st}=m,Ie=ye+m.lineLength,Ze=Ue=>{if(D){const[Ne,Ye,tt]=Ue.up,At=O.length;o.updateGlobeVertexNormal(D,At+0,Ne,Ye,tt),o.updateGlobeVertexNormal(D,At+1,Ne,Ye,tt),o.updateGlobeVertexNormal(D,At+2,Ne,Ye,tt),o.updateGlobeVertexNormal(D,At+3,Ne,Ye,tt)}const[Ke,Oe,Ae]=Ue.point;o.addDynamicAttributes(O,Ke,Oe,Ae,Ue.angle)};if(Pe>1){const Ue=as(le,C,pe,xe,d,U,$,m,P,w,ee,te,!1,ne,W,he);if(!Ue)return{notEnoughRoom:!0};if(_&&!d){let[Ke,Oe,Ae]=Ue.first.point,[Ne,Ye,tt]=Ue.last.point;[Ke,Oe]=lt(Ke,Oe,Ae,A),[Ne,Ye]=lt(Ne,Ye,tt,A);const At=Wt(ze,st,(Ne-Ke)*Q,Ye-Oe);if(m.flipState=At&&At.needsFlipping?1:2,At)return At}Ze(Ue.first);for(let Ke=Te+1;Ke<Te+Pe-1;Ke++){const Oe=Vr(le*C.getoffsetX(Ke),pe,xe,d,U,$,Le,ye,Ie,P,w,ee,te,!1,!1,ne,W,he);if(!Oe)return O.length-=4*(Ke-Te),{notEnoughRoom:!0};Ze(Oe)}Ze(Ue.last)}else{if(_&&!d){const Ke=lt($.x,$.y,0,x),Oe=ye+Le+1,Ae=new o.pointGeometry(P.getx(Oe),P.gety(Oe)),Ne=lt(Ae.x,Ae.y,0,x),Ye=Ne[3]>0?Ne:Xs($,Ae,Ke,1,x,void 0,ne,W.canonical),tt=Wt(ze,st,(Ye[0]-Ke[0])*Q,Ye[1]-Ke[1]);if(m.flipState=tt&&tt.needsFlipping?1:2,tt)return tt}const Ue=Vr(le*C.getoffsetX(Te),pe,xe,d,U,$,Le,ye,Ie,P,w,ee,te,!1,!1,ne,W,he);if(!Ue)return{notEnoughRoom:!0};Ze(Ue)}return{}}function So(m,c,d,_,x){const{x:w,y:A,z:C}=_.projectTilePoint(m.x,m.y,c);if(!x)return lt(w,A,C,d);const[P,O,D]=x(m);return lt(w+P,A+O,C+D,d)}function Xs(m,c,d,_,x,w,A,C){const P=So(m.sub(c)._unit()._add(m),C,x,A,w);return o.sub(P,d,P),o.normalize(P,P),o.scaleAndAdd(P,d,P,_)}function Vr(m,c,d,_,x,w,A,C,P,O,D,U,$,ee,Q,te,ne,W){const he=_?m-c:m+c;let le=he>0?1:-1,pe=0;_&&(le*=-1,pe=Math.PI),le<0&&(pe+=Math.PI);let xe=C+A+(le>0?0:1)|0,ye=x,Te=x,Pe=0,Le=0;const ze=Math.abs(he),st=[],Ie=[];let Ze=w,Ue=Ze;const Ke=()=>Xs(Ue,Ze,Te,ze-Pe+1,D,$,te,ne.canonical);for(;Pe+Le<=ze;){if(xe+=le,xe<C||xe>=P)return null;if(Te=ye,Ue=Ze,st.push(Te),ee&&Ie.push(Ue),Ze=new o.pointGeometry(O.getx(xe),O.gety(xe)),ye=U[xe],!ye){const gt=So(Ze,ne.canonical,D,te,$);ye=gt[3]>0?U[xe]=gt:Ke()}Pe+=Le,Le=o.distance(Te,ye)}Q&&$&&(U[xe]&&(ye=Ke(),Le=o.distance(Te,ye)),U[xe]=ye);const Oe=(ze-Pe)/Le,Ae=Ze.sub(Ue)._mult(Oe)._add(Ue),Ne=o.sub([],ye,Te),Ye=o.scaleAndAdd([],Te,Ne,Oe);let tt=[0,0,1],At=Ne[0],qt=Ne[1];if(W&&(tt=te.upVector(ne.canonical,Ae.x,Ae.y),tt[0]!==0||tt[1]!==0||tt[2]!==1)){const gt=[tt[2],0,-tt[0]],Mt=o.cross([],tt,gt);o.normalize(gt,gt),o.normalize(Mt,Mt),At=o.dot(Ne,gt),qt=o.dot(Ne,Mt)}if(d){const gt=o.cross([],tt,Ne);o.normalize(gt,gt),o.scaleAndAdd(Ye,Ye,gt,d*le)}const vt=pe+Math.atan2(qt,At);return st.push(Ye),ee&&Ie.push(Ae),{point:Ye,angle:vt,path:st,tilePath:Ie,up:tt}}function Pn(m,c){const d=c.length,_=d+4*m;c.resize(_),c.float32.fill(-1/0,4*d,4*_)}function vh(m,c,d){const _=c[0],x=c[1];return m[0]=d[0]*_+d[4]*x+d[12],m[1]=d[1]*_+d[5]*x+d[13],m[3]=d[3]*_+d[7]*x+d[15],m}const Z=100;class ie{constructor(c,d,_=new Zc(c.width+200,c.height+200,25),x=new Zc(c.width+200,c.height+200,25)){this.transform=c,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Z,this.screenBottomBoundary=c.height+Z,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=d}placeCollisionBox(c,d,_,x,w,A,C,P){let O=_.projectedAnchorX,D=_.projectedAnchorY,U=_.projectedAnchorZ;const $=_.elevation,ee=_.tileID,Q=c.getProjection();if($&&ee){const[ye,Te,Pe]=Q.upVector(ee.canonical,_.tileAnchorX,_.tileAnchorY),Le=Q.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=ye*$*Le,D+=Te*$*Le,U+=Pe*$*Le}const te=this.projectAndGetPerspectiveRatio(C,O,D,U,_.tileID,Q.name==="globe"||!!$||this.transform.pitch>0,Q),ne=A*te.perspectiveRatio,W=(_.x1*d+x.x-_.padding)*ne+te.point.x,he=(_.y1*d+x.y-_.padding)*ne+te.point.y,le=(_.x2*d+x.x+_.padding)*ne+te.point.x,pe=(_.y2*d+x.y+_.padding)*ne+te.point.y,xe=te.perspectiveRatio<=.55||te.occluded;return!this.isInsideGrid(W,he,le,pe)||!w&&this.grid.hitTest(W,he,le,pe,P)||xe?{box:[],offscreen:!1,occluded:te.occluded}:{box:[W,he,le,pe],offscreen:this.isOffscreen(W,he,le,pe),occluded:!1}}placeCollisionCircles(c,d,_,x,w,A,C,P,O,D,U,$,ee,Q,te){const ne=[],W=this.transform.elevation,he=c.getProjection(),le=W?W.getAtTileOffsetFunc(te,this.transform.center.lat,this.transform.worldSize,he):null,pe=new o.pointGeometry(_.tileAnchorX,_.tileAnchorY);let{x:xe,y:ye,z:Te}=he.projectTilePoint(pe.x,pe.y,te.canonical);if(le){const[Ae,Ne,Ye]=le(pe);xe+=Ae,ye+=Ne,Te+=Ye}const Pe=he.name==="globe",Le=this.projectAndGetPerspectiveRatio(C,xe,ye,Te,te,Pe||!!W||this.transform.pitch>0,he),{perspectiveRatio:ze}=Le,st=(U?A/ze:A*ze)/o.ONE_EM,Ie=lt(xe,ye,Te,P),Ze=Le.signedDistanceFromCamera>0?as(st,w,_.lineOffsetX*st,_.lineOffsetY*st,!1,Ie,pe,_,x,P,{},W&&!U?le:null,U&&!!W,he,te,U):null;let Ue=!1,Ke=!1,Oe=!0;if(Ze&&!Le.occluded){const Ae=.5*ee*ze+Q,Ne=new o.pointGeometry(-100,-100),Ye=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),tt=new Ur,{first:At,last:qt}=Ze,vt=At.path.length;let gt=[];for(let It=vt-1;It>=1;It--)gt.push(At.path[It]);for(let It=1;It<qt.path.length;It++)gt.push(qt.path[It]);const Mt=2.5*Ae;O&&(gt=gt.map(([It,gn,In],jn)=>(le&&!Pe&&(In=le(jn<vt-1?At.tilePath[vt-1-jn]:qt.tilePath[jn-vt+2])[2]),lt(It,gn,In,O))),gt.some(It=>It[3]<=0)&&(gt=[]));let nn=[];if(gt.length>0){let It=1/0,gn=-1/0,In=1/0,jn=-1/0;for(const Nn of gt)It=Math.min(It,Nn[0]),In=Math.min(In,Nn[1]),gn=Math.max(gn,Nn[0]),jn=Math.max(jn,Nn[1]);gn>=Ne.x&&It<=Ye.x&&jn>=Ne.y&&In<=Ye.y&&(nn=[gt.map(Nn=>new o.pointGeometry(Nn[0],Nn[1]))],(It<Ne.x||gn>Ye.x||In<Ne.y||jn>Ye.y)&&(nn=o.clipLine(nn,Ne.x,Ne.y,Ye.x,Ye.y)))}for(const It of nn){tt.reset(It,.25*Ae);let gn=0;gn=tt.length<=.5*Ae?1:Math.ceil(tt.paddedLength/Mt)+1;for(let In=0;In<gn;In++){const jn=In/Math.max(gn-1,1),Nn=tt.lerp(jn),xr=Nn.x+Z,ki=Nn.y+Z;ne.push(xr,ki,Ae,0);const As=xr-Ae,Po=ki-Ae,Kn=xr+Ae,Bn=ki+Ae;if(Oe=Oe&&this.isOffscreen(As,Po,Kn,Bn),Ke=Ke||this.isInsideGrid(As,Po,Kn,Bn),!d&&this.grid.hitTestCircle(xr,ki,Ae,$)&&(Ue=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Ue,occluded:!1}}}}return{circles:!D&&Ue||!Ke?[]:ne,offscreen:Oe,collisionDetected:Ue,occluded:Le.occluded}}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let _=1/0,x=1/0,w=-1/0,A=-1/0;for(const D of c){const U=new o.pointGeometry(D.x+Z,D.y+Z);_=Math.min(_,U.x),x=Math.min(x,U.y),w=Math.max(w,U.x),A=Math.max(A,U.y),d.push(U)}const C=this.grid.query(_,x,w,A).concat(this.ignoredGrid.query(_,x,w,A)),P={},O={};for(const D of C){const U=D.key;if(P[U.bucketInstanceId]===void 0&&(P[U.bucketInstanceId]={}),P[U.bucketInstanceId][U.featureIndex])continue;const $=[new o.pointGeometry(D.x1,D.y1),new o.pointGeometry(D.x2,D.y1),new o.pointGeometry(D.x2,D.y2),new o.pointGeometry(D.x1,D.y2)];o.polygonIntersectsPolygon(d,$)&&(P[U.bucketInstanceId][U.featureIndex]=!0,O[U.bucketInstanceId]===void 0&&(O[U.bucketInstanceId]=[]),O[U.bucketInstanceId].push(U.featureIndex))}return O}insertCollisionBox(c,d,_,x,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:w},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,d,_,x,w){const A=d?this.ignoredGrid:this.grid,C={bucketInstanceId:_,featureIndex:x,collisionGroupID:w};for(let P=0;P<c.length;P+=4)A.insertCircle(C,c[P],c[P+1],c[P+2])}projectAndGetPerspectiveRatio(c,d,_,x,w,A,C){const P=[d,_,x,1];let O=!1;if(x||this.transform.pitch>0){o.transformMat4$1(P,P,c);const U=C.name==="globe";this.fogState&&w&&!U&&(O=function(ee,Q,te,ne,W,he){const le=he.calculateFogTileMatrix(W),pe=[Q,te,ne];return o.transformMat4(pe,pe,le),wt(ee,pe,he.pitch,he._fov)}(this.fogState,d,_,x,w.toUnwrapped(),this.transform)>.9)}else vh(P,P,c);const D=P[3];return{point:new o.pointGeometry((P[0]/D+1)/2*this.transform.width+Z,(-P[1]/D+1)/2*this.transform.height+Z),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/D*.5,1.5),signedDistanceFromCamera:D,occluded:A&&P[2]>D||O}}isOffscreen(c,d,_,x){return _<Z||c>=this.screenRightBoundary||x<Z||d>this.screenBottomBoundary}isInsideGrid(c,d,_,x){return _>=0&&c<this.gridRightBoundary&&x>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const c=o.identity([]);return o.translate(c,c,[-100,-100,0]),c}}function be(m,c,d){const _=c.createTileMatrix(m,m.worldSize,d.toUnwrapped());return o.multiply(new Float32Array(16),m.projMatrix,_)}function Ge(m,c,d){if(c.projection.name===d.projection.name)return m.projMatrix;const _=d.clone();return _.setProjection(c.projection),be(_,c.getProjection(),m)}function ot(m,c,d){return c.name===d.projection.name?m.projMatrix:be(d,c,m)}class xt{constructor(c,d,_,x){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?d:-d))):x&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Yt{constructor(c,d,_,x,w,A=!1){this.text=new xt(c?c.text:null,d,_,w),this.icon=new xt(c?c.icon:null,d,x,w),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tr{constructor(c,d,_,x=!1){this.text=c,this.icon=d,this.skipFade=_,this.clipped=x}}class vr{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Fn{constructor(c,d,_,x,w){this.bucketInstanceId=c,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=w}}class vn{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const d=++this.maxGroupID;this.collisionGroups[c]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[c]}}function xh(m,c,d,_,x){const{horizontalAlign:w,verticalAlign:A}=o.getAnchorAlignment(m),C=-(w-.5)*c,P=-(A-.5)*d,O=o.evaluateVariableOffset(m,_);return new o.pointGeometry(C+O[0]*x,P+O[1]*x)}function qc(m,c,d,_,x){const w=new o.pointGeometry(m,c);return d&&w._rotate(_?x:-x),w}class Ri{constructor(c,d,_,x,w){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new ie(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new vn(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,d,_,x){const w=_.getBucket(d),A=_.latestFeatureIndex;if(!w||!A||d.id!==w.layerIds[0])return;const C=w.layers[0].layout,P=_.collisionBoxArray,O=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),D=_.tileSize/o.EXTENT,U=_.tileID.toUnwrapped();this.transform.setProjection(w.projection);const $=(ee=_.tileID,Q=w.getProjection(),te=this.transform,Q.name===this.projection?te.calculateProjMatrix(ee.toUnwrapped()):be(te,Q,ee));var ee,Q,te;const ne=C.get("text-pitch-alignment")==="map",W=C.get("text-rotation-alignment")==="map";d.compileFilter();const he=d.dynamicFilter(),le=d.dynamicFilterNeedsFeature(),pe=this.transform.calculatePixelsToTileUnitsMatrix(_),xe=Pi($,_.tileID.canonical,ne,W,this.transform,w.getProjection(),pe);let ye=null;if(ne){const Le=Ss($,_.tileID.canonical,ne,W,this.transform,w.getProjection(),pe);ye=o.multiply([],this.transform.labelPlaneMatrix,Le)}let Te=null;he&&_.latestFeatureIndex&&(Te={unwrappedTileID:U,dynamicFilter:he,dynamicFilterNeedsFeature:le,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new Fn(w.bucketInstanceId,A,w.sourceLayerIndex,w.index,_.tileID);const Pe={bucket:w,layout:C,posMatrix:$,textLabelPlaneMatrix:xe,labelToScreenMatrix:ye,clippingData:Te,scale:O,textPixelRatio:D,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(x)for(const Le of w.sortKeyRanges){const{sortKey:ze,symbolInstanceStart:st,symbolInstanceEnd:Ie}=Le;c.push({sortKey:ze,symbolInstanceStart:st,symbolInstanceEnd:Ie,parameters:Pe})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Pe})}attemptAnchorPlacement(c,d,_,x,w,A,C,P,O,D,U,$,ee,Q,te,ne,W,he){const{textOffset0:le,textOffset1:pe,crossTileID:xe}=$,ye=[le,pe],Te=xh(c,_,x,ye,w),Pe=this.collisionIndex.placeCollisionBox(Q,w,d,qc(Te.x,Te.y,A,C,this.transform.angle),U,P,O,D.predicate);if(ne){const Le=Q.getSymbolInstanceIconSize(he,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,Le,ne,qc(Te.x,Te.y,A,C,this.transform.angle),U,P,O,D.predicate).box.length===0)return}if(Pe.box.length>0){let Le;return this.prevPlacement&&this.prevPlacement.variableOffsets[xe]&&this.prevPlacement.placements[xe]&&this.prevPlacement.placements[xe].text&&(Le=this.prevPlacement.variableOffsets[xe].anchor),this.variableOffsets[xe]={textOffset:ye,width:_,height:x,anchor:c,textScale:w,prevAnchor:Le},this.markUsedJustification(Q,c,$,te),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,te,$),this.placedOrientations[xe]=te),{shift:Te,placedGlyphBoxes:Pe}}}placeLayerBucketPart(c,d,_,x){const{bucket:w,layout:A,posMatrix:C,textLabelPlaneMatrix:P,labelToScreenMatrix:O,clippingData:D,textPixelRatio:U,holdingForFade:$,collisionBoxArray:ee,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:te,collisionGroup:ne}=c.parameters,W=A.get("text-optional"),he=A.get("icon-optional"),le=A.get("text-allow-overlap"),pe=A.get("icon-allow-overlap"),xe=A.get("text-rotation-alignment")==="map",ye=A.get("text-pitch-alignment")==="map",Te=A.get("icon-text-fit")!=="none",Pe=A.get("symbol-z-order")==="viewport-y";this.transform.setProjection(w.projection);let Le=le&&(pe||!w.hasIconData()||he),ze=pe&&(le||!w.hasTextData()||W);!w.collisionArrays&&ee&&w.deserializeCollisionBoxes(ee),_&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,ee);const st=(Ie,Ze,Ue)=>{const{crossTileID:Ke,numVerticalGlyphVertices:Oe}=Ie;if(D){const Kn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Bn=null;if(D.dynamicFilterNeedsFeature){const fn=this.retainedQueryData[w.bucketInstanceId];Bn=D.featureIndex.loadFeature({featureIndex:Ie.featureIndex,bucketIndex:fn.bucketIndex,sourceLayerIndex:fn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,D.dynamicFilter)(Kn,Bn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new o.pointGeometry(Ie.tileAnchorX,Ie.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[Ke]=new tr(!1,!1,!1,!0),void(d[Ke]=!0)}if(d[Ke])return;if($)return void(this.placements[Ke]=new tr(!1,!1,!1));let Ae=!1,Ne=!1,Ye=!0,tt=!1,At=!1,qt=null,vt={box:null,offscreen:null,occluded:null},gt={box:null,offscreen:null,occluded:null},Mt=null,nn=null,It=null,gn=0,In=0,jn=0;Ue.textFeatureIndex?gn=Ue.textFeatureIndex:Ie.useRuntimeCollisionCircles&&(gn=Ie.featureIndex),Ue.verticalTextFeatureIndex&&(In=Ue.verticalTextFeatureIndex);const Nn=Kn=>{Kn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Bn=this.transform.elevation;(Bn||Kn.elevation)&&(Kn.elevation=Bn?Bn.getAtTileOffset(Kn.tileID,Kn.tileAnchorX,Kn.tileAnchorY):0)},xr=Ue.textBox;if(xr){Nn(xr);const Kn=fn=>{let lr=o.WritingMode.horizontal;if(w.allowVerticalPlacement&&!fn&&this.prevPlacement){const ci=this.prevPlacement.placedOrientations[Ke];ci&&(this.placedOrientations[Ke]=ci,lr=ci,this.markUsedOrientation(w,lr,Ie))}return lr},Bn=(fn,lr)=>{if(w.allowVerticalPlacement&&Oe>0&&Ue.verticalTextBox){for(const ci of w.writingModes)if(ci===o.WritingMode.vertical?(vt=lr(),gt=vt):vt=fn(),vt&&vt.box&&vt.box.length)break}else vt=fn()};if(A.get("text-variable-anchor")){let fn=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ke]){const qn=this.prevPlacement.variableOffsets[Ke];fn.indexOf(qn.anchor)>0&&(fn=fn.filter(ui=>ui!==qn.anchor),fn.unshift(qn.anchor))}const lr=(qn,ui,hi)=>{const da=w.getSymbolInstanceTextSize(Q,Ie,this.transform.zoom,Ze),Wl=(qn.x2-qn.x1)*da+2*qn.padding,Hi=(qn.y2-qn.y1)*da+2*qn.padding,us=Te&&!pe?ui:null;us&&Nn(us);let Io={box:[],offscreen:!1,occluded:!1};const fa=le?2*fn.length:fn.length;for(let pa=0;pa<fa;++pa){const $l=this.attemptAnchorPlacement(fn[pa%fn.length],qn,Wl,Hi,da,xe,ye,U,C,ne,pa>=fn.length,Ie,Ze,w,hi,us,Q,te);if($l&&(Io=$l.placedGlyphBoxes,Io&&Io.box&&Io.box.length)){Ae=!0,qt=$l.shift;break}}return Io};Bn(()=>lr(xr,Ue.iconBox,o.WritingMode.horizontal),()=>{const qn=Ue.verticalTextBox;return qn&&Nn(qn),w.allowVerticalPlacement&&!(vt&&vt.box&&vt.box.length)&&Oe>0&&qn?lr(qn,Ue.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),vt&&(Ae=vt.box,Ye=vt.offscreen,tt=vt.occluded);const ci=Kn(vt&&vt.box);if(!Ae&&this.prevPlacement){const qn=this.prevPlacement.variableOffsets[Ke];qn&&(this.variableOffsets[Ke]=qn,this.markUsedJustification(w,qn.anchor,Ie,ci))}}else{const fn=(lr,ci)=>{const qn=w.getSymbolInstanceTextSize(Q,Ie,this.transform.zoom,Ze),ui=this.collisionIndex.placeCollisionBox(w,qn,lr,new o.pointGeometry(0,0),le,U,C,ne.predicate);return ui&&ui.box&&ui.box.length&&(this.markUsedOrientation(w,ci,Ie),this.placedOrientations[Ke]=ci),ui};Bn(()=>fn(xr,o.WritingMode.horizontal),()=>{const lr=Ue.verticalTextBox;return w.allowVerticalPlacement&&Oe>0&&lr?(Nn(lr),fn(lr,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Kn(vt&&vt.box&&vt.box.length)}}if(Mt=vt,Ae=Mt&&Mt.box&&Mt.box.length>0,Ye=Mt&&Mt.offscreen,tt=Mt&&Mt.occluded,Ie.useRuntimeCollisionCircles){const Kn=w.text.placedSymbolArray.get(Ie.centerJustifiedTextSymbolIndex>=0?Ie.centerJustifiedTextSymbolIndex:Ie.verticalPlacedTextSymbolIndex),Bn=o.evaluateSizeForFeature(w.textSizeData,Q,Kn),fn=A.get("text-padding");nn=this.collisionIndex.placeCollisionCircles(w,le,Kn,w.lineVertexArray,w.glyphOffsetArray,Bn,C,P,O,_,ye,ne.predicate,Ie.collisionCircleDiameter*Bn/o.ONE_EM,fn,this.retainedQueryData[w.bucketInstanceId].tileID),Ae=le||nn.circles.length>0&&!nn.collisionDetected,Ye=Ye&&nn.offscreen,tt=nn.occluded}if(Ue.iconFeatureIndex&&(jn=Ue.iconFeatureIndex),Ue.iconBox){const Kn=Bn=>{Nn(Bn);const fn=Te&&qt?qc(qt.x,qt.y,xe,ye,this.transform.angle):new o.pointGeometry(0,0),lr=w.getSymbolInstanceIconSize(te,this.transform.zoom,Ie.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,lr,Bn,fn,pe,U,C,ne.predicate)};gt&&gt.box&&gt.box.length&&Ue.verticalIconBox?(It=Kn(Ue.verticalIconBox),Ne=It.box.length>0):(It=Kn(Ue.iconBox),Ne=It.box.length>0),Ye=Ye&&It.offscreen,At=It.occluded}const ki=W||Ie.numHorizontalGlyphVertices===0&&Oe===0,As=he||Ie.numIconVertices===0;if(ki||As?As?ki||(Ne=Ne&&Ae):Ae=Ne&&Ae:Ne=Ae=Ne&&Ae,Ae&&Mt&&Mt.box&&this.collisionIndex.insertCollisionBox(Mt.box,A.get("text-ignore-placement"),w.bucketInstanceId,gt&&gt.box&&In?In:gn,ne.ID),Ne&&It&&this.collisionIndex.insertCollisionBox(It.box,A.get("icon-ignore-placement"),w.bucketInstanceId,jn,ne.ID),nn&&(Ae&&this.collisionIndex.insertCollisionCircles(nn.circles,A.get("text-ignore-placement"),w.bucketInstanceId,gn,ne.ID),_)){const Kn=w.bucketInstanceId;let Bn=this.collisionCircleArrays[Kn];Bn===void 0&&(Bn=this.collisionCircleArrays[Kn]=new vr);for(let fn=0;fn<nn.circles.length;fn+=4)Bn.circles.push(nn.circles[fn+0]),Bn.circles.push(nn.circles[fn+1]),Bn.circles.push(nn.circles[fn+2]),Bn.circles.push(nn.collisionDetected?1:0)}const Po=w.projection.name!=="globe";Le=Le&&(Po||!tt),ze=ze&&(Po||!At),this.placements[Ke]=new tr(Ae||Le,Ne||ze,Ye||w.justReloaded),d[Ke]=!0};if(Pe){const Ie=w.getSortedSymbolIndexes(this.transform.angle);for(let Ze=Ie.length-1;Ze>=0;--Ze){const Ue=Ie[Ze];st(w.symbolInstances.get(Ue),Ue,w.collisionArrays[Ue])}}else for(let Ie=c.symbolInstanceStart;Ie<c.symbolInstanceEnd;Ie++)st(w.symbolInstances.get(Ie),Ie,w.collisionArrays[Ie]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const Ie=this.collisionCircleArrays[w.bucketInstanceId];o.invert(Ie.invProjMatrix,C),Ie.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(c,d,_,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:P,crossTileID:O}=_,D=o.getAnchorJustification(d),U=x===o.WritingMode.vertical?P:D==="left"?w:D==="center"?A:D==="right"?C:-1;w>=0&&(c.text.placedSymbolArray.get(w).crossTileID=U>=0&&w!==U?0:O),A>=0&&(c.text.placedSymbolArray.get(A).crossTileID=U>=0&&A!==U?0:O),C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:O),P>=0&&(c.text.placedSymbolArray.get(P).crossTileID=U>=0&&P!==U?0:O)}markUsedOrientation(c,d,_){const x=d===o.WritingMode.horizontal||d===o.WritingMode.horizontalOnly?d:0,w=d===o.WritingMode.vertical?d:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:O}=_,D=c.text.placedSymbolArray;A>=0&&(D.get(A).placedOrientation=x),C>=0&&(D.get(C).placedOrientation=x),P>=0&&(D.get(P).placedOrientation=x),O>=0&&(D.get(O).placedOrientation=w)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const x=d?d.symbolFadeChange(c):1,w=d?d.opacities:{},A=d?d.variableOffsets:{},C=d?d.placedOrientations:{};for(const P in this.placements){const O=this.placements[P],D=w[P];D?(this.opacities[P]=new Yt(D,x,O.text,O.icon,null,O.clipped),_=_||O.text!==D.text.placed||O.icon!==D.icon.placed):(this.opacities[P]=new Yt(null,x,O.text,O.icon,O.skipFade,O.clipped),_=_||O.text||O.icon)}for(const P in w){const O=w[P];if(!this.opacities[P]){const D=new Yt(O,x,!1,!1);D.isHidden()||(this.opacities[P]=D,_=_||O.text.placed||O.icon.placed)}}for(const P in A)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=A[P]);for(const P in C)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=C[P]);_?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:c)}updateLayerOpacities(c,d){const _={};for(const x of d){const w=x.getBucket(c);w&&x.latestFeatureIndex&&c.id===w.layerIds[0]&&this.updateBucketOpacities(w,_,x.collisionBoxArray)}}updateBucketOpacities(c,d,_){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const x=c.layers[0].layout,w=!!c.layers[0].dynamicFilter(),A=new Yt(null,0,!1,!1,!0),C=x.get("text-allow-overlap"),P=x.get("icon-allow-overlap"),O=x.get("text-variable-anchor"),D=x.get("text-rotation-alignment")==="map",U=x.get("text-pitch-alignment")==="map",$=x.get("icon-text-fit")!=="none",ee=new Yt(null,0,C&&(P||!c.hasIconData()||x.get("icon-optional")),P&&(C||!c.hasTextData()||x.get("text-optional")),!0);!c.collisionArrays&&_&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(_);const Q=(ne,W,he)=>{for(let le=0;le<W/4;le++)ne.opacityVertexArray.emplaceBack(he)};let te=0;for(let ne=0;ne<c.symbolInstances.length;ne++){const W=c.symbolInstances.get(ne),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:le,crossTileID:pe,numIconVertices:xe}=W;let ye=this.opacities[pe];d[pe]?ye=A:ye||(ye=ee,this.opacities[pe]=ye),d[pe]=!0;const Te=he>0||le>0,Pe=xe>0,Le=this.placedOrientations[pe],ze=Le===o.WritingMode.vertical,st=Le===o.WritingMode.horizontal||Le===o.WritingMode.horizontalOnly;if(!Te&&!Pe||ye.isHidden()||te++,Te){const Ie=wh(ye.text);Q(c.text,he,ze?Pl:Ie),Q(c.text,le,st?Pl:Ie);const Ze=ye.text.isHidden(),{leftJustifiedTextSymbolIndex:Ue,centerJustifiedTextSymbolIndex:Ke,rightJustifiedTextSymbolIndex:Oe,verticalPlacedTextSymbolIndex:Ae}=W,Ne=c.text.placedSymbolArray,Ye=Ze||ze?1:0;Ue>=0&&(Ne.get(Ue).hidden=Ye),Ke>=0&&(Ne.get(Ke).hidden=Ye),Oe>=0&&(Ne.get(Oe).hidden=Ye),Ae>=0&&(Ne.get(Ae).hidden=Ze||st?1:0);const tt=this.variableOffsets[pe];tt&&this.markUsedJustification(c,tt.anchor,W,Le);const At=this.placedOrientations[pe];At&&(this.markUsedJustification(c,"left",W,At),this.markUsedOrientation(c,At,W))}if(Pe){const Ie=wh(ye.icon),{placedIconSymbolIndex:Ze,verticalPlacedIconSymbolIndex:Ue}=W,Ke=c.icon.placedSymbolArray,Oe=ye.icon.isHidden()?1:0;Ze>=0&&(Q(c.icon,xe,ze?Pl:Ie),Ke.get(Ze).hidden=Oe),Ue>=0&&(Q(c.icon,W.numVerticalIconVertices,st?Pl:Ie),Ke.get(Ue).hidden=Oe)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Ie=c.collisionArrays[ne];if(Ie){let Ze=new o.pointGeometry(0,0),Ue=!0;if(Ie.textBox||Ie.verticalTextBox){if(O){const Oe=this.variableOffsets[pe];Oe?(Ze=xh(Oe.anchor,Oe.width,Oe.height,Oe.textOffset,Oe.textScale),D&&Ze._rotate(U?this.transform.angle:-this.transform.angle)):Ue=!1}w&&(Ue=!ye.clipped),Ie.textBox&&xi(c.textCollisionBox.collisionVertexArray,ye.text.placed,!Ue||ze,Ze.x,Ze.y),Ie.verticalTextBox&&xi(c.textCollisionBox.collisionVertexArray,ye.text.placed,!Ue||st,Ze.x,Ze.y)}const Ke=Ue&&!!(!st&&Ie.verticalIconBox);Ie.iconBox&&xi(c.iconCollisionBox.collisionVertexArray,ye.icon.placed,Ke,$?Ze.x:0,$?Ze.y:0),Ie.verticalIconBox&&xi(c.iconCollisionBox.collisionVertexArray,ye.icon.placed,!Ke,$?Ze.x:0,$?Ze.y:0)}}}if(c.fullyClipped=te===0,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=ne.invProjMatrix,c.placementViewportMatrix=ne.viewportMatrix,c.collisionCircleArray=ne.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>c}setStale(){this.stale=!0}}function xi(m,c,d,_,x){m.emplaceBack(c?1:0,d?1:0,_||0,x||0),m.emplaceBack(c?1:0,d?1:0,_||0,x||0),m.emplaceBack(c?1:0,d?1:0,_||0,x||0),m.emplaceBack(c?1:0,d?1:0,_||0,x||0)}const d_=Math.pow(2,25),bh=Math.pow(2,24),Mr=Math.pow(2,17),Xc=Math.pow(2,16),Hf=Math.pow(2,9),Yc=Math.pow(2,8),Yr=Math.pow(2,1);function wh(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const c=m.placed?1:0,d=Math.floor(127*m.opacity);return d*d_+c*bh+d*Mr+c*Xc+d*Hf+c*Yc+d*Yr+c}const Pl=0;class Ao{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,d,_,x,w){const A=this._bucketParts;for(;this._currentTileIndex<c.length;)if(d.getBucketParts(A,x,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((C,P)=>C.sortKey-P.sortKey));this._currentPartIndex<A.length;){const C=A[this._currentPartIndex];if(d.placeLayerBucketPart(C,this._seenCrossTileIDs,_,C.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class Kc{constructor(c,d,_,x,w,A,C,P){this.placement=new Ri(c,w,A,C,P),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(c,d,_){const x=o.exported.now(),w=()=>{const A=o.exported.now()-x;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=d[c[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=C)&&(!A.maxzoom||A.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Ao(A)),this._inProgressLayer.continuePlacement(_[A.source],this.placement,this._showCollisionBoxes,A,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Eh=512/o.EXTENT/2;class Wx{constructor(c,d,_){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let x=0;x<d.length;x++){const w=d.get(x),A=w.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,c)})}}getScaledCoordinates(c,d){const _=Eh/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*o.EXTENT+c.tileAnchorX)*_),y:Math.floor((d.canonical.y*o.EXTENT+c.tileAnchorY)*_)}}findMatches(c,d,_){const x=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let w=0;w<c.length;w++){const A=c.get(w);if(A.crossTileID)continue;const C=this.indexedSymbolInstances[A.key];if(!C)continue;const P=this.getScaledCoordinates(A,d);for(const O of C)if(Math.abs(O.coord.x-P.x)<=x&&Math.abs(O.coord.y-P.y)<=x&&!_[O.crossTileID]){_[O.crossTileID]=!0,A.crossTileID=O.crossTileID;break}}}}class Zf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Il{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const d=Math.round((c-this.lng)/360);if(d!==0)for(const _ in this.indexes){const x=this.indexes[_],w={};for(const A in x){const C=x[A];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),w[C.tileID.key]=C}this.indexes[_]=w}this.lng=c}addBucket(c,d,_){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let w=0;w<d.symbolInstances.length;w++)d.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const x=this.usedCrossTileIDs[c.overscaledZ];for(const w in this.indexes){const A=this.indexes[w];if(Number(w)>c.overscaledZ)for(const C in A){const P=A[C];P.tileID.isChildOf(c)&&P.findMatches(d.symbolInstances,c,x)}else{const C=A[c.scaledTo(Number(w)).key];C&&C.findMatches(d.symbolInstances,c,x)}}for(let w=0;w<d.symbolInstances.length;w++){const A=d.symbolInstances.get(w);A.crossTileID||(A.crossTileID=_.generate(),x[A.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Wx(c,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(c,d){for(const _ in d.indexedSymbolInstances)for(const x of d.indexedSymbolInstances[_])delete this.usedCrossTileIDs[c][x.crossTileID]}removeStaleBuckets(c){let d=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const w in x)c[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[w]),delete x[w],d=!0)}return d}}class f_{constructor(){this.layerIndexes={},this.crossTileIDs=new Zf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,d,_,x){let w=this.layerIndexes[c.id];w===void 0&&(w=this.layerIndexes[c.id]=new Il);let A=!1;const C={};x.name!=="globe"&&w.handleWrapJump(_);for(const P of d){const O=P.getBucket(c);O&&c.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(P.tileID,O,this.crossTileIDs)&&(A=!0),C[O.bucketInstanceId]=!0)}return w.removeStaleBuckets(C)&&(A=!0),A}pruneUnusedLayers(c){const d={};c.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const Jc=(m,c)=>o.emitValidationErrors(m,c&&c.filter(d=>d.identifier!=="source.canvas")),Rl=o.pick(Dt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),la=o.pick(Dt,["setCenter","setZoom","setBearing","setPitch"]),Th={version:8,layers:[],sources:{}},ca={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ls extends o.Evented{constructor(c,d={}){super(),this.map=c,this.dispatcher=new Hr(Lt(),this),this.imageManager=new Bt,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(c._requestManager,d.localFontFamily?o.LocalGlyphMode.all:d.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.crossTileSymbolIndex=new f_,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const _=this;this._rtlTextPluginCallback=ls.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,A)=>{if(o.triggerPluginCompletionEvent(w),A&&A.every(C=>C))for(const C in _._sourceCaches){const P=_._sourceCaches[C],O=P.getSource().type;O!=="vector"&&O!=="geojson"||P.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getSource(x.sourceId);if(w&&w.vectorLayerIds)for(const A in this._layers){const C=this._layers[A];C.source===w.id&&this._validateLayer(C)}})}loadURL(c,d={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const _=typeof d.validate=="boolean"?d.validate:!o.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);const x=this.map._requestManager.transformRequest(c,o.ResourceType.Style);this._request=o.getJSON(x,(w,A)=>{this._request=null,w?this.fire(new o.ErrorEvent(w)):A&&this._load(A,_)})}loadJSON(c,d={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(c,d.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Th,!1)}_updateLayerCount(c,d){const _=d?1:-1;c.is3D()&&(this._num3DLayers+=_),c.type==="circle"&&(this._numCircleLayers+=_),c.type==="symbol"&&(this._numSymbolLayers+=_)}_load(c,d){if(d&&Jc(this,o.validateStyle(c)))return;this._loaded=!0,this.stylesheet=o.clone$1(c),this._updateMapProjection();for(const x in c.sources)this.addSource(x,c.sources[x],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const _=un(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of _)x=o.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new cn(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(d,_,x){let w,A,C;const P=o.exported.devicePixelRatio>1?"@2x":"";let O=o.getJSON(_.transformRequest(_.normalizeSpriteURL(d,P,".json"),o.ResourceType.SpriteJSON),($,ee)=>{O=null,C||(C=$,w=ee,U())}),D=o.getImage(_.transformRequest(_.normalizeSpriteURL(d,P,".png"),o.ResourceType.SpriteImage),($,ee)=>{D=null,C||(C=$,A=ee,U())});function U(){if(C)x(C);else if(w&&A){const $=o.exported.getImageData(A),ee={};for(const Q in w){const{width:te,height:ne,x:W,y:he,sdf:le,pixelRatio:pe,stretchX:xe,stretchY:ye,content:Te}=w[Q],Pe=new o.RGBAImage({width:te,height:ne});o.RGBAImage.copy($,Pe,{x:W,y:he},{x:0,y:0},{width:te,height:ne}),ee[Q]={data:Pe,pixelRatio:pe,sdf:le,stretchX:xe,stretchY:ye,content:Te}}x(null,ee)}}return{cancel(){O&&(O.cancel(),O=null),D&&(D.cancel(),D=null)}}}(c,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new o.ErrorEvent(d));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(c){const d=this.getSource(c.source);if(!d)return;const _=c.sourceLayer;_&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(_)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const d=[];for(const _ of c){const x=this._layers[_];x.type!=="custom"&&d.push(x.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&(typeof c.isLayerDraped=="function"?c.isLayerDraped():ca[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const d=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(x.length||w.length)&&this._updateWorkerLayers(x,w);for(const A in this._updatedSources){const C=this._updatedSources[A];C==="reload"?this._reloadSource(A):C==="clear"&&this._clearSource(A)}this._updateTilesForChangedImages();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const _={};for(const x in this._sourceCaches){const w=this._sourceCaches[x];_[x]=w.used,w.used=!1}for(const x of this._order){const w=this._layers[x];if(w.recalculate(c,this._availableImages),!w.isHidden(c.zoom)){const C=this._getLayerSourceCache(w);C&&(C.used=!0)}const A=this.map.painter;if(A){const C=w.getProgramIds();if(!C)continue;const P=w.getProgramConfiguration(c.zoom);for(const O of C)A.useProgram(O,P)}}for(const x in _){const w=this._sourceCaches[x];_[x]!==w.used&&w.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),Jc(this,o.validateStyle(c)))return!1;(c=o.clone$1(c)).layers=un(c.layers);const d=function(x,w){if(!x)return[{command:Dt.setStyle,args:[w]}];let A=[];try{if(!v(x.version,w.version))return[{command:Dt.setStyle,args:[w]}];v(x.center,w.center)||A.push({command:Dt.setCenter,args:[w.center]}),v(x.zoom,w.zoom)||A.push({command:Dt.setZoom,args:[w.zoom]}),v(x.bearing,w.bearing)||A.push({command:Dt.setBearing,args:[w.bearing]}),v(x.pitch,w.pitch)||A.push({command:Dt.setPitch,args:[w.pitch]}),v(x.sprite,w.sprite)||A.push({command:Dt.setSprite,args:[w.sprite]}),v(x.glyphs,w.glyphs)||A.push({command:Dt.setGlyphs,args:[w.glyphs]}),v(x.transition,w.transition)||A.push({command:Dt.setTransition,args:[w.transition]}),v(x.light,w.light)||A.push({command:Dt.setLight,args:[w.light]}),v(x.fog,w.fog)||A.push({command:Dt.setFog,args:[w.fog]}),v(x.projection,w.projection)||A.push({command:Dt.setProjection,args:[w.projection]});const C={},P=[];(function(U,$,ee,Q){let te;for(te in $=$||{},U=U||{})U.hasOwnProperty(te)&&($.hasOwnProperty(te)||Kt(te,ee,Q));for(te in $)$.hasOwnProperty(te)&&(U.hasOwnProperty(te)?v(U[te],$[te])||(U[te].type==="geojson"&&$[te].type==="geojson"&&Br(U,$,te)?ee.push({command:Dt.setGeoJSONSourceData,args:[te,$[te].data]}):yi(te,$,ee,Q)):dn(te,$,ee))})(x.sources,w.sources,P,C);const O=[];x.layers&&x.layers.forEach(U=>{U.source&&C[U.source]?A.push({command:Dt.removeLayer,args:[U.id]}):O.push(U)});let D=x.terrain;D&&C[D.source]&&(A.push({command:Dt.setTerrain,args:[void 0]}),D=void 0),A=A.concat(P),v(D,w.terrain)||A.push({command:Dt.setTerrain,args:[w.terrain]}),function(U,$,ee){$=$||[];const Q=(U=U||[]).map(vi),te=$.map(vi),ne=U.reduce(wn,{}),W=$.reduce(wn,{}),he=Q.slice(),le=Object.create(null);let pe,xe,ye,Te,Pe,Le,ze;for(pe=0,xe=0;pe<Q.length;pe++)ye=Q[pe],W.hasOwnProperty(ye)?xe++:(ee.push({command:Dt.removeLayer,args:[ye]}),he.splice(he.indexOf(ye,xe),1));for(pe=0,xe=0;pe<te.length;pe++)ye=te[te.length-1-pe],he[he.length-1-pe]!==ye&&(ne.hasOwnProperty(ye)?(ee.push({command:Dt.removeLayer,args:[ye]}),he.splice(he.lastIndexOf(ye,he.length-xe),1)):xe++,Le=he[he.length-pe],ee.push({command:Dt.addLayer,args:[W[ye],Le]}),he.splice(he.length-pe,0,ye),le[ye]=!0);for(pe=0;pe<te.length;pe++)if(ye=te[pe],Te=ne[ye],Pe=W[ye],!le[ye]&&!v(Te,Pe))if(v(Te.source,Pe.source)&&v(Te["source-layer"],Pe["source-layer"])&&v(Te.type,Pe.type)){for(ze in je(Te.layout,Pe.layout,ee,ye,null,Dt.setLayoutProperty),je(Te.paint,Pe.paint,ee,ye,null,Dt.setPaintProperty),v(Te.filter,Pe.filter)||ee.push({command:Dt.setFilter,args:[ye,Pe.filter]}),v(Te.minzoom,Pe.minzoom)&&v(Te.maxzoom,Pe.maxzoom)||ee.push({command:Dt.setLayerZoomRange,args:[ye,Pe.minzoom,Pe.maxzoom]}),Te)Te.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&(ze.indexOf("paint.")===0?je(Te[ze],Pe[ze],ee,ye,ze.slice(6),Dt.setPaintProperty):v(Te[ze],Pe[ze])||ee.push({command:Dt.setLayerProperty,args:[ye,ze,Pe[ze]]}));for(ze in Pe)Pe.hasOwnProperty(ze)&&!Te.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&(ze.indexOf("paint.")===0?je(Te[ze],Pe[ze],ee,ye,ze.slice(6),Dt.setPaintProperty):v(Te[ze],Pe[ze])||ee.push({command:Dt.setLayerProperty,args:[ye,ze,Pe[ze]]}))}else ee.push({command:Dt.removeLayer,args:[ye]}),Le=he[he.lastIndexOf(ye)+1],ee.push({command:Dt.addLayer,args:[Pe,Le]})}(O,w.layers,A)}catch(C){console.warn("Unable to compute style diff:",C),A=[{command:Dt.setStyle,args:[w]}]}return A}(this.serialize(),c).filter(x=>!(x.command in la));if(d.length===0)return!1;const _=d.filter(x=>!(x.command in Rl));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return d.forEach(x=>{x.command!=="setTransition"&&x.command!=="setProjection"&&this[x.command].apply(this,x.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,d){return this.getImage(c)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,d),this._afterImageUpdated(c),this)}updateImage(c,d){this.imageManager.updateImage(c,d)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,d,_={}){if(this._checkLoaded(),this.getSource(c)!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(o.validateSource,`sources.${c}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const x=Me(c,d,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:x.serialize(),sourceId:c}));const w=A=>{const C=(A?"symbol:":"other:")+c,P=this._sourceCaches[C]=new o.SourceCache(C,x,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[c]=P,P.style=this,P.onAdd(this.map)};w(!1),d.type!=="vector"&&d.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const d=this.getSource(c);if(!d)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===c)return this.fire(new o.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new o.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(c);for(const x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,d){this._checkLoaded(),this.getSource(c).setData(d),this._changed=!0}getSource(c){const d=this._getSourceCache(c);return d&&d.getSource()}_getSources(){const c=[];for(const d in this._otherSourceCaches){const _=this._getSourceCache(d);_&&c.push(_.getSource())}return c}addLayer(c,d,_={}){this._checkLoaded();const x=c.id;if(this.getLayer(x))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(c.type==="custom"){if(Jc(this,o.validateCustomStyleLayer(c)))return;w=o.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(x,c.source),c=o.clone$1(c),c=o.extend(c,{source:x})),this._validate(o.validateLayer,`layers.${x}`,c,{arrayIndex:-1},_))return;w=o.createStyleLayer(c),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const A=d?this._order.indexOf(d):this._order.length;if(d&&A===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(A,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const C=this._getLayerSourceCache(w);if(this._removedLayers[x]&&w.source&&C&&w.type!=="custom"){const P=this._removedLayers[x];delete this._removedLayers[x],P.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",C.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,d){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===d)return;const _=this._order.indexOf(c);this._order.splice(_,1);const x=d?this._order.indexOf(d):this._order.length;d&&x===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(x,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const d=this._layers[c];if(!d)return void this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const _=this._order.indexOf(c);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const d in this._layers)if(this._layers[d].type===c)return!0;return!1}setLayerZoomRange(c,d,_){this._checkLoaded();const x=this.getLayer(c);x?x.minzoom===d&&x.maxzoom===_||(d!=null&&(x.minzoom=d),_!=null&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,d,_={}){this._checkLoaded();const x=this.getLayer(c);if(x){if(!v(x.filter,d))return d==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(o.validateFilter,`layers.${x.id}.filter`,d,{layerType:x.type},_)||(x.filter=o.clone$1(d),this._updateLayer(x)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const d=this.getLayer(c);return d&&o.clone$1(d.filter)}setLayoutProperty(c,d,_,x={}){this._checkLoaded();const w=this.getLayer(c);w?v(w.getLayoutProperty(d),_)||(w.setLayoutProperty(d,_,x),this._updateLayer(w)):this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,d){const _=this.getLayer(c);if(_)return _.getLayoutProperty(d);this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,d,_,x={}){this._checkLoaded();const w=this.getLayer(c);w?v(w.getPaintProperty(d),_)||(w.setPaintProperty(d,_,x)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,d){const _=this.getLayer(c);return _&&_.getPaintProperty(d)}setFeatureState(c,d){this._checkLoaded();const _=c.source,x=c.sourceLayer,w=this.getSource(_);if(!w)return void this.fire(new o.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const A=w.type;if(A==="geojson"&&x)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!x)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));c.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(_);for(const P of C)P.setFeatureState(x,c.id,d)}removeFeatureState(c,d){this._checkLoaded();const _=c.source,x=this.getSource(_);if(!x)return void this.fire(new o.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const w=x.type,A=w==="vector"?c.sourceLayer:void 0;if(w==="vector"&&!A)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof c.id!="string"&&typeof c.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(_);for(const P of C)P.removeFeatureState(A,c.id,d)}getFeatureState(c){this._checkLoaded();const d=c.source,_=c.sourceLayer,x=this.getSource(d);if(x){if(x.type!=="vector"||_)return c.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(_,c.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const d in this._sourceCaches){const _=this._sourceCaches[d].getSource();c[_.id]||(c[_.id]=_.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateLayer(c){this._updatedLayers[c.id]=!0;const d=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&d&&d.getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",d.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const d=A=>this._layers[A].type==="fill-extrusion",_={},x=[];for(let A=this._order.length-1;A>=0;A--){const C=this._order[A];if(d(C)){_[C]=A;for(const P of c){const O=P[C];if(O)for(const D of O)x.push(D)}}}x.sort((A,C)=>C.intersectionZ-A.intersectionZ);const w=[];for(let A=this._order.length-1;A>=0;A--){const C=this._order[A];if(d(C))for(let P=x.length-1;P>=0;P--){const O=x[P].feature;if(_[O.layer.id]<A)break;w.push(O),x.pop()}else for(const P of c){const O=P[C];if(O)for(const D of O)w.push(D.feature)}}return w}queryRenderedFeatures(c,d,_){d&&d.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const x={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of d.layers){const O=this._layers[P];if(!O)return this.fire(new o.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];x[O.source]=!0}}const w=[];d.availableImages=this._availableImages;const A=d&&d.layers?d.layers.some(P=>{const O=this.getLayer(P);return O&&O.is3D()}):this.has3DLayers(),C=ns.createFromScreenPoints(c,_);for(const P in this._sourceCaches){const O=this._sourceCaches[P].getSource().id;d.layers&&!x[O]||w.push(Re(this._sourceCaches[P],this._layers,this._serializedLayers,C,d,_,A,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(P,O,D,U,$,ee,Q){const te={},ne=ee.queryRenderedSymbols(U),W=[];for(const he of Object.keys(ne).map(Number))W.push(Q[he]);W.sort(ft);for(const he of W){const le=he.featureIndex.lookupSymbolFeatures(ne[he.bucketInstanceId],O,he.bucketIndex,he.sourceLayerIndex,$.filter,$.layers,$.availableImages,P);for(const pe in le){const xe=te[pe]=te[pe]||[],ye=le[pe];ye.sort((Te,Pe)=>{const Le=he.featureSortOrder;if(Le){const ze=Le.indexOf(Te.featureIndex);return Le.indexOf(Pe.featureIndex)-ze}return Pe.featureIndex-Te.featureIndex});for(const Te of ye)xe.push(Te)}}for(const he in te)te[he].forEach(le=>{const pe=le.feature,xe=D(P[he]).getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=xe});return te}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(c,d){d&&d.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const _=this._getSourceCaches(c);let x=[];for(const w of _)x=x.concat(Xe(w,d));return x}addSourceType(c,d,_){return ls.getSourceType(c)?_(new Error(`A source type called "${c}" already exists.`)):(ls.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(c,d={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const A in c)if(!v(c[A],_[A])){x=!0;break}if(!x)return;const w=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,d),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,d=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(d===1){if(typeof c.source=="object"){const _="terrain-dem-src";this.addSource(_,c.source),c=o.clone$1(c),c=o.extend(c,{source:_})}if(this._validate(o.validateTerrain,"terrain",c))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode)this._createTerrain(c,d);else{const _=this.terrain,x=_.get();for(const w of Object.keys(o.spec.terrain))!c.hasOwnProperty(w)&&o.spec.terrain[w].default&&(c[w]=o.spec.terrain[w].default);for(const w in c)if(!v(c[w],x[w])){_.set(c),this.stylesheet.terrain=c;const A=this._setTransitionParameters({duration:0});_.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const d=this.fog=new Cn(c,this.map.transform);this.stylesheet.fog=c;const _=this._setTransitionParameters({duration:0});d.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,_=d.get();Object.keys(c).length===0&&d.set(c);for(const x in c)if(!v(c[x],_[x])){d.set(c),this.stylesheet.fog=c;const w=this._setTransitionParameters({duration:0});d.updateTransitions(w);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:o.exported.now(),transition:o.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(_=>this.isLayerDraped(this._layers[_])),d=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...d)}_createTerrain(c,d){const _=this.terrain=new Ci(c,d);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(const c in this._layers){const d=this._layers[c];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const d=this._layers[c];d.type==="symbol"&&this._updateLayer(d)}}_validate(c,d,_,x,w={}){return(!w||w.validate!==!1)&&Jc(this,c.call(o.validateStyle,o.extend({key:d,style:this.serialize(),value:_,styleSpec:o.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const d=this._getSourceCaches(c);for(const _ of d)_.clearTiles()}_reloadSource(c){const d=this._getSourceCaches(c);for(const _ of d)_.resume(),_.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const d in this._sourceCaches)this._sourceCaches[d].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const d=this._sourceCaches[c];d.resume(),d.reload()}}_updatePlacement(c,d,_,x,w=!1){let A=!1,C=!1;const P={};for(const O of this._order){const D=this._layers[O];if(D.type!=="symbol")continue;if(!P[D.source]){const $=this._getLayerSourceCache(D);if(!$)continue;P[D.source]=$.getRenderableIds(!0).map(ee=>$.getTileByID(ee)).sort((ee,Q)=>Q.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(Q.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(D,P[D.source],c.center.lng,c.projection);A=A||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),c.zoom))&&(this.pauseablePlacement=new Kc(c,this._order,w,d,_,x,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),C=!0),A&&this.pauseablePlacement.placement.setStale()),C||A)for(const O of this._order){const D=this._layers[O];D.type==="symbol"&&this.placement.updateLayerOpacities(D,P[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(d.tileID.key,d.type,d.icons)};x(this._otherSourceCaches[d.source]),x(this._symbolSourceCaches[d.source])}getGlyphs(c,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(c,d,_){return o.makeRequest(d,_)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return c.type==="symbol"?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const d=[];return this._otherSourceCaches[c]&&d.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&d.push(this._symbolSourceCaches[c]),d}_isSourceCacheLoaded(c){const d=this._getSourceCaches(c);return d.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ls.getSourceType=function(m){return Ce[m]},ls.setSourceType=function(m,c){Ce[m]=c},ls.registerForPluginStateChange=o.registerForPluginStateChange;var Qc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,p_="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",m_=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Sh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,g_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let qf={},Xf={};const kl=[];$a(Qc,kl),$a(m_,kl),$a(Sh,kl),$a(g_,kl),qf=mn("",m_),Xf=mn(g_,Sh);const __=mn(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ah=Qc,Ch=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Yf={background:mn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:mn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:mn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:mn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:mn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:mn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:mn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:mn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:mn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:mn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:mn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:mn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:mn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:mn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:mn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:mn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:mn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:mn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:mn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:mn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:mn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:mn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:mn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:mn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,p_),skyboxGradient:mn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,p_),skyboxCapture:mn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:mn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:mn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function $a(m,c){const d=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of d)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=_.split(" ");for(const w of x)c.includes(w)||c.push(w)}}function mn(m,c){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},w=[...kl];return $a(m,w),$a(c,w),{fragmentSource:m=m.replace(d,(A,C,P,O,D)=>(x[D]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${D}
varying ${P} ${O} ${D};
#else
uniform ${P} ${O} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${P} ${O} ${D} = u_${D};
#endif
`)),vertexSource:c=c.replace(d,(A,C,P,O,D)=>{const U=O==="float"?"vec2":"vec4",$=D.match(/color/)?"color":U;return x[D]?C==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${P} ${U} a_${D};
varying ${P} ${O} ${D};
#else
uniform ${P} ${O} u_${D};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${P} ${O} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${$}(a_${D}, u_${D}_t);
#else
    ${P} ${O} ${D} = u_${D};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${P} ${U} a_${D};
#else
uniform ${P} ${O} u_${D};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${P} ${O} ${D} = a_${D};
#else
    ${P} ${O} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${P} ${O} ${D} = unpack_mix_${$}(a_${D}, u_${D}_t);
#else
    ${P} ${O} ${D} = u_${D};
#endif
`}),staticAttributes:_,usedDefines:w}}class eu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,d,_,x,w,A,C){this.context=c;let P=this.boundPaintVertexBuffers.length!==x.length;for(let D=0;!P&&D<x.length;D++)this.boundPaintVertexBuffers[D]!==x[D]&&(P=!0);let O=this.boundDynamicVertexBuffers.length!==C.length;for(let D=0;!O&&D<C.length;D++)this.boundDynamicVertexBuffers[D]!==C[D]&&(O=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||P||O||this.boundIndexBuffer!==w||this.boundVertexOffset!==A)this.freshBind(d,_,x,w,A,C);else{c.bindVertexArrayOES.set(this.vao);for(const D of C)D&&D.bind();w&&w.dynamicDraw&&w.bind()}}freshBind(c,d,_,x,w,A){let C;const P=c.numAttributes,O=this.context,D=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=c,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=A;else{C=O.currentNumAttributes||0;for(let U=P;U<C;U++)D.disableVertexAttribArray(U)}d.enableAttributes(D,c),d.bind(),d.setVertexAttribPointers(D,c,w);for(const U of _)U.enableAttributes(D,c),U.bind(),U.setVertexAttribPointers(D,c,w);for(const U of A)U&&(U.enableAttributes(D,c),U.bind(),U.setVertexAttribPointers(D,c,w));x&&x.bind(),O.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Kf(m,c){const d=Math.pow(2,c.canonical.z),_=c.canonical.y;return[new o.MercatorCoordinate(0,_/d).toLngLat().lat,new o.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}function tu(m,c,d,_,x,w,A){const C=m.context,P=C.gl,O=d.fbo;if(!O)return;m.prepareDrawTile();const D=m.useProgram("hillshade");C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.colorAttachment.get());const U=((te,ne,W,he)=>{const le=W.paint.get("hillshade-shadow-color"),pe=W.paint.get("hillshade-highlight-color"),xe=W.paint.get("hillshade-accent-color");let ye=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(ye-=te.transform.angle);const Te=!te.options.moving;return{u_matrix:he||te.transform.calculateProjMatrix(ne.tileID.toUnwrapped(),Te),u_image:0,u_latrange:Kf(0,ne.tileID),u_light:[W.paint.get("hillshade-exaggeration"),ye],u_shadow:le,u_highlight:pe,u_accent:xe}})(m,d,_,m.terrain?c.projMatrix:null);m.prepareDrawProgram(C,D,c.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:ee,tileBoundsSegments:Q}=m.getTileBoundsBuffers(d);D.draw(C,P.TRIANGLES,x,w,A,o.CullFaceMode.disabled,U,_.id,$,ee,Q)}function nu(m,c,d){if(!c.needsDEMTextureUpload)return;const _=m.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||m.getTileTexture(d.stride);const w=d.getPixels();c.demTexture?c.demTexture.update(w,{premultiply:!1}):c.demTexture=new o.Texture(_,w,x.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function Mh(m,c,d,_,x,w){const A=m.context,C=A.gl;if(!c.dem)return;const P=c.dem;if(A.activeTexture.set(C.TEXTURE1),nu(m,c,P),!c.demTexture)return;c.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const O=P.dim;A.activeTexture.set(C.TEXTURE0);let D=c.fbo;if(!D){const Q=new o.Texture(A,{width:O,height:O,data:null},C.RGBA);Q.bind(C.LINEAR,C.CLAMP_TO_EDGE),D=c.fbo=A.createFramebuffer(O,O,!0),D.colorAttachment.set(Q.texture)}A.bindFramebuffer.set(D.framebuffer),A.viewport.set([0,0,O,O]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:$,tileBoundsSegments:ee}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(A,C.TRIANGLES,_,x,w,o.CullFaceMode.disabled,((Q,te)=>{const ne=te.stride,W=o.create();return o.ortho(W,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(W,W,[0,-o.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[ne,ne],u_zoom:Q.overscaledZ,u_unpack:te.unpackVector}})(c.tileID,P),d.id,U,$,ee),c.needsHillshadePrepare=!1}const Ph=m=>({u_matrix:new o.UniformMatrix4f(m),u_image0:new o.Uniform1i(m),u_skirt_height:new o.Uniform1f(m)}),Jf=(m,c)=>({u_matrix:m,u_image0:0,u_skirt_height:c}),Ih=(m,c,d,_,x,w,A,C,P,O,D,U,$,ee,Q)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:d,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:A,u_frustum_tr:C,u_frustum_br:P,u_frustum_bl:O,u_globe_pos:D,u_globe_radius:U,u_viewport:$,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:ee});function Qf(m,c){return m!=null&&c!=null&&!(!m.hasData()||!c.hasData())&&m.demTexture!=null&&c.demTexture!=null&&m.tileID.key!==c.tileID.key}const ua=new class{constructor(){this.operations={}}newMorphing(m,c,d,_,x){if(m in this.operations){const w=this.operations[m];w.to.tileID.key!==d.tileID.key&&(w.queued=d)}else this.operations[m]={startTime:_,phase:0,duration:x,from:c,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const c=this.operations[m];return{from:c.from,to:c.to,phase:c.phase}}update(m){for(const c in this.operations){const d=this.operations[c];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[c];break}}}_nextOp(m,c){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=c,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Ha={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Rh(m){return 6*Math.pow(1.5,22-m)}function ep(m,c){const d=1<<m.z;return!c&&(m.x===0||m.x===d-1)||m.y===0||m.y===d-1}const ln=m=>({u_matrix:m});function ru(m,c,d,_,x){if(x>0){const w=o.exported.now(),A=(w-m.timeAdded)/x,C=c?(w-c.timeAdded)/x:-1,P=d.getSource(),O=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),D=!c||Math.abs(c.tileID.overscaledZ-O)>Math.abs(m.tileID.overscaledZ-O),U=D&&m.refreshedUponExpiration?1:o.clamp(D?A:1-C,0,1);return m.refreshedUponExpiration&&A>=1&&(m.refreshedUponExpiration=!1),c?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class y_ extends o.SourceCache{constructor(c){const d={type:"raster-dem",maxzoom:c.transform.maxZoom},_=new Hr(Lt(),null),x=Me("mock-dem",d,_,c.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,d){c.state="loaded",d(null)}}class v_ extends o.SourceCache{constructor(c){const d=Me("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new Hr(Lt(),null),c.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,d,_){if(c.freezeTileCoverage)return;this.transform=c;const x=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,A)=>{if(w[A.key]="",!this._tiles[A.key]){const C=new o.Tile(A,this._source.tileSize*A.overscaleFactor(),c.tileZoom);C.state="loaded",this._tiles[A.key]=C}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(c){const d=this.proxyCachedFBO[c];if(d!==void 0){const _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class tp extends o.OverscaledTileID{constructor(c,d,_){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class np extends o.Elevation{constructor(c,d){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,w]=function(P){const O=new o.StructArrayLayout2i4,D=new o.StructArrayLayout3ui6,U=131;O.reserve(17161),D.reserve(33800);const $=o.EXTENT/128,ee=o.EXTENT+$/2,Q=ee+$;for(let ne=-$;ne<Q;ne+=$)for(let W=-$;W<Q;W+=$){const he=W<0||W>ee||ne<0||ne>ee?24575:0,le=o.clamp(Math.round(W),0,o.EXTENT),pe=o.clamp(Math.round(ne),0,o.EXTENT);O.emplaceBack(le+he,pe)}const te=(ne,W)=>{const he=W*U+ne;D.emplaceBack(he+1,he,he+U),D.emplaceBack(he+U,he+U+1,he+1)};for(let ne=1;ne<129;ne++)for(let W=1;W<129;W++)te(W,ne);return[0,129].forEach(ne=>{for(let W=0;W<130;W++)te(W,ne),te(ne,W)}),[O,D,32768]}(),A=c.context;this.gridBuffer=A.createVertexBuffer(_,o.posAttributes.members),this.gridIndexBuffer=A.createIndexBuffer(x),this.gridSegments=o.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new v_(d.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const C=A.gl;this._overlapStencilMode=new o.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new y_(d.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,d,_){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const x=c.terrain.properties;this.sourceCache=c.terrain.drapeRenderMode===0?this._mockSourceCache:c._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const w=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const A=this.getScaledDemTileSize();this.sourceCache.update(d,A,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),d.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||c.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&c.dataType==="source"?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):c.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=d.getIds().map(P=>{const O=d.getTileByID(P).tileID;return O.projMatrix=_.calculateProjMatrix(O.toUnwrapped()),O});(function(P,O){const D=O.transform.pointCoordinate(O.transform.getCameraPoint()),U=new o.pointGeometry(D.x,D.y);P.sort(($,ee)=>{if(ee.overscaledZ-$.overscaledZ)return ee.overscaledZ-$.overscaledZ;const Q=new o.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),te=new o.pointGeometry(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),ne=U.mult(1<<$.canonical.z);return ne.x-=.5,ne.y-=.5,ne.distSqr(Q)-ne.distSqr(te)})})(x,this.painter),this._previousZoom=_.zoom;const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const A=this._style._sourceCaches;for(const P in A){const O=A[P];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,c[P],w),O.usedForTerrain))continue;const D=c[P];O.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[d.id]=x.map(P=>new tp(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const C={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const O=this.terrainTileForTile[P.key];if(!O)continue;const D=O.tileID.key;D in C||(this._visibleDemTiles.push(O),C[D]=D)}}_assignTerrainTiles(c){this._initializing||c.forEach(d=>{if(this.terrainTileForTile[d.key])return;const _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){const c=this.painter.context,d=c.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(c.activeTexture.set(d.TEXTURE1),nu(this.painter,x,w))}}_prepareDemTileUniforms(c,d,_,x){if(!d||d.demTexture==null)return!1;const w=c.tileID.canonical,A=Math.pow(2,d.tileID.canonical.z-w.z),C=x||"";return _[`u_dem_tl${C}`]=[w.x*A%1,w.y*A%1],_[`u_dem_scale${C}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,d=c.gl;if(!this._emptyDepthBufferTexture){const _=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(c,_,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const d=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const w=x.dem.tree.minimums[0];return w>0&&c++,_+w},0);return c?d/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,d=c.gl;c.activeTexture.set(d.TEXTURE2);const _=this._getLoadedAreaMinimum(),x=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new o.Texture(c,x,d.RGBA,{premultiply:!1}),w}setupElevationDraw(c,d,_){const x=this.painter.context,w=x.gl,A=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var C;A.u_dem_size=this.sourceCache.getSource().tileSize,A.u_exaggeration=this.exaggeration();let P=null,O=null,D=1;if(_&&_.morphing&&this._useVertexMorphing){const U=_.morphing.srcDemTile,$=_.morphing.dstDemTile;D=_.morphing.phase,U&&$&&(this._prepareDemTileUniforms(c,U,A,"_prev")&&(O=U),this._prepareDemTileUniforms(c,$,A)&&(P=$))}if(O&&P?(x.activeTexture.set(w.TEXTURE2),P.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),x.activeTexture.set(w.TEXTURE4),O.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),A.u_dem_lerp=D):(P=this.terrainTileForTile[c.tileID.key],x.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(c,P,A)?P.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),x.activeTexture.set(w.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&P){const U=(1<<P.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=U}if(_&&_.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(x,A),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,c.tileID.canonical,_&&_.useDenormalizedUpVectorScale);d.setGlobeUniformValues(x,U)}}globeUniformValues(c,d,_){const x=c.projection;return{u_tile_tl_up:x.upVector(d,0,0),u_tile_tr_up:x.upVector(d,o.EXTENT,0),u_tile_br_up:x.upVector(d,o.EXTENT,o.EXTENT),u_tile_bl_up:x.upVector(d,0,o.EXTENT),u_tile_up_scale:_?o.globeMetersToEcef(1):x.upVectorScale(d,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const d=this.painter,_=this.painter.context;c.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,A,C,P){if(x.transform.projection.name==="globe")(function(O,D,U,$,ee){const Q=O.context,te=Q.gl;let ne,W;const he=O.options.showTerrainWireframe?2:0,le=O.transform,pe=o.globeUseCustomAntiAliasing(O,Q,le),xe=(Ke,Oe)=>{if(W===Ke)return;const Ae=[Ha[Ke],"PROJECTION_GLOBE_VIEW"];pe&&Ae.push("CUSTOM_ANTIALIASING"),Oe&&Ae.push(Ha[he]),ne=O.useProgram("globeRaster",null,Ae),W=Ke},ye=O.colorModeForRenderPass(),Te=new o.DepthMode(te.LEQUAL,o.DepthMode.ReadWrite,O.depthRangeFor3D);ua.update(ee);const Pe=o.calculateGlobeMercatorMatrix(le),Le=[o.mercatorXfromLng(le.center.lng),o.mercatorYfromLat(le.center.lat)],ze=he?[!1,!0]:[!1],st=O.globeSharedBuffers,Ie=[le.width*o.exported.devicePixelRatio,le.height*o.exported.devicePixelRatio],Ze=Float32Array.from(le.globeMatrix),Ue={useDenormalizedUpVectorScale:!0};if(ze.forEach(Ke=>{const Oe=O.transform,Ae=Rh(Oe.zoom)*D.exaggeration();W=-1;const Ne=Ke?te.LINES:te.TRIANGLES;for(const Ye of $){const tt=U.getTile(Ye),At=o.StencilMode.disabled,qt=D.prevTerrainTileForTile[Ye.key],vt=D.terrainTileForTile[Ye.key];Qf(qt,vt)&&ua.newMorphing(Ye.key,qt,vt,ee,250),Q.activeTexture.set(te.TEXTURE0),tt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const gt=ua.getMorphValuesForProxy(Ye.key),Mt=gt?1:0;gt&&o.extend$1(Ue,{morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:o.easeCubicInOut(gt.phase)}});const nn=o.tileCornersToBounds(Ye.canonical),It=o.getLatitudinalLod(nn.getCenter().lat),gn=o.getGridMatrix(Ye.canonical,nn,It,Oe.worldSize/Oe._pixelsPerMercatorPixel),In=o.globeNormalizeECEF(o.globeTileBounds(Ye.canonical)),jn=Ih(Oe.projMatrix,Ze,Pe,In,o.globeToMercatorTransition(Oe.zoom),Le,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,Ie,Ae,gn);if(xe(Mt,Ke),D.setupElevationDraw(tt,ne,Ue),O.prepareDrawProgram(Q,ne,Ye.toUnwrapped()),st){const[Nn,xr,ki]=Ke?st.getWirefameBuffers(O.context,It):st.getGridBuffers(It,Ae!==0);ne.draw(Q,Ne,Te,At,ye,o.CullFaceMode.backCCW,jn,"globe_raster",Nn,xr,ki)}}}),st){const Ke=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&Ke.push("CUSTOM_ANTIALIASING"),ne=O.useProgram("globeRaster",null,Ke);for(const Oe of $){const{x:Ae,y:Ne,z:Ye}=Oe.canonical,tt=Ne===0,At=Ne===(1<<Ye)-1,[qt,vt,gt,Mt]=st.getPoleBuffers(Ye);if(Mt&&(tt||At)){const nn=U.getTile(Oe);Q.activeTexture.set(te.TEXTURE0),nn.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);let It=o.globePoleMatrixForTile(Ye,Ae,le);const gn=o.globeNormalizeECEF(o.globeTileBounds(Oe.canonical)),In=(jn,Nn)=>jn.draw(Q,te.TRIANGLES,Te,o.StencilMode.disabled,ye,o.CullFaceMode.disabled,Ih(le.projMatrix,It,It,gn,0,Le,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Ie,0),"globe_pole_raster",Nn,gt,Mt);D.setupElevationDraw(nn,ne,Ue),O.prepareDrawProgram(Q,ne,Oe.toUnwrapped()),tt&&In(ne,qt),At&&(It=o.scale(o.create(),It,[1,-1,1]),In(ne,vt))}}}})(x,w,A,C,P);else{const O=x.context,D=O.gl;let U,$;const ee=x.options.showTerrainWireframe?2:0,Q=(le,pe)=>{if($===le)return;const xe=[Ha[le]];pe&&xe.push(Ha[ee]),U=x.useProgram("terrainRaster",null,xe),$=le},te=x.colorModeForRenderPass(),ne=new o.DepthMode(D.LEQUAL,o.DepthMode.ReadWrite,x.depthRangeFor3D);ua.update(P);const W=x.transform,he=Rh(W.zoom)*w.exaggeration();(ee?[!1,!0]:[!1]).forEach(le=>{$=-1;const pe=le?D.LINES:D.TRIANGLES,[xe,ye]=le?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const Te of C){const Pe=A.getTile(Te),Le=o.StencilMode.disabled,ze=w.prevTerrainTileForTile[Te.key],st=w.terrainTileForTile[Te.key];Qf(ze,st)&&ua.newMorphing(Te.key,ze,st,P,250),O.activeTexture.set(D.TEXTURE0),Pe.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const Ie=ua.getMorphValuesForProxy(Te.key),Ze=Ie?1:0;let Ue;Ie&&(Ue={morphing:{srcDemTile:Ie.from,dstDemTile:Ie.to,phase:o.easeCubicInOut(Ie.phase)}});const Ke=Jf(Te.projMatrix,ep(Te.canonical,W.renderWorldCopies)?he/10:he);Q(Ze,le),w.setupElevationDraw(Pe,U,Ue),x.prepareDrawProgram(O,U,Te.toUnwrapped()),U.draw(O,pe,ne,Le,te,o.CullFaceMode.backCCW,Ke,"terrain_raster",w.gridBuffer,xe,ye)}})}}(d,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(this._drapedRenderBatches.length===0)return c+1;this.renderingToTexture=!0;const d=this.painter,_=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],A=this._drapedRenderBatches.shift(),C=[],P=d.style.order;let O=0;for(const D of w){const U=x.getTileByID(D.proxyTileKey),$=x.proxyCachedFBO[D.key]?x.proxyCachedFBO[D.key][c]:void 0,ee=$!==void 0?x.renderCache[$]:this.pool[O++],Q=$!==void 0;if(U.texture=ee.tex,Q&&!ee.dirty){C.push(U.tileID);continue}let te;_.bindFramebuffer.set(ee.fb.framebuffer),this.renderedToTile=!1,ee.dirty&&(_.clear({color:o.Color.transparent,stencil:0}),ee.dirty=!1);for(let ne=A.start;ne<=A.end;++ne){const W=d.style._layers[P[ne]];if(W.isHidden(d.transform.zoom))continue;const he=d.style._getLayerSourceCache(W),le=he?this.proxyToSource[D.key][he.id]:[D];if(!le)continue;const pe=le;_.viewport.set([0,0,ee.fb.width,ee.fb.height]),te!==(he?he.id:null)&&(this._setupStencil(ee,le,W,he),te=he?he.id:null),d.renderLayer(d,he,W,pe)}this.renderedToTile?(ee.dirty=!0,C.push(U.tileID)):Q||--O,O===5&&(O=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),A.end+1}postRender(){}renderCacheEfficiency(c){const d=c.order.length;if(d===0)return{efficiency:100};let _,x=0,w=0,A=!1;for(let C=0;C<d;++C){const P=c._layers[c.order[C]];this._style.isLayerDraped(P)?(A&&++x,++w):A||(A=!0,_=P.id)}return w===0?{efficiency:100}:{efficiency:100*(1-x/w),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{c=Math.min(c,d.dem.tree.minimums[0])}),c===0?c:(c-30)*this._exaggeration}raycast(c,d,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const A=w.tileID,C=1<<A.overscaledZ,{x:P,y:O}=A.canonical,D=P/C,U=(P+1)/C,$=O/C,ee=(O+1)/C;return{minx:D,miny:$,maxx:U,maxy:ee,t:w.dem.tree.raycastRoot(D,$,U,ee,c,d,_),tile:w}});x.sort((w,A)=>(w.t!==null?w.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const w of x){if(w.t==null)return null;const A=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,c,d,_);if(A!=null)return A}return null}_createFBO(){const c=this.painter.context,d=c.gl,_=this.drapeBufferSize;c.activeTexture.set(d.TEXTURE0);const x=new o.Texture(c,{width:_[0],height:_[1],data:null},d.RGBA);x.bind(d.LINEAR,d.CLAMP_TO_EDGE);const w=c.createFramebuffer(_[0],_[1],!1);return w.colorAttachment.set(x.texture),w.depthAttachment=new Ml(c,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const d=this._style._layers[c],_=d.isHidden(this.painter.transform.zoom);return d.type==="custom"?!_&&d.shouldRedrape():!_&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const _ of this._style._getSources())if(_ instanceof B){c=!0;break}if(!c)return;const d={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],w=this._style._getLayerSourceCache(x);if(w&&!d[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof o.ZoomDependentExpression){d[w.id]=!0;for(const A of this.proxyCoords){const C=this.proxyToSource[A.key][w.id];if(C)for(const P of C)this._clearRenderCacheForTile(w.id,P)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof G){c=!0;break}if(!c)return;const d={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],w=this._style._getLayerSourceCache(x);if(!w||d[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const A=x.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const P=this.proxyToSource[C.key][w.id];if(P)for(const O of P){const D=ru(w.getTile(O),w.findLoadedParent(O,0),w,this.painter.transform,A);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(w.id,O)}}}}_setupDrapedRenderBatches(){const c=this._style.order,d=c.length;if(d===0)return;const _=[];let x,w=0,A=this._style._layers[c[w]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++w<d;)A=this._style._layers[c[w]];for(;w<d;++w){const C=this._style._layers[c[w]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?x===void 0&&(x=w):x!==void 0&&(_.push({start:x,end:w-1}),x=void 0))}x!==void 0&&_.push({start:x,end:w-1}),this._drapedRenderBatches=_}_setupRenderCache(c){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const A=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let C=0;C<A.length;++C){const P=Object.values(A[C]);d.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let A=_.length-1;A>=0;A--){const C=_[A];if(d.getTileByID(C.key),d.proxyCachedFBO[C.key]!==void 0){const P=c[C.key],O=this.proxyToSource[C.key];let D=0;for(const U in O){const $=O[U],ee=P[U];if(!ee||ee.length!==$.length||$.some((Q,te)=>Q!==ee[te]||x[U]&&x[U].hasOwnProperty(Q.key))){D=-1;break}++D}for(const U in d.proxyCachedFBO[C.key])d.renderCache[d.proxyCachedFBO[C.key][U]].dirty=D<0||D!==Object.values(P).length}}const w=[...this._drapedRenderBatches];w.sort((A,C)=>C.end-C.start-(A.end-A.start));for(const A of w)for(const C of _){if(d.proxyCachedFBO[C.key])continue;let P=d.renderCachePool.pop();P===void 0&&d.renderCache.length<50&&(P=d.renderCache.length,d.renderCache.push(this._createFBO())),P!==void 0&&(d.proxyCachedFBO[C.key]={},d.proxyCachedFBO[C.key][A.start]=P,d.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(c,d,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,A=w.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let C;if(_.isTileClipped())C=d.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(c,d){const _=this.painter,x=this.painter.context,w=x.gl;_._tileClippingMaskIDs={},x.setColorMode(o.ColorMode.disabled),x.setDepthMode(o.DepthMode.disabled);const A=_.useProgram("clippingMask");for(const C of c){const P=_._tileClippingMaskIDs[C.key]=--d;A.draw(x,w.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:w.ALWAYS,mask:0},P,255,w.KEEP,w.KEEP,w.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ln(C.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(c){const d=this.painter.transform;if(c.x<0||c.x>d.width||c.y<0||c.y>d.height)return null;const _=[c.x,c.y,1,1];o.transformMat4$1(_,_,d.pixelMatrixInverse),o.scale$1(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;const x=d._camera.position,w=o.mercatorZfromAltitude(1,d.center.lat),A=[x[0],x[1],x[2]/w,0],C=o.subtract([],_.slice(0,3),A);o.normalize(C,C);const P=this.raycast(A,C,this._exaggeration);return P!==null&&P?(o.scaleAndAdd(A,A,C,P),A[3]=A[2],A[2]*=w,A):null}drawDepth(){const c=this.painter,d=c.context,_=this.proxySourceCache,x=Math.ceil(c.width),w=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=d.gl,C=d.createFramebuffer(x,w,!0);d.activeTexture.set(A.TEXTURE0);const P=new o.Texture(d,{width:x,height:w,data:null},A.RGBA);P.bind(A.NEAREST,A.CLAMP_TO_EDGE),C.colorAttachment.set(P.texture);const O=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,x,w);C.depthAttachment.set(O),this._depthFBO=C,this._depthTexture=P}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,x,w]),function(A,C,P,O){if(A.transform.projection.name==="globe")return;const D=A.context,U=D.gl;D.clear({depth:1});const $=A.useProgram("terrainDepth"),ee=new o.DepthMode(U.LESS,o.DepthMode.ReadWrite,A.depthRangeFor3D);for(const Q of O){const te=P.getTile(Q),ne=Jf(Q.projMatrix,0);C.setupElevationDraw(te,$),$.draw(D,U.TRIANGLES,ee,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,ne,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(c,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,d,_){if(c.getSource()instanceof we)return this._setupProxiedCoordsForImageSource(c,d,_);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const x=this.proxiedCoords[c.id]=[],w=this.proxyCoords;for(let C=0;C<w.length;C++){const P=w[C],O=this._findTileCoveringTileID(P,c);if(O){const D=this._createProxiedId(P,O,_[P.key]&&_[P.key][c.id]);x.push(D),this.proxyToSource[P.key][c.id]=[D]}}let A=!1;for(let C=0;C<d.length;C++){const P=c.getTile(d[C]);if(!P||!P.hasData())continue;const O=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==P.tileID.canonical.z){const D=this.proxyToSource[O.tileID.key][c.id],U=this._createProxiedId(O.tileID,P,_[O.tileID.key]&&_[O.tileID.key][c.id]);D?D.splice(D.length-1,0,U):this.proxyToSource[O.tileID.key][c.id]=[U],x.push(U),A=!0}}this._sourceTilesOverlap[c.id]=A}_setupProxiedCoordsForImageSource(c,d,_){if(!c.getSource().loaded())return;const x=this.proxiedCoords[c.id]=[],w=this.proxyCoords,A=c.getSource(),C=new o.pointGeometry(A.tileID.x,A.tileID.y)._div(1<<A.tileID.z),P=A.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((D,U)=>(D.min.x=Math.min(D.min.x,U.x-C.x),D.min.y=Math.min(D.min.y,U.y-C.y),D.max.x=Math.max(D.max.x,U.x-C.x),D.max.y=Math.max(D.max.y,U.y-C.y),D),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(D,U)=>{const $=D.wrap+D.canonical.x/(1<<D.canonical.z),ee=D.canonical.y/(1<<D.canonical.z),Q=o.EXTENT/(1<<D.canonical.z),te=U.wrap+U.canonical.x/(1<<U.canonical.z),ne=U.canonical.y/(1<<U.canonical.z);return $+Q<te+P.min.x||$>te+P.max.x||ee+Q<ne+P.min.y||ee>ne+P.max.y};for(let D=0;D<w.length;D++){const U=w[D];for(let $=0;$<d.length;$++){const ee=c.getTile(d[$]);if(!ee||!ee.hasData()||O(U,ee.tileID))continue;const Q=this._createProxiedId(U,ee,_[U.key]&&_[U.key][c.id]),te=this.proxyToSource[U.key][c.id];te?te.push(Q):this.proxyToSource[U.key][c.id]=[Q],x.push(Q)}}}_createProxiedId(c,d,_){let x=this.orthoMatrix;if(_){const w=_.find(A=>A.key===d.tileID.key);if(w)return w}if(d.tileID.key!==c.key){const w=c.canonical.z-d.tileID.canonical.z;let A,C,P;x=o.create();const O=d.tileID.wrap-c.wrap<<c.overscaledZ;w>0?(A=o.EXTENT>>w,C=A*((d.tileID.canonical.x<<w)-c.canonical.x+O),P=A*((d.tileID.canonical.y<<w)-c.canonical.y)):(A=o.EXTENT<<-w,C=o.EXTENT*(d.tileID.canonical.x-(c.canonical.x+O<<-w)),P=o.EXTENT*(d.tileID.canonical.y-(c.canonical.y<<-w))),o.ortho(x,0,A,0,A,0,1),o.translate(x,x,[C,P,0])}return new tp(d.tileID,c.key,x)}_findTileCoveringTileID(c,d){let _=d.getTile(c);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[d.id],w=x[c.key];if(_=w?d.getTileByID(w):null,_&&_.hasData()||w===null)return _;let A=_?_.tileID:c,C=A.overscaledZ;const P=d.getSource().minzoom,O=[];if(!w){const U=d.getSource().maxzoom;if(c.canonical.z>=U){const $=c.canonical.z-U;d.getSource().reparseOverscaled?(C=Math.max(c.canonical.z+2,d.transform.tileZoom),A=new o.OverscaledTileID(C,c.wrap,U,c.canonical.x>>$,c.canonical.y>>$)):$!==0&&(C=U,A=new o.OverscaledTileID(C,c.wrap,U,c.canonical.x>>$,c.canonical.y>>$))}A.key!==c.key&&(O.push(A.key),_=d.getTile(A))}const D=U=>{O.forEach($=>{x[$]=U}),O.length=0};for(C-=1;C>=P&&(!_||!_.hasData());C--){_&&D(_.tileID.key);const U=A.calculateScaledKey(C);if(_=d.getTileByID(U),_&&_.hasData())break;const $=x[U];if($===null)break;$===void 0?O.push(U):_=d.getTileByID($)}return D(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,d){let _=this._tilesDirty[c];_||(_=this._tilesDirty[c]={}),_[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(d){let _=0;const x=new o.StructArrayLayout2ui4,w=131;for(let A=1;A<129;A++){for(let C=1;C<129;C++)_=A*w+C,x.emplaceBack(_,_+1),x.emplaceBack(_,_+w),x.emplaceBack(_+1,_+w),A===128&&x.emplaceBack(_+w,_+w+1);x.emplaceBack(_+1,_+1+w)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class rp{static cacheKey(c,d,_,x){let w=`${d}${x?x.cacheKey:""}`;for(const A of _)c.usedDefines.includes(A)&&(w+=`/${A}`);return w}constructor(c,d,_,x,w,A){const C=c.gl;this.program=C.createProgram();const P=function(W){const he=[];for(let le=0;le<W.length;le++){if(W[le]===null)continue;const pe=W[le].split(" ");he.push(pe.pop())}return he}(_.staticAttributes),O=x?x.getBinderAttributes():[],D=P.concat(O);let U=x?x.defines():[];U=U.concat(A.map(W=>`#define ${W}`));const $=c.isWebGL2?`#version 300 es
`:"",ee=$+U.concat(c.extStandardDerivatives&&$.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Ch):Ch,Ch,Ah,__.fragmentSource,Xf.fragmentSource,_.fragmentSource).join(`
`),Q=$+U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ah,__.vertexSource,Xf.vertexSource,qf.vertexSource,_.vertexSource).join(`
`),te=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(te,ee),C.compileShader(te),C.attachShader(this.program,te);const ne=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(ne,Q),C.compileShader(ne),C.attachShader(this.program,ne),this.attributes={},this.numAttributes=D.length;for(let W=0;W<this.numAttributes;W++)D[W]&&(C.bindAttribLocation(this.program,W,D[W]),this.attributes[D[W]]=W);C.linkProgram(this.program),C.deleteShader(ne),C.deleteShader(te),this.fixedUniforms=w(c),this.binderUniforms=x?x.getUniforms(c):[],A.includes("TERRAIN")&&(this.terrainUniforms=(W=>({u_dem:new o.Uniform1i(W),u_dem_prev:new o.Uniform1i(W),u_dem_unpack:new o.Uniform4f(W),u_dem_tl:new o.Uniform2f(W),u_dem_scale:new o.Uniform1f(W),u_dem_tl_prev:new o.Uniform2f(W),u_dem_scale_prev:new o.Uniform1f(W),u_dem_size:new o.Uniform1f(W),u_dem_lerp:new o.Uniform1f(W),u_exaggeration:new o.Uniform1f(W),u_depth:new o.Uniform1i(W),u_depth_size_inv:new o.Uniform2f(W),u_meter_to_dem:new o.Uniform1f(W),u_label_plane_matrix_inv:new o.UniformMatrix4f(W)}))(c)),A.includes("GLOBE")&&(this.globeUniforms=(W=>({u_tile_tl_up:new o.Uniform3f(W),u_tile_tr_up:new o.Uniform3f(W),u_tile_br_up:new o.Uniform3f(W),u_tile_bl_up:new o.Uniform3f(W),u_tile_up_scale:new o.Uniform1f(W)}))(c)),A.includes("FOG")&&(this.fogUniforms=(W=>({u_fog_matrix:new o.UniformMatrix4f(W),u_fog_range:new o.Uniform2f(W),u_fog_color:new o.Uniform4f(W),u_fog_horizon_blend:new o.Uniform1f(W),u_fog_temporal_offset:new o.Uniform1f(W),u_frustum_tl:new o.Uniform3f(W),u_frustum_tr:new o.Uniform3f(W),u_frustum_br:new o.Uniform3f(W),u_frustum_bl:new o.Uniform3f(W),u_globe_pos:new o.Uniform3f(W),u_globe_radius:new o.Uniform1f(W),u_globe_transition:new o.Uniform1f(W),u_is_globe:new o.Uniform1i(W),u_viewport:new o.Uniform2f(W)}))(c))}}setTerrainUniformValues(c,d){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in d)_[x]&&_[x].set(this.program,x,d[x])}}setGlobeUniformValues(c,d){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in d)_[x]&&_[x].set(this.program,x,d[x])}}setFogUniformValues(c,d){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in d)_[x].set(this.program,x,d[x])}}draw(c,d,_,x,w,A,C,P,O,D,U,$,ee,Q,te){const ne=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(_),c.setStencilMode(x),c.setColorMode(w),c.setCullFace(A);for(const he of Object.keys(this.fixedUniforms))this.fixedUniforms[he].set(this.program,he,C[he]);Q&&Q.setUniforms(this.program,c,this.binderUniforms,$,{zoom:ee});const W={[ne.LINES]:2,[ne.TRIANGLES]:3,[ne.LINE_STRIP]:1}[d];for(const he of U.get()){const le=he.vaos||(he.vaos={});(le[P]||(le[P]=new eu)).bind(c,this,O,Q?Q.getPaintVertexBuffers():[],D,he.vertexOffset,te||[]),ne.drawElements(d,he.primitiveLength*W,ne.UNSIGNED_SHORT,he.primitiveOffset*W*2)}}}function x_(m,c){const d=Math.pow(2,c.tileID.overscaledZ),_=c.tileSize*Math.pow(2,m.transform.tileZoom)/d,x=_*(c.tileID.canonical.x+c.tileID.wrap*d),w=_*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/pr(c,1,m.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const $x=o.create(),kh=(m,c,d,_,x,w,A,C,P,O,D)=>{const U=c.style.light,$=U.properties.get("position"),ee=[$.x,$.y,$.z],Q=o.create$1();U.properties.get("anchor")==="viewport"&&(o.fromRotation(Q,-c.transform.angle),o.transformMat3(ee,ee,Q));const te=U.properties.get("color"),ne=c.transform,W={u_matrix:m,u_lightpos:ee,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$x,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:w};return ne.projection.name==="globe"&&(W.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],W.u_zoom_transition=P,W.u_inv_rot_matrix=D,W.u_merc_center=O,W.u_up_dir=ne.projection.upVector(new o.CanonicalTileID(0,0,0),O[0]*o.EXTENT,O[1]*o.EXTENT),W.u_height_lift=C),W},ip=(m,c,d,_,x,w,A,C,P,O,D,U)=>{const $=kh(m,c,d,_,x,w,A,P,O,D,U),ee={u_height_factor:-Math.pow(2,A.overscaledZ)/C.tileSize/8};return o.extend($,x_(c,C),ee)},Lh=m=>({u_matrix:m}),Oh=(m,c,d)=>o.extend(Lh(m),x_(c,d)),b_=(m,c)=>({u_matrix:m,u_world:c}),w_=(m,c,d,_)=>o.extend(Oh(m,c,d),{u_world:_}),Hx=o.create(),iu=(m,c,d,_,x,w)=>{const A=m.transform,C=A.projection.name==="globe";let P;if(w.paint.get("circle-pitch-alignment")==="map")if(C){const D=o.globePixelsToTileUnits(A.zoom,c.canonical)*A._pixelsPerMercatorPixel;P=Float32Array.from([D,0,0,D])}else P=A.calculatePixelsToTileUnitsMatrix(d);else P=new Float32Array([A.pixelsToGLUnits[0],0,0,A.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:A.cameraToCenterDistance,u_matrix:m.translatePosMatrix(c.projMatrix,d,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Hx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){O.u_inv_rot_matrix=_,O.u_merc_center=x,O.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],O.u_zoom_transition=o.globeToMercatorTransition(A.zoom);const D=x[0]*o.EXTENT,U=x[1]*o.EXTENT;O.u_up_dir=A.projection.upVector(new o.CanonicalTileID(0,0,0),D,U)}return O},su=m=>{const c=[];return m.paint.get("circle-pitch-alignment")==="map"&&c.push("PITCH_WITH_MAP"),m.paint.get("circle-pitch-scale")==="map"&&c.push("SCALE_WITH_MAP"),c},E_=(m,c,d,_)=>{const x=o.EXTENT/d.tileSize;return{u_matrix:m,u_camera_to_center_distance:c.getCameraToCenterDistance(_),u_extrude_scale:[c.pixelsToGLUnits[0]/x,c.pixelsToGLUnits[1]/x]}},ou=(m,c,d=1)=>({u_matrix:m,u_color:c,u_overlay:0,u_overlay_scale:d}),sp=o.create(),Ys=(m,c,d,_,x,w,A)=>{const C=m.transform,P=C.projection.name==="globe",O=P?o.globePixelsToTileUnits(C.zoom,c.canonical)*C._pixelsPerMercatorPixel:pr(d,1,w),D={u_matrix:c.projMatrix,u_extrude_scale:O,u_intensity:A,u_inv_rot_matrix:sp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){D.u_inv_rot_matrix=_,D.u_merc_center=x,D.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],D.u_zoom_transition=o.globeToMercatorTransition(C.zoom);const U=x[0]*o.EXTENT,$=x[1]*o.EXTENT;D.u_up_dir=C.projection.upVector(new o.CanonicalTileID(0,0,0),U,$)}return D},op=(m,c,d,_,x,w,A)=>{const C=m.transform,P=C.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:ap(m,c,d,_),u_pixels_to_tile_units:P,u_device_pixel_ratio:w,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:zh(d)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Dh(c,m.transform),u_alpha_discard_threshold:0,u_trim_offset:A}},T_=(m,c,d,_,x)=>{const w=m.transform;return{u_matrix:ap(m,c,d,_),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:Dh(c,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Dh(m,c){return 1/pr(m,1,c.tileZoom)}function ap(m,c,d,_){return m.translatePosMatrix(_||c.tileID.projMatrix,c,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function zh(m){const c=m.paint.get("line-dasharray").value;return c.value||c.kind!=="constant"}const Zx=(m,c,d,_,x,w)=>{return{u_matrix:m,u_tl_parent:c,u_scale_parent:d,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(C=x.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(A=x.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:lp(x.paint.get("raster-hue-rotate")),u_perspective_transform:w};var A,C};function lp(m){m*=Math.PI/180;const c=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*c-d+1)/3,(Math.sqrt(3)*c-d+1)/3]}const S_=o.create(),au=(m,c,d,_,x,w,A,C,P,O,D,U,$,ee,Q,te)=>{const ne=x.transform,W={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:ne.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:ne.width/ne.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:A,u_coord_matrix:C,u_is_text:+P,u_pitch_with_map:+_,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:S_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:S_,u_up_vector:[0,-1,0]};return te.name==="globe"&&(W.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],W.u_zoom_transition=U,W.u_inv_rot_matrix=ee,W.u_merc_center=$,W.u_camera_forward=ne._camera.forward(),W.u_ecef_origin=o.globeECEFOrigin(ne.globeMatrix,D.toUnwrapped()),W.u_tile_matrix=Float32Array.from(ne.globeMatrix),W.u_up_vector=Q),W},A_=(m,c,d,_,x,w,A,C,P,O,D,U,$,ee,Q,te,ne)=>o.extend(au(m,c,d,_,x,w,A,C,P,O,U,$,ee,Q,te,ne),{u_gamma_scale:_?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+D}),cp=(m,c,d,_,x,w,A,C,P,O,D,U,$,ee,Q,te)=>o.extend(A_(m,c,d,_,x,w,A,C,!0,P,!0,D,U,$,ee,Q,te),{u_texsize_icon:O,u_texture_icon:1}),qx=(m,c,d)=>({u_matrix:m,u_opacity:c,u_color:d}),up=(m,c,d,_,x)=>o.extend(function(w,A,C){const P=A.imageManager.getPattern(w.toString()),{width:O,height:D}=A.imageManager.getPixelSize(),U=Math.pow(2,C.tileID.overscaledZ),$=C.tileSize*Math.pow(2,A.transform.tileZoom)/U,ee=$*(C.tileID.canonical.x+C.tileID.wrap*U),Q=$*C.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[O,D],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/pr(C,1,A.transform.tileZoom),u_pixel_coord_upper:[ee>>16,Q>>16],u_pixel_coord_lower:[65535&ee,65535&Q]}}(_,d,x),{u_matrix:m,u_opacity:c}),Xx={fillExtrusion:m=>({u_matrix:new o.UniformMatrix4f(m),u_lightpos:new o.Uniform3f(m),u_lightintensity:new o.Uniform1f(m),u_lightcolor:new o.Uniform3f(m),u_vertical_gradient:new o.Uniform1f(m),u_opacity:new o.Uniform1f(m),u_edge_radius:new o.Uniform1f(m),u_ao:new o.Uniform2f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_up_dir:new o.Uniform3f(m),u_height_lift:new o.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new o.UniformMatrix4f(m),u_lightpos:new o.Uniform3f(m),u_lightintensity:new o.Uniform1f(m),u_lightcolor:new o.Uniform3f(m),u_vertical_gradient:new o.Uniform1f(m),u_height_factor:new o.Uniform1f(m),u_edge_radius:new o.Uniform1f(m),u_ao:new o.Uniform2f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_up_dir:new o.Uniform3f(m),u_height_lift:new o.Uniform1f(m),u_image:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_pixel_coord_upper:new o.Uniform2f(m),u_pixel_coord_lower:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m),u_opacity:new o.Uniform1f(m)}),fill:m=>({u_matrix:new o.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new o.UniformMatrix4f(m),u_image:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_pixel_coord_upper:new o.Uniform2f(m),u_pixel_coord_lower:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m)}),fillOutline:m=>({u_matrix:new o.UniformMatrix4f(m),u_world:new o.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new o.UniformMatrix4f(m),u_world:new o.Uniform2f(m),u_image:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_pixel_coord_upper:new o.Uniform2f(m),u_pixel_coord_lower:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new o.Uniform1f(m),u_extrude_scale:new o.UniformMatrix2f(m),u_device_pixel_ratio:new o.Uniform1f(m),u_matrix:new o.UniformMatrix4f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_up_dir:new o.Uniform3f(m)}),collisionBox:m=>({u_matrix:new o.UniformMatrix4f(m),u_camera_to_center_distance:new o.Uniform1f(m),u_extrude_scale:new o.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new o.UniformMatrix4f(m),u_inv_matrix:new o.UniformMatrix4f(m),u_camera_to_center_distance:new o.Uniform1f(m),u_viewport_size:new o.Uniform2f(m)}),debug:m=>({u_color:new o.UniformColor(m),u_matrix:new o.UniformMatrix4f(m),u_overlay:new o.Uniform1i(m),u_overlay_scale:new o.Uniform1f(m)}),clippingMask:m=>({u_matrix:new o.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new o.Uniform1f(m),u_intensity:new o.Uniform1f(m),u_matrix:new o.UniformMatrix4f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_up_dir:new o.Uniform3f(m)}),heatmapTexture:m=>({u_image:new o.Uniform1i(m),u_color_ramp:new o.Uniform1i(m),u_opacity:new o.Uniform1f(m)}),hillshade:m=>({u_matrix:new o.UniformMatrix4f(m),u_image:new o.Uniform1i(m),u_latrange:new o.Uniform2f(m),u_light:new o.Uniform2f(m),u_shadow:new o.UniformColor(m),u_highlight:new o.UniformColor(m),u_accent:new o.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new o.UniformMatrix4f(m),u_image:new o.Uniform1i(m),u_dimension:new o.Uniform2f(m),u_zoom:new o.Uniform1f(m),u_unpack:new o.Uniform4f(m)}),line:m=>({u_matrix:new o.UniformMatrix4f(m),u_pixels_to_tile_units:new o.UniformMatrix2f(m),u_device_pixel_ratio:new o.Uniform1f(m),u_units_to_pixels:new o.Uniform2f(m),u_dash_image:new o.Uniform1i(m),u_gradient_image:new o.Uniform1i(m),u_image_height:new o.Uniform1f(m),u_texsize:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m),u_alpha_discard_threshold:new o.Uniform1f(m),u_trim_offset:new o.Uniform2f(m)}),linePattern:m=>({u_matrix:new o.UniformMatrix4f(m),u_texsize:new o.Uniform2f(m),u_pixels_to_tile_units:new o.UniformMatrix2f(m),u_device_pixel_ratio:new o.Uniform1f(m),u_image:new o.Uniform1i(m),u_units_to_pixels:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m),u_alpha_discard_threshold:new o.Uniform1f(m)}),raster:m=>({u_matrix:new o.UniformMatrix4f(m),u_tl_parent:new o.Uniform2f(m),u_scale_parent:new o.Uniform1f(m),u_fade_t:new o.Uniform1f(m),u_opacity:new o.Uniform1f(m),u_image0:new o.Uniform1i(m),u_image1:new o.Uniform1i(m),u_brightness_low:new o.Uniform1f(m),u_brightness_high:new o.Uniform1f(m),u_saturation_factor:new o.Uniform1f(m),u_contrast_factor:new o.Uniform1f(m),u_spin_weights:new o.Uniform3f(m),u_perspective_transform:new o.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new o.Uniform1i(m),u_is_size_feature_constant:new o.Uniform1i(m),u_size_t:new o.Uniform1f(m),u_size:new o.Uniform1f(m),u_camera_to_center_distance:new o.Uniform1f(m),u_rotate_symbol:new o.Uniform1i(m),u_aspect_ratio:new o.Uniform1f(m),u_fade_change:new o.Uniform1f(m),u_matrix:new o.UniformMatrix4f(m),u_label_plane_matrix:new o.UniformMatrix4f(m),u_coord_matrix:new o.UniformMatrix4f(m),u_is_text:new o.Uniform1i(m),u_pitch_with_map:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_camera_forward:new o.Uniform3f(m),u_tile_matrix:new o.UniformMatrix4f(m),u_up_vector:new o.Uniform3f(m),u_ecef_origin:new o.Uniform3f(m),u_texture:new o.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new o.Uniform1i(m),u_is_size_feature_constant:new o.Uniform1i(m),u_size_t:new o.Uniform1f(m),u_size:new o.Uniform1f(m),u_camera_to_center_distance:new o.Uniform1f(m),u_rotate_symbol:new o.Uniform1i(m),u_aspect_ratio:new o.Uniform1f(m),u_fade_change:new o.Uniform1f(m),u_matrix:new o.UniformMatrix4f(m),u_label_plane_matrix:new o.UniformMatrix4f(m),u_coord_matrix:new o.UniformMatrix4f(m),u_is_text:new o.Uniform1i(m),u_pitch_with_map:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_texture:new o.Uniform1i(m),u_gamma_scale:new o.Uniform1f(m),u_device_pixel_ratio:new o.Uniform1f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_camera_forward:new o.Uniform3f(m),u_tile_matrix:new o.UniformMatrix4f(m),u_up_vector:new o.Uniform3f(m),u_ecef_origin:new o.Uniform3f(m),u_is_halo:new o.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new o.Uniform1i(m),u_is_size_feature_constant:new o.Uniform1i(m),u_size_t:new o.Uniform1f(m),u_size:new o.Uniform1f(m),u_camera_to_center_distance:new o.Uniform1f(m),u_rotate_symbol:new o.Uniform1i(m),u_aspect_ratio:new o.Uniform1f(m),u_fade_change:new o.Uniform1f(m),u_matrix:new o.UniformMatrix4f(m),u_label_plane_matrix:new o.UniformMatrix4f(m),u_coord_matrix:new o.UniformMatrix4f(m),u_is_text:new o.Uniform1i(m),u_pitch_with_map:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_texsize_icon:new o.Uniform2f(m),u_texture:new o.Uniform1i(m),u_texture_icon:new o.Uniform1i(m),u_gamma_scale:new o.Uniform1f(m),u_device_pixel_ratio:new o.Uniform1f(m),u_is_halo:new o.Uniform1i(m)}),background:m=>({u_matrix:new o.UniformMatrix4f(m),u_opacity:new o.Uniform1f(m),u_color:new o.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new o.UniformMatrix4f(m),u_opacity:new o.Uniform1f(m),u_image:new o.Uniform1i(m),u_pattern_tl:new o.Uniform2f(m),u_pattern_br:new o.Uniform2f(m),u_texsize:new o.Uniform2f(m),u_pattern_size:new o.Uniform2f(m),u_pixel_coord_upper:new o.Uniform2f(m),u_pixel_coord_lower:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m)}),terrainRaster:Ph,terrainDepth:Ph,skybox:m=>({u_matrix:new o.UniformMatrix4f(m),u_sun_direction:new o.Uniform3f(m),u_cubemap:new o.Uniform1i(m),u_opacity:new o.Uniform1f(m),u_temporal_offset:new o.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new o.UniformMatrix4f(m),u_color_ramp:new o.Uniform1i(m),u_center_direction:new o.Uniform3f(m),u_radius:new o.Uniform1f(m),u_opacity:new o.Uniform1f(m),u_temporal_offset:new o.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new o.UniformMatrix3f(m),u_sun_direction:new o.Uniform3f(m),u_sun_intensity:new o.Uniform1f(m),u_color_tint_r:new o.Uniform4f(m),u_color_tint_m:new o.Uniform4f(m),u_luminance:new o.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new o.UniformMatrix4f(m),u_globe_matrix:new o.UniformMatrix4f(m),u_normalize_matrix:new o.UniformMatrix4f(m),u_merc_matrix:new o.UniformMatrix4f(m),u_zoom_transition:new o.Uniform1f(m),u_merc_center:new o.Uniform2f(m),u_image0:new o.Uniform1i(m),u_grid_matrix:new o.UniformMatrix3f(m),u_skirt_height:new o.Uniform1f(m),u_frustum_tl:new o.Uniform3f(m),u_frustum_tr:new o.Uniform3f(m),u_frustum_br:new o.Uniform3f(m),u_frustum_bl:new o.Uniform3f(m),u_globe_pos:new o.Uniform3f(m),u_globe_radius:new o.Uniform1f(m),u_viewport:new o.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new o.Uniform3f(m),u_frustum_tr:new o.Uniform3f(m),u_frustum_br:new o.Uniform3f(m),u_frustum_bl:new o.Uniform3f(m),u_horizon:new o.Uniform1f(m),u_transition:new o.Uniform1f(m),u_fadeout_range:new o.Uniform1f(m),u_color:new o.Uniform4f(m),u_high_color:new o.Uniform4f(m),u_space_color:new o.Uniform4f(m),u_star_intensity:new o.Uniform1f(m),u_star_density:new o.Uniform1f(m),u_star_size:new o.Uniform1f(m),u_temporal_offset:new o.Uniform1f(m),u_horizon_angle:new o.Uniform1f(m),u_rotation_matrix:new o.UniformMatrix4f(m)})};let Za;function C_(m,c,d,_,x,w,A){const C=m.context,P=C.gl,O=m.transform,D=m.useProgram("collisionBox"),U=[];let $=0,ee=0;for(let pe=0;pe<_.length;pe++){const xe=_[pe],ye=c.getTile(xe),Te=ye.getBucket(d);if(!Te)continue;const Pe=Ge(xe,Te,O);let Le=Pe;x[0]===0&&x[1]===0||(Le=m.translatePosMatrix(Pe,ye,x,w));const ze=A?Te.textCollisionBox:Te.iconCollisionBox,st=Te.collisionCircleArray;if(st.length>0){const Ie=o.create(),Ze=Le;o.mul(Ie,Te.placementInvProjMatrix,O.glCoordMatrix),o.mul(Ie,Ie,Te.placementViewportMatrix),U.push({circleArray:st,circleOffset:ee,transform:Ze,invTransform:Ie,projection:Te.getProjection()}),$+=st.length/4,ee=$}ze&&(m.terrain&&m.terrain.setupElevationDraw(ye,D),D.draw(C,P.LINES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,E_(Le,O,ye,Te.getProjection()),d.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,O.zoom,null,[ze.collisionVertexBuffer,ze.collisionVertexBufferExt]))}if(!A||!U.length)return;const Q=m.useProgram("collisionCircle"),te=new o.StructArrayLayout2f1f2i16;te.resize(4*$),te._trim();let ne=0;for(const pe of U)for(let xe=0;xe<pe.circleArray.length/4;xe++){const ye=4*xe,Te=pe.circleArray[ye+0],Pe=pe.circleArray[ye+1],Le=pe.circleArray[ye+2],ze=pe.circleArray[ye+3];te.emplace(ne++,Te,Pe,Le,ze,0),te.emplace(ne++,Te,Pe,Le,ze,1),te.emplace(ne++,Te,Pe,Le,ze,2),te.emplace(ne++,Te,Pe,Le,ze,3)}(!Za||Za.length<2*$)&&(Za=function(pe){const xe=2*pe,ye=new o.StructArrayLayout3ui6;ye.resize(xe),ye._trim();for(let Te=0;Te<xe;Te++){const Pe=6*Te;ye.uint16[Pe+0]=4*Te+0,ye.uint16[Pe+1]=4*Te+1,ye.uint16[Pe+2]=4*Te+2,ye.uint16[Pe+3]=4*Te+2,ye.uint16[Pe+4]=4*Te+3,ye.uint16[Pe+5]=4*Te+0}return ye}($));const W=C.createIndexBuffer(Za,!0),he=C.createVertexBuffer(te,o.collisionCircleLayout.members,!0);for(const pe of U){const xe={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(le=O).getCameraToCenterDistance(pe.projection),u_viewport_size:[le.width,le.height]};Q.draw(C,P.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,xe,d.id,he,W,o.SegmentVector.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,O.zoom)}var le;he.destroy(),W.destroy()}const hp=o.create();function M_({width:m,height:c,anchor:d,textOffset:_,textScale:x},w){const{horizontalAlign:A,verticalAlign:C}=o.getAnchorAlignment(d),P=-(A-.5)*m,O=-(C-.5)*c,D=o.evaluateVariableOffset(d,_);return new o.pointGeometry((P/x+D[0])*w,(O/x+D[1])*w)}function Ll(m,c,d,_,x,w,A,C,P,O,D){const U=m.text.placedSymbolArray,$=m.text.dynamicLayoutVertexArray,ee=m.icon.dynamicLayoutVertexArray,Q={},te=m.getProjection(),ne=ot(C,te,w),W=w.elevation,he=te.upVectorScale(C.canonical,w.center.lat,w.worldSize).metersToTile;$.clear();for(let le=0;le<U.length;le++){const pe=U.get(le),{tileAnchorX:xe,tileAnchorY:ye,numGlyphs:Te}=pe,Pe=m.allowVerticalPlacement&&!pe.placedOrientation,Le=pe.hidden||!pe.crossTileID||Pe?null:_[pe.crossTileID];if(Le){let ze=0,st=0,Ie=0;if(W){const At=W?W.getAtTileOffset(C,xe,ye):0,[qt,vt,gt]=te.upVector(C.canonical,xe,ye);ze=At*qt*he,st=At*vt*he,Ie=At*gt*he}let[Ze,Ue,Ke,Oe]=lt(pe.projectedAnchorX+ze,pe.projectedAnchorY+st,pe.projectedAnchorZ+Ie,d?ne:A);const Ae=Xt(w.getCameraToCenterDistance(te),Oe);let Ne=x.evaluateSizeForFeature(m.textSizeData,O,pe)*Ae/o.ONE_EM;d&&(Ne*=m.tilePixelRatio/P);const Ye=M_(Le,Ne);d?({x:Ze,y:Ue,z:Ke}=te.projectTilePoint(xe+Ye.x,ye+Ye.y,C.canonical),[Ze,Ue,Ke]=lt(Ze+ze,Ue+st,Ke+Ie,A)):(c&&Ye._rotate(-w.angle),Ze+=Ye.x,Ue+=Ye.y,Ke=0);const tt=m.allowVerticalPlacement&&pe.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let At=0;At<Te;At++)o.addDynamicAttributes($,Ze,Ue,Ke,tt);D&&pe.associatedIconIndex>=0&&(Q[pe.associatedIconIndex]={x:Ze,y:Ue,z:Ke,angle:tt})}else Pn(Te,$)}if(D){ee.clear();const le=m.icon.placedSymbolArray;for(let pe=0;pe<le.length;pe++){const xe=le.get(pe),{numGlyphs:ye}=xe,Te=Q[pe];if(xe.hidden||!Te)Pn(ye,ee);else{const{x:Pe,y:Le,z:ze,angle:st}=Te;for(let Ie=0;Ie<ye;Ie++)o.addDynamicAttributes(ee,Pe,Le,ze,st)}}m.icon.dynamicLayoutVertexBuffer.updateData(ee)}m.text.dynamicLayoutVertexBuffer.updateData($)}function Yx(m,c,d){return d.iconsInText&&c?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function P_(m,c,d,_,x,w,A,C,P,O,D,U){const $=m.context,ee=$.gl,Q=m.transform,te=C==="map",ne=P==="map",W=te&&d.layout.get("symbol-placement")!=="point",he=te&&!ne&&!W,le=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pe=!1;const xe=m.depthModeForSublayer(0,o.DepthMode.ReadOnly),ye=[o.mercatorXfromLng(Q.center.lng),o.mercatorYfromLat(Q.center.lat)],Te=d.layout.get("text-variable-anchor"),Pe=Q.projection.name==="globe",Le=[],ze=[0,-1,0];let st=ze;!Pe&&!Q.mercatorFromTransition||te||(st=function(Ie){const Ze=Ie._camera.getWorldToCamera(Ie.worldSize,1),Ue=o.multiply([],Ze,Ie.globeMatrix);o.invert(Ue,Ue);const Ke=[0,0,0],Oe=[0,1,0,0];return o.transformMat4$1(Oe,Oe,Ue),Ke[0]=Oe[0],Ke[1]=Oe[1],Ke[2]=Oe[2],o.normalize(Ke,Ke),Ke}(Q));for(const Ie of _){const Ze=c.getTile(Ie),Ue=Ze.getBucket(d);if(!Ue||Ue.projection.name==="mercator"&&Pe)continue;const Ke=x?Ue.text:Ue.icon;if(!Ke||Ue.fullyClipped||!Ke.segments.get().length)continue;const Oe=Ke.programConfigurations.get(d.id),Ae=x||Ue.sdfIcons,Ne=x?Ue.textSizeData:Ue.iconSizeData,Ye=ne||Q.pitch!==0,tt=o.evaluateSizeForZoom(Ne,Q.zoom);let At,qt,vt,gt,Mt=[0,0],nn=null;if(x){if(qt=Ze.glyphAtlasTexture,vt=ee.LINEAR,At=Ze.glyphAtlasTexture.size,Ue.iconsInText){Mt=Ze.imageAtlasTexture.size,nn=Ze.imageAtlasTexture;const Hi=Ne.kind==="composite"||Ne.kind==="camera";gt=Ye||m.options.rotating||m.options.zooming||Hi?ee.LINEAR:ee.NEAREST}}else{const Hi=d.layout.get("icon-size").constantOr(0)!==1||Ue.iconsNeedLinear;qt=Ze.imageAtlasTexture,vt=Ae||m.options.rotating||m.options.zooming||Hi||Ye?ee.LINEAR:ee.NEAREST,At=Ze.imageAtlasTexture.size}const It=Ue.projection.name==="globe",gn=It?st:ze,In=It?o.globeToMercatorTransition(Q.zoom):0,jn=ot(Ie,Ue.getProjection(),Q),Nn=Q.calculatePixelsToTileUnitsMatrix(Ze),xr=Ts(jn,Ze.tileID.canonical,ne,te,Q,Ue.getProjection(),Nn),ki=m.terrain&&ne&&W?o.invert(o.create(),xr):hp,As=Ss(jn,Ze.tileID.canonical,ne,te,Q,Ue.getProjection(),Nn),Po=Te&&Ue.hasTextData(),Kn=d.layout.get("icon-text-fit")!=="none"&&Po&&Ue.hasIconData();if(W){const Hi=Q.elevation,us=Hi?Hi.getAtTileOffsetFunc(Ie,Q.center.lat,Q.worldSize,Ue.getProjection()):null,Io=Pi(jn,Ze.tileID.canonical,ne,te,Q,Ue.getProjection(),Nn);Ii(Ue,jn,m,x,Io,As,ne,O,us,Ie)}const Bn=W||x&&Te||Kn,fn=m.translatePosMatrix(jn,Ze,w,A),lr=Bn?hp:xr,ci=m.translatePosMatrix(As,Ze,w,A,!0),qn=Ue.getProjection().createInversionMatrix(Q,Ie.canonical),ui=[];m.terrainRenderModeElevated()&&ne&&ui.push("PITCH_WITH_MAP_TERRAIN"),It&&ui.push("PROJECTION_GLOBE_VIEW"),Bn&&ui.push("PROJECTED_POS_ON_VIEWPORT");const hi=Ae&&d.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let da;da=Ae?Ue.iconsInText?cp(Ne.kind,tt,he,ne,m,fn,lr,ci,At,Mt,Ie,In,ye,qn,gn,Ue.getProjection()):A_(Ne.kind,tt,he,ne,m,fn,lr,ci,x,At,!0,Ie,In,ye,qn,gn,Ue.getProjection()):au(Ne.kind,tt,he,ne,m,fn,lr,ci,x,At,Ie,In,ye,qn,gn,Ue.getProjection());const Wl={program:m.useProgram(Yx(Ae,x,Ue),Oe,ui),buffers:Ke,uniformValues:da,atlasTexture:qt,atlasTextureIcon:nn,atlasInterpolation:vt,atlasInterpolationIcon:gt,isSDF:Ae,hasHalo:hi,tile:Ze,labelPlaneMatrixInv:ki};if(le&&Ue.canOverlap){pe=!0;const Hi=Ke.segments.get();for(const us of Hi)Le.push({segments:new o.SegmentVector([us]),sortKey:us.sortKey,state:Wl})}else Le.push({segments:Ke.segments,sortKey:0,state:Wl})}pe&&Le.sort((Ie,Ze)=>Ie.sortKey-Ze.sortKey);for(const Ie of Le){const Ze=Ie.state;if(m.terrain&&m.terrain.setupElevationDraw(Ze.tile,Ze.program,{useDepthForOcclusion:!Pe,labelPlaneMatrixInv:Ze.labelPlaneMatrixInv}),$.activeTexture.set(ee.TEXTURE0),Ze.atlasTexture.bind(Ze.atlasInterpolation,ee.CLAMP_TO_EDGE),Ze.atlasTextureIcon&&($.activeTexture.set(ee.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),Ze.isSDF){const Ue=Ze.uniformValues;Ze.hasHalo&&(Ue.u_is_halo=1,I_(Ze.buffers,Ie.segments,d,m,Ze.program,xe,D,U,Ue)),Ue.u_is_halo=0}I_(Ze.buffers,Ie.segments,d,m,Ze.program,xe,D,U,Ze.uniformValues)}}function I_(m,c,d,_,x,w,A,C,P){const O=_.context,D=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];x.draw(O,O.gl.TRIANGLES,w,A,C,o.CullFaceMode.disabled,P,d.id,m.layoutVertexBuffer,m.indexBuffer,c,d.paint,_.transform.zoom,m.programConfigurations.get(d.id),D)}function R_(m,c,d,_,x,w,A){const C=m.context.gl,P=d.paint.get("fill-pattern"),O=P&&P.constantOr(1);let D,U,$,ee,Q;A?(U=O&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=C.LINES):(U=O?"fillPattern":"fill",D=C.TRIANGLES);for(const te of _){const ne=c.getTile(te);if(O&&!ne.patternsLoaded())continue;const W=ne.getBucket(d);if(!W)continue;m.prepareDrawTile();const he=W.programConfigurations.get(d.id),le=m.useProgram(U,he);O&&(m.context.activeTexture.set(C.TEXTURE0),ne.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),he.updatePaintBuffers());const pe=P.constantOr(null);if(pe&&ne.imageAtlas){const ye=ne.imageAtlas.patternPositions[pe.toString()];ye&&he.setConstantPatternPositions(ye)}const xe=m.translatePosMatrix(te.projMatrix,ne,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(A){ee=W.indexBuffer2,Q=W.segments2;const ye=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];$=U==="fillOutlinePattern"&&O?w_(xe,m,ne,ye):b_(xe,ye)}else ee=W.indexBuffer,Q=W.segments,$=O?Oh(xe,m,ne):Lh(xe);m.prepareDrawProgram(m.context,le,te.toUnwrapped()),le.draw(m.context,D,x,m.stencilModeForClipping(te),w,o.CullFaceMode.disabled,$,d.id,W.layoutVertexBuffer,ee,Q,d.paint,m.transform.zoom,he)}}function dp(m,c,d,_,x,w,A){const C=m.context,P=C.gl,O=m.transform,D=d.paint.get("fill-extrusion-pattern"),U=D.constantOr(1),$=d.paint.get("fill-extrusion-opacity"),ee=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),d.paint.get("fill-extrusion-ambient-occlusion-radius")],Q=d.layout.get("fill-extrusion-edge-radius"),te=O.projection.name==="globe"?o.fillExtrusionHeightLift():0,ne=O.projection.name==="globe",W=ne?o.globeToMercatorTransition(O.zoom):0,he=[o.mercatorXfromLng(O.center.lng),o.mercatorYfromLat(O.center.lat)],le=[];ne&&le.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&le.push("FAUX_AO");for(const pe of _){const xe=c.getTile(pe),ye=xe.getBucket(d);if(!ye||ye.projection.name!==O.projection.name)continue;const Te=ye.programConfigurations.get(d.id),Pe=m.useProgram(U?"fillExtrusionPattern":"fillExtrusion",Te,le);if(m.terrain){const Ke=m.terrain;if(m.style.terrainSetForDrapingOnly())Ke.setupElevationDraw(xe,Pe,{useMeterToDem:!0});else{if(!ye.enableTerrain)continue;if(Ke.setupElevationDraw(xe,Pe,{useMeterToDem:!0}),Kx(C,c,pe,ye,d,Ke),!ye.centroidVertexBuffer){const Oe=Pe.attributes.a_centroid_pos;Oe!==void 0&&P.vertexAttrib2f(Oe,0,0)}}}U&&(m.context.activeTexture.set(P.TEXTURE0),xe.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Te.updatePaintBuffers());const Le=D.constantOr(null);if(Le&&xe.imageAtlas){const Ke=xe.imageAtlas.patternPositions[Le.toString()];Ke&&Te.setConstantPatternPositions(Ke)}const ze=m.translatePosMatrix(pe.projMatrix,xe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),st=O.projection.createInversionMatrix(O,pe.canonical),Ie=d.paint.get("fill-extrusion-vertical-gradient"),Ze=U?ip(ze,m,Ie,$,ee,Q,pe,xe,te,W,he,st):kh(ze,m,Ie,$,ee,Q,pe,te,W,he,st);m.prepareDrawProgram(C,Pe,pe.toUnwrapped());const Ue=[];m.terrain&&Ue.push(ye.centroidVertexBuffer),ne&&Ue.push(ye.layoutVertexExtBuffer),Pe.draw(C,C.gl.TRIANGLES,x,w,A,o.CullFaceMode.backCCW,Ze,d.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,d.paint,m.transform.zoom,Te,Ue)}}function Kx(m,c,d,_,x,w){const A=[W=>{let he=W.canonical.x-1,le=W.wrap;return he<0&&(he=(1<<W.canonical.z)-1,le--),new o.OverscaledTileID(W.overscaledZ,le,W.canonical.z,he,W.canonical.y)},W=>{let he=W.canonical.x+1,le=W.wrap;return he===1<<W.canonical.z&&(he=0,le++),new o.OverscaledTileID(W.overscaledZ,le,W.canonical.z,he,W.canonical.y)},W=>new o.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(W.canonical.y===0?1<<W.canonical.z:W.canonical.y)-1),W=>new o.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],C=W=>{const he=c.getSource().minzoom,le=xe=>{const ye=c.getTileByID(xe);if(ye&&ye.hasData())return ye.getBucket(x)},pe=[0,-1,1];for(const xe of pe){if(W.overscaledZ+xe<he)continue;const ye=le(W.calculateScaledKey(W.overscaledZ+xe));if(ye)return ye}},P=[0,0,0],O=(W,he)=>(P[0]=Math.min(W.min.y,he.min.y),P[1]=Math.max(W.max.y,he.max.y),P[2]=o.EXTENT-he.min.x>W.max.x?he.min.x-o.EXTENT:W.max.x,P),D=(W,he)=>(P[0]=Math.min(W.min.x,he.min.x),P[1]=Math.max(W.max.x,he.max.x),P[2]=o.EXTENT-he.min.y>W.max.y?he.min.y-o.EXTENT:W.max.y,P),U=[(W,he)=>O(W,he),(W,he)=>O(he,W),(W,he)=>D(W,he),(W,he)=>D(he,W)],$=new o.pointGeometry(0,0);let ee,Q,te;const ne=(W,he,le,pe,xe)=>{const ye=[[pe?le:W,pe?W:le,0],[pe?le:he,pe?he:le,0]],Te=xe<0?o.EXTENT+xe:xe,Pe=[pe?Te:(W+he)/2,pe?(W+he)/2:Te,0];return le===0&&xe<0||le!==0&&xe>0?w.getForTilePoints(te,[Pe],!0,Q):ye.push(Pe),w.getForTilePoints(d,ye,!0,ee),Math.max(ye[0][2],ye[1][2],Pe[2])/w.exaggeration()};for(let W=0;W<4;W++){const he=(W<2?1:5)-W,le=_.borders[W];if(le.length===0)continue;const pe=te=A[W](d),xe=C(pe);if(!(xe&&xe instanceof o.FillExtrusionBucket&&xe.enableTerrain)||_.borderDoneWithNeighborZ[W]===xe.canonical.z&&xe.borderDoneWithNeighborZ[he]===_.canonical.z||(Q=w.findDEMTileFor(pe),!Q||!Q.dem))continue;if(!ee){const Le=w.findDEMTileFor(d);if(!Le||!Le.dem)return;ee=Le}const ye=xe.borders[he];let Te=0;const Pe=xe.borderDoneWithNeighborZ[he]!==_.canonical.z;if(_.canonical.z===xe.canonical.z){for(let Le=0;Le<le.length;Le++){const ze=_.featuresOnBorder[le[Le]],st=ze.borders[W];let Ie;for(;Te<ye.length&&(Ie=xe.featuresOnBorder[ye[Te]],!(Ie.borders[he][1]>st[0]+3));)Pe&&xe.encodeCentroid(void 0,Ie,!1),Te++;if(Ie&&Te<ye.length){const Ze=Te;let Ue=0;for(;!(Ie.borders[he][0]>st[1]-3)&&(Ue++,++Te!==ye.length);)Ie=xe.featuresOnBorder[ye[Te]];if(Ie=xe.featuresOnBorder[ye[Ze]],ze.intersectsCount()>1||Ie.intersectsCount()>1||Ue!==1){Ue!==1&&(Te=Ze),_.encodeCentroid(void 0,ze,!1),Pe&&xe.encodeCentroid(void 0,Ie,!1);continue}const Ke=U[W](ze,Ie),Oe=W%2?o.EXTENT-1:0;$.x=ne(Ke[0],Math.min(o.EXTENT-1,Ke[1]),Oe,W<2,Ke[2]),$.y=0,_.encodeCentroid($,ze,!1),Pe&&xe.encodeCentroid($,Ie,!1)}else _.encodeCentroid(void 0,ze,!1)}_.borderDoneWithNeighborZ[W]=xe.canonical.z,_.needsCentroidUpdate=!0,Pe&&(xe.borderDoneWithNeighborZ[he]=_.canonical.z,xe.needsCentroidUpdate=!0)}else{for(const Le of le)_.encodeCentroid(void 0,_.featuresOnBorder[Le],!1);if(Pe){for(const Le of ye)xe.encodeCentroid(void 0,xe.featuresOnBorder[Le],!1);xe.borderDoneWithNeighborZ[he]=_.canonical.z,xe.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[W]=xe.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(m)}const fp=new o.Color(1,0,0,1),pp=new o.Color(0,1,0,1),k_=new o.Color(0,0,1,1),L_=new o.Color(1,0,1,1),O_=new o.Color(0,1,1,1);function mp(m,c,d){const _=m.context,x=m.transform,w=_.gl,A=x.projection.name==="globe",C=A?["PROJECTION_GLOBE_VIEW"]:null;let P=d.projMatrix;if(A&&o.globeToMercatorTransition(x.zoom)>0){const ze=o.transitionTileAABBinECEF(d.canonical,x),st=o.globeDenormalizeECEF(ze);P=o.multiply(new Float32Array(16),x.globeMatrix,st),o.multiply(P,x.projMatrix,P)}const O=m.useProgram("debug",null,C),D=c.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(D,O);const U=o.DepthMode.disabled,$=o.StencilMode.disabled,ee=m.colorModeForRenderPass(),Q="$debug";_.activeTexture.set(w.TEXTURE0),m.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),A?D._makeGlobeTileDebugBuffers(m.context,x):D._makeDebugTileBoundsBuffers(m.context,x.projection);const te=D._tileDebugBuffer||m.debugBuffer,ne=D._tileDebugIndexBuffer||m.debugIndexBuffer,W=D._tileDebugSegments||m.debugSegments;O.draw(_,w.LINE_STRIP,U,$,ee,o.CullFaceMode.disabled,ou(P,o.Color.red),Q,te,ne,W,null,null,null,[D._globeTileDebugBorderBuffer]);const he=D.latestRawTileData,le=Math.floor((he&&he.byteLength||0)/1024),pe=c.getTile(d).tileSize,xe=512/Math.min(pe,512)*(d.overscaledZ/x.zoom)*.5;let ye=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ye+=` => ${d.overscaledZ}`),ye+=` ${le}kb`,function(ze,st){ze.initDebugOverlayCanvas();const Ie=ze.debugOverlayCanvas,Ze=ze.context.gl,Ue=ze.debugOverlayCanvas.getContext("2d");Ue.clearRect(0,0,Ie.width,Ie.height),Ue.shadowColor="white",Ue.shadowBlur=2,Ue.lineWidth=1.5,Ue.strokeStyle="white",Ue.textBaseline="top",Ue.font="bold 36px Open Sans, sans-serif",Ue.fillText(st,5,5),Ue.strokeText(st,5,5),ze.debugOverlayTexture.update(Ie),ze.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(m,ye);const Te=D._tileDebugTextBuffer||m.debugBuffer,Pe=D._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Le=D._tileDebugTextSegments||m.debugSegments;O.draw(_,w.TRIANGLES,U,$,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,ou(P,o.Color.transparent,xe),Q,Te,Pe,Le,null,null,null,[D._globeTileDebugTextBuffer])}function ha(m,c,d,_){lu(m,0,c+d/2,m.transform.width,d,_)}function Ol(m,c,d,_){lu(m,c-d/2,0,d,m.transform.height,_)}function lu(m,c,d,_,x,w){const A=m.context,C=A.gl;C.enable(C.SCISSOR_TEST),C.scissor(c*o.exported.devicePixelRatio,d*o.exported.devicePixelRatio,_*o.exported.devicePixelRatio,x*o.exported.devicePixelRatio),A.clear({color:w}),C.disable(C.SCISSOR_TEST)}const Dl=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:zl}=Dl;function Co(m,c,d,_){m.emplaceBack(c,d,_)}class Fh{constructor(c){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Co(this.vertexArray,-1,-1,1),Co(this.vertexArray,1,-1,1),Co(this.vertexArray,-1,1,1),Co(this.vertexArray,1,1,1),Co(this.vertexArray,-1,-1,-1),Co(this.vertexArray,1,-1,-1),Co(this.vertexArray,-1,1,-1),Co(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,zl),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function an(m,c,d,_,x,w){const A=m.gl,C=c.paint.get("sky-atmosphere-color"),P=c.paint.get("sky-atmosphere-halo-color"),O=c.paint.get("sky-atmosphere-sun-intensity"),D=((U,$,ee,Q,te)=>({u_matrix_3f:U,u_sun_direction:$,u_sun_intensity:ee,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[te.r,te.g,te.b,te.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),_),x,O,C,P);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+w,c.skyboxTexture,0),d.draw(m,A.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,D,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Nh=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Jx{constructor(c){const d=new o.StructArrayLayout5f20;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const _=new o.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(d,Nh.members),this.indexBuffer=c.createIndexBuffer(_),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const gp={symbol:function(m,c,d,_,x){if(m.renderPass!=="translucent")return;const w=o.StencilMode.disabled,A=m.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(C,P,O,D,U,$,ee){const Q=P.transform,te=U==="map",ne=$==="map";for(const W of C){const he=D.getTile(W),le=he.getBucket(O);if(!le||!le.text||!le.text.segments.get().length)continue;const pe=o.evaluateSizeForZoom(le.textSizeData,Q.zoom),xe=ot(W,le.getProjection(),Q),ye=Q.calculatePixelsToTileUnitsMatrix(he),Te=Ts(xe,he.tileID.canonical,ne,te,Q,le.getProjection(),ye),Pe=O.layout.get("icon-text-fit")!=="none"&&le.hasIconData();if(pe){const Le=Math.pow(2,Q.zoom-he.tileID.overscaledZ);Ll(le,te,ne,ee,o.symbolSize,Q,Te,W,Le,pe,Pe)}}}(_,m,d,c,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),x),d.paint.get("icon-opacity").constantOr(1)!==0&&P_(m,c,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),w,A),d.paint.get("text-opacity").constantOr(1)!==0&&P_(m,c,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),w,A),c.map.showCollisionBoxes&&(C_(m,c,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),C_(m,c,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,c,d,_){if(m.renderPass!=="translucent")return;const x=d.paint.get("circle-opacity"),w=d.paint.get("circle-stroke-width"),A=d.paint.get("circle-stroke-opacity"),C=d.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(w.constantOr(1)===0||A.constantOr(1)===0))return;const P=m.context,O=P.gl,D=m.transform,U=m.depthModeForSublayer(0,o.DepthMode.ReadOnly),$=o.StencilMode.disabled,ee=m.colorModeForRenderPass(),Q=D.projection.name==="globe",te=[o.mercatorXfromLng(D.center.lng),o.mercatorYfromLat(D.center.lat)],ne=[];for(let he=0;he<_.length;he++){const le=_[he],pe=c.getTile(le),xe=pe.getBucket(d);if(!xe||xe.projection.name!==D.projection.name)continue;const ye=xe.programConfigurations.get(d.id),Te=su(d);Q&&Te.push("PROJECTION_GLOBE_VIEW");const Pe=m.useProgram("circle",ye,Te),Le=xe.layoutVertexBuffer,ze=xe.globeExtVertexBuffer,st=xe.indexBuffer,Ie=D.projection.createInversionMatrix(D,le.canonical),Ze={programConfiguration:ye,program:Pe,layoutVertexBuffer:Le,globeExtVertexBuffer:ze,indexBuffer:st,uniformValues:iu(m,le,pe,Ie,te,d),tile:pe};if(C){const Ue=xe.segments.get();for(const Ke of Ue)ne.push({segments:new o.SegmentVector([Ke]),sortKey:Ke.sortKey,state:Ze})}else ne.push({segments:xe.segments,sortKey:0,state:Ze})}C&&ne.sort((he,le)=>he.sortKey-le.sortKey);const W={useDepthForOcclusion:!Q};for(const he of ne){const{programConfiguration:le,program:pe,layoutVertexBuffer:xe,globeExtVertexBuffer:ye,indexBuffer:Te,uniformValues:Pe,tile:Le}=he.state,ze=he.segments;m.terrain&&m.terrain.setupElevationDraw(Le,pe,W),m.prepareDrawProgram(P,pe,Le.tileID.toUnwrapped()),pe.draw(P,O.TRIANGLES,U,$,ee,o.CullFaceMode.disabled,Pe,d.id,xe,Te,ze,d.paint,D.zoom,le,[ye])}},heatmap:function(m,c,d,_){if(d.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const x=m.context,w=x.gl,A=o.StencilMode.disabled,C=new o.ColorMode([w.ONE,w.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(ee,Q,te,ne){const W=ee.gl,he=Q.width*ne,le=Q.height*ne;ee.activeTexture.set(W.TEXTURE1),ee.viewport.set([0,0,he,le]);let pe=te.heatmapFbo;if(!pe||pe&&(pe.width!==he||pe.height!==le)){pe&&pe.destroy();const xe=W.createTexture();W.bindTexture(W.TEXTURE_2D,xe),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),pe=te.heatmapFbo=ee.createFramebuffer(he,le,!1),function(ye,Te,Pe,Le,ze,st){const Ie=ye.gl;Ie.texImage2D(Ie.TEXTURE_2D,0,ye.isWebGL2&&ye.extRenderToTextureHalfFloat?Ie.RGBA16F:Ie.RGBA,ze,st,0,Ie.RGBA,ye.extRenderToTextureHalfFloat?ye.isWebGL2?Ie.HALF_FLOAT:ye.extTextureHalfFloat.HALF_FLOAT_OES:Ie.UNSIGNED_BYTE,null),Le.colorAttachment.set(Pe)}(ee,0,xe,pe,he,le)}else W.bindTexture(W.TEXTURE_2D,pe.colorAttachment.get()),ee.bindFramebuffer.set(pe.framebuffer)})(x,m,d,m.transform.projection.name==="globe"?.5:.25),x.clear({color:o.Color.transparent});const P=m.transform,O=P.projection.name==="globe",D=O?["PROJECTION_GLOBE_VIEW"]:null,U=O?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,$=[o.mercatorXfromLng(P.center.lng),o.mercatorYfromLat(P.center.lat)];for(let ee=0;ee<_.length;ee++){const Q=_[ee];if(c.hasRenderableParent(Q))continue;const te=c.getTile(Q),ne=te.getBucket(d);if(!ne||ne.projection.name!==P.projection.name)continue;const W=ne.programConfigurations.get(d.id),he=m.useProgram("heatmap",W,D),{zoom:le}=m.transform;m.terrain&&m.terrain.setupElevationDraw(te,he),m.prepareDrawProgram(x,he,Q.toUnwrapped());const pe=P.projection.createInversionMatrix(P,Q.canonical);he.draw(x,w.TRIANGLES,o.DepthMode.disabled,A,C,U,Ys(m,Q,te,pe,$,le,d.paint.get("heatmap-intensity")),d.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,d.paint,m.transform.zoom,W,O?[ne.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(x,w){const A=x.context,C=A.gl,P=w.heatmapFbo;if(!P)return;A.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,P.colorAttachment.get()),A.activeTexture.set(C.TEXTURE1);let O=w.colorRampTexture;O||(O=w.colorRampTexture=new o.Texture(A,w.colorRamp,C.RGBA)),O.bind(C.LINEAR,C.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(A,C.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,x.colorModeForRenderPass(),o.CullFaceMode.disabled,((D,U,$,ee)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(m,d))},line:function(m,c,d,_){if(m.renderPass!=="translucent")return;const x=d.paint.get("line-opacity"),w=d.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const A=m.depthModeForSublayer(0,o.DepthMode.ReadOnly),C=m.colorModeForRenderPass(),P=m.terrain&&m.terrain.renderingToTexture?1:o.exported.devicePixelRatio,O=d.paint.get("line-dasharray"),D=O.constantOr(1),U=d.layout.get("line-cap"),$=d.paint.get("line-pattern"),ee=$.constantOr(1),Q=d.paint.get("line-gradient"),te=ee?"linePattern":"line",ne=m.context,W=ne.gl,he=(pe=>{const xe=[];zh(pe)&&xe.push("RENDER_LINE_DASH"),pe.paint.get("line-gradient")&&xe.push("RENDER_LINE_GRADIENT");const ye=pe.paint.get("line-trim-offset");ye[0]===0&&ye[1]===0||xe.push("RENDER_LINE_TRIM_OFFSET");const Te=pe.paint.get("line-pattern").constantOr(1),Pe=pe.paint.get("line-opacity").constantOr(1)!==1;return!Te&&Pe&&xe.push("RENDER_LINE_ALPHA_DISCARD"),xe})(d);let le=he.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const pe of _){const xe=c.getTile(pe);if(ee&&!xe.patternsLoaded())continue;const ye=xe.getBucket(d);if(!ye)continue;m.prepareDrawTile();const Te=ye.programConfigurations.get(d.id),Pe=m.useProgram(te,Te,he),Le=$.constantOr(null);if(Le&&xe.imageAtlas){const Ae=xe.imageAtlas.patternPositions[Le.toString()];Ae&&Te.setConstantPatternPositions(Ae)}const ze=O.constantOr(null),st=U.constantOr(null);if(!ee&&ze&&st&&xe.lineAtlas){const Ae=xe.lineAtlas.getDash(ze,st);Ae&&Te.setConstantPatternPositions(Ae)}let[Ie,Ze]=d.paint.get("line-trim-offset");(st==="round"||st==="square")&&Ie!==Ze&&(Ie===0&&(Ie-=1),Ze===1&&(Ze+=1));const Ue=m.terrain?pe.projMatrix:null,Ke=ee?T_(m,xe,d,Ue,P):op(m,xe,d,Ue,ye.lineClipsArray.length,P,[Ie,Ze]);if(Q){const Ae=ye.gradients[d.id];let Ne=Ae.texture;if(d.gradientVersion!==Ae.version){let Ye=256;if(d.stepInterpolant){const tt=c.getSource().maxzoom,At=pe.canonical.z===tt?Math.ceil(1<<m.transform.maxZoom-pe.canonical.z):1;Ye=o.clamp(o.nextPowerOfTwo(ye.maxLineLength/o.EXTENT*1024*At),256,ne.maxTextureSize)}Ae.gradient=o.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Ye,image:Ae.gradient||void 0,clips:ye.lineClipsArray}),Ae.texture?Ae.texture.update(Ae.gradient):Ae.texture=new o.Texture(ne,Ae.gradient,W.RGBA),Ae.version=d.gradientVersion,Ne=Ae.texture}ne.activeTexture.set(W.TEXTURE1),Ne.bind(d.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}D&&(ne.activeTexture.set(W.TEXTURE0),xe.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),Te.updatePaintBuffers()),ee&&(ne.activeTexture.set(W.TEXTURE0),xe.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Te.updatePaintBuffers()),m.prepareDrawProgram(ne,Pe,pe.toUnwrapped());const Oe=Ae=>{Pe.draw(ne,W.TRIANGLES,A,Ae,C,o.CullFaceMode.disabled,Ke,d.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,d.paint,m.transform.zoom,Te,[ye.layoutVertexBuffer2])};if(le){const Ae=m.stencilModeForClipping(pe).ref;Ae===0&&m.terrain&&ne.clear({stencil:0});const Ne={func:W.EQUAL,mask:255};Ke.u_alpha_discard_threshold=.8,Oe(new o.StencilMode(Ne,Ae,255,W.KEEP,W.KEEP,W.INVERT)),Ke.u_alpha_discard_threshold=0,Oe(new o.StencilMode(Ne,Ae,255,W.KEEP,W.KEEP,W.KEEP))}else Oe(m.stencilModeForClipping(pe))}le&&(m.resetStencilClippingMasks(),m.terrain&&ne.clear({stencil:0}))},fill:function(m,c,d,_){const x=d.paint.get("fill-color"),w=d.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const A=m.colorModeForRenderPass(),C=d.paint.get("fill-pattern"),P=m.opaquePassEnabledForLayer()&&!C.constantOr(1)&&x.constantOr(o.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===P){const O=m.depthModeForSublayer(1,m.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);R_(m,c,d,_,O,A,!1)}if(m.renderPass==="translucent"&&d.paint.get("fill-antialias")){const O=m.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);R_(m,c,d,_,O,A,!0)}},"fill-extrusion":function(m,c,d,_){const x=d.paint.get("fill-extrusion-opacity");if(x!==0&&m.renderPass==="translucent"){const w=new o.DepthMode(m.context.gl.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D);if(x!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))dp(m,c,d,_,w,o.StencilMode.disabled,o.ColorMode.disabled),dp(m,c,d,_,w,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const A=m.colorModeForRenderPass();dp(m,c,d,_,w,o.StencilMode.disabled,A)}}},hillshade:function(m,c,d,_){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const x=m.context,w=m.depthModeForSublayer(0,o.DepthMode.ReadOnly),A=m.colorModeForRenderPass(),C=m.terrain&&m.terrain.renderingToTexture,[P,O]=m.renderPass!=="translucent"||C?[{},_]:m.stencilConfigForOverlap(_);for(const D of O){const U=c.getTile(D);if(U.needsHillshadePrepare&&m.renderPass==="offscreen")Mh(m,U,d,w,o.StencilMode.disabled,A);else if(m.renderPass==="translucent"){const $=C&&m.terrain?m.terrain.stencilModeForRTTOverlap(D):P[D.overscaledZ];tu(m,D,U,d,w,$,A)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,c,d,_,x,w){if(m.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!_.length)return;const A=m.context,C=A.gl,P=c.getSource(),O=m.useProgram("raster"),D=m.colorModeForRenderPass(),U=m.terrain&&m.terrain.renderingToTexture,[$,ee]=P instanceof we||U?[{},_]:m.stencilConfigForOverlap(_),Q=ee[ee.length-1].overscaledZ,te=!m.options.moving;for(const ne of ee){const W=U?o.DepthMode.disabled:m.depthModeForSublayer(ne.overscaledZ-Q,d.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,C.LESS),he=ne.toUnwrapped(),le=c.getTile(ne);if(U&&(!le||!le.hasData()))continue;const pe=U?ne.projMatrix:m.transform.calculateProjMatrix(he,te),xe=m.terrain&&U?m.terrain.stencilModeForRTTOverlap(ne):$[ne.overscaledZ],ye=w?0:d.paint.get("raster-fade-duration");le.registerFadeDuration(ye);const Te=c.findLoadedParent(ne,0),Pe=ru(le,Te,c,m.transform,ye);let Le,ze;m.terrain&&m.terrain.prepareDrawTile();const st=d.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;A.activeTexture.set(C.TEXTURE0),le.texture.bind(st,C.CLAMP_TO_EDGE),A.activeTexture.set(C.TEXTURE1),Te?(Te.texture.bind(st,C.CLAMP_TO_EDGE),Le=Math.pow(2,Te.tileID.overscaledZ-le.tileID.overscaledZ),ze=[le.tileID.canonical.x*Le%1,le.tileID.canonical.y*Le%1]):le.texture.bind(st,C.CLAMP_TO_EDGE);const Ie=Zx(pe,ze||[0,0],Le||1,Pe,d,P instanceof we?P.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(A,O,he),P instanceof we)P.boundsBuffer&&P.boundsSegments&&O.draw(A,C.TRIANGLES,W,o.StencilMode.disabled,D,o.CullFaceMode.disabled,Ie,d.id,P.boundsBuffer,m.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:Ze,tileBoundsIndexBuffer:Ue,tileBoundsSegments:Ke}=m.getTileBoundsBuffers(le);O.draw(A,C.TRIANGLES,W,xe,D,o.CullFaceMode.disabled,Ie,d.id,Ze,Ue,Ke)}}m.resetStencilClippingMasks()},background:function(m,c,d,_){const x=d.paint.get("background-color"),w=d.paint.get("background-opacity");if(w===0)return;const A=m.context,C=A.gl,P=m.transform,O=P.tileSize,D=d.paint.get("background-pattern");if(m.isPatternMissing(D))return;const U=!D&&x.a===1&&w===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==U)return;const $=o.StencilMode.disabled,ee=m.depthModeForSublayer(0,U==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Q=m.colorModeForRenderPass(),te=m.useProgram(D?"backgroundPattern":"background");let ne,W=_;W||(ne=m.getBackgroundTiles(),W=Object.values(ne).map(he=>he.tileID)),D&&(A.activeTexture.set(C.TEXTURE0),m.imageManager.bind(m.context));for(const he of W){const le=he.toUnwrapped(),pe=_?he.projMatrix:m.transform.calculateProjMatrix(le);m.prepareDrawTile();const xe=c?c.getTile(he):ne?ne[he.key]:new o.Tile(he,O,P.zoom,m),ye=D?up(pe,w,m,D,{tileID:he,tileSize:O}):qx(pe,w,x);m.prepareDrawProgram(A,te,le);const{tileBoundsBuffer:Te,tileBoundsIndexBuffer:Pe,tileBoundsSegments:Le}=m.getTileBoundsBuffers(xe);te.draw(A,C.TRIANGLES,ee,$,Q,o.CullFaceMode.disabled,ye,d.id,Te,Pe,Le)}},sky:function(m,c,d){const _=m.transform,x=_.projection.name==="mercator"||_.projection.name==="globe"?1:o.smoothstep(7,8,_.zoom),w=d.paint.get("sky-opacity")*x;if(w===0)return;const A=m.context,C=d.paint.get("sky-type"),P=new o.DepthMode(A.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),O=m.frameCounter/1e3%1;C==="atmosphere"?m.renderPass==="offscreen"?d.needsSkyboxCapture(m)&&(function(D,U,$,ee){const Q=D.context,te=Q.gl;let ne=U.skyboxFbo;if(!ne){ne=U.skyboxFbo=Q.createFramebuffer(32,32,!1),U.skyboxGeometry=new Fh(Q),U.skyboxTexture=Q.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,U.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let pe=0;pe<6;++pe)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ne.framebuffer),Q.viewport.set([0,0,32,32]);const W=U.getCenter(D,!0),he=D.useProgram("skyboxCapture"),le=new Float64Array(16);o.identity(le),o.rotateY(le,le,.5*-Math.PI),an(Q,U,he,le,W,0),o.identity(le),o.rotateY(le,le,.5*Math.PI),an(Q,U,he,le,W,1),o.identity(le),o.rotateX(le,le,.5*-Math.PI),an(Q,U,he,le,W,2),o.identity(le),o.rotateX(le,le,.5*Math.PI),an(Q,U,he,le,W,3),o.identity(le),an(Q,U,he,le,W,4),o.identity(le),o.rotateY(le,le,Math.PI),an(Q,U,he,le,W,5),Q.viewport.set([0,0,D.width,D.height])}(m,d),d.markSkyboxValid(m)):m.renderPass==="sky"&&function(D,U,$,ee,Q){const te=D.context,ne=te.gl,W=D.transform,he=D.useProgram("skybox");te.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_CUBE_MAP,U.skyboxTexture);const le=((pe,xe,ye,Te,Pe)=>({u_matrix:pe,u_sun_direction:xe,u_cubemap:0,u_opacity:Te,u_temporal_offset:Pe}))(W.skyboxMatrix,U.getCenter(D,!1),0,ee,Q);D.prepareDrawProgram(te,he),he.draw(te,ne.TRIANGLES,$,o.StencilMode.disabled,D.colorModeForRenderPass(),o.CullFaceMode.backCW,le,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(m,d,P,w,O):C==="gradient"&&m.renderPass==="sky"&&function(D,U,$,ee,Q){const te=D.context,ne=te.gl,W=D.transform,he=D.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Fh(te)),te.activeTexture.set(ne.TEXTURE0);let le=U.colorRampTexture;le||(le=U.colorRampTexture=new o.Texture(te,U.colorRamp,ne.RGBA)),le.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const pe=((xe,ye,Te,Pe,Le)=>({u_matrix:xe,u_color_ramp:0,u_center_direction:ye,u_radius:o.degToRad(Te),u_opacity:Pe,u_temporal_offset:Le}))(W.skyboxMatrix,U.getCenter(D,!1),U.paint.get("sky-gradient-radius"),ee,Q);D.prepareDrawProgram(te,he),he.draw(te,ne.TRIANGLES,$,o.StencilMode.disabled,D.colorModeForRenderPass(),o.CullFaceMode.backCW,pe,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(m,d,P,w,O)},debug:function(m,c,d){for(let _=0;_<d.length;_++)mp(m,c,d[_])},custom:function(m,c,d,_){const x=m.context,w=d.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&d.isLayerDraped()){if(m.renderPass==="offscreen"){const A=w.prerender;if(A){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const C=m.transform.pointMerc;A.call(w,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(m.transform.zoom),[C.x,C.y],m.transform.pixelsPerMeterRatio)}else A.call(w,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const C=w.renderToTile;if(C){const P=_[0].canonical,O=new o.MercatorCoordinate(P.x+_[0].wrap*(1<<P.z),P.y,P.z);x.setDepthMode(o.DepthMode.disabled),x.setStencilMode(o.StencilMode.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),C.call(w,x.gl,O),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(o.StencilMode.disabled);const A=w.renderingMode==="3d"?new o.DepthMode(m.context.gl.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(x.setDepthMode(A),m.transform.projection.name==="globe"){const C=m.transform.pointMerc;w.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(m.transform.zoom),[C.x,C.y],m.transform.pixelsPerMeterRatio)}else w.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class cu{constructor(c,d,_=!1){this.context=new oe(c,_),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new f_,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,d){const _=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new np(this,c));const x=this._terrain;this.transform.elevation=_?x:null,x.update(c,this.transform,d)}_updateFog(c){const d=c.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=d.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const w=_+.78*(x-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,d){if(this.width=c*o.exported.devicePixelRatio,this.height=d*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const c=this.context,d=new o.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(o.EXTENT,0),d.emplaceBack(0,o.EXTENT),d.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(d,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const _=new o.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(o.EXTENT,0),_.emplaceBack(0,o.EXTENT),_.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=c.createVertexBuffer(_,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const x=new o.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(x,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const w=new o.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(o.EXTENT,0,o.EXTENT,0),w.emplaceBack(0,o.EXTENT,0,o.EXTENT),w.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(w,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const A=new o.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(A);const C=new o.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])C.emplaceBack(O);this.debugIndexBuffer=c.createIndexBuffer(C),this.emptyTexture=new o.Texture(c,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=o.create();const P=this.context.gl;this.stencilClearMode=new o.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Jx(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,d=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,d.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,ln(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,d,_){if(!d||this.currentStencilSource===d.id||!c.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const P of _)if(this._tileClippingMaskIDs[P.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=d.id;const x=this.context,w=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(o.ColorMode.disabled),x.setDepthMode(o.DepthMode.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of _){const P=d.getTile(C),O=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:U,tileBoundsSegments:$}=this.getTileBoundsBuffers(P);A.draw(x,w.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ln(C.projMatrix),"$clipping",D,U,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,d=this.context.gl;return new o.StencilMode({func:d.NOTEQUAL,mask:255},c,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const d=this.context.gl;return new o.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(c){const d=this.context.gl,_=c.sort((A,C)=>C.overscaledZ-A.overscaledZ),x=_[_.length-1].overscaledZ,w=_[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const A={};for(let C=0;C<w;C++)A[C+x]=new o.StencilMode({func:d.GEQUAL,mask:255},C+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=w,[A,_]}return[{[x]:o.StencilMode.disabled},_]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([c.CONSTANT_COLOR,c.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(c,d,_){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new o.DepthMode(_||this.context.gl.LEQUAL,d,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,d){this.style=c,this.options=d,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const _=this.style.order,x=this.style._sourceCaches;for(const P in x){const O=x[P];O.used&&O.prepare(this.context)}const w={},A={},C={};for(const P in x){const O=x[P];w[P]=O.getVisibleCoordinates(),A[P]=w[P].slice().reverse(),C[P]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<_.length;P++)if(this.style._layers[_[P]].is3D()){this.opaquePassCutoff=P;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const P of _){const O=this.style._layers[P],D=c._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const U=D?A[D.id]:void 0;(O.type==="custom"||O.isSky()||U&&U.length)&&this.renderLayer(this,D,O,U)}if(this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:d.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[_[this.currentLayer]],O=c._getLayerSourceCache(P);if(P.isSky())continue;const D=O?A[O.id]:void 0;this._renderTileClippingMasks(P,O,D),this.renderLayer(this,O,P,D)}if(this.style.fog&&this.transform.projection.supportsFog&&function(P,O){const D=P.context,U=D.gl,$=P.transform,ee=new o.DepthMode(U.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Q=P.useProgram("globeAtmosphere",null,$.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),te=o.globeToMercatorTransition($.zoom),ne=O.properties.get("color").toArray01(),W=O.properties.get("high-color").toArray01(),he=O.properties.get("space-color").toArray01PremultipliedAlpha(),le=o.identity$1([]);o.rotateY$1(le,le,-o.degToRad($._center.lng)),o.rotateX$1(le,le,o.degToRad($._center.lat)),o.rotateZ$1(le,le,$.angle),o.rotateX$1(le,le,-$._pitch);const pe=o.fromQuat(new Float32Array(16),le),xe=o.mapValue(O.properties.get("star-intensity"),0,1,0,.25),ye=5e-4,Te=o.mapValue(O.properties.get("horizon-blend"),0,1,ye,.25),Pe=o.globeUseCustomAntiAliasing(P,D,$)&&Te===ye?$.worldSize/(2*Math.PI*1.025)-1:$.globeRadius,Le=P.frameCounter/1e3%1,ze=o.length($.globeCenterInViewSpace),st=Math.sqrt(Math.pow(ze,2)-Math.pow(Pe,2)),Ie=Math.acos(st/ze),Ze=((Ke,Oe,Ae,Ne,Ye,tt,At,qt,vt,gt,Mt,nn,It,gn)=>({u_frustum_tl:Ke,u_frustum_tr:Oe,u_frustum_br:Ae,u_frustum_bl:Ne,u_horizon:Ye,u_transition:tt,u_fadeout_range:At,u_color:qt,u_high_color:vt,u_space_color:gt,u_star_intensity:Mt,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:nn,u_horizon_angle:It,u_rotation_matrix:gn}))($.frustumCorners.TL,$.frustumCorners.TR,$.frustumCorners.BR,$.frustumCorners.BL,$.frustumCorners.horizon,te,Te,ne,W,he,xe,Le,Ie,pe);P.prepareDrawProgram(D,Q);const Ue=P.atmosphereBuffer;Ue&&Q.draw(D,U.TRIANGLES,ee,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Ze,"skybox",Ue.vertexBuffer,Ue.indexBuffer,Ue.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const P=this.style._layers[_[this.currentLayer]],O=c._getLayerSourceCache(P);P.isSky()&&this.renderLayer(this,O,P,O?A[O.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const P=this.style._layers[_[this.currentLayer]],O=c._getLayerSourceCache(P);if(P.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(P)){if(P.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const D=O?(P.type==="symbol"?C:A)[O.id]:void 0;this._renderTileClippingMasks(P,O,O?w[O.id]:void 0),this.renderLayer(this,O,P,D),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let P=null;o.values(this.style._layers).forEach(O=>{const D=c._getLayerSourceCache(O);D&&!O.isHidden(this.transform.zoom)&&(!P||P.getSource().maxzoom<D.getSource().maxzoom)&&(P=D)}),P&&this.options.showTileBoundaries&&gp.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const O=P.transform.padding;ha(P,P.transform.height-(O.top||0),3,fp),ha(P,O.bottom||0,3,pp),Ol(P,O.left||0,3,k_),Ol(P,P.transform.width-(O.right||0),3,L_);const D=P.transform.centerPoint;(function(U,$,ee,Q){lu(U,$-1,ee-10,2,20,Q),lu(U,$-10,ee-1,20,2,Q)})(P,D.x,P.transform.height-D.y,O_)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(c,d,_,x){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(_.type)||c.terrain&&_.type==="custom")&&gp[_.type](c,d,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let _=this.gpuTimers[c.id];_||(_=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,d=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(d),c.beginQueryEXT(c.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const d={};for(const _ in c){const x=c[_],w=this.context.extTimerQuery,A=w.getQueryObjectEXT(x.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(x.query),d[_]=A}return d}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery;let _=0;for(const x of c)_+=d.getQueryObjectEXT(x,d.QUERY_RESULT_EXT)/1e6,d.deleteQueryEXT(x);return _}translatePosMatrix(c,d,_,x,w){if(!_[0]&&!_[1])return c;const A=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(A){const O=Math.sin(A),D=Math.cos(A);_=[_[0]*D-_[1]*O,_[0]*O+_[1]*D]}const C=[w?_[0]:pr(d,_[0],this.transform.zoom),w?_[1]:pr(d,_[1],this.transform.zoom),0],P=new Float32Array(16);return o.translate(P,c,C),P}saveTileTexture(c){const d=this._tileTextures[c.size[0]];d?d.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const d=this._tileTextures[c];return d&&d.length>0?d.pop():null}isPatternMissing(c){return c===null||c!==void 0&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,d=this.terrain&&this.terrain.exaggeration()===0,_=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),this.transform.projection.name==="globe"&&x.push("GLOBE"),d&&x.push("ZERO_EXAGGERATION"),_&&!c&&_.getOpacity(this.transform.pitch)!==0&&x.push("FOG"),c&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(c,d,_){this.cache=this.cache||{};const x=_||[],w=this.currentGlobalDefines().concat(x),A=rp.cacheKey(Yf[c],c,w,d);return this.cache[A]||(this.cache[A]=new rp(this.context,c,Yf[c],d,Xx[c],w)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,d,_){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const w=x.getOpacity(this.transform.pitch),A=((C,P,O,D,U,$,ee,Q,te,ne,W)=>{const he=C.transform,le=P.properties.get("color").toArray01();le[3]=D;const pe=C.frameCounter/1e3%1;return{u_fog_matrix:O?he.calculateFogTileMatrix(O):C.identityMat,u_fog_range:P.getFovAdjustedRange(he._fov),u_fog_color:le,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:pe,u_frustum_tl:U,u_frustum_tr:$,u_frustum_br:ee,u_frustum_bl:Q,u_globe_pos:te,u_globe_radius:ne,u_viewport:W,u_globe_transition:o.globeToMercatorTransition(he.zoom),u_is_globe:+(he.projection.name==="globe")}})(this,x,_,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);d.setFogUniformValues(c,A)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,d=c.createTexture();return c.bindTexture(c.TEXTURE_2D,d),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&c.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const c=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)d[x.key]=c[x.key]||new o.Tile(x,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class _p{constructor(c=0,d=0,_=0,x=0){if(isNaN(c)||c<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=d,this.left=_,this.right=x}interpolate(c,d,_){return d.top!=null&&c.top!=null&&(this.top=o.number(c.top,d.top,_)),d.bottom!=null&&c.bottom!=null&&(this.bottom=o.number(c.bottom,d.bottom,_)),d.left!=null&&c.left!=null&&(this.left=o.number(c.left,d.left,_)),d.right!=null&&c.right!=null&&(this.right=o.number(c.right,d.right,_)),this}getCenter(c,d){const _=o.clamp((this.left+c-this.right)/2,0,c),x=o.clamp((this.top+d-this.bottom)/2,0,d);return new o.pointGeometry(_,x)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new _p(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function D_(m,c){const d=o.getColumn(m,3);o.fromQuat(m,c),o.setColumn(m,3,d)}function Bh(m,c){const d=o.identity$1([]);return o.rotateZ$1(d,d,-c),o.rotateX$1(d,d,-m),d}function z_(m,c){const d=[m[0],m[1],0],_=[c[0],c[1],0];if(o.length(d)>=1e-15){const A=o.normalize([],d);o.scale$2(_,A,o.dot(_,A)),c[0]=_[0],c[1]=_[1]}const x=o.cross([],c,m);if(o.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return Bh(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),w)}class Uh{constructor(c,d){this.position=c,this.orientation=d}get position(){return this._position}set position(c){if(c){const d=c instanceof o.MercatorCoordinate?c:new o.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(d.x=o.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(c,d){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(c)):0,x=this.position,w=o.MercatorCoordinate.fromLngLat(c,_),A=[w.x-x.x,w.y-x.y,w.z-x.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=z_(A,d)}setPitchBearing(c,d){this.orientation=Bh(o.degToRad(c),o.degToRad(-d))}}class Fl{constructor(c,d){this._transform=o.identity([]),this.orientation=d,this.position=c}get mercatorPosition(){const c=this.position;return new o.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=o.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var d;c&&o.setColumn(this._transform,3,[(d=c)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||o.identity$1([]),c&&D_(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,d){this._orientation=Bh(c,d),D_(this._transform,this._orientation)}forward(){const c=o.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=o.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=o.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,d){const _=new Float64Array(16);return o.invert(_,this.getWorldToCamera(c,d)),_}getWorldToCameraPosition(c,d,_){const x=this.position;o.scale$2(x,x,-c);const w=new Float64Array(16);return o.fromScaling(w,[_,_,_]),o.translate(w,w,x),w[10]*=d,w}getWorldToCamera(c,d){const _=new Float64Array(16),x=new Float64Array(4),w=this.position;return o.conjugate(x,this._orientation),o.scale$2(w,w,-c),o.fromQuat(_,x),o.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(c,d,_,x){const w=new Float64Array(16);return o.perspective(w,c,d,_,x),w}getDistanceToElevation(c,d=!1){const _=c===0?0:o.mercatorZfromAltitude(c,d?o.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new Fl([...this.position],[...this.orientation])}}function Nl(m,c){const d=qa(m.projection,m.zoom,m.width,m.height),_=function(w,A,C,P,O){const D=new o.LngLat(C.lng-180*Xa,C.lat),U=new o.LngLat(C.lng+180*Xa,C.lat),$=w.project(D.lng,D.lat),ee=w.project(U.lng,U.lat),Q=-Math.atan2(ee.y-$.y,ee.x-$.x),te=o.MercatorCoordinate.fromLngLat(C);te.y=o.clamp(te.y,-.999975,.999975);const ne=te.toLngLat(),W=w.project(ne.lng,ne.lat),he=o.MercatorCoordinate.fromLngLat(ne);he.x+=Xa;const le=he.toLngLat(),pe=w.project(le.lng,le.lat),xe=hu(pe.x-W.x,pe.y-W.y,Q),ye=o.MercatorCoordinate.fromLngLat(ne);ye.y+=Xa;const Te=ye.toLngLat(),Pe=w.project(Te.lng,Te.lat),Le=hu(Pe.x-W.x,Pe.y-W.y,Q),ze=Math.abs(xe.x)/Math.abs(Le.y),st=o.identity([]);o.rotateZ(st,st,-Q*(1-(O?0:P)));const Ie=o.identity([]);return o.scale(Ie,Ie,[1,1-(1-ze)*P,1]),Ie[4]=-Le.x/Le.y*P,o.rotateZ(Ie,Ie,Q),o.multiply(Ie,st,Ie),Ie}(m.projection,0,m.center,d,c),x=Vh(m);return o.scale(_,_,[x,x,1]),_}function Vh(m){const c=m.projection,d=qa(m.projection,m.zoom,m.width,m.height),_=uu(c,m.center),x=uu(c,o.LngLat.convert(c.center));return Math.pow(2,_*d+(1-d)*x)}function qa(m,c,d,_,x=1/0){const w=m.range;if(!w)return 0;const A=Math.min(x,Math.max(d,_)),C=Math.log(A/1024)/Math.LN2;return o.smoothstep(w[0]+C,w[1]+C,c)}const Xa=1/4e4;function uu(m,c){const d=o.clamp(c.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),_=new o.LngLat(c.lng-180*Xa,d),x=new o.LngLat(c.lng+180*Xa,d),w=m.project(_.lng,d),A=m.project(x.lng,d),C=o.MercatorCoordinate.fromLngLat(_),P=o.MercatorCoordinate.fromLngLat(x),O=A.x-w.x,D=A.y-w.y,U=P.x-C.x,$=P.y-C.y,ee=Math.sqrt((U*U+$*$)/(O*O+D*D));return Math.log(ee)/Math.LN2}function hu(m,c,d){const _=Math.cos(d),x=Math.sin(d);return{x:m*_-c*x,y:m*x+c*_}}class mt{constructor(c,d,_,x,w,A,C){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=c||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=x??60,this.setProjection(A),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new _p,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Fl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new mt(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,d=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(c||_)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const _=!v(d,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const d=c!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const d=-c*Math.PI/180;var _;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),function(x,w,A){var C=w[0],P=w[1],O=w[2],D=w[3],U=Math.sin(A),$=Math.cos(A);x[0]=C*$+O*U,x[1]=P*$+D*U,x[2]=C*-U+O*$,x[3]=P*-U+D*$}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const d=o.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=o.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const d=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,w=0;for(let A=0;A<d.length;A++){const C=new o.pointGeometry(d[A][0]*this.width,_+d[A][1]*(this.height-_)),P=c.pointCoordinate(C);if(!P)continue;const O=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);x+=P[3]*O,w+=O}return w===0?NaN:x/w}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const c=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,x=this._mercatorZfromZoom(c),w=this._mercatorZfromZoom(this._maxZoom),A=Math.max(x-_,w);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let _;_=c.z<this._camera.position[2]?[d.x,d.y,d.z]:[c.x,c.y,c.z];const x=o.length(o.sub([],this._camera.position,_));return o.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let d=!1;if(c.orientation&&!o.exactEquals(c.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(c.orientation)),c.position){const _=[c.position.x,c.position.y,c.position.z];o.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,d=new Uh;return d.position=new o.MercatorCoordinate(c[0],c[1],c[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(c){if(!o.length$1(c))return!1;o.normalize$1(c,c);const d=o.transformQuat([],[0,0,-1],c),_=o.transformQuat([],[0,-1,0],c);if(_[2]<0)return!1;const x=z_(d,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(c){const d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;c[2]=o.clamp(c[2],x/_,x/d),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,d,_){this._unmodified=!1,this._edgeInsets.interpolate(c,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const d=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(c){const d=[new o.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const _=this.pointCoordinate(new o.pointGeometry(0,0)),x=this.pointCoordinate(new o.pointGeometry(this.width,0)),w=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),A=this.pointCoordinate(new o.pointGeometry(0,this.height)),C=Math.floor(Math.min(_.x,x.x,w.x,A.x)),P=Math.floor(Math.max(_.x,x.x,w.x,A.x)),O=1;for(let D=C-O;D<=P+O;D++)D!==0&&d.push(new o.UnwrappedTileID(D,c))}return d}coveringTiles(c){let d=this.coveringZoomLevel(c);const _=d,x=this.elevation&&!c.isTerrainDEM,w=this.projection.name==="mercator";if(c.minzoom!==void 0&&d<c.minzoom)return[];c.maxzoom!==void 0&&d>c.maxzoom&&(d=c.maxzoom);const A=this.locationCoordinate(this.center),C=this.center.lat,P=1<<d,O=[P*A.x,P*A.y,0],D=this.projection.name==="globe",U=!D,$=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,U),ee=D?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=P*o.mercatorZfromAltitude(1,this.center.lat),te=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),ne=[P*ee.x,P*ee.y,te*(U?1:Q)],W=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),he=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,le=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,pe=c.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,xe=this.projection.isReprojectedInTileSpace?Vh(this):1,ye=Oe=>{const Ne=new o.MercatorCoordinate(Oe.x+25e-6,Oe.y,Oe.z),Ye=new o.MercatorCoordinate(Oe.x,Oe.y+25e-6,Oe.z),tt=Oe.toLngLat(),At=Ne.toLngLat(),qt=Ye.toLngLat(),vt=this.locationCoordinate(tt),gt=this.locationCoordinate(At),Mt=this.locationCoordinate(qt),nn=Math.hypot(gt.x-vt.x,gt.y-vt.y),It=Math.hypot(Mt.x-vt.x,Mt.y-vt.y);return Math.sqrt(nn*It)*xe/25e-6},Te=Oe=>{const Ae=le,Ne=pe;return{aabb:o.tileAABB(this,P,0,0,0,Oe,Ne,Ae,this.projection),zoom:0,x:0,y:0,minZ:Ne,maxZ:Ae,wrap:Oe,fullyVisible:!1}},Pe=[];let Le=[];const ze=d,st=c.reparseOverscaled?_:d,Ie=Oe=>Oe*Oe,Ze=Ie((te-this._centerAltitude)*Q),Ue=Oe=>{if(!this._elevation||!Oe.tileID||!w)return;const Ae=this._elevation.getMinMaxForTile(Oe.tileID),Ne=Oe.aabb;Ae?(Ne.min[2]=Ae.min,Ne.max[2]=Ae.max,Ne.center[2]=(Ne.min[2]+Ne.max[2])/2):(Oe.shouldSplit=Ke(Oe),Oe.shouldSplit||(Ne.min[2]=Ne.max[2]=Ne.center[2]=this._centerAltitude))},Ke=Oe=>{if(Oe.zoom<he)return!0;if(Oe.zoom===ze)return!1;if(Oe.shouldSplit!=null)return Oe.shouldSplit;const Ae=Oe.aabb.distanceX(ne),Ne=Oe.aabb.distanceY(ne);let Ye=Ze,tt=1;if(D){Ye=Ie(Oe.aabb.distanceZ(ne));const vt=Math.pow(2,Oe.zoom),gt=o.latFromMercatorY((Oe.y+1)/vt),Mt=o.latFromMercatorY(Oe.y/vt),nn=Math.min(Math.max(C,gt),Mt),It=o.circumferenceAtLatitude(nn)/o.circumferenceAtLatitude(C);if(tt=nn===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,It/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Oe.zoom===ze-1&&It>=.9)return!0}else if(x&&(Ye=Ie(Oe.aabb.distanceZ(ne)*Q)),this.projection.isReprojectedInTileSpace&&_<=5){const vt=Math.pow(2,Oe.zoom),gt=ye(new o.MercatorCoordinate((Oe.x+.5)/vt,(Oe.y+.5)/vt));tt=gt>.85?1:gt}const At=Ae*Ae+Ne*Ne+Ye,qt=Ie((1<<ze-Oe.zoom)*W*tt*((vt,gt)=>{if(gt*Ie(.707)<vt)return 1;const Mt=Math.sqrt(gt/vt);return Mt/(1.4144271570014144+(Math.pow(1.1,Mt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ye,Ze),At));return At<qt};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)Pe.push(Te(-Oe)),Pe.push(Te(Oe));for(Pe.push(Te(0));Pe.length>0;){const Oe=Pe.pop(),Ae=Oe.x,Ne=Oe.y;let Ye=Oe.fullyVisible;if(!Ye){const tt=Oe.aabb.intersects($);if(tt===0)continue;Ye=tt===2}if(Oe.zoom!==ze&&Ke(Oe))for(let tt=0;tt<4;tt++){const At=(Ae<<1)+tt%2,qt=(Ne<<1)+(tt>>1),vt={aabb:w?Oe.aabb.quadrant(tt):o.tileAABB(this,P,Oe.zoom+1,At,qt,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:At,y:qt,wrap:Oe.wrap,fullyVisible:Ye,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};x&&!D&&(vt.tileID=new o.OverscaledTileID(Oe.zoom+1===ze?st:Oe.zoom+1,Oe.wrap,Oe.zoom+1,At,qt),Ue(vt)),Pe.push(vt)}else{const tt=Oe.zoom===ze?st:Oe.zoom;if(c.minzoom&&c.minzoom>tt)continue;const At=O[0]-(.5+Ae+(Oe.wrap<<Oe.zoom))*(1<<d-Oe.zoom),qt=O[1]-.5-Ne,vt=Oe.tileID?Oe.tileID:new o.OverscaledTileID(tt,Oe.wrap,Oe.zoom,Ae,Ne);Le.push({tileID:vt,distanceSq:At*At+qt*qt})}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,Ae=this.horizonLineFromTop();Le=Le.filter(Ne=>{const Ye=[0,0,0,1],tt=[o.EXTENT,o.EXTENT,0,1],At=this.calculateFogTileMatrix(Ne.tileID.toUnwrapped());o.transformMat4$1(Ye,Ye,At),o.transformMat4$1(tt,tt,At);const qt=o.getAABBPointSquareDist(Ye,tt);if(qt===0)return!0;let vt=!1;const gt=this._elevation;if(gt&&qt>Oe&&Ae!==0){const Mt=this.calculateProjMatrix(Ne.tileID.toUnwrapped());let nn;c.isTerrainDEM||(nn=gt.getMinMaxForTile(Ne.tileID)),nn||(nn={min:pe,max:le});const It=o.furthestTileCorner(this.rotation),gn=[It[0]*o.EXTENT,It[1]*o.EXTENT,nn.max];o.transformMat4(gn,gn,Mt),vt=(1-gn[1])*this.height*.5<Ae}return qt<Oe||vt})}return Le.sort((Oe,Ae)=>Oe.distanceSq-Ae.distanceSq).map(Oe=>Oe.tileID)}resize(c,d){this.width=c,this.height=d,this.pixelsToGLUnits=[2/c,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const d=o.clamp(c.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),_=this.projection.project(c.lng,d);return new o.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,d){let _,x;const w=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;_=(d.x-w.x)/C,x=(d.y-w.y)/C}else{const C=this.pointCoordinate(d),P=this.pointCoordinate(w);_=C.x-P.x,x=C.y-P.y}const A=this.locationCoordinate(c);this.setLocation(new o.MercatorCoordinate(A.x-_,A.y-x))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,d){const _=d?o.mercatorZfromAltitude(d,c.lat):void 0,x=this.projection.project(c.lng,c.lat);return new o.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,d){const _=d??this._centerAltitude,x=[c.x,c.y,0,1],w=[c.x,c.y,1,1];o.transformMat4$1(x,x,this.pixelMatrixInverse),o.transformMat4$1(w,w,this.pixelMatrixInverse);const A=w[3];o.scale$1(x,x,1/x[3]),o.scale$1(w,w,1/A);const C=x[2],P=w[2];return{p0:x,p1:w,t:C===P?0:(_-C)/(P-C)}}screenPointToMercatorRay(c){const d=[c.x,c.y,0,1],_=[c.x,c.y,1,1];return o.transformMat4$1(d,d,this.pixelMatrixInverse),o.transformMat4$1(_,_,this.pixelMatrixInverse),o.scale$1(d,d,1/d[3]),o.scale$1(_,_,1/_[3]),d[2]=o.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,_[2]=o.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,o.scale$1(d,d,1/this.worldSize),o.scale$1(_,_,1/this.worldSize),new o.Ray([d[0],d[1],d[2]],o.normalize([],o.sub([],_,d)))}rayIntersectionCoordinate(c){const{p0:d,p1:_,t:x}=c,w=o.mercatorZfromAltitude(d[2],this._center.lat),A=o.mercatorZfromAltitude(_[2],this._center.lat);return new o.MercatorCoordinate(o.number(d[0],_[0],x)/this.worldSize,o.number(d[1],_[1],x)/this.worldSize,o.number(w,A,x))}pointCoordinate(c,d=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,d)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let d=this.projection.pointCoordinate3D(this,c.x,c.y);if(d)return new o.MercatorCoordinate(d[0],d[1],d[2]);let _=0,x=this.horizonLineFromTop();if(c.y>x)return this.pointCoordinate(c);const w=.02*x,A=c.clone();for(let C=0;C<10&&x-_>w;C++){A.y=o.number(_,x,.66);const P=this.projection.pointCoordinate3D(this,A.x,A.y);P?(x=A.y,d=P):_=A.y}return d?new o.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}_coordinatePoint(c,d){const _=d&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,x=[c.x*this.worldSize,c.y*this.worldSize,_+c.toAltitude(),1];return o.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new o.pointGeometry(x[0]/x[3],x[1]/x[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:d}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new o.pointGeometry(d,c)),A=this.pointLocation3D(new o.pointGeometry(x,c)),C=this.pointLocation3D(new o.pointGeometry(x,_)),P=this.pointLocation3D(new o.pointGeometry(d,_));let O=Math.min(w.lng,A.lng,C.lng,P.lng),D=Math.max(w.lng,A.lng,C.lng,P.lng),U=Math.min(w.lat,A.lat,C.lat,P.lat),$=Math.max(w.lat,A.lat,C.lat,P.lat);const ee=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,te=(ne,W,he,le,pe)=>{const xe=(ne+he)/2,ye=(W+le)/2,Te=new o.pointGeometry(xe,ye),{lng:Pe,lat:Le}=this.pointLocation3D(Te),ze=Math.max(0,O-Pe,U-Le,Pe-D,Le-$);O=Math.min(O,Pe),D=Math.max(D,Pe),U=Math.min(U,Le),$=Math.max($,Le),(pe<Q||ze>ee)&&(te(ne,W,xe,ye,pe+1),te(xe,ye,he,le,pe+1))};if(te(d,c,x,c,1),te(x,c,x,_,1),te(x,_,d,_,1),te(d,_,d,c,1),this.projection.name==="globe"){const[ne,W]=o.polesInViewport(this);ne?($=90,D=180,O=-180):W&&(U=-90,D=180,O=-180)}return new o.LngLatBounds(new o.LngLat(O,U),new o.LngLat(D,$))}_getBoundsRectangular(c,d){const{top:_,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,C=new o.pointGeometry(x,_),P=new o.pointGeometry(A,_),O=new o.pointGeometry(A,w),D=new o.pointGeometry(x,w);let U=this.pointCoordinate(C,c),$=this.pointCoordinate(P,c);const ee=this.pointCoordinate(O,d),Q=this.pointCoordinate(D,d),te=(ne,W)=>(W.y-ne.y)/(W.x-ne.x);return U.y>1&&$.y>=0?U=new o.MercatorCoordinate((1-Q.y)/te(Q,U)+Q.x,1):U.y<0&&$.y<=1&&(U=new o.MercatorCoordinate(-Q.y/te(Q,U)+Q.x,0)),$.y>1&&U.y>=0?$=new o.MercatorCoordinate((1-ee.y)/te(ee,$)+ee.x,1):$.y<0&&U.y<=1&&($=new o.MercatorCoordinate(-ee.y/te(ee,$)+ee.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(U)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(ee))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=c.visibleDemTiles.reduce((_,x)=>{if(x.dem){const w=x.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*c.exaggeration(),d.max*c.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return c?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,d){return this.projection.createTileMatrix(this,d,c)}calculateDistanceTileData(c){const d=c.key,_=this._distanceTileDataCache;if(_[d])return _[d];const x=c.canonical,w=1/this.height,A=this.cameraWorldSize,C=A/this.zoomScale(x.z),P=(x.x+Math.pow(2,x.z)*c.wrap)*C,O=x.y*C,D=this.point;D.x*=A/this.worldSize,D.y*=A/this.worldSize;const U=this.angle,$=Math.sin(-U),ee=-Math.cos(-U);return _[d]={bearing:[$,ee],center:[(D.x-P)*w,(D.y-O)*w],scale:C/o.EXTENT*w},_[d]}calculateFogTileMatrix(c){const d=c.key,_=this._fogTileMatrixCache;if(_[d])return _[d];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return o.multiply(x,this.worldToFogMatrix,x),_[d]=new Float32Array(x),_[d]}calculateProjMatrix(c,d=!1){const _=c.key,x=d?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];const w=this.calculatePosMatrix(c,this.worldSize);return o.multiply(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,w),x[_]=new Float32Array(w),x[_]}calculatePixelsToTileUnitsMatrix(c){const d=c.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];const x=function(w,A){const{scale:C}=w.tileTransform,P=C*o.EXTENT/(w.tileSize*Math.pow(2,A.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return O=new Float32Array(4),$=(D=A.inverseAdjustmentMatrix)[1],ee=D[2],Q=D[3],ne=(U=[P,P])[1],O[0]=D[0]*(te=U[0]),O[1]=$*te,O[2]=ee*ne,O[3]=Q*ne,O;var O,D,U,$,ee,Q,te,ne}(c,this);return _[d]=x,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const c=1/this.worldSize,d=o.fromScaling([],[c,c,c]);return o.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const c=this._elevation;this._updateCameraState();const d=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),x=this._camera.forward(),w=o.mercatorZfromAltitude(1,this._center.lat);_[2]/=w,x[2]/=w,o.normalize(x,x);const A=c.raycast(_,x,c.exaggeration());if(A){const C=o.scaleAndAdd([],_,x,A),P=new o.MercatorCoordinate(C[0],C[1],o.mercatorZfromAltitude(C[2],o.latFromMercatorY(C[1]))),O=(P.z+o.length([P.x-_[0],P.y-_[1],P.z-_[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const d=this._elevation,_=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),w=d.getAtPointOrZero(new o.MercatorCoordinate(...x)),A=this.pixelsPerMeter/this.worldSize*w,C=this._minimumHeightOverTerrain(),P=x[2]-A;if(P<=C)if(P<0||c){const O=this.locationCoordinate(this._center,this._centerAltitude),D=[x[0],x[1],O.z-x[2]],U=o.length(D);D[2]-=(C-P)/this._pixelsPerMercatorPixel;const $=o.length(D);if($===0)return;o.scale$2(D,D,U/$*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],O.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const $=this.center;return $.lat=o.clamp($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&($.lng=o.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const d=this._unmodified,{x:_,y:x}=this.point;let w=0,A=_,C=x;const P=this.width/2,O=this.height/2,D=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(x-O<D&&(C=D+O),x+O>U&&(C=U-O),U-D<this.height&&(w=Math.max(w,this.height/(U-D)),C=(U+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,Q=this.worldSize/2-($+ee)/2;A=(_+Q+this.worldSize)%this.worldSize-Q,A-P<$&&(A=$+P),A+P>ee&&(A=ee-P),ee-$<this.width&&(w=Math.max(w,this.width/(ee-$)),A=(ee+$)/2)}A===_&&C===x||(this.center=this.unproject(new o.pointGeometry(A,C))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const _=qa(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?d:1,w=this._camera.getWorldToCamera(this.worldSize,x),A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);A[8]=2*-c.x/this.width,A[9]=2*c.y/this.height;let C=o.mul([],A,w);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),Te=o.identity([]);o.translate(Te,Te,[ye.x*this.worldSize,ye.y*this.worldSize,0]),o.multiply(Te,Te,Nl(this)),o.translate(Te,Te,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),o.multiply(C,C,Te),this.inverseAdjustmentMatrix=function(Pe){const Le=Nl(Pe,!0);return rt([],[Le[0],Le[1],Le[4],Le[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],C,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=C,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const P=o.invert([],A);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const O=new Float32Array(16);o.identity(O),o.scale(O,O,[1,-1,1]),o.rotateX(O,O,this._pitch),o.rotateZ(O,O,this.angle);const D=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;D[8]=2*-c.x/this.width,D[9]=2*(c.y+U)/this.height,this.skyboxMatrix=o.multiply(O,D,O);const $=this.point,ee=$.x,Q=$.y,te=this.width%2/2,ne=this.height%2/2,W=Math.cos(this.angle),he=Math.sin(this.angle),le=ee-Math.round(ee)+W*te+he*ne,pe=Q-Math.round(Q)+W*ne+he*te,xe=new Float64Array(C);if(o.translate(xe,xe,[le>.5?le-1:le,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=xe,C=o.create(),o.scale(C,C,[this.width/2,-this.height/2,1]),o.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=o.create(),o.scale(C,C,[1,-1,1]),o.translate(C,C,[-1,-1,0]),o.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},C=o.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=C,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(ye,ye,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=C;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[c,c,d];o.scale$2(w,w,x),o.scale$2(_,_,-1),o.multiply$2(_,_,w);const A=o.create();o.translate(A,A,_),o.scale(A,A,w),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,d,x)}_computeCameraPosition(c){const d=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-c/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*w,x.y/this.worldSize-_[1]*w,c/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=c[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((d-_)/x,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,c,w),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),w=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),C=Math.max((c[2]-w)/Math.cos(_),A),P=this._zoomFromMercatorZ(C);o.scaleAndAdd(c,c,d,C),this._pitch=o.clamp(_,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(x,-Math.PI,Math.PI),this._setZoom(o.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let d=0,_=o.GLOBE_ZOOM_THRESHOLD_MAX,x=0,w=1/0;for(;_-d>1e-6&&_>d;){const A=d+.5*(_-d),C=this.tileSize*Math.pow(2,A),P=this.getCameraToCenterDistance(this.projection,A,C),O=this.scaleZoom(P/(c*this.tileSize)),D=Math.abs(A-O);D<w&&(w=D,x=A),A<O?d=A:_=A}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,d){const _=Math.min(c.x,d.x),x=Math.max(c.x,d.x),w=Math.min(c.y,d.y),A=Math.max(c.y,d.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new o.pointGeometry(_,w),new o.pointGeometry(x,A),new o.pointGeometry(_,A),new o.pointGeometry(x,w)],P=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const D of C){const U=this.pointRayIntersection(D);if(U.t<0)return!0;const $=this.rayIntersectionCoordinate(U);if($.x<P||$.y<0||$.x>O||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(c,d){const _=o.length(o.sub([],this._camera.position,c)),x=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const c=function([d,_,x],w){const A=[d,_,x,1];o.transformMat4$1(A,A,w);const C=A[3]=Math.max(A[3],1e-6);return A[0]/=C,A[1]/=C,A[2]/=C,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,c))}}getCameraToCenterDistance(c,d=this.zoom,_=this.worldSize){const x=qa(c,d,this.width,this.height,1024),w=c.pixelSpaceConversion(this.center.lat,_,x);return .5/Math.tan(.5*this._fov)*this.height*w}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(c,c,this.globeMatrix),c}}function cs(m,c){let d=!1,_=null;const x=()=>{_=null,d&&(m(),_=setTimeout(x,c),d=!1)};return()=>(d=!0,_||x(),_)}class F_{constructor(c){this._hashName=c&&encodeURIComponent(c),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=cs(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,o.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const d=yp(c);if(this._hashName){const _=this._hashName;let x=!1;const w=o.window.location.hash.slice(1).split("&").map(A=>{const C=A.split("=")[0];return C===_?(x=!0,`${C}=${d}`):A}).filter(A=>A);return x||w.push(`${_}=${d}`),`#${w.join("&")}`}return`#${d}`}_getCurrentHash(){const c=o.window.location.hash.replace("#","");if(this._hashName){let d;return c.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(d[3]||0):c.getBearing();return c.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,c)}}function yp(m,c){const d=m.getCenter(),_=Math.round(100*m.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),A=Math.round(d.lng*w)/w,C=Math.round(d.lat*w)/w,P=m.getBearing(),O=m.getPitch();let D=c?`/${A}/${C}/${_}`:`${_}/${C}/${A}`;return(P||O)&&(D+="/"+Math.round(10*P)/10),O&&(D+=`/${Math.round(O)}`),D}const du={linearity:.3,easing:o.bezier(0,0,.3,1)},Bl=o.extend({deceleration:2500,maxSpeed:1400},du),N_=o.extend({deceleration:20,maxSpeed:1400},du),jh=o.extend({deceleration:1e3,maxSpeed:360},du),vp=o.extend({deceleration:1e3,maxSpeed:90},du);class Gh{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,d=o.exported.now();for(;c.length>0&&d-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(d.pan.mag()){const w=pu(d.pan.mag(),_,o.extend({},Bl,c||{}));x.offset=d.pan.mult(w.amount/d.pan.mag()),x.center=this._map.transform.center,fu(x,w)}if(d.zoom){const w=pu(d.zoom,_,N_);x.zoom=this._map.transform.zoom+w.amount,fu(x,w)}if(d.bearing){const w=pu(d.bearing,_,jh);x.bearing=this._map.transform.bearing+o.clamp(w.amount,-179,179),fu(x,w)}if(d.pitch){const w=pu(d.pitch,_,vp);x.pitch=this._map.transform.pitch+w.amount,fu(x,w)}if(x.zoom||x.bearing){const w=d.pinchAround===void 0?d.around:d.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function fu(m,c){(!m.duration||m.duration<c.duration)&&(m.duration=c.duration,m.easing=c.easing)}function pu(m,c,d){const{maxSpeed:_,linearity:x,deceleration:w}=d,A=o.clamp(m*x/(c/1e3),-_,_),C=Math.abs(A)/(w*x);return{easing:d.easing,duration:1e3*C,amount:A*(C/2)}}class jr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,_,x={}){const w=ue(d.getCanvasContainer(),_),A=d.unproject(w);super(c,o.extend({point:w,lngLat:A,originalEvent:_},x)),this._defaultPrevented=!1,this.target=d}}class Wh extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,_){const x=c==="touchend"?_.changedTouches:_.touches,w=Fe(d.getCanvasContainer(),x),A=w.map(P=>d.unproject(P)),C=w.reduce((P,O,D,U)=>P.add(O.div(U.length)),new o.pointGeometry(0,0));super(c,{points:w,point:C,lngLats:A,lngLat:d.unproject(C),originalEvent:_}),this._defaultPrevented=!1}}class Qx extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,_){super(c,{originalEvent:_}),this._defaultPrevented=!1}}class B_{constructor(c,d){this._map=c,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Qx(c.type,this._map,c))}mousedown(c,d){return this._mousedownPos=d,this._firePreventable(new jr(c.type,this._map,c))}mouseup(c){this._map.fire(new jr(c.type,this._map,c))}preclick(c){const d=o.extend({},c);d.type="preclick",this._map.fire(new jr(d.type,this._map,d))}click(c,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(c),this._map.fire(new jr(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new jr(c.type,this._map,c))}mouseover(c){this._map.fire(new jr(c.type,this._map,c))}mouseout(c){this._map.fire(new jr(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Wh(c.type,this._map,c))}touchmove(c){this._map.fire(new Wh(c.type,this._map,c))}touchend(c){this._map.fire(new Wh(c.type,this._map,c))}touchcancel(c){this._map.fire(new Wh(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $h{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new jr(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new jr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new jr(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xp{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,d){this.isEnabled()&&c.shiftKey&&c.button===0&&(q(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(c,d){if(!this._active)return;const _=d,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=F("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const A=Math.min(x.x,_.x),C=Math.max(x.x,_.x),P=Math.min(x.y,_.y),O=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${P}px)`,this._box.style.width=C-A+"px",this._box.style.height=O-P+"px")})}mouseupWindow(c,d){if(!this._active)return;const _=this._startPos,x=d;if(_&&c.button===0){if(this.reset(),Ee(),_.x!==x.x||_.y!==x.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:w=>w.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),H(),delete this._startPos,delete this._lastPos}_fireEvent(c,d){return this._map.fire(new o.Event(c,{originalEvent:d}))}}function Hh(m,c){const d={};for(let _=0;_<m.length;_++)d[m[_].identifier]=c[_];return d}class U_{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=c.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const w=new o.pointGeometry(0,0);for(const A of x)w._add(A);return w.div(x.length)}(d),this.touches=Hh(_,d)))}touchmove(c,d,_){if(this.aborted||!this.centroid)return;const x=Hh(_,d);for(const w in this.touches){const A=this.touches[w],C=x[w];(!C||C.dist(A)>30)&&(this.aborted=!0)}}touchend(c,d,_){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Ul{constructor(c){this.singleTap=new U_(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,d,_){this.singleTap.touchstart(c,d,_)}touchmove(c,d,_){this.singleTap.touchmove(c,d,_)}touchend(c,d,_){const x=this.singleTap.touchend(c,d,_);if(x){const w=c.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(x)<30;if(w&&A||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class bp{constructor(){this._zoomIn=new Ul({numTouches:1,numTaps:2}),this._zoomOut=new Ul({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,d,_){this._zoomIn.touchstart(c,d,_),this._zoomOut.touchstart(c,d,_)}touchmove(c,d,_){this._zoomIn.touchmove(c,d,_),this._zoomOut.touchmove(c,d,_)}touchend(c,d,_){const x=this._zoomIn.touchend(c,d,_),w=this._zoomOut.touchend(c,d,_);return x?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(x)},{originalEvent:c})}):w?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(w)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const V_={0:1,2:2};class Zh{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,d){return!1}_move(c,d){return{}}mousedown(c,d){if(this._lastPoint)return;const _=Qe(c);this._correctButton(c,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(c,d){const _=this._lastPoint;if(_){if(c.preventDefault(),this._eventButton!=null&&function(x,w){const A=V_[w];return x.buttons===void 0||(x.buttons&A)!==A}(c,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}}mouseupWindow(c){this._lastPoint&&Qe(c)===this._eventButton&&(this._moved&&Ee(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class j_ extends Zh{mousedown(c,d){super.mousedown(c,d),this._lastPoint&&(this._active=!0)}_correctButton(c,d){return d===0&&!c.ctrlKey}_move(c,d){return{around:d,panDelta:d.sub(c)}}}class wp extends Zh{_correctButton(c,d){return d===0&&c.ctrlKey||d===2}_move(c,d){const _=.8*(d.x-c.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(c){c.preventDefault()}}class Ep extends Zh{_correctButton(c,d){return d===0&&c.ctrlKey||d===2}_move(c,d){const _=-.5*(d.y-c.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(c){c.preventDefault()}}class Vl{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(c,d,_){return this._calculateTransform(c,d,_)}touchmove(c,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,d,_)}}touchend(c,d,_){this._calculateTransform(c,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,d,_){_.length>0&&(this._active=!0);const x=Hh(_,d),w=new o.pointGeometry(0,0),A=new o.pointGeometry(0,0);let C=0;for(const O in x){const D=x[O],U=this._touches[O];U&&(w._add(D),A._add(D.sub(U)),C++,x[O]=D)}if(this._touches=x,C<this._minTouches||!A.mag())return;const P=A.div(C);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(C),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class qh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,d,_){return{}}touchstart(c,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(c,d,_){const x=this._firstTwoTouches;if(!x)return;c.preventDefault();const[w,A]=x,C=mu(_,d,w),P=mu(_,d,A);if(!C||!P)return;const O=this._aroundCenter?null:C.add(P).div(2);return this._move([C,P],O,c)}touchend(c,d,_){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,A=mu(_,d,x),C=mu(_,d,w);A&&C||(this._active&&Ee(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function mu(m,c,d){for(let _=0;_<m.length;_++)if(m[_].identifier===d)return c[_]}function G_(m,c){return Math.log(m/c)/Math.LN2}class W_ extends qh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,d){const _=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(G_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:G_(this._distance,_),pinchAround:d}}}function Tp(m,c){return 180*m.angleWith(c)/Math.PI}class $_ extends qh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,d){const _=this._vector;if(this._vector=c[0].sub(c[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Tp(this._vector,_),pinchAround:d}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const d=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const x=Tp(c,_);return Math.abs(x)<d}}function Xh(m){return Math.abs(m.y)>Math.abs(m.x)}class li extends qh{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,Xh(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,d,_){const x=this._lastPoints;if(!x)return;const w=c[0].sub(x[0]),A=c[1].sub(x[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,A,_.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+A.y)/2*-.5})}gestureBeginsVertically(c,d,_){if(this._valid!==void 0)return this._valid;const x=c.mag()>=2,w=d.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const A=c.y>0==d.y>0;return Xh(c)&&Xh(d)&&A}}const e1={panStep:100,bearingStep:15,pitchStep:10};class H_{constructor(){const c=e1;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let d=0,_=0,x=0,w=0,A=0;switch(c.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:c.shiftKey?_=-1:(c.preventDefault(),w=-1);break;case 39:c.shiftKey?_=1:(c.preventDefault(),w=1);break;case 38:c.shiftKey?x=1:(c.preventDefault(),A=-1);break;case 40:c.shiftKey?x=-1:(c.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:C=>{const P=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:t1,zoom:d?Math.round(P)+d*(c.shiftKey?2:1):P,bearing:C.getBearing()+_*this._bearingStep,pitch:C.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-A*this._panStep],center:C.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function t1(m){return m*(2-m)}const Z_=4.000244140625;class Mo{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=c.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const _=o.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%Z_==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(x*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),c.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=c,this._delta-=d,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=ue(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;this._type==="wheel"&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Z_?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&O!==0&&(O=1/O);const D=d(),U=Math.pow(2,D),$=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom($*O))),this._type==="wheel"&&(this._startZoom=D,this._easing=this._smoothOutEasing(200)),this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:d(),x=this._startZoom,w=this._easing;let A,C=!1;if(this._type==="wheel"&&x&&w){const P=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),O=w(P);A=o.number(x,_,O),P<1?this._frameId||(this._frameId=!0):C=!0}else A=_,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:A-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let d=o.ease;if(this._prevEase){const _=this._prevEase,x=(o.exported.now()-_.start)/_.duration,w=_.easing(x+.01)-_.easing(x),A=.27/Math.sqrt(w*w+1e-4)*.01,C=Math.sqrt(.0729-A*A);d=o.bezier(A,C,.25,1)}return this._prevEase={start:o.exported.now(),duration:c,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class q_{constructor(c,d){this._clickZoom=c,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,d){return c.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(c.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ks{constructor(){this._tap=new Ul({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,d,_){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(c,d,_))}touchmove(c,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=d[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,c.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(c,d,_)}touchend(c,d,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(c,d,_)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yh{constructor(c,d,_){this._el=c,this._mousePan=d,this._touchPan=_}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class yt{constructor(c,d,_){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class X_{constructor(c,d,_,x){this._el=c,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gu=m=>m.zoom||m.drag||m.pitch||m.rotate;class _u extends o.Event{}class yu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,d){const _=o.sub([],d,c);this.radius=o.length(_[2]<0?o.div([],_,this.constants):[_[0],_[1],0])}projectRay(c){o.div(c,c,this.constants),o.normalize(c,c),o.mul$1(c,c,this.constants);const d=o.scale$2([],c,this.radius);if(d[2]>0){const _=o.scale$2([],[0,0,1],o.dot(d,[0,0,1])),x=o.scale$2([],o.normalize([],[d[0],d[1],0]),this.radius),w=o.add([],d,o.scale$2([],o.sub([],o.add([],x,_),d),2));d[0]=w[0],d[1]=w[1]}return d}}function vu(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Y_{constructor(c,d){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Gh(c),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new yu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),o.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[x,w,A]of this._listeners)x.addEventListener(w,x===o.window.document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[c,d,_]of this._listeners)c.removeEventListener(d,c===o.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(c){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new B_(d,c));const x=d.boxZoom=new xp(d,c);this._add("boxZoom",x);const w=new bp,A=new jl;d.doubleClickZoom=new q_(A,w),this._add("tapZoom",w),this._add("clickZoom",A);const C=new Ks;this._add("tapDragZoom",C);const P=d.touchPitch=new li(d);this._add("touchPitch",P);const O=new wp(c),D=new Ep(c);d.dragRotate=new yt(c,O,D),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const U=new j_(c),$=new Vl(d,c);d.dragPan=new Yh(_,U,$),this._add("mousePan",U),this._add("touchPan",$,["touchZoom","touchRotate"]);const ee=new $_,Q=new W_;d.touchZoomRotate=new X_(_,Q,ee,C),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new $h(d));const te=d.scrollZoom=new Mo(d,this);this._add("scrollZoom",te,["mousePan"]);const ne=d.keyboard=new H_;this._add("keyboard",ne);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[W]&&d[W].enable(c[W])}_add(c,d,_){this._handlers.push({handlerName:c,handler:d,allowed:_}),this._handlersById[c]=d}stop(c){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,d,_){for(const x in c)if(x!==_&&(!d||d.indexOf(x)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const d=[];for(const _ of c)this._el.contains(_.target)&&d.push(_);return d}handleEvent(c,d){this._updatingCamera=!0;const _=c.type==="renderFrame",x=_?void 0:c,w={needsRenderFrame:!1},A={},C={},P=c.touches?this._getMapTouches(c.touches):void 0,O=P?Fe(this._el,P):_?void 0:ue(this._el,c);for(const{handlerName:$,handler:ee,allowed:Q}of this._handlers){if(!ee.isEnabled())continue;let te;this._blockedByActive(C,Q,$)?ee.reset():ee[d||c.type]&&(te=ee[d||c.type](c,O,P),this.mergeHandlerResult(w,A,te,$,x),te&&te.needsRenderFrame&&this._triggerRenderFrame()),(te||ee.isActive())&&(C[$]=ee)}const D={};for(const $ in this._previousActiveHandlers)C[$]||(D[$]=x);this._previousActiveHandlers=C,(Object.keys(D).length||vu(w))&&(this._changes.push([w,A,D]),this._triggerRenderFrame()),(Object.keys(C).length||vu(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=w;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(c,d,_,x,w){if(!_)return;o.extend(c,_);const A={handlerName:x,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(d.zoom=A),_.panDelta!==void 0&&(d.drag=A),_.pitchDelta!==void 0&&(d.pitch=A),_.bearingDelta!==void 0&&(d.rotate=A)}_applyChanges(){const c={},d={},_={};for(const[x,w,A]of this._changes)x.panDelta&&(c.panDelta=(c.panDelta||new o.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(c.around=x.around),x.aroundCoord!==void 0&&(c.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(c.pinchAround=x.pinchAround),x.noInertia&&(c.noInertia=x.noInertia),o.extend(d,w),o.extend(_,A);this._updateMapTransform(c,d,_),this._changes=[]}_updateMapTransform(c,d,_){const x=this._map,w=x.transform,A=he=>[he.x,he.y,he.z];if((he=>{const le=this._eventsInProgress.drag;return le&&!this._handlersById[le.handlerName].isActive()})()&&!vu(c)){const he=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",he!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!vu(c))return void this._fireEvents(d,_,!0);let{panDelta:C,zoomDelta:P,bearingDelta:O,pitchDelta:D,around:U,aroundCoord:$,pinchAround:ee}=c;w._isCameraConstrained&&(P>0&&(P=0),w._isCameraConstrained=!1),ee!==void 0&&(U=ee),(P||(he=>d.drag&&!this._eventsInProgress.drag)())&&U&&(this._dragOrigin=A(w.pointCoordinate3D(U)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),U=U||x.transform.centerPoint,O&&(w.bearing+=O),D&&(w.pitch+=D),w._updateCameraState();const Q=[0,0,0];if(C)if(w.projection.name==="mercator"){const he=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(U).dir),le=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(U.sub(C)).dir);Q[0]=le[0]-he[0],Q[1]=le[1]-he[1]}else{const he=w.pointCoordinate(U);if(w.projection.name==="globe"){C=C.rotate(-w.angle);const le=w._pixelsPerMercatorPixel/w.worldSize;Q[0]=-C.x*o.mercatorScale(o.latFromMercatorY(he.y))*le,Q[1]=-C.y*o.mercatorScale(w.center.lat)*le}else{const le=w.pointCoordinate(U.sub(C));he&&le&&(Q[0]=le.x-he.x,Q[1]=le.y-he.y)}}const te=w.zoom,ne=[0,0,0];if(P){const he=A($||w.pointCoordinate3D(U)),le={dir:o.normalize([],o.sub([],he,w._camera.position))};if(le.dir[2]<0){const pe=w.zoomDeltaToMovement(he,P);o.scale$2(ne,le.dir,pe)}}const W=o.add(Q,Q,ne);w._translateCameraConstrained(W),P&&Math.abs(w.zoom-te)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(d,_,!0)}_fireEvents(c,d,_){const x=gu(this._eventsInProgress),w=gu(c),A={};for(const D in c){const{originalEvent:U}=c[D];this._eventsInProgress[D]||(A[`${D}start`]=U),this._eventsInProgress[D]=c[D]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const D in A)this._fireEvent(D,A[D]);w&&this._fireEvent("move",w.originalEvent);for(const D in c){const{originalEvent:U}=c[D];this._fireEvent(D,U)}const C={};let P;for(const D in this._eventsInProgress){const{handlerName:U,originalEvent:$}=this._eventsInProgress[D];this._handlersById[U].isActive()||(delete this._eventsInProgress[D],P=d[U]||$,C[`${D}end`]=P)}for(const D in C)this._fireEvent(D,C[D]);const O=gu(this._eventsInProgress);if(_&&(x||w)&&!O){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;D?(U(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:P})):(this._map.fire(new o.Event("moveend",{originalEvent:P})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,d){this._map.fire(new o.Event(c,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new _u("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Sp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class K_ extends o.Evented{constructor(c,d){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,d){return this.jumpTo({center:c},d)}panBy(c,d,_){return c=o.pointGeometry.convert(c).mult(-1),this.panTo(this.transform.center,o.extend({offset:c},d),_)}panTo(c,d,_){return this.easeTo(o.extend({center:c},d),_)}getZoom(){return this.transform.zoom}setZoom(c,d){return this.jumpTo({zoom:c},d),this}zoomTo(c,d,_){return this.easeTo(o.extend({zoom:c},d),_)}zoomIn(c,d){return this.zoomTo(this.getZoom()+1,c,d),this}zoomOut(c,d){return this.zoomTo(this.getZoom()-1,c,d),this}getBearing(){return this.transform.bearing}setBearing(c,d){return this.jumpTo({bearing:c},d),this}getPadding(){return this.transform.padding}setPadding(c,d){return this.jumpTo({padding:c},d),this}rotateTo(c,d,_){return this.easeTo(o.extend({bearing:c},d),_)}resetNorth(c,d){return this.rotateTo(0,o.extend({duration:1e3},c),d),this}resetNorthPitch(c,d){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},c),d),this}snapToNorth(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this}getPitch(){return this.transform.pitch}setPitch(c,d){return this.jumpTo({pitch:c},d),this}cameraForBounds(c,d){c=o.LngLatBounds.convert(c);const _=d&&d.bearing||0,x=d&&d.pitch||0,w=c.getNorthWest(),A=c.getSouthEast();return this._cameraForBounds(this.transform,w,A,_,x,d)}_extendCameraOptions(c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=o.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const _=c.padding;c.padding={top:_,bottom:_,right:_,left:_}}return c.padding=o.extend(d,c.padding),c}_minimumAABBFrustumDistance(c,d){const _=d.max[0]-d.min[0],x=d.max[1]-d.min[1];return _/x>c.aspect?_/(2*Math.tan(.5*c.fovX)*c.aspect):x/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,d,_,x,w,A){const C=c.clone(),P=this._extendCameraOptions(A);C.bearing=x,C.pitch=w;const O=o.LngLat.convert(d),D=o.LngLat.convert(_),U=.5*(O.lat+D.lat),$=.5*(O.lng+D.lng),ee=o.latLngToECEF(U,$),Q=o.normalize([],ee),te=o.normalize([],o.cross([],Q,[0,1,0])),ne=o.cross([],te,Q),W=[te[0],te[1],te[2],0,ne[0],ne[1],ne[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],he=[ee,o.latLngToECEF(O.lat,O.lng),o.latLngToECEF(D.lat,O.lng),o.latLngToECEF(D.lat,D.lng),o.latLngToECEF(O.lat,D.lng),o.latLngToECEF(U,O.lng),o.latLngToECEF(U,D.lng),o.latLngToECEF(O.lat,$),o.latLngToECEF(D.lat,$)];let le=o.Aabb.fromPoints(he.map(Ye=>[o.dot(te,Ye),o.dot(ne,Ye),o.dot(Q,Ye)]));const pe=o.transformMat4([],le.center,W);o.squaredLength(pe)===0&&o.set(pe,0,0,1),o.normalize(pe,pe),o.scale$2(pe,pe,o.GLOBE_RADIUS),C.center=o.ecefToLatLng(pe);const xe=C.getWorldToCameraMatrix(),ye=o.invert(new Float64Array(16),xe);le=o.Aabb.applyTransform(le,o.multiply([],xe,W)),o.transformMat4(pe,pe,xe);const Te=.5*(le.max[2]-le.min[2]),Pe=this._minimumAABBFrustumDistance(C,le),Le=o.scale$2([],[0,0,1],Te),ze=o.add(Le,pe,Le),st=Pe+(C.pitch===0?0:o.distance(pe,ze)),Ie=C.globeCenterInViewSpace,Ze=o.sub([],pe,[Ie[0],Ie[1],Ie[2]]);o.normalize(Ze,Ze),o.scale$2(Ze,Ze,st);const Ue=o.add([],pe,Ze);o.transformMat4(Ue,Ue,ye);const Ke=o.earthRadius/o.GLOBE_RADIUS,Oe=o.length(Ue),Ae=o.mercatorZfromAltitude(Math.max(Oe*Ke-o.earthRadius,Number.EPSILON),0),Ne=Math.min(C.zoomFromMercatorZAdjusted(Ae),P.maxZoom);return Ne>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"mercator"}),C.zoom=Ne,this._cameraForBounds(C,d,_,x,w,A)):{center:C.center,zoom:Ne,bearing:x,pitch:w}}queryTerrainElevation(c,d){const _=this.transform.elevation;return _?(d=o.extend({},{exaggerated:!0},d),_.getAtPoint(o.MercatorCoordinate.fromLngLat(c),null,d.exaggerated)):null}_cameraForBounds(c,d,_,x,w,A){if(c.projection.name==="globe")return this._cameraForBoundsOnGlobe(c,d,_,x,w,A);const C=c.clone(),P=this._extendCameraOptions(A),O=C.padding;C.bearing=x,C.pitch=w;const D=o.LngLat.convert(d),U=o.LngLat.convert(_),$=new o.LngLat(D.lng,U.lat),ee=new o.LngLat(U.lng,D.lat),Q=C.project(D),te=C.project(U),ne=this.queryTerrainElevation(D),W=this.queryTerrainElevation(U),he=this.queryTerrainElevation($),le=this.queryTerrainElevation(ee),pe=[[Q.x,Q.y,Math.min(ne||0,W||0,he||0,le||0)],[te.x,te.y,Math.max(ne||0,W||0,he||0,le||0)]];let xe=o.Aabb.fromPoints(pe);const ye=C.getWorldToCameraMatrix(),Te=o.invert(new Float64Array(16),ye);xe=o.Aabb.applyTransform(xe,ye);const Pe=o.sub([],xe.max,xe.min),Le=O.left||0,ze=O.right||0,st=O.bottom||0,Ie=O.top||0,{left:Ze,right:Ue,top:Ke,bottom:Oe}=P.padding,Ae=.5*(Le+ze),Ne=.5*(Ie+st),Ye=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(Le+ze+Ze+Ue))/Pe[0],(C.height-(st+Ie+Oe+Ke))/Pe[1])),P.maxZoom),tt=C.scale/C.zoomScale(Ye);xe=new o.Aabb([xe.min[0]-(Ze+Ae)*tt,xe.min[1]-(Oe+Ne)*tt,xe.min[2]],[xe.max[0]+(Ue+Ae)*tt,xe.max[1]+(Ke+Ne)*tt,xe.max[2]]);const At=.5*Pe[2],qt=this._minimumAABBFrustumDistance(C,xe),vt=[0,0,1,0];o.transformMat4$1(vt,vt,ye),o.normalize$2(vt,vt);const gt=o.scale$2([],vt,qt+At),Mt=o.add([],xe.center,gt),nn=(typeof P.offset.x=="number"&&typeof P.offset.y=="number"?new o.pointGeometry(P.offset.x,P.offset.y):o.pointGeometry.convert(P.offset)).rotate(-o.degToRad(x));xe.center[0]-=nn.x*tt,xe.center[1]+=nn.y*tt,o.transformMat4(xe.center,xe.center,Te),o.transformMat4(Mt,Mt,Te);const It=[xe.center[0],xe.center[1],Mt[2]*C.pixelsPerMeter];o.scale$2(It,It,1/C.worldSize);const gn=o.lngFromMercatorX(It[0]),In=o.latFromMercatorY(It[1]),jn=Math.min(C._zoomFromMercatorZ(It[2]),P.maxZoom),Nn=new o.LngLat(gn,In);return C.mercatorFromTransition&&jn<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"globe"}),C.zoom=jn,this._cameraForBounds(C,d,_,x,w,A)):{center:Nn,zoom:jn,bearing:x,pitch:w}}fitBounds(c,d,_){const x=this.cameraForBounds(c,d);return this._fitInternal(x,d,_)}fitScreenCoordinates(c,d,_,x,w){const A=o.pointGeometry.convert(c),C=o.pointGeometry.convert(d),P=new o.pointGeometry(Math.min(A.x,C.x),Math.min(A.y,C.y)),O=new o.pointGeometry(Math.max(A.x,C.x),Math.max(A.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,C))return this;const D=this.transform.pointLocation3D(P),U=this.transform.pointLocation3D(O),$=this.transform.pointLocation3D(new o.pointGeometry(P.x,O.y)),ee=this.transform.pointLocation3D(new o.pointGeometry(O.x,P.y)),Q=[Math.min(D.lng,U.lng,$.lng,ee.lng),Math.min(D.lat,U.lat,$.lat,ee.lat)],te=[Math.max(D.lng,U.lng,$.lng,ee.lng),Math.max(D.lat,U.lat,$.lat,ee.lat)],ne=x&&x.pitch?x.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,Q,te,_,ne,x);return this._fitInternal(W,x,w)}_fitInternal(c,d,_){return c?(delete(d=o.extend(c,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(c,d){this.stop();const _=c.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,A=!1;return"zoom"in c&&_.zoom!==+c.zoom&&(x=!0,_.zoom=+c.zoom),c.center!==void 0&&(_.center=o.LngLat.convert(c.center)),"bearing"in c&&_.bearing!==+c.bearing&&(w=!0,_.bearing=+c.bearing),"pitch"in c&&_.pitch!==+c.pitch&&(A=!0,_.pitch=+c.pitch),c.padding==null||_.isPaddingEqual(c.padding)||(_.padding=c.padding),c.preloadOnly?(this._preloadTiles(_),this):(this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d)),x&&this.fire(new o.Event("zoomstart",d)).fire(new o.Event("zoom",d)).fire(new o.Event("zoomend",d)),w&&this.fire(new o.Event("rotatestart",d)).fire(new o.Event("rotate",d)).fire(new o.Event("rotateend",d)),A&&this.fire(new o.Event("pitchstart",d)).fire(new o.Event("pitch",d)).fire(new o.Event("pitchend",d)),this.fire(new o.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Sp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,d){const _=this.transform;if(!_.projection.supportsFreeCamera)return o.warnOnce(Sp),this;this.stop();const x=_.zoom,w=_.pitch,A=_.bearing;_.setFreeCameraOptions(c);const C=x!==_.zoom,P=w!==_.pitch,O=A!==_.bearing;return this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d)),C&&this.fire(new o.Event("zoomstart",d)).fire(new o.Event("zoom",d)).fire(new o.Event("zoomend",d)),O&&this.fire(new o.Event("rotatestart",d)).fire(new o.Event("rotate",d)).fire(new o.Event("rotateend",d)),P&&this.fire(new o.Event("pitchstart",d)).fire(new o.Event("pitch",d)).fire(new o.Event("pitchend",d)),this.fire(new o.Event("moveend",d)),this}easeTo(c,d){this._stop(!1,c.easeId),((c=o.extend({offset:[0,0],duration:500,easing:o.ease},c)).animate===!1||!c.essential&&o.exported.prefersReducedMotion)&&(c.duration=0);const _=this.transform,x=this.getZoom(),w=this.getBearing(),A=this.getPitch(),C=this.getPadding(),P="zoom"in c?+c.zoom:x,O="bearing"in c?this._normalizeBearing(c.bearing,w):w,D="pitch"in c?+c.pitch:A,U="padding"in c?c.padding:_.padding,$=o.pointGeometry.convert(c.offset);let ee,Q,te;if(_.projection.name==="globe"){const Le=o.MercatorCoordinate.fromLngLat(_.center),ze=$.rotate(-_.angle);Le.x+=ze.x/_.worldSize,Le.y+=ze.y/_.worldSize;const st=Le.toLngLat(),Ie=o.LngLat.convert(c.center||st);this._normalizeCenter(Ie),ee=_.centerPoint.add(ze),Q=new o.pointGeometry(Le.x,Le.y).mult(_.worldSize),te=new o.pointGeometry(o.mercatorXfromLng(Ie.lng),o.mercatorYfromLat(Ie.lat)).mult(_.worldSize).sub(Q)}else{ee=_.centerPoint.add($);const Le=_.pointLocation(ee),ze=o.LngLat.convert(c.center||Le);this._normalizeCenter(ze),Q=_.project(Le),te=_.project(ze).sub(Q)}const ne=_.zoomScale(P-x);let W,he;c.around&&(W=o.LngLat.convert(c.around),he=_.locationPoint(W));const le=this._zooming||P!==x,pe=this._rotating||w!==O,xe=this._pitching||D!==A,ye=!_.isPaddingEqual(U),Te=Le=>ze=>{if(le&&(Le.zoom=o.number(x,P,ze)),pe&&(Le.bearing=o.number(w,O,ze)),xe&&(Le.pitch=o.number(A,D,ze)),ye&&(Le.interpolatePadding(C,U,ze),ee=Le.centerPoint.add($)),W)Le.setLocationAtPoint(W,he);else{const st=Le.zoomScale(Le.zoom-x),Ie=P>x?Math.min(2,ne):Math.max(.5,ne),Ze=Math.pow(Ie,1-ze),Ue=Le.unproject(Q.add(te.mult(ze*Ze)).mult(st));Le.setLocationAtPoint(Le.renderWorldCopies?Ue.wrap():Ue,ee)}return c.preloadOnly||this._fireMoveEvents(d),Le};if(c.preloadOnly){const Le=this._emulate(Te,c.duration,_);return this._preloadTiles(Le),this}const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=le,this._rotating=pe,this._pitching=xe,this._padding=ye,this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,Pe),this._ease(Te(_),Le=>{_.recenterOnTerrain(),this._afterEase(d,Le)},c),this}_prepareEase(c,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||_.moving||this.fire(new o.Event("movestart",c)),this._zooming&&!_.zooming&&this.fire(new o.Event("zoomstart",c)),this._rotating&&!_.rotating&&this.fire(new o.Event("rotatestart",c)),this._pitching&&!_.pitching&&this.fire(new o.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new o.Event("move",c)),this._zooming&&this.fire(new o.Event("zoom",c)),this._rotating&&this.fire(new o.Event("rotate",c)),this._pitching&&this.fire(new o.Event("pitch",c))}_afterEase(c,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new o.Event("zoomend",c)),x&&this.fire(new o.Event("rotateend",c)),w&&this.fire(new o.Event("pitchend",c)),this.fire(new o.Event("moveend",c))}flyTo(c,d){if(!c.essential&&o.exported.prefersReducedMotion){const Ye=o.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ye,d)}this.stop(),c=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},c);const _=this.transform,x=this.getZoom(),w=this.getBearing(),A=this.getPitch(),C=this.getPadding(),P="zoom"in c?o.clamp(+c.zoom,_.minZoom,_.maxZoom):x,O="bearing"in c?this._normalizeBearing(c.bearing,w):w,D="pitch"in c?+c.pitch:A,U="padding"in c?c.padding:_.padding,$=_.zoomScale(P-x),ee=o.pointGeometry.convert(c.offset);let Q=_.centerPoint.add(ee);const te=_.pointLocation(Q),ne=o.LngLat.convert(c.center||te);this._normalizeCenter(ne);const W=_.project(te),he=_.project(ne).sub(W);let le=c.curve;const pe=Math.max(_.width,_.height),xe=pe/$,ye=he.mag();if("minZoom"in c){const Ye=o.clamp(Math.min(c.minZoom,x,P),_.minZoom,_.maxZoom),tt=pe/_.zoomScale(Ye-x);le=Math.sqrt(tt/ye*2)}const Te=le*le;function Pe(Ye){const tt=(xe*xe-pe*pe+(Ye?-1:1)*Te*Te*ye*ye)/(2*(Ye?xe:pe)*Te*ye);return Math.log(Math.sqrt(tt*tt+1)-tt)}function Le(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function ze(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const st=Pe(0);let Ie=function(Ye){return ze(st)/ze(st+le*Ye)},Ze=function(Ye){return pe*((ze(st)*(Le(tt=st+le*Ye)/ze(tt))-Le(st))/Te)/ye;var tt},Ue=(Pe(1)-st)/le;if(Math.abs(ye)<1e-6||!isFinite(Ue)){if(Math.abs(pe-xe)<1e-6)return this.easeTo(c,d);const Ye=xe<pe?-1:1;Ue=Math.abs(Math.log(xe/pe))/le,Ze=function(){return 0},Ie=function(tt){return Math.exp(Ye*le*tt)}}c.duration="duration"in c?+c.duration:1e3*Ue/("screenSpeed"in c?+c.screenSpeed/le:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const Ke=w!==O,Oe=D!==A,Ae=!_.isPaddingEqual(U),Ne=Ye=>tt=>{const At=tt*Ue,qt=1/Ie(At);Ye.zoom=tt===1?P:x+Ye.scaleZoom(qt),Ke&&(Ye.bearing=o.number(w,O,tt)),Oe&&(Ye.pitch=o.number(A,D,tt)),Ae&&(Ye.interpolatePadding(C,U,tt),Q=Ye.centerPoint.add(ee));const vt=tt===1?ne:Ye.unproject(W.add(he.mult(Ze(At))).mult(qt));return Ye.setLocationAtPoint(Ye.renderWorldCopies?vt.wrap():vt,Q),Ye._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(d),Ye};if(c.preloadOnly){const Ye=this._emulate(Ne,c.duration,_);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=Ke,this._pitching=Oe,this._padding=Ae,this._prepareEase(d,!1),this._ease(Ne(_),()=>this._afterEase(d),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!c){const _=this.handlers;_&&_.stop(!1)}return this}_ease(c,d,_){_.animate===!1||_.duration===0?(c(1),d()):(this._easeStart=o.exported.now(),this._easeOptions=_,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,d){c=o.wrap(c,-180,180);const _=Math.abs(c-d);return Math.abs(c-360-d)<_&&(c-=360),Math.abs(c+360-d)<_&&(c+=360),c}_normalizeCenter(c){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const _=c.lng-d.center.lng;c.lng+=_>180?-360:_<-180?360:0}_emulate(c,d,_){const x=Math.ceil(15*d/1e3),w=[],A=c(_.clone());for(let C=0;C<=x;C++){const P=A(C/x);w.push(P.clone())}return w}}class Ap{constructor(c={}){this.options=c,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const d=this.options&&this.options.compact;return this._map=c,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F("button","mapboxgl-ctrl-attrib-button",this._container),F("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,d){const _=this._map._getUIString(`AttributionControl.${d}`);c.setAttribute("aria-label",_),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(c){const _=d.reduce((x,w,A)=>(w.value&&(x+=`${w.key}=${w.value}${A<d.length-1?"&":""}`),x),"?");c.href=`${o.config.FEEDBACK_URL}/${_}#${yp(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const d=this._map.style._sourceCaches;for(const x in d){const w=d[x];if(w.used){const A=w.getSource();A.attribution&&c.indexOf(A.attribution)<0&&c.push(A.attribution)}}c.sort((x,w)=>x.length-w.length),c=c.filter((x,w)=>{for(let A=w+1;A<c.length;A++)if(c[A].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const _=c.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,c.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Cp{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=F("div","mapboxgl-ctrl");const d=F("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(Object.entries(c).length===0)return!0;for(const d in c){const _=c[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const d=c[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class xu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const d=++this._id;return this._queue.push({callback:c,id:d,cancelled:!1}),d}remove(c){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const x of _)if(x.id===c)return void(x.cancelled=!0)}run(c=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Kh(m,c,d){if(m=new o.LngLat(m.lng,m.lat),c){const _=new o.LngLat(m.lng-360,m.lat),x=new o.LngLat(m.lng+360,m.lat),w=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),A=d.locationPoint(m).distSqr(c),C=c.x<0||c.y<0||c.x>d.width||c.y>d.height;d.locationPoint(_).distSqr(c)<A&&(C||Math.abs(_.lng-d.center.lng)<w)?m=_:d.locationPoint(x).distSqr(c)<A&&(C||Math.abs(x.lng-d.center.lng)<w)&&(m=x)}for(;Math.abs(m.lng-d.center.lng)>180;){const _=d.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const Gl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Jh extends o.Evented{constructor(c,d){if(super(),(c instanceof o.window.HTMLElement||d)&&(c=o.extend({element:c},d)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=o.pointGeometry.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=F("div");const x=41,w=27,A=j("svg",{display:"block",height:x*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${x}`},this._element),C=j("radialGradient",{id:"shadowGradient"},j("defs",{},A));j("stop",{offset:"10%","stop-opacity":.4},C),j("stop",{offset:"100%","stop-opacity":.05},C),j("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),j("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),j("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),j("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=o.pointGeometry.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in Gl)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=o.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const d=c.code,_=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(c){const d=c.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,d=this._pos;if(!c||!d)return!1;const _=c.unproject(d),x=c.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(_)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const d=this._pos;if(!d||d.x<0||d.x>c.transform.width||d.y<0||d.y>c.transform.height)return void this._clearFadeTimer();const _=c.unproject(d);let x;c._showingGlobe()&&o.isLngLatBehindGlobe(c.transform,this._lngLat)?x=0:(x=1-c._queryFogOpacity(_),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${c.x}px,${c.y}px)
            ${Gl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const c=this._pos,d=this._map,_=this.getPitchAlignment();if(!d||!c||_!=="map")return"";if(!d._showingGlobe()){const P=d.getPitch();return P?`rotateX(${P}deg)`:""}const x=o.radToDeg(o.globeTiltAtLngLat(d.transform,this._lngLat)),w=c.sub(o.globeCenterToScreenPoint(d.transform)),A=Math.abs(w.x)+Math.abs(w.y);if(A===0)return"";const C=x/A;return`rotateX(${-w.y*C}deg) rotateY(${w.x*C}deg)`}_calculateZTransform(){const c=this._pos,d=this._map;if(!d||!c)return"";let _=0;const x=this.getRotationAlignment();if(x==="map")if(d._showingGlobe()){const w=d.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),A=d.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);_=o.radToDeg(Math.atan2(A.y,A.x))-90}else _=-d.getBearing();else if(x==="horizon"){const w=o.smoothstep(4,6,d.getZoom()),A=o.globeCenterToScreenPoint(d.transform);A.y+=w*d.transform.height;const C=c.sub(A),P=o.radToDeg(Math.atan2(C.y,C.x));_=(P>90?P-270:P+90)*(1-w)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(c){o.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Kh(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),c===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=o.pointGeometry.convert(c),this._update(),this}_onMove(c){const d=this._map;if(!d)return;const _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){const w=this._clickTolerance||d._clickTolerance;if(c.point.dist(_)<w)return;this._isDragging=!0}this._pos=c.point.sub(x),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(c){const d=this._map,_=this._pos;d&&_&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(_),this._pointerdownPos=c.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const d=this._map;return d&&(c?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const J_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Q_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Mp(m=new o.pointGeometry(0,0),c="bottom"){if(typeof m=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(c){case"top":return new o.pointGeometry(0,m);case"top-left":return new o.pointGeometry(d,d);case"top-right":return new o.pointGeometry(-d,d);case"bottom":return new o.pointGeometry(0,-m);case"bottom-left":return new o.pointGeometry(d,-d);case"bottom-right":return new o.pointGeometry(-d,-d);case"left":return new o.pointGeometry(m,0);case"right":return new o.pointGeometry(-m,0)}return new o.pointGeometry(0,0)}return m instanceof o.pointGeometry||Array.isArray(m)?o.pointGeometry.convert(m):o.pointGeometry.convert(m[c]||[0,0])}class ey{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const d=o.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,d,_){this._start=this.getValue(d),this._end=c,this._startTime=d,this._endTime=d+_}}const ty={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ny={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Pp={showCompass:!0,showZoom:!0,visualizePitch:!1};class ry{constructor(c,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new wp({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,_&&(this.mousePitch=new Ep({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(c,d){this.mouseRotate.mousedown(c,d),this.mousePitch&&this.mousePitch.mousedown(c,d),q()}move(c,d){const _=this.map,x=this.mouseRotate.mousemoveWindow(c,d),w=x&&x.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const A=this.mousePitch.mousemoveWindow(c,d),C=A&&A.pitchDelta;C&&_.setPitch(_.getPitch()+C)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){H(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(o.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),ue(this.element,c)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,ue(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Fe(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){c.targetTouches.length!==1?this.reset():(this._lastPos=Fe(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const iy={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},sy={maxWidth:100,unit:"metric"};function oy(m,c,d){const _=Qh(c),x=_/c,w={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[d];this._map._requestDomTask(()=>{this._container.style.width=m*x+"px",this._container.innerHTML=`${_}&nbsp;${w}`})}function Qh(m){const c=Math.pow(10,`${Math.floor(m)}`.length-1);let d=m/c;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(_){const x=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*x)/x}(d),c*d}const bu={version:o.version,supported:T,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends K_{constructor(m){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(m=o.extend({},ny,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(m.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new mt(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new xu,this._domRenderTaskQueue=new xu,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},ty,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ey(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,typeof m.container=="string"){if(this._container=o.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Y_(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new F_(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,o.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Ap({customAttribution:m.customAttribution})),this._logoControl=new Cp,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(m,c){if(c===void 0&&(c=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[c];return c.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(m);return c>-1&&this._controls.splice(c,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new o.Event("movestart",m)).fire(new o.Event("move",m)),this.fire(new o.Event("resize",m)),c&&this.fire(new o.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(o.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?o.window.navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(c=>c==="auto"?o.window.navigator.language:c):m}setLanguage(m){const c=this._parseLanguage(m);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,c=m.projection.name;let d;c==="globe"&&m.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),d=!0):c==="mercator"&&m.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,c){return this._updateProjection(m||c||{name:"mercator"})}_updateProjection(m){let c;if(c=m.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const d in this.style._sourceCaches)this.style._sourceCaches[d].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(o.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(o.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,c,d){if(m==="mouseenter"||m==="mouseover"){let _=!1;const x=A=>{const C=c.filter(O=>this.getLayer(O)),P=C.length?this.queryRenderedFeatures(A.point,{layers:C}):[];P.length?_||(_=!0,d.call(this,new jr(m,this,A.originalEvent,{features:P}))):_=!1},w=()=>{_=!1};return{layers:new Set(c),listener:d,delegates:{mousemove:x,mouseout:w}}}if(m==="mouseleave"||m==="mouseout"){let _=!1;const x=A=>{const C=c.filter(P=>this.getLayer(P));(C.length?this.queryRenderedFeatures(A.point,{layers:C}):[]).length?_=!0:_&&(_=!1,d.call(this,new jr(m,this,A.originalEvent)))},w=A=>{_&&(_=!1,d.call(this,new jr(m,this,A.originalEvent)))};return{layers:new Set(c),listener:d,delegates:{mousemove:x,mouseout:w}}}{const _=x=>{const w=c.filter(C=>this.getLayer(C)),A=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];A.length&&(x.features=A,d.call(this,x),delete x.features)};return{layers:new Set(c),listener:d,delegates:{[m]:_}}}}on(m,c,d){if(d===void 0)return super.on(m,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(m,c,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(m,c,d){if(d===void 0)return super.once(m,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(m,c,d);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(m,c,d){if(d===void 0)return super.off(m,c);c=new Set(Array.isArray(c)?c:[c]);const _=(w,A)=>{if(w.size!==A.size)return!1;for(const C of w)if(!A.has(C))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[m]:void 0;return x&&(w=>{for(let A=0;A<w.length;A++){const C=w[A];if(C.listener===d&&_(C.layers,c)){for(const P in C.delegates)this.off(P,C.delegates[P]);return w.splice(A,1),this}}})(x),this}queryRenderedFeatures(m,c){return this.style?(c!==void 0||m===void 0||m instanceof o.pointGeometry||Array.isArray(m)||(c=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(m,c){return this.style.querySourceFeatures(m,c)}setStyle(m,c){return(c=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(m,c))}_getUIString(m){const c=this._locale[m];if(c==null)throw new Error(`Missing UI string '${m}'`);return c}_updateStyle(m,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new ls(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ls(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,c){if(typeof m=="string"){const d=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(d,o.ResourceType.Style);o.getJSON(_,(x,w)=>{x?this.fire(new o.ErrorEvent(x)):w&&this._updateDiff(w,c)})}else typeof m=="object"&&this._updateDiff(m,c)}_updateDiff(m,c){try{this.style.setState(m)&&this._update(!0)}catch(d){o.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(m,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(m,c){return this._lazyInitEmptyStyle(),this.style.addSource(m,c),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const c in m){const d=m[c]._tiles;for(const _ in d){const x=d[_];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(m,c,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,c,d)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,c,{pixelRatio:d=1,sdf:_=!1,stretchX:x,stretchY:w,content:A}={}){if(this._lazyInitEmptyStyle(),c instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&c instanceof o.window.ImageBitmap){const{width:C,height:P,data:O}=o.exported.getImageData(c);this.style.addImage(m,{data:new o.RGBAImage({width:C,height:P},O),pixelRatio:d,stretchX:x,stretchY:w,content:A,sdf:_,version:0})}else if(c.width===void 0||c.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:P}=c,O=c;this.style.addImage(m,{data:new o.RGBAImage({width:C,height:P},new Uint8Array(O.data)),pixelRatio:d,stretchX:x,stretchY:w,content:A,sdf:_,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m)}}updateImage(m,c){const d=this.style.getImage(m);if(!d)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=c instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&c instanceof o.window.ImageBitmap?o.exported.getImageData(c):c,{width:x,height:w}=_;x!==void 0&&w!==void 0?x===d.data.width&&w===d.data.height?(d.data.replace(_.data,!(c instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&c instanceof o.window.ImageBitmap)),this.style.updateImage(m,d)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,c){o.getImage(this._requestManager.transformRequest(m,o.ResourceType.Image),(d,_)=>{c(d,_ instanceof o.window.HTMLImageElement?o.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,c){return this._lazyInitEmptyStyle(),this.style.addLayer(m,c),this._update(!0)}moveLayer(m,c){return this.style.moveLayer(m,c),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,c,d){return this.style.setLayerZoomRange(m,c,d),this._update(!0)}setFilter(m,c,d={}){return this.style.setFilter(m,c,d),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,c,d,_={}){return this.style.setPaintProperty(m,c,d,_),this._update(!0)}getPaintProperty(m,c){return this.style.getPaintProperty(m,c)}setLayoutProperty(m,c,d,_={}){return this.style.setLayoutProperty(m,c,d,_),this._update(!0)}getLayoutProperty(m,c){return this.style.getLayoutProperty(m,c)}setLight(m,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(m),this.transform):0}setFeatureState(m,c){return this.style.setFeatureState(m,c),this._update()}removeFeatureState(m,c){return this.style.removeFeatureState(m,c),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let d,_,x,w=this._container;for(;w&&(!_||!x);){const A=o.window.getComputedStyle(w).transform;A&&A!=="none"&&(d=A.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(_=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(x=d[3])),w=w.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=x?Math.abs(c/x):c}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=F("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=F("div","mapboxgl-canvas-container",m);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=F("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=F("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=F("div",`mapboxgl-ctrl-${x}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,c){const d=o.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(c),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${c}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const c=this._markers.indexOf(m);c!==-1&&this._markers.splice(c,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const c=this._popups.indexOf(m);c!==-1&&this._popups.splice(c,1)}_setupPainter(){const m=o.extend({},T.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",m),d=c||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);d?(this._useWebGL2&&!c&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(d,!0),this.painter=new cu(d,this.transform,!!c),this.on("data",_=>{_.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(d)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let c;const d=this.painter.context.extTimerQuery,_=o.exported.now();if(this.listens("gpu-timing-frame")&&(c=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,P=this.transform.pitch,O=o.exported.now(),D=new o.EvaluationParameters(C,{now:O,fadeDuration:x,pitch:P,transition:this.style.getTransition()});this.style.update(D)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const C=o.exported.now()-_;d.endQueryEXT(d.TIME_ELAPSED_EXT,c),setTimeout(()=>{const P=d.getQueryObjectEXT(c,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(c),this.fire(new o.Event("gpu-timing-frame",{cpuTime:C,gpuTime:P})),o.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(C);this.fire(new o.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(C);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(A||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(w=this._updateAverageElevation(_,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const c of this._markers)m&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!m||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(m,c=!1){const d=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);if((c||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=m;const A=Math.abs(_-x);if(A>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(x),d(x);this._averageElevation.easeTo(x,m,300)}else if(A>1e-4)return this._averageElevation.jumpTo(x),d(x)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===o.AUTH_ERR_MSG||m.status===401)){const c=this.painter.context.gl;o.storeAuthState(c,!1),this._logoControl instanceof Cp&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const d=this.painter.context.gl,_=d.createFramebuffer();function x(w){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,w,0);const A=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,A),A}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(x(m),c.canvasCopies.map(x),c.timeStamps)}_canvasPixelComparison(m,c,d){let _=d[1]-d[0];const x=m.length/4;for(let w=0;w<c.length;w++){const A=c[w];let C=0;for(let P=0;P<A.length;P+=4)A[P]===m[P]&&A[P+1]===m[P+1]&&A[P+2]===m[P+2]&&A[P+3]===m[P+3]&&(C+=1);_+=(d[w+2]-d[w+1])*(1-C/x)}return _}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=o.exported.frame(c=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(c)}))}_preloadTiles(m){const c=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(c,(d,_)=>d._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,c){o.setCacheLimits(m,c)}get version(){return o.version}},NavigationControl:class{constructor(m){this.options=o.extend({},Pp,m),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),F("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),F("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:c}):d.resetNorth({},{originalEvent:c}))}),this._compassIcon=F("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const c=m.getZoom(),d=c===m.getMaxZoom(),_=c===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ry(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,c){const d=F("button",m,this._container);return d.type="button",d.addEventListener("click",c),d}_setButtonTitle(m,c){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${c}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends o.Evented{constructor(m){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},iy,m),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=cs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const c=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,m(d)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(d=>c(d.state!=="denied")).catch(()=>c()):c()}_isOutOfMapMaxBounds(m){const c=this._map.getMaxBounds(),d=m.coords;return!!c&&(d.longitude<c.getWest()||d.longitude>c.getEast()||d.latitude<c.getSouth()||d.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",m)),this._finish()}}_updateCamera(m){const c=new o.LngLat(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,_=this._map.getBearing(),x=o.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(d),x,{geolocateSource:!0})}_updateMarker(m){if(m){const c=new o.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,c=o.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,d=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=F("button","mapboxgl-ctrl-geolocate",this._container),F("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F("div","mapboxgl-user-location"),this._dotElement.appendChild(F("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(F("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Jh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=F("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(c=>{c==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ap,ScaleControl:class{constructor(m){this.options=o.extend({},sy,m),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=oy.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,c=this._map,d=c._containerHeight/2,_=c._containerWidth/2-m/2,x=c.unproject([_,d]),w=c.unproject([_+m,d]),A=x.distanceTo(w);if(this.options.unit==="imperial"){const C=3.2808*A;C>5280?this._setScale(m,C/5280,"mile"):this._setScale(m,C,"foot")}else this.options.unit==="nautical"?this._setScale(m,A/1852,"nautical-mile"):A>=1e3?this._setScale(m,A/1e3,"kilometer"):this._setScale(m,A,"meter")}_setScale(m,c,d){const _=Qh(c),x=_/c;this._map._requestDomTask(()=>{this._container.style.width=m*x+"px",this._container.innerHTML=d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:d}).format(_):`${_}&nbsp;nm`})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof o.window.HTMLElement?this._container=m.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=F("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(m){super(),this.options=o.extend(Object.create(J_),m),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=o.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(o.window.document.createTextNode(m))}setHTML(m){const c=o.window.document.createDocumentFragment(),d=o.window.document.createElement("body");let _;for(d.innerHTML=m;_=d.firstChild,_;)c.appendChild(_);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=F("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(m),this.options.closeButton){const d=this._closeButton=F("button","mapboxgl-popup-close-button",c);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let c;return this._classList.delete(m)?c=!1:(this._classList.add(m),c=!0),this._updateClassList(),c}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const c=this._map,d=this._container,_=this._pos;if(!c||!d||!_)return"bottom";const x=d.offsetWidth,w=d.offsetHeight,A=_.x<x/2,C=_.x>c.transform.width-x/2;if(_.y+m<w)return A?"top-left":C?"top-right":"top";if(_.y>c.transform.height-w){if(A)return"bottom-left";if(C)return"bottom-right"}return A?"left":C?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),m.className=c.join(" ")}_update(m){const c=this._map,d=this._content;if(!c||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=F("div","mapboxgl-popup",c.getContainer()),this._tip=F("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Kh(this._lngLat,this._pos,c.transform)),!this._trackPointer||m){const x=this._pos=this._trackPointer&&m?m:c.project(this._lngLat),w=Mp(this.options.offset),A=this._anchor=this._getAnchor(w.y),C=Mp(this.options.offset,A),P=x.add(C).round();c._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${Gl[A]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&c._showingGlobe()){const x=o.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Q_);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Jh,Style:ls,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Uh,Evented:o.Evented,config:o.config,prewarm:function(){Lt().acquire(Ct)},clearPrewarmedResources:function(){const m=Tt;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Ct),Tt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(m){o.config.ACCESS_TOKEN=m},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(m){o.config.API_URL=m},get workerCount(){return St.workerCount},set workerCount(m){St.workerCount=m},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){o.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){o.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return bu});var p=s;return p})})(iee);const Ux=ex,see=ix({__proto__:null,default:Ux},[ex]);function oee(t){var e=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return e?{key:e[1],value:e[2]}:null}function aee(t){var e=t.match(/<?([^>]*)>(.*)/);if(!e)return null;var n=e[1],r=e[2].split(";"),s=null,u=r.reduce(function(p,o){var v=oee(o);return v?v.key==="rel"?(s||(s=v.value),p):(p[v.key]=v.value,p):p},{});return s?{url:n,rel:s,params:u}:null}function lee(t){return t?t.split(/,\s*</).reduce(function(e,n){var r=aee(n);if(!r)return e;var s=r.rel.split(/\s+/);return s.forEach(function(u){e[u]||(e[u]={url:r.url,params:r.params})}),e},{}):{}}var cee=lee,uee=cee;function a2(t,e){this.request=t,this.headers=e.headers,this.rawBody=e.body,this.statusCode=e.statusCode;try{this.body=JSON.parse(e.body||"{}")}catch{this.body=e.body}this.links=uee(this.headers.link)}a2.prototype.hasNextPage=function(){return!!this.links.next};a2.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var hee=a2,Vx={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},qR=Vx;function dee(t){var e=t.type||qR.ERROR_HTTP,n;if(t.body)try{n=JSON.parse(t.body)}catch{n=t.body}else n=null;var r=t.message||null;r||(typeof n=="string"?r=n:n&&typeof n.message=="string"?r=n.message:e===qR.ERROR_REQUEST_ABORTED&&(r="Request aborted")),this.message=r,this.type=e,this.statusCode=t.statusCode||null,this.request=t.request,this.body=n}var fee=dee;function pee(t){var e=t.indexOf(":"),n=t.substring(0,e).trim().toLowerCase(),r=t.substring(e+1).trim();return{name:n,value:r}}function mee(t){var e={};return t&&t.trim().split(/[\r|\n]+/).forEach(function(n){var r=pee(n);e[r.name]=r.value}),e}var gee=mee,_ee=hee,XR=fee,ww=Vx,yee=gee,tx={};function vee(t){var e=tx[t.id];e&&(e.abort(),delete tx[t.id])}function xee(t,e){return new _ee(t,{body:e.response,headers:yee(e.getAllResponseHeaders()),statusCode:e.status})}function YR(t){var e=t.total,n=t.loaded,r=100*n/e;return{total:e,transferred:n,percent:r}}function wF(t,e){return new Promise(function(n,r){e.onprogress=function(p){t.emitter.emit(ww.EVENT_PROGRESS_DOWNLOAD,YR(p))};var s=t.file;s&&(e.upload.onprogress=function(p){t.emitter.emit(ww.EVENT_PROGRESS_UPLOAD,YR(p))}),e.onerror=function(p){r(p)},e.onabort=function(){var p=new XR({request:t,type:ww.ERROR_REQUEST_ABORTED});r(p)},e.onload=function(){if(delete tx[t.id],e.status<200||e.status>=400){var p=new XR({request:t,body:e.response,statusCode:e.status});r(p);return}n(e)};var u=t.body;typeof u=="string"?e.send(u):u?e.send(JSON.stringify(u)):s?e.send(s):e.send(),tx[t.id]=e}).then(function(n){return xee(t,n)})}function EF(t,e){var n=t.url(e),r=new window.XMLHttpRequest;return r.open(t.method,n),Object.keys(t.headers).forEach(function(s){r.setRequestHeader(s,t.headers[s])}),r}function bee(t){return Promise.resolve().then(function(){var e=EF(t,t.client.accessToken);return wF(t,e)})}var wee={browserAbort:vee,sendRequestXhr:wF,browserSend:bee,createRequestXhr:EF},nx={},Eee={get exports(){return nx},set exports(t){nx=t}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(t,e){(function(n){var r=e,s=t&&t.exports==r&&t,u=typeof qd=="object"&&qd;(u.global===u||u.window===u)&&(n=u);var p=function(X){this.message=X};p.prototype=new Error,p.prototype.name="InvalidCharacterError";var o=function(X){throw new p(X)},v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T=/[\t\n\f\r ]/g,I=function(X){X=String(X).replace(T,"");var re=X.length;re%4==0&&(X=X.replace(/==?$/,""),re=X.length),(re%4==1||/[^+a-zA-Z0-9/]/.test(X))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var de=0,q,H,J="",Ee=-1;++Ee<re;)H=v.indexOf(X.charAt(Ee)),q=de%4?q*64+H:H,de++%4&&(J+=String.fromCharCode(255&q>>(-2*de&6)));return J},L=function(X){X=String(X),/[^\0-\xFF]/.test(X)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var re=X.length%3,de="",q=-1,H,J,Ee,ue,Fe=X.length-re;++q<Fe;)H=X.charCodeAt(q)<<16,J=X.charCodeAt(++q)<<8,Ee=X.charCodeAt(++q),ue=H+J+Ee,de+=v.charAt(ue>>18&63)+v.charAt(ue>>12&63)+v.charAt(ue>>6&63)+v.charAt(ue&63);return re==2?(H=X.charCodeAt(q)<<8,J=X.charCodeAt(++q),ue=H+J,de+=v.charAt(ue>>10)+v.charAt(ue>>4&63)+v.charAt(ue<<2&63)+"="):re==1&&(ue=X.charCodeAt(q),de+=v.charAt(ue>>2)+v.charAt(ue<<4&63)+"=="),de},F={encode:L,decode:I,version:"0.1.0"};if(r&&!r.nodeType)if(s)s.exports=F;else for(var j in F)F.hasOwnProperty(j)&&(r[j]=F[j]);else n.base64=F})(qd)})(Eee,nx);var Tee=nx,Ew={};function See(t){if(Ew[t])return Ew[t];var e=t.split("."),n=e[0],r=e[1];if(!r)throw new Error("Invalid token");var s=Aee(r),u={usage:n,user:s.u};return Uu(s,"a")&&(u.authorization=s.a),Uu(s,"exp")&&(u.expires=s.exp*1e3),Uu(s,"iat")&&(u.created=s.iat*1e3),Uu(s,"scopes")&&(u.scopes=s.scopes),Uu(s,"client")&&(u.client=s.client),Uu(s,"ll")&&(u.lastLogin=s.ll),Uu(s,"iu")&&(u.impersonator=s.iu),Ew[t]=u,u}function Aee(t){try{return JSON.parse(Tee.decode(t))}catch{throw new Error("Invalid token")}}function Uu(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var TF=See,jx=Mee,Cee=Object.prototype.hasOwnProperty;function Mee(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var r in n)Cee.call(n,r)&&(t[r]=n[r])}return t}var vT={},Pee={get exports(){return vT},set exports(t){vT=t}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(v,T,I){this.fn=v,this.context=T,this.once=I||!1}function u(v,T,I,L,F){if(typeof I!="function")throw new TypeError("The listener must be a function");var j=new s(I,L||v,F),X=n?n+T:T;return v._events[X]?v._events[X].fn?v._events[X]=[v._events[X],j]:v._events[X].push(j):(v._events[X]=j,v._eventsCount++),v}function p(v,T){--v._eventsCount===0?v._events=new r:delete v._events[T]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var T=[],I,L;if(this._eventsCount===0)return T;for(L in I=this._events)e.call(I,L)&&T.push(n?L.slice(1):L);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(I)):T},o.prototype.listeners=function(T){var I=n?n+T:T,L=this._events[I];if(!L)return[];if(L.fn)return[L.fn];for(var F=0,j=L.length,X=new Array(j);F<j;F++)X[F]=L[F].fn;return X},o.prototype.listenerCount=function(T){var I=n?n+T:T,L=this._events[I];return L?L.fn?1:L.length:0},o.prototype.emit=function(T,I,L,F,j,X){var re=n?n+T:T;if(!this._events[re])return!1;var de=this._events[re],q=arguments.length,H,J;if(de.fn){switch(de.once&&this.removeListener(T,de.fn,void 0,!0),q){case 1:return de.fn.call(de.context),!0;case 2:return de.fn.call(de.context,I),!0;case 3:return de.fn.call(de.context,I,L),!0;case 4:return de.fn.call(de.context,I,L,F),!0;case 5:return de.fn.call(de.context,I,L,F,j),!0;case 6:return de.fn.call(de.context,I,L,F,j,X),!0}for(J=1,H=new Array(q-1);J<q;J++)H[J-1]=arguments[J];de.fn.apply(de.context,H)}else{var Ee=de.length,ue;for(J=0;J<Ee;J++)switch(de[J].once&&this.removeListener(T,de[J].fn,void 0,!0),q){case 1:de[J].fn.call(de[J].context);break;case 2:de[J].fn.call(de[J].context,I);break;case 3:de[J].fn.call(de[J].context,I,L);break;case 4:de[J].fn.call(de[J].context,I,L,F);break;default:if(!H)for(ue=1,H=new Array(q-1);ue<q;ue++)H[ue-1]=arguments[ue];de[J].fn.apply(de[J].context,H)}}return!0},o.prototype.on=function(T,I,L){return u(this,T,I,L,!1)},o.prototype.once=function(T,I,L){return u(this,T,I,L,!0)},o.prototype.removeListener=function(T,I,L,F){var j=n?n+T:T;if(!this._events[j])return this;if(!I)return p(this,j),this;var X=this._events[j];if(X.fn)X.fn===I&&(!F||X.once)&&(!L||X.context===L)&&p(this,j);else{for(var re=0,de=[],q=X.length;re<q;re++)(X[re].fn!==I||F&&!X[re].once||L&&X[re].context!==L)&&de.push(X[re]);de.length?this._events[j]=de.length===1?de[0]:de:p(this,j)}return this},o.prototype.removeAllListeners=function(T){var I;return T?(I=n?n+T:T,this._events[I]&&p(this,I)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,t.exports=o})(Pee);function Iee(t){return t.map(encodeURIComponent).join(",")}function SF(t){return Array.isArray(t)?Iee(t):encodeURIComponent(String(t))}function AF(t,e,n){if(n===!1||n===null)return t;var r=/\?/.test(t)?"&":"?",s=encodeURIComponent(e);return n!==void 0&&n!==""&&n!==!0&&(s+="="+SF(n)),""+t+r+s}function Ree(t,e){if(!e)return t;var n=t;return Object.keys(e).forEach(function(r){var s=e[r];s!==void 0&&(Array.isArray(s)&&(s=s.filter(function(u){return u!=null}).join(",")),n=AF(n,r,s))}),n}function kee(t,e){if(!e||t.slice(0,4)==="http")return t;var n=t[0]==="/"?"":"/";return""+e.replace(/\/$/,"")+n+t}function Lee(t,e){return e?t.replace(/\/:([a-zA-Z0-9]+)/g,function(n,r){var s=e[r];if(s===void 0)throw new Error("Unspecified route parameter "+r);var u=SF(s);return"/"+u}):t}var Oee={appendQueryObject:Ree,appendQueryParam:AF,prependOrigin:kee,interpolateRouteParams:Lee},Dee=TF,l2=jx,zee=vT,P0=Oee,KR=Vx,Fee=1;function Nc(t,e){if(!t)throw new Error("MapiRequest requires a client");if(!e||!e.path||!e.method)throw new Error("MapiRequest requires an options object with path and method properties");var n={};e.body&&(n["content-type"]="application/json");var r=l2(n,e.headers),s=Object.keys(r).reduce(function(u,p){return u[p.toLowerCase()]=r[p],u},{});this.id=Fee++,this._options=e,this.emitter=new zee,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=e.path,this.method=e.method,this.origin=e.origin||t.origin,this.query=e.query||{},this.params=e.params||{},this.body=e.body||null,this.file=e.file||null,this.encoding=e.encoding||"utf8",this.sendFileAs=e.sendFileAs||null,this.headers=s}Nc.prototype.url=function(e){var n=P0.prependOrigin(this.path,this.origin);n=P0.appendQueryObject(n,this.query);var r=this.params,s=e??this.client.accessToken;if(s){n=P0.appendQueryParam(n,"access_token",s);var u=Dee(s).user;r=l2({ownerId:u},r)}return n=P0.interpolateRouteParams(n,r),n};Nc.prototype.send=function(){var e=this;if(e.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then(function(n){return e.response=n,e.emitter.emit(KR.EVENT_RESPONSE,n),n},function(n){throw e.error=n,e.emitter.emit(KR.EVENT_ERROR,n),n})};Nc.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Nc.prototype.eachPage=function(e){var n=this;function r(p){function o(){delete n._nextPageRequest;var v=p.nextPage();v&&(n._nextPageRequest=v,u(v))}e(null,p,o)}function s(p){e(p,null,function(){})}function u(p){p.send().then(r,s)}u(this)};Nc.prototype.clone=function(){return this._extend()};Nc.prototype._extend=function(e){var n=l2(this._options,e);return new Nc(this.client,n)};var Nee=Nc,Bee=TF,Uee=Nee,Vee=Vx;function CF(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");Bee(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||Vee.API_ORIGIN}CF.prototype.createRequest=function(e){return new Uee(this,e)};var MF=CF,PF=wee,IF=MF;function Rf(t){IF.call(this,t)}Rf.prototype=Object.create(IF.prototype);Rf.prototype.constructor=Rf;Rf.prototype.sendRequest=PF.browserSend;Rf.prototype.abortRequest=PF.browserAbort;function jee(t){return new Rf(t)}var RF=jee,Gee=RF,JR=Gee;const Wee=ix({__proto__:null,default:JR},[JR]);var $ee=Object.prototype.toString,Hee=function(t){var e;return $ee.call(t)==="[object Object]"&&(e=Object.getPrototypeOf(t),e===null||e===Object.getPrototypeOf({}))},Zee=Hee,qee=jx,kF="value",Tw=`
  `,ar={};ar.assert=function(t,e){return e=e||{},function(n){var r=Bc(t,n);if(r){var s=c2(r,e);throw e.apiName&&(s=e.apiName+": "+s),new Error(s)}}};ar.shape=function(e){var n=Jee(e);return function(s){var u=Bc(ar.plainObject,s);if(u)return u;for(var p,o,v=[],T=0;T<n.length;T++)p=n[T].key,o=n[T].value,u=Bc(o,s[p]),u&&v.push([p].concat(u));return v.length<2?v[0]:function(I){v=v.map(function(j){var X=j[0],re=c2(j,I).split(`
`).join(Tw);return"- "+X+": "+re});var L=I.path.join("."),F=L===kF?"":" of "+L;return"The following properties"+F+" have invalid values:"+Tw+v.join(Tw)}}};ar.strictShape=function(e){var n=ar.shape(e);return function(s){var u=n(s);if(u)return u;var p=Object.keys(s).reduce(function(o,v){return e[v]===void 0&&o.push(v),o},[]);if(p.length!==0)return function(){return"The following keys are invalid: "+p.join(", ")}}};ar.arrayOf=function(e){return LF(e)};ar.tuple=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return LF(e)};function LF(t){var e=Array.isArray(t),n=function(r){return e?t[r]:t};return function(s){var u=Bc(ar.plainArray,s);if(u)return u;if(e&&s.length!==t.length)return"an array with "+t.length+" items";for(var p=0;p<s.length;p++)if(u=Bc(n(p),s[p]),u)return[p].concat(u)}}ar.required=function(e){function n(r){return r==null?function(s){return OF(s,DF(s.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return n.__required=!0,n};ar.oneOfType=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(r){var s=e.map(function(u){return Bc(u,r)}).filter(Boolean);if(s.length===e.length)return s.every(function(u){return u.length===1&&typeof u[0]=="string"})?Xee(s.map(function(u){return u[0]})):s.reduce(function(u,p){return p.length>u.length?p:u})}};ar.equal=function(e){return function(r){if(r!==e)return JSON.stringify(e)}};ar.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),n=e.map(function(r){return ar.equal(r)});return ar.oneOfType.apply(this,n)};ar.range=function(e){var n=e[0],r=e[1];return function(u){var p=Bc(ar.number,u);if(p||u<n||u>r)return"number between "+n+" & "+r+" (inclusive)"}};ar.any=function(){};ar.boolean=function(e){if(typeof e!="boolean")return"boolean"};ar.number=function(e){if(typeof e!="number")return"number"};ar.plainArray=function(e){if(!Array.isArray(e))return"array"};ar.plainObject=function(e){if(!Zee(e))return"object"};ar.string=function(e){if(typeof e!="string")return"string"};ar.func=function(e){if(typeof e!="function")return"function"};function Bc(t,e){if(!(e==null&&!t.hasOwnProperty("__required"))){var n=t(e);if(n)return Array.isArray(n)?n:[n]}}function c2(t,e){var n=t.length,r=t[n-1],s=t.slice(0,n-1);return s.length===0&&(s=[kF]),e=qee(e,{path:s}),typeof r=="function"?r(e):OF(e,Yee(r))}function Xee(t){return t.length<2?t[0]:t.length===2?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function Yee(t){return"must be "+Kee(t)+"."}function Kee(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function OF(t,e){var n=DF(t.path),r=t.path.join(".")+" "+e,s=n?"Item at position ":"";return s+r}function DF(t){return typeof t[t.length-1]=="number"||typeof t[0]=="number"}function Jee(t){return Object.keys(t||{}).map(function(e){return{key:e,value:t[e]}})}ar.validate=Bc;ar.processMessage=c2;var Qee=ar,ete=jx,of=Qee;function tte(t){if(typeof window<"u")return t instanceof qd.Blob||t instanceof qd.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof t=="string"||t.pipe!==void 0))return"Filename or Readable stream"}function nte(t,e){return of.assert(of.strictShape(t),e)}function rte(t){var e="date";if(typeof t=="boolean")return e;try{var n=new Date(t);if(n.getTime&&isNaN(n.getTime()))return e}catch{return e}}function ite(t){return of.tuple(of.number,of.number)(t)}var ste=ete(of,{file:tte,date:rte,coordinates:ite,assertShape:nte});function ote(t,e){var n=function(r,s){return e.indexOf(r)!==-1&&s!==void 0};return typeof e=="function"&&(n=e),Object.keys(t).filter(function(r){return n(r,t[r])}).reduce(function(r,s){return r[s]=t[s],r},{})}var ate=ote;function lte(t,e){return Object.keys(t).reduce(function(n,r){return n[r]=e(r,t[r]),n},{})}var cte=lte,ute=cte;function hte(t){return ute(t,function(e,n){return typeof n=="boolean"?JSON.stringify(n):n})}var dte=hte,fte=MF,pte=RF;function mte(t){return function(e){var n;fte.prototype.isPrototypeOf(e)?n=e:n=pte(e);var r=Object.create(t);return r.client=n,r}}var gte=mte,zF=jx,xn=ste,rx=ate,FF=dte,_te=gte,u2={},NF=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];u2.forwardGeocode=function(t){xn.assertShape({query:xn.required(xn.string),mode:xn.oneOf("mapbox.places","mapbox.places-permanent"),countries:xn.arrayOf(xn.string),proximity:xn.oneOf(xn.coordinates,"ip"),types:xn.arrayOf(xn.oneOf(NF)),autocomplete:xn.boolean,bbox:xn.arrayOf(xn.number),limit:xn.number,language:xn.arrayOf(xn.string),routing:xn.boolean,fuzzyMatch:xn.boolean,worldview:xn.string})(t),t.mode=t.mode||"mapbox.places";var e=FF(zF({country:t.countries},rx(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:rx(t,["mode","query"]),query:e})};u2.reverseGeocode=function(t){xn.assertShape({query:xn.required(xn.coordinates),mode:xn.oneOf("mapbox.places","mapbox.places-permanent"),countries:xn.arrayOf(xn.string),types:xn.arrayOf(xn.oneOf(NF)),bbox:xn.arrayOf(xn.number),limit:xn.number,language:xn.arrayOf(xn.string),reverseMode:xn.oneOf("distance","score"),routing:xn.boolean,worldview:xn.string})(t),t.mode=t.mode||"mapbox.places";var e=FF(zF({country:t.countries},rx(t,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:rx(t,["mode","query"]),query:e})};var yte=_te(u2);const vte="pk.eyJ1IjoiYnVnc2luY29kZSIsImEiOiJjbGdhNnpkeXIwd2R6M2NvNmgxZzM3NWYyIn0.wuaN3Rn-e7YPeXj5zr7o5Q";Ux.accessToken=vte;const{default:xte}=xF(()=>import("./mapbox-gl-csp-worker-1c93f7b8.js"),[]);Ux.workerClass=xte;const bte=t=>t?(t=QK(t),t=dT(t),t):"",wte=async t=>{const e=Object.keys(_j(t));let n=[];for(const r of e){const s=t[r],u=Ete(s),p=await Tte(u),o=bte(r);n.push({courier:o,stops:p,active:e.length===1})}return n},Ete=t=>t.map(n=>({timestamp:Qt.fromISO(n.timestamp),status:n.status,location:Qv.isLocation(n.location)?new Qv(n.location):n.location})),Tte=async t=>{var u,p;const e=[];let n=[...t];n.sort((o,v)=>o.timestamp<v.timestamp?-1:o.timestamp>v.timestamp?1:0);let r;for(;r=n.shift();){let o={startDate:r.timestamp,events:[r],selected:!1};if(r.location){o.location=r.location;const v=new Set([r.location.toString()]);let T=0,I=n[T];do{const F=((u=I==null?void 0:I.location)==null?void 0:u.toString())||"";v.add(F),T+=1,I=n[T]}while(v.size===1);if(T>1){let F=n.splice(0,T-1);F=[r,...F],o.events=F,o.endDate=F[F.length-1].timestamp}const L=await Ste((p=r==null?void 0:r.location)==null?void 0:p.toString());L&&(o.feature=L)}e.push(o)}const{length:s}=e;return e.forEach((o,v)=>{o.color=eee(s,v)}),Promise.resolve(e)},Ste=async t=>{const e=Wee({accessToken:Ux.accessToken}),n=yte(e);if(!(!n||!t))return n.forwardGeocode({query:t.toString(),autocomplete:!1,limit:1,mode:"mapbox.places"}).send().then(r=>{if(r&&r.body&&r.body.features&&r.body.features.length){const s=r.body.features[0];return s.coordinates||"geometry"in s&&(s.coordinates=s.geometry.coordinates),LK(s.coordinates)}}).catch(r=>{console.error(r)})};class Ate{constructor(e){Is(this,"rootStore");Is(this,"drawerOpen",!1);this.rootStore=e,uD(this),wS(()=>{this.rootStore.parcelData!==[]?Rv(()=>this.drawerOpen=!0):Rv(()=>this.drawerOpen=!1)})}get isMobile(){return this.width?this.width<768:!1}get width(){if(window)return window.innerWidth}get height(){if(window)return window.innerHeight}get drawerHeight(){return this.isMobile?this.drawerOpen&&this.height?`${this.height/2}px`:"10vh":"0px"}}class Cte{constructor(){Is(this,"uiStore");Is(this,"isLoading",!1);Is(this,"errorMessage","");Is(this,"parcelData",[]);Is(this,"trackingNumber","");Is(this,"pitch",0);uD(this),this.uiStore=new Ate(this),wS(()=>{var n;const e=(n=this.parcelData)!=null&&n.length?60:0;Rv(()=>this.pitch=e)})}clear(){return this.isLoading=!0,Promise.resolve(setTimeout(Go(()=>{this.trackingNumber="",this.parcelData=[],this.isLoading=!1}),500))}load(e){this.isLoading=!0,this.errorMessage="",this.trackingNumber=e;const n="https://package.place/api/track/"+e;fetch(n).then(r=>{if(r.ok)return r.json();throw r.status===404?new Error("Couldn't find a parcel with that tracking number"):(console.error(r),new Error("Hmmm... Something went wrong"))}).then(r=>wte(r)).then(Go("setData",r=>this.parcelData=r)).catch(Go("setError",r=>{this.errorMessage=r.message,this.clear()})).finally(Go(()=>this.isLoading=!1))}get viewStateProps(){const e=this.selectedStop;if(e){const n=e.feature;if(n)return{longitude:n.geometry.coordinates[0],latitude:n.geometry.coordinates[1],pitch:this.pitch,zoom:10}}return this.viewStateForStops}get selectedStop(){const e=this.activeCourier;if(!e)return null;const n=e.stops.filter(r=>r.selected);return n.length>0?n[0]:null}set selectedStop(e){e&&this.parcelData.forEach(n=>{n.active&&n.stops.forEach(r=>{r===e?r.selected=!e.selected:r.selected=!1})})}get features(){const e=this.activeCourier;return this.activeCourier?(e==null?void 0:e.stops.filter(n=>n.feature!==void 0).map(n=>n.feature))||[]:[]}get minimumBoundingGeometry(){return this.activeCourier?zK(uT(DK(this.features))):null}get bounds(){const e=this.minimumBoundingGeometry;if(!e)return null;const n=e.bbox;return n?[[n[0],n[1]],[n[2],n[3]]]:null}get viewStateForStops(){const e=this.bounds;if(!e)return null;let{width:n,height:r}=this.uiStore;const s=document.getElementById("Map");s&&(n=s.clientWidth,r=s.clientHeight);let u=new uh({width:n,height:r});u=u.fitBounds(e,{padding:32});const{latitude:p,longitude:o,altitude:v,bearing:T,zoom:I}=u;return{latitude:p,longitude:o,altitude:v,bearing:T,zoom:I,pitch:this.pitch}}get activeCourier(){const e=this.parcelData.filter(n=>n.active);return e.length?e[0]:null}set activeCourier(e){this.parcelData.forEach(n=>{n===e?n.active=!e.active:n.active=!1})}get arcs(){const e=this.activeCourier;return e?e.stops.filter(s=>s.feature!==null&&s.feature!==void 0).reduce((s,u,p,o)=>{var v,T;if(p<o.length-1){const I=o[p+1],L={from:{name:u.location?u.location.toString():u.events[0].status,coordindates:(v=u.feature)==null?void 0:v.geometry.coordinates},to:{name:I.location?I.location.toString():u.events[0].status,coordindates:(T=I.feature)==null?void 0:T.geometry.coordinates},color:u.color};return[...s,L]}return[...s]},[]):[]}get arcsLayer(){return this.activeCourier?[new QS({id:"stops",data:this.arcs,getSourcePosition:e=>[...e.from.coordindates,0],getTargetPosition:e=>[...e.to.coordindates,0],getSourceColor:e=>{var n;return((n=e==null?void 0:e.color)==null?void 0:n.rgba)??[0,0,0,255]},getTargetColor:e=>{var n;return((n=e==null?void 0:e.color)==null?void 0:n.rgba)??[0,0,0,255]},getHeight:.25,getWidth:3})]:[]}}const BF=We.createContext(void 0),Hc=()=>{const t=We.useContext(BF);if(!t)throw new Error("Must use `useStore` within a StoreProvider");return t.store},Mte=({store:t,children:e})=>Rt(BF.Provider,{value:{store:t},children:e});const Pte=ws(function(){const e=Hc(),{uiStore:n}=e,r=Go("toggleDrawer",()=>{n.drawerOpen=!n.drawerOpen});return Sr("section",{className:"Drawer is-hidden-tablet has-background-light",children:[Rt("button",{onClick:r,className:"button is-light m-2",title:"Open drawer",children:Rt(f8,{className:`Drawer-button ${n.drawerOpen?"Drawer-button__open":"Drawer-button__closed"}`})}),Sr("div",{className:"Drawer-content",style:{maxHeight:n.drawerOpen?n.drawerHeight:0},children:[Rt(jF,{}),Rt(HF,{})]})]})});function UF(){return new URLSearchParams(Fg().search)}const Ite=ws(function(){const e=xO(),n=UF(),r=Fg(),s=Hc(),u=n.get("trackingNumber"),[p,o]=We.useState(u||""),[v,T]=We.useState(""),[I,L]=We.useState("Submit");return We.useEffect(()=>{u&&r.pathname==="/"&&o(u)},[u,r]),We.useEffect(()=>{s.errorMessage?T("is-danger"):T("")},[s.errorMessage]),We.useEffect(()=>{s.parcelData.length>0&&s.trackingNumber===p?L("Clear"):L("Submit")},[s.parcelData,s.trackingNumber,p]),Rt("form",{onSubmit:j=>{j.preventDefault(),I==="Clear"?(o(""),e("/")):e(`/?trackingNumber=${p}`)},className:`Form ${s.parcelData.length>0&&"Form__on-top"} has-background-light box`,children:Sr("fieldset",{disabled:s.isLoading,className:"Form-content content is-small",children:[Rt("h1",{className:s.parcelData?"is-size-5":"is-size-3",children:"Parcel Tracker"}),Rt("p",{className:`${s.parcelData.length&&"is-hidden"}`,children:"Enter in a tracking number from Canada Post, Purolator, DHL, FedEx, SkyNet Worldwide, USPS, or UPS, and see the order history plotted on the map!"}),Sr("div",{className:"field has-addons",children:[Rt("div",{className:"control is-expanded",children:Rt("input",{id:"trackingNumber",type:"text",placeholder:"Tracking Number",value:p||"",onChange:j=>o(j.target.value),className:`input is-fullwidth ${v}`,required:!0})}),Rt("div",{className:"control",children:Rt("button",{className:`button ${v}`,type:"submit",children:I})})]}),s.errorMessage&&Rt("p",{className:"has-text-danger",children:s.errorMessage})]})})});function Rte(t){return Kg({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M18.364 17.364L12 23.728l-6.364-6.364a9 9 0 1 1 12.728 0zM12 13a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"}}]}]})(t)}const kte=t=>{const[e,n]=We.useState(()=>t?"selected":"");return We.useEffect(()=>n(()=>t?"selected":""),[t]),e},Lte=(t,e)=>{const[n,r]=We.useState(()=>(t==null?void 0:t.hex)??"#000");return We.useEffect(()=>{t&&r(e?tee(t,.8).hex:t.hex)},[e,t]),n},VF=ws(function({selected:e,color:n,onClick:r,iconSize:s,iconContent:u,content:p}){const o=kte(e||!1),v=Lte(n,e||!1);return Sr("div",{className:`ListItem ${o}`,onClick:r,children:[Rt("div",{className:`ListItem_icon ${o}`,children:Rt("div",{className:"ListItem_icon--fill",style:{backgroundColor:v,width:s,height:s},children:u})}),Rt("div",{className:"ListItem_content",children:p})]})}),Ote=ws(function({event:e,...n}){return Rt(VF,{content:Sr(ox,{children:[Rt("h4",{className:"is-size-6",children:e.status}),Rt("p",{className:"is-size-7",children:e.timestamp.toLocaleString(Qt.DATETIME_MED)})]}),iconSize:"15px",...n})}),Dte=ws(function({stop:e,displayConnector:n}){const r=Hc(),s=We.useMemo(()=>{var v;return!!((v=e.location)!=null&&v.toString())},[e]),u=We.useMemo(()=>{var T;const v=(T=e==null?void 0:e.location)==null?void 0:T.toString();return v||(e.events.length>0?e.events[0].status:e.startDate.toString())},[e]),p=We.useMemo(()=>{const{startDate:v,endDate:T}=e,I=[];return e.events.length===1?e.location?I.push(v.toLocaleString(Qt.DATE_MED)):I.push(v.toLocaleString(Qt.DATETIME_MED)):I.push(v.toLocaleString(Qt.DATE_MED)),T&&(T.hasSame(v,"day")||I.push(T.toLocaleString(Qt.DATE_MED))),I.join(" - ")},[e]),o=()=>r.selectedStop=e;return Sr("div",{children:[Rt(VF,{selected:e.selected,iconSize:"30px",onClick:o,color:e.color,content:Sr(ox,{children:[Rt("h4",{className:"is-size-5 mb-0 has-text-weight-medium",children:u}),Rt("p",{className:"is-size-6",children:p})]}),iconContent:Rt("div",{className:"ListItem_icon--fill",children:n?Rt(Rte,{}):Rt(p8,{})})}),s&&e.events.map((v,T)=>Rt(Ote,{event:v,color:e.color,onClick:o,selected:e.selected},`${v.status}-${T}`))]})}),zte=ws(function({stops:e}){return Rt("div",{children:e.map((n,r)=>Rt(Dte,{stop:n,displayConnector:e.length>1&&r<e.length-1},n.startDate.toString()))})}),Fte=ws(function({data:e,collapsable:n}){const r=Hc(),s=()=>{n&&Rv(()=>r.activeCourier=e)};return Sr(ox,{children:[Sr("div",{onClick:s,className:"has-background-light p-2",children:[Sr("h5",{className:"mb-0",children:["Delivered by ",e.courier]}),n?Rt(d8,{onClick:s,className:e.active?"caretExpanded":"caretCollapsed"}):null]}),Rt("div",{children:Rt(zte,{stops:e.stops})})]})}),Nte=ws(function(){const e=Hc();return Rt("div",{children:e.parcelData.map((n,r)=>Sr(Bs.Fragment,{children:[Rt(Fte,{data:n,collapsable:e.parcelData.length>1}),r!==e.parcelData.length-1&&Rt("span",{style:{backgroundColor:"#ff0"}})]},n.courier))})}),jF=ws(function(){return Hc().parcelData.length>0?Rt(Nte,{}):Sr(ox,{children:[Rt(ane,{}),!1]})}),Bte=We.createContext(null);function Ute(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function QR(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function ek(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const s=t.center;t.center=new s.constructor(n.longitude,n.latitude),r=r||s!==t.center}if("zoom"in n){const s=t.zoom;t.zoom=n.zoom,r=r||s!==t.zoom}if("bearing"in n){const s=t.bearing;t.bearing=n.bearing,r=r||s!==t.bearing}if("pitch"in n){const s=t.pitch;t.pitch=n.pitch,r=r||s!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const Vte=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function tk(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{const s=e[r.ref];let u=null;if("interactive"in r&&(u={...r},delete u.interactive),s){u=u||{...r},delete u.ref;for(const p of Vte)p in s&&(u[p]=s[p])}return u||r});return{...t,layers:n}}function jte(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,s=Array.isArray(e)?e[0]:e?e.x:0,u=Array.isArray(e)?e[1]:e?e.y:0;return n===s&&r===u}function gc(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!gc(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!gc(t[s],e[s]))return!1;return!0}return!1}const nk={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Sw={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},rk={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Gte=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Wte=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class kf{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=s=>{const u=this.props[rk[s.type]];u&&u(s)},this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const u=this.props[nk[s.type]];if(u){if(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"){const p=this._hoveredFeatures||this._map.queryRenderedFeatures(s.point,{layers:this.props.interactiveLayerIds});s.features=p}u(s),delete s.features}},this._onCameraEvent=s=>{if(!this._internalUpdate){const u=this.props[Sw[s.type]];u&&u(s)}s.type in this._deferredEvents&&(this._deferredEvents[s.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const s=this._updateSize(e),u=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||s||u&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=kf.savedMaps.pop();if(!r)return null;const s=r.map,u=s.getContainer();for(n.className=u.className;u.childNodes.length>0;)n.appendChild(u.childNodes[0]);s._container=n,r.setProps({...e,styleDiffing:!1}),s.resize();const{initialViewState:p}=e;return p&&(p.bounds?s.fitBounds(p.bounds,{...p.fitBoundsOptions,duration:0}):r._updateViewState(p,!1)),s.isStyleLoaded()?s.fire("load"):s.once("styledata",()=>s.fire("load")),r}_initialize(e){const{props:n}=this,r={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||$te()||null,container:e,style:tk(n.mapStyle)},s=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const T=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=T,n.gl)}const u=new this._MapClass(r);s.padding&&u.setPadding(s.padding),n.cursor&&(u.getCanvas().style.cursor=n.cursor),this._createShadowTransform(u);const p=u._render;u._render=T=>{this._inRender=!0,p.call(u,T),this._inRender=!1};const o=u._renderTaskQueue.run;u._renderTaskQueue.run=T=>{o.call(u._renderTaskQueue,T),this._onBeforeRepaint()},u.on("render",()=>this._onAfterRepaint());const v=u.fire;u.fire=this._fireEvent.bind(this,v),u.on("resize",()=>{this._renderTransform.resize(u.transform.width,u.transform.height)}),u.on("styledata",()=>this._updateStyleComponents(this.props,{})),u.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const T in nk)u.on(T,this._onPointerEvent);for(const T in Sw)u.on(T,this._onCameraEvent);for(const T in rk)u.on(T,this._onEvent);this._map=u}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),kf.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=Ute(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,s=this._renderTransform,{zoom:u,pitch:p,bearing:o}=s,v=r.isMoving();v&&(s.cameraElevationReference="sea");const T=ek(s,{...QR(r.transform),...e});if(v&&(s.cameraElevationReference="ground"),T&&n){const I=this._deferredEvents;I.move=!0,I.zoom||(I.zoom=u!==s.zoom),I.rotate||(I.rotate=o!==s.bearing),I.pitch||(I.pitch=p!==s.pitch)}return v||ek(r.transform,e),T}_updateSettings(e,n){const r=this._map;let s=!1;for(const u of Gte)u in e&&!gc(e[u],n[u])&&(s=!0,r[`set${u[0].toUpperCase()}${u.slice(1)}`](e[u]));return s}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor),e.mapStyle!==n.mapStyle){const r={diff:e.styleDiffing};return"localIdeographFontFamily"in e&&(r.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(tk(e.mapStyle),r),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let s=!1;return r.style.loaded()&&("light"in e&&!gc(e.light,n.light)&&(s=!0,r.setLight(e.light)),"fog"in e&&!gc(e.fog,n.fog)&&(s=!0,r.setFog(e.fog)),"terrain"in e&&!gc(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(s=!0,r.setTerrain(e.terrain))),s}_updateHandlers(e,n){const r=this._map;let s=!1;for(const u of Wte){const p=e[u];gc(p,n[u])||(s=!0,p?r[u].enable(p):r[u].disable())}return s}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const u=e.type,p=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0;let o;if(u==="mousemove")try{o=this._map.queryRenderedFeatures(e.point,{layers:r.interactiveLayerIds})}catch{o=[]}else o=[];const v=o.length>0;!v&&p&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=o,v&&!p&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=u}else this._hoveredFeatures=null}_fireEvent(e,n,r){const s=this._map,u=s.transform,p=typeof n=="string"?n:n.type;return p==="move"&&this._updateViewState(this.props,!1),p in Sw&&(typeof n=="object"&&(n.viewState=QR(u)),this._map.isMoving())?(s.transform=this._renderTransform,e.call(s,n,r),s.transform=u,s):(e.call(s,n,r),s)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=n}}}kf.savedMaps=[];function $te(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_HOME:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",ANDROID_SDK_ROOT:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",APPDATA:"C:\\Users\\USER\\AppData\\Roaming",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\LOCAL\\crashpad_2396_XQNPDLUZICTAWSPV",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"EZRA",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EFC_5396:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\USER",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\USER",INIT_CWD:"C:\\Users\\USER\\Desktop\\parcel-tracker",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\USER\\AppData\\Local",LOGONSERVER:"\\\\EZRA",NODE:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",NODE_ENV:"production",NODE_PATH:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.pnpm\\node_modules",npm_command:"run-script",npm_config_legacy_peer_deps:"true",npm_config_registry:"https://registry.npmjs.org/",npm_config_store_dir:"C:/Users/USER/AppData/Local/pnpm/store",npm_config_user_agent:"pnpm/8.2.0 npm/? node/v18.1.0 win32 x64",npm_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_lifecycle_event:"build",npm_lifecycle_script:"vite build",npm_node_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_package_dependencies_bulma:"^0.9.4",npm_package_dependencies_bulma_extensions:"^6.2.7",npm_package_dependencies_deck_gl:"^8.9.7",npm_package_dependencies_luxon:"^3.3.0",npm_package_dependencies_mapbox_gl:"^2.13.0",npm_package_dependencies_mobx:"^6.9.0",npm_package_dependencies_mobx_react:"^8.0.0",npm_package_dependencies_mobx_utils:"^6.0.6",npm_package_dependencies_react:"^18.2.0",npm_package_dependencies_react_dom:"^18.2.0",npm_package_dependencies_react_icons:"^4.8.0",npm_package_dependencies_react_map_gl:"^7.0.21",npm_package_dependencies_react_router:"^6.10.0",npm_package_dependencies_react_router_dom:"^6.10.0",npm_package_dependencies_worker_loader:"^3.0.8",npm_package_dependencies__creativebulma_bulma_collapsible:"^1.0.4",npm_package_dependencies__danmarshall_deckgl_typings:"^4.9.28",npm_package_dependencies__deck_gl_core:"^8.9.7",npm_package_dependencies__mapbox_mapbox_sdk:"^0.15.0",npm_package_dependencies__turf_bbox:"^6.5.0",npm_package_dependencies__turf_bbox_polygon:"^6.5.0",npm_package_dependencies__turf_helpers:"^6.5.0",npm_package_dependencies__types_luxon:"^3.3.0",npm_package_dependencies__types_mapbox_gl:"^2.7.10",npm_package_dependencies__types_mapbox__mapbox_sdk:"^0.13.4",npm_package_devDependencies_sass:"^1.61.0",npm_package_devDependencies_typescript:"^4.9.5",npm_package_devDependencies_vite:"^4.2.1",npm_package_devDependencies__types_node:"^18.15.11",npm_package_devDependencies__types_react:"^18.0.33",npm_package_devDependencies__types_react_dom:"^18.0.11",npm_package_devDependencies__vitejs_plugin_react:"^3.1.0",npm_package_name:"parcel-tracker",npm_package_private:"true",npm_package_scripts_build:"vite build",npm_package_scripts_dev:"vite",npm_package_scripts_preview:"vite preview",npm_package_type:"module",npm_package_version:"0.0.0",NUMBER_OF_PROCESSORS:"4",OneDrive:"C:\\Users\\USER\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.bin;C:\\snapshot\\dist\\node-gyp-bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Git\\cmd;C:\\Program Files\\PostgreSQL\\14\\bin;C:\\Program Files\\dotnet\\;C:\\Program Files (x86)\\ADB and Fastboot++;C:\\Users\\USER\\AppData\\Local\\pnpm;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\Scripts\\;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\;C:\\Users\\USER\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\USER\\AppData\\Roaming\\npm;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\cmdline-tools\\latest\\bin;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\emulator;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\platform-tools;",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JSE;.WSF;.WSH;.MSC;.CPL",PNPM_HOME:"C:\\Users\\USER\\AppData\\Local\\pnpm",PNPM_SCRIPT_SRC_DIR:"C:\\Users\\USER\\Desktop\\parcel-tracker",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 69 Stepping 1, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"4501",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\USER\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\USER\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.77.0",TMP:"C:\\Users\\USER\\AppData\\Local\\Temp",USERDOMAIN:"EZRA",USERDOMAIN_ROAMINGPROFILE:"EZRA",USERNAME:"USER",USERPROFILE:"C:\\Users\\USER",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"--ms-enable-electron-run-as-node",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-b0a863057a-sock",VSCODE_INJECTION:"1",windir:"C:\\WINDOWS"}.MapboxAccessToken}catch{}try{t=t||{ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_HOME:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",ANDROID_SDK_ROOT:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",APPDATA:"C:\\Users\\USER\\AppData\\Roaming",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\LOCAL\\crashpad_2396_XQNPDLUZICTAWSPV",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"EZRA",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EFC_5396:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\USER",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\USER",INIT_CWD:"C:\\Users\\USER\\Desktop\\parcel-tracker",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\USER\\AppData\\Local",LOGONSERVER:"\\\\EZRA",NODE:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",NODE_ENV:"production",NODE_PATH:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.pnpm\\node_modules",npm_command:"run-script",npm_config_legacy_peer_deps:"true",npm_config_registry:"https://registry.npmjs.org/",npm_config_store_dir:"C:/Users/USER/AppData/Local/pnpm/store",npm_config_user_agent:"pnpm/8.2.0 npm/? node/v18.1.0 win32 x64",npm_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_lifecycle_event:"build",npm_lifecycle_script:"vite build",npm_node_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_package_dependencies_bulma:"^0.9.4",npm_package_dependencies_bulma_extensions:"^6.2.7",npm_package_dependencies_deck_gl:"^8.9.7",npm_package_dependencies_luxon:"^3.3.0",npm_package_dependencies_mapbox_gl:"^2.13.0",npm_package_dependencies_mobx:"^6.9.0",npm_package_dependencies_mobx_react:"^8.0.0",npm_package_dependencies_mobx_utils:"^6.0.6",npm_package_dependencies_react:"^18.2.0",npm_package_dependencies_react_dom:"^18.2.0",npm_package_dependencies_react_icons:"^4.8.0",npm_package_dependencies_react_map_gl:"^7.0.21",npm_package_dependencies_react_router:"^6.10.0",npm_package_dependencies_react_router_dom:"^6.10.0",npm_package_dependencies_worker_loader:"^3.0.8",npm_package_dependencies__creativebulma_bulma_collapsible:"^1.0.4",npm_package_dependencies__danmarshall_deckgl_typings:"^4.9.28",npm_package_dependencies__deck_gl_core:"^8.9.7",npm_package_dependencies__mapbox_mapbox_sdk:"^0.15.0",npm_package_dependencies__turf_bbox:"^6.5.0",npm_package_dependencies__turf_bbox_polygon:"^6.5.0",npm_package_dependencies__turf_helpers:"^6.5.0",npm_package_dependencies__types_luxon:"^3.3.0",npm_package_dependencies__types_mapbox_gl:"^2.7.10",npm_package_dependencies__types_mapbox__mapbox_sdk:"^0.13.4",npm_package_devDependencies_sass:"^1.61.0",npm_package_devDependencies_typescript:"^4.9.5",npm_package_devDependencies_vite:"^4.2.1",npm_package_devDependencies__types_node:"^18.15.11",npm_package_devDependencies__types_react:"^18.0.33",npm_package_devDependencies__types_react_dom:"^18.0.11",npm_package_devDependencies__vitejs_plugin_react:"^3.1.0",npm_package_name:"parcel-tracker",npm_package_private:"true",npm_package_scripts_build:"vite build",npm_package_scripts_dev:"vite",npm_package_scripts_preview:"vite preview",npm_package_type:"module",npm_package_version:"0.0.0",NUMBER_OF_PROCESSORS:"4",OneDrive:"C:\\Users\\USER\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.bin;C:\\snapshot\\dist\\node-gyp-bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Git\\cmd;C:\\Program Files\\PostgreSQL\\14\\bin;C:\\Program Files\\dotnet\\;C:\\Program Files (x86)\\ADB and Fastboot++;C:\\Users\\USER\\AppData\\Local\\pnpm;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\Scripts\\;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\;C:\\Users\\USER\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\USER\\AppData\\Roaming\\npm;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\cmdline-tools\\latest\\bin;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\emulator;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\platform-tools;",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JSE;.WSF;.WSH;.MSC;.CPL",PNPM_HOME:"C:\\Users\\USER\\AppData\\Local\\pnpm",PNPM_SCRIPT_SRC_DIR:"C:\\Users\\USER\\Desktop\\parcel-tracker",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 69 Stepping 1, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"4501",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\USER\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\USER\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.77.0",TMP:"C:\\Users\\USER\\AppData\\Local\\Temp",USERDOMAIN:"EZRA",USERDOMAIN_ROAMINGPROFILE:"EZRA",USERNAME:"USER",USERPROFILE:"C:\\Users\\USER",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"--ms-enable-electron-run-as-node",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-b0a863057a-sock",VSCODE_INJECTION:"1",windir:"C:\\WINDOWS"}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const Hte=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Zte(t,e){if(!t)return null;const n=t.map,r={getMap:()=>n,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:s=>t.transform.locationPoint(e.LngLat.convert(s)),unproject:s=>t.transform.pointLocation(e.Point.convert(s)),queryTerrainElevation:(s,u)=>{const p=n.transform;n.transform=t.transform;const o=n.queryTerrainElevation(s,u);return n.transform=p,o}};for(const s of qte(n))!(s in r)&&!Hte.includes(s)&&(r[s]=n[s].bind(n));return r}function qte(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const Xte=typeof document<"u"?We.useLayoutEffect:We.useEffect,Yte=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Kte(t,e){for(const n of Yte)n in e&&(t[n]=e[n]);e.RTLTextPlugin&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(e.RTLTextPlugin,n=>{n&&console.error(n)},!1)}const Gx=We.createContext(null),Jte={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:t=>console.error(t.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},h2=We.forwardRef((t,e)=>{const n=We.useContext(Bte),[r,s]=We.useState(null),u=We.useRef(),{current:p}=We.useRef({mapLib:null,map:null});We.useEffect(()=>{const v=t.mapLib;let T=!0,I;return Promise.resolve(v||xF(()=>Promise.resolve().then(()=>see),void 0)).then(L=>{if(T){if(L.Map||(L=L.default),!L||!L.Map)throw new Error("Invalid mapLib");if(L.supported(t))Kte(L,t),t.reuseMaps&&(I=kf.reuse(t,u.current)),I||(I=new kf(L.Map,t,u.current)),p.map=Zte(I,L),p.mapLib=L,s(I),n==null||n.onMapMount(p.map,t.id);else throw new Error("Map is not supported by this browser")}}).catch(L=>{t.onError({type:"error",target:null,originalEvent:null,error:L})}),()=>{T=!1,I&&(n==null||n.onMapUnmount(t.id),t.reuseMaps?I.recycle():I.destroy())}},[]),Xte(()=>{r&&r.setProps(t)}),We.useImperativeHandle(e,()=>p.map,[r]);const o=We.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]);return We.createElement("div",{id:t.id,ref:u,style:o},r&&We.createElement(Gx.Provider,{value:p},We.createElement("div",{"mapboxgl-children":""},t.children)))});h2.displayName="Map";h2.defaultProps=Jte;const Qte=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function yh(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const s=e[r];Number.isFinite(s)&&!Qte.test(r)?n[r]=`${s}px`:n[r]=s}}const ene={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function GF(t){const{map:e,mapLib:n}=We.useContext(Gx),r=We.useRef({props:t});r.current.props=t;const s=We.useMemo(()=>{let u=!1;We.Children.forEach(t.children,v=>{v&&(u=!0)});const p={...t,element:u?document.createElement("div"):null},o=new n.Marker(p).setLngLat([t.longitude,t.latitude]);return o.getElement().addEventListener("click",v=>{var T,I;(I=(T=r.current.props).onClick)===null||I===void 0||I.call(T,{type:"click",target:o,originalEvent:v})}),o.on("dragstart",v=>{var T,I;const L=v;L.lngLat=s.getLngLat(),(I=(T=r.current.props).onDragStart)===null||I===void 0||I.call(T,L)}),o.on("drag",v=>{var T,I;const L=v;L.lngLat=s.getLngLat(),(I=(T=r.current.props).onDrag)===null||I===void 0||I.call(T,L)}),o.on("dragend",v=>{var T,I;const L=v;L.lngLat=s.getLngLat(),(I=(T=r.current.props).onDragEnd)===null||I===void 0||I.call(T,L)}),o},[]);return We.useEffect(()=>(s.addTo(e.getMap()),()=>{s.remove()}),[]),We.useEffect(()=>{yh(s.getElement(),t.style)},[t.style]),(s.getLngLat().lng!==t.longitude||s.getLngLat().lat!==t.latitude)&&s.setLngLat([t.longitude,t.latitude]),t.offset&&!jte(s.getOffset(),t.offset)&&s.setOffset(t.offset),s.isDraggable()!==t.draggable&&s.setDraggable(t.draggable),s.getRotation()!==t.rotation&&s.setRotation(t.rotation),s.getRotationAlignment()!==t.rotationAlignment&&s.setRotationAlignment(t.rotationAlignment),s.getPitchAlignment()!==t.pitchAlignment&&s.setPitchAlignment(t.pitchAlignment),s.getPopup()!==t.popup&&s.setPopup(t.popup),af.createPortal(t.children,s.getElement())}GF.defaultProps=ene;We.memo(GF);function ik(t){return new Set(t?t.trim().split(/\s+/):[])}function tne(t){const{map:e,mapLib:n}=We.useContext(Gx),r=We.useMemo(()=>document.createElement("div"),[]),s=We.useRef({props:t});s.current.props=t;const u=We.useMemo(()=>{const p={...t},o=new n.Popup(p).setLngLat([t.longitude,t.latitude]);return o.once("open",v=>{var T,I;(I=(T=s.current.props).onOpen)===null||I===void 0||I.call(T,v)}),o},[]);if(We.useEffect(()=>{const p=o=>{var v,T;(T=(v=s.current.props).onClose)===null||T===void 0||T.call(v,o)};return u.on("close",p),u.setDOMContent(r).addTo(e.getMap()),()=>{u.off("close",p),u.isOpen()&&u.remove()}},[]),We.useEffect(()=>{yh(u.getElement(),t.style)},[t.style]),u.isOpen()&&((u.getLngLat().lng!==t.longitude||u.getLngLat().lat!==t.latitude)&&u.setLngLat([t.longitude,t.latitude]),t.offset&&!gc(u.options.offset,t.offset)&&u.setOffset(t.offset),(u.options.anchor!==t.anchor||u.options.maxWidth!==t.maxWidth)&&(u.options.anchor=t.anchor,u.setMaxWidth(t.maxWidth)),u.options.className!==t.className)){const p=ik(u.options.className),o=ik(t.className);for(const v of p)o.has(v)||u.removeClassName(v);for(const v of o)p.has(v)||u.addClassName(v);u.options.className=t.className}return af.createPortal(t.children,r)}We.memo(tne);function h_(t,e,n,r){const s=We.useContext(Gx),u=We.useMemo(()=>t(s),[]);return We.useEffect(()=>{const p=r||n||e,o=typeof e=="function"&&typeof n=="function"?e:null,v=typeof n=="function"?n:typeof e=="function"?e:null,{map:T}=s;return T.hasControl(u)||(T.addControl(u,p==null?void 0:p.position),o&&o(s)),()=>{v&&v(s),T.hasControl(u)&&T.removeControl(u)}},[]),u}function nne(t){const e=h_(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return We.useEffect(()=>{yh(e._container,t.style)},[t.style]),null}We.memo(nne);function rne(t){const e=h_(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return We.useEffect(()=>{yh(e._controlContainer,t.style)},[t.style]),null}We.memo(rne);const WF=We.forwardRef((t,e)=>{const n=We.useRef({props:t}),r=h_(({mapLib:s})=>{const u=new s.GeolocateControl(t),p=u._setupUI;return u._setupUI=o=>{u._container.hasChildNodes()||p(o)},u.on("geolocate",o=>{var v,T;(T=(v=n.current.props).onGeolocate)===null||T===void 0||T.call(v,o)}),u.on("error",o=>{var v,T;(T=(v=n.current.props).onError)===null||T===void 0||T.call(v,o)}),u.on("outofmaxbounds",o=>{var v,T;(T=(v=n.current.props).onOutOfMaxBounds)===null||T===void 0||T.call(v,o)}),u.on("trackuserlocationstart",o=>{var v,T;(T=(v=n.current.props).onTrackUserLocationStart)===null||T===void 0||T.call(v,o)}),u.on("trackuserlocationend",o=>{var v,T;(T=(v=n.current.props).onTrackUserLocationEnd)===null||T===void 0||T.call(v,o)}),u},{position:t.position});return n.current.props=t,We.useImperativeHandle(e,()=>({trigger:()=>r.trigger()}),[]),We.useEffect(()=>{yh(r._container,t.style)},[t.style]),null});WF.displayName="GeolocateControl";We.memo(WF);function ine(t){const e=h_(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return We.useEffect(()=>{yh(e._container,t.style)},[t.style]),null}We.memo(ine);const sne={unit:"metric",maxWidth:100};function $F(t){const e=h_(({mapLib:n})=>new n.ScaleControl(t),{position:t.position});return(e.options.unit!==t.unit||e.options.maxWidth!==t.maxWidth)&&(e.options.maxWidth=t.maxWidth,e.setUnit(t.unit)),We.useEffect(()=>{yh(e._container,t.style)},[t.style]),null}$F.defaultProps=sne;We.memo($F);const sk={longitude:0,latitude:0,zoom:1,pitch:0,bearing:0},one=ws(function(){const e=Hc(),[n,r]=We.useState(sk);return We.useEffect(()=>{var u;(u=document.getElementById("deckgl-wrapper"))==null||u.addEventListener("contextmenu",p=>p.preventDefault())},[]),We.useEffect(()=>{const u=e.viewStateProps;u&&r({...u,transitionInterpolator:new kK,transitionDuration:500})},[e.viewStateProps]),Sr("main",{className:"Map",id:"Map",children:[Sr("section",{className:"Map-content",children:[Rt(Ite,{}),Rt(JK,{viewState:n||sk,onViewStateChange:u=>r(u.viewState),layers:e.arcsLayer,controller:!0,getTooltip:({object:u})=>{if(u){const p=u;return{text:`${p.from.name} to ${p.to.name}`}}return null},children:Rt(h2,{style:{width:"100%",height:"100%"},mapStyle:"mapbox://styles/mapbox/streets-v12",mapboxAccessToken:"pk.eyJ1IjoiYnVnc2luY29kZSIsImEiOiJjbGdhNnpkeXIwd2R6M2NvNmgxZzM3NWYyIn0.wuaN3Rn-e7YPeXj5zr7o5Q"})})]}),Rt(Pte,{})]})}),ane=ws(function(){const e=Hc();return Sr("section",{className:`content ${e.uiStore.isMobile?"pb-2":"p-2"}`,children:[Sr("h3",{children:["About ",Rt("b",{children:"unboX"})]}),Rt("p",{children:"This tool is built for people who like to keep track of their online purchases or shipments across major couriers all in one app."}),Rt("p",{children:"It can be frustrating not knowing the whereabouts of a package or when it will arrive, especially if it's a time-sensitive delivery."}),Sr("p",{children:["For the technical details and to peak into the code, checkout the For technical details and insight into the development approach, checkout the ",Rt("a",{href:"https://githuib.com/adeyinkaezra123/unboX",children:"Github Repo."})]}),Rt("p",{children:"If you find any bugs or have a way to improve this, feel free to raise an issue or make a PR"})]})}),HF=()=>Sr("footer",{className:"Sidebar-footer p-2 has-background-light has-text-centered",children:[Rt("a",{className:"is-size-7 text-muted",href:"https://www.github.com/adeyinkaezra123/unboX",target:"_blank",rel:"noreferrer",title:"source code",children:"Check out the code on Github"}),Sr("p",{className:"is-size-7 is-italic",children:["© Copyright ",new Date().getFullYear()," -"," "]}),Rt("p",{className:"is-size-7 is-italic",children:"Made by Ezra Adeyinka with lots of ❤️ and ☕"})]});const lne=ws(function(){return Sr("aside",{className:"Sidebar is-hidden-mobile",children:[Rt("header",{className:"Sidebar-header has-background-light",children:Rt("h2",{className:"title is-4",children:"📦 unboX"})}),Rt("section",{className:"Sidebar-content py-4 mb-0",children:Rt("div",{className:"has-text-left px-3 mt-2",children:Rt(jF,{})})}),Rt(HF,{})]})});function cne(t){return Kg({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M16 8c-0.020-1.045-0.247-2.086-0.665-3.038-0.417-0.953-1.023-1.817-1.766-2.53s-1.624-1.278-2.578-1.651c-0.953-0.374-1.978-0.552-2.991-0.531-1.013 0.020-2.021 0.24-2.943 0.646-0.923 0.405-1.758 0.992-2.449 1.712s-1.237 1.574-1.597 2.497c-0.361 0.923-0.533 1.914-0.512 2.895 0.020 0.981 0.234 1.955 0.627 2.847 0.392 0.892 0.961 1.7 1.658 2.368s1.523 1.195 2.416 1.543c0.892 0.348 1.851 0.514 2.799 0.493 0.949-0.020 1.89-0.227 2.751-0.608 0.862-0.379 1.642-0.929 2.287-1.604s1.154-1.472 1.488-2.335c0.204-0.523 0.342-1.069 0.415-1.622 0.019 0.001 0.039 0.002 0.059 0.002 0.552 0 1-0.448 1-1 0-0.028-0.001-0.056-0.004-0.083h0.004zM14.411 10.655c-0.367 0.831-0.898 1.584-1.55 2.206s-1.422 1.112-2.254 1.434c-0.832 0.323-1.723 0.476-2.608 0.454-0.884-0.020-1.759-0.215-2.56-0.57-0.801-0.354-1.526-0.867-2.125-1.495s-1.071-1.371-1.38-2.173c-0.31-0.801-0.457-1.66-0.435-2.512s0.208-1.694 0.551-2.464c0.342-0.77 0.836-1.468 1.441-2.044s1.321-1.029 2.092-1.326c0.771-0.298 1.596-0.438 2.416-0.416s1.629 0.202 2.368 0.532c0.74 0.329 1.41 0.805 1.963 1.387s0.988 1.27 1.272 2.011c0.285 0.74 0.418 1.532 0.397 2.32h0.004c-0.002 0.027-0.004 0.055-0.004 0.083 0 0.516 0.39 0.94 0.892 0.994-0.097 0.544-0.258 1.075-0.481 1.578z"}}]})(t)}const une=ws(function({isLoading:e}){return Rt("div",{className:`Loading ${e?"visible":"hidden"}`,children:Rt(cne,{children:Rt("span",{className:"sr-only",children:"Loading..."})})})}),ev=new Cte,hne=()=>Sr("div",{className:"App",children:[Rt(une,{isLoading:ev.isLoading}),Rt(lne,{}),Rt(one,{})]}),dne=ws(function(){const e=UF(),n=Fg(),r=e.get("trackingNumber");return We.useEffect(()=>{r&&n.pathname==="/"?ev.load(r):ev.clear()},[r,n]),Rt(Mte,{store:ev,children:Sr($6,{children:[Rt(EE,{path:"/",element:Rt(hne,{})}),Rt(EE,{element:Rt(G6,{to:"/"})})]})})});Cw.createRoot(document.getElementById("root")).render(Rt(Bs.StrictMode,{children:Rt(H6,{children:Rt(dne,{})})}));
