(function(){var zp=Qo;function Qo(r,e,t,n){this.cx=3*r,this.bx=3*(t-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=t,this.p2y=n}Qo.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var t=r,n=0;n<8;n++){var i=this.sampleCurveX(t)-r;if(Math.abs(i)<e)return t;var s=this.sampleCurveDerivativeX(t);if(Math.abs(s)<1e-6)break;t-=i/s}var a=0,o=1;for(t=r,n=0;n<20&&(i=this.sampleCurveX(t),!(Math.abs(i-r)<e));n++)r>i?a=t:o=t,t=.5*(o-a)+a;return t},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var O=yr;function yr(r,e){this.x=r,this.y=e}yr.prototype={clone:function(){return new yr(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,t=r.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),t=Math.sin(r),n=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=n,this},_rotateAround:function(r,e){var t=Math.cos(r),n=Math.sin(r),i=e.y+n*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yr.convert=function(r){return r instanceof yr?r:Array.isArray(r)?new yr(r[0],r[1]):r};var W=typeof self<"u"?self:{};const Dp=Math.PI/180,Bp=180/Math.PI;function me(r){return r*Dp}function et(r){return r*Bp}function ue(r,e,t){return Math.min(t,Math.max(e,r))}function el(r,e,t){const n=t-e,i=((r-e)%n+n)%n+e;return i===e?t:i}function _s(r){const e=[];for(const t in r)e.push(r[t]);return e}function Ve(r,...e){for(const t of e)for(const n in t)r[n]=t[n];return r}let Rp=1;function tl(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function rl(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function nl(r,e){r.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function ws(r,e){return r.indexOf(e,r.length-e.length)!==-1}function Ss(r,e,t){const n={};for(const i in r)n[i]=e.call(t||this,r[i],i,r);return n}function Vt(r){return Array.isArray(r)?r.map(Vt):typeof r=="object"&&r?Ss(r,Vt):r}const il={};function Pe(r){il[r]||(typeof console<"u"&&console.warn(r),il[r]=!0)}function Lt(r,e,t){return(t.y-r.y)*(e.x-r.x)>(e.y-r.y)*(t.x-r.x)}function Vp(r){let e=0;for(let t,n,i=0,s=r.length,a=s-1;i<s;a=i++)t=r[i],n=r[a],e+=(n.x-t.x)*(t.y+n.y);return e}function mr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function As(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,n,i,s)=>{const a=i||s;return e[n]=!a||a.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let ks=null;function sl(r){if(ks==null){const e=r.navigator?r.navigator.userAgent:null;ks=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ks}function al(r){try{const e=W[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Is(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}var gr=ft;function ft(r,e,t){var n=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var i=new Int32Array(this.arrayBuffer);r=i[0],this.d=(e=i[1])+2*(t=i[2]);for(var s=0;s<this.d*this.d;s++){var a=i[3+s],o=i[3+s+1];n.push(a===o?null:i.subarray(a,o))}var l=i[3+n.length+1];this.keys=i.subarray(i[3+n.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=t,this.scale=e/r,this.uid=0;var c=t/e*r;this.min=-c,this.max=r+c}ft.prototype.insert=function(r,e,t,n,i){this._forEachCell(e,t,n,i,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i)},ft.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ft.prototype._insertCell=function(r,e,t,n,i,s){this.cells[i].push(s)},ft.prototype.query=function(r,e,t,n,i){var s=this.min,a=this.max;if(r<=s&&e<=s&&a<=t&&a<=n&&!i)return Array.prototype.slice.call(this.keys);var o=[];return this._forEachCell(r,e,t,n,this._queryCell,o,{},i),o},ft.prototype._queryCell=function(r,e,t,n,i,s,a,o){var l=this.cells[i];if(l!==null)for(var u=this.keys,c=this.bboxes,p=0;p<l.length;p++){var h=l[p];if(a[h]===void 0){var d=4*h;(o?o(c[d+0],c[d+1],c[d+2],c[d+3]):r<=c[d+2]&&e<=c[d+3]&&t>=c[d+0]&&n>=c[d+1])?(a[h]=!0,s.push(u[h])):a[h]=!1}}},ft.prototype._forEachCell=function(r,e,t,n,i,s,a,o){for(var l=this._convertToCellCoord(r),u=this._convertToCellCoord(e),c=this._convertToCellCoord(t),p=this._convertToCellCoord(n),h=l;h<=c;h++)for(var d=u;d<=p;d++){var f=this.d*d+h;if((!o||o(this._convertFromCellCoord(h),this._convertFromCellCoord(d),this._convertFromCellCoord(h+1),this._convertFromCellCoord(d+1)))&&i.call(this,r,e,t,n,f,s,a,o))return}},ft.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},ft.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},ft.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=3+this.cells.length+1+1,t=0,n=0;n<this.cells.length;n++)t+=this.cells[n].length;var i=new Int32Array(e+t+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var s=e,a=0;a<r.length;a++){var o=r[a];i[3+a]=s,i.set(o,s),s+=o.length}return i[3+r.length]=s,i.set(this.keys,s),i[3+r.length+1]=s+=this.keys.length,i.set(this.bboxes,s),s+=this.bboxes.length,i.buffer};var Ms,ol={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Zn(r){return(r=Math.round(r))<0?0:r>255?255:r}function Ts(r){return Zn(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function Xn(r){return(e=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function Cs(r,e,t){return t<0?t+=1:t>1&&(t-=1),6*t<1?r+(e-r)*t*6:2*t<1?e:3*t<2?r+(e-r)*(2/3-t)*6:r}try{Ms={}.parseCSSColor=function(r){var e,t=r.replace(/ /g,"").toLowerCase();if(t in ol)return ol[t].slice();if(t[0]==="#")return t.length===4?(e=parseInt(t.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:t.length===7&&(e=parseInt(t.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=t.indexOf("("),i=t.indexOf(")");if(n!==-1&&i+1===t.length){var s=t.substr(0,n),a=t.substr(n+1,i-(n+1)).split(","),o=1;switch(s){case"rgba":if(a.length!==4)return null;o=Xn(a.pop());case"rgb":return a.length!==3?null:[Ts(a[0]),Ts(a[1]),Ts(a[2]),o];case"hsla":if(a.length!==4)return null;o=Xn(a.pop());case"hsl":if(a.length!==3)return null;var l=(parseFloat(a[0])%360+360)%360/360,u=Xn(a[1]),c=Xn(a[2]),p=c<=.5?c*(u+1):c+u-c*u,h=2*c-p;return[Zn(255*Cs(h,p,l+1/3)),Zn(255*Cs(h,p,l)),Zn(255*Cs(h,p,l-1/3)),o];default:return null}}return null}}catch{}class We{constructor(e,t,n,i=1){this.r=e,this.g=t,this.b=n,this.a=i}static parse(e){if(!e)return;if(e instanceof We)return e;if(typeof e!="string")return;const t=Ms(e);return t?new We(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,i]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(n)},${i})`}toArray(){const{r:e,g:t,b:n,a:i}=this;return i===0?[0,0,0,0]:[255*e/i,255*t/i,255*n/i,i]}toArray01(){const{r:e,g:t,b:n,a:i}=this;return i===0?[0,0,0,0]:[e/i,t/i,n/i,i]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:n,a:i}=this;return[e,t,n,i]}}We.black=new We(0,0,0,1),We.white=new We(1,1,1,1),We.transparent=new We(0,0,0,0),We.red=new We(1,0,0,1),We.blue=new We(0,0,1,1);var Ce=We;function er(r,...e){for(const t of e)for(const n in t)r[n]=t[n];return r}class Lp extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var yt=Lp;class Es{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new Es(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Fp=Es;const Hr={kind:"null"},F={kind:"number"},ne={kind:"string"},ee={kind:"boolean"},mt={kind:"color"},xr={kind:"object"},te={kind:"value"},Wn={kind:"collator"},Kr={kind:"formatted"},Jr={kind:"resolvedImage"};function tt(r,e){return{kind:"array",itemType:r,N:e}}function Ae(r){if(r.kind==="array"){const e=Ae(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Up=[Hr,F,ne,ee,mt,Kr,xr,tt(te),Jr];function Qr(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Qr(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const t of Up)if(!Qr(t,e))return null}}return`Expected ${Ae(r)} but found ${Ae(e)} instead.`}function Ps(r,e){return e.some(t=>t.kind===r.kind)}function en(r,e){return e.some(t=>t==="null"?r===null:t==="array"?Array.isArray(r):t==="object"?r&&!Array.isArray(r)&&typeof r=="object":t===typeof r)}class zs{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ds{constructor(e,t,n,i,s){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=s}}class Ye{constructor(e){this.sections=e}static fromString(e){return new Ye([new Ds(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Ye?e:Ye.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class rt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new rt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function ll(r,e,t,n){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[r,e,t,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[r,e,t,n]:[r,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Yn(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Ce||r instanceof zs||r instanceof Ye||r instanceof rt)return!0;if(Array.isArray(r)){for(const e of r)if(!Yn(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Yn(r[e]))return!1;return!0}return!1}function ze(r){if(r===null)return Hr;if(typeof r=="string")return ne;if(typeof r=="boolean")return ee;if(typeof r=="number")return F;if(r instanceof Ce)return mt;if(r instanceof zs)return Wn;if(r instanceof Ye)return Kr;if(r instanceof rt)return Jr;if(Array.isArray(r)){const e=r.length;let t;for(const n of r){const i=ze(n);if(t){if(t===i)continue;t=te;break}t=i}return tt(t||te,e)}return xr}function tn(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Ce||r instanceof Ye||r instanceof rt?r.toString():JSON.stringify(r)}class Bs{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Yn(e[1]))return t.error("invalid value");const n=e[1];let i=ze(n);const s=t.expectedType;return i.kind!=="array"||i.N!==0||!s||s.kind!=="array"||typeof s.N=="number"&&s.N!==0||(i=s),new Bs(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ce?["rgba"].concat(this.value.toArray()):this.value instanceof Ye?this.value.serialize():this.value}}var rn=Bs,Oe=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Rs={string:ne,number:F,boolean:ee,object:xr};class Vs{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const s=e[0];if(s==="array"){let o,l;if(e.length>2){const u=e[1];if(typeof u!="string"||!(u in Rs)||u==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);o=Rs[u],i++}else o=te;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],i++}n=tt(o,l)}else n=Rs[s];const a=[];for(;i<e.length;i++){const o=t.parse(e[i],i,te);if(!o)return null;a.push(o)}return new Vs(n,a)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!Qr(this.type,ze(n)))return n;if(t===this.args.length-1)throw new Oe(`Expected value to be of type ${Ae(this.type)}, but found ${Ae(ze(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){t.push(n.kind);const i=e.N;(typeof i=="number"||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map(n=>n.serialize()))}}var At=Vs;class nn{constructor(e){this.type=Kr,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return t.error("First argument must be an image or text section.");const i=[];let s=!1;for(let a=1;a<=e.length-1;++a){const o=e[a];if(s&&typeof o=="object"&&!Array.isArray(o)){s=!1;let l=null;if(o["font-scale"]&&(l=t.parse(o["font-scale"],1,F),!l))return null;let u=null;if(o["text-font"]&&(u=t.parse(o["text-font"],1,tt(ne)),!u))return null;let c=null;if(o["text-color"]&&(c=t.parse(o["text-color"],1,mt),!c))return null;const p=i[i.length-1];p.scale=l,p.font=u,p.textColor=c}else{const l=t.parse(e[a],1,te);if(!l)return null;const u=l.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,i.push({content:l,scale:null,font:null,textColor:null})}}return new nn(i)}evaluate(e){return new Ye(this.sections.map(t=>{const n=t.content.evaluate(e);return ze(n)===Jr?new Ds("",n,null,null,null):new Ds(tn(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class Hn{constructor(e){this.type=Jr,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const n=t.parse(e[1],1,ne);return n?new Hn(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=rt.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Op={"to-boolean":ee,"to-color":mt,"to-number":F,"to-string":ne};class Ls{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return t.error("Expected one argument.");const i=Op[n],s=[];for(let a=1;a<e.length;a++){const o=t.parse(e[a],a,te);if(!o)return null;s.push(o)}return new Ls(i,s)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof Ce)return t;if(typeof t=="string"){const s=e.parseColor(t);if(s)return s}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:ll(t[0],t[1],t[2],t[3]),!n))return new Ce(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Oe(n||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}if(this.type.kind==="number"){let t=null;for(const n of this.args){if(t=n.evaluate(e),t===null)return 0;const i=Number(t);if(!isNaN(i))return i}throw new Oe(`Could not convert ${JSON.stringify(t)} to number.`)}return this.type.kind==="formatted"?Ye.fromString(tn(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?rt.fromString(tn(this.args[0].evaluate(e))):tn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new nn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Hn(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var vr=Ls;const jp=["Unknown","Point","LineString","Polygon"];var ul=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?jp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ce.parse(e)),t}};class br{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const n=e[0],i=br.definitions[n];if(!i)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,o=a.filter(([u])=>!Array.isArray(u)||u.length===e.length-1);let l=null;for(const[u,c]of o){l=new gl(t.registry,t.path,null,t.scope);const p=[];let h=!1;for(let d=1;d<e.length;d++){const f=e[d],y=Array.isArray(u)?u[d-1]:u.type,m=l.parse(f,1+p.length,y);if(!m){h=!0;break}p.push(m)}if(!h)if(Array.isArray(u)&&u.length!==p.length)l.error(`Expected ${u.length} arguments, but found ${p.length} instead.`);else{for(let d=0;d<p.length;d++){const f=Array.isArray(u)?u[d]:u.type,y=p[d];l.concat(d+1).checkSubtype(f,y.type)}if(l.errors.length===0)return new br(n,s,c,p)}}if(o.length===1)t.errors.push(...l.errors);else{const u=(o.length?o:a).map(([p])=>{return h=p,Array.isArray(h)?`(${h.map(Ae).join(", ")})`:`(${Ae(h.type)}...)`;var h}).join(" | "),c=[];for(let p=1;p<e.length;p++){const h=t.parse(e[p],1+c.length);if(!h)return null;c.push(Ae(h.type))}t.error(`Expected arguments of type ${u}, but found (${c.join(", ")}) instead.`)}return null}static register(e,t){br.definitions=t;for(const n in t)e[n]=br}}var Ft=br;class Kn{constructor(e,t,n){this.type=Wn,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,ee);if(!i)return null;const s=t.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,ee);if(!s)return null;let a=null;return n.locale&&(a=t.parse(n.locale,1,ne),!a)?null:new Kn(i,s,a)}evaluate(e){return new zs(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ut=8192;function Fs(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Jn(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Np(r,e){const t=(180+r[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(t*i*Ut),Math.round(n*i*Ut)]}function $p(r,e,t){const n=r[0]-e[0],i=r[1]-e[1],s=r[0]-t[0],a=r[1]-t[1];return n*a-s*i==0&&n*s<=0&&i*a<=0}function Us(r,e){let t=!1;for(let a=0,o=e.length;a<o;a++){const l=e[a];for(let u=0,c=l.length;u<c-1;u++){if($p(r,l[u],l[u+1]))return!1;(i=l[u])[1]>(n=r)[1]!=(s=l[u+1])[1]>n[1]&&n[0]<(s[0]-i[0])*(n[1]-i[1])/(s[1]-i[1])+i[0]&&(t=!t)}}var n,i,s;return t}function qp(r,e){for(let t=0;t<e.length;t++)if(Us(r,e[t]))return!0;return!1}function cl(r,e,t,n){const i=n[0]-t[0],s=n[1]-t[1],a=(r[0]-t[0])*s-i*(r[1]-t[1]),o=(e[0]-t[0])*s-i*(e[1]-t[1]);return a>0&&o<0||a<0&&o>0}function Gp(r,e,t){for(const u of t)for(let c=0;c<u.length-1;++c)if((o=[(a=u[c+1])[0]-(s=u[c])[0],a[1]-s[1]])[0]*(l=[(i=e)[0]-(n=r)[0],i[1]-n[1]])[1]-o[1]*l[0]!=0&&cl(n,i,s,a)&&cl(s,a,n,i))return!0;var n,i,s,a,o,l;return!1}function hl(r,e){for(let t=0;t<r.length;++t)if(!Us(r[t],e))return!1;for(let t=0;t<r.length-1;++t)if(Gp(r[t],r[t+1],e))return!1;return!0}function Zp(r,e){for(let t=0;t<e.length;t++)if(hl(r,e[t]))return!0;return!1}function Os(r,e,t){const n=[];for(let i=0;i<r.length;i++){const s=[];for(let a=0;a<r[i].length;a++){const o=Np(r[i][a],t);Fs(e,o),s.push(o)}n.push(s)}return n}function pl(r,e,t){const n=[];for(let i=0;i<r.length;i++){const s=Os(r[i],e,t);n.push(s)}return n}function dl(r,e,t,n){if(r[0]<t[0]||r[0]>t[2]){const i=.5*n;let s=r[0]-t[0]>i?-n:t[0]-r[0]>i?n:0;s===0&&(s=r[0]-t[2]>i?-n:t[2]-r[0]>i?n:0),r[0]+=s}Fs(e,r)}function fl(r,e,t,n){const i=Math.pow(2,n.z)*Ut,s=[n.x*Ut,n.y*Ut],a=[];if(!r)return a;for(const o of r)for(const l of o){const u=[l.x+s[0],l.y+s[1]];dl(u,e,t,i),a.push(u)}return a}function yl(r,e,t,n){const i=Math.pow(2,n.z)*Ut,s=[n.x*Ut,n.y*Ut],a=[];if(!r)return a;for(const l of r){const u=[];for(const c of l){const p=[c.x+s[0],c.y+s[1]];Fs(e,p),u.push(p)}a.push(u)}if(e[2]-e[0]<=i/2){(o=e)[0]=o[1]=1/0,o[2]=o[3]=-1/0;for(const l of a)for(const u of l)dl(u,e,t,i)}var o;return a}class sn{constructor(e,t){this.type=ee,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Yn(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let i=0;i<n.features.length;++i){const s=n.features[i].geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new sn(n,n.features[i].geometry)}else if(n.type==="Feature"){const i=n.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new sn(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new sn(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,n){const i=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],a=t.canonicalID();if(!a)return!1;if(n.type==="Polygon"){const o=Os(n.coordinates,s,a),l=fl(t.geometry(),i,s,a);if(!Jn(i,s))return!1;for(const u of l)if(!Us(u,o))return!1}if(n.type==="MultiPolygon"){const o=pl(n.coordinates,s,a),l=fl(t.geometry(),i,s,a);if(!Jn(i,s))return!1;for(const u of l)if(!qp(u,o))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,n){const i=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],a=t.canonicalID();if(!a)return!1;if(n.type==="Polygon"){const o=Os(n.coordinates,s,a),l=yl(t.geometry(),i,s,a);if(!Jn(i,s))return!1;for(const u of l)if(!hl(u,o))return!1}if(n.type==="MultiPolygon"){const o=pl(n.coordinates,s,a),l=yl(t.geometry(),i,s,a);if(!Jn(i,s))return!1;for(const u of l)if(!Zp(u,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var js=sn;function an(r){if(r instanceof Ft&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof js)return!1;let e=!0;return r.eachChild(t=>{e&&!an(t)&&(e=!1)}),e}function Qn(r){if(r instanceof Ft&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(t=>{e&&!Qn(t)&&(e=!1)}),e}function ei(r,e){if(r instanceof Ft&&e.indexOf(r.name)>=0)return!1;let t=!0;return r.eachChild(n=>{t&&!ei(n,e)&&(t=!1)}),t}class Ns{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new Ns(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ml=Ns;class $s{constructor(e,t=[],n,i=new Fp,s=[]){this.registry=e,this.path=t,this.key=t.map(a=>`[${a}]`).join(""),this.scope=i,this.errors=s,this.expectedType=n}parse(e,t,n,i,s={}){return t?this.concat(t,n,i)._parse(e,s):this._parse(e,s)}_parse(e,t){function n(i,s,a){return a==="assert"?new At(s,[i]):a==="coerce"?new vr(s,[i]):i}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if(typeof i!="string")return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[i];if(s){let a=s.parse(e,this);if(!a)return null;if(this.expectedType){const o=this.expectedType,l=a.type;if(o.kind!=="string"&&o.kind!=="number"&&o.kind!=="boolean"&&o.kind!=="object"&&o.kind!=="array"||l.kind!=="value")if(o.kind!=="color"&&o.kind!=="formatted"&&o.kind!=="resolvedImage"||l.kind!=="value"&&l.kind!=="string"){if(this.checkSubtype(o,l))return null}else a=n(a,o,t.typeAnnotation||"coerce");else a=n(a,o,t.typeAnnotation||"assert")}if(!(a instanceof rn)&&a.type.kind!=="resolvedImage"&&qs(a)){const o=new ul;try{a=new rn(a.type,a.evaluate(o))}catch(l){return this.error(l.message),null}}return a}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const i=typeof e=="number"?this.path.concat(e):this.path,s=n?this.scope.concat(n):this.scope;return new $s(this.registry,i,t||null,s,this.errors)}error(e,...t){const n=`${this.key}${t.map(i=>`[${i}]`).join("")}`;this.errors.push(new yt(n,e))}checkSubtype(e,t){const n=Qr(e,t);return n&&this.error(n),n}}var gl=$s;function qs(r){if(r instanceof ml)return qs(r.boundExpression);if(r instanceof Ft&&r.name==="error"||r instanceof Kn||r instanceof js)return!1;const e=r instanceof vr||r instanceof At;let t=!0;return r.eachChild(n=>{t=e?t&&qs(n):t&&n instanceof rn}),!!t&&an(r)&&ei(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ti(r,e){const t=r.length-1;let n,i,s=0,a=t,o=0;for(;s<=a;)if(o=Math.floor((s+a)/2),n=r[o],i=r[o+1],n<=e){if(o===t||e<i)return o;s=o+1}else{if(!(n>e))throw new Oe("Input is not a number.");a=o-1}return 0}class Gs{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,s]of n)this.labels.push(i),this.outputs.push(s)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,F);if(!n)return null;const i=[];let s=null;t.expectedType&&t.expectedType.kind!=="value"&&(s=t.expectedType);for(let a=1;a<e.length;a+=2){const o=a===1?-1/0:e[a],l=e[a+1],u=a,c=a+1;if(typeof o!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const p=t.parse(l,c,s);if(!p)return null;s=s||p.type,i.push([o,p])}return new Gs(s,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const s=t.length;return i>=t[s-1]?n[s-1].evaluate(e):n[ti(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Zs=Gs;function de(r,e,t){return r*(1-t)+e*t}var ri=Object.freeze({__proto__:null,number:de,color:function(r,e,t){return new Ce(de(r.r,e.r,t),de(r.g,e.g,t),de(r.b,e.b,t),de(r.a,e.a,t))},array:function(r,e,t){return r.map((n,i)=>de(n,e[i],t))}});const xl=.95047,vl=1.08883,bl=4/29,Xs=6/29,_l=3*Xs*Xs,Xp=Math.PI/180,Wp=180/Math.PI;function Ws(r){return r>.008856451679035631?Math.pow(r,1/3):r/_l+bl}function Ys(r){return r>Xs?r*r*r:_l*(r-bl)}function Hs(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Ks(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function wl(r){const e=Ks(r.r),t=Ks(r.g),n=Ks(r.b),i=Ws((.4124564*e+.3575761*t+.1804375*n)/xl),s=Ws((.2126729*e+.7151522*t+.072175*n)/1);return{l:116*s-16,a:500*(i-s),b:200*(s-Ws((.0193339*e+.119192*t+.9503041*n)/vl)),alpha:r.a}}function Sl(r){let e=(r.l+16)/116,t=isNaN(r.a)?e:e+r.a/500,n=isNaN(r.b)?e:e-r.b/200;return e=1*Ys(e),t=xl*Ys(t),n=vl*Ys(n),new Ce(Hs(3.2404542*t-1.5371385*e-.4985314*n),Hs(-.969266*t+1.8760108*e+.041556*n),Hs(.0556434*t-.2040259*e+1.0572252*n),r.alpha)}function Yp(r,e,t){const n=e-r;return r+t*(n>180||n<-180?n-360*Math.round(n/360):n)}const on={forward:wl,reverse:Sl,interpolate:function(r,e,t){return{l:de(r.l,e.l,t),a:de(r.a,e.a,t),b:de(r.b,e.b,t),alpha:de(r.alpha,e.alpha,t)}}},ln={forward:function(r){const{l:e,a:t,b:n}=wl(r),i=Math.atan2(n,t)*Wp;return{h:i<0?i+360:i,c:Math.sqrt(t*t+n*n),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Xp,t=r.c;return Sl({l:r.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:r.alpha})},interpolate:function(r,e,t){return{h:Yp(r.h,e.h,t),c:de(r.c,e.c,t),l:de(r.l,e.l,t),alpha:de(r.alpha,e.alpha,t)}}};var Al=Object.freeze({__proto__:null,lab:on,hcl:ln});class ni{constructor(e,t,n,i,s){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[a,o]of s)this.labels.push(a),this.outputs.push(o)}static interpolationFactor(e,t,n,i){let s=0;if(e.name==="exponential")s=Js(t,e.base,n,i);else if(e.name==="linear")s=Js(t,1,n,i);else if(e.name==="cubic-bezier"){const a=e.controlPoints;s=new zp(a[0],a[1],a[2],a[3]).solve(Js(t,1,n,i))}return s}static parse(e,t){let[n,i,s,...a]=e;if(!Array.isArray(i)||i.length===0)return t.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const u=i[1];if(typeof u!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:u}}else{if(i[0]!=="cubic-bezier")return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const u=i.slice(1);if(u.length!==4||u.some(c=>typeof c!="number"||c<0||c>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:u}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(s=t.parse(s,2,F),!s)return null;const o=[];let l=null;n==="interpolate-hcl"||n==="interpolate-lab"?l=mt:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let u=0;u<a.length;u+=2){const c=a[u],p=a[u+1],h=u+3,d=u+4;if(typeof c!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',h);if(o.length&&o[o.length-1][0]>=c)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',h);const f=t.parse(p,d,l);if(!f)return null;l=l||f.type,o.push([c,f])}return l.kind==="number"||l.kind==="color"||l.kind==="array"&&l.itemType.kind==="number"&&typeof l.N=="number"?new ni(l,n,i,s,o):t.error(`Type ${Ae(l)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const s=t.length;if(i>=t[s-1])return n[s-1].evaluate(e);const a=ti(t,i),o=ni.interpolationFactor(this.interpolation,i,t[a],t[a+1]),l=n[a].evaluate(e),u=n[a+1].evaluate(e);return this.operator==="interpolate"?ri[this.type.kind.toLowerCase()](l,u,o):this.operator==="interpolate-hcl"?ln.reverse(ln.interpolate(ln.forward(l),ln.forward(u),o)):on.reverse(on.interpolate(on.forward(l),on.forward(u),o))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function Js(r,e,t,n){const i=n-t,s=r-t;return i===0?0:e===1?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}var gt=ni;class Qs{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&i.kind!=="value"&&(n=i);const s=[];for(const o of e.slice(1)){const l=t.parse(o,1+s.length,n,void 0,{typeAnnotation:"omit"});if(!l)return null;n=n||l.type,s.push(l)}const a=i&&s.some(o=>Qr(i,o.type));return new Qs(a?te:n,s)}evaluate(e){let t,n=null,i=0;for(const s of this.args){if(i++,n=s.evaluate(e),n&&n instanceof rt&&!n.available&&(t||(t=n),n=null,i===this.args.length))return t;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var kl=Qs;class ea{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let s=1;s<e.length-1;s+=2){const a=e[s];if(typeof a!="string")return t.error(`Expected string, but found ${typeof a} instead.`,s);if(/[^a-zA-Z0-9_]/.test(a))return t.error("Variable names must contain only alphanumeric characters or '_'.",s);const o=t.parse(e[s+1],s+1);if(!o)return null;n.push([a,o])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new ea(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}var Il=ea;class ta{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,F),i=t.parse(e[2],2,tt(t.expectedType||te));return n&&i?new ta(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Oe(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new Oe(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new Oe(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Hp=ta;class ra{constructor(e,t){this.type=ee,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,te),i=t.parse(e[2],2,te);return n&&i?Ps(n.type,[ee,ne,F,Hr,te])?new ra(n,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ae(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!en(t,["boolean","string","number","null"]))throw new Oe(`Expected first argument to be of type boolean, string, number or null, but found ${Ae(ze(t))} instead.`);if(!en(n,["string","array"]))throw new Oe(`Expected second argument to be of type array or string, but found ${Ae(ze(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Kp=ra;class ii{constructor(e,t,n){this.type=F,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,te),i=t.parse(e[2],2,te);if(!n||!i)return null;if(!Ps(n.type,[ee,ne,F,Hr,te]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ae(n.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,F);return s?new ii(n,i,s):null}return new ii(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!en(t,["boolean","string","number","null"]))throw new Oe(`Expected first argument to be of type boolean, string, number or null, but found ${Ae(ze(t))} instead.`);if(!en(n,["string","array"]))throw new Oe(`Expected second argument to be of type array or string, but found ${Ae(ze(n))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Jp=ii;class na{constructor(e,t,n,i,s,a){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=s,this.otherwise=a}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&t.expectedType.kind!=="value"&&(i=t.expectedType);const s={},a=[];for(let u=2;u<e.length-1;u+=2){let c=e[u];const p=e[u+1];Array.isArray(c)||(c=[c]);const h=t.concat(u);if(c.length===0)return h.error("Expected at least one branch label.");for(const f of c){if(typeof f!="number"&&typeof f!="string")return h.error("Branch labels must be numbers or strings.");if(typeof f=="number"&&Math.abs(f)>Number.MAX_SAFE_INTEGER)return h.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof f=="number"&&Math.floor(f)!==f)return h.error("Numeric branch labels must be integer values.");if(n){if(h.checkSubtype(n,ze(f)))return null}else n=ze(f);if(s[String(f)]!==void 0)return h.error("Branch labels must be unique.");s[String(f)]=a.length}const d=t.parse(p,u,i);if(!d)return null;i=i||d.type,a.push(d)}const o=t.parse(e[1],1,te);if(!o)return null;const l=t.parse(e[e.length-1],e.length-1,i);return l?o.type.kind!=="value"&&t.concat(1).checkSubtype(n,o.type)?null:new na(n,i,o,s,a,l):null}evaluate(e){const t=this.input.evaluate(e);return(ze(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],i={};for(const a of t){const o=i[this.cases[a]];o===void 0?(i[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[o][1].push(a)}const s=a=>this.inputType.kind==="number"?Number(a):a;for(const[a,o]of n)e.push(o.length===1?s(o[0]):o.map(s)),e.push(this.outputs[a].serialize());return e.push(this.otherwise.serialize()),e}}var Qp=na;class ia{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&t.expectedType.kind!=="value"&&(n=t.expectedType);const i=[];for(let a=1;a<e.length-1;a+=2){const o=t.parse(e[a],a,ee);if(!o)return null;const l=t.parse(e[a+1],a+1,n);if(!l)return null;i.push([o,l]),n=n||l.type}const s=t.parse(e[e.length-1],e.length-1,n);return s?new ia(n,i,s):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var ed=ia;class si{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,te),i=t.parse(e[2],2,F);if(!n||!i)return null;if(!Ps(n.type,[tt(te),ne,te]))return t.error(`Expected first argument to be of type array or string, but found ${Ae(n.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,F);return s?new si(n.type,n,i,s):null}return new si(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!en(t,["string","array"]))throw new Oe(`Expected first argument to be of type array or string, but found ${Ae(ze(t))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var td=si;function Ml(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Tl(r,e,t,n){return n.compare(e,t)===0}function _r(r,e,t){const n=r!=="=="&&r!=="!=";return class Pp{constructor(s,a,o){this.type=ee,this.lhs=s,this.rhs=a,this.collator=o,this.hasUntypedArgument=s.type.kind==="value"||a.type.kind==="value"}static parse(s,a){if(s.length!==3&&s.length!==4)return a.error("Expected two or three arguments.");const o=s[0];let l=a.parse(s[1],1,te);if(!l)return null;if(!Ml(o,l.type))return a.concat(1).error(`"${o}" comparisons are not supported for type '${Ae(l.type)}'.`);let u=a.parse(s[2],2,te);if(!u)return null;if(!Ml(o,u.type))return a.concat(2).error(`"${o}" comparisons are not supported for type '${Ae(u.type)}'.`);if(l.type.kind!==u.type.kind&&l.type.kind!=="value"&&u.type.kind!=="value")return a.error(`Cannot compare types '${Ae(l.type)}' and '${Ae(u.type)}'.`);n&&(l.type.kind==="value"&&u.type.kind!=="value"?l=new At(u.type,[l]):l.type.kind!=="value"&&u.type.kind==="value"&&(u=new At(l.type,[u])));let c=null;if(s.length===4){if(l.type.kind!=="string"&&u.type.kind!=="string"&&l.type.kind!=="value"&&u.type.kind!=="value")return a.error("Cannot use collator to compare non-string types.");if(c=a.parse(s[3],3,Wn),!c)return null}return new Pp(l,u,c)}evaluate(s){const a=this.lhs.evaluate(s),o=this.rhs.evaluate(s);if(n&&this.hasUntypedArgument){const l=ze(a),u=ze(o);if(l.kind!==u.kind||l.kind!=="string"&&l.kind!=="number")throw new Oe(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const l=ze(a),u=ze(o);if(l.kind!=="string"||u.kind!=="string")return e(s,a,o)}return this.collator?t(s,a,o,this.collator.evaluate(s)):e(s,a,o)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}serialize(){const s=[r];return this.eachChild(a=>{s.push(a.serialize())}),s}}}const rd=_r("==",function(r,e,t){return e===t},Tl),nd=_r("!=",function(r,e,t){return e!==t},function(r,e,t,n){return!Tl(0,e,t,n)}),id=_r("<",function(r,e,t){return e<t},function(r,e,t,n){return n.compare(e,t)<0}),sd=_r(">",function(r,e,t){return e>t},function(r,e,t,n){return n.compare(e,t)>0}),ad=_r("<=",function(r,e,t){return e<=t},function(r,e,t,n){return n.compare(e,t)<=0}),od=_r(">=",function(r,e,t){return e>=t},function(r,e,t,n){return n.compare(e,t)>=0});class sa{constructor(e,t,n,i,s,a){this.type=ne,this.number=e,this.locale=t,this.currency=n,this.unit=i,this.minFractionDigits=s,this.maxFractionDigits=a}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const n=t.parse(e[1],1,F);if(!n)return null;const i=e[2];if(typeof i!="object"||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let s=null;if(i.locale&&(s=t.parse(i.locale,1,ne),!s))return null;let a=null;if(i.currency&&(a=t.parse(i.currency,1,ne),!a))return null;let o=null;if(i.unit&&(o=t.parse(i.unit,1,ne),!o))return null;let l=null;if(i["min-fraction-digits"]&&(l=t.parse(i["min-fraction-digits"],1,F),!l))return null;let u=null;return i["max-fraction-digits"]&&(u=t.parse(i["max-fraction-digits"],1,F),!u)?null:new sa(n,s,a,o,l,u)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class aa{constructor(e){this.type=F,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${Ae(n.type)} instead.`):new aa(n):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Oe(`Expected value to be of type string or array, but found ${Ae(ze(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const Cl={"==":rd,"!=":nd,">":sd,"<":id,">=":od,"<=":ad,array:At,at:Hp,boolean:At,case:ed,coalesce:kl,collator:Kn,format:nn,image:Hn,in:Kp,"index-of":Jp,interpolate:gt,"interpolate-hcl":gt,"interpolate-lab":gt,length:aa,let:Il,literal:rn,match:Qp,number:At,"number-format":sa,object:At,slice:td,step:Zs,string:At,"to-boolean":vr,"to-color":vr,"to-number":vr,"to-string":vr,var:ml,within:js};function El(r,[e,t,n,i]){e=e.evaluate(r),t=t.evaluate(r),n=n.evaluate(r);const s=i?i.evaluate(r):1,a=ll(e,t,n,s);if(a)throw new Oe(a);return new Ce(e/255*s,t/255*s,n/255*s,s)}function Pl(r,e){return r in e}function oa(r,e){const t=e[r];return t===void 0?null:t}function tr(r){return{type:r}}Ft.register(Cl,{error:[{kind:"error"},[ne],(r,[e])=>{throw new Oe(e.evaluate(r))}],typeof:[ne,[te],(r,[e])=>Ae(ze(e.evaluate(r)))],"to-rgba":[tt(F,4),[mt],(r,[e])=>e.evaluate(r).toArray()],rgb:[mt,[F,F,F],El],rgba:[mt,[F,F,F,F],El],has:{type:ee,overloads:[[[ne],(r,[e])=>Pl(e.evaluate(r),r.properties())],[[ne,xr],(r,[e,t])=>Pl(e.evaluate(r),t.evaluate(r))]]},get:{type:te,overloads:[[[ne],(r,[e])=>oa(e.evaluate(r),r.properties())],[[ne,xr],(r,[e,t])=>oa(e.evaluate(r),t.evaluate(r))]]},"feature-state":[te,[ne],(r,[e])=>oa(e.evaluate(r),r.featureState||{})],properties:[xr,[],r=>r.properties()],"geometry-type":[ne,[],r=>r.geometryType()],id:[te,[],r=>r.id()],zoom:[F,[],r=>r.globals.zoom],pitch:[F,[],r=>r.globals.pitch||0],"distance-from-center":[F,[],r=>r.distanceFromCenter()],"heatmap-density":[F,[],r=>r.globals.heatmapDensity||0],"line-progress":[F,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[F,[],r=>r.globals.skyRadialProgress||0],accumulated:[te,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[F,tr(F),(r,e)=>{let t=0;for(const n of e)t+=n.evaluate(r);return t}],"*":[F,tr(F),(r,e)=>{let t=1;for(const n of e)t*=n.evaluate(r);return t}],"-":{type:F,overloads:[[[F,F],(r,[e,t])=>e.evaluate(r)-t.evaluate(r)],[[F],(r,[e])=>-e.evaluate(r)]]},"/":[F,[F,F],(r,[e,t])=>e.evaluate(r)/t.evaluate(r)],"%":[F,[F,F],(r,[e,t])=>e.evaluate(r)%t.evaluate(r)],ln2:[F,[],()=>Math.LN2],pi:[F,[],()=>Math.PI],e:[F,[],()=>Math.E],"^":[F,[F,F],(r,[e,t])=>Math.pow(e.evaluate(r),t.evaluate(r))],sqrt:[F,[F],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[F,[F],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[F,[F],(r,[e])=>Math.log(e.evaluate(r))],log2:[F,[F],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[F,[F],(r,[e])=>Math.sin(e.evaluate(r))],cos:[F,[F],(r,[e])=>Math.cos(e.evaluate(r))],tan:[F,[F],(r,[e])=>Math.tan(e.evaluate(r))],asin:[F,[F],(r,[e])=>Math.asin(e.evaluate(r))],acos:[F,[F],(r,[e])=>Math.acos(e.evaluate(r))],atan:[F,[F],(r,[e])=>Math.atan(e.evaluate(r))],min:[F,tr(F),(r,e)=>Math.min(...e.map(t=>t.evaluate(r)))],max:[F,tr(F),(r,e)=>Math.max(...e.map(t=>t.evaluate(r)))],abs:[F,[F],(r,[e])=>Math.abs(e.evaluate(r))],round:[F,[F],(r,[e])=>{const t=e.evaluate(r);return t<0?-Math.round(-t):Math.round(t)}],floor:[F,[F],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[F,[F],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[ee,[ne,te],(r,[e,t])=>r.properties()[e.value]===t.value],"filter-id-==":[ee,[te],(r,[e])=>r.id()===e.value],"filter-type-==":[ee,[ne],(r,[e])=>r.geometryType()===e.value],"filter-<":[ee,[ne,te],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<i}],"filter-id-<":[ee,[te],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<n}],"filter->":[ee,[ne,te],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>i}],"filter-id->":[ee,[te],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>n}],"filter-<=":[ee,[ne,te],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[ee,[te],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<=n}],"filter->=":[ee,[ne,te],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[ee,[te],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>=n}],"filter-has":[ee,[te],(r,[e])=>e.value in r.properties()],"filter-has-id":[ee,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[ee,[tt(ne)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[ee,[tt(te)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[ee,[ne,tt(te)],(r,[e,t])=>t.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[ee,[ne,tt(te)],(r,[e,t])=>function(n,i,s,a){for(;s<=a;){const o=s+a>>1;if(i[o]===n)return!0;i[o]>n?a=o-1:s=o+1}return!1}(r.properties()[e.value],t.value,0,t.value.length-1)],all:{type:ee,overloads:[[[ee,ee],(r,[e,t])=>e.evaluate(r)&&t.evaluate(r)],[tr(ee),(r,e)=>{for(const t of e)if(!t.evaluate(r))return!1;return!0}]]},any:{type:ee,overloads:[[[ee,ee],(r,[e,t])=>e.evaluate(r)||t.evaluate(r)],[tr(ee),(r,e)=>{for(const t of e)if(t.evaluate(r))return!0;return!1}]]},"!":[ee,[ee],(r,[e])=>!e.evaluate(r)],"is-supported-script":[ee,[ne],(r,[e])=>{const t=r.globals&&r.globals.isSupportedScript;return!t||t(e.evaluate(r))}],upcase:[ne,[ne],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[ne,[ne],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[ne,tr(te),(r,e)=>e.map(t=>tn(t.evaluate(r))).join("")],"resolved-locale":[ne,[Wn],(r,[e])=>e.evaluate(r).resolvedLocale()]});var un=Cl;function zl(r){return{result:"success",value:r}}function wr(r){return{result:"error",value:r}}function Sr(r){return r["property-type"]==="data-driven"}function Dl(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function la(r){return!!r.expression&&r.expression.interpolated}function oe(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function ai(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function ld(r){return r}function Bl(r,e){const t=e.type==="color",n=r.stops&&typeof r.stops[0][0]=="object",i=n||!(n||r.property!==void 0),s=r.type||(la(e)?"exponential":"interval");if(t&&((r=er({},r)).stops&&(r.stops=r.stops.map(u=>[u[0],Ce.parse(u[1])])),r.default=Ce.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Al[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let a,o,l;if(s==="exponential")a=Rl;else if(s==="interval")a=cd;else if(s==="categorical"){a=ud,o=Object.create(null);for(const u of r.stops)o[u[0]]=u[1];l=typeof r.stops[0][0]}else{if(s!=="identity")throw new Error(`Unknown function type "${s}"`);a=hd}if(n){const u={},c=[];for(let d=0;d<r.stops.length;d++){const f=r.stops[d],y=f[0].zoom;u[y]===void 0&&(u[y]={zoom:y,type:r.type,property:r.property,default:r.default,stops:[]},c.push(y)),u[y].stops.push([f[0].value,f[1]])}const p=[];for(const d of c)p.push([u[d].zoom,Bl(u[d],e)]);const h={name:"linear"};return{kind:"composite",interpolationType:h,interpolationFactor:gt.interpolationFactor.bind(void 0,h),zoomStops:p.map(d=>d[0]),evaluate:({zoom:d},f)=>Rl({stops:p,base:r.base},e,d).evaluate(d,f)}}if(i){const u=s==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:u,interpolationFactor:gt.interpolationFactor.bind(void 0,u),zoomStops:r.stops.map(c=>c[0]),evaluate:({zoom:c})=>a(r,e,c,o,l)}}return{kind:"source",evaluate(u,c){const p=c&&c.properties?c.properties[r.property]:void 0;return p===void 0?cn(r.default,e.default):a(r,e,p,o,l)}}}function cn(r,e,t){return r!==void 0?r:e!==void 0?e:t!==void 0?t:void 0}function ud(r,e,t,n,i){return cn(typeof t===i?n[t]:void 0,r.default,e.default)}function cd(r,e,t){if(oe(t)!=="number")return cn(r.default,e.default);const n=r.stops.length;if(n===1||t<=r.stops[0][0])return r.stops[0][1];if(t>=r.stops[n-1][0])return r.stops[n-1][1];const i=ti(r.stops.map(s=>s[0]),t);return r.stops[i][1]}function Rl(r,e,t){const n=r.base!==void 0?r.base:1;if(oe(t)!=="number")return cn(r.default,e.default);const i=r.stops.length;if(i===1||t<=r.stops[0][0])return r.stops[0][1];if(t>=r.stops[i-1][0])return r.stops[i-1][1];const s=ti(r.stops.map(c=>c[0]),t),a=function(c,p,h,d){const f=d-h,y=c-h;return f===0?0:p===1?y/f:(Math.pow(p,y)-1)/(Math.pow(p,f)-1)}(t,n,r.stops[s][0],r.stops[s+1][0]),o=r.stops[s][1],l=r.stops[s+1][1];let u=ri[e.type]||ld;if(r.colorSpace&&r.colorSpace!=="rgb"){const c=Al[r.colorSpace];u=(p,h)=>c.reverse(c.interpolate(c.forward(p),c.forward(h),a))}return typeof o.evaluate=="function"?{evaluate(...c){const p=o.evaluate.apply(void 0,c),h=l.evaluate.apply(void 0,c);if(p!==void 0&&h!==void 0)return u(p,h,a)}}:u(o,l,a)}function hd(r,e,t){return e.type==="color"?t=Ce.parse(t):e.type==="formatted"?t=Ye.fromString(t.toString()):e.type==="resolvedImage"?t=rt.fromString(t.toString()):oe(t)===e.type||e.type==="enum"&&e.values[t]||(t=void 0),cn(t,r.default,e.default)}class ua{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new ul,this._defaultValue=t?function(n){return n.type==="color"&&(ai(n.default)||Array.isArray(n.default))?new Ce(0,0,0,0):n.type==="color"?Ce.parse(n.default)||null:n.default===void 0?null:n.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,s,a,o,l){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=l||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,s,a,o,l){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=l||null;try{const u=this.expression.evaluate(this._evaluator);if(u==null||typeof u=="number"&&u!=u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new Oe(`Expected value to be one of ${Object.keys(this._enumValues).map(c=>JSON.stringify(c)).join(", ")}, but found ${JSON.stringify(u)} instead.`);return u}catch(u){return this._warningHistory[u.message]||(this._warningHistory[u.message]=!0,typeof console<"u"&&console.warn(u.message)),this._defaultValue}}}function oi(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in un}function rr(r,e){const t=new gl(un,[],e?function(i){const s={color:mt,string:ne,number:F,enum:ne,boolean:ee,formatted:Kr,resolvedImage:Jr};return i.type==="array"?tt(s[i.value]||te,i.length):s[i.type]}(e):void 0),n=t.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?zl(new ua(n,e)):wr(t.errors)}class ca{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Qn(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,s,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,s,a)}evaluate(e,t,n,i,s,a){return this._styleExpression.evaluate(e,t,n,i,s,a)}}class ha{constructor(e,t,n,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Qn(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,s,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,s,a)}evaluate(e,t,n,i,s,a){return this._styleExpression.evaluate(e,t,n,i,s,a)}interpolationFactor(e,t,n){return this.interpolationType?gt.interpolationFactor(this.interpolationType,e,t,n):0}}function Vl(r,e){if((r=rr(r,e)).result==="error")return r;const t=r.value.expression,n=an(t);if(!n&&!Sr(e))return wr([new yt("","data expressions not supported")]);const i=ei(t,["zoom","pitch","distance-from-center"]);if(!i&&!Dl(e))return wr([new yt("","zoom expressions not supported")]);const s=ui(t);return s||i?s instanceof yt?wr([s]):s instanceof gt&&!la(e)?wr([new yt("",'"interpolate" expressions cannot be used with this property')]):zl(s?new ha(n?"camera":"composite",r.value,s.labels,s instanceof gt?s.interpolation:void 0):new ca(n?"constant":"source",r.value)):wr([new yt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class li{constructor(e,t){this._parameters=e,this._specification=t,er(this,Bl(this._parameters,this._specification))}static deserialize(e){return new li(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ui(r){let e=null;if(r instanceof Il)e=ui(r.result);else if(r instanceof kl){for(const t of r.args)if(e=ui(t),e)break}else(r instanceof Zs||r instanceof gt)&&r.input instanceof Ft&&r.input.name==="zoom"&&(e=r);return e instanceof yt||r.eachChild(t=>{const n=ui(t);n instanceof yt?e=n:!e&&n?e=new yt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new yt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}let ci;const Me={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(ci==null){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ci={ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_HOME:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",ANDROID_SDK_ROOT:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",APPDATA:"C:\\Users\\USER\\AppData\\Roaming",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\LOCAL\\crashpad_2396_XQNPDLUZICTAWSPV",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"EZRA",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EFC_5396:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\USER",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\USER",INIT_CWD:"C:\\Users\\USER\\Desktop\\parcel-tracker",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\USER\\AppData\\Local",LOGONSERVER:"\\\\EZRA",NODE:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",NODE_ENV:"production",NODE_PATH:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.pnpm\\node_modules",npm_command:"run-script",npm_config_legacy_peer_deps:"true",npm_config_registry:"https://registry.npmjs.org/",npm_config_store_dir:"C:/Users/USER/AppData/Local/pnpm/store",npm_config_user_agent:"pnpm/8.2.0 npm/? node/v18.1.0 win32 x64",npm_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_lifecycle_event:"build",npm_lifecycle_script:"vite build",npm_node_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_package_dependencies_bulma:"^0.9.4",npm_package_dependencies_bulma_extensions:"^6.2.7",npm_package_dependencies_deck_gl:"^8.9.7",npm_package_dependencies_luxon:"^3.3.0",npm_package_dependencies_mapbox_gl:"^2.13.0",npm_package_dependencies_mobx:"^6.9.0",npm_package_dependencies_mobx_react:"^8.0.0",npm_package_dependencies_mobx_utils:"^6.0.6",npm_package_dependencies_react:"^18.2.0",npm_package_dependencies_react_dom:"^18.2.0",npm_package_dependencies_react_icons:"^4.8.0",npm_package_dependencies_react_map_gl:"^7.0.21",npm_package_dependencies_react_router:"^6.10.0",npm_package_dependencies_react_router_dom:"^6.10.0",npm_package_dependencies_worker_loader:"^3.0.8",npm_package_dependencies__creativebulma_bulma_collapsible:"^1.0.4",npm_package_dependencies__danmarshall_deckgl_typings:"^4.9.28",npm_package_dependencies__deck_gl_core:"^8.9.7",npm_package_dependencies__mapbox_mapbox_sdk:"^0.15.0",npm_package_dependencies__turf_bbox:"^6.5.0",npm_package_dependencies__turf_bbox_polygon:"^6.5.0",npm_package_dependencies__turf_helpers:"^6.5.0",npm_package_dependencies__types_luxon:"^3.3.0",npm_package_dependencies__types_mapbox_gl:"^2.7.10",npm_package_dependencies__types_mapbox__mapbox_sdk:"^0.13.4",npm_package_devDependencies_sass:"^1.61.0",npm_package_devDependencies_typescript:"^4.9.5",npm_package_devDependencies_vite:"^4.2.1",npm_package_devDependencies__types_node:"^18.15.11",npm_package_devDependencies__types_react:"^18.0.33",npm_package_devDependencies__types_react_dom:"^18.0.11",npm_package_devDependencies__vitejs_plugin_react:"^3.1.0",npm_package_name:"parcel-tracker",npm_package_private:"true",npm_package_scripts_build:"vite build",npm_package_scripts_dev:"vite",npm_package_scripts_preview:"vite preview",npm_package_type:"module",npm_package_version:"0.0.0",NUMBER_OF_PROCESSORS:"4",OneDrive:"C:\\Users\\USER\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.bin;C:\\snapshot\\dist\\node-gyp-bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Git\\cmd;C:\\Program Files\\PostgreSQL\\14\\bin;C:\\Program Files\\dotnet\\;C:\\Program Files (x86)\\ADB and Fastboot++;C:\\Users\\USER\\AppData\\Local\\pnpm;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\Scripts\\;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\;C:\\Users\\USER\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\USER\\AppData\\Roaming\\npm;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\cmdline-tools\\latest\\bin;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\emulator;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\platform-tools;",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JSE;.WSF;.WSH;.MSC;.CPL",PNPM_HOME:"C:\\Users\\USER\\AppData\\Local\\pnpm",PNPM_SCRIPT_SRC_DIR:"C:\\Users\\USER\\Desktop\\parcel-tracker",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 69 Stepping 1, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"4501",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\USER\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\USER\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.77.0",TMP:"C:\\Users\\USER\\AppData\\Local\\Temp",USERDOMAIN:"EZRA",USERDOMAIN_ROAMINGPROFILE:"EZRA",USERNAME:"USER",USERPROFILE:"C:\\Users\\USER",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"--ms-enable-electron-run-as-node",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-b0a863057a-sock",VSCODE_INJECTION:"1",windir:"C:\\WINDOWS"}.API_URL_REGEX!=null?new RegExp({ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_HOME:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",ANDROID_SDK_ROOT:"C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\",APPDATA:"C:\\Users\\USER\\AppData\\Roaming",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\LOCAL\\crashpad_2396_XQNPDLUZICTAWSPV",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"EZRA",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EFC_5396:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\USER",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\USER",INIT_CWD:"C:\\Users\\USER\\Desktop\\parcel-tracker",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\USER\\AppData\\Local",LOGONSERVER:"\\\\EZRA",NODE:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",NODE_ENV:"production",NODE_PATH:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.pnpm\\node_modules",npm_command:"run-script",npm_config_legacy_peer_deps:"true",npm_config_registry:"https://registry.npmjs.org/",npm_config_store_dir:"C:/Users/USER/AppData/Local/pnpm/store",npm_config_user_agent:"pnpm/8.2.0 npm/? node/v18.1.0 win32 x64",npm_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_lifecycle_event:"build",npm_lifecycle_script:"vite build",npm_node_execpath:"C:\\Users\\USER\\AppData\\Local\\pnpm\\pnpm.exe",npm_package_dependencies_bulma:"^0.9.4",npm_package_dependencies_bulma_extensions:"^6.2.7",npm_package_dependencies_deck_gl:"^8.9.7",npm_package_dependencies_luxon:"^3.3.0",npm_package_dependencies_mapbox_gl:"^2.13.0",npm_package_dependencies_mobx:"^6.9.0",npm_package_dependencies_mobx_react:"^8.0.0",npm_package_dependencies_mobx_utils:"^6.0.6",npm_package_dependencies_react:"^18.2.0",npm_package_dependencies_react_dom:"^18.2.0",npm_package_dependencies_react_icons:"^4.8.0",npm_package_dependencies_react_map_gl:"^7.0.21",npm_package_dependencies_react_router:"^6.10.0",npm_package_dependencies_react_router_dom:"^6.10.0",npm_package_dependencies_worker_loader:"^3.0.8",npm_package_dependencies__creativebulma_bulma_collapsible:"^1.0.4",npm_package_dependencies__danmarshall_deckgl_typings:"^4.9.28",npm_package_dependencies__deck_gl_core:"^8.9.7",npm_package_dependencies__mapbox_mapbox_sdk:"^0.15.0",npm_package_dependencies__turf_bbox:"^6.5.0",npm_package_dependencies__turf_bbox_polygon:"^6.5.0",npm_package_dependencies__turf_helpers:"^6.5.0",npm_package_dependencies__types_luxon:"^3.3.0",npm_package_dependencies__types_mapbox_gl:"^2.7.10",npm_package_dependencies__types_mapbox__mapbox_sdk:"^0.13.4",npm_package_devDependencies_sass:"^1.61.0",npm_package_devDependencies_typescript:"^4.9.5",npm_package_devDependencies_vite:"^4.2.1",npm_package_devDependencies__types_node:"^18.15.11",npm_package_devDependencies__types_react:"^18.0.33",npm_package_devDependencies__types_react_dom:"^18.0.11",npm_package_devDependencies__vitejs_plugin_react:"^3.1.0",npm_package_name:"parcel-tracker",npm_package_private:"true",npm_package_scripts_build:"vite build",npm_package_scripts_dev:"vite",npm_package_scripts_preview:"vite preview",npm_package_type:"module",npm_package_version:"0.0.0",NUMBER_OF_PROCESSORS:"4",OneDrive:"C:\\Users\\USER\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\USER\\Desktop\\parcel-tracker\\node_modules\\.bin;C:\\snapshot\\dist\\node-gyp-bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Git\\cmd;C:\\Program Files\\PostgreSQL\\14\\bin;C:\\Program Files\\dotnet\\;C:\\Program Files (x86)\\ADB and Fastboot++;C:\\Users\\USER\\AppData\\Local\\pnpm;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\Scripts\\;C:\\Users\\USER\\AppData\\Local\\Programs\\Python\\Python39\\;C:\\Users\\USER\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\USER\\AppData\\Roaming\\npm;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\cmdline-tools\\latest\\bin;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\emulator;C:\\Users\\USER\\AppData\\Local\\Android\\sdk\\platform-tools;",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JSE;.WSF;.WSH;.MSC;.CPL",PNPM_HOME:"C:\\Users\\USER\\AppData\\Local\\pnpm",PNPM_SCRIPT_SRC_DIR:"C:\\Users\\USER\\Desktop\\parcel-tracker",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 69 Stepping 1, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"4501",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\USER\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\USER\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.77.0",TMP:"C:\\Users\\USER\\AppData\\Local\\Temp",USERDOMAIN:"EZRA",USERDOMAIN_ROAMINGPROFILE:"EZRA",USERNAME:"USER",USERPROFILE:"C:\\Users\\USER",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"--ms-enable-electron-run-as-node",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\USER\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-b0a863057a-sock",VSCODE_INJECTION:"1",windir:"C:\\WINDOWS"}.API_URL_REGEX):r}catch{ci=r}}return ci},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},pd={supported:!1,testSupport:function(r){!pa&&Ar&&(Ll?Fl(r):hn=r)}};let hn,Ar,pa=!1,Ll=!1;function Fl(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Ar),r.isContextLost())return;pd.supported=!0}catch{}r.deleteTexture(e),pa=!0}W.document&&(Ar=W.document.createElement("img"),Ar.onload=function(){hn&&Fl(hn),hn=null,Ll=!0},Ar.onerror=function(){pa=!0,hn=null},Ar.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var da="2.13.0";const Ul={create:"create",load:"load",fullLoad:"fullLoad"};function dd(r){const e=r.name.split("?")[0];return jl(e)&&e.includes("mapbox-gl.js")?"javascript":jl(e)&&e.includes("mapbox-gl.css")?"css":function(t){return Me.API_FONTS_REGEX.test(t)}(e)?"fontRange":$l(e)?"sprite":Nl(e)?"style":function(t){return Me.API_TILEJSON_REGEX.test(t)}(e)?"tilejson":"other"}const Ol="NO_ACCESS_TOKEN";function fa(r){return Me.API_URL_REGEX.test(r)}function jl(r){return Me.API_CDN_URL_REGEX.test(r)}function Nl(r){return Me.API_STYLE_REGEX.test(r)&&!$l(r)}function $l(r){return Me.API_SPRITE_REGEX.test(r)}const fd=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ql(r){const e=r.match(fd);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Gl(r){const e=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${e}`}function Zl(r){if(!r)return null;const e=r.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(W.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class hi{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Zl(Me.ACCESS_TOKEN);let n="";return n=t&&t.u?W.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(i,s)=>String.fromCharCode(+("0x"+s)))):"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=al("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const i=W.localStorage.getItem(t);i&&(this.eventData=JSON.parse(i));const s=W.localStorage.getItem(n);s&&(this.anonId=s)}catch{Pe("Unable to read from LocalStorage")}}saveEventData(){const e=al("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{W.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&W.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{Pe("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,n,i){if(!Me.EVENTS_URL)return;const s=ql(Me.EVENTS_URL);s.params.push(`access_token=${i||Me.ACCESS_TOKEN||""}`);const a={event:this.type,created:new Date(e).toISOString()},o=t?Ve(a,t):a,l={url:Gl(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([o])};this.pendingRequest=yd(l,u=>{this.pendingRequest=null,n(u),this.saveEventData(),this.processRequests(i)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Xl=new class extends hi{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){Me.EVENTS_URL&&Me.ACCESS_TOKEN&&Array.isArray(e)&&e.some(n=>function(i){return i.indexOf("mapbox:")===0}(n)||fa(n))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Zl(Me.ACCESS_TOKEN),n=t?t.u:Me.ACCESS_TOKEN;let i=n!==this.eventData.tokenU;rl(this.anonId)||(this.anonId=tl(),i=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const a=new Date(this.eventData.lastSuccess),o=new Date(s),l=(s-this.eventData.lastSuccess)/864e5;i=i||l>=1||l<-1||a.getDate()!==o.getDate()}else i=!0;i?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:da,skuId:"01","enabled.telemetry":!1,userId:this.anonId},a=>{a||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)},e):this.processRequests()}};Xl.postTurnstileEvent.bind(Xl);const Wl=new class extends hi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,i){this.skuToken=t,this.errorCb=i,Me.EVENTS_URL&&(n||Me.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Ol)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),rl(this.anonId)||(this.anonId=tl()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:da,skuId:"01",skuToken:this.skuToken,userId:this.anonId},i=>{i?this.errorCb(i):t&&(this.success[t]=!0)},e))}};Wl.postMapLoadEvent.bind(Wl);const Yl=new class extends hi{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){Me.EVENTS_URL&&(e||Me.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),i=function(s){const a=W.performance.getEntriesByType("resource"),o=W.performance.getEntriesByType("mark"),l=function(d){const f={};if(d){for(const y in d)if(y!=="other")for(const m of d[y]){const g=`${y}ResolveRangeMin`,b=`${y}ResolveRangeMax`,x=`${y}RequestCount`,v=`${y}RequestCachedCount`;f[g]=Math.min(f[g]||1/0,m.startTime),f[b]=Math.max(f[b]||-1/0,m.responseEnd);const w=_=>{f[_]===void 0&&(f[_]=0),++f[_]};m.transferSize!==void 0&&m.transferSize===0&&w(v),w(x)}}return f}(function(d,f){const y={};if(d)for(const m of d){const g=f(m);y[g]===void 0&&(y[g]=[]),y[g].push(m)}return y}(a,dd)),u=W.devicePixelRatio,c=W.navigator.connection||W.navigator.mozConnection||W.navigator.webkitConnection,p={counters:[],metadata:[],attributes:[]},h=(d,f,y)=>{y!=null&&d.push({name:f,value:y.toString()})};for(const d in l)h(p.counters,d,l[d]);if(s.interactionRange[0]!==1/0&&s.interactionRange[1]!==-1/0&&(h(p.counters,"interactionRangeMin",s.interactionRange[0]),h(p.counters,"interactionRangeMax",s.interactionRange[1])),o)for(const d of Object.keys(Ul)){const f=Ul[d],y=o.find(m=>m.name===f);y&&h(p.counters,f,y.startTime)}return h(p.counters,"visibilityHidden",s.visibilityHidden),h(p.attributes,"style",function(d){if(d)for(const f of d){const y=f.name.split("?")[0];if(Nl(y)){const m=y.split("/").slice(-2);if(m.length===2)return`mapbox://styles/${m[0]}/${m[1]}`}}}(a)),h(p.attributes,"terrainEnabled",s.terrainEnabled?"true":"false"),h(p.attributes,"fogEnabled",s.fogEnabled?"true":"false"),h(p.attributes,"projection",s.projection),h(p.attributes,"zoom",s.zoom),h(p.metadata,"devicePixelRatio",u),h(p.metadata,"connectionEffectiveType",c?c.effectiveType:void 0),h(p.metadata,"navigatorUserAgent",W.navigator.userAgent),h(p.metadata,"screenWidth",W.screen.width),h(p.metadata,"screenHeight",W.screen.height),h(p.metadata,"windowWidth",W.innerWidth),h(p.metadata,"windowHeight",W.innerHeight),h(p.metadata,"mapWidth",s.width/u),h(p.metadata,"mapHeight",s.height/u),h(p.metadata,"webglRenderer",s.renderer),h(p.metadata,"webglVendor",s.vendor),h(p.metadata,"sdkVersion",da),h(p.metadata,"sdkIdentifier","mapbox-gl-js"),p}(n);for(const s of i.metadata);for(const s of i.counters);for(const s of i.attributes);this.postEvent(t,i,()=>{},e)}};Yl.postPerformanceEvent.bind(Yl);const Hl=new class extends hi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,i){const s=ql(Me.API_URL+Me.SESSION_PATH);s.params.push(`sku=${t||""}`),s.params.push(`access_token=${i||Me.ACCESS_TOKEN||""}`);const a={url:Gl(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=md(a,o=>{this.pendingRequest=null,n(o),this.saveEventData(),this.processRequests(i)})}getSessionAPI(e,t,n,i){this.skuToken=t,this.errorCb=i,n||Me.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Ol))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,i=>{i?this.errorCb(i):t&&(this.success[t]=!0)},e)}};let kt,pi;function di(){(function(){try{return W.caches}catch{}})()&&!kt&&(kt=W.caches.open("mapbox-tiles"))}function Kl(r){const e=r.indexOf("?");if(e<0)return r;const t=function(i){const s=i.indexOf("?");return s>0?i.slice(s+1).split("&"):[]}(r),n=t.filter(i=>{const s=i.split("=");return s[0]==="language"||s[0]==="worldview"});return n.length?`${r.slice(0,e)}?${n.join("&")}`:r.slice(0,e)}Hl.getSessionAPI.bind(Hl);class ya extends Error{constructor(e,t,n){t===401&&fa(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Jl=mr()?()=>self.worker&&self.worker.referrer:()=>(W.location.protocol==="blob:"?W.parent:W).location.href,fi=function(r,e){if(!(/^file:/.test(t=r.url)||/^file:/.test(Jl())&&!/^\w+:/.test(t))){if(W.fetch&&W.Request&&W.AbortController&&W.Request.prototype.hasOwnProperty("signal"))return function(n,i){const s=new W.AbortController,a=new W.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:Jl(),signal:s.signal});let o=!1,l=!1;const u=(c=a.url).indexOf("sku=")>0&&fa(c);var c;n.type==="json"&&a.headers.set("Accept","application/json");const p=(d,f,y)=>{if(l)return;if(d&&d.message!=="SecurityError"&&Pe(d),f&&y)return h(f);const m=Date.now();W.fetch(a).then(g=>{if(g.ok){const b=u?g.clone():null;return h(g,b,m)}return i(new ya(g.statusText,g.status,n.url))}).catch(g=>{g.name!=="AbortError"&&i(new Error(`${g.message} ${n.url}`))})},h=(d,f,y)=>{(n.type==="arrayBuffer"?d.arrayBuffer():n.type==="json"?d.json():d.text()).then(m=>{l||(f&&y&&function(g,b,x){if(di(),!kt)return;const v={status:b.status,statusText:b.statusText,headers:new W.Headers};b.headers.forEach((A,S)=>v.headers.set(S,A));const w=As(b.headers.get("Cache-Control")||"");if(w["no-store"])return;w["max-age"]&&v.headers.set("Expires",new Date(x+1e3*w["max-age"]).toUTCString());const _=v.headers.get("Expires");_&&(new Date(_).getTime()-x<42e4||function(A,S){if(pi===void 0)try{new Response(new ReadableStream),pi=!0}catch{pi=!1}pi?S(A.body):A.blob().then(S)}(b,A=>{const S=new W.Response(A,v);di(),kt&&kt.then(C=>C.put(Kl(g.url),S)).catch(C=>Pe(C.message))}))}(a,f,y),o=!0,i(null,m,d.headers.get("Cache-Control"),d.headers.get("Expires")))}).catch(m=>{l||i(new Error(m.message))})};return u?function(d,f){if(di(),!kt)return f(null);const y=Kl(d.url);kt.then(m=>{m.match(y).then(g=>{const b=function(x){if(!x)return!1;const v=new Date(x.headers.get("Expires")||0),w=As(x.headers.get("Cache-Control")||"");return v>Date.now()&&!w["no-cache"]}(g);m.delete(y),b&&m.put(y,g.clone()),f(null,g,b)}).catch(f)}).catch(f)}(a,p):p(null,null),{cancel:()=>{l=!0,o||s.abort()}}}(r,e);if(mr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var t;return function(n,i){const s=new W.XMLHttpRequest;s.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(s.responseType="arraybuffer");for(const a in n.headers)s.setRequestHeader(a,n.headers[a]);return n.type==="json"&&(s.responseType="text",s.setRequestHeader("Accept","application/json")),s.withCredentials=n.credentials==="include",s.onerror=()=>{i(new Error(s.statusText))},s.onload=()=>{if((s.status>=200&&s.status<300||s.status===0)&&s.response!==null){let a=s.response;if(n.type==="json")try{a=JSON.parse(s.response)}catch(o){return i(o)}i(null,a,s.getResponseHeader("Cache-Control"),s.getResponseHeader("Expires"))}else i(new ya(s.statusText,s.status,n.url))},s.send(n.body),{cancel:()=>s.abort()}}(r,e)},Ql=function(r,e){return fi(Ve(r,{type:"arrayBuffer"}),e)},yd=function(r,e){return fi(Ve(r,{method:"POST"}),e)},md=function(r,e){return fi(Ve(r,{method:"GET"}),e)},yi={};function N(r,e,t={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),yi[e]={klass:r,omit:t.omit||[]}}N(Object,"Object"),gr.serialize=function(r,e){const t=r.toArrayBuffer();return e&&e.push(t),{buffer:t}},gr.deserialize=function(r){return new gr(r.buffer)},Object.defineProperty(gr,"name",{value:"Grid"}),N(gr,"Grid"),N(Ce,"Color"),N(Error,"Error"),N(ya,"AJAXError"),N(rt,"ResolvedImage"),N(li,"StylePropertyFunction"),N(ua,"StyleExpression",{omit:["_evaluator"]}),N(ha,"ZoomDependentExpression"),N(ca,"ZoomConstantExpression"),N(Ft,"CompoundExpression",{omit:["_evaluate"]});for(const r in un)yi[un[r]._classRegistryKey]||N(un[r],`Expression${r}`);function eu(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function tu(r){return W.ImageBitmap&&r instanceof W.ImageBitmap}function pn(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(eu(r)||tu(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const t=r;return e&&e.push(t.buffer),t}if(r instanceof W.ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const t=[];for(const n of r)t.push(pn(n,e));return t}if(typeof r=="object"){const t=r.constructor,n=t._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const i=t.serialize?t.serialize(r,e):{};if(!t.serialize){for(const s in r)r.hasOwnProperty(s)&&(yi[n].omit.indexOf(s)>=0||(i[s]=pn(r[s],e)));r instanceof Error&&(i.message=r.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(i.$name=n),i}throw new Error("can't serialize object of type "+typeof r)}function dn(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||eu(r)||tu(r)||ArrayBuffer.isView(r)||r instanceof W.ImageData)return r;if(Array.isArray(r))return r.map(dn);if(typeof r=="object"){const e=r.$name||"Object",{klass:t}=yi[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(r);const n=Object.create(t.prototype);for(const i of Object.keys(r))i!=="$name"&&(n[i]=dn(r[i]));return n}throw new Error("can't deserialize object of type "+typeof r)}class gd{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const xd=W.performance;function ru(r){const e=r?r.url.toString():void 0;return xd.getEntriesByName(e)}class vd{constructor(){this.tasks={},this.taskQueue=[],nl(["process"],this),this.invoker=new gd(this.process),this.nextId=0}add(e,t){const n=this.nextId++,i=function({type:s,isSymbolTile:a,zoom:o}){return o=o||0,s==="message"?0:s!=="maybePrepare"||a?s!=="parseTile"||a?s==="parseTile"&&a?300-o:s==="maybePrepare"&&a?400-o:500:200-o:100-o}(t);if(i===0){mr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:t,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){mr();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const s=this.tasks[this.taskQueue[i]];s.priority<t&&(t=s.priority,e=i)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class bd{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},nl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=mr()?e:W,this.scheduler=new vd}send(e,t,n,i,s=!1,a){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=a,this.callbacks[o]=n);const l=sl(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:e,hasCallback:!!n,targetMapId:i,mustQueue:s,sourceMapId:this.mapId,data:pn(t,l)},l),{cancel:()=>{n&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){const i=this.cancelCallbacks[n];delete this.cancelCallbacks[n],i&&i.cancel()}else if(t.mustQueue||mr()){const i=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,t),i&&i.metadata||{type:"message"})}else this.processTask(n,t)}processTask(e,t){if(t.type==="<response>"){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(dn(t.error)):n(null,dn(t.data)))}else{const n=sl(this.globalScope)?void 0:[],i=t.hasCallback?(a,o)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:a?pn(a):null,data:pn(o,n)},n)}:a=>{},s=dn(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,s,i);else if(this.parent.getWorkerSource){const a=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,a[0],s.source)[a[1]](s,i)}else i(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var T=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function nu(r,e,t){t[r]&&t[r].indexOf(e)!==-1||(t[r]=t[r]||[],t[r].push(e))}function ma(r,e,t){if(t&&t[r]){const n=t[r].indexOf(e);n!==-1&&t[r].splice(n,1)}}class kr{constructor(e,t={}){Ve(this,t),this.type=e}}class ga extends kr{constructor(e,t={}){super("error",Ve({error:e},t))}}class mi{on(e,t){return this._listeners=this._listeners||{},nu(e,t,this._listeners),this}off(e,t){return ma(e,t,this._listeners),ma(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},nu(e,t,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,t){typeof e=="string"&&(e=new kr(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const o of i)o.call(this,e);const s=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const o of s)ma(n,o,this._oneTimeListeners),o.call(this,e);const a=this._eventedParent;a&&(Ve(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),a.fire(e))}else e instanceof ga&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}function De(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Ot(r){if(Array.isArray(r))return r.map(Ot);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const t in r)e[t]=Ot(r[t]);return e}return De(r)}class U{constructor(e,t,n,i){this.message=(e?`${e}: `:"")+n,i&&(this.identifier=i),t!=null&&t.__line__&&(this.line=t.__line__)}}function at(r){const e=r.key,t=r.value,n=r.valueSpec||{},i=r.objectElementValidators||{},s=r.style,a=r.styleSpec;let o=[];const l=oe(t);if(l!=="object")return[new U(e,t,`object expected, ${l} found`)];for(const u in t){const c=u.split(".")[0],p=n[c]||n["*"];let h;i[c]?h=i[c]:n[c]?h=Ge:i["*"]?h=i["*"]:n["*"]&&(h=Ge),h?o=o.concat(h({key:(e&&`${e}.`)+u,value:t[u],valueSpec:p,style:s,styleSpec:a,object:t,objectKey:u},t)):o.push(new U(e,t[u],`unknown property "${u}"`))}for(const u in n)i[u]||n[u].required&&n[u].default===void 0&&t[u]===void 0&&o.push(new U(e,t,`missing required property "${u}"`));return o}function iu(r){const e=r.value,t=r.valueSpec,n=r.style,i=r.styleSpec,s=r.key,a=r.arrayElementValidator||Ge;if(oe(e)!=="array")return[new U(s,e,`array expected, ${oe(e)} found`)];if(t.length&&e.length!==t.length)return[new U(s,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new U(s,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let o={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};i.$version<7&&(o.function=t.function),oe(t.value)==="object"&&(o=t.value);let l=[];for(let u=0;u<e.length;u++)l=l.concat(a({array:e,arrayIndex:u,value:e[u],valueSpec:o,style:n,styleSpec:i,key:`${s}[${u}]`}));return l}function su(r){const e=r.key,t=r.value,n=r.valueSpec;let i=oe(t);if(i==="number"&&t!=t&&(i="NaN"),i!=="number")return[new U(e,t,`number expected, ${i} found`)];if("minimum"in n){let s=n.minimum;if(oe(n.minimum)==="array"&&(s=n.minimum[r.arrayIndex]),t<s)return[new U(e,t,`${t} is less than the minimum value ${s}`)]}if("maximum"in n){let s=n.maximum;if(oe(n.maximum)==="array"&&(s=n.maximum[r.arrayIndex]),t>s)return[new U(e,t,`${t} is greater than the maximum value ${s}`)]}return[]}function au(r){const e=r.valueSpec,t=De(r.value.type);let n,i,s,a={};const o=t!=="categorical"&&r.value.property===void 0,l=!o,u=oe(r.value.stops)==="array"&&oe(r.value.stops[0])==="array"&&oe(r.value.stops[0][0])==="object",c=at({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(d){if(t==="identity")return[new U(d.key,d.value,'identity function may not have a "stops" property')];let f=[];const y=d.value;return f=f.concat(iu({key:d.key,value:y,valueSpec:d.valueSpec,style:d.style,styleSpec:d.styleSpec,arrayElementValidator:p})),oe(y)==="array"&&y.length===0&&f.push(new U(d.key,y,"array must have at least one stop")),f},default:function(d){return Ge({key:d.key,value:d.value,valueSpec:e,style:d.style,styleSpec:d.styleSpec})}}});return t==="identity"&&o&&c.push(new U(r.key,r.value,'missing required property "property"')),t==="identity"||r.value.stops||c.push(new U(r.key,r.value,'missing required property "stops"')),t==="exponential"&&r.valueSpec.expression&&!la(r.valueSpec)&&c.push(new U(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(l&&!Sr(r.valueSpec)?c.push(new U(r.key,r.value,"property functions not supported")):o&&!Dl(r.valueSpec)&&c.push(new U(r.key,r.value,"zoom functions not supported"))),t!=="categorical"&&!u||r.value.property!==void 0||c.push(new U(r.key,r.value,'"property" property is required')),c;function p(d){let f=[];const y=d.value,m=d.key;if(oe(y)!=="array")return[new U(m,y,`array expected, ${oe(y)} found`)];if(y.length!==2)return[new U(m,y,`array length 2 expected, length ${y.length} found`)];if(u){if(oe(y[0])!=="object")return[new U(m,y,`object expected, ${oe(y[0])} found`)];if(y[0].zoom===void 0)return[new U(m,y,"object stop key must have zoom")];if(y[0].value===void 0)return[new U(m,y,"object stop key must have value")];const g=De(y[0].zoom);if(typeof g!="number")return[new U(m,y[0].zoom,"stop zoom values must be numbers")];if(s&&s>g)return[new U(m,y[0].zoom,"stop zoom values must appear in ascending order")];g!==s&&(s=g,i=void 0,a={}),f=f.concat(at({key:`${m}[0]`,value:y[0],valueSpec:{zoom:{}},style:d.style,styleSpec:d.styleSpec,objectElementValidators:{zoom:su,value:h}}))}else f=f.concat(h({key:`${m}[0]`,value:y[0],valueSpec:{},style:d.style,styleSpec:d.styleSpec},y));return oi(Ot(y[1]))?f.concat([new U(`${m}[1]`,y[1],"expressions are not allowed in function stops.")]):f.concat(Ge({key:`${m}[1]`,value:y[1],valueSpec:e,style:d.style,styleSpec:d.styleSpec}))}function h(d,f){const y=oe(d.value),m=De(d.value),g=d.value!==null?d.value:f;if(n){if(y!==n)return[new U(d.key,g,`${y} stop domain type must match previous stop domain type ${n}`)]}else n=y;if(y!=="number"&&y!=="string"&&y!=="boolean"&&typeof m!="number"&&typeof m!="string"&&typeof m!="boolean")return[new U(d.key,g,"stop domain value must be a number, string, or boolean")];if(y!=="number"&&t!=="categorical"){let b=`number expected, ${y} found`;return Sr(e)&&t===void 0&&(b+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new U(d.key,g,b)]}return t!=="categorical"||y!=="number"||typeof m=="number"&&isFinite(m)&&Math.floor(m)===m?t!=="categorical"&&y==="number"&&typeof m=="number"&&typeof i=="number"&&i!==void 0&&m<i?[new U(d.key,g,"stop domain values must appear in ascending order")]:(i=m,t==="categorical"&&m in a?[new U(d.key,g,"stop domain values must be unique")]:(a[m]=!0,[])):[new U(d.key,g,`integer expected, found ${String(m)}`)]}}function Ir(r){const e=(r.expressionContext==="property"?Vl:rr)(Ot(r.value),r.valueSpec);if(e.result==="error")return e.value.map(n=>new U(`${r.key}${n.key}`,r.value,n.message));const t=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!t.outputDefined())return[new U(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Qn(t))return[new U(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter")return ou(t,r);if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!ei(t,["zoom","feature-state"]))return[new U(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!an(t))return[new U(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ou(r,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const i of e.valueSpec.expression.parameters)t.delete(i);if(t.size===0)return[];const n=[];return r instanceof Ft&&t.has(r.name)?[new U(e.key,e.value,`["${r.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(r.eachChild(i=>{n.push(...ou(i,e))}),n)}function gi(r){const e=r.key,t=r.value,n=r.valueSpec,i=[];return Array.isArray(n.values)?n.values.indexOf(De(t))===-1&&i.push(new U(e,t,`expected one of [${n.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(n.values).indexOf(De(t))===-1&&i.push(new U(e,t,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(t)} found`)),i}function xa(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!xa(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function xi(r,e="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};xa(r)||(r=vi(r));const t=r;let n=!0;try{n=function(u){if(!Mr(u))return u;let c=Ot(u);return uu(c),c=lu(c),c}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const i=T[`filter_${e}`],s=rr(n,i);let a=null;if(s.result==="error")throw new Error(s.value.map(u=>`${u.key}: ${u.message}`).join(", "));a=(u,c,p)=>s.value.evaluate(u,c,{},p);let o=null,l=null;if(n!==t){const u=rr(t,i);if(u.result==="error")throw new Error(u.value.map(c=>`${c.key}: ${c.message}`).join(", "));o=(c,p,h,d,f)=>u.value.evaluate(c,p,{},h,void 0,void 0,d,f),l=!an(u.value.expression)}return{filter:a,dynamicFilter:o||void 0,needGeometry:cu(n),needFeature:!!l}}function lu(r){if(!Array.isArray(r))return r;const e=function(t){if(_d.has(t[0])){for(let n=1;n<t.length;n++)if(Mr(t[n]))return!0}return t}(r);return e===!0?e:e.map(t=>lu(t))}function uu(r){let e=!1;const t=[];if(r[0]==="case"){for(let n=1;n<r.length-1;n+=2)e=e||Mr(r[n]),t.push(r[n+1]);t.push(r[r.length-1])}else if(r[0]==="match"){e=e||Mr(r[1]);for(let n=2;n<r.length-1;n+=2)t.push(r[n+1]);t.push(r[r.length-1])}else if(r[0]==="step"){e=e||Mr(r[1]);for(let n=1;n<r.length-1;n+=2)t.push(r[n+1])}e&&(r.length=0,r.push("any",...t));for(let n=1;n<r.length;n++)uu(r[n])}function Mr(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let t=1;t<r.length;t++)if(Mr(r[t]))return!0;return!1}const _d=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wd(r,e){return r<e?-1:r>e?1:0}function cu(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(cu(r[e]))return!0;return!1}function vi(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?va(r[1],r[2],"=="):e==="!="?bi(va(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?va(r[1],r[2],e):e==="any"?(t=r.slice(1),["any"].concat(t.map(vi))):e==="all"?["all"].concat(r.slice(1).map(vi)):e==="none"?["all"].concat(r.slice(1).map(vi).map(bi)):e==="in"?hu(r[1],r.slice(2)):e==="!in"?bi(hu(r[1],r.slice(2))):e==="has"?pu(r[1]):e==="!has"?bi(pu(r[1])):e!=="within"||r;var t}function va(r,e,t){switch(r){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,r,e]}}function hu(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",r,["literal",e.sort(wd)]]:["filter-in-small",r,["literal",e]]}}function pu(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function bi(r){return["!",r]}function du(r){return xa(Ot(r.value))?Ir(er({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):fu(r)}function fu(r){const e=r.value,t=r.key;if(oe(e)!=="array")return[new U(t,e,`array expected, ${oe(e)} found`)];const n=r.styleSpec;let i,s=[];if(e.length<1)return[new U(t,e,"filter array must have at least 1 element")];switch(s=s.concat(gi({key:`${t}[0]`,value:e[0],valueSpec:n.filter_operator,style:r.style,styleSpec:r.styleSpec})),De(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&De(e[1])==="$type"&&s.push(new U(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&s.push(new U(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(i=oe(e[1]),i!=="string"&&s.push(new U(`${t}[1]`,e[1],`string expected, ${i} found`)));for(let a=2;a<e.length;a++)i=oe(e[a]),De(e[1])==="$type"?s=s.concat(gi({key:`${t}[${a}]`,value:e[a],valueSpec:n.geometry_type,style:r.style,styleSpec:r.styleSpec})):i!=="string"&&i!=="number"&&i!=="boolean"&&s.push(new U(`${t}[${a}]`,e[a],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let a=1;a<e.length;a++)s=s.concat(fu({key:`${t}[${a}]`,value:e[a],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":i=oe(e[1]),e.length!==2?s.push(new U(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):i!=="string"&&s.push(new U(`${t}[1]`,e[1],`string expected, ${i} found`));break;case"within":i=oe(e[1]),e.length!==2?s.push(new U(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):i!=="object"&&s.push(new U(`${t}[1]`,e[1],`object expected, ${i} found`))}return s}function yu(r,e){const t=r.key,n=r.style,i=r.styleSpec,s=r.value,a=r.objectKey,o=i[`${e}_${r.layerType}`];if(!o)return[];const l=a.match(/^(.*)-transition$/);if(e==="paint"&&l&&o[l[1]]&&o[l[1]].transition)return Ge({key:t,value:s,valueSpec:i.transition,style:n,styleSpec:i});const u=r.valueSpec||o[a];if(!u)return[new U(t,s,`unknown property "${a}"`)];let c;if(oe(s)==="string"&&Sr(u)&&!u.tokens&&(c=/^{([^}]+)}$/.exec(s)))return[new U(t,s,`"${a}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(c[1])} }\`.`)];const p=[];return r.layerType==="symbol"&&(a==="text-field"&&n&&!n.glyphs&&p.push(new U(t,s,'use of "text-field" requires a style "glyphs" property')),a==="text-font"&&ai(Ot(s))&&De(s.type)==="identity"&&p.push(new U(t,s,'"text-font" does not support identity functions'))),p.concat(Ge({key:r.key,value:s,valueSpec:u,style:n,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function mu(r){return yu(r,"paint")}function gu(r){return yu(r,"layout")}function Tr(r){const e=r.value,t=r.key,n=oe(e);return n!=="string"?[new U(t,e,`string expected, ${n} found`)]:[]}const xu={promoteId:function({key:r,value:e}){if(oe(e)==="string")return Tr({key:r,value:e});{const t=[];for(const n in e)t.push(...Tr({key:`${r}.${n}`,value:e[n]}));return t}}};function Sd(r){return r.source.reduce((e,t)=>{const n=r[t];return n.type.type==="enum"&&(e=e.concat(Object.keys(n.type.values))),e},[])}const vu={"*":()=>[],array:iu,boolean:function(r){const e=r.value,t=r.key,n=oe(e);return n!=="boolean"?[new U(t,e,`boolean expected, ${n} found`)]:[]},number:su,color:function(r){const e=r.key,t=r.value,n=oe(t);return n!=="string"?[new U(e,t,`color expected, ${n} found`)]:Ms(t)===null?[new U(e,t,`color expected, "${t}" found`)]:[]},enum:gi,filter:du,function:au,layer:function(r){let e=[];const t=r.value,n=r.key,i=r.style,s=r.styleSpec;t.type||t.ref||e.push(new U(n,t,'either "type" or "ref" is required'));let a=De(t.type);const o=De(t.ref);if(t.id){const l=De(t.id);for(let u=0;u<r.arrayIndex;u++){const c=i.layers[u];De(c.id)===l&&e.push(new U(n,t.id,`duplicate layer id "${t.id}", previously used at line ${c.id.__line__}`))}}if("ref"in t){let l;["type","source","source-layer","filter","layout"].forEach(u=>{u in t&&e.push(new U(n,t[u],`"${u}" is prohibited for ref layers`))}),i.layers.forEach(u=>{De(u.id)===o&&(l=u)}),l?l.ref?e.push(new U(n,t.ref,"ref cannot reference another ref layer")):a=De(l.type):typeof o=="string"&&e.push(new U(n,t.ref,`ref layer "${o}" not found`))}else if(a!=="background"&&a!=="sky")if(t.source){const l=i.sources&&i.sources[t.source],u=l&&De(l.type);l?u==="vector"&&a==="raster"?e.push(new U(n,t.source,`layer "${t.id}" requires a raster source`)):u==="raster"&&a!=="raster"?e.push(new U(n,t.source,`layer "${t.id}" requires a vector source`)):u!=="vector"||t["source-layer"]?u==="raster-dem"&&a!=="hillshade"?e.push(new U(n,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):a!=="line"||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||u==="geojson"&&l.lineMetrics||e.push(new U(n,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new U(n,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new U(n,t.source,`source "${t.source}" not found`))}else e.push(new U(n,t,'missing required property "source"'));return e=e.concat(at({key:n,value:t,valueSpec:s.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ge({key:`${n}.type`,value:t.type,valueSpec:s.layer.type,style:r.style,styleSpec:r.styleSpec,object:t,objectKey:"type"}),filter:l=>du(er({layerType:a},l)),layout:l=>at({layer:t,key:l.key,value:l.value,valueSpec:{},style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":u=>gu(er({layerType:a},u))}}),paint:l=>at({layer:t,key:l.key,value:l.value,valueSpec:{},style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":u=>mu(er({layerType:a},u))}})}})),e},object:at,source:function(r){const e=r.value,t=r.key,n=r.styleSpec,i=r.style;if(!e.type)return[new U(t,e,'"type" is required')];const s=De(e.type);let a;switch(s){case"vector":case"raster":case"raster-dem":return a=at({key:t,value:e,valueSpec:n[`source_${s.replace("-","_")}`],style:r.style,styleSpec:n,objectElementValidators:xu}),a;case"geojson":if(a=at({key:t,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:xu}),e.cluster)for(const o in e.clusterProperties){const[l,u]=e.clusterProperties[o],c=typeof l=="string"?[l,["accumulated"],["get",o]]:l;a.push(...Ir({key:`${t}.${o}.map`,value:u,expressionContext:"cluster-map"})),a.push(...Ir({key:`${t}.${o}.reduce`,value:c,expressionContext:"cluster-reduce"}))}return a;case"video":return at({key:t,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return at({key:t,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new U(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return gi({key:`${t}.type`,value:e.type,valueSpec:{values:Sd(n)},style:i,styleSpec:n})}},light:function(r){const e=r.value,t=r.styleSpec,n=t.light,i=r.style;let s=[];const a=oe(e);if(e===void 0)return s;if(a!=="object")return s=s.concat([new U("light",e,`object expected, ${a} found`)]),s;for(const o in e){const l=o.match(/^(.*)-transition$/);s=s.concat(l&&n[l[1]]&&n[l[1]].transition?Ge({key:o,value:e[o],valueSpec:t.transition,style:i,styleSpec:t}):n[o]?Ge({key:o,value:e[o],valueSpec:n[o],style:i,styleSpec:t}):[new U(o,e[o],`unknown property "${o}"`)])}return s},terrain:function(r){const e=r.value,t=r.key,n=r.style,i=r.styleSpec,s=i.terrain;let a=[];const o=oe(e);if(e===void 0)return a;if(o!=="object")return a=a.concat([new U("terrain",e,`object expected, ${o} found`)]),a;for(const l in e){const u=l.match(/^(.*)-transition$/);a=a.concat(u&&s[u[1]]&&s[u[1]].transition?Ge({key:l,value:e[l],valueSpec:i.transition,style:n,styleSpec:i}):s[l]?Ge({key:l,value:e[l],valueSpec:s[l],style:n,styleSpec:i}):[new U(l,e[l],`unknown property "${l}"`)])}if(e.source){const l=n.sources&&n.sources[e.source],u=l&&De(l.type);l?u!=="raster-dem"&&a.push(new U(t,e.source,`terrain cannot be used with a source of type ${String(u)}, it only be used with a "raster-dem" source type`)):a.push(new U(t,e.source,`source "${e.source}" not found`))}else a.push(new U(t,e,'terrain is missing required property "source"'));return a},fog:function(r){const e=r.value,t=r.style,n=r.styleSpec,i=n.fog;let s=[];const a=oe(e);if(e===void 0)return s;if(a!=="object")return s=s.concat([new U("fog",e,`object expected, ${a} found`)]),s;for(const o in e){const l=o.match(/^(.*)-transition$/);s=s.concat(l&&i[l[1]]&&i[l[1]].transition?Ge({key:o,value:e[o],valueSpec:n.transition,style:t,styleSpec:n}):i[o]?Ge({key:o,value:e[o],valueSpec:i[o],style:t,styleSpec:n}):[new U(o,e[o],`unknown property "${o}"`)])}return s},string:Tr,formatted:function(r){return Tr(r).length===0?[]:Ir(r)},resolvedImage:function(r){return Tr(r).length===0?[]:Ir(r)},projection:function(r){const e=r.value,t=r.styleSpec,n=t.projection,i=r.style;let s=[];const a=oe(e);if(a==="object")for(const o in e)s=s.concat(Ge({key:o,value:e[o],valueSpec:n[o],style:i,styleSpec:t}));else a!=="string"&&(s=s.concat([new U("projection",e,`object or string expected, ${a} found`)]));return s}};function Ge(r){const e=r.value,t=r.valueSpec,n=r.styleSpec;return t.expression&&ai(De(e))?au(r):t.expression&&oi(Ot(e))?Ir(r):t.type&&vu[t.type]?vu[t.type](r):at(er({},r,{valueSpec:t.type?n[t.type]:t}))}function Ad(r){const e=r.value,t=r.key,n=Tr(r);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new U(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new U(t,e,'"glyphs" url must include a "{range}" token'))),n}function kd(r,e=T){return ba(Ge({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:Ad,"*":()=>[]}}))}const Id=r=>ba(mu(r)),Md=r=>ba(gu(r));function ba(r){return r.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}const bu=r=>r>=1536&&r<=1791,_u=r=>r>=1872&&r<=1919,wu=r=>r>=2208&&r<=2303,Su=r=>r>=11904&&r<=12031,Au=r=>r>=12032&&r<=12255,ku=r=>r>=12272&&r<=12287,_a=r=>r>=12288&&r<=12351,Iu=r=>r>=12352&&r<=12447,wa=r=>r>=12448&&r<=12543,Mu=r=>r>=12544&&r<=12591,Tu=r=>r>=12704&&r<=12735,Cu=r=>r>=12736&&r<=12783,Eu=r=>r>=12784&&r<=12799,Pu=r=>r>=12800&&r<=13055,zu=r=>r>=13056&&r<=13311,Du=r=>r>=13312&&r<=19903,Bu=r=>r>=19968&&r<=40959,Ru=r=>r>=40960&&r<=42127,Vu=r=>r>=42128&&r<=42191,Lu=r=>r>=63744&&r<=64255,Sa=r=>r>=64336&&r<=65023,Fu=r=>r>=65040&&r<=65055,Aa=r=>r>=65072&&r<=65103,Uu=r=>r>=65104&&r<=65135,ka=r=>r>=65136&&r<=65279,Ia=r=>r>=65280&&r<=65519;function Ma(r){for(const e of r)if(Ta(e.charCodeAt(0)))return!0;return!1}function Td(r){for(const e of r)if(!Cd(e.charCodeAt(0)))return!1;return!0}function Cd(r){return!(bu(r)||_u(r)||wu(r)||Sa(r)||ka(r))}function Ta(r){return!(r!==746&&r!==747&&(r<4352||!(Tu(r)||Mu(r)||Aa(r)&&!(r>=65097&&r<=65103)||Lu(r)||zu(r)||Su(r)||Cu(r)||!(!_a(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Du(r)||Bu(r)||Pu(r)||(e=>e>=12592&&e<=12687)(r)||(e=>e>=43360&&e<=43391)(r)||(e=>e>=55216&&e<=55295)(r)||(e=>e>=4352&&e<=4607)(r)||(e=>e>=44032&&e<=55215)(r)||Iu(r)||ku(r)||(e=>e>=12688&&e<=12703)(r)||Au(r)||Eu(r)||wa(r)&&r!==12540||!(!Ia(r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Uu(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(e=>e>=5120&&e<=5759)(r)||(e=>e>=6320&&e<=6399)(r)||Fu(r)||(e=>e>=19904&&e<=19967)(r)||Ru(r)||Vu(r))))}function Ou(r){return!(Ta(r)||function(e){return!!((t=>t>=128&&t<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(t=>t>=8192&&t<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&e!==9251||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||_a(e)||wa(e)||(t=>t>=57344&&t<=63743)(e)||Aa(e)||Uu(e)||Ia(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function ju(r){return r>=1424&&r<=2303||Sa(r)||ka(r)}function Ed(r,e){return!(!e&&ju(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(t=>t>=6016&&t<=6143)(r))}function Pd(r){for(const e of r)if(ju(e.charCodeAt(0)))return!0;return!1}let _i,Ca,wi,nr;const Cr={now:()=>wi!==void 0?wi:W.performance.now(),setNow(r){wi=r},restoreNow(){wi=void 0},frame(r){const e=W.requestAnimationFrame(r);return{cancel:()=>W.cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:t,height:n}=r;nr||(nr=W.document.createElement("canvas"));const i=nr.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return(t>nr.width||n>nr.height)&&(nr.width=t,nr.height=n),i.clearRect(-e,-e,t+2*e,n+2*e),i.drawImage(r,0,0,t,n),i.getImageData(-e,-e,t+2*e,n+2*e)},resolveURL:r=>(_i||(_i=W.document.createElement("a")),_i.href=r,_i.href),get devicePixelRatio(){return W.devicePixelRatio},get prefersReducedMotion(){return!!W.matchMedia&&(Ca==null&&(Ca=W.matchMedia("(prefers-reduced-motion: reduce)")),Ca.matches)}},Nu="loading",$u="loaded";let It="unavailable",Er=null;function qu(){zd.fire(new kr("pluginStateChange",{pluginStatus:It,pluginURL:Er}))}const zd=new mi,Gu=function(){return It},Dd=function(){if(It!=="deferred"||!Er)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");It=Nu,qu(),Er&&Ql({url:Er},r=>{r?function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(It="error")}(r):(It=$u,qu())})},Be={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>It===$u||Be.applyArabicShaping!=null,isLoading:()=>It===Nu,setState(r){It=r.pluginStatus,Er=r.pluginURL},isParsed:()=>Be.applyArabicShaping!=null&&Be.processBidirectionalText!=null&&Be.processStyledBidirectionalText!=null,getPluginURL:()=>Er};class we{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,n){for(const i of t)if(!Ed(i.charCodeAt(0),n))return!1;return!0}(e,Be.isLoaded())}}class Si{constructor(e,t){this.property=e,this.value=t,this.expression=function(n,i){if(ai(n))return new li(n,i);if(oi(n)){const s=Vl(n,i);if(s.result==="error")throw new Error(s.value.map(a=>`${a.key}: ${a.message}`).join(", "));return s.value}{let s=n;return typeof n=="string"&&i.type==="color"&&(s=Ce.parse(n)),{kind:"constant",evaluate:()=>s}}}(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class Ea{constructor(e){this.property=e,this.value=new Si(e,void 0)}transitioned(e,t){return new Zu(this.property,this.value,t,Ve({},e.transition,this.transition),e.now)}untransitioned(){return new Zu(this.property,this.value,null,{},0)}}class Bd{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Vt(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ea(this._values[e].property)),this._values[e].value=new Si(this._values[e].property,t===null?void 0:Vt(t))}getTransition(e){return Vt(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ea(this._values[e].property)),this._values[e].transition=Vt(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);n!==void 0&&(e[t]=n);const i=this.getTransition(t);i!==void 0&&(e[`${t}-transition`]=i)}return e}transitioned(e,t){const n=new Xu(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new Xu(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Zu{constructor(e,t,n,i,s){const a=i.delay||0,o=i.duration||0;s=s||0,this.property=e,this.value=t,this.begin=s+a,this.end=this.begin+o,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,s=this.value.possiblyEvaluate(e,t,n),a=this.prior;if(a){if(i>this.end)return this.prior=null,s;if(this.value.isDataDriven())return this.prior=null,s;if(i<this.begin)return a.possiblyEvaluate(e,t,n);{const o=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,n),s,function(l){if(l<=0)return 0;if(l>=1)return 1;const u=l*l,c=u*l;return 4*(l<.5?c:3*(l-u)+c-.75)}(o))}}return s}}class Xu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new Ai(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Rd{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Vt(this._values[e].value)}setValue(e,t){this._values[e]=new Si(this._values[e].property,t===null?void 0:Vt(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);n!==void 0&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new Ai(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].possiblyEvaluate(e,t,n);return i}}class Pr{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class Ai{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ${constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const i=ri[this.specification.type];return i?i(e,t,n):e}}class Z{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new Pr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new Pr(this,{kind:"constant",value:void 0},e.parameters);const i=ri[this.specification.type];return i?new Pr(this,{kind:"constant",value:i(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,i,s,a){return e.kind==="constant"?e.value:e.evaluate(t,n,i,s,a)}}class ki{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class Xe{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new we(0,{});for(const n in e){const i=e[n];i.specification.overridable&&this.overridableProperties.push(n);const s=this.defaultPropertyValues[n]=new Si(i,void 0),a=this.defaultTransitionablePropertyValues[n]=new Ea(i);this.defaultTransitioningPropertyValues[n]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=s.possiblyEvaluate(t)}}}function Wu(r,e){return 256*(r=ue(Math.floor(r),0,255))+ue(Math.floor(e),0,255)}N(Z,"DataDrivenProperty"),N($,"DataConstantProperty"),N(ki,"ColorRampProperty");const Vd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ii{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Se{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ve(r,e=1){let t=0,n=0;return{members:r.map(i=>{const s=Vd[i.type].BYTES_PER_ELEMENT,a=t=Yu(t,Math.max(e,s)),o=i.components||1;return n=Math.max(n,s),t+=s*o,{name:i.name,type:i.type,components:o,offset:a}}),size:Yu(t,Math.max(n,e)),alignment:e}}function Yu(r,e){return Math.ceil(r/e)*e}class jt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}jt.prototype.bytesPerElement=4,N(jt,"StructArrayLayout2i4");class Mi extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=3*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,e}}Mi.prototype.bytesPerElement=6,N(Mi,"StructArrayLayout3i6");class fn extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const a=4*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=s,e}}fn.prototype.bytesPerElement=8,N(fn,"StructArrayLayout4i8");class Pa extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,i,s,a,o)}emplace(e,t,n,i,s,a,o,l){const u=6*e,c=12*e,p=3*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.uint8[c+4]=i,this.uint8[c+5]=s,this.uint8[c+6]=a,this.uint8[c+7]=o,this.float32[p+2]=l,e}}Pa.prototype.bytesPerElement=12,N(Pa,"StructArrayLayout2i4ub1f12");class yn extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const a=4*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=s,e}}yn.prototype.bytesPerElement=16,N(yn,"StructArrayLayout4f16");class Nt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,s)}emplace(e,t,n,i,s,a){const o=6*e,l=3*e;return this.uint16[o+0]=t,this.uint16[o+1]=n,this.uint16[o+2]=i,this.uint16[o+3]=s,this.float32[l+2]=a,e}}Nt.prototype.bytesPerElement=12,N(Nt,"StructArrayLayout4ui1f12");class Ti extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const a=4*e;return this.uint16[a+0]=t,this.uint16[a+1]=n,this.uint16[a+2]=i,this.uint16[a+3]=s,e}}Ti.prototype.bytesPerElement=8,N(Ti,"StructArrayLayout4ui8");class Ci extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,s,a)}emplace(e,t,n,i,s,a,o){const l=6*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+3]=s,this.int16[l+4]=a,this.int16[l+5]=o,e}}Ci.prototype.bytesPerElement=12,N(Ci,"StructArrayLayout6i12");class za extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o,l,u,c,p,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,i,s,a,o,l,u,c,p,h)}emplace(e,t,n,i,s,a,o,l,u,c,p,h,d){const f=12*e;return this.int16[f+0]=t,this.int16[f+1]=n,this.int16[f+2]=i,this.int16[f+3]=s,this.uint16[f+4]=a,this.uint16[f+5]=o,this.uint16[f+6]=l,this.uint16[f+7]=u,this.int16[f+8]=c,this.int16[f+9]=p,this.int16[f+10]=h,this.int16[f+11]=d,e}}za.prototype.bytesPerElement=24,N(za,"StructArrayLayout4i4ui4i24");class Da extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,s,a)}emplace(e,t,n,i,s,a,o){const l=10*e,u=5*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.float32[u+2]=s,this.float32[u+3]=a,this.float32[u+4]=o,e}}Da.prototype.bytesPerElement=20,N(Da,"StructArrayLayout3i3f20");class Ba extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Ba.prototype.bytesPerElement=4,N(Ba,"StructArrayLayout1ul4");class Ra extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o,l,u,c,p,h,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,i,s,a,o,l,u,c,p,h,d)}emplace(e,t,n,i,s,a,o,l,u,c,p,h,d,f){const y=20*e,m=10*e;return this.int16[y+0]=t,this.int16[y+1]=n,this.int16[y+2]=i,this.int16[y+3]=s,this.int16[y+4]=a,this.float32[m+3]=o,this.float32[m+4]=l,this.float32[m+5]=u,this.float32[m+6]=c,this.int16[y+14]=p,this.uint32[m+8]=h,this.uint16[y+18]=d,this.uint16[y+19]=f,e}}Ra.prototype.bytesPerElement=40,N(Ra,"StructArrayLayout5i4f1i1ul2ui40");class Ei extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,i,s,a,o)}emplace(e,t,n,i,s,a,o,l){const u=8*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=i,this.int16[u+4]=s,this.int16[u+5]=a,this.int16[u+6]=o,this.int16[u+7]=l,e}}Ei.prototype.bytesPerElement=16,N(Ei,"StructArrayLayout3i2i2i16");class Hu extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,s)}emplace(e,t,n,i,s,a){const o=4*e,l=8*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.int16[l+6]=s,this.int16[l+7]=a,e}}Hu.prototype.bytesPerElement=16,N(Hu,"StructArrayLayout2f1f2i16");class Va extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[o+1]=i,this.float32[o+2]=s,e}}Va.prototype.bytesPerElement=12,N(Va,"StructArrayLayout2ub2f12");class La extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=3*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,e}}La.prototype.bytesPerElement=12,N(La,"StructArrayLayout3f12");class xt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=n,this.uint16[s+2]=i,e}}xt.prototype.bytesPerElement=6,N(xt,"StructArrayLayout3ui6");class Fa extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o,l,u,c,p,h,d,f,y,m,g,b,x,v,w){const _=this.length;return this.resize(_+1),this.emplace(_,e,t,n,i,s,a,o,l,u,c,p,h,d,f,y,m,g,b,x,v,w)}emplace(e,t,n,i,s,a,o,l,u,c,p,h,d,f,y,m,g,b,x,v,w,_){const A=30*e,S=15*e,C=60*e;return this.int16[A+0]=t,this.int16[A+1]=n,this.int16[A+2]=i,this.float32[S+2]=s,this.float32[S+3]=a,this.uint16[A+8]=o,this.uint16[A+9]=l,this.uint32[S+5]=u,this.uint32[S+6]=c,this.uint32[S+7]=p,this.uint16[A+16]=h,this.uint16[A+17]=d,this.uint16[A+18]=f,this.float32[S+10]=y,this.float32[S+11]=m,this.uint8[C+48]=g,this.uint8[C+49]=b,this.uint8[C+50]=x,this.uint32[S+13]=v,this.int16[A+28]=w,this.uint8[C+58]=_,e}}Fa.prototype.bytesPerElement=60,N(Fa,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ua extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o,l,u,c,p,h,d,f,y,m,g,b,x,v,w,_,A,S,C,z,k,M,E,P){const B=this.length;return this.resize(B+1),this.emplace(B,e,t,n,i,s,a,o,l,u,c,p,h,d,f,y,m,g,b,x,v,w,_,A,S,C,z,k,M,E,P)}emplace(e,t,n,i,s,a,o,l,u,c,p,h,d,f,y,m,g,b,x,v,w,_,A,S,C,z,k,M,E,P,B){const I=38*e,L=19*e;return this.int16[I+0]=t,this.int16[I+1]=n,this.int16[I+2]=i,this.float32[L+2]=s,this.float32[L+3]=a,this.int16[I+8]=o,this.int16[I+9]=l,this.int16[I+10]=u,this.int16[I+11]=c,this.int16[I+12]=p,this.int16[I+13]=h,this.uint16[I+14]=d,this.uint16[I+15]=f,this.uint16[I+16]=y,this.uint16[I+17]=m,this.uint16[I+18]=g,this.uint16[I+19]=b,this.uint16[I+20]=x,this.uint16[I+21]=v,this.uint16[I+22]=w,this.uint16[I+23]=_,this.uint16[I+24]=A,this.uint16[I+25]=S,this.uint16[I+26]=C,this.uint16[I+27]=z,this.uint16[I+28]=k,this.uint32[L+15]=M,this.float32[L+16]=E,this.float32[L+17]=P,this.float32[L+18]=B,e}}Ua.prototype.bytesPerElement=76,N(Ua,"StructArrayLayout3i2f6i15ui1ul3f76");class Pi extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Pi.prototype.bytesPerElement=4,N(Pi,"StructArrayLayout1f4");class Ku extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,s)}emplace(e,t,n,i,s,a){const o=5*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=s,this.float32[o+4]=a,e}}Ku.prototype.bytesPerElement=20,N(Ku,"StructArrayLayout5f20");class Oa extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const a=6*e;return this.uint32[3*e+0]=t,this.uint16[a+2]=n,this.uint16[a+3]=i,this.uint16[a+4]=s,e}}Oa.prototype.bytesPerElement=12,N(Oa,"StructArrayLayout1ul3ui12");class zr extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}zr.prototype.bytesPerElement=4,N(zr,"StructArrayLayout2ui4");class zi extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}zi.prototype.bytesPerElement=2,N(zi,"StructArrayLayout1ui2");class Di extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}Di.prototype.bytesPerElement=8,N(Di,"StructArrayLayout2f8");class Ju extends Ii{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ju.prototype.size=40;class ja extends Ra{get(e){return new Ju(this,e)}}N(ja,"CollisionBoxArray");class Qu extends Ii{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Qu.prototype.size=60;class ec extends Fa{get(e){return new Qu(this,e)}}N(ec,"PlacedSymbolArray");class tc extends Ii{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}tc.prototype.size=76;class rc extends Ua{get(e){return new tc(this,e)}}N(rc,"SymbolInstanceArray");class nc extends Pi{getoffsetX(e){return this.float32[1*e+0]}}N(nc,"GlyphOffsetArray");class ic extends jt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}N(ic,"SymbolLineVertexArray");class sc extends Ii{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sc.prototype.size=12;class ac extends Oa{get(e){return new sc(this,e)}}N(ac,"FeatureIndexArray");class oc extends zr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}N(oc,"FillExtrusionCentroidArray");const Ld=ve([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Fd=ve([{name:"a_dash",components:4,type:"Uint16"}]);var ir={},Ud={get exports(){return ir},set exports(r){ir=r}},Na={};({get exports(){return Na},set exports(r){Na=r}}).exports=function(r,e){var t,n,i,s,a,o,l,u;for(n=r.length-(t=3&r.length),i=e,a=3432918353,o=461845907,u=0;u<n;)l=255&r.charCodeAt(u)|(255&r.charCodeAt(++u))<<8|(255&r.charCodeAt(++u))<<16|(255&r.charCodeAt(++u))<<24,++u,i=27492+(65535&(s=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,t){case 3:l^=(255&r.charCodeAt(u+2))<<16;case 2:l^=(255&r.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&r.charCodeAt(u)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295}return i^=r.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0};var $a={};({get exports(){return $a},set exports(r){$a=r}}).exports=function(r,e){for(var t,n=r.length,i=e^n,s=0;n>=4;)t=1540483477*(65535&(t=255&r.charCodeAt(s)|(255&r.charCodeAt(++s))<<8|(255&r.charCodeAt(++s))<<16|(255&r.charCodeAt(++s))<<24))+((1540483477*(t>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(t=1540483477*(65535&(t^=t>>>24))+((1540483477*(t>>>16)&65535)<<16)),n-=4,++s;switch(n){case 3:i^=(255&r.charCodeAt(s+2))<<16;case 2:i^=(255&r.charCodeAt(s+1))<<8;case 1:i=1540483477*(65535&(i^=255&r.charCodeAt(s)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0};var lc=Na,Od=$a;Ud.exports=lc,ir.murmur3=lc,ir.murmur2=Od;class Bi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(uc(e)),this.positions.push(t,n,i)}getPositions(e){const t=uc(e);let n=0,i=this.ids.length-1;for(;n<i;){const a=n+i>>1;this.ids[a]>=t?i=a:n=a+1}const s=[];for(;this.ids[n]===t;)s.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return s}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return qa(n,i,0,n.length-1),t&&t.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(e){const t=new Bi;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function uc(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ir(String(r))}function qa(r,e,t,n){for(;t<n;){const i=r[t+n>>1];let s=t-1,a=n+1;for(;;){do s++;while(r[s]<i);do a--;while(r[a]>i);if(s>=a)break;Ri(r,s,a),Ri(e,3*s,3*a),Ri(e,3*s+1,3*a+1),Ri(e,3*s+2,3*a+2)}a-t<n-a?(qa(r,e,t,a),t=a+1):(qa(r,e,a+1,n),n=a)}}function Ri(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}N(Bi,"FeaturePositionMap");class Ga{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Za extends Ga{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class jd extends Ga{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class Nd extends Ga{constructor(e){super(e),this.current=Ce.transparent}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}function Xa(r){return[Wu(255*r.r,255*r.g),Wu(255*r.b,255*r.a)]}class mn{constructor(e,t,n){this.value=e,this.uniformNames=t.map(i=>`u_${i}`),this.type=n}setUniform(e,t,n,i,s){t.set(e,s,i.constantOr(this.value))}getBinding(e,t){return this.type==="color"?new Nd(e):new Za(e)}}class Dr{constructor(e,t){this.uniformNames=t.map(n=>`u_${n}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,n,i,s){const a=s==="u_pattern"||s==="u_dash"?this.pattern:s==="u_pixel_ratio"?this.pixelRatio:null;a&&t.set(e,s,a)}getBinding(e,t){return t==="u_pattern"||t==="u_dash"?new jd(e):new Za(e)}}class Mt{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(s=>({name:`a_${s}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,s,a){const o=this.paintVertexArray.length,l=this.expression.evaluate(new we(0),t,{},s,i,a);this.paintVertexArray.resize(e),this._setPaintValue(o,e,l)}updatePaintArray(e,t,n,i,s){const a=this.expression.evaluate({zoom:0},n,i,void 0,s);this._setPaintValue(e,t,a)}_setPaintValue(e,t,n){if(this.type==="color"){const i=Xa(n);for(let s=e;s<t;s++)this.paintVertexArray.emplace(s,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ot{constructor(e,t,n,i,s,a){this.expression=e,this.uniformNames=t.map(o=>`u_${o}_t`),this.type=n,this.useIntegerZoom=i,this.zoom=s,this.maxValue=0,this.paintVertexAttributes=t.map(o=>({name:`a_${o}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,t,n,i,s,a){const o=this.expression.evaluate(new we(this.zoom),t,{},s,i,a),l=this.expression.evaluate(new we(this.zoom+1),t,{},s,i,a),u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(u,e,o,l)}updatePaintArray(e,t,n,i,s){const a=this.expression.evaluate({zoom:this.zoom},n,i,void 0,s),o=this.expression.evaluate({zoom:this.zoom+1},n,i,void 0,s);this._setPaintValue(e,t,a,o)}_setPaintValue(e,t,n,i){if(this.type==="color"){const s=Xa(n),a=Xa(i);for(let o=e;o<t;o++)this.paintVertexArray.emplace(o,s[0],s[1],a[0],a[1])}else{for(let s=e;s<t;s++)this.paintVertexArray.emplace(s,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,i,s){const a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,o=ue(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(e,s,o)}getBinding(e,t){return new Za(e)}}class $t{constructor(e,t,n,i,s){this.expression=e,this.layerId=s,this.paintVertexAttributes=(n==="array"?Fd:Ld).members;for(let a=0;a<t.length;++a);this.paintVertexArray=new i}populatePaintArray(e,t,n){const i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,s,a){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],a)}_setPaintValues(e,t,n,i){if(!i||!n)return;const s=i[n];if(!s)return;const{tl:a,br:o,pixelRatio:l}=s;for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,a[0],a[1],o[0],o[1],l)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qt{constructor(e,t,n=()=>!0){this.binders={},this._buffers=[];const i=[];for(const s in e.paint._values){if(!n(s))continue;const a=e.paint.get(s);if(!(a instanceof Pr&&Sr(a.property.specification)))continue;const o=qd(s,e.type),l=a.value,u=a.property.specification.type,c=a.property.useIntegerZoom,p=s==="line-dasharray"||s.endsWith("pattern"),h=s==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(l.kind!=="constant"||h)if(l.kind==="source"||h||p){const d=cc(s,u,"source");this.binders[s]=p?new $t(l,o,u,d,e.id):new Mt(l,o,u,d),i.push(`/a_${s}`)}else{const d=cc(s,u,"composite");this.binders[s]=new ot(l,o,u,c,t,d),i.push(`/z_${s}`)}else this.binders[s]=p?new Dr(l.value,o):new mn(l.value,o,u),i.push(`/u_${s}`)}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Mt||t instanceof ot?t.maxValue:0}populatePaintArrays(e,t,n,i,s,a){for(const o in this.binders){const l=this.binders[o];(l instanceof Mt||l instanceof ot||l instanceof $t)&&l.populatePaintArray(e,t,n,i,s,a)}}setConstantPatternPositions(e){for(const t in this.binders){const n=this.binders[t];n instanceof Dr&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,t,n,i,s,a){let o=!1;for(const l in e){const u=t.getPositions(l);for(const c of u){const p=n.feature(c.index);for(const h in this.binders){const d=this.binders[h];if((d instanceof Mt||d instanceof ot||d instanceof $t)&&d.expression.isStateDependent===!0){const f=i.paint.get(h);d.expression=f.value,d.updatePaintArray(c.start,c.end,p,e[l],s,a),o=!0}}}}return o}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof mn||n instanceof Dr)&&e.push(...n.uniformNames.map(i=>`#define HAS_UNIFORM_${i}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Mt||n instanceof ot||n instanceof $t)for(let i=0;i<n.paintVertexAttributes.length;i++)e.push(n.paintVertexAttributes[i].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof mn||n instanceof Dr||n instanceof ot)for(const i of n.uniformNames)e.push(i)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof mn||i instanceof Dr||i instanceof ot)for(const s of i.uniformNames)t.push({name:s,property:n,binding:i.getBinding(e,s)})}return t}setUniforms(e,t,n,i,s){for(const{name:a,property:o,binding:l}of n)this.binders[o].setUniform(e,l,s,i.get(o),a)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Mt||t instanceof ot||t instanceof $t)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Mt||n instanceof ot||n instanceof $t)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Mt||t instanceof ot||t instanceof $t)&&t.destroy()}}}class sr{constructor(e,t,n=()=>!0){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new qt(i,t,n);this.needsUpload=!1,this._featureMap=new Bi,this._bufferOffset=0}populatePaintArrays(e,t,n,i,s,a,o){for(const l in this.programConfigurations)this.programConfigurations[l].populatePaintArrays(e,t,i,s,a,o);t.id!==void 0&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i,s){for(const a of n)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(e,this._featureMap,t,a,i,s)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const $d={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function qd(r,e){return $d[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const Gd={"line-pattern":{source:Nt,composite:Nt},"fill-pattern":{source:Nt,composite:Nt},"fill-extrusion-pattern":{source:Nt,composite:Nt},"line-dasharray":{source:Ti,composite:Ti}},Zd={color:{source:Di,composite:yn},number:{source:Pi,composite:Di}};function cc(r,e,t){const n=Gd[r];return n&&n[t]||Zd[e][t]}N(mn,"ConstantBinder"),N(Dr,"PatternConstantBinder"),N(Mt,"SourceExpressionBinder"),N($t,"PatternCompositeBinder"),N(ot,"CompositeExpressionBinder"),N(qt,"ProgramConfiguration",{omit:["_buffers"]}),N(sr,"ProgramConfigurationSet");const Vi="-transition";class lt extends mi{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Rd(t.layout)),t.paint)){this._transitionablePaint=new Bd(t.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ai(t.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){t!=null&&this._validate(Md,`layers.${this.id}.layout.${e}`,e,t,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return ws(e,Vi)?this._transitionablePaint.getTransition(e.slice(0,-Vi.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(t!=null&&this._validate(Id,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(ws(e,Vi))return this._transitionablePaint.setTransition(e.slice(0,-Vi.length),t||void 0),!1;{const i=this._transitionablePaint._values[e],s=i.value.isDataDriven(),a=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const o=this._transitionablePaint._values[e].value,l=o.isDataDriven(),u=ws(e,"pattern")||e==="line-dasharray";return l||s||u||this._handleOverridablePaintPropertyUpdate(e,a,o)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),function(t,n,i){const s={};for(const a in t)n.call(this,t[a],a,t)&&(s[a]=t[a]);return s}(e,(t,n)=>!(t===void 0||n==="layout"&&!Object.keys(t).length||n==="paint"&&!Object.keys(t).length))}_validate(e,t,n,i,s={}){return(!s||s.validate!==!1)&&function(a,o){let l=!1;if(o&&o.length)for(const u of o)a.fire(new ga(new Error(u.message))),l=!0;return l}(this,e.call(kd,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:T,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Pr&&Sr(t.property.specification)&&(t.value.kind==="source"||t.value.kind==="composite")&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=xi(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Xd=ve([{name:"a_pos",components:2,type:"Int16"}],4),Wd=ve([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ue{constructor(e=[]){this.segments=e}prepareSegment(e,t,n,i){let s=this.segments[this.segments.length-1];return e>Ue.MAX_VERTEX_ARRAY_LENGTH&&Pe(`Max vertices per segment is ${Ue.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!s||s.vertexLength+e>Ue.MAX_VERTEX_ARRAY_LENGTH||s.sortKey!==i)&&(s={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},i!==void 0&&(s.sortKey=i),this.segments.push(s)),s}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new Ue([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}Ue.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,N(Ue,"SegmentVector");var Y=8192;class ar{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ae?new ae(e.lng,e.lat):ae.convert(e),this}setSouthWest(e){return this._sw=e instanceof ae?new ae(e.lng,e.lat):ae.convert(e),this}extend(e){const t=this._sw,n=this._ne;let i,s;if(e instanceof ae)i=e,s=e;else{if(!(e instanceof ar))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ar.convert(e)):this.extend(ae.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(ae.convert(e)):this;if(i=e._sw,s=e._ne,!i||!s)return this}return t||n?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),n.lng=Math.max(s.lng,n.lng),n.lat=Math.max(s.lat,n.lat)):(this._sw=new ae(i.lng,i.lat),this._ne=new ae(s.lng,s.lat)),this}getCenter(){return new ae((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ae(this.getWest(),this.getNorth())}getSouthEast(){return new ae(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=ae.convert(e);let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(e){return!e||e instanceof ar?e:new ar(e)}}var Wa=1e-6,vt=typeof Float32Array<"u"?Float32Array:Array;function gn(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function hc(r,e){var t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],c=e[8],p=e[9],h=e[10],d=e[11],f=e[12],y=e[13],m=e[14],g=e[15],b=t*o-n*a,x=t*l-i*a,v=t*u-s*a,w=n*l-i*o,_=n*u-s*o,A=i*u-s*l,S=c*y-p*f,C=c*m-h*f,z=c*g-d*f,k=p*m-h*y,M=p*g-d*y,E=h*g-d*m,P=b*E-x*M+v*k+w*z-_*C+A*S;return P?(r[0]=(o*E-l*M+u*k)*(P=1/P),r[1]=(i*M-n*E-s*k)*P,r[2]=(y*A-m*_+g*w)*P,r[3]=(h*_-p*A-d*w)*P,r[4]=(l*z-a*E-u*C)*P,r[5]=(t*E-i*z+s*C)*P,r[6]=(m*v-f*A-g*x)*P,r[7]=(c*A-h*v+d*x)*P,r[8]=(a*M-o*z+u*S)*P,r[9]=(n*z-t*M-s*S)*P,r[10]=(f*_-y*v+g*b)*P,r[11]=(p*v-c*_-d*b)*P,r[12]=(o*C-a*k-l*S)*P,r[13]=(t*k-n*C+i*S)*P,r[14]=(y*x-f*w-m*b)*P,r[15]=(c*w-p*x+h*b)*P,r):null}function pc(r,e,t){var n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],l=e[5],u=e[6],c=e[7],p=e[8],h=e[9],d=e[10],f=e[11],y=e[12],m=e[13],g=e[14],b=e[15],x=t[0],v=t[1],w=t[2],_=t[3];return r[0]=x*n+v*o+w*p+_*y,r[1]=x*i+v*l+w*h+_*m,r[2]=x*s+v*u+w*d+_*g,r[3]=x*a+v*c+w*f+_*b,r[4]=(x=t[4])*n+(v=t[5])*o+(w=t[6])*p+(_=t[7])*y,r[5]=x*i+v*l+w*h+_*m,r[6]=x*s+v*u+w*d+_*g,r[7]=x*a+v*c+w*f+_*b,r[8]=(x=t[8])*n+(v=t[9])*o+(w=t[10])*p+(_=t[11])*y,r[9]=x*i+v*l+w*h+_*m,r[10]=x*s+v*u+w*d+_*g,r[11]=x*a+v*c+w*f+_*b,r[12]=(x=t[12])*n+(v=t[13])*o+(w=t[14])*p+(_=t[15])*y,r[13]=x*i+v*l+w*h+_*m,r[14]=x*s+v*u+w*d+_*g,r[15]=x*a+v*c+w*f+_*b,r}function dc(r,e,t){var n,i,s,a,o,l,u,c,p,h,d,f,y=t[0],m=t[1],g=t[2];return e===r?(r[12]=e[0]*y+e[4]*m+e[8]*g+e[12],r[13]=e[1]*y+e[5]*m+e[9]*g+e[13],r[14]=e[2]*y+e[6]*m+e[10]*g+e[14],r[15]=e[3]*y+e[7]*m+e[11]*g+e[15]):(i=e[1],s=e[2],a=e[3],o=e[4],l=e[5],u=e[6],c=e[7],p=e[8],h=e[9],d=e[10],f=e[11],r[0]=n=e[0],r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=l,r[6]=u,r[7]=c,r[8]=p,r[9]=h,r[10]=d,r[11]=f,r[12]=n*y+o*m+p*g+e[12],r[13]=i*y+l*m+h*g+e[13],r[14]=s*y+u*m+d*g+e[14],r[15]=a*y+c*m+f*g+e[15]),r}function Li(r,e,t){var n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Ya(){var r=new vt(3);return vt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function fc(r){var e=new vt(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Ha(r){return Math.hypot(r[0],r[1],r[2])}function Fi(r,e,t){var n=new vt(3);return n[0]=r,n[1]=e,n[2]=t,n}function Br(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function Yd(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r}function Hd(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r}function Gt(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}function Ka(r,e,t,n){return r[0]=e[0]+t[0]*n,r[1]=e[1]+t[1]*n,r[2]=e[2]+t[2]*n,r}function ut(r,e){var t=e[0],n=e[1],i=e[2],s=t*t+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function Zt(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function ct(r,e,t){var n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s+t[15];return r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/(a=a||1),r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/a,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/a,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var bt,Rr=function(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r};function xn(r,e,t){var n=e[0],i=e[1],s=e[2],a=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*a,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*a,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*a,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*a,r}function yc(){var r=new vt(4);return vt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}Ya(),function(){var r;r=new vt(4),vt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0)}(),Ya(),Fi(1,0,0),Fi(0,1,0),yc(),yc(),bt=new vt(9),vt!=Float32Array&&(bt[1]=0,bt[2]=0,bt[3]=0,bt[5]=0,bt[6]=0,bt[7]=0),bt[0]=1,bt[4]=1,bt[8]=1,ve([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);const mc=ve([{name:"a_pos_3",components:3,type:"Int16"}]);var Ja=ve([{name:"a_pos",type:"Int16",components:2}]);class gc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const i=Zt(t,this.dir);if(Math.abs(i)<1e-6)return!1;const s=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/i;return n[0]=this.pos[0]+this.dir[0]*s,n[1]=this.pos[1]+this.dir[1]*s,n[2]=this.pos[2]+this.dir[2]*s,!0}closestPointOnSphere(e,t,n){if(function(d,f){var y=d[0],m=d[1],g=d[2],b=f[0],x=f[1],v=f[2];return Math.abs(y-b)<=Wa*Math.max(1,Math.abs(y),Math.abs(b))&&Math.abs(m-x)<=Wa*Math.max(1,Math.abs(m),Math.abs(x))&&Math.abs(g-v)<=Wa*Math.max(1,Math.abs(g),Math.abs(v))}(this.pos,e)||t===0)return n[0]=n[1]=n[2]=0,!1;const[i,s,a]=this.dir,o=this.pos[0]-e[0],l=this.pos[1]-e[1],u=this.pos[2]-e[2],c=i*i+s*s+a*a,p=2*(o*i+l*s+u*a),h=p*p-4*c*(o*o+l*l+u*u-t*t);if(h<0){const d=Math.max(-p/2,0),f=o+i*d,y=l+s*d,m=u+a*d,g=Math.hypot(f,y,m);return n[0]=f*t/g,n[1]=y*t/g,n[2]=m*t/g,!1}{const d=(-p-Math.sqrt(h))/(2*c);if(d<0){const f=Math.hypot(o,l,u);return n[0]=o*t/f,n[1]=l*t/f,n[2]=u*t/f,!1}return n[0]=o+i*d,n[1]=l+s*d,n[2]=u+a*d,!0}}}class ht{static fromPoints(e){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const i of e)Yd(t,t,i),Hd(n,n,i);return new ht(t,n)}static applyTransform(e,t){const n=e.getCorners();for(let i=0;i<n.length;++i)ct(n[i],n[i],t);return ht.fromPoints(n)}constructor(e,t){this.min=e,this.max=t,this.center=Gt([],Br([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=fc(this.min),i=fc(this.max);for(let s=0;s<t.length;s++)n[s]=t[s]?this.min[s]:this.center[s],i[s]=t[s]?this.center[s]:this.max[s];return i[2]=this.max[2],new ht(n,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let n=!0;for(let i=0;i<e.planes.length;i++){const s=e.planes[i];let a=0;for(let o=0;o<t.length;o++)a+=Zt(s,t[o])+s[3]>=0;if(a===0)return 0;a!==t.length&&(n=!1)}if(n)return 2;for(let i=0;i<3;i++){let s=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let o=0;o<e.points.length;o++){const l=e.points[o][i]-this.min[i];s=Math.min(s,l),a=Math.max(a,l)}if(a<0||s>this.max[i]-this.min[i])return 0}return 1}}const vn=Y/Math.PI/2,pt=-vn,dt=vn,Kd=[new ht([pt,pt,pt],[dt,dt,dt]),new ht([pt,pt,pt],[0,0,dt]),new ht([0,pt,pt],[dt,0,dt]),new ht([pt,0,pt],[0,dt,dt]),new ht([0,0,pt],[dt,dt,dt])];function xc(r){return r*vn/Ui}function vc(r,e,t,n=!0){const i=Gt([],r._camera.position,r.worldSize),s=[e,t,1,1];xn(s,s,r.pixelMatrixInverse),function(z,k,M){z[0]=k[0]*M,z[1]=k[1]*M,z[2]=k[2]*M,z[3]=k[3]*M}(s,s,1/s[3]);const a=ut([],Rr([],s,i)),o=r.globeMatrix,l=[o[12],o[13],o[14]],u=Rr([],l,i),c=Ha(u),p=ut([],u),h=r.worldSize/(2*Math.PI),d=Zt(p,a),f=Math.asin(h/c);if(f<Math.acos(d)){if(!n)return null;const z=[],k=[];Gt(z,a,c/d),ut(k,Rr(k,z,u)),ut(a,Br(a,u,Gt(a,k,Math.tan(f)*c)))}const y=[];new gc(i,a).closestPointOnSphere(l,h,y);const m=ut([],Is(o,0)),g=ut([],Is(o,1)),b=ut([],Is(o,2)),x=Zt(m,y),v=Zt(g,y),w=Zt(b,y),_=et(Math.asin(-v/h));let A=et(Math.atan2(x,w));A=r.center.lng+function(z,k){const M=(k-z+180)%360-180;return M<-180?M+360:M}(r.center.lng,A);const S=or(A),C=ue(lr(_),0,1);return new Oi(S,C)}function bn(r){if(r.z<=1)return Kd[r.z+2*r.y+r.x];const e=_c(bc(r));return ht.fromPoints(e)}function _n(r,e,t){return Gt(r,r,1-t),Ka(r,r,e,t)}function bc({x:r,y:e,z:t}){const n=1/(1<<t),i=new ae(nt(r*n),je((e+1)*n)),s=new ae(nt((r+1)*n),je(e*n));return new ar(i,s)}function _c(r){const e=me(r.getNorth()),t=me(r.getSouth()),n=Math.cos(e),i=Math.cos(t),s=Math.sin(e),a=Math.sin(t),o=r.getWest(),l=r.getEast();return[wn(i,a,o),wn(i,a,l),wn(n,s,l),wn(n,s,o)]}function wn(r,e,t,n=vn){return t=me(t),[r*Math.sin(t)*n,-e*n,r*Math.cos(t)*n]}function Qa(r,e,t){return wn(Math.cos(me(r)),Math.sin(me(r)),e,t)}function Sn(r,e,t,n){const i=1<<t.z,s=(r/Y+t.x)/i;return Qa(je((e/Y+t.y)/i),nt(s),n)}function eo({min:r,max:e}){return 16383/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const wc=new Float64Array(16);function to(r){const e=eo(r),t=function(n,i){return n[0]=i[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=i[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}(wc,[e,e,e]);return dc(t,t,function(n,i){return n[0]=-i[0],n[1]=-i[1],n[2]=-i[2],n}([],r.min))}function ro(r){return(e=ue(((e=r)-5)/1,0,1))*e*(3-2*e);var e}const Ui=63710088e-1,Sc=2*Math.PI*Ui;class ae{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ae(el(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,s=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Ui*Math.acos(Math.min(s,1))}toBounds(e=0){const t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new ar(new ae(this.lng-n,this.lat-t),new ae(this.lng+n,this.lat+t))}toEcef(e){const t=xc(e);return Qa(this.lat,this.lng,vn+t)}static convert(e){if(e instanceof ae)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ae(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ae(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function Ac(r){return Sc*Math.cos(r*Math.PI/180)}function or(r){return(180+r)/360}function lr(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Tt(r,e){return r/Ac(e)}function nt(r){return 360*r-180}function je(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}const ur=85.051129;class Oi{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=ae.convert(e);return new Oi(or(n.lng),lr(n.lat),Tt(t,n.lat))}toLngLat(){return new ae(nt(this.x),je(this.y))}toAltitude(){return this.z*Ac(je(this.y))}meterInMercatorCoordinateUnits(){return 1/Sc*(e=je(this.y),1/Math.cos(e*Math.PI/180));var e}}function no(r,e,t,n,i,s,a,o,l){const u=(e+n)/2,c=(t+i)/2,p=new O(u,c);o(p),function(h,d,f,y,m,g){const b=f-m,x=y-g;return Math.abs((y-d)*b-(f-h)*x)/Math.hypot(b,x)}(p.x,p.y,s.x,s.y,a.x,a.y)>=l?(no(r,e,t,u,c,s,p,o,l),no(r,u,c,n,i,p,a,o,l)):r.push(a)}function Jd(r,e,t){let n=r[0],i=n.x,s=n.y;e(n);const a=[n];for(let o=1;o<r.length;o++){const l=r[o],{x:u,y:c}=l;e(l),no(a,i,s,u,c,n,l,e,t),i=u,s=c,n=l}return a}function io(r,e,t,n){if(n(e,t)){const i=e.add(t)._mult(.5);io(r,e,i,n),io(r,i,t,n)}else r.push(t)}function Qd(r,e){let t=r[0];const n=[t];for(let i=1;i<r.length;i++){const s=r[i];io(n,t,s,e),t=s}return n}const so=Math.pow(2,14)-1,kc=-so-1;function ef(r,e){const t=Math.round(r.x*e),n=Math.round(r.y*e);return r.x=ue(t,kc,so),r.y=ue(n,kc,so),(t<r.x||t>r.x+1||n<r.y||n>r.y+1)&&Pe("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Ct(r,e,t){const n=r.loadGeometry(),i=r.extent,s=Y/i;if(e&&t&&t.projection.isReprojectedInTileSpace){const a=1<<e.z,{scale:o,x:l,y:u,projection:c}=t,p=h=>{const d=nt((e.x+h.x/i)/a),f=je((e.y+h.y/i)/a),y=c.project(d,f);h.x=(y.x*o-l)*i,h.y=(y.y*o-u)*i};for(let h=0;h<n.length;h++)if(r.type!==1)n[h]=Jd(n[h],p,1);else{const d=[];for(const f of n[h])f.x<0||f.x>=i||f.y<0||f.y>=i||(p(f),d.push(f));n[h]=d}}for(const a of n)for(const o of a)ef(o,s);return n}function cr(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Ct(r):[]}}function ji(r,e,t,n,i){r.emplaceBack(2*e+(n+1)/2,2*t+(i+1)/2)}function Ni(r,e,t){r.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class ao{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new jt,this.indexArray=new xt,this.segments=new Ue,this.programConfigurations=new sr(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,n,i){const s=this.layers[0],a=[];let o=null;s.type==="circle"&&(o=s.layout.get("circle-sort-key"));for(const{feature:u,id:c,index:p,sourceLayerIndex:h}of e){const d=this.layers[0]._featureFilter.needGeometry,f=cr(u,d);if(!this.layers[0]._featureFilter.filter(new we(this.zoom),f,n))continue;const y=o?o.evaluate(f,{},n):void 0,m={id:c,properties:u.properties,type:u.type,sourceLayerIndex:h,index:p,geometry:d?f.geometry:Ct(u,n,i),patterns:{},sortKey:y};a.push(m)}o&&a.sort((u,c)=>u.sortKey-c.sortKey);let l=null;i.projection.name==="globe"&&(this.globeExtVertexArray=new Ci,l=i.projection);for(const u of a){const{geometry:c,index:p,sourceLayerIndex:h}=u,d=e[p].feature;this.addFeature(u,c,p,t.availableImages,n,l),t.featureIndex.insert(d,c,p,h,this.index)}}update(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Wd.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,n,i,s,a){for(const o of t)for(const l of o){const u=l.x,c=l.y;if(u<0||u>=Y||c<0||c>=Y)continue;if(a){const d=a.projectTilePoint(u,c,s),f=a.upVector(s,u,c),y=this.globeExtVertexArray;Ni(y,d,f),Ni(y,d,f),Ni(y,d,f),Ni(y,d,f)}const p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),h=p.vertexLength;ji(this.layoutVertexArray,u,c,-1,-1),ji(this.layoutVertexArray,u,c,1,-1),ji(this.layoutVertexArray,u,c,1,1),ji(this.layoutVertexArray,u,c,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+2,h+3),p.vertexLength+=4,p.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i,s)}}function tf(r,e){for(let t=0;t<r.length;t++)if(Vr(e,r[t]))return!0;for(let t=0;t<e.length;t++)if(Vr(r,e[t]))return!0;return!!oo(r,e)}function rf(r,e,t){return!!Vr(r,e)||!!lo(e,r,t)}function Ic(r,e){if(r.length===1)return Tc(e,r[0]);for(let t=0;t<e.length;t++){const n=e[t];for(let i=0;i<n.length;i++)if(Vr(r,n[i]))return!0}for(let t=0;t<r.length;t++)if(Tc(e,r[t]))return!0;for(let t=0;t<e.length;t++)if(oo(r,e[t]))return!0;return!1}function nf(r,e,t){if(r.length>1){if(oo(r,e))return!0;for(let n=0;n<e.length;n++)if(lo(e[n],r,t))return!0}for(let n=0;n<r.length;n++)if(lo(r[n],e,t))return!0;return!1}function oo(r,e){if(r.length===0||e.length===0)return!1;for(let t=0;t<r.length-1;t++){const n=r[t],i=r[t+1];for(let s=0;s<e.length-1;s++)if(sf(n,i,e[s],e[s+1]))return!0}return!1}function sf(r,e,t,n){return Lt(r,t,n)!==Lt(e,t,n)&&Lt(r,e,t)!==Lt(r,e,n)}function lo(r,e,t){const n=t*t;if(e.length===1)return r.distSqr(e[0])<n;for(let i=1;i<e.length;i++)if(Mc(r,e[i-1],e[i])<n)return!0;return!1}function Mc(r,e,t){const n=e.distSqr(t);if(n===0)return r.distSqr(e);const i=((r.x-e.x)*(t.x-e.x)+(r.y-e.y)*(t.y-e.y))/n;return r.distSqr(i<0?e:i>1?t:t.sub(e)._mult(i)._add(e))}function Tc(r,e){let t,n,i,s=!1;for(let a=0;a<r.length;a++){t=r[a];for(let o=0,l=t.length-1;o<t.length;l=o++)n=t[o],i=t[l],n.y>e.y!=i.y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(s=!s)}return s}function Vr(r,e){let t=!1;for(let n=0,i=r.length-1;n<r.length;i=n++){const s=r[n],a=r[i];s.y>e.y!=a.y>e.y&&e.x<(a.x-s.x)*(e.y-s.y)/(a.y-s.y)+s.x&&(t=!t)}return t}function af(r,e,t){const n=t[0],i=t[2];if(r.x<n.x&&e.x<n.x||r.x>i.x&&e.x>i.x||r.y<n.y&&e.y<n.y||r.y>i.y&&e.y>i.y)return!1;const s=Lt(r,e,t[0]);return s!==Lt(r,e,t[1])||s!==Lt(r,e,t[2])||s!==Lt(r,e,t[3])}function Lr(r,e,t){const n=e.paint.get(r).value;return n.kind==="constant"?n.value:t.programConfigurations.get(e.id).getMaxValue(r)}function $i(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Cc(r,e,t,n,i){if(!e[0]&&!e[1])return r;const s=O.convert(e)._mult(i);t==="viewport"&&s._rotate(-n);const a=[];for(let o=0;o<r.length;o++)a.push(r[o].sub(s));return a}function Ec(r,e,t,n){const i=O.convert(r)._mult(n);return e==="viewport"&&i._rotate(-t),i}N(ao,"CircleBucket",{omit:["layers"]});const of=new Xe({"circle-sort-key":new Z(T.layout_circle["circle-sort-key"])});var lf={paint:new Xe({"circle-radius":new Z(T.paint_circle["circle-radius"]),"circle-color":new Z(T.paint_circle["circle-color"]),"circle-blur":new Z(T.paint_circle["circle-blur"]),"circle-opacity":new Z(T.paint_circle["circle-opacity"]),"circle-translate":new $(T.paint_circle["circle-translate"]),"circle-translate-anchor":new $(T.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $(T.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $(T.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Z(T.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Z(T.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Z(T.paint_circle["circle-stroke-opacity"])}),layout:of};function Pc(r,e,t,n,i,s,a,o,l){if(s&&r.queryGeometry.isAboveHorizon)return!1;s&&(l*=r.pixelToTileUnitsFactor);const u=r.tileID.canonical,c=t.projection.upVectorScale(u,t.center.lat,t.worldSize).metersToTile;for(const p of e)for(const h of p){const d=h.add(o),f=i&&t.elevation?t.elevation.exaggeration()*i.getElevationAt(d.x,d.y,!0):0,y=t.projection.projectTilePoint(d.x,d.y,u);if(f>0){const x=t.projection.upVector(u,d.x,d.y);y.x+=x[0]*c*f,y.y+=x[1]*c*f,y.z+=x[2]*c*f}const m=s?d:uf(y.x,y.y,y.z,n),g=s?r.tilespaceRays.map(x=>hf(x,f)):r.queryGeometry.screenGeometry,b=xn([],[y.x,y.y,y.z,1],n);if(!a&&s?l*=b[3]/t.cameraToCenterDistance:a&&!s&&(l*=t.cameraToCenterDistance/b[3]),s){const x=je((h.y/Y+u.y)/(1<<u.z));l/=t.projection.pixelsPerMeter(x,1)/Tt(1,x)}if(rf(g,m,l))return!0}return!1}function uf(r,e,t,n){const i=xn([],[r,e,t,1],n);return new O(i[0]/i[3],i[1]/i[3])}const zc=Fi(0,0,0),cf=Fi(0,0,1);function hf(r,e){const t=Ya();return zc[2]=e,r.intersectsPlane(zc,cf,t),new O(t[0],t[1])}class Dc extends ao{}function Bc(r,{width:e,height:t},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==e*t*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(e*t*n);return r.width=e,r.height=t,r.data=i,r}function Rc(r,e,t){const{width:n,height:i}=e;n===r.width&&i===r.height||(uo(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,n),height:Math.min(r.height,i)},t),r.width=n,r.height=i,r.data=e.data)}function uo(r,e,t,n,i,s){if(i.width===0||i.height===0)return e;if(i.width>r.width||i.height>r.height||t.x>r.width-i.width||t.y>r.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const a=r.data,o=e.data;for(let l=0;l<i.height;l++){const u=((t.y+l)*r.width+t.x)*s,c=((n.y+l)*e.width+n.x)*s;for(let p=0;p<i.width*s;p++)o[c+p]=a[u+p]}return e}N(Dc,"HeatmapBucket",{omit:["layers"]});class hr{constructor(e,t){Bc(this,e,1,t)}resize(e){Rc(this,new hr(e),1)}clone(){return new hr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,s){uo(e,t,n,i,s,1)}}class Je{constructor(e,t){Bc(this,e,4,t)}resize(e){Rc(this,new Je(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Je({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,s){uo(e,t,n,i,s,4)}}N(hr,"AlphaImage"),N(Je,"RGBAImage");var pf={paint:new Xe({"heatmap-radius":new Z(T.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Z(T.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $(T.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ki(T.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $(T.paint_heatmap["heatmap-opacity"])})};function Vc(r){const e={},t=r.resolution||256,n=r.clips?r.clips.length:1,i=r.image||new Je({width:t,height:n}),s=(a,o,l)=>{e[r.evaluationKey]=l;const u=r.expression.evaluate(e);i.data[a+o+0]=Math.floor(255*u.r/u.a),i.data[a+o+1]=Math.floor(255*u.g/u.a),i.data[a+o+2]=Math.floor(255*u.b/u.a),i.data[a+o+3]=Math.floor(255*u.a)};if(r.clips)for(let a=0,o=0;a<n;++a,o+=4*t)for(let l=0,u=0;l<t;l++,u+=4){const c=l/(t-1),{start:p,end:h}=r.clips[a];s(o,u,p*(1-c)+h*c)}else for(let a=0,o=0;a<t;a++,o+=4)s(0,o,a/(t-1));return i}var df={paint:new Xe({"hillshade-illumination-direction":new $(T.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $(T.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $(T.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $(T.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $(T.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $(T.paint_hillshade["hillshade-accent-color"])})};const ff=ve([{name:"a_pos",components:2,type:"Int16"}],4),{members:yf}=ff;var Fr={};function qi(r,e,t){t=t||2;var n,i,s,a,o,l,u,c=e&&e.length,p=c?e[0]*t:r.length,h=Lc(r,0,p,t,!0),d=[];if(!h||h.next===h.prev)return d;if(c&&(h=function(y,m,g,b){var x,v,w,_=[];for(x=0,v=m.length;x<v;x++)(w=Lc(y,m[x]*b,x<v-1?m[x+1]*b:y.length,b,!1))===w.next&&(w.steiner=!0),_.push(Sf(w));for(_.sort(bf),x=0;x<_.length;x++)g=_f(_[x],g);return g}(r,e,h,t)),r.length>80*t){n=s=r[0],i=a=r[1];for(var f=t;f<p;f+=t)(o=r[f])<n&&(n=o),(l=r[f+1])<i&&(i=l),o>s&&(s=o),l>a&&(a=l);u=(u=Math.max(s-n,a-i))!==0?32767/u:0}return An(h,d,t,n,i,u,0),d}function Lc(r,e,t,n,i){var s,a;if(i===po(r,e,t,n)>0)for(s=e;s<t;s+=n)a=Oc(s,r[s],r[s+1],a);else for(s=t-n;s>=e;s-=n)a=Oc(s,r[s],r[s+1],a);return a&&Gi(a,a.next)&&(In(a),a=a.next),a}function pr(r,e){if(!r)return r;e||(e=r);var t,n=r;do if(t=!1,n.steiner||!Gi(n,n.next)&&Ie(n.prev,n,n.next)!==0)n=n.next;else{if(In(n),(n=e=n.prev)===n.next)break;t=!0}while(t||n!==e);return e}function An(r,e,t,n,i,s,a){if(r){!a&&s&&function(c,p,h,d){var f=c;do f.z===0&&(f.z=co(f.x,f.y,p,h,d)),f.prevZ=f.prev,f.nextZ=f.next,f=f.next;while(f!==c);f.prevZ.nextZ=null,f.prevZ=null,function(y){var m,g,b,x,v,w,_,A,S=1;do{for(g=y,y=null,v=null,w=0;g;){for(w++,b=g,_=0,m=0;m<S&&(_++,b=b.nextZ);m++);for(A=S;_>0||A>0&&b;)_!==0&&(A===0||!b||g.z<=b.z)?(x=g,g=g.nextZ,_--):(x=b,b=b.nextZ,A--),v?v.nextZ=x:y=x,x.prevZ=v,v=x;g=b}v.nextZ=null,S*=2}while(w>1)}(f)}(r,n,i,s);for(var o,l,u=r;r.prev!==r.next;)if(o=r.prev,l=r.next,s?gf(r,n,i,s):mf(r))e.push(o.i/t|0),e.push(r.i/t|0),e.push(l.i/t|0),In(r),r=l.next,u=l.next;else if((r=l)===u){a?a===1?An(r=xf(pr(r),e,t),e,t,n,i,s,2):a===2&&vf(r,e,t,n,i,s):An(pr(r),e,t,n,i,s,1);break}}}function mf(r){var e=r.prev,t=r,n=r.next;if(Ie(e,t,n)>=0)return!1;for(var i=e.x,s=t.x,a=n.x,o=e.y,l=t.y,u=n.y,c=i<s?i<a?i:a:s<a?s:a,p=o<l?o<u?o:u:l<u?l:u,h=i>s?i>a?i:a:s>a?s:a,d=o>l?o>u?o:u:l>u?l:u,f=n.next;f!==e;){if(f.x>=c&&f.x<=h&&f.y>=p&&f.y<=d&&Ur(i,o,s,l,a,u,f.x,f.y)&&Ie(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function gf(r,e,t,n){var i=r.prev,s=r,a=r.next;if(Ie(i,s,a)>=0)return!1;for(var o=i.x,l=s.x,u=a.x,c=i.y,p=s.y,h=a.y,d=o<l?o<u?o:u:l<u?l:u,f=c<p?c<h?c:h:p<h?p:h,y=o>l?o>u?o:u:l>u?l:u,m=c>p?c>h?c:h:p>h?p:h,g=co(d,f,e,t,n),b=co(y,m,e,t,n),x=r.prevZ,v=r.nextZ;x&&x.z>=g&&v&&v.z<=b;){if(x.x>=d&&x.x<=y&&x.y>=f&&x.y<=m&&x!==i&&x!==a&&Ur(o,c,l,p,u,h,x.x,x.y)&&Ie(x.prev,x,x.next)>=0||(x=x.prevZ,v.x>=d&&v.x<=y&&v.y>=f&&v.y<=m&&v!==i&&v!==a&&Ur(o,c,l,p,u,h,v.x,v.y)&&Ie(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;x&&x.z>=g;){if(x.x>=d&&x.x<=y&&x.y>=f&&x.y<=m&&x!==i&&x!==a&&Ur(o,c,l,p,u,h,x.x,x.y)&&Ie(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;v&&v.z<=b;){if(v.x>=d&&v.x<=y&&v.y>=f&&v.y<=m&&v!==i&&v!==a&&Ur(o,c,l,p,u,h,v.x,v.y)&&Ie(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function xf(r,e,t){var n=r;do{var i=n.prev,s=n.next.next;!Gi(i,s)&&Fc(i,n,n.next,s)&&kn(i,s)&&kn(s,i)&&(e.push(i.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),In(n),In(n.next),n=r=s),n=n.next}while(n!==r);return pr(n)}function vf(r,e,t,n,i,s){var a=r;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&Af(a,o)){var l=Uc(a,o);return a=pr(a,a.next),l=pr(l,l.next),An(a,e,t,n,i,s,0),void An(l,e,t,n,i,s,0)}o=o.next}a=a.next}while(a!==r)}function bf(r,e){return r.x-e.x}function _f(r,e){var t=function(i,s){var a,o=s,l=i.x,u=i.y,c=-1/0;do{if(u<=o.y&&u>=o.next.y&&o.next.y!==o.y){var p=o.x+(u-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(p<=l&&p>c&&(c=p,a=o.x<o.next.x?o:o.next,p===l))return a}o=o.next}while(o!==s);if(!a)return null;var h,d=a,f=a.x,y=a.y,m=1/0;o=a;do l>=o.x&&o.x>=f&&l!==o.x&&Ur(u<y?l:c,u,f,y,u<y?c:l,u,o.x,o.y)&&(h=Math.abs(u-o.y)/(l-o.x),kn(o,i)&&(h<m||h===m&&(o.x>a.x||o.x===a.x&&wf(a,o)))&&(a=o,m=h)),o=o.next;while(o!==d);return a}(r,e);if(!t)return e;var n=Uc(t,r);return pr(n,n.next),pr(t,t.next)}function wf(r,e){return Ie(r.prev,r,e.prev)<0&&Ie(e.next,r,r.next)<0}function co(r,e,t,n,i){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-t)*i|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Sf(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function Ur(r,e,t,n,i,s,a,o){return(i-a)*(e-o)>=(r-a)*(s-o)&&(r-a)*(n-o)>=(t-a)*(e-o)&&(t-a)*(s-o)>=(i-a)*(n-o)}function Af(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(t,n){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==n.i&&i.next.i!==n.i&&Fc(i,i.next,t,n))return!0;i=i.next}while(i!==t);return!1}(r,e)&&(kn(r,e)&&kn(e,r)&&function(t,n){var i=t,s=!1,a=(t.x+n.x)/2,o=(t.y+n.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&a<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next;while(i!==t);return s}(r,e)&&(Ie(r.prev,r,e.prev)||Ie(r,e.prev,e))||Gi(r,e)&&Ie(r.prev,r,r.next)>0&&Ie(e.prev,e,e.next)>0)}function Ie(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Gi(r,e){return r.x===e.x&&r.y===e.y}function Fc(r,e,t,n){var i=Xi(Ie(r,e,t)),s=Xi(Ie(r,e,n)),a=Xi(Ie(t,n,r)),o=Xi(Ie(t,n,e));return i!==s&&a!==o||!(i!==0||!Zi(r,t,e))||!(s!==0||!Zi(r,n,e))||!(a!==0||!Zi(t,r,n))||!(o!==0||!Zi(t,e,n))}function Zi(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Xi(r){return r>0?1:r<0?-1:0}function kn(r,e){return Ie(r.prev,r,r.next)<0?Ie(r,e,r.next)>=0&&Ie(r,r.prev,e)>=0:Ie(r,e,r.prev)<0||Ie(r,r.next,e)<0}function Uc(r,e){var t=new ho(r.i,r.x,r.y),n=new ho(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function Oc(r,e,t,n){var i=new ho(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function In(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function ho(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function po(r,e,t,n){for(var i=0,s=e,a=t-n;s<t;s+=n)i+=(r[a]-r[s])*(r[s+1]+r[a+1]),a=s;return i}function kf(r,e,t,n,i){jc(r,e,t||0,n||r.length-1,i||If)}function jc(r,e,t,n,i){for(;n>t;){if(n-t>600){var s=n-t+1,a=e-t+1,o=Math.log(s),l=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*l*(s-l)/s)*(a-s/2<0?-1:1);jc(r,e,Math.max(t,Math.floor(e-a*l/s+u)),Math.min(n,Math.floor(e+(s-a)*l/s+u)),i)}var c=r[e],p=t,h=n;for(Mn(r,t,e),i(r[n],c)>0&&Mn(r,t,n);p<h;){for(Mn(r,p,h),p++,h--;i(r[p],c)<0;)p++;for(;i(r[h],c)>0;)h--}i(r[t],c)===0?Mn(r,t,h):Mn(r,++h,n),h<=e&&(t=h+1),e<=h&&(n=h-1)}}function Mn(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}function If(r,e){return r<e?-1:r>e?1:0}function fo(r,e){const t=r.length;if(t<=1)return[r];const n=[];let i,s;for(let a=0;a<t;a++){const o=Vp(r[a]);o!==0&&(r[a].area=Math.abs(o),s===void 0&&(s=o<0),s===o<0?(i&&n.push(i),i=[r[a]]):i.push(r[a]))}if(i&&n.push(i),e>1)for(let a=0;a<n.length;a++)n[a].length<=e||(kf(n[a],e,1,n[a].length-1,Mf),n[a]=n[a].slice(0,e));return n}function Mf(r,e){return e.area-r.area}function yo(r,e,t){const n=t.patternDependencies;let i=!1;for(const s of e){const a=s.paint.get(`${r}-pattern`);a.isConstant()||(i=!0);const o=a.constantOr(null);o&&(i=!0,n[o]=!0)}return i}function mo(r,e,t,n,i){const s=i.patternDependencies;for(const a of e){const o=a.paint.get(`${r}-pattern`).value;if(o.kind!=="constant"){let l=o.evaluate({zoom:n},t,{},i.availableImages);l=l&&l.name?l.name:l,s[l]=!0,t.patterns[a.id]=l}}return t}({get exports(){return Fr},set exports(r){Fr=r}}).exports=qi,Fr.default=qi,qi.deviation=function(r,e,t,n){var i=e&&e.length,s=Math.abs(po(r,0,i?e[0]*t:r.length,t));if(i)for(var a=0,o=e.length;a<o;a++)s-=Math.abs(po(r,e[a]*t,a<o-1?e[a+1]*t:r.length,t));var l=0;for(a=0;a<n.length;a+=3){var u=n[a]*t,c=n[a+1]*t,p=n[a+2]*t;l+=Math.abs((r[u]-r[p])*(r[c+1]-r[u+1])-(r[u]-r[c])*(r[p+1]-r[u+1]))}return s===0&&l===0?0:Math.abs((l-s)/s)},qi.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},n=0,i=0;i<r.length;i++){for(var s=0;s<r[i].length;s++)for(var a=0;a<e;a++)t.vertices.push(r[i][s][a]);i>0&&t.holes.push(n+=r[i-1].length)}return t};class Wi{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new jt,this.indexArray=new xt,this.indexArray2=new zr,this.programConfigurations=new sr(e.layers,e.zoom),this.segments=new Ue,this.segments2=new Ue,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,n,i){this.hasPattern=yo("fill",this.layers,t);const s=this.layers[0].layout.get("fill-sort-key"),a=[];for(const{feature:o,id:l,index:u,sourceLayerIndex:c}of e){const p=this.layers[0]._featureFilter.needGeometry,h=cr(o,p);if(!this.layers[0]._featureFilter.filter(new we(this.zoom),h,n))continue;const d=s?s.evaluate(h,{},n,t.availableImages):void 0,f={id:l,properties:o.properties,type:o.type,sourceLayerIndex:c,index:u,geometry:p?h.geometry:Ct(o,n,i),patterns:{},sortKey:d};a.push(f)}s&&a.sort((o,l)=>o.sortKey-l.sortKey);for(const o of a){const{geometry:l,index:u,sourceLayerIndex:c}=o;if(this.hasPattern){const p=mo("fill",this.layers,o,this.zoom,t);this.patternFeatures.push(p)}else this.addFeature(o,l,u,n,{},t.availableImages);t.featureIndex.insert(e[u].feature,l,u,c,this.index)}}update(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}addFeatures(e,t,n,i,s){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,n,i)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,i,s,a=[]){for(const o of fo(t,500)){let l=0;for(const f of o)l+=f.length;const u=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray),c=u.vertexLength,p=[],h=[];for(const f of o){if(f.length===0)continue;f!==o[0]&&h.push(p.length/2);const y=this.segments2.prepareSegment(f.length,this.layoutVertexArray,this.indexArray2),m=y.vertexLength;this.layoutVertexArray.emplaceBack(f[0].x,f[0].y),this.indexArray2.emplaceBack(m+f.length-1,m),p.push(f[0].x),p.push(f[0].y);for(let g=1;g<f.length;g++)this.layoutVertexArray.emplaceBack(f[g].x,f[g].y),this.indexArray2.emplaceBack(m+g-1,m+g),p.push(f[g].x),p.push(f[g].y);y.vertexLength+=f.length,y.primitiveLength+=f.length}const d=Fr(p,h);for(let f=0;f<d.length;f+=3)this.indexArray.emplaceBack(c+d[f],c+d[f+1],c+d[f+2]);u.vertexLength+=l,u.primitiveLength+=d.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,s,a,i)}}N(Wi,"FillBucket",{omit:["layers","patternFeatures"]});const Tf=new Xe({"fill-sort-key":new Z(T.layout_fill["fill-sort-key"])});var Cf={paint:new Xe({"fill-antialias":new $(T.paint_fill["fill-antialias"]),"fill-opacity":new Z(T.paint_fill["fill-opacity"]),"fill-color":new Z(T.paint_fill["fill-color"]),"fill-outline-color":new Z(T.paint_fill["fill-outline-color"]),"fill-translate":new $(T.paint_fill["fill-translate"]),"fill-translate-anchor":new $(T.paint_fill["fill-translate-anchor"]),"fill-pattern":new Z(T.paint_fill["fill-pattern"])}),layout:Tf};const Ef=ve([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Pf=ve([{name:"a_centroid_pos",components:2,type:"Uint16"}]),zf=ve([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Df}=Ef;var Yi={},Bf=O,Nc=Or;function Or(r,e,t,n,i){this.properties={},this.extent=t,this.type=0,this._pbf=r,this._geometry=-1,this._keys=n,this._values=i,r.readFields(Rf,this,e)}function Rf(r,e,t){r==1?e.id=t.readVarint():r==2?function(n,i){for(var s=n.readVarint()+n.pos;n.pos<s;){var a=i._keys[n.readVarint()],o=i._values[n.readVarint()];i.properties[a]=o}}(t,e):r==3?e.type=t.readVarint():r==4&&(e._geometry=t.pos)}function Vf(r){for(var e,t,n=0,i=0,s=r.length,a=s-1;i<s;a=i++)n+=((t=r[a]).x-(e=r[i]).x)*(e.y+t.y);return n}Or.types=["Unknown","Point","LineString","Polygon"],Or.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,t=r.readVarint()+r.pos,n=1,i=0,s=0,a=0,o=[];r.pos<t;){if(i<=0){var l=r.readVarint();n=7&l,i=l>>3}if(i--,n===1||n===2)s+=r.readSVarint(),a+=r.readSVarint(),n===1&&(e&&o.push(e),e=[]),e.push(new Bf(s,a));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&o.push(e),o},Or.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,t=1,n=0,i=0,s=0,a=1/0,o=-1/0,l=1/0,u=-1/0;r.pos<e;){if(n<=0){var c=r.readVarint();t=7&c,n=c>>3}if(n--,t===1||t===2)(i+=r.readSVarint())<a&&(a=i),i>o&&(o=i),(s+=r.readSVarint())<l&&(l=s),s>u&&(u=s);else if(t!==7)throw new Error("unknown command "+t)}return[a,l,o,u]},Or.prototype.toGeoJSON=function(r,e,t){var n,i,s=this.extent*Math.pow(2,t),a=this.extent*r,o=this.extent*e,l=this.loadGeometry(),u=Or.types[this.type];function c(d){for(var f=0;f<d.length;f++){var y=d[f];d[f]=[360*(y.x+a)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(y.y+o)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(n=0;n<l.length;n++)p[n]=l[n][0];c(l=p);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=function(d){var f=d.length;if(f<=1)return[d];for(var y,m,g=[],b=0;b<f;b++){var x=Vf(d[b]);x!==0&&(m===void 0&&(m=x<0),m===x<0?(y&&g.push(y),y=[d[b]]):y.push(d[b]))}return y&&g.push(y),g}(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)c(l[n][i])}l.length===1?l=l[0]:u="Multi"+u;var h={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(h.id=this.id),h};var Lf=Nc,$c=qc;function qc(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Ff,this,e),this.length=this._features.length}function Ff(r,e,t){r===15?e.version=t.readVarint():r===1?e.name=t.readString():r===5?e.extent=t.readVarint():r===2?e._features.push(t.pos):r===3?e._keys.push(t.readString()):r===4&&e._values.push(function(n){for(var i=null,s=n.readVarint()+n.pos;n.pos<s;){var a=n.readVarint()>>3;i=a===1?n.readString():a===2?n.readFloat():a===3?n.readDouble():a===4?n.readVarint64():a===5?n.readVarint():a===6?n.readSVarint():a===7?n.readBoolean():null}return i}(t))}qc.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new Lf(this._pbf,e,this.extent,this._keys,this._values)};var Uf=$c;function Of(r,e,t){if(r===3){var n=new Uf(t,t.readVarint()+t.pos);n.length&&(e[n.name]=n)}}var go=Yi.VectorTile=function(r,e){this.layers=r.readFields(Of,{},e)},Hi=Yi.VectorTileFeature=Nc;function Ki(r,e,t,n){const i=[],s=n===0?(a,o,l,u,c,p)=>{a.push(new O(p,l+(p-o)/(u-o)*(c-l)))}:(a,o,l,u,c,p)=>{a.push(new O(o+(p-l)/(c-l)*(u-o),p))};for(const a of r){const o=[];for(const l of a){if(l.length<=2)continue;const u=[];for(let h=0;h<l.length-1;h++){const d=l[h].x,f=l[h].y,y=l[h+1].x,m=l[h+1].y,g=n===0?d:f,b=n===0?y:m;g<e?b>e&&s(u,d,f,y,m,e):g>t?b<t&&s(u,d,f,y,m,t):u.push(l[h]),b<e&&g>=e&&s(u,d,f,y,m,e),b>t&&g<=t&&s(u,d,f,y,m,t)}let c=l[l.length-1];const p=n===0?c.x:c.y;p>=e&&p<=t&&u.push(c),u.length&&(c=u[u.length-1],u[0].x===c.x&&u[0].y===c.y||u.push(u[0]),o.push(u))}o.length&&i.push(o)}return i}Yi.VectorTileLayer=$c;const jf=Hi.types,Nf=Math.pow(2,13);function Tn(r,e,t,n,i,s,a,o){r.emplaceBack((e<<1)+a,(t<<1)+s,(Math.floor(n*Nf)<<1)+i,Math.round(o))}function Cn(r,e,t){r.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Gc{constructor(){this.acc=new O(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new O(e.x,e.y),this.max=new O(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const n=this.min,i=this.max;e.x<n.x?n.x=e.x:e.x>i.x&&(i.x=e.x),e.y<n.y?n.y=e.y:e.y>i.y&&(i.y=e.y),((e.x===0||e.x===Y)&&e.x===t.x)!=((e.y===0||e.y===Y)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,de(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Y!=e.x>Y&&this.addBorderIntersection(1,de(t.y,e.y,(Y-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,de(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Y!=e.y>Y&&this.addBorderIntersection(3,de(t.x,e.x,(Y-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((t,n)=>t+n.edges,0);return e!==0?this.acc.div(e)._round():new O(0,0)}span(){return new O(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class Ji{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new fn,this.centroidVertexArray=new oc,this.indexArray=new xt,this.programConfigurations=new sr(e.layers,e.zoom),this.segments=new Ue,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,n,i){this.features=[],this.hasPattern=yo("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(s){const a=Math.exp(Math.PI*(1-s.y/(1<<s.z)*2));return 80150034*a/(a*a+1)/Y/(1<<s.z)}(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:s,id:a,index:o,sourceLayerIndex:l}of e){const u=this.layers[0]._featureFilter.needGeometry,c=cr(s,u);if(!this.layers[0]._featureFilter.filter(new we(this.zoom),c,n))continue;const p={id:a,sourceLayerIndex:l,index:o,geometry:u?c.geometry:Ct(s,n,i),properties:s.properties,type:s.type,patterns:{}},h=this.layoutVertexArray.length;this.hasPattern?this.features.push(mo("fill-extrusion",this.layers,p,this.zoom,t)):this.addFeature(p,p.geometry,o,n,{},t.availableImages,i),t.featureIndex.insert(s,p.geometry,o,l,this.index,h)}this.sortBorders()}addFeatures(e,t,n,i,s){for(const a of this.features){const{geometry:o}=a;this.addFeature(a,o,a.index,t,n,i,s)}this.sortBorders()}update(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Df),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,zf.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Pf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i,s,a,o){const l=[new O(0,0),new O(Y,Y)],u=o.projection,c=u.name==="globe",p=this.enableTerrain&&!c?new Gc:null,h=jf[e.type]==="Polygon";c&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ci);const d=fo(t,500);for(let g=d.length-1;g>=0;g--){const b=d[g];(b.length===0||(f=b[0]).every(x=>x.x<=0)||f.every(x=>x.x>=Y)||f.every(x=>x.y<=0)||f.every(x=>x.y>=Y))&&d.splice(g,1)}var f;let y;if(c)y=Kc(d,l,i);else{y=[];for(const g of d)y.push({polygon:g,bounds:l})}const m=h?this.edgeRadius:0;for(const{polygon:g,bounds:b}of y){let x=0,v=0;for(const _ of g)h&&!_[0].equals(_[_.length-1])&&_.push(_[0]),v+=h?_.length-1:_.length;const w=this.segments.prepareSegment((h?5:4)*v,this.layoutVertexArray,this.indexArray);if(h){const _=[],A=[];x=w.vertexLength;for(const C of g){let z,k;C.length&&C!==g[0]&&A.push(_.length/2),z=C[1].sub(C[0])._perp()._unit();for(let M=1;M<C.length;M++){const E=C[M],P=C[M===C.length-1?1:M+1];let{x:B,y:I}=E;if(m){k=P.sub(E)._perp()._unit();const L=z.add(k)._unit(),X=m*Math.min(4,1/(z.x*L.x+z.y*L.y));B+=X*L.x,I+=X*L.y,z=k}Tn(this.layoutVertexArray,B,I,0,0,1,1,0),w.vertexLength++,_.push(E.x,E.y),c&&Cn(this.layoutVertexExtArray,u.projectTilePoint(B,I,i),u.upVector(i,B,I))}}const S=Fr(_,A);for(let C=0;C<S.length;C+=3)this.indexArray.emplaceBack(x+S[C],x+S[C+2],x+S[C+1]),w.primitiveLength++}for(const _ of g){p&&_.length&&p.startRing(_[0]);let A,S,C,z=_.length>4&&Yc(_[_.length-2],_[0],_[1]),k=m?$f(_[_.length-2],_[0],_[1],m):0;S=_[1].sub(_[0])._perp()._unit();let M=!0;for(let E=1,P=0;E<_.length;E++){let B=_[E-1],I=_[E];const L=_[E===_.length-1?1:E+1];if(p&&h&&p.currentPolyCount.top++,Wc(I,B,b)){m&&(S=L.sub(I)._perp()._unit(),M=!M);continue}p&&p.append(I,B);const X=I.sub(B)._perp(),q=X.x/(Math.abs(X.x)+Math.abs(X.y)),V=X.y>0?1:0,R=B.dist(I);if(P+R>32768&&(P=0),m){C=L.sub(I)._perp()._unit();let H=Xc(B,I,L,Zc(S,C),m);isNaN(H)&&(H=0);const ie=I.sub(B)._unit();B=B.add(ie.mult(k))._round(),I=I.add(ie.mult(-H))._round(),k=H,S=C}const G=w.vertexLength,J=_.length>4&&Yc(B,I,L);let K=Hc(P,z,M);if(Tn(this.layoutVertexArray,B.x,B.y,q,V,0,0,K),Tn(this.layoutVertexArray,B.x,B.y,q,V,0,1,K),P+=R,K=Hc(P,J,!M),z=J,Tn(this.layoutVertexArray,I.x,I.y,q,V,0,0,K),Tn(this.layoutVertexArray,I.x,I.y,q,V,0,1,K),w.vertexLength+=4,this.indexArray.emplaceBack(G+0,G+1,G+2),this.indexArray.emplaceBack(G+1,G+3,G+2),w.primitiveLength+=2,m){const H=x+(E===1?_.length-2:E-2),ie=E===1?x:H+1;if(this.indexArray.emplaceBack(G+1,H,G+3),this.indexArray.emplaceBack(H,ie,G+3),w.primitiveLength+=2,A===void 0&&(A=G),!Wc(L,_[E],b)){const D=E===_.length-1?A:w.vertexLength;this.indexArray.emplaceBack(G+2,G+3,D),this.indexArray.emplaceBack(G+3,D+1,D),this.indexArray.emplaceBack(G+3,ie,D+1),w.primitiveLength+=3}M=!M}if(c){const H=this.layoutVertexExtArray,ie=u.projectTilePoint(B.x,B.y,i),D=u.projectTilePoint(I.x,I.y,i),j=u.upVector(i,B.x,B.y),Q=u.upVector(i,I.x,I.y);Cn(H,ie,j),Cn(H,ie,j),Cn(H,D,Q),Cn(H,D,Q)}}h&&(x+=_.length-1)}}if(p&&p.polyCount.length>0){if(p.borders){p.vertexArrayOffset=this.centroidVertexArray.length;const g=p.borders,b=this.featuresOnBorder.push(p)-1;for(let x=0;x<4;x++)g[x][0]!==Number.MAX_VALUE&&this.borders[x].push(b)}this.encodeCentroid(p.borders?void 0:p.centroid(),p)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,s,a,i)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,t,n=!0){let i,s;if(e)if(e.y!==0){const o=t.span()._mult(this.tileToMeter);i=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(o.x/10)),s=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(o.y/10))}else i=Math.ceil(7*(e.x+450)),s=0;else i=0,s=+n;let a=n?this.centroidVertexArray.length:t.vertexArrayOffset;for(const o of t.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*o.edges+o.top);for(let l=0;l<o.top;l++)this.centroidVertexArray.emplace(a++,i,s);for(let l=0;l<2*o.edges;l++)this.centroidVertexArray.emplace(a++,0,s),this.centroidVertexArray.emplace(a++,i,s)}}}function Zc(r,e){const t=r.add(e)._unit();return r.x*t.x+r.y*t.y}function $f(r,e,t,n){const i=e.sub(r)._perp()._unit(),s=t.sub(e)._perp()._unit();return Xc(r,e,t,Zc(i,s),n)}function Xc(r,e,t,n,i){const s=Math.sqrt(1-n*n);return Math.min(r.dist(e)/3,e.dist(t)/3,i*s/n)}function Wc(r,e,t){return r.x<t[0].x&&e.x<t[0].x||r.x>t[1].x&&e.x>t[1].x||r.y<t[0].y&&e.y<t[0].y||r.y>t[1].y&&e.y>t[1].y}function Yc(r,e,t){if(r.x<0||r.x>=Y||e.x<0||e.x>=Y||t.x<0||t.x>=Y)return!1;const n=t.sub(e),i=n.perp(),s=r.sub(e);return(n.x*s.x+n.y*s.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(s.x*s.x+s.y*s.y))>-.866&&i.x*s.x+i.y*s.y<0}function Hc(r,e,t){const n=e?2|r:-3&r;return t?1|n:-2&n}function Kc(r,e,t){const n=1<<t.z,i=nt(t.x/n),s=nt((t.x+1)/n),a=je(t.y/n),o=je((t.y+1)/n);return function(l,u,c,p,h=0,d){const f=[];if(!l.length||!c||!p)return f;const y=(_,A)=>{for(const S of _)f.push({polygon:S,bounds:A})},m=Math.ceil(Math.log2(c)),g=Math.ceil(Math.log2(p)),b=m-g,x=[];for(let _=0;_<Math.abs(b);_++)x.push(b>0?0:1);for(let _=0;_<Math.min(m,g);_++)x.push(0),x.push(1);let v=l;if(v=Ki(v,u[0].y-h,u[1].y+h,1),v=Ki(v,u[0].x-h,u[1].x+h,0),!v.length)return f;const w=[];for(x.length?w.push({polygons:v,bounds:u,depth:0}):y(v,u);w.length;){const _=w.pop(),A=_.depth,S=x[A],C=_.bounds[0],z=_.bounds[1],k=S===0?C.x:C.y,M=S===0?z.x:z.y,E=d?d(S,k,M):.5*(k+M),P=Ki(_.polygons,k-h,E+h,S),B=Ki(_.polygons,E-h,M+h,S);if(P.length){const I=[C,new O(S===0?E:z.x,S===1?E:z.y)];x.length>A+1?w.push({polygons:P,bounds:I,depth:A+1}):y(P,I)}if(B.length){const I=[new O(S===0?E:C.x,S===1?E:C.y),z];x.length>A+1?w.push({polygons:B,bounds:I,depth:A+1}):y(B,I)}}return f}(r,e,Math.ceil((s-i)/11.25),Math.ceil((a-o)/11.25),1,(l,u,c)=>{if(l===0)return .5*(u+c);{const p=je((t.y+u/Y)/n);return(lr(.5*(je((t.y+c/Y)/n)+p))*n-t.y)*Y}})}N(Ji,"FillExtrusionBucket",{omit:["layers","features"]}),N(Gc,"PartMetadata");const qf=new Xe({"fill-extrusion-edge-radius":new $(T["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Gf={paint:new Xe({"fill-extrusion-opacity":new $(T["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Z(T["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $(T["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $(T["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Z(T["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Z(T["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Z(T["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $(T["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new $(T["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new $(T["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:qf};function Jc(r,e,t){var n=2*Math.PI*6378137/256/Math.pow(2,t);return[r*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Qc{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=En(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=function(s,a,o){var l=Jc(256*s,256*(a=Math.pow(2,o)-a-1),o),u=Jc(256*(s+1),256*(a+1),o);return l[0]+","+l[1]+","+u[0]+","+u[1]}(this.x,this.y,this.z),i=function(s,a,o){let l,u="";for(let c=s;c>0;c--)l=1<<c-1,u+=(a&l?1:0)+(o&l?2:0);return u}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Zf{constructor(e,t){this.wrap=e,this.canonical=t,this.key=En(e,t.z,t.z,t.x,t.y)}}class Qe{constructor(e,t,n,i,s){this.overscaledZ=e,this.wrap=t,this.canonical=new Qc(n,+i,+s),this.key=t===0&&e===n?this.canonical.key:En(t,e,n,i,s)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Qe(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qe(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return En(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return En(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Qe(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Qe(t,this.wrap,t,n,i),new Qe(t,this.wrap,t,n+1,i),new Qe(t,this.wrap,t,n,i+1),new Qe(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Qe(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Qe(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Zf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function En(r,e,t,n,i){const s=1<<Math.min(t,22);let a=s*(i%s)+n%s;return r&&t<22&&(a+=s*s*((r<0?-2*r-1:2*r)%(1<<2*(22-t)))),16*(32*a+t)+(e-t)}N(Qc,"CanonicalTileID"),N(Qe,"OverscaledTileID",{omit:["projMatrix"]});class jr extends O{constructor(e,t,n){super(e,t),this.z=n}}function Pn(r,e){return r.x*e.x+r.y*e.y}function eh(r,e){if(r.length===1){let t=0;const n=e[t++];let i;for(;!i||n.equals(i);)if(i=e[t++],!i)return 1/0;for(;t<e.length;t++){const s=e[t],a=r[0],o=i.sub(n),l=s.sub(n),u=a.sub(n),c=Pn(o,o),p=Pn(o,l),h=Pn(l,l),d=Pn(u,o),f=Pn(u,l),y=c*h-p*p,m=(h*d-p*f)/y,g=(c*f-p*d)/y,b=n.z*(1-m-g)+i.z*m+s.z*g;if(isFinite(b))return b}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}function th(r,e,t,n,i,s,a,o){const l=a*i.getElevationAt(r,e,!0,!0),u=s[0]!==0,c=u?s[1]===0?a*(s[0]/7-450):a*function(p,h,d){const f=Math.floor(h[0]/8),y=Math.floor(h[1]/8),m=10*(h[0]-8*f),g=10*(h[1]-8*y),b=p.getElevationAt(f,y,!0,!0),x=p.getMeterToDEM(d),v=Math.floor(.5*(m*x-1)),w=Math.floor(.5*(g*x-1)),_=p.tileCoordToPixel(f,y),A=2*v+1,S=2*w+1,C=function(B,I,L,X,q){return[B.getElevationAtPixel(I,L,!0),B.getElevationAtPixel(I+q,L,!0),B.getElevationAtPixel(I,L+q,!0),B.getElevationAtPixel(I+X,L+q,!0)]}(p,_.x-v,_.y-w,A,S),z=Math.abs(C[0]-C[1]),k=Math.abs(C[2]-C[3]),M=Math.abs(C[0]-C[2])+Math.abs(C[1]-C[3]),E=Math.min(.25,.5*x*(z+k)/A),P=Math.min(.25,.5*x*M/S);return b+Math.max(E*m,P*g)}(i,s,o):l;return{base:l+(t===0)?-1:t,top:u?Math.max(c+n,l+t+2):l+n}}const Xf=ve([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Wf}=Xf,Yf=ve([{name:"a_packed",components:4,type:"Float32"}]),{members:Hf}=Yf,Kf=Hi.types,Jf=Math.cos(Math.PI/180*37.5);class Qi{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new Pa,this.layoutVertexArray2=new yn,this.indexArray=new xt,this.programConfigurations=new sr(e.layers,e.zoom),this.segments=new Ue,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,n,i){this.hasPattern=yo("line",this.layers,t);const s=this.layers[0].layout.get("line-sort-key"),a=[];for(const{feature:c,id:p,index:h,sourceLayerIndex:d}of e){const f=this.layers[0]._featureFilter.needGeometry,y=cr(c,f);if(!this.layers[0]._featureFilter.filter(new we(this.zoom),y,n))continue;const m=s?s.evaluate(y,{},n):void 0,g={id:p,properties:c.properties,type:c.type,sourceLayerIndex:d,index:h,geometry:f?y.geometry:Ct(c,n,i),patterns:{},sortKey:m};a.push(g)}s&&a.sort((c,p)=>c.sortKey-p.sortKey);const{lineAtlas:o,featureIndex:l}=t,u=this.addConstantDashes(o);for(const c of a){const{geometry:p,index:h,sourceLayerIndex:d}=c;if(u&&this.addFeatureDashes(c,o),this.hasPattern){const f=mo("line",this.layers,c,this.zoom,t);this.patternFeatures.push(f)}else this.addFeature(c,p,h,n,o.positions,t.availableImages);l.insert(e[h].feature,p,h,d,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,s=n.layout.get("line-cap").value;if(i.kind!=="constant"||s.kind!=="constant")t=!0;else{const a=s.value,o=i.value;if(!o)continue;e.addDash(o,a)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const i of this.layers){const s=i.paint.get("line-dasharray").value,a=i.layout.get("line-cap").value;if(s.kind==="constant"&&a.kind==="constant")continue;let o,l;if(s.kind==="constant"){if(o=s.value,!o)continue}else o=s.evaluate({zoom:n},e);l=a.kind==="constant"?a.value:a.evaluate({zoom:n},e),t.addDash(o,l),e.patterns[i.id]=t.getKey(o,l)}}update(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}addFeatures(e,t,n,i,s){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,n,i)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Hf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,s,a){const o=this.layers[0].layout,l=o.get("line-join").evaluate(e,{}),u=o.get("line-cap").evaluate(e,{}),c=o.get("line-miter-limit"),p=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const h of t)this.addLine(h,e,l,u,c,p);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,s,a,i)}addLine(e,t,n,i,s,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let g=0;g<e.length-1;g++)this.totalDistance+=e[g].dist(e[g+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o=Kf[t.type]==="Polygon";let l=e.length;for(;l>=2&&e[l-1].equals(e[l-2]);)l--;let u=0;for(;u<l-1&&e[u].equals(e[u+1]);)u++;if(l<(o?3:2))return;n==="bevel"&&(s=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,p=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);let h,d,f,y,m;this.e1=this.e2=-1,o&&(h=e[l-2],m=e[u].sub(h)._unit()._perp());for(let g=u;g<l;g++){if(f=g===l-1?o?e[u+1]:void 0:e[g+1],f&&e[g].equals(f))continue;m&&(y=m),h&&(d=h),h=e[g],m=f?f.sub(h)._unit()._perp():y,y=y||m;let b=y.add(m);b.x===0&&b.y===0||b._unit();const x=y.x*m.x+y.y*m.y,v=b.x*m.x+b.y*m.y,w=v!==0?1/v:1/0,_=2*Math.sqrt(2-2*v),A=v<Jf&&d&&f,S=y.x*m.y-y.y*m.x>0;if(A&&g>u){const k=h.dist(d);if(k>2*c){const M=h.sub(h.sub(d)._mult(c/k)._round());this.updateDistance(d,M),this.addCurrentVertex(M,y,0,0,p),d=M}}const C=d&&f;let z=C?n:o?"butt":i;if(C&&z==="round"&&(w<a?z="miter":w<=2&&(z="fakeround")),z==="miter"&&w>s&&(z="bevel"),z==="bevel"&&(w>2&&(z="flipbevel"),w<s&&(z="miter")),d&&this.updateDistance(d,h),z==="miter")b._mult(w),this.addCurrentVertex(h,b,0,0,p);else if(z==="flipbevel"){if(w>100)b=m.mult(-1);else{const k=w*y.add(m).mag()/y.sub(m).mag();b._perp()._mult(k*(S?-1:1))}this.addCurrentVertex(h,b,0,0,p),this.addCurrentVertex(h,b.mult(-1),0,0,p)}else if(z==="bevel"||z==="fakeround"){const k=-Math.sqrt(w*w-1),M=S?k:0,E=S?0:k;if(d&&this.addCurrentVertex(h,y,M,E,p),z==="fakeround"){const P=Math.round(180*_/Math.PI/20);for(let B=1;B<P;B++){let I=B/P;if(I!==.5){const X=I-.5;I+=I*X*(I-1)*((1.0904+x*(x*(3.55645-1.43519*x)-3.2452))*X*X+(.848013+x*(.215638*x-1.06021)))}const L=m.sub(y)._mult(I)._add(y)._unit()._mult(S?-1:1);this.addHalfVertex(h,L.x,L.y,!1,S,0,p)}}f&&this.addCurrentVertex(h,m,-M,-E,p)}else if(z==="butt")this.addCurrentVertex(h,b,0,0,p);else if(z==="square"){const k=d?1:-1;d||this.addCurrentVertex(h,b,k,k,p),this.addCurrentVertex(h,b,0,0,p),d&&this.addCurrentVertex(h,b,k,k,p)}else z==="round"&&(d&&(this.addCurrentVertex(h,y,0,0,p),this.addCurrentVertex(h,y,1,1,p,!0)),f&&(this.addCurrentVertex(h,m,-1,-1,p,!0),this.addCurrentVertex(h,m,0,0,p)));if(A&&g<l-1){const k=h.dist(f);if(k>2*c){const M=h.add(f.sub(h)._mult(c/k)._round());this.updateDistance(h,M),this.addCurrentVertex(M,m,0,0,p),h=M}}}}addCurrentVertex(e,t,n,i,s,a=!1){const o=t.y*i-t.x,l=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,a,!1,n,s),this.addHalfVertex(e,o,l,a,!0,-i,s)}addHalfVertex({x:e,y:t},n,i,s,a,o,l){this.layoutVertexArray.emplaceBack((e<<1)+(s?1:0),(t<<1)+(a?1:0),Math.round(63*n)+128,Math.round(63*i)+128,1+(o===0?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const u=l.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),l.primitiveLength++),a?this.e2=u:this.e1=u}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}N(Qi,"LineBucket",{omit:["layers","patternFeatures"]});const Qf=new Xe({"line-cap":new Z(T.layout_line["line-cap"]),"line-join":new Z(T.layout_line["line-join"]),"line-miter-limit":new $(T.layout_line["line-miter-limit"]),"line-round-limit":new $(T.layout_line["line-round-limit"]),"line-sort-key":new Z(T.layout_line["line-sort-key"])});var rh={paint:new Xe({"line-opacity":new Z(T.paint_line["line-opacity"]),"line-color":new Z(T.paint_line["line-color"]),"line-translate":new $(T.paint_line["line-translate"]),"line-translate-anchor":new $(T.paint_line["line-translate-anchor"]),"line-width":new Z(T.paint_line["line-width"]),"line-gap-width":new Z(T.paint_line["line-gap-width"]),"line-offset":new Z(T.paint_line["line-offset"]),"line-blur":new Z(T.paint_line["line-blur"]),"line-dasharray":new Z(T.paint_line["line-dasharray"]),"line-pattern":new Z(T.paint_line["line-pattern"]),"line-gradient":new ki(T.paint_line["line-gradient"]),"line-trim-offset":new $(T.paint_line["line-trim-offset"])}),layout:Qf};const nh=new class extends Z{possiblyEvaluate(e,t){return t=new we(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=Ve({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}(rh.paint.properties["line-width"].specification);function ih(r,e){return e>0?e+2*r:r}nh.useIntegerZoom=!0;const ey=ve([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ty=ve([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ry=ve([{name:"a_projected_pos",components:4,type:"Float32"}],4);ve([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ny=ve([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),iy=ve([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ve([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const sh=ve([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);ve([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4),ve([{name:"triangle",components:3,type:"Uint16"}]),ve([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ve([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ve([{type:"Float32",name:"offsetX"}]),ve([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ne=24;const Et=128;function ah(r,e){const{expression:t}=e;if(t.kind==="constant")return{kind:"constant",layoutSize:t.evaluate(new we(r+1))};if(t.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:i}=t;let s=0;for(;s<n.length&&n[s]<=r;)s++;s=Math.max(0,s-1);let a=s;for(;a<n.length&&n[a]<r+1;)a++;a=Math.min(n.length-1,a);const o=n[s],l=n[a];return t.kind==="composite"?{kind:"composite",minZoom:o,maxZoom:l,interpolationType:i}:{kind:"camera",minZoom:o,maxZoom:l,minSize:t.evaluate(new we(o)),maxSize:t.evaluate(new we(l)),interpolationType:i}}}function oh(r,{uSize:e,uSizeT:t},{lowerSize:n,upperSize:i}){return r.kind==="source"?n/Et:r.kind==="composite"?de(n/Et,i/Et,t):e}function es(r,e){let t=0,n=0;if(r.kind==="constant")n=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:i,minZoom:s,maxZoom:a}=r,o=i?ue(gt.interpolationFactor(i,e,s,a),0,1):0;r.kind==="camera"?n=de(r.minSize,r.maxSize,o):t=o}return{uSizeT:t,uSize:n}}function sy(r,e,t){return r.sections.forEach(n=>{n.text=function(i,s,a){const o=s.layout.get("text-transform").evaluate(a,{});return o==="uppercase"?i=i.toLocaleUpperCase():o==="lowercase"&&(i=i.toLocaleLowerCase()),Be.applyArabicShaping&&(i=Be.applyArabicShaping(i)),i}(n.text,e,t)}),r}const zn={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function ay(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function oy(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}var ts=fe,lh=function(r,e,t,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,c=-7,p=t?i-1:0,h=t?-1:1,d=r[e+p];for(p+=h,s=d&(1<<-c)-1,d>>=-c,c+=o;c>0;s=256*s+r[e+p],p+=h,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=n;c>0;a=256*a+r[e+p],p+=h,c-=8);if(s===0)s=1-u;else{if(s===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),s-=u}return(d?-1:1)*a*Math.pow(2,s-n)},uh=function(r,e,t,n,i,s){var a,o,l,u=8*s-i-1,c=(1<<u)-1,p=c>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,f=n?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+p>=1?h/l:h*Math.pow(2,1-p))*l>=2&&(a++,l/=2),a+p>=c?(o=0,a=c):a+p>=1?(o=(e*l-1)*Math.pow(2,i),a+=p):(o=e*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;r[t+d]=255&o,d+=f,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;r[t+d]=255&a,d+=f,a/=256,u-=8);r[t+d-f]|=128*y};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function fe(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}fe.Varint=0,fe.Fixed64=1,fe.Bytes=2,fe.Fixed32=5;var xo=4294967296,ch=1/xo,hh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Pt(r){return r.type===fe.Bytes?r.readVarint()+r.pos:r.pos+1}function Nr(r,e,t){return t?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function ph(r,e,t){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(n);for(var i=t.pos-1;i>=r;i--)t.buf[i+n]=t.buf[i]}function ly(r,e){for(var t=0;t<r.length;t++)e.writeVarint(r[t])}function uy(r,e){for(var t=0;t<r.length;t++)e.writeSVarint(r[t])}function cy(r,e){for(var t=0;t<r.length;t++)e.writeFloat(r[t])}function hy(r,e){for(var t=0;t<r.length;t++)e.writeDouble(r[t])}function py(r,e){for(var t=0;t<r.length;t++)e.writeBoolean(r[t])}function dy(r,e){for(var t=0;t<r.length;t++)e.writeFixed32(r[t])}function fy(r,e){for(var t=0;t<r.length;t++)e.writeSFixed32(r[t])}function yy(r,e){for(var t=0;t<r.length;t++)e.writeFixed64(r[t])}function my(r,e){for(var t=0;t<r.length;t++)e.writeSFixed64(r[t])}function rs(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function $r(r,e,t){r[t]=e,r[t+1]=e>>>8,r[t+2]=e>>>16,r[t+3]=e>>>24}function dh(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function fh(r){let e=0,t=0;for(const a of r)e+=a.w*a.h,t=Math.max(t,a.w);r.sort((a,o)=>o.h-a.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let i=0,s=0;for(const a of r)for(let o=n.length-1;o>=0;o--){const l=n[o];if(!(a.w>l.w||a.h>l.h)){if(a.x=l.x,a.y=l.y,s=Math.max(s,a.y+a.h),i=Math.max(i,a.x+a.w),a.w===l.w&&a.h===l.h){const u=n.pop();o<n.length&&(n[o]=u)}else a.h===l.h?(l.x+=a.w,l.w-=a.w):a.w===l.w?(l.y+=a.h,l.h-=a.h):(n.push({x:l.x+a.w,y:l.y,w:l.w-a.w,h:a.h}),l.y+=a.h,l.h-=a.h);break}}return{w:i,h:s,fill:e/(i*s)||0}}fe.prototype={destroy:function(){this.buf=null},readFields:function(r,e,t){for(t=t||this.length;this.pos<t;){var n=this.readVarint(),i=n>>3,s=this.pos;this.type=7&n,r(i,e,this),this.pos===s&&this.skip(n)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=rs(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=dh(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=rs(this.buf,this.pos)+rs(this.buf,this.pos+4)*xo;return this.pos+=8,r},readSFixed64:function(){var r=rs(this.buf,this.pos)+dh(this.buf,this.pos+4)*xo;return this.pos+=8,r},readFloat:function(){var r=lh(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=lh(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,t,n=this.buf;return e=127&(t=n[this.pos++]),t<128?e:(e|=(127&(t=n[this.pos++]))<<7,t<128?e:(e|=(127&(t=n[this.pos++]))<<14,t<128?e:(e|=(127&(t=n[this.pos++]))<<21,t<128?e:function(i,s,a){var o,l,u=a.buf;if(o=(112&(l=u[a.pos++]))>>4,l<128||(o|=(127&(l=u[a.pos++]))<<3,l<128)||(o|=(127&(l=u[a.pos++]))<<10,l<128)||(o|=(127&(l=u[a.pos++]))<<17,l<128)||(o|=(127&(l=u[a.pos++]))<<24,l<128)||(o|=(1&(l=u[a.pos++]))<<31,l<128))return Nr(i,o,s);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=n[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&hh?function(t,n,i){return hh.decode(t.subarray(n,i))}(this.buf,e,r):function(t,n,i){for(var s="",a=n;a<i;){var o,l,u,c=t[a],p=null,h=c>239?4:c>223?3:c>191?2:1;if(a+h>i)break;h===1?c<128&&(p=c):h===2?(192&(o=t[a+1]))==128&&(p=(31&c)<<6|63&o)<=127&&(p=null):h===3?(l=t[a+2],(192&(o=t[a+1]))==128&&(192&l)==128&&((p=(15&c)<<12|(63&o)<<6|63&l)<=2047||p>=55296&&p<=57343)&&(p=null)):h===4&&(l=t[a+2],u=t[a+3],(192&(o=t[a+1]))==128&&(192&l)==128&&(192&u)==128&&((p=(15&c)<<18|(63&o)<<12|(63&l)<<6|63&u)<=65535||p>=1114112)&&(p=null)),p===null?(p=65533,h=1):p>65535&&(p-=65536,s+=String.fromCharCode(p>>>10&1023|55296),p=56320|1023&p),s+=String.fromCharCode(p),a+=h}return s}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==fe.Bytes)return r.push(this.readVarint(e));var t=Pt(this);for(r=r||[];this.pos<t;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==fe.Bytes)return r.push(this.readSVarint());var e=Pt(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==fe.Bytes)return r.push(this.readBoolean());var e=Pt(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==fe.Bytes)return r.push(this.readFloat());var e=Pt(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==fe.Bytes)return r.push(this.readDouble());var e=Pt(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==fe.Bytes)return r.push(this.readFixed32());var e=Pt(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==fe.Bytes)return r.push(this.readSFixed32());var e=Pt(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==fe.Bytes)return r.push(this.readFixed64());var e=Pt(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==fe.Bytes)return r.push(this.readSFixed64());var e=Pt(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===fe.Varint)for(;this.buf[this.pos++]>127;);else if(e===fe.Bytes)this.pos=this.readVarint()+this.pos;else if(e===fe.Fixed32)this.pos+=4;else{if(e!==fe.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),$r(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),$r(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),$r(this.buf,-1&r,this.pos),$r(this.buf,Math.floor(r*ch),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),$r(this.buf,-1&r,this.pos),$r(this.buf,Math.floor(r*ch),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,t){var n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(s,a,o){o.buf[o.pos++]=127&s|128,s>>>=7,o.buf[o.pos++]=127&s|128,s>>>=7,o.buf[o.pos++]=127&s|128,s>>>=7,o.buf[o.pos++]=127&s|128,o.buf[o.pos]=127&(s>>>=7)}(n,0,t),function(s,a){var o=(7&s)<<4;a.buf[a.pos++]|=o|((s>>>=3)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s)))))}(i,t)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(n,i,s){for(var a,o,l=0;l<i.length;l++){if((a=i.charCodeAt(l))>55295&&a<57344){if(!o){a>56319||l+1===i.length?(n[s++]=239,n[s++]=191,n[s++]=189):o=a;continue}if(a<56320){n[s++]=239,n[s++]=191,n[s++]=189,o=a;continue}a=o-55296<<10|a-56320|65536,o=null}else o&&(n[s++]=239,n[s++]=191,n[s++]=189,o=null);a<128?n[s++]=a:(a<2048?n[s++]=a>>6|192:(a<65536?n[s++]=a>>12|224:(n[s++]=a>>18|240,n[s++]=a>>12&63|128),n[s++]=a>>6&63|128),n[s++]=63&a|128)}return s}(this.buf,r,this.pos);var t=this.pos-e;t>=128&&ph(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(r){this.realloc(4),uh(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),uh(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=r[t]},writeRawMessage:function(r,e){this.pos++;var t=this.pos;r(e,this);var n=this.pos-t;n>=128&&ph(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeMessage:function(r,e,t){this.writeTag(r,fe.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,ly,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,uy,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,py,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,cy,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,hy,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,dy,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,fy,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,yy,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,my,e)},writeBytesField:function(r,e){this.writeTag(r,fe.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,fe.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,fe.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,fe.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,fe.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,fe.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,fe.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,fe.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,fe.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,fe.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};class yh{constructor(e,{pixelRatio:t,version:n,stretchX:i,stretchY:s,content:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=s,this.content=a,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class mh{constructor(e,t){const n={},i={};this.haveRenderCallbacks=[];const s=[];this.addImages(e,n,s),this.addImages(t,i,s);const{w:a,h:o}=fh(s),l=new Je({width:a||1,height:o||1});for(const u in e){const c=e[u],p=n[u].paddedRect;Je.copy(c.data,l,{x:0,y:0},{x:p.x+1,y:p.y+1},c.data)}for(const u in t){const c=t[u],p=i[u].paddedRect,h=p.x+1,d=p.y+1,f=c.data.width,y=c.data.height;Je.copy(c.data,l,{x:0,y:0},{x:h,y:d},c.data),Je.copy(c.data,l,{x:0,y:y-1},{x:h,y:d-1},{width:f,height:1}),Je.copy(c.data,l,{x:0,y:0},{x:h,y:d+y},{width:f,height:1}),Je.copy(c.data,l,{x:f-1,y:0},{x:h-1,y:d},{width:1,height:y}),Je.copy(c.data,l,{x:0,y:0},{x:h+f,y:d},{width:1,height:y})}this.image=l,this.iconPositions=n,this.patternPositions=i}addImages(e,t,n){for(const i in e){const s=e[i],a={x:0,y:0,w:s.data.width+2,h:s.data.height+2};n.push(a),t[i]=new yh(a,s),s.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t||e.version===t.version)return;e.version=t.version;const[i,s]=e.tl;n.update(t.data,void 0,{x:i,y:s})}}N(yh,"ImagePosition"),N(mh,"ImageAtlas");const it={horizontal:1,vertical:2,horizontalOnly:3};class Dn{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new Dn;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new Dn;return t.imageName=e,t}}class qr{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new qr;for(let i=0;i<e.sections.length;i++){const s=e.sections[i];s.image?n.addImageSection(s):n.addTextSection(s,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,n){let i="";for(let s=0;s<t.length;s++){const a=t.charCodeAt(s+1)||null,o=t.charCodeAt(s-1)||null;i+=!n&&(a&&Ou(a)&&!zn[t[s+1]]||o&&Ou(o)&&!zn[t[s-1]])||!zn[t[s]]?t[s]:zn[t[s]]}return i}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&ns[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&ns[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new qr;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Dn.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(t.length===0)return void Pe("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Dn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Pe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vo(r,e,t,n,i,s,a,o,l,u,c,p,h,d,f){const y=qr.fromFeature(r,i);p===it.vertical&&y.verticalizePunctuation(h);let m=[];const g=function(_,A,S,C,z,k){if(!_)return[];const M=[],E=function(L,X,q,V,R,G){let J=0;for(let K=0;K<L.length();K++){const H=L.getSection(K);J+=gh(L.getCharCode(K),H,V,R,X,G)}return J/Math.max(1,Math.ceil(J/q))}(_,A,S,C,z,k),P=_.text.indexOf("")>=0;let B=0;for(let L=0;L<_.length();L++){const X=_.getSection(L),q=_.getCharCode(L);if(ns[q]||(B+=gh(q,X,C,z,A,k)),L<_.length()-1){const V=!((I=q)<11904||!(Tu(I)||Mu(I)||Aa(I)||Lu(I)||zu(I)||Su(I)||Cu(I)||_a(I)||Du(I)||Bu(I)||Pu(I)||Ia(I)||Iu(I)||ku(I)||Au(I)||Eu(I)||wa(I)||Fu(I)||Vu(I)||Ru(I)));(gy[q]||V||X.imageName)&&M.push(vh(L+1,B,E,M,xy(q,_.getCharCode(L+1),V&&P),!1))}}var I;return bh(vh(_.length(),B,E,M,0,!0))}(y,u,s,e,n,d),{processBidirectionalText:b,processStyledBidirectionalText:x}=Be;if(b&&y.sections.length===1){const _=b(y.toString(),g);for(const A of _){const S=new qr;S.text=A,S.sections=y.sections;for(let C=0;C<A.length;C++)S.sectionIndex.push(0);m.push(S)}}else if(x){const _=x(y.text,y.sectionIndex,g);for(const A of _){const S=new qr;S.text=A[0],S.sectionIndex=A[1],S.sections=y.sections,m.push(S)}}else m=function(_,A){const S=[],C=_.text;let z=0;for(const k of A)S.push(_.substring(z,k)),z=k;return z<C.length&&S.push(_.substring(z,C.length)),S}(y,g);const v=[],w={positionedLines:v,text:y.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:p,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(_,A,S,C,z,k,M,E,P,B,I,L){let X=0,q=0,V=0;const R=E==="right"?1:E==="left"?0:.5;let G=!1;for(const j of z){const Q=j.getSections();for(const le of Q){if(le.imageName)continue;const ye=A[le.fontStack];if(ye&&(G=ye.ascender!==void 0&&ye.descender!==void 0,!G))break}if(!G)break}let J=0;for(const j of z){j.trim();const Q=j.getMaxScale(),le=(Q-1)*Ne,ye={positionedGlyphs:[],lineOffset:0};_.positionedLines[J]=ye;const he=ye.positionedGlyphs;let _e=0;if(!j.length()){q+=k,++J;continue}let pe=0,be=0;for(let se=0;se<j.length();se++){const Te=j.getSection(se),Ze=j.getSectionIndex(se),re=j.getCharCode(se);let ge=Te.scale,Ee=null,ce=null,xe=null,$e=Ne,Le=0;const qe=!(P===it.horizontal||!I&&!Ta(re)||I&&(ns[re]||(K=re,bu(K)||_u(K)||wu(K)||Sa(K)||ka(K))));if(Te.imageName){const Re=C[Te.imageName];if(!Re)continue;xe=Te.imageName,_.iconsInText=_.iconsInText||!0,ce=Re.paddedRect;const Fe=Re.displaySize;ge=ge*Ne/L,Ee={width:Fe[0],height:Fe[1],left:1,top:-3,advance:qe?Fe[1]:Fe[0],localGlyph:!1},Le=G?-Ee.height*ge:Q*Ne-17-Fe[1]*ge,$e=Ee.advance;const Rt=(qe?Fe[0]:Fe[1])*ge-Ne*Q;Rt>0&&Rt>_e&&(_e=Rt)}else{const Re=S[Te.fontStack];if(!Re)continue;Re[re]&&(ce=Re[re]);const Fe=A[Te.fontStack];if(!Fe)continue;const Rt=Fe.glyphs[re];if(!Rt)continue;if(Ee=Rt.metrics,$e=re!==8203?Ne:0,G){const Yr=Fe.ascender!==void 0?Math.abs(Fe.ascender):0,$n=Fe.descender!==void 0?Math.abs(Fe.descender):0,qn=(Yr+$n)*ge;pe<qn&&(pe=qn,be=(Yr-$n)/2*ge),Le=-Yr*ge}else Le=(Q-ge)*Ne-17}qe?(_.verticalizable=!0,he.push({glyph:re,imageName:xe,x:X,y:q+Le,vertical:qe,scale:ge,localGlyph:Ee.localGlyph,fontStack:Te.fontStack,sectionIndex:Ze,metrics:Ee,rect:ce}),X+=$e*ge+B):(he.push({glyph:re,imageName:xe,x:X,y:q+Le,vertical:qe,scale:ge,localGlyph:Ee.localGlyph,fontStack:Te.fontStack,sectionIndex:Ze,metrics:Ee,rect:ce}),X+=Ee.advance*ge+B)}he.length!==0&&(V=Math.max(X-B,V),G?wh(he,R,_e,be,k*Q/2):wh(he,R,_e,0,k/2)),X=0;const ke=k*Q+_e;ye.lineOffset=Math.max(_e,le),q+=ke,++J}var K;const H=q,{horizontalAlign:ie,verticalAlign:D}=_h(M);(function(j,Q,le,ye,he,_e){const pe=(Q-le)*he,be=-_e*ye;for(const ke of j)for(const se of ke.positionedGlyphs)se.x+=pe,se.y+=be})(_.positionedLines,R,ie,D,V,H),_.top+=-D*H,_.bottom=_.top+H,_.left+=-ie*V,_.right=_.left+V,_.hasBaseline=G}(w,e,t,n,m,a,o,l,p,u,h,f),!function(_){for(const A of _)if(A.positionedGlyphs.length!==0)return!1;return!0}(v)&&w}const ns={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function gh(r,e,t,n,i,s){if(e.imageName){const a=n[e.imageName];return a?a.displaySize[0]*e.scale*Ne/s+i:0}{const a=t[e.fontStack],o=a&&a.glyphs[r];return o?o.metrics.advance*e.scale+i:0}}function xh(r,e,t,n){const i=Math.pow(r-e,2);return n?r<e?i/2:2*i:i+Math.abs(t)*t}function xy(r,e,t){let n=0;return r===10&&(n-=1e4),t&&(n+=150),r!==40&&r!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function vh(r,e,t,n,i,s){let a=null,o=xh(e,t,i,s);for(const l of n){const u=xh(e-l.x,t,i,s)+l.badness;u<=o&&(a=l,o=u)}return{index:r,x:e,priorBreak:a,badness:o}}function bh(r){return r?bh(r.priorBreak).concat(r.index):[]}function _h(r){let e=.5,t=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function wh(r,e,t,n,i){if(!(e||t||n||i))return;const s=r.length-1,a=r[s],o=(a.x+a.metrics.advance*a.scale)*e;for(let l=0;l<=s;l++)r[l].x-=o,r[l].y+=t+n+i}function vy(r,e,t){const{horizontalAlign:n,verticalAlign:i}=_h(t),s=e[0]-r.displaySize[0]*n,a=e[1]-r.displaySize[1]*i;return{image:r,top:a,bottom:a+r.displaySize[1],left:s,right:s+r.displaySize[0]}}function Sh(r,e,t,n,i,s){const a=r.image;let o;if(a.content){const m=a.content,g=a.pixelRatio||1;o=[m[0]/g,m[1]/g,a.displaySize[0]-m[2]/g,a.displaySize[1]-m[3]/g]}const l=e.left*s,u=e.right*s;let c,p,h,d;t==="width"||t==="both"?(d=i[0]+l-n[3],p=i[0]+u+n[1]):(d=i[0]+(l+u-a.displaySize[0])/2,p=d+a.displaySize[0]);const f=e.top*s,y=e.bottom*s;return t==="height"||t==="both"?(c=i[1]+f-n[0],h=i[1]+y+n[2]):(c=i[1]+(f+y-a.displaySize[1])/2,h=c+a.displaySize[1]),{image:a,top:c,right:p,bottom:h,left:d,collisionPadding:o}}class zt extends O{constructor(e,t,n,i,s){super(e,t),this.angle=i,this.z=n,s!==void 0&&(this.segment=s)}clone(){return new zt(this.x,this.y,this.z,this.angle,this.segment)}}function Ah(r,e,t,n,i){if(e.segment===void 0)return!0;let s=e,a=e.segment+1,o=0;for(;o>-t/2;){if(a--,a<0)return!1;o-=r[a].dist(s),s=r[a]}o+=r[a].dist(r[a+1]),a++;const l=[];let u=0;for(;o<t/2;){const c=r[a],p=r[a+1];if(!p)return!1;let h=r[a-1].angleTo(c)-c.angleTo(p);for(h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:o,angleDelta:h}),u+=h;o-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return!1;a++,o+=c.dist(p)}return!0}function kh(r){let e=0;for(let t=0;t<r.length-1;t++)e+=r[t].dist(r[t+1]);return e}function Ih(r,e,t){return r?.6*e*t:0}function Mh(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function by(r,e,t,n,i,s){const a=Ih(t,i,s),o=Mh(t,n)*s;let l=0;const u=kh(r)/2;for(let c=0;c<r.length-1;c++){const p=r[c],h=r[c+1],d=p.dist(h);if(l+d>u){const f=(u-l)/d,y=de(p.x,h.x,f),m=de(p.y,h.y,f),g=new zt(y,m,0,h.angleTo(p),c);return!a||Ah(r,g,o,a,e)?g:void 0}l+=d}}function _y(r,e,t,n,i,s,a,o,l){const u=Ih(n,s,a),c=Mh(n,i),p=c*a,h=r[0].x===0||r[0].x===l||r[0].y===0||r[0].y===l;return e-p<e/4&&(e=p+e/4),Th(r,h?e/2*o%e:(c/2+2*s)*a*o%e,e,u,t,p,h,!1,l)}function Th(r,e,t,n,i,s,a,o,l){const u=s/2,c=kh(r);let p=0,h=e-t,d=[];for(let f=0;f<r.length-1;f++){const y=r[f],m=r[f+1],g=y.dist(m),b=m.angleTo(y);for(;h+t<p+g;){h+=t;const x=(h-p)/g,v=de(y.x,m.x,x),w=de(y.y,m.y,x);if(v>=0&&v<l&&w>=0&&w<l&&h-u>=0&&h+u<=c){const _=new zt(v,w,0,b,f);_._round(),n&&!Ah(r,_,s,n,i)||d.push(_)}}p+=g}return o||d.length||a||(d=Th(r,p/2,t,n,i,s,a,!0,l)),d}function Ch(r,e,t,n){const i=[],s=r.image,a=s.pixelRatio,o=s.paddedRect.w-2,l=s.paddedRect.h-2,u=r.right-r.left,c=r.bottom-r.top,p=s.stretchX||[[0,o]],h=s.stretchY||[[0,l]],d=(k,M)=>k+M[1]-M[0],f=p.reduce(d,0),y=h.reduce(d,0),m=o-f,g=l-y;let b=0,x=f,v=0,w=y,_=0,A=m,S=0,C=g;if(s.content&&n){const k=s.content;b=is(p,0,k[0]),v=is(h,0,k[1]),x=is(p,k[0],k[2]),w=is(h,k[1],k[3]),_=k[0]-b,S=k[1]-v,A=k[2]-k[0]-x,C=k[3]-k[1]-w}const z=(k,M,E,P)=>{const B=ss(k.stretch-b,x,u,r.left),I=as(k.fixed-_,A,k.stretch,f),L=ss(M.stretch-v,w,c,r.top),X=as(M.fixed-S,C,M.stretch,y),q=ss(E.stretch-b,x,u,r.left),V=as(E.fixed-_,A,E.stretch,f),R=ss(P.stretch-v,w,c,r.top),G=as(P.fixed-S,C,P.stretch,y),J=new O(B,L),K=new O(q,L),H=new O(q,R),ie=new O(B,R),D=new O(I/a,X/a),j=new O(V/a,G/a),Q=e*Math.PI/180;if(Q){const he=Math.sin(Q),_e=Math.cos(Q),pe=[_e,-he,he,_e];J._matMult(pe),K._matMult(pe),ie._matMult(pe),H._matMult(pe)}const le=k.stretch+k.fixed,ye=M.stretch+M.fixed;return{tl:J,tr:K,bl:ie,br:H,tex:{x:s.paddedRect.x+1+le,y:s.paddedRect.y+1+ye,w:E.stretch+E.fixed-le,h:P.stretch+P.fixed-ye},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:j,minFontScaleX:A/a/u,minFontScaleY:C/a/c,isSDF:t}};if(n&&(s.stretchX||s.stretchY)){const k=Eh(p,m,f),M=Eh(h,g,y);for(let E=0;E<k.length-1;E++){const P=k[E],B=k[E+1];for(let I=0;I<M.length-1;I++)i.push(z(P,M[I],B,M[I+1]))}}else i.push(z({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:o+1},{fixed:0,stretch:l+1}));return i}function is(r,e,t){let n=0;for(const i of r)n+=Math.max(e,Math.min(t,i[1]))-Math.max(e,Math.min(t,i[0]));return n}function Eh(r,e,t){const n=[{fixed:-1,stretch:0}];for(const[i,s]of r){const a=n[n.length-1];n.push({fixed:i-a.stretch,stretch:a.stretch}),n.push({fixed:i-a.stretch,stretch:a.stretch+(s-i)})}return n.push({fixed:e+1,stretch:t}),n}function ss(r,e,t,n){return r/e*t+n}function as(r,e,t,n){return r-e*t/n}function wy(r,e,t,n){const i=e+r.positionedLines[n].lineOffset;return n===0?t+i/2:t+(i+(e+r.positionedLines[n-1].lineOffset))/2}N(zt,"Anchor");class Sy{constructor(e=[],t=Ay){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const s=e-1>>1,a=t[s];if(n(i,a)>=0)break;t[e]=a,e=s}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,s=t[e];for(;e<i;){let a=1+(e<<1),o=t[a];const l=a+1;if(l<this.length&&n(t[l],o)<0&&(a=l,o=t[l]),n(o,s)>=0)break;t[e]=o,e=a}t[e]=s}}function Ay(r,e){return r<e?-1:r>e?1:0}function ky(r,e=1,t=!1){let n=1/0,i=1/0,s=-1/0,a=-1/0;const o=r[0];for(let d=0;d<o.length;d++){const f=o[d];(!d||f.x<n)&&(n=f.x),(!d||f.y<i)&&(i=f.y),(!d||f.x>s)&&(s=f.x),(!d||f.y>a)&&(a=f.y)}const l=Math.min(s-n,a-i);let u=l/2;const c=new Sy([],Iy);if(l===0)return new O(n,i);for(let d=n;d<s;d+=l)for(let f=i;f<a;f+=l)c.push(new Gr(d+u,f+u,u,r));let p=function(d){let f=0,y=0,m=0;const g=d[0];for(let b=0,x=g.length,v=x-1;b<x;v=b++){const w=g[b],_=g[v],A=w.x*_.y-_.x*w.y;y+=(w.x+_.x)*A,m+=(w.y+_.y)*A,f+=3*A}return new Gr(y/f,m/f,0,d)}(r),h=c.length;for(;c.length;){const d=c.pop();(d.d>p.d||!p.d)&&(p=d,t&&console.log("found best %d after %d probes",Math.round(1e4*d.d)/1e4,h)),d.max-p.d<=e||(u=d.h/2,c.push(new Gr(d.p.x-u,d.p.y-u,u,r)),c.push(new Gr(d.p.x+u,d.p.y-u,u,r)),c.push(new Gr(d.p.x-u,d.p.y+u,u,r)),c.push(new Gr(d.p.x+u,d.p.y+u,u,r)),h+=4)}return t&&(console.log(`num probes: ${h}`),console.log(`best distance: ${p.d}`)),p.p}function Iy(r,e){return e.max-r.max}function Gr(r,e,t,n){this.p=new O(r,e),this.h=t,this.d=function(i,s){let a=!1,o=1/0;for(let l=0;l<s.length;l++){const u=s[l];for(let c=0,p=u.length,h=p-1;c<p;h=c++){const d=u[c],f=u[h];d.y>i.y!=f.y>i.y&&i.x<(f.x-d.x)*(i.y-d.y)/(f.y-d.y)+d.x&&(a=!a),o=Math.min(o,Mc(i,d,f))}}return(a?1:-1)*Math.sqrt(o)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const bo=Number.POSITIVE_INFINITY,My=Math.sqrt(2);function Ty(r,[e,t]){let n=0,i=0;if(t===bo){e<0&&(e=0);const s=e/My;switch(r){case"top-right":case"top-left":i=s-7;break;case"bottom-right":case"bottom-left":i=7-s;break;case"bottom":i=7-e;break;case"top":i=e-7}switch(r){case"top-right":case"bottom-right":n=-s;break;case"top-left":case"bottom-left":n=s;break;case"left":n=e;break;case"right":n=-e}}else{switch(e=Math.abs(e),t=Math.abs(t),r){case"top-right":case"top-left":case"top":i=t-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-t}switch(r){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}}return[n,i]}function Cy(r,e,t,n,i,s,a,o,l,u){r.createArrays(),r.tilePixelRatio=Y/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const c=r.layers[0].layout,p=r.layers[0]._unevaluatedLayout._values,h={};if(r.textSizeData.kind==="composite"){const{minZoom:y,maxZoom:m}=r.textSizeData;h.compositeTextSizes=[p["text-size"].possiblyEvaluate(new we(y),o),p["text-size"].possiblyEvaluate(new we(m),o)]}if(r.iconSizeData.kind==="composite"){const{minZoom:y,maxZoom:m}=r.iconSizeData;h.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new we(y),o),p["icon-size"].possiblyEvaluate(new we(m),o)]}h.layoutTextSize=p["text-size"].possiblyEvaluate(new we(l+1),o),h.layoutIconSize=p["icon-size"].possiblyEvaluate(new we(l+1),o),h.textMaxSize=p["text-size"].possiblyEvaluate(new we(18),o);const d=c.get("text-rotation-alignment")==="map"&&c.get("symbol-placement")!=="point",f=c.get("text-size");for(const y of r.features){const m=c.get("text-font").evaluate(y,{},o).join(","),g=f.evaluate(y,{},o),b=h.layoutTextSize.evaluate(y,{},o),x=(h.layoutIconSize.evaluate(y,{},o),{horizontal:{},vertical:void 0}),v=y.text;let w,_=[0,0];if(v){const C=v.toString(),z=c.get("text-letter-spacing").evaluate(y,{},o)*Ne,k=c.get("text-line-height").evaluate(y,{},o)*Ne,M=Td(C)?z:0,E=c.get("text-anchor").evaluate(y,{},o),P=c.get("text-variable-anchor");if(!P){const q=c.get("text-radial-offset").evaluate(y,{},o);_=q?Ty(E,[q*Ne,bo]):c.get("text-offset").evaluate(y,{},o).map(V=>V*Ne)}let B=d?"center":c.get("text-justify").evaluate(y,{},o);const I=c.get("symbol-placement")==="point",L=I?c.get("text-max-width").evaluate(y,{},o)*Ne:1/0,X=q=>{r.allowVerticalPlacement&&Ma(C)&&(x.vertical=vo(v,e,t,i,m,L,k,E,q,M,_,it.vertical,!0,b,g))};if(!d&&P){const q=B==="auto"?P.map(R=>Ph(R)):[B];let V=!1;for(let R=0;R<q.length;R++){const G=q[R];if(!x.horizontal[G])if(V)x.horizontal[G]=x.horizontal[0];else{const J=vo(v,e,t,i,m,L,k,"center",G,M,_,it.horizontal,!1,b,g);J&&(x.horizontal[G]=J,V=J.positionedLines.length===1)}}X("left")}else{if(B==="auto"&&(B=Ph(E)),I||c.get("text-writing-mode").indexOf("horizontal")>=0||!Ma(C)){const q=vo(v,e,t,i,m,L,k,E,B,M,_,it.horizontal,!1,b,g);q&&(x.horizontal[B]=q)}X(I?"left":B)}}let A=!1;if(y.icon&&y.icon.name){const C=n[y.icon.name];C&&(w=vy(i[y.icon.name],c.get("icon-offset").evaluate(y,{},o),c.get("icon-anchor").evaluate(y,{},o)),A=C.sdf,r.sdfIcons===void 0?r.sdfIcons=C.sdf:r.sdfIcons!==C.sdf&&Pe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(C.pixelRatio!==r.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const S=Dh(x.horizontal)||x.vertical;r.iconsInText||(r.iconsInText=!!S&&S.iconsInText),(S||w)&&Ey(r,y,x,w,n,h,b,0,_,A,a,o,u)}s&&r.generateCollisionDebugBuffers(l,r.collisionBoxArray)}function Ph(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ey(r,e,t,n,i,s,a,o,l,u,c,p,h){let d=s.textMaxSize.evaluate(e,{},p);d===void 0&&(d=a);const f=r.layers[0].layout,y=f.get("icon-offset").evaluate(e,{},p),m=Dh(t.horizontal)||t.vertical,g=h.name==="globe",b=a/24,x=r.tilePixelRatio*d/24,v=(M=r.overscaling,r.zoom>18&&M>2&&(M>>=1),Math.max(Y/(512*M),1)*f.get("symbol-spacing")),w=f.get("text-padding")*r.tilePixelRatio,_=f.get("icon-padding")*r.tilePixelRatio,A=me(f.get("text-max-angle")),S=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point",C=f.get("icon-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point",z=f.get("symbol-placement"),k=v/2;var M;const E=f.get("icon-text-fit");let P;n&&E!=="none"&&(r.allowVerticalPlacement&&t.vertical&&(P=Sh(n,t.vertical,E,f.get("icon-text-fit-padding"),y,b)),m&&(n=Sh(n,m,E,f.get("icon-text-fit-padding"),y,b)));const B=(I,L,X)=>{if(L.x<0||L.x>=Y||L.y<0||L.y>=Y)return;let q=null;if(g){const{x:V,y:R,z:G}=h.projectTilePoint(L.x,L.y,X);q={anchor:new zt(V,R,G,0,void 0),up:h.upVector(X,L.x,L.y)}}(function(V,R,G,J,K,H,ie,D,j,Q,le,ye,he,_e,pe,be,ke,se,Te,Ze,re,ge,Ee,ce,xe){const $e=V.addToLineVertexArray(R,J);let Le,qe,Re,Fe,Rt,Yr,$n,qn=0,Ip=0,Mp=0,Tp=0,Xo=-1,Wo=-1;const St={};let Cp=ir("");const dr=G?G.anchor:R;let Yo=0,Ho=0;if(j._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Yo,Ho]=j.layout.get("text-offset").evaluate(re,{},xe).map(He=>He*Ne):(Yo=j.layout.get("text-radial-offset").evaluate(re,{},xe)*Ne,Ho=bo),V.allowVerticalPlacement&&K.vertical){const He=K.vertical;if(pe)Yr=_o(He),D&&($n=_o(D));else{const Ke=j.layout.get("text-rotate").evaluate(re,{},xe)+90;Re=os(Q,dr,R,le,ye,he,He,_e,Ke,be),D&&(Fe=os(Q,dr,R,le,ye,he,D,se,Ke))}}if(H){const He=j.layout.get("icon-rotate").evaluate(re,{},xe),Ke=j.layout.get("icon-text-fit")!=="none",Gn=Ch(H,He,Ee,Ke),Jo=D?Ch(D,He,Ee,Ke):void 0;qe=os(Q,dr,R,le,ye,he,H,se,He),qn=4*Gn.length;const Ep=V.iconSizeData;let fr=null;Ep.kind==="source"?(fr=[Et*j.layout.get("icon-size").evaluate(re,{},xe)],fr[0]>Xt&&Pe(`${V.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ep.kind==="composite"&&(fr=[Et*ge.compositeIconSizes[0].evaluate(re,{},xe),Et*ge.compositeIconSizes[1].evaluate(re,{},xe)],(fr[0]>Xt||fr[1]>Xt)&&Pe(`${V.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),V.addSymbols(V.icon,Gn,fr,Ze,Te,re,!1,G,R,$e.lineStartIndex,$e.lineLength,-1,ce,xe),Xo=V.icon.placedSymbolArray.length-1,Jo&&(Ip=4*Jo.length,V.addSymbols(V.icon,Jo,fr,Ze,Te,re,it.vertical,G,R,$e.lineStartIndex,$e.lineLength,-1,ce,xe),Wo=V.icon.placedSymbolArray.length-1)}for(const He in K.horizontal){const Ke=K.horizontal[He];Le||(Cp=ir(Ke.text),pe?Rt=_o(Ke):Le=os(Q,dr,R,le,ye,he,Ke,_e,j.layout.get("text-rotate").evaluate(re,{},xe),be));const Gn=Ke.positionedLines.length===1;if(Mp+=zh(V,G,R,Ke,ie,j,pe,re,be,$e,K.vertical?it.horizontal:it.horizontalOnly,Gn?Object.keys(K.horizontal):[He],St,Xo,ge,ce,xe),Gn)break}K.vertical&&(Tp+=zh(V,G,R,K.vertical,ie,j,pe,re,be,$e,it.vertical,["vertical"],St,Wo,ge,ce,xe));let Qt=-1;const Ko=(He,Ke)=>He?Math.max(He,Ke):Ke;Qt=Ko(Rt,Qt),Qt=Ko(Yr,Qt),Qt=Ko($n,Qt);const Vm=Qt>-1?1:0;V.glyphOffsetArray.length>=Yt.MAX_GLYPHS&&Pe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),re.sortKey!==void 0&&V.addToSortKeyRanges(V.symbolInstances.length,re.sortKey),V.symbolInstances.emplaceBack(dr.x,dr.y,dr.z,R.x,R.y,St.right>=0?St.right:-1,St.center>=0?St.center:-1,St.left>=0?St.left:-1,St.vertical>=0?St.vertical:-1,Xo,Wo,Cp,Le!==void 0?Le:V.collisionBoxArray.length,Le!==void 0?Le+1:V.collisionBoxArray.length,Re!==void 0?Re:V.collisionBoxArray.length,Re!==void 0?Re+1:V.collisionBoxArray.length,qe!==void 0?qe:V.collisionBoxArray.length,qe!==void 0?qe+1:V.collisionBoxArray.length,Fe||V.collisionBoxArray.length,Fe?Fe+1:V.collisionBoxArray.length,le,Mp,Tp,qn,Ip,Vm,0,Yo,Ho,Qt)})(r,L,q,I,t,n,i,P,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,w,S,l,0,_,C,y,e,s,u,c,p)};if(z==="line")for(const I of function(L,X,q,V,R){const G=[];for(let J=0;J<L.length;J++){const K=L[J];let H;for(let ie=0;ie<K.length-1;ie++){let D=K[ie],j=K[ie+1];D.x<0&&j.x<0||(D.x<0?D=new O(0,D.y+(0-D.x)/(j.x-D.x)*(j.y-D.y))._round():j.x<0&&(j=new O(0,D.y+(0-D.x)/(j.x-D.x)*(j.y-D.y))._round()),D.y<0&&j.y<0||(D.y<0?D=new O(D.x+(0-D.y)/(j.y-D.y)*(j.x-D.x),0)._round():j.y<0&&(j=new O(D.x+(0-D.y)/(j.y-D.y)*(j.x-D.x),0)._round()),D.x>=V&&j.x>=V||(D.x>=V?D=new O(V,D.y+(V-D.x)/(j.x-D.x)*(j.y-D.y))._round():j.x>=V&&(j=new O(V,D.y+(V-D.x)/(j.x-D.x)*(j.y-D.y))._round()),D.y>=R&&j.y>=R||(D.y>=R?D=new O(D.x+(R-D.y)/(j.y-D.y)*(j.x-D.x),R)._round():j.y>=R&&(j=new O(D.x+(R-D.y)/(j.y-D.y)*(j.x-D.x),R)._round()),H&&D.equals(H[H.length-1])||(H=[D],G.push(H)),H.push(j)))))}}return G}(e.geometry,0,0,Y,Y)){const L=_y(I,v,A,t.vertical||m,n,24,x,r.overscaling,Y);for(const X of L){const q=m;q&&Py(r,q.text,k,X)||B(I,X,p)}}else if(z==="line-center"){for(const I of e.geometry)if(I.length>1){const L=by(I,A,t.vertical||m,n,24,x);L&&B(I,L,p)}}else if(e.type==="Polygon")for(const I of fo(e.geometry,0)){const L=ky(I,16);B(I[0],new zt(L.x,L.y,0,0,void 0),p)}else if(e.type==="LineString")for(const I of e.geometry)B(I,new zt(I[0].x,I[0].y,0,0,void 0),p);else if(e.type==="Point")for(const I of e.geometry)for(const L of I)B([L],new zt(L.x,L.y,0,0,void 0),p)}const Xt=32640;function zh(r,e,t,n,i,s,a,o,l,u,c,p,h,d,f,y,m){const g=function(v,w,_,A,S,C,z,k){const M=[];if(w.positionedLines.length===0)return M;const E=A.layout.get("text-rotate").evaluate(C,{})*Math.PI/180,P=function(q){const V=q[0],R=q[1],G=V*R;return G>0?[V,-R]:G<0?[-V,R]:V===0?[R,V]:[R,-V]}(_);let B=Math.abs(w.top-w.bottom);for(const q of w.positionedLines)B-=q.lineOffset;const I=w.positionedLines.length,L=B/I;let X=w.top-_[1];for(let q=0;q<I;++q){const V=w.positionedLines[q];X=wy(w,L,X,q);for(const R of V.positionedGlyphs){if(!R.rect)continue;const G=R.rect||{};let J=4,K=!0,H=1,ie=0;if(R.imageName){const ce=z[R.imageName];if(!ce)continue;if(ce.sdf){Pe("SDF images are not supported in formatted text and will be ignored.");continue}K=!1,H=ce.pixelRatio,J=1/H}const D=(S||k)&&R.vertical,j=R.metrics.advance*R.scale/2,Q=R.metrics,le=R.rect;if(le===null)continue;k&&w.verticalizable&&(ie=R.imageName?j-R.metrics.width*R.scale/2:0);const ye=S?[R.x+j,R.y]:[0,0];let he=[0,0],_e=[0,0],pe=!1;S||(D?(_e=[R.x+j+P[0],R.y+P[1]-ie],pe=!0):he=[R.x+j+_[0],R.y+_[1]-ie]);const be=le.w*R.scale/(H*(R.localGlyph?2:1)),ke=le.h*R.scale/(H*(R.localGlyph?2:1));let se,Te,Ze,re;if(D){const ce=R.y-X,xe=new O(-j,j-ce),$e=-Math.PI/2,Le=new O(..._e);se=new O(-j+he[0],he[1]),se._rotateAround($e,xe)._add(Le),se.x+=-ce+j,se.y-=(Q.left-J)*R.scale;const qe=R.imageName?Q.advance*R.scale:Ne*R.scale,Re=String.fromCharCode(R.glyph);ay(Re)?se.x+=(1-J)*R.scale:oy(Re)?se.x+=qe-Q.height*R.scale+(-J-1)*R.scale:se.x+=R.imageName||Q.width+2*J===le.w&&Q.height+2*J===le.h?(qe-ke)/2:(qe-(Q.height+2*J)*R.scale)/2,Te=new O(se.x,se.y-be),Ze=new O(se.x+ke,se.y),re=new O(se.x+ke,se.y-be)}else{const ce=(Q.left-J)*R.scale-j+he[0],xe=(-Q.top-J)*R.scale+he[1],$e=ce+be,Le=xe+ke;se=new O(ce,xe),Te=new O($e,xe),Ze=new O(ce,Le),re=new O($e,Le)}if(E){let ce;ce=S?new O(0,0):pe?new O(P[0],P[1]):new O(_[0],_[1]),se._rotateAround(E,ce),Te._rotateAround(E,ce),Ze._rotateAround(E,ce),re._rotateAround(E,ce)}const ge=new O(0,0),Ee=new O(0,0);M.push({tl:se,tr:Te,bl:Ze,br:re,tex:G,writingMode:w.writingMode,glyphOffset:ye,sectionIndex:R.sectionIndex,isSDF:K,pixelOffsetTL:ge,pixelOffsetBR:Ee,minFontScaleX:0,minFontScaleY:0})}}return M}(0,n,l,s,a,o,i,r.allowVerticalPlacement),b=r.textSizeData;let x=null;b.kind==="source"?(x=[Et*s.layout.get("text-size").evaluate(o,{},m)],x[0]>Xt&&Pe(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):b.kind==="composite"&&(x=[Et*f.compositeTextSizes[0].evaluate(o,{},m),Et*f.compositeTextSizes[1].evaluate(o,{},m)],(x[0]>Xt||x[1]>Xt)&&Pe(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,g,x,l,a,o,c,e,t,u.lineStartIndex,u.lineLength,d,y,m);for(const v of p)h[v]=r.text.placedSymbolArray.length-1;return 4*g.length}function Dh(r){for(const e in r)return r[e];return null}function os(r,e,t,n,i,s,a,o,l,u){let c=a.top,p=a.bottom,h=a.left,d=a.right;const f=a.collisionPadding;if(f&&(h-=f[0],c-=f[1],d+=f[2],p+=f[3]),l){const y=new O(h,c),m=new O(d,c),g=new O(h,p),b=new O(d,p),x=me(l);let v=new O(0,0);u&&(v=new O(u[0],u[1])),y._rotateAround(x,v),m._rotateAround(x,v),g._rotateAround(x,v),b._rotateAround(x,v),h=Math.min(y.x,m.x,g.x,b.x),d=Math.max(y.x,m.x,g.x,b.x),c=Math.min(y.y,m.y,g.y,b.y),p=Math.max(y.y,m.y,g.y,b.y)}return r.emplaceBack(e.x,e.y,e.z,t.x,t.y,h,c,d,p,o,n,i,s),r.length-1}function _o(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function Py(r,e,t,n){const i=r.compareText;if(e in i){const s=i[e];for(let a=s.length-1;a>=0;a--)if(n.dist(s[a])<t)return!0}else i[e]=[];return i[e].push(n),!1}function Bh(r,e){const t=r.fovAboveCenter,n=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,i=(r._camera.position[2]*r.worldSize-n)/Math.cos(r._pitch),s=Math.sin(t)*i/Math.sin(Math.max(Math.PI/2-r._pitch-t,.01)),a=Math.sin(r._pitch)*s+i;return Math.min(1.01*a,i*(1/r._horizonShift))}function Bn(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const t=Math.pow(2,-r.z),n=r.x*t,i=(r.x+1)*t,s=r.y*t,a=(r.y+1)*t,o=nt(n),l=nt(i),u=je(s),c=je(a),p=e.project(o,u),h=e.project(l,u),d=e.project(l,c),f=e.project(o,c);let y=Math.min(p.x,h.x,d.x,f.x),m=Math.min(p.y,h.y,d.y,f.y),g=Math.max(p.x,h.x,d.x,f.x),b=Math.max(p.y,h.y,d.y,f.y);const x=t/16;function v(_,A,S,C,z,k){const M=(S+z)/2,E=(C+k)/2,P=e.project(nt(M),je(E)),B=Math.max(0,y-P.x,m-P.y,P.x-g,P.y-b);y=Math.min(y,P.x),g=Math.max(g,P.x),m=Math.min(m,P.y),b=Math.max(b,P.y),B>x&&(v(_,P,S,C,M,E),v(P,A,M,E,z,k))}v(p,h,n,s,i,s),v(h,d,i,s,i,a),v(d,f,i,a,n,a),v(f,p,n,a,n,s),y-=x,m-=x,g+=x,b+=x;const w=1/Math.max(g-y,b-m);return{scale:w,x:y*w,y:m*w,x2:g*w,y2:b*w,projection:e}}const zy=gn(new Float32Array(16));class Wt{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new ae(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t,n=!0){return e._coordinatePoint(e.locationCoordinate(t),n)}pixelsPerMeter(e,t){return Tt(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return Bh(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,i){const s=e.horizonLineFromTop(!1),a=new O(t,Math.max(s,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(a,i))}pointCoordinate3D(e,t,n){const i=new O(t,n);if(e.elevation)return e.elevation.pointCoordinate(i);{const s=this.pointCoordinate(e,i.x,i.y,0);return[s.x,s.y,s.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return zy}createTileMatrix(e,t,n){let i,s,a;const o=n.canonical,l=gn(new Float64Array(16));if(this.isReprojectedInTileSpace){const u=Bn(o,this);i=1,s=u.x+n.wrap*u.scale,a=u.y,Li(l,l,[i/u.scale,i/u.scale,e.pixelsPerMeter/t])}else i=t/e.zoomScale(o.z),s=(o.x+Math.pow(2,o.z)*n.wrap)*i,a=o.y*i;return dc(l,l,[s,a,0]),Li(l,l,[i/Y,i/Y,1]),l}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class Dy extends Wt{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],i=Math.sin(me(t));this.n=(i+Math.sin(me(n)))/2,this.c=1+i*(2*this.n-i),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n,c:i,r0:s}=this,a=me(e-this.center[0]),o=me(t),l=Math.sqrt(i-2*n*Math.sin(o))/n;return{x:l*Math.sin(a*n),y:l*Math.cos(a*n)-s,z:0}}unproject(e,t){const{n,c:i,r0:s}=this,a=s+t;let o=Math.atan2(e,Math.abs(a))*Math.sign(a);a*n<0&&(o-=Math.PI*Math.sign(e)*Math.sign(a));const l=me(this.center[0])*n;o=el(o,-Math.PI-l,Math.PI-l);const u=ue(et(o/n)+this.center[0],-180,180),c=Math.asin(ue((i-(e*e+a*a)*n*n)/(2*n),-1,1)),p=ue(et(c),-85.051129,ur);return new ae(u,p)}}const Rn=1.340264,Vn=-.081106,Ln=893e-6,Fn=.003796,ls=Math.sqrt(3)/2;class By extends Wt{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(ls*Math.sin(t)),i=n*n,s=i*i*i;return{x:.5*(e*Math.cos(n)/(ls*(Rn+3*Vn*i+s*(7*Ln+9*Fn*i)))/Math.PI+.5),y:1-.5*(n*(Rn+Vn*i+s*(Ln+Fn*i))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=n*n,s=i*i*i;for(let c,p,h,d=0;d<12&&(p=n*(Rn+Vn*i+s*(Ln+Fn*i))-t,h=Rn+3*Vn*i+s*(7*Ln+9*Fn*i),c=p/h,n=ue(n-c,-Math.PI/3,Math.PI/3),i=n*n,s=i*i*i,!(Math.abs(c)<1e-12));++d);const a=ls*e*(Rn+3*Vn*i+s*(7*Ln+9*Fn*i))/Math.cos(n),o=Math.asin(Math.sin(n)/ls),l=ue(180*a/Math.PI,-180,180),u=ue(180*o/Math.PI,-85.051129,ur);return new ae(l,u)}}class Ry extends Wt{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),i=ue(360*(.5-t),-85.051129,ur);return new ae(n,i)}}const Zr=Math.PI/2;function us(r){return Math.tan((Zr+r)/2)}class Vy extends Wt{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30];let i=me(t),s=me(n);this.southernCenter=i+s<0,this.southernCenter&&(i=-i,s=-s);const a=Math.cos(i),o=us(i);this.n=i===s?Math.sin(i):Math.log(a/Math.cos(s))/Math.log(us(s)/o),this.f=a*Math.pow(us(i),this.n)/this.n}project(e,t){t=me(t),this.southernCenter&&(t=-t),e=me(e-this.center[0]);const n=1e-6,{n:i,f:s}=this;s>0?t<-Zr+n&&(t=-Zr+n):t>Zr-n&&(t=Zr-n);const a=s/Math.pow(us(t),i);let o=a*Math.sin(i*e),l=s-a*Math.cos(i*e);return o=.5*(o/Math.PI+.5),l=.5*(l/Math.PI+.5),{x:o,y:this.southernCenter?l:1-l,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n,f:i}=this,s=i-t,a=Math.sign(s),o=Math.sign(n)*Math.sqrt(e*e+s*s);let l=Math.atan2(e,Math.abs(s))*a;s*n<0&&(l-=Math.PI*Math.sign(e)*a);const u=ue(et(l/n)+this.center[0],-180,180),c=ue(et(2*Math.atan(Math.pow(i/o,1/n))-Zr),-85.051129,ur);return new ae(u,this.southernCenter?-c:c)}}class Rh extends Wt{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:or(e),y:lr(t),z:0}}unproject(e,t){const n=nt(e),i=je(t);return new ae(n,i)}}const Vh=me(ur);class Ly extends Wt{project(e,t){const n=(t=me(t))*t,i=n*n;return{x:.5*((e=me(e))*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=25,s=0,a=n*n;do{a=n*n;const u=a*a;s=(n*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))-t)/(1.007226+a*(.045255+u*(.259866*a-.311325-.005916*11*u))),n=ue(n-s,-Vh,Vh)}while(Math.abs(s)>1e-6&&--i>0);a=n*n;const o=ue(et(e/(.8707+a*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))),-180,180),l=et(n);return new ae(o,l)}}const Lh=me(ur);class Fy extends Wt{project(e,t){t=me(t),e=me(e);const n=Math.cos(t),i=2/Math.PI,s=Math.acos(n*Math.cos(e/2)),a=Math.sin(s)/s,o=.5*(e*i+2*n*Math.sin(e/2)/a)||0,l=.5*(t+Math.sin(t)/a)||0;return{x:.5*(o/Math.PI+.5),y:1-.5*(l/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,i=t=(2*(1-t)-1)*Math.PI,s=25;const a=1e-6;let o=0,l=0;do{const u=Math.cos(i),c=Math.sin(i),p=2*c*u,h=c*c,d=u*u,f=Math.cos(n/2),y=Math.sin(n/2),m=2*f*y,g=y*y,b=1-d*f*f,x=b?1/b:0,v=b?Math.acos(u*f)*Math.sqrt(1/b):0,w=.5*(2*v*u*y+2*n/Math.PI)-e,_=.5*(v*c+i)-t,A=.5*x*(d*g+v*u*f*h)+1/Math.PI,S=x*(m*p/4-v*c*y),C=.125*x*(p*y-v*c*d*m),z=.5*x*(h*f+v*g*u)+.5,k=S*C-z*A;o=(_*S-w*z)/k,l=(w*C-_*A)/k,n=ue(n-o,-Math.PI,Math.PI),i=ue(i-l,-Lh,Lh)}while((Math.abs(o)>a||Math.abs(l)>a)&&--s>0);return new ae(et(n),et(i))}}class Fh extends Wt{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(me(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:i}=this;return{x:me(e)*i*n+.5,y:-Math.sin(me(t))/i*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:i}=this,s=-(t-.5)/n,a=ue(et((e-.5)/n)/i,-180,180),o=Math.asin(ue(s*i,-1,1)),l=ue(et(o),-85.051129,ur);return new ae(a,l)}}class Uy extends Rh{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,n){const i=Sn(e,t,n);return ct(i,i,to(bn(n))),{x:i[0],y:i[1],z:i[2]}}locationPoint(e,t){const n=Qa(t.lat,t.lng),i=ut([],n),s=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Ka(n,n,i,Tt(1,0)*Y*s);const a=gn(new Float64Array(16));return pc(a,e.pixelMatrix,e.globeMatrix),ct(n,n,a),new O(n[0],n[1])}pixelsPerMeter(e,t){return Tt(1,0)*t}pixelSpaceConversion(e,t,n){const i=Tt(1,e)*t,s=de(Tt(1,45)*t,i,n);return this.pixelsPerMeter(e,t)/s}createTileMatrix(e,t,n){const i=function(s){const a=function(l,u){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l}(wc,s.min),o=1/eo(s);return Li(a,a,[o,o,o])}(bn(n.canonical));return pc(new Float64Array(16),e.globeMatrix,i)}createInversionMatrix(e,t){const{center:n}=e,i=to(bn(t));return function(s,a,o){var l=Math.sin(o),u=Math.cos(o),c=a[0],p=a[1],h=a[2],d=a[3],f=a[8],y=a[9],m=a[10],g=a[11];a!==s&&(s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15]),s[0]=c*u-f*l,s[1]=p*u-y*l,s[2]=h*u-m*l,s[3]=d*u-g*l,s[8]=c*l+f*u,s[9]=p*l+y*u,s[10]=h*l+m*u,s[11]=d*l+g*u}(i,i,me(n.lng)),function(s,a,o){var l=Math.sin(o),u=Math.cos(o),c=a[4],p=a[5],h=a[6],d=a[7],f=a[8],y=a[9],m=a[10],g=a[11];a!==s&&(s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15]),s[4]=c*u+f*l,s[5]=p*u+y*l,s[6]=h*u+m*l,s[7]=d*u+g*l,s[8]=f*u-c*l,s[9]=y*u-p*l,s[10]=m*u-h*l,s[11]=g*u-d*l}(i,i,me(n.lat)),Li(i,i,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(i)}pointCoordinate(e,t,n,i){return vc(e,t,n,!0)||new Oi(0,0)}pointCoordinate3D(e,t,n){const i=this.pointCoordinate(e,t,n,0);return[i.x,i.y,i.z]}isPointAboveHorizon(e,t){return!vc(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(i,s){const a=i.cameraToCenterDistance,o=i._centerAltitude*s,l=i._camera,u=i._camera.forward(),c=Br([],Gt([],u,-a),[0,0,o]),p=i.worldSize/(2*Math.PI),h=[0,0,-p],d=i.width/i.height,f=Math.tan(i.fovAboveCenter),y=Gt([],l.up(),f),m=Gt([],l.right(),f*d),g=ut([],Br([],Br([],u,y),m)),b=[];let x;if(new gc(c,g).closestPointOnSphere(h,p,b)){const v=Br([],b,h),w=Rr([],v,c);x=Math.cos(i.fovAboveCenter)*Ha(w)}else{const v=Rr([],c,h),w=Rr([],h,c);ut(w,w);const _=Ha(v)-p;x=Math.sqrt(_*(_+2*p));const A=Math.acos(x/(p+_))-Math.acos(Zt(u,w));x*=Math.cos(A)}return 1.01*x}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=ro(e.zoom);if(n>0){const i=Bh(e,Tt(1,e.center.lat)*e.worldSize),s=e.worldSize/(2*Math.PI),a=Math.max(e.width,e.height)/e.worldSize*Math.PI;return de(t,i+s*(1-Math.cos(a)),Math.pow(n,10))}return t}upVector(e,t,n){return Sn(t,n,e,1)}upVectorScale(e){return{metersToTile:xc(eo(bn(e)))}}}function wo(r){const e=r.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new Rh(r);case"equirectangular":return new Ry(r);case"naturalEarth":return new Ly(r);case"equalEarth":return new By(r);case"winkelTripel":return new Fy(r);case"albers":return t?new Fh(r):new Dy(r);case"lambertConformalConic":return t?new Fh(r):new Vy(r);case"globe":return new Uy(r)}throw new Error(`Invalid projection name: ${r.name}`)}const Oy=Hi.types,jy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cs(r,e,t,n,i,s,a,o,l,u,c,p,h){const d=o?Math.min(Xt,Math.round(o[0])):0,f=o?Math.min(Xt,Math.round(o[1])):0;r.emplaceBack(e,t,Math.round(32*n),Math.round(32*i),s,a,(d<<1)+(l?1:0),f,16*u,16*c,256*p,256*h)}function hs(r,e,t,n,i,s,a){r.emplaceBack(e,t,n,i,s,a)}function So(r,e,t,n,i){r.emplaceBack(e,t,n,i),r.emplaceBack(e,t,n,i),r.emplaceBack(e,t,n,i),r.emplaceBack(e,t,n,i)}function Ny(r){for(const e of r.sections)if(Pd(e.text))return!0;return!1}class Ao{constructor(e){this.layoutVertexArray=new za,this.indexArray=new xt,this.programConfigurations=e,this.segments=new Ue,this.dynamicLayoutVertexArray=new yn,this.opacityVertexArray=new Ba,this.placedSymbolArray=new ec,this.globeExtVertexArray=new Da}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ey.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ry.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,jy,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ty.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}N(Ao,"SymbolBuffers");class ko{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new Ue,this.collisionVertexArray=new Va,this.collisionVertexArrayExt=new La}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ny.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,iy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}N(ko,"CollisionBuffers");class Yt{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=gn([]),this.placementViewportMatrix=gn([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ah(this.zoom,t["text-size"]),this.iconSizeData=ah(this.zoom,t["icon-size"]);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),s=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=s!=="viewport-y"&&i.constantOr(1)!==void 0,this.sortFeaturesByY=(s==="viewport-y"||s==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(a=>it[a]),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Ao(new sr(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ao(new sr(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new nc,this.lineVertexArray=new ic,this.symbolInstances=new rc}calculateGlyphDependencies(e,t,n,i,s){for(let a=0;a<e.length;a++)if(t[e.charCodeAt(a)]=!0,i&&s){const o=zn[e.charAt(a)];o&&(t[o.charCodeAt(0)]=!0)}}populate(e,t,n,i){const s=this.layers[0],a=s.layout,o=this.projection.name==="globe",l=a.get("text-font"),u=a.get("text-field"),c=a.get("icon-image"),p=(u.value.kind!=="constant"||u.value.value instanceof Ye&&!u.value.value.isEmpty()||u.value.value.toString().length>0)&&(l.value.kind!=="constant"||l.value.value.length>0),h=c.value.kind!=="constant"||!!c.value.value||Object.keys(c.parameters).length>0,d=a.get("symbol-sort-key");if(this.features=[],!p&&!h)return;const f=t.iconDependencies,y=t.glyphDependencies,m=t.availableImages,g=new we(this.zoom);for(const{feature:b,id:x,index:v,sourceLayerIndex:w}of e){const _=s._featureFilter.needGeometry,A=cr(b,_);if(!s._featureFilter.filter(g,A,n))continue;if(_||(A.geometry=Ct(b,n,i)),o&&b.type!==1&&n.z<=5){const k=A.geometry,M=.98078528056,E=(P,B)=>Zt(Sn(P.x,P.y,n,1),Sn(B.x,B.y,n,1))<M;for(let P=0;P<k.length;P++)k[P]=Qd(k[P],E)}let S,C;if(p){const k=s.getValueAndResolveTokens("text-field",A,n,m),M=Ye.factory(k);Ny(M)&&(this.hasRTLText=!0),(!this.hasRTLText||Gu()==="unavailable"||this.hasRTLText&&Be.isParsed())&&(S=sy(M,s,A))}if(h){const k=s.getValueAndResolveTokens("icon-image",A,n,m);C=k instanceof rt?k:rt.fromString(k)}if(!S&&!C)continue;const z=this.sortFeaturesByKey?d.evaluate(A,{},n):void 0;if(this.features.push({id:x,text:S,icon:C,index:v,sourceLayerIndex:w,geometry:A.geometry,properties:b.properties,type:Oy[b.type],sortKey:z}),C&&(f[C.name]=!0),S){const k=l.evaluate(A,{},n).join(","),M=a.get("text-rotation-alignment")==="map"&&a.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(it.vertical)>=0;for(const E of S.sections)if(E.image)f[E.image.name]=!0;else{const P=Ma(S.toString()),B=E.fontStack||k,I=y[B]=y[B]||{};this.calculateGlyphDependencies(E.text,I,M,this.allowVerticalPlacement,P)}}}a.get("symbol-placement")==="line"&&(this.features=function(b){const x={},v={},w=[];let _=0;function A(k){w.push(b[k]),_++}function S(k,M,E){const P=v[k];return delete v[k],v[M]=P,w[P].geometry[0].pop(),w[P].geometry[0]=w[P].geometry[0].concat(E[0]),P}function C(k,M,E){const P=x[M];return delete x[M],x[k]=P,w[P].geometry[0].shift(),w[P].geometry[0]=E[0].concat(w[P].geometry[0]),P}function z(k,M,E){const P=E?M[0][M[0].length-1]:M[0][0];return`${k}:${P.x}:${P.y}`}for(let k=0;k<b.length;k++){const M=b[k],E=M.geometry,P=M.text?M.text.toString():null;if(!P){A(k);continue}const B=z(P,E),I=z(P,E,!0);if(B in v&&I in x&&v[B]!==x[I]){const L=C(B,I,E),X=S(B,I,w[L].geometry);delete x[B],delete v[I],v[z(P,w[X].geometry,!0)]=X,w[L].geometry=null}else B in v?S(B,I,E):I in x?C(B,I,E):(A(k),x[B]=_-1,v[I]=_-1)}return w.filter(k=>k.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((b,x)=>b.sortKey-x.sortKey)}update(e,t,n,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n,i),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n,i))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=wo(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:i,y:s}of t)this.lineVertexArray.emplaceBack(i,s);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,i,s,a,o,l,u,c,p,h,d,f){const y=e.indexArray,m=e.layoutVertexArray,g=e.globeExtVertexArray,b=e.segments.prepareSegment(4*t.length,m,y,this.canOverlap?a.sortKey:void 0),x=this.glyphOffsetArray.length,v=b.vertexLength,w=this.allowVerticalPlacement&&o===it.vertical?Math.PI/2:0,_=a.text&&a.text.sections;for(let S=0;S<t.length;S++){const{tl:C,tr:z,bl:k,br:M,tex:E,pixelOffsetTL:P,pixelOffsetBR:B,minFontScaleX:I,minFontScaleY:L,glyphOffset:X,isSDF:q,sectionIndex:V}=t[S],R=b.vertexLength,G=X[1];if(cs(m,u.x,u.y,C.x,G+C.y,E.x,E.y,n,q,P.x,P.y,I,L),cs(m,u.x,u.y,z.x,G+z.y,E.x+E.w,E.y,n,q,B.x,P.y,I,L),cs(m,u.x,u.y,k.x,G+k.y,E.x,E.y+E.h,n,q,P.x,B.y,I,L),cs(m,u.x,u.y,M.x,G+M.y,E.x+E.w,E.y+E.h,n,q,B.x,B.y,I,L),l){const{x:J,y:K,z:H}=l.anchor,[ie,D,j]=l.up;hs(g,J,K,H,ie,D,j),hs(g,J,K,H,ie,D,j),hs(g,J,K,H,ie,D,j),hs(g,J,K,H,ie,D,j),So(e.dynamicLayoutVertexArray,J,K,H,w)}else So(e.dynamicLayoutVertexArray,u.x,u.y,u.z,w);y.emplaceBack(R,R+1,R+2),y.emplaceBack(R+1,R+2,R+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(X[0]),S!==t.length-1&&V===t[S+1].sectionIndex||e.programConfigurations.populatePaintArrays(m.length,a,a.index,{},d,f,_&&_[V])}const A=l?l.anchor:u;e.placedSymbolArray.emplaceBack(A.x,A.y,A.z,u.x,u.y,x,this.glyphOffsetArray.length-x,v,c,p,u.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],o,0,!1,0,h,0)}_commitLayoutVertex(e,t,n,i,s,a,o){e.emplaceBack(t,n,i,s,a,Math.round(o.x),Math.round(o.y))}_addCollisionDebugVertices(e,t,n,i,s,a,o){const l=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),u=l.vertexLength,c=o.tileAnchorX,p=o.tileAnchorY;for(let d=0;d<4;d++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,i,s,a,c,p,new O(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,s,a,c,p,new O(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,s,a,c,p,new O(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,s,a,c,p,new O(e.x1,e.y2)),l.vertexLength+=4;const h=n.indexArray;h.emplaceBack(u,u+1),h.emplaceBack(u+1,u+2),h.emplaceBack(u+2,u+3),h.emplaceBack(u+3,u),l.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,i,s,a){for(let o=i;o<s;o++){const l=n.get(o),u=this.getSymbolInstanceTextSize(e,a,t,o);this._addCollisionDebugVertices(l,u,this.textCollisionBox,l.projectedAnchorX,l.projectedAnchorY,l.projectedAnchorZ,a)}}_addIconDebugCollisionBoxes(e,t,n,i,s,a){for(let o=i;o<s;o++){const l=n.get(o),u=this.getSymbolInstanceIconSize(e,t,a.placedIconSymbolIndex);this._addCollisionDebugVertices(l,u,this.iconCollisionBox,l.projectedAnchorX,l.projectedAnchorY,l.projectedAnchorZ,a)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ko(Ei,sh.members,zr),this.iconCollisionBox=new ko(Ei,sh.members,zr);const n=es(this.iconSizeData,e),i=es(this.textSizeData,e);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._addTextDebugCollisionBoxes(i,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(i,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,t,n,i){const s=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),a=oh(this.textSizeData,e,s)/Ne;return this.tilePixelRatio*a}getSymbolInstanceIconSize(e,t,n){const i=this.icon.placedSymbolArray.get(n),s=oh(this.iconSizeData,e,i);return this.tilePixelRatio*s}_commitDebugCollisionVertexUpdate(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}_updateTextDebugCollisionBoxes(e,t,n,i,s,a){for(let o=i;o<s;o++){const l=n.get(o),u=this.getSymbolInstanceTextSize(e,a,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,u,l.padding)}}_updateIconDebugCollisionBoxes(e,t,n,i,s,a){for(let o=i;o<s;o++){const l=n.get(o),u=this.getSymbolInstanceIconSize(e,t,a);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,u,l.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=es(this.iconSizeData,e),i=es(this.textSizeData,e);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(i,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(i,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,i,s,a,o,l,u){const c={};if(t<n){const{x1:p,y1:h,x2:d,y2:f,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v,featureIndex:w}=e.get(t);c.textBox={x1:p,y1:h,x2:d,y2:f,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v},c.textFeatureIndex=w}if(i<s){const{x1:p,y1:h,x2:d,y2:f,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v,featureIndex:w}=e.get(i);c.verticalTextBox={x1:p,y1:h,x2:d,y2:f,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v},c.verticalTextFeatureIndex=w}if(a<o){const{x1:p,y1:h,x2:d,y2:f,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v,featureIndex:w}=e.get(a);c.iconBox={x1:p,y1:h,x2:d,y2:f,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v},c.iconFeatureIndex=w}if(l<u){const{x1:p,y1:h,x2:d,y2:f,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v,featureIndex:w}=e.get(l);c.verticalIconBox={x1:p,y1:h,x2:d,y2:f,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v},c.verticalIconFeatureIndex=w}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let s=n.vertexStartIndex;s<i;s+=4)e.indexArray.emplaceBack(s,s+1,s+2),e.indexArray.emplaceBack(s+1,s+2,s+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],s=[],a=[];for(let o=0;o<this.symbolInstances.length;++o){a.push(o);const l=this.symbolInstances.get(o);i.push(0|Math.round(t*l.tileAnchorX+n*l.tileAnchorY)),s.push(l.featureIndex)}return a.sort((o,l)=>i[o]-i[l]||s[l]-s[o]),a}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const n=this.symbolInstances.get(t);this.featureSortOrder.push(n.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:s,leftJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:l,verticalPlacedIconSymbolIndex:u}=n;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),s>=0&&s!==i&&this.addIndicesForPlacedSymbol(this.text,s),a>=0&&a!==s&&a!==i&&this.addIndicesForPlacedSymbol(this.text,a),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),l>=0&&this.addIndicesForPlacedSymbol(this.icon,l),u>=0&&this.addIndicesForPlacedSymbol(this.icon,u)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}N(Yt,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Yt.MAX_GLYPHS=65535,Yt.addDynamicAttributes=So;const $y=new Xe({"symbol-placement":new $(T.layout_symbol["symbol-placement"]),"symbol-spacing":new $(T.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $(T.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Z(T.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $(T.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $(T.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new $(T.layout_symbol["icon-ignore-placement"]),"icon-optional":new $(T.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $(T.layout_symbol["icon-rotation-alignment"]),"icon-size":new Z(T.layout_symbol["icon-size"]),"icon-text-fit":new $(T.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $(T.layout_symbol["icon-text-fit-padding"]),"icon-image":new Z(T.layout_symbol["icon-image"]),"icon-rotate":new Z(T.layout_symbol["icon-rotate"]),"icon-padding":new $(T.layout_symbol["icon-padding"]),"icon-keep-upright":new $(T.layout_symbol["icon-keep-upright"]),"icon-offset":new Z(T.layout_symbol["icon-offset"]),"icon-anchor":new Z(T.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $(T.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $(T.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $(T.layout_symbol["text-rotation-alignment"]),"text-field":new Z(T.layout_symbol["text-field"]),"text-font":new Z(T.layout_symbol["text-font"]),"text-size":new Z(T.layout_symbol["text-size"]),"text-max-width":new Z(T.layout_symbol["text-max-width"]),"text-line-height":new Z(T.layout_symbol["text-line-height"]),"text-letter-spacing":new Z(T.layout_symbol["text-letter-spacing"]),"text-justify":new Z(T.layout_symbol["text-justify"]),"text-radial-offset":new Z(T.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $(T.layout_symbol["text-variable-anchor"]),"text-anchor":new Z(T.layout_symbol["text-anchor"]),"text-max-angle":new $(T.layout_symbol["text-max-angle"]),"text-writing-mode":new $(T.layout_symbol["text-writing-mode"]),"text-rotate":new Z(T.layout_symbol["text-rotate"]),"text-padding":new $(T.layout_symbol["text-padding"]),"text-keep-upright":new $(T.layout_symbol["text-keep-upright"]),"text-transform":new Z(T.layout_symbol["text-transform"]),"text-offset":new Z(T.layout_symbol["text-offset"]),"text-allow-overlap":new $(T.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new $(T.layout_symbol["text-ignore-placement"]),"text-optional":new $(T.layout_symbol["text-optional"])});var Io={paint:new Xe({"icon-opacity":new Z(T.paint_symbol["icon-opacity"]),"icon-color":new Z(T.paint_symbol["icon-color"]),"icon-halo-color":new Z(T.paint_symbol["icon-halo-color"]),"icon-halo-width":new Z(T.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Z(T.paint_symbol["icon-halo-blur"]),"icon-translate":new $(T.paint_symbol["icon-translate"]),"icon-translate-anchor":new $(T.paint_symbol["icon-translate-anchor"]),"text-opacity":new Z(T.paint_symbol["text-opacity"]),"text-color":new Z(T.paint_symbol["text-color"],{runtimeType:mt,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Z(T.paint_symbol["text-halo-color"]),"text-halo-width":new Z(T.paint_symbol["text-halo-width"]),"text-halo-blur":new Z(T.paint_symbol["text-halo-blur"]),"text-translate":new $(T.paint_symbol["text-translate"]),"text-translate-anchor":new $(T.paint_symbol["text-translate-anchor"])}),layout:$y};class Uh{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Hr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}N(Uh,"FormatSectionOverride",{omit:["defaultValue"]});class ps extends lt{constructor(e){super(e,Io)}recalculate(e,t){super.recalculate(e,t),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const i=[];for(const s of n)i.indexOf(s)<0&&i.push(s);this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,i){const s=this.layout.get(e).evaluate(t,{},n,i),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||oi(a.value)||!s?s:function(o,l){return l.replace(/{([^{}]+)}/g,(u,c)=>c in o?String(o[c]):"")}(t.properties,s)}createBucket(e){return new Yt(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Io.paint.overridableProperties){if(!ps.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new Uh(t),i=new ua(n,t.property.specification);let s=null;s=t.value.kind==="constant"||t.value.kind==="source"?new ca("source",i):new ha("composite",i,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Pr(t.property,s,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&ps.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=Io.paint.properties[t];let s=!1;const a=o=>{for(const l of o)if(i.overrides&&i.overrides.hasOverride(l))return void(s=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Ye)a(n.value.value.sections);else if(n.value.kind==="source"){const o=u=>{s||(u instanceof rn&&ze(u.value)===Kr?a(u.value.sections):u instanceof nn?a(u.sections):u.eachChild(o))},l=n.value;l._styleExpression&&o(l._styleExpression.expression)}return s}getProgramConfiguration(e){return new qt(this,e)}}var qy={paint:new Xe({"background-color":new $(T.paint_background["background-color"]),"background-pattern":new $(T.paint_background["background-pattern"]),"background-opacity":new $(T.paint_background["background-opacity"])})},Gy={paint:new Xe({"raster-opacity":new $(T.paint_raster["raster-opacity"]),"raster-hue-rotate":new $(T.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $(T.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $(T.paint_raster["raster-brightness-max"]),"raster-saturation":new $(T.paint_raster["raster-saturation"]),"raster-contrast":new $(T.paint_raster["raster-contrast"]),"raster-resampling":new $(T.paint_raster["raster-resampling"]),"raster-fade-duration":new $(T.paint_raster["raster-fade-duration"])})};class Zy extends lt{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Xy={paint:new Xe({"sky-type":new $(T.paint_sky["sky-type"]),"sky-atmosphere-sun":new $(T.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new $(T.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new $(T.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new $(T.paint_sky["sky-gradient-radius"]),"sky-gradient":new ki(T.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new $(T.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new $(T.paint_sky["sky-atmosphere-color"]),"sky-opacity":new $(T.paint_sky["sky-opacity"])})};function Mo(r,e,t){const n=[0,0,1],i=function(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}([]);return function(s,a,o){o*=.5;var l=a[0],u=a[1],c=a[2],p=a[3],h=Math.sin(o),d=Math.cos(o);s[0]=l*d-c*h,s[1]=u*d+p*h,s[2]=c*d+l*h,s[3]=p*d-u*h}(i,i,t?-me(r)+Math.PI:me(r)),function(s,a,o){o*=.5;var l=a[0],u=a[1],c=a[2],p=a[3],h=Math.sin(o),d=Math.cos(o);s[0]=l*d+p*h,s[1]=u*d+c*h,s[2]=c*d-u*h,s[3]=p*d-l*h}(i,i,-me(e)),function(s,a,o){var l=o[0],u=o[1],c=o[2],p=a[0],h=a[1],d=a[2],f=u*d-c*h,y=c*p-l*d,m=l*h-u*p,g=u*m-c*y,b=c*f-l*m,x=l*y-u*f,v=2*o[3];y*=v,m*=v,b*=2,x*=2,s[0]=p+(f*=v)+(g*=2),s[1]=h+y+b,s[2]=d+m+x}(n,n,i),ut(n,n)}const Wy={circle:class extends lt{constructor(e){super(e,lf)}createBucket(e){return new ao(e)}queryRadius(e){const t=e;return Lr("circle-radius",this,t)+Lr("circle-stroke-width",this,t)+$i(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,s,a,o,l){const u=Ec(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Pc(e,i,a,o,l,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",u,c)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new qt(this,e)}},heatmap:class extends lt{createBucket(e){return new Dc(e)}constructor(e){super(e,pf),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Vc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Lr("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,i,s,a,o,l){const u=this.paint.get("heatmap-radius").evaluate(t,n);return Pc(e,i,a,o,l,!0,!0,new O(0,0),u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new qt(this,e)}},hillshade:class extends lt{constructor(e){super(e,df)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends lt{constructor(e){super(e,Cf)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(e){return new qt(this,e)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Wi(e)}queryRadius(){return $i(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,s,a){return!e.queryGeometry.isAboveHorizon&&Ic(Cc(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends lt{constructor(e){super(e,Gf)}createBucket(e){return new Ji(e)}queryRadius(){return $i(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new qt(this,e)}queryIntersectsFeature(e,t,n,i,s,a,o,l,u){const c=Ec(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),p=this.paint.get("fill-extrusion-height").evaluate(t,n),h=this.paint.get("fill-extrusion-base").evaluate(t,n),d=[0,0],f=l&&a.elevation,y=a.elevation?a.elevation.exaggeration():1,m=e.tile.getBucket(this);if(f&&m instanceof Ji){const w=m.centroidVertexArray,_=u+1;_<w.length&&(d[0]=w.geta_centroid_pos0(_),d[1]=w.geta_centroid_pos1(_))}if(d[0]===0&&d[1]===1)return!1;a.projection.name==="globe"&&(i=Kc([i],[new O(0,0),new O(Y,Y)],e.tileID.canonical).map(w=>w.polygon).flat());const g=f?l:null,[b,x]=function(w,_,A,S,C,z,k,M,E,P,B){return w.projection.name==="globe"?function(I,L,X,q,V,R,G,J,K,H,ie){const D=[],j=[],Q=I.projection.upVectorScale(ie,I.center.lat,I.worldSize).metersToTile,le=[0,0,0,1],ye=[0,0,0,1],he=(pe,be,ke,se)=>{pe[0]=be,pe[1]=ke,pe[2]=se,pe[3]=1},_e=function(){const pe=Math.PI/32,be=Math.tan(pe),ke=Ui;return ke*Math.sqrt(1+2*be*be)-ke}();X>0&&(X+=_e),q+=_e;for(const pe of L){const be=[],ke=[];for(const se of pe){const Te=se.x+V.x,Ze=se.y+V.y,re=I.projection.projectTilePoint(Te,Ze,ie),ge=I.projection.upVector(ie,se.x,se.y);let Ee=X,ce=q;if(G){const xe=th(Te,Ze,X,q,G,J,K,H);Ee+=xe.base,ce+=xe.top}X!==0?he(le,re.x+ge[0]*Q*Ee,re.y+ge[1]*Q*Ee,re.z+ge[2]*Q*Ee):he(le,re.x,re.y,re.z),he(ye,re.x+ge[0]*Q*ce,re.y+ge[1]*Q*ce,re.z+ge[2]*Q*ce),ct(le,le,R),ct(ye,ye,R),be.push(new jr(le[0],le[1],le[2])),ke.push(new jr(ye[0],ye[1],ye[2]))}D.push(be),j.push(ke)}return[D,j]}(w,_,A,S,C,z,k,M,E,P,B):k?function(I,L,X,q,V,R,G,J,K){const H=[],ie=[],D=[0,0,0,1];for(const j of I){const Q=[],le=[];for(const ye of j){const he=ye.x+q.x,_e=ye.y+q.y,pe=th(he,_e,L,X,R,G,J,K);D[0]=he,D[1]=_e,D[2]=pe.base,D[3]=1,xn(D,D,V),D[3]=Math.max(D[3],1e-5);const be=new jr(D[0]/D[3],D[1]/D[3],D[2]/D[3]);D[0]=he,D[1]=_e,D[2]=pe.top,D[3]=1,xn(D,D,V),D[3]=Math.max(D[3],1e-5);const ke=new jr(D[0]/D[3],D[1]/D[3],D[2]/D[3]);Q.push(be),le.push(ke)}H.push(Q),ie.push(le)}return[H,ie]}(_,A,S,C,z,k,M,E,P):function(I,L,X,q,V){const R=[],G=[],J=V[8]*L,K=V[9]*L,H=V[10]*L,ie=V[11]*L,D=V[8]*X,j=V[9]*X,Q=V[10]*X,le=V[11]*X;for(const ye of I){const he=[],_e=[];for(const pe of ye){const be=pe.x+q.x,ke=pe.y+q.y,se=V[0]*be+V[4]*ke+V[12],Te=V[1]*be+V[5]*ke+V[13],Ze=V[2]*be+V[6]*ke+V[14],re=V[3]*be+V[7]*ke+V[15],ge=se+J,Ee=Te+K,ce=Ze+H,xe=Math.max(re+ie,1e-5),$e=se+D,Le=Te+j,qe=Ze+Q,Re=Math.max(re+le,1e-5);he.push(new jr(ge/xe,Ee/xe,ce/xe)),_e.push(new jr($e/Re,Le/Re,qe/Re))}R.push(he),G.push(_e)}return[R,G]}(_,A,S,C,z)}(a,i,h,p,c,o,g,d,y,a.center.lat,e.tileID.canonical),v=e.queryGeometry;return function(w,_,A){let S=1/0;Ic(A,_)&&(S=eh(A,_[0]));for(let C=0;C<_.length;C++){const z=_[C],k=w[C];for(let M=0;M<z.length-1;M++){const E=z[M],P=[E,z[M+1],k[M+1],k[M],E];tf(A,P)&&(S=Math.min(S,eh(A,P)))}}return S!==1/0&&S}(b,x,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},line:class extends lt{constructor(e){super(e,rh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Zs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=nh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Qi(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new qt(this,e)}queryRadius(e){const t=e,n=ih(Lr("line-width",this,t),Lr("line-gap-width",this,t)),i=Lr("line-offset",this,t);return n/2+Math.abs(i)+$i(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,s,a){if(e.queryGeometry.isAboveHorizon)return!1;const o=Cc(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),l=e.pixelToTileUnitsFactor/2*ih(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),u=this.paint.get("line-offset").evaluate(t,n);return u&&(i=function(c,p){const h=[],d=new O(0,0);for(let f=0;f<c.length;f++){const y=c[f],m=[];for(let g=0;g<y.length;g++){const b=y[g-1],x=y[g],v=y[g+1],w=g===0?d:x.sub(b)._unit()._perp(),_=g===y.length-1?d:v.sub(x)._unit()._perp(),A=w._add(_)._unit();A._mult(1/(A.x*_.x+A.y*_.y)),m.push(A._mult(p)._add(x))}h.push(m)}return h}(i,u*e.pixelToTileUnitsFactor)),function(c,p,h){for(let d=0;d<p.length;d++){const f=p[d];if(c.length>=3){for(let y=0;y<f.length;y++)if(Vr(c,f[y]))return!0}if(nf(c,f,h))return!0}return!1}(o,i,l)}isTileClipped(){return!0}},symbol:ps,background:class extends lt{constructor(e){super(e,qy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends lt{constructor(e){super(e,Gy)}getProgramIds(){return["raster"]}},sky:class extends lt{constructor(e){super(e,Xy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="sky-gradient"?this._updateColorRamp():e!=="sky-atmosphere-sun"&&e!=="sky-atmosphere-halo-color"&&e!=="sky-atmosphere-color"&&e!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Vc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if(this.paint.get("sky-type")==="atmosphere"){const i=this.paint.get("sky-atmosphere-sun"),s=!i,a=e.style.light,o=a.properties.get("position");return s&&a.properties.get("anchor")==="viewport"&&Pe("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?Mo(o.azimuthal,90-o.polar,t):Mo(i[0],90-i[1],t)}const n=this.paint.get("sky-gradient-center");return Mo(n[0],90-n[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return e==="atmosphere"?["skyboxCapture","skybox"]:e==="gradient"?["skyboxGradient"]:null}}};var Yy=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function To(r){if(typeof r=="number"||typeof r=="boolean"||typeof r=="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let t="[";for(const n of r)t+=`${To(n)},`;return`${t}]`}let e="{";for(const t of Object.keys(r).sort())e+=`${t}:${To(r[t])},`;return`${e}}`}function Hy(r){let e="";for(const t of Yy)e+=`/${To(r[t])}`;return e}class Ky{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(e,t){for(const s of e)this._layerConfigs[s.id]=s,(this._layers[s.id]=(n=s,n.type==="custom"?new Zy(n):new Wy[n.type](n))).compileFilter(),this.keyCache[s.id]&&delete this.keyCache[s.id];var n;for(const s of t)delete this.keyCache[s],delete this._layerConfigs[s],delete this._layers[s];this.familiesBySource={};const i=function(s,a){const o={};for(let u=0;u<s.length;u++){const c=a&&a[s[u].id]||Hy(s[u]);a&&(a[s[u].id]=c);let p=o[c];p||(p=o[c]=[]),p.push(s[u])}const l=[];for(const u in o)l.push(o[u]);return l}(_s(this._layerConfigs),this.keyCache);for(const s of i){const a=s.map(h=>this._layers[h.id]),o=a[0];if(o.visibility==="none")continue;const l=o.source||"";let u=this.familiesBySource[l];u||(u=this.familiesBySource[l]={});const c=o.sourceLayer||"_geojsonTileLayer";let p=u[c];p||(p=u[c]=[]),p.push(a)}}}class Oh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Jy=["tile","layer","source","sourceLayer","state"];class jh{constructor(e,t,n,i,s){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=i,this.properties=e.properties,this.id=s}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const t of Jy)this[t]!==void 0&&(e[t]=this[t]);return e}}class ds{constructor(e,t,n,i){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,t,n){const{width:i,height:s}=e,{context:a}=this,{gl:o}=a,{HTMLImageElement:l,HTMLCanvasElement:u,HTMLVideoElement:c,ImageData:p,ImageBitmap:h}=W;if(o.bindTexture(o.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!t||t.premultiply!==!1)),n||this.size&&this.size[0]===i&&this.size[1]===s){const{x:d,y:f}=n||{x:0,y:0};e instanceof l||e instanceof u||e instanceof c||e instanceof p||h&&e instanceof h?o.texSubImage2D(o.TEXTURE_2D,0,d,f,o.RGBA,o.UNSIGNED_BYTE,e):o.texSubImage2D(o.TEXTURE_2D,0,d,f,i,s,o.RGBA,o.UNSIGNED_BYTE,e.data)}else this.size=[i,s],e instanceof l||e instanceof u||e instanceof c||e instanceof p||h&&e instanceof h?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,e):o.texImage2D(o.TEXTURE_2D,0,this.format,i,s,0,this.format,o.UNSIGNED_BYTE,e.data);this.useMipmap=!!(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap?e===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}const st=32,_t=33,Ht=new Uint16Array(8184);for(let r=0;r<2046;r++){let e=r+2,t=0,n=0,i=0,s=0,a=0,o=0;for(1&e?i=s=a=st:t=n=o=st;(e>>=1)>1;){const u=t+i>>1,c=n+s>>1;1&e?(i=t,s=n,t=a,n=o):(t=i,n=s,i=a,s=o),a=u,o=c}const l=4*r;Ht[l+0]=t,Ht[l+1]=n,Ht[l+2]=i,Ht[l+3]=s}const wt=new Uint16Array(2178),Kt=new Uint8Array(1089),fs=new Uint16Array(1089);function Nh(r){return r===0?-.03125:r===32?.03125:0}var Qy=ve([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const $h={type:2,extent:Y,loadGeometry:()=>[[new O(0,0),new O(8193,0),new O(8193,8193),new O(0,8193),new O(0,0)]]};class qh{constructor(e,t,n,i,s){this.tileID=e,this.uid=Rp++,this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=s,this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Cr.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Bn(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(i,s){const a={};if(!s)return a;for(const o of i){const l=o.layerIds.map(u=>s.getLayer(u)).filter(Boolean);if(l.length!==0){o.layers=l,o.stateDependentLayerIds&&(o.stateDependentLayers=o.stateDependentLayerIds.map(u=>l.filter(c=>c.id===u)[0]));for(const u of l)a[u.id]=o}}return a}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const i in this.buckets){const s=this.buckets[i];if(s instanceof Yt){if(this.hasSymbolBuckets=!0,!n)break;s.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const i in this.buckets){const s=this.buckets[i];if(s instanceof Yt&&s.hasRTLText){this.hasRTLText=!0,Be.isLoading()||Be.isLoaded()||Gu()!=="deferred"||Dd();break}}this.queryPadding=0;for(const i in this.buckets){const s=this.buckets[i];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(i).queryRadius(s))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ja}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const i=this.buckets[n];i.uploadPending()&&i.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ds(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ds(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ds(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,i,s,a,o,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:o,transform:a,params:s,tileTransform:this.tileTransform},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const i=n.loadVTLayers(),s=t?t.sourceLayer:"",a=i._geojsonTileLayer||i[s];if(!a)return;const o=xi(t&&t.filter),{z:l,x:u,y:c}=this.tileID.canonical,p={z:l,x:u,y:c};for(let h=0;h<a.length;h++){const d=a.feature(h);if(o.needGeometry){const m=cr(d,!0);if(!o.filter(new we(this.tileID.overscaledZ),m,this.tileID.canonical))continue}else if(!o.filter(new we(this.tileID.overscaledZ),d))continue;const f=n.getId(d,s),y=new jh(d,l,u,c,f);y.tile=p,e.push(y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const n=As(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let i=!1;if(this.expirationTime>n)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{const s=this.expirationTime-t;s?this.expirationTime=n+Math.max(s,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!t)return;const n=this.latestFeatureIndex.loadVTLayers(),i=t.style.listImages();for(const s in this.buckets){if(!t.style.hasLayer(s))continue;const a=this.buckets[s],o=a.layers[0].sourceLayer||"_geojsonTileLayer",l=n[o],u=e[o];if(!l||!u||Object.keys(u).length===0)continue;if(a.update(u,l,i,this.imageAtlas&&this.imageAtlas.patternPositions||{}),a instanceof Qi||a instanceof Wi){const p=t.style._getSourceCache(a.layers[0].source);t._terrain&&t._terrain.enabled&&p&&a.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(p.id,this.tileID)}const c=t&&t.style&&t.style.getLayer(s);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(a)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Cr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Cr.now()+e}setTexture(e,t){const n=t.context,i=n.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new ds(n,e,i.RGBA,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),n.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax))}setDependencies(e,t){const n={};for(const i of t)n[i]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const i=this.dependencies[n];if(i){for(const s of t)if(i[s])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||t.name==="mercator"||this._tileDebugBuffer)return;const n=Ct($h,this.tileID.canonical,this.tileTransform)[0],i=new jt,s=new zi;for(let a=0;a<n.length;a++){const{x:o,y:l}=n[a];i.emplaceBack(o,l),s.emplaceBack(a)}s.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(s),this._tileDebugBuffer=e.createVertexBuffer(i,Ja.members),this._tileDebugSegments=Ue.simpleSegment(0,0,i.length,s.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||t.name==="mercator")return;const n=Ct($h,this.tileID.canonical,this.tileTransform)[0];let i,s;if(this.isRaster){const a=function(o,l){const u=Bn(o,l),c=Math.pow(2,o.z);for(let m=0;m<_t;m++)for(let g=0;g<_t;g++){const b=nt((o.x+(g+Nh(g))/st)/c),x=je((o.y+(m+Nh(m))/st)/c),v=l.project(b,x),w=m*_t+g;wt[2*w+0]=Math.round((v.x*u.scale-u.x)*Y),wt[2*w+1]=Math.round((v.y*u.scale-u.y)*Y)}Kt.fill(0),fs.fill(0);for(let m=2045;m>=0;m--){const g=4*m,b=Ht[g+0],x=Ht[g+1],v=Ht[g+2],w=Ht[g+3],_=b+v>>1,A=x+w>>1,S=_+A-x,C=A+b-_,z=x*_t+b,k=w*_t+v,M=A*_t+_,E=Math.hypot((wt[2*z+0]+wt[2*k+0])/2-wt[2*M+0],(wt[2*z+1]+wt[2*k+1])/2-wt[2*M+1])>=16;if(Kt[M]=Kt[M]||(E?1:0),m<1022){const P=(x+C>>1)*_t+(b+S>>1),B=(w+C>>1)*_t+(v+S>>1);Kt[M]=Kt[M]||Kt[P]||Kt[B]}}const p=new fn,h=new xt;let d=0;function f(m,g){const b=g*_t+m;return fs[b]===0&&(p.emplaceBack(wt[2*b+0],wt[2*b+1],m*Y/st,g*Y/st),fs[b]=++d),fs[b]-1}function y(m,g,b,x,v,w){const _=m+b>>1,A=g+x>>1;if(Math.abs(m-v)+Math.abs(g-w)>1&&Kt[A*_t+_])y(v,w,m,g,_,A),y(b,x,v,w,_,A);else{const S=f(m,g),C=f(b,x),z=f(v,w);h.emplaceBack(S,C,z)}}return y(0,0,st,st,st,0),y(st,st,0,0,0,st),{vertices:p,indices:h}}(this.tileID.canonical,t);i=a.vertices,s=a.indices}else{i=new fn,s=new xt;for(const{x:o,y:l}of n)i.emplaceBack(o,l,0,0);const a=Fr(i.int16,void 0,4);for(let o=0;o<a.length;o+=3)s.emplaceBack(a[o],a[o+1],a[o+2])}this._tileBoundsBuffer=e.createVertexBuffer(i,Qy.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(s),this._tileBoundsSegments=Ue.simpleSegment(0,0,i.length,s.length)}_makeGlobeTileDebugBuffers(e,t){const n=t.projection;if(!n||n.name!=="globe"||t.freezeTileCoverage)return;const i=this.tileID.canonical,s=function(u,c){const p=ro(c.zoom);if(p===0)return bn(u);const h=bc(u),d=_c(h),f=or(h.getWest())*c.worldSize,y=or(h.getEast())*c.worldSize,m=lr(h.getNorth())*c.worldSize,g=lr(h.getSouth())*c.worldSize,b=[f,m,0],x=[y,m,0],v=[f,g,0],w=[y,g,0],_=hc([],c.globeMatrix);return ct(b,b,_),ct(x,x,_),ct(v,v,_),ct(w,w,_),d[0]=_n(d[0],v,p),d[1]=_n(d[1],w,p),d[2]=_n(d[2],x,p),d[3]=_n(d[3],b,p),ht.fromPoints(d)}(i,t),a=to(s),o=ro(t.zoom);let l;o>0&&(l=hc(new Float64Array(16),t.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,i,t,a,l,o),this._makeGlobeTileDebugTextBuffer(e,i,t,a,l,o)}_globePoint(e,t,n,i,s,a,o){let l=Sn(e,t,n);if(a){const u=1<<n.z,c=or(i.center.lng),p=lr(i.center.lat),h=(n.x+.5)/u-c;let d=0;h>.5?d=-1:h<-.5&&(d=1);let f=(e/Y+n.x)/u+d,y=(t/Y+n.y)/u;f=(f-c)*i._pixelsPerMercatorPixel+c,y=(y-p)*i._pixelsPerMercatorPixel+p;const m=[f*i.worldSize,y*i.worldSize,0];ct(m,m,a),l=_n(l,m,o)}return ct(l,l,s)}_makeGlobeTileDebugBorderBuffer(e,t,n,i,s,a){const o=new jt,l=new zi,u=new Mi,c=(h,d,f,y,m)=>{const g=(f-h)/(m-1),b=(y-d)/(m-1),x=o.length;for(let v=0;v<m;v++){const w=h+v*g,_=d+v*b;o.emplaceBack(w,_);const A=this._globePoint(w,_,t,n,i,s,a);u.emplaceBack(A[0],A[1],A[2]),l.emplaceBack(x+v)}},p=Y;c(0,0,p,0,16),c(p,0,p,p,16),c(p,p,0,p,16),c(0,p,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(o,Ja.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(u,mc.members),this._tileDebugSegments=Ue.simpleSegment(0,0,o.length,l.length)}_makeGlobeTileDebugTextBuffer(e,t,n,i,s,a){const o=new jt,l=new xt,u=new Mi,c=25;l.reserve(32),o.reserve(c),u.reserve(c);const p=(h,d)=>c*h+d;for(let h=0;h<c;h++){const d=2048*h;for(let f=0;f<c;f++){const y=2048*f;o.emplaceBack(y,d);const m=this._globePoint(y,d,t,n,i,s,a);u.emplaceBack(m[0],m[1],m[2])}}for(let h=0;h<4;h++)for(let d=0;d<4;d++){const f=p(h,d),y=p(h,d+1),m=p(h+1,d),g=p(h+1,d+1);l.emplaceBack(f,y,m),l.emplaceBack(m,y,g)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(l),this._tileDebugTextBuffer=e.createVertexBuffer(o,Ja.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(u,mc.members),this._tileDebugTextSegments=Ue.simpleSegment(0,0,c,32)}}class em{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const i=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},Ve(this.stateChanges[e][i],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const s in this.state[e])s!==i&&(this.deletedStates[e][s]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][i]===null){this.deletedStates[e][i]={};for(const s in this.state[e][i])n[s]||(this.deletedStates[e][i][s]=null)}else for(const s in n)this.deletedStates[e]&&this.deletedStates[e][i]&&this.deletedStates[e][i][s]===null&&delete this.deletedStates[e][i][s]}removeFeatureState(e,t,n){if(this.deletedStates[e]===null)return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&t!==void 0)this.deletedStates[e][i]!==null&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),i=Ve({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const s=this.deletedStates[e][t];if(s===null)return{};for(const a in s)delete i[a]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const s={};for(const a in this.stateChanges[i])this.state[i][a]||(this.state[i][a]={}),Ve(this.state[i][a],this.stateChanges[i][a]),s[a]=this.state[i][a];n[i]=s}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const s={};if(this.deletedStates[i]===null)for(const a in this.state[i])s[a]={},this.state[i][a]={};else for(const a in this.deletedStates[i]){if(this.deletedStates[i][a]===null)this.state[i][a]={};else if(this.state[i][a])for(const o of Object.keys(this.deletedStates[i][a]))delete this.state[i][a][o];s[a]=this.state[i][a]}n[i]=n[i]||{},Ve(n[i],s)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const i in e)e[i].setFeatureState(n,t)}}class Gh{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Zh(r,e,t,n){let i=0,s=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(n[a])<1e-15){if(t[a]<r[a]||t[a]>e[a])return null}else{const o=1/n[a];let l=(r[a]-t[a])*o,u=(e[a]-t[a])*o;if(l>u){const c=l;l=u,u=c}if(l>i&&(i=l),u<s&&(s=u),i>s)return null}return i}function Xh(r,e,t,n,i,s,a,o,l,u,c){const p=n-r,h=i-e,d=s-t,f=a-r,y=o-e,m=l-t,g=c[1]*m-c[2]*y,b=c[2]*f-c[0]*m,x=c[0]*y-c[1]*f,v=p*g+h*b+d*x;if(Math.abs(v)<1e-15)return null;const w=1/v,_=u[0]-r,A=u[1]-e,S=u[2]-t,C=(_*g+A*b+S*x)*w;if(C<0||C>1)return null;const z=A*d-S*h,k=S*p-_*d,M=_*h-A*p,E=(c[0]*z+c[1]*k+c[2]*M)*w;return E<0||C+E>1?null:(f*z+y*k+m*M)*w}function Wh(r,e,t){return(r-e)/(t-e)}function Yh(r,e,t,n,i,s,a,o,l){const u=1<<t,c=s-n,p=a-i,h=(r+1)/u*c+n,d=(e+0)/u*p+i,f=(e+1)/u*p+i;o[0]=(r+0)/u*c+n,o[1]=d,l[0]=h,l[1]=f}class Hh{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(s){const a=Math.ceil(Math.log2(s.dim/8)),o=[];let l=Math.ceil(Math.pow(2,a));const u=1/l,c=(d,f,y,m,g)=>{const b=m?1:0,x=(d+1)*y-b,v=f*y,w=(f+1)*y-b;g[0]=d*y,g[1]=v,g[2]=x,g[3]=w};let p=new Gh(l);const h=[];for(let d=0;d<l*l;d++){c(d%l,Math.floor(d/l),u,!1,h);const f=Jt(h[0],h[1],s),y=Jt(h[2],h[1],s),m=Jt(h[2],h[3],s),g=Jt(h[0],h[3],s);p.minimums.push(Math.min(f,y,m,g)),p.maximums.push(Math.max(f,y,m,g)),p.leaves.push(1)}for(o.push(p),l/=2;l>=1;l/=2){const d=o[o.length-1];p=new Gh(l);for(let f=0;f<l*l;f++){c(f%l,Math.floor(f/l),2,!0,h);const y=d.getElevation(h[0],h[1]),m=d.getElevation(h[2],h[1]),g=d.getElevation(h[2],h[3]),b=d.getElevation(h[0],h[3]),x=d.isLeaf(h[0],h[1]),v=d.isLeaf(h[2],h[1]),w=d.isLeaf(h[2],h[3]),_=d.isLeaf(h[0],h[3]),A=Math.min(y.min,m.min,g.min,b.min),S=Math.max(y.max,m.max,g.max,b.max),C=x&&v&&w&&_;p.maximums.push(S),p.minimums.push(A),p.leaves.push(S-A<=5&&C?1:0)}o.push(p)}return o}(this.dem),n=t.length-1,i=t[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,i,s,a,o=1){return Zh([e,t,-100],[n,i,this.maximums[0]*o],s,a)}raycast(e,t,n,i,s,a,o=1){if(!this.nodeCount)return null;const l=this.raycastRoot(e,t,n,i,s,a,o);if(l==null)return null;const u=[],c=[],p=[],h=[],d=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:f,t:y,nodex:m,nodey:g,depth:b}=d.pop();if(this.leaves[f]){Yh(m,g,b,e,t,n,i,p,h);const v=1<<b,w=(m+0)/v,_=(m+1)/v,A=(g+0)/v,S=(g+1)/v,C=Jt(w,A,this.dem)*o,z=Jt(_,A,this.dem)*o,k=Jt(_,S,this.dem)*o,M=Jt(w,S,this.dem)*o,E=Xh(p[0],p[1],C,h[0],p[1],z,h[0],h[1],k,s,a),P=Xh(h[0],h[1],k,p[0],h[1],M,p[0],p[1],C,s,a),B=Math.min(E!==null?E:Number.MAX_VALUE,P!==null?P:Number.MAX_VALUE);if(B!==Number.MAX_VALUE)return B;{const I=Ka([],s,a,y);if(Kh(C,z,M,k,Wh(I[0],p[0],h[0]),Wh(I[1],p[1],h[1]))>=I[2])return y}continue}let x=0;for(let v=0;v<this._siblingOffset.length;v++){Yh((m<<1)+this._siblingOffset[v][0],(g<<1)+this._siblingOffset[v][1],b+1,e,t,n,i,p,h),p[2]=-100,h[2]=this.maximums[this.childOffsets[f]+v]*o;const w=Zh(p,h,s,a);if(w!=null){const _=w;u[v]=_;let A=!1;for(let S=0;S<x&&!A;S++)_>=u[c[S]]&&(c.splice(S,0,v),A=!0);A||(c[x]=v),x++}}for(let v=0;v<x;v++){const w=c[v];d.push({idx:this.childOffsets[f]+w,t:u[w],nodex:(m<<1)+this._siblingOffset[w][0],nodey:(g<<1)+this._siblingOffset[w][1],depth:b+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,i,s){if(e[i].isLeaf(t,n)===1)return;this.childOffsets[s]||(this.childOffsets[s]=this.nodeCount);const a=i-1,o=e[a];let l=0,u=0;for(let c=0;c<this._siblingOffset.length;c++){const p=2*t+this._siblingOffset[c][0],h=2*n+this._siblingOffset[c][1],d=o.getElevation(p,h),f=o.isLeaf(p,h),y=this._addNode(d.min,d.max,f);f&&(l|=1<<c),u||(u=y)}for(let c=0;c<this._siblingOffset.length;c++)l&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],a,u+c)}}function Kh(r,e,t,n,i,s){return de(de(r,t,s),de(e,n,s),i)}function Jt(r,e,t){const n=t.dim,i=ue(r*n-.5,0,n-1),s=ue(e*n-.5,0,n-1),a=Math.floor(i),o=Math.floor(s),l=Math.min(a+1,n-1),u=Math.min(o+1,n-1);return Kh(t.get(a,o),t.get(l,o),t.get(a,u),t.get(l,u),i-a,s-o)}const Jh={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ys{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n,i=!1,s=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return Pe(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const a=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=n||"mapbox",this.borderReady=i,!i){for(let l=0;l<a;l++)o[this._idx(-1,l)]=o[this._idx(0,l)],o[this._idx(a,l)]=o[this._idx(a-1,l)],o[this._idx(l,-1)]=o[this._idx(l,0)],o[this._idx(l,a)]=o[this._idx(l,a-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(a,-1)]=o[this._idx(a-1,0)],o[this._idx(-1,a)]=o[this._idx(0,a-1)],o[this._idx(a,a)]=o[this._idx(a-1,a-1)],s&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Hh(this)}get(e,t,n=!1){n&&(e=ue(e,-1,this.dim),t=ue(t,-1,this.dim));const i=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[i],this.pixels[i+1],this.pixels[i+2])}static getUnpackVector(e){return Jh[e]}get unpackVector(){return Jh[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,n){return(256*e*256+256*t+n)/10-1e4}_unpackTerrarium(e,t,n){return 256*e+t+n/256-32768}static pack(e,t){const n=[0,0,0,0],i=ys.getUnpackVector(t);let s=Math.floor((e+i[3])/i[2]);return n[2]=s%256,s=Math.floor(s/256),n[1]=s%256,s=Math.floor(s/256),n[0]=s,n}getPixels(){return new Je({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,s=t*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(t){case-1:i=s-1;break;case 1:s=i+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}const l=-t*this.dim,u=-n*this.dim;for(let c=a;c<o;c++)for(let p=i;p<s;p++){const h=4*this._idx(p,c),d=4*this._idx(p+l,c+u);this.pixels[h+0]=e.pixels[d+0],this.pixels[h+1]=e.pixels[d+1],this.pixels[h+2]=e.pixels[d+2],this.pixels[h+3]=e.pixels[d+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}N(ys,"DEMData"),N(Hh,"DemMinMaxQuadTree",{omit:["dem"]});class tm{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;this.data[i]===void 0&&(this.data[i]=[]);const s={value:t,timeout:void 0};if(n!==void 0&&(s.timeout=setTimeout(()=>{this.remove(e,s)},n)),this.data[i].push(s),this.order.push(i),this.order.length>this.max){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=t===void 0?0:this.data[n].indexOf(t),s=this.data[n][i];return this.data[n].splice(i,1),s.timeout&&clearTimeout(s.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(s.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const n of t)this.remove(n.value.tileID,n)}}class Dt{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}Dt.Replace=[1,0],Dt.disabled=new Dt(Dt.Replace,Ce.transparent,[!1,!1,!1,!1]),Dt.unblended=new Dt(Dt.Replace,Ce.transparent,[!0,!0,!0,!0]),Dt.alphaBlended=new Dt([1,771],Ce.transparent,[!0,!0,!0,!0]);class Xr extends mi{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",i=>{i.dataType==="source"&&i.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&i.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new tm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new em,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if(t.state!=="loaded"&&t.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return _s(this._tiles).map(e=>e.tileID).sort(Qh).map(e=>e.key)}getRenderableIds(e){const t=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&t.push(this._tiles[n]);return e?t.sort((n,i)=>{const s=n.tileID,a=i.tileID,o=new O(s.canonical.x,s.canonical.y)._rotate(this.transform.angle),l=new O(a.canonical.x,a.canonical.y)._rotate(this.transform.angle);return s.overscaledZ-a.overscaledZ||l.y-o.y||l.x-o.x}).map(n=>n.tileID.key):t.map(n=>n.tileID).sort(Qh).map(n=>n.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,i){if(i)if(e.state="errored",i.status!==404)this._source.fire(new ga(i,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const s=this.map.painter.terrain;this.update(this.transform,s.getScaledDemTileSize(),!0),s.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Cr.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new kr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const s=t[i];if(e.neighboringTiles&&e.neighboringTiles[s]){const a=this.getTileByID(s);n(e,a),n(a,e)}}function n(i,s){if(!i.dem||i.dem.borderReady)return;i.needsHillshadePrepare=!0,i.needsDEMTextureUpload=!0;let a=s.tileID.canonical.x-i.tileID.canonical.x;const o=s.tileID.canonical.y-i.tileID.canonical.y,l=Math.pow(2,i.tileID.canonical.z),u=s.tileID.key;a===0&&o===0||Math.abs(o)>1||(Math.abs(a)>1&&(Math.abs(a+l)===1?a+=l:Math.abs(a-l)===1&&(a-=l)),s.dem&&i.dem&&(i.dem.backfillBorder(s.dem,a,o),i.neighboringTiles&&i.neighboringTiles[u]&&(i.neighboringTiles[u].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const s in this._tiles){let a=this._tiles[s];if(i[s]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>n)continue;let o=a.tileID;for(;a&&a.tileID.overscaledZ>t+1;){const u=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[u.key],a&&a.hasData()&&(o=u)}let l=o;for(;l.overscaledZ>t;)if(l=l.scaledTo(l.overscaledZ-1),e[l.key]){i[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const i=e.scaledTo(n),s=this._getLoadedTile(i);if(s)return s}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,s=Math.floor(n*i*5),a=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,s):s,o=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,a):a;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){const n={};for(const i in this._tiles){const s=this._tiles[i];s.tileID=s.tileID.unwrapTo(s.tileID.wrap+t),n[s.tileID.key]=s}this._tiles=n;for(const i in this._timers)clearTimeout(this._timers[i]),delete this._timers[i];for(const i in this._tiles)this._setTileReloadTimer(+i,this._tiles[i])}}update(e,t,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let i;this.updateCacheSize(e,t),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(o=>new Qe(o.canonical.z,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y)):(i=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(i=i.filter(o=>this._source.hasTile(o)))):i=[];const s=this._updateRetainedTiles(i);if(ep(this._source.type)&&i.length!==0){const o={},l={},u=Object.keys(s);for(const p of u){const h=s[p],d=this._tiles[p];if(!d||d.fadeEndTime&&d.fadeEndTime<=Cr.now())continue;const f=this.findLoadedParent(h,Math.max(h.overscaledZ-Xr.maxOverzooming,this._source.minzoom));f&&(this._addTile(f.tileID),o[f.tileID.key]=f.tileID),l[p]=h}const c=i[i.length-1].overscaledZ;for(const p in this._tiles){const h=this._tiles[p];if(s[p]||!h.hasData())continue;let d=h.tileID;for(;d.overscaledZ>c;){d=d.scaledTo(d.overscaledZ-1);const f=this._tiles[d.key];if(f&&f.hasData()&&l[d.key]){s[p]=h.tileID;break}}}for(const p in o)s[p]||(this._coveredTiles[p]=!0,s[p]=o[p])}for(const o in s)this._tiles[o].clearFadeHold();const a=function(o,l){const u=[];for(const c in o)c in l||u.push(c);return u}(this._tiles,s);for(const o of a){const l=this._tiles[o];l.hasSymbolBuckets&&!l.holdingForFade()?l.setHoldDuration(this.map._fadeDuration):l.hasSymbolBuckets&&!l.symbolFadeFinished()||this._removeTile(+o)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(e.length===0)return t;const n={},i=e.reduce((u,c)=>Math.min(u,c.overscaledZ),1/0),s=e[0].overscaledZ,a=Math.max(s-Xr.maxOverzooming,this._source.minzoom),o=Math.max(s+Xr.maxUnderzooming,this._source.minzoom),l={};for(const u of e){const c=this._addTile(u);t[u.key]=u,c.hasData()||i<this._source.maxzoom&&(l[u.key]=u)}this._retainLoadedChildren(l,i,o,t);for(const u of e){let c=this._tiles[u.key];if(c.hasData())continue;if(u.canonical.z>=this._source.maxzoom){const h=u.children(this._source.maxzoom)[0],d=this.getTile(h);if(d&&d.hasData()){t[h.key]=h;continue}}else{const h=u.children(this._source.maxzoom);if(t[h[0].key]&&t[h[1].key]&&t[h[2].key]&&t[h[3].key])continue}let p=c.wasRequested();for(let h=u.overscaledZ-1;h>=a;--h){const d=u.scaledTo(h);if(n[d.key]||(n[d.key]=!0,c=this.getTile(d),!c&&p&&(c=this._addTile(d)),c&&(t[d.key]=d,p=c.wasRequested(),c.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const s=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(s),n)break;i=s}for(const s of t)this._loadedParentTiles[s]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=!!t;if(!n){const i=this.map?this.map.painter:null;t=new qh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new kr("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!=="reloading"?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,n){const i=[],s=this.transform;if(!s)return i;const a=s.projection.name==="globe",o=or(s.center.lng);for(const l in this._tiles){const u=this._tiles[l];if(n&&u.clearQueryDebugViz(),u.holdingForFade())continue;let c;if(a){const p=u.tileID.canonical;if(p.z===0){const h=[Math.abs(ue(o,...Un(p,-1))-o),Math.abs(ue(o,...Un(p,1))-o)];c=[0,2*h.indexOf(Math.min(...h))-1]}else{const h=[Math.abs(ue(o,...Un(p,-1))-o),Math.abs(ue(o,...Un(p,0))-o),Math.abs(ue(o,...Un(p,1))-o)];c=[h.indexOf(Math.min(...h))-1]}}else c=[0];for(const p of c){const h=e.containsTile(u,s,t,p);h&&i.push(h)}}return i}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of t)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(ep(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(t.fadeEndTime!==void 0&&t.fadeEndTime>=Cr.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,t))}_preloadTiles(e,t){const n=new Map,i=Array.isArray(e)?e:[e],s=this.map.painter.terrain,a=this.usedForTerrain&&s?s.getScaledDemTileSize():this._source.tileSize;for(const o of i){const l=o.coveringTiles({tileSize:a,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const u of l)n.set(u.key,u);this.usedForTerrain&&o.updateElevation(!1)}(function(o,l,u){if(!o.length)return u(null,[]);let c=o.length;const p=new Array(o.length);let h=null;o.forEach((d,f)=>{l(d,(y,m)=>{y&&(h=y),p[f]=m,--c==0&&u(h,p)})})})(Array.from(n.values()),(o,l)=>{const u=new qh(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(u,c=>{this._source.type==="raster-dem"&&u.dem&&this._backfillDEM(u),l(c,u)})},t)}}function Qh(r,e){const t=Math.abs(2*r.wrap)-+(r.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||n-t||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function ep(r){return r==="raster"||r==="image"||r==="video"||r==="custom"}function Un(r,e){const t=1<<r.z;return[r.x/t+e,(r.x+1)/t+e]}Xr.maxOverzooming=10,Xr.maxUnderzooming=3;class Co{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const i=n||e.findDEMTileFor(t);if(!i||!i.dem)return;const s=i.dem,a=i.tileID,o=1<<t.canonical.z-a.canonical.z;return new Co(i,i.tileSize/Y/o,[(t.canonical.x/o-a.canonical.x)*s.dim,(t.canonical.y/o-a.canonical.y)*s.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],i=Math.floor(e*this._scale+this._offset[0]),s=Math.floor(n);return new O(i,s)}getElevationAt(e,t,n,i){const s=e*this._scale+this._offset[0],a=t*this._scale+this._offset[1],o=Math.floor(s),l=Math.floor(a),u=this._dem;return i=!!i,n?de(de(u.get(o,l,i),u.get(o,l+1,i),a-l),de(u.get(o+1,l,i),u.get(o+1,l+1,i),a-l),s-o):u.get(o,l,i)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Tt(1,e)*this._dem.stride}}class tp{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new gr(Y,16,0),this.featureIndexArray=new ac,this.promoteId=t}insert(e,t,n,i,s,a=0){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,s,a);const l=this.grid;for(let u=0;u<t.length;u++){const c=t[u],p=[1/0,1/0,-1/0,-1/0];for(let h=0;h<c.length;h++){const d=c[h];p[0]=Math.min(p[0],d.x),p[1]=Math.min(p[1],d.y),p[2]=Math.max(p[2],d.x),p[3]=Math.max(p[3],d.y)}p[0]<Y&&p[1]<Y&&p[2]>=0&&p[3]>=0&&l.insert(o,p[0],p[1],p[2],p[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new go(new ts(this.rawTileData)).layers,this.sourceLayerCoder=new Oh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,n,i){this.loadVTLayers();const s=e.params||{},a=xi(s.filter),o=e.tileResult,l=e.transform,u=o.bufferedTilespaceBounds,c=this.grid.query(u.min.x,u.min.y,u.max.x,u.max.y,(f,y,m,g)=>function(b,x,v,w,_){for(const S of b)if(x<=S.x&&v<=S.y&&w>=S.x&&_>=S.y)return!0;const A=[new O(x,v),new O(x,_),new O(w,_),new O(w,v)];if(b.length>2){for(const S of A)if(Vr(b,S))return!0}for(let S=0;S<b.length-1;S++)if(af(b[S],b[S+1],A))return!0;return!1}(o.bufferedTilespaceGeometry,f,y,m,g));c.sort(rm);let p=null;l.elevation&&c.length>0&&(p=Co.create(l.elevation,this.tileID));const h={};let d;for(let f=0;f<c.length;f++){const y=c[f];if(y===d)continue;d=y;const m=this.featureIndexArray.get(y);let g=null;this.loadMatchingFeature(h,m,a,s.layers,s.availableImages,t,n,i,(b,x,v,w=0)=>(g||(g=Ct(b,this.tileID.canonical,e.tileTransform)),x.queryIntersectsFeature(o,b,v,g,this.z,e.transform,e.pixelPosMatrix,p,w)))}return h}loadMatchingFeature(e,t,n,i,s,a,o,l,u){const{featureIndex:c,bucketIndex:p,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,f=this.bucketLayerIDs[p];if(i&&!function(b,x){for(let v=0;v<b.length;v++)if(x.indexOf(b[v])>=0)return!0;return!1}(i,f))return;const y=this.sourceLayerCoder.decode(h),m=this.vtLayers[y].feature(c);if(n.needGeometry){const b=cr(m,!0);if(!n.filter(new we(this.tileID.overscaledZ),b,this.tileID.canonical))return}else if(!n.filter(new we(this.tileID.overscaledZ),m))return;const g=this.getId(m,y);for(let b=0;b<f.length;b++){const x=f[b];if(i&&i.indexOf(x)<0)continue;const v=a[x];if(!v)continue;let w={};g!==void 0&&l&&(w=l.getState(v.sourceLayer||"_geojsonTileLayer",g));const _=Ve({},o[x]);_.paint=rp(_.paint,v.paint,m,w,s),_.layout=rp(_.layout,v.layout,m,w,s);const A=!u||u(m,v,w,d);if(!A)continue;const S=new jh(m,this.z,this.x,this.y,g);S.layer=_;let C=e[x];C===void 0&&(C=e[x]=[]),C.push({featureIndex:c,feature:S,intersectionZ:A})}}lookupSymbolFeatures(e,t,n,i,s,a,o,l){const u={};this.loadVTLayers();const c=xi(s);for(const p of e)this.loadMatchingFeature(u,{bucketIndex:n,sourceLayerIndex:i,featureIndex:p,layoutVertexArrayOffset:0},c,a,o,l,t);return u}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const i=this.sourceLayerCoder.decode(n),s=this.vtFeatures[i];if(s[t])return s[t];const a=this.vtLayers[i].feature(t);return s[t]=a,a}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;if(this.promoteId){const i=typeof this.promoteId=="string"?this.promoteId:this.promoteId[t];i!=null&&(n=e.properties[i]),typeof n=="boolean"&&(n=Number(n))}return n}}function rp(r,e,t,n,i){return Ss(r,(s,a)=>{const o=e instanceof Ai?e.get(a):null;return o&&o.evaluate?o.evaluate(t,n,i):o})}function rm(r,e){return e-r}N(tp,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class np{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new hr({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=(n=this.nextRow)<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2));var n;this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const i=[];let s=e.length%2==1?-e[e.length-1]*n:0,a=e[0]*n,o=!0;i.push({left:s,right:a,isDash:o,zeroLength:e[0]===0});let l=e[0];for(let u=1;u<e.length;u++){o=!o;const c=e[u];s=l*n,l+=c,a=l*n,i.push({left:s,right:a,isDash:o,zeroLength:c===0})}return i}addRoundDash(e,t,n){const i=t/2;for(let s=-n;s<=n;s++){const a=this.width*(this.nextRow+n+s);let o=0,l=e[o];for(let u=0;u<this.width;u++){u/l.right>1&&(l=e[++o]);const c=Math.abs(u-l.left),p=Math.abs(u-l.right),h=Math.min(c,p);let d;const f=s/n*(i+1);if(l.isDash){const y=i-Math.abs(f);d=Math.sqrt(h*h+y*y)}else d=i-Math.sqrt(h*h+f*f);this.image.data[a+u]=Math.max(0,Math.min(255,d+128))}}}addRegularDash(e,t){for(let l=e.length-1;l>=0;--l){const u=e[l],c=e[l+1];u.zeroLength?e.splice(l,1):c&&c.isDash===u.isDash&&(c.left=u.left,e.splice(l,1))}const n=e[0],i=e[e.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);const s=this.width*this.nextRow;let a=0,o=e[a];for(let l=0;l<this.width;l++){l/o.right>1&&(o=e[++a]);const u=Math.abs(l-o.left),c=Math.abs(l-o.right),p=Math.min(u,c);this.image.data[s+l]=Math.max(0,Math.min(255,(o.isDash?p:-p)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const i=t==="round",s=i?7:0,a=2*s+1;if(this.nextRow+a>this.height)return Pe("LineAtlas out of space"),null;e.length===0&&e.push(1);let o=0;for(let c=0;c<e.length;c++)e[c]<0&&(Pe("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),o+=e[c];if(o!==0){const c=this.width/o,p=this.getDashRanges(e,this.width,c);i?this.addRoundDash(p,c,s):this.addRegularDash(p,t==="square"?.5*c:0)}const l=this.nextRow+s;this.nextRow+=a;const u={tl:[l,s],br:[o,0]};return this.positions[n]=u,u}}N(np,"LineAtlas");class ip{constructor(e){const t={},n=[];for(const o in e){const l=e[o],u=t[o]={};for(const c in l.glyphs){const p=l.glyphs[+c];if(!p||p.bitmap.width===0||p.bitmap.height===0)continue;const h=p.metrics.localGlyph?2:1,d={x:0,y:0,w:p.bitmap.width+2*h,h:p.bitmap.height+2*h};n.push(d),u[c]=d}}const{w:i,h:s}=fh(n),a=new hr({width:i||1,height:s||1});for(const o in e){const l=e[o];for(const u in l.glyphs){const c=l.glyphs[+u];if(!c||c.bitmap.width===0||c.bitmap.height===0)continue;const p=t[o][u],h=c.metrics.localGlyph?2:1;hr.copy(c.bitmap,a,{x:0,y:0},{x:p.x+h,y:p.y+h},c.bitmap)}}this.image=a,this.positions=t}}N(ip,"GlyphAtlas");class nm{constructor(e){this.tileID=new Qe(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Bn(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,n,i,s){this.status="parsing",this.data=e,this.collisionBoxArray=new ja;const a=new Oh(Object.keys(e.layers).sort()),o=new tp(this.tileID,this.promoteId);o.bucketLayerIDs=[];const l={},u=new np(256,256),c={featureIndex:o,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:u,availableImages:n},p=t.familiesBySource[this.source];for(const w in p){const _=e.layers[w];if(!_)continue;let A=!1,S=!1;for(const k of p[w])k[0].type==="symbol"?A=!0:S=!0;if(this.isSymbolTile===!0&&!A||this.isSymbolTile===!1&&!S)continue;_.version===1&&Pe(`Vector tile source "${this.source}" layer "${w}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const C=a.encode(w),z=[];for(let k=0;k<_.length;k++){const M=_.feature(k),E=o.getId(M,w);z.push({feature:M,id:E,index:k,sourceLayerIndex:C})}for(const k of p[w]){const M=k[0];this.isSymbolTile!==void 0&&M.type==="symbol"!==this.isSymbolTile||M.minzoom&&this.zoom<Math.floor(M.minzoom)||M.maxzoom&&this.zoom>=M.maxzoom||M.visibility!=="none"&&(Eo(k,this.zoom,n),(l[M.id]=M.createBucket({index:o.bucketLayerIDs.length,layers:k,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:C,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:n})).populate(z,c,this.tileID.canonical,this.tileTransform),o.bucketLayerIDs.push(k.map(E=>E.id)))}}let h,d,f,y;u.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=Ss(c.glyphDependencies,w=>Object.keys(w).map(Number));Object.keys(g).length?i.send("getGlyphs",{uid:this.uid,stacks:g},(w,_)=>{h||(h=w,d=_,v.call(this))},void 0,!1,m):d={};const b=Object.keys(c.iconDependencies);b.length?i.send("getImages",{icons:b,source:this.source,tileID:this.tileID,type:"icons"},(w,_)=>{h||(h=w,f=_,v.call(this))},void 0,!1,m):f={};const x=Object.keys(c.patternDependencies);function v(){if(h)return s(h);if(d&&f&&y){const w=new ip(d),_=new mh(f,y);for(const A in l){const S=l[A];S instanceof Yt?(Eo(S.layers,this.zoom,n),Cy(S,d,w.positions,f,_.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):S.hasPattern&&(S instanceof Qi||S instanceof Wi||S instanceof Ji)&&(Eo(S.layers,this.zoom,n),S.addFeatures(c,this.tileID.canonical,_.patternPositions,n,this.tileTransform))}this.status="done",s(null,{buckets:_s(l).filter(A=>!A.isEmpty()),featureIndex:o,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:w.image,lineAtlas:u,imageAtlas:_,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?w.positions:null})}}x.length?i.send("getImages",{icons:x,source:this.source,tileID:this.tileID,type:"patterns"},(w,_)=>{h||(h=w,y=_,v.call(this))},void 0,!1,m):y={},v.call(this)}}function Eo(r,e,t){const n=new we(e);for(const i of r)i.recalculate(n,t)}class im{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,i){const s=this.entries[e]=this.entries[e]||{callbacks:[]};if(s.result){const[a,o]=s.result;return this.scheduler?this.scheduler.add(()=>{i(a,o)},t):i(a,o),()=>{}}return s.callbacks.push(i),s.cancel||(s.cancel=n((a,o)=>{s.result=[a,o];for(const l of s.callbacks)this.scheduler?this.scheduler.add(()=>{l(a,o)},t):l(a,o);setTimeout(()=>delete this.entries[e],3e3)})),()=>{s.result||(s.callbacks=s.callbacks.filter(a=>a!==i),s.callbacks.length||(s.cancel(),delete this.entries[e]))}}}function sm(r,e,t){const n=JSON.stringify(r.request);return r.data&&(this.deduped.entries[n]={result:[null,r.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},i=>{const s=Ql(r.request,(a,o,l,u)=>{a?i(a):o&&i(null,{vectorTile:t?void 0:new go(new ts(o)),rawData:o,cacheControl:l,expires:u})});return()=>{s.cancel(),i()}},e)}class Po extends mi{constructor(e,t,n,i,s){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=s||sm,this.loading={},this.loaded={},this.deduped=new im(e.scheduler),this.isSpriteLoaded=i,this.scheduler=e.scheduler}loadTile(e,t){const n=e.uid,i=e&&e.request,s=i&&i.collectResourceTiming,a=this.loading[n]=new nm(e);a.abort=this.loadVectorData(e,(o,l)=>{const u=!this.loading[n];if(delete this.loading[n],u||o||!l)return a.status="done",u||(this.loaded[n]=a),t(o);const c=l.rawData,p={};l.expires&&(p.expires=l.expires),l.cacheControl&&(p.cacheControl=l.cacheControl),a.vectorTile=l.vectorTile||new go(new ts(c));const h=()=>{a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,(d,f)=>{if(d||!f)return t(d);const y={};if(s){const m=ru(i);m.length>0&&(y.resourceTiming=JSON.parse(JSON.stringify(m)))}t(null,Ve({rawTileData:c.slice(0)},f,p,y))})};this.isSpriteLoaded?h():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()}),this.loaded=this.loaded||{},this.loaded[n]=a})}reloadTile(e,t){const n=this.loaded,i=e.uid,s=this;if(n&&n[i]){const a=n[i];a.showCollisionBoxes=e.showCollisionBoxes,a.enableTerrain=!!e.enableTerrain,a.projection=e.projection,a.tileTransform=Bn(e.tileID.canonical,e.projection);const o=(l,u)=>{const c=a.reloadCallback;c&&(delete a.reloadCallback,a.parse(a.vectorTile,s.layerIndex,this.availableImages,s.actor,c)),t(l,u)};a.status==="parsing"?a.reloadCallback=o:a.status==="done"&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}}class am{loadTile(e,t){const{uid:n,encoding:i,rawImageData:s,padding:a,buildQuadTree:o}=e,l=W.ImageBitmap&&s instanceof W.ImageBitmap?this.getImageData(s,a):s;t(null,new ys(n,l,i,a<1,o))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}var om=function r(e,t){var n,i=e&&e.type;if(i==="FeatureCollection")for(n=0;n<e.features.length;n++)r(e.features[n],t);else if(i==="GeometryCollection")for(n=0;n<e.geometries.length;n++)r(e.geometries[n],t);else if(i==="Feature")r(e.geometry,t);else if(i==="Polygon")sp(e.coordinates,t);else if(i==="MultiPolygon")for(n=0;n<e.coordinates.length;n++)sp(e.coordinates[n],t);return e};function sp(r,e){if(r.length!==0){ap(r[0],e);for(var t=1;t<r.length;t++)ap(r[t],!e)}}function ap(r,e){for(var t=0,n=0,i=0,s=r.length,a=s-1;i<s;a=i++){var o=(r[i][0]-r[a][0])*(r[a][1]+r[i][1]),l=t+o;n+=Math.abs(t)>=Math.abs(o)?t-l+o:o-l+t,t=l}t+n>=0!=!!e&&r.reverse()}const lm=Hi.prototype.toGeoJSON;class um{constructor(e){this._feature=e,this.extent=Y,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(this._feature.type===1){const e=[];for(const t of this._feature.geometry)e.push([new O(t[0],t[1])]);return e}{const e=[];for(const t of this._feature.geometry){const n=[];for(const i of t)n.push(new O(i[0],i[1]));e.push(n)}return e}}toGeoJSON(e,t,n){return lm.call(this,e,t,n)}}class cm{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=Y,this.length=e.length,this._features=e}feature(e){return new um(this._features[e])}}var Wr={},hm={get exports(){return Wr},set exports(r){Wr=r}},pm=O,dm=Yi.VectorTileFeature,fm=op;function op(r,e){this.options=e||{},this.features=r,this.length=r.length}function ms(r,e){this.id=typeof r.id=="number"?r.id:void 0,this.type=r.type,this.rawGeometry=r.type===1?[r.geometry]:r.geometry,this.properties=r.tags,this.extent=e||4096}op.prototype.feature=function(r){return new ms(this.features[r],this.options.extent)},ms.prototype.loadGeometry=function(){var r=this.rawGeometry;this.geometry=[];for(var e=0;e<r.length;e++){for(var t=r[e],n=[],i=0;i<t.length;i++)n.push(new pm(t[i][0],t[i][1]));this.geometry.push(n)}return this.geometry},ms.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var r=this.geometry,e=1/0,t=-1/0,n=1/0,i=-1/0,s=0;s<r.length;s++)for(var a=r[s],o=0;o<a.length;o++){var l=a[o];e=Math.min(e,l.x),t=Math.max(t,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y)}return[e,n,t,i]},ms.prototype.toGeoJSON=dm.prototype.toGeoJSON;var ym=ts,lp=fm;function zo(r){var e=new ym;return function(t,n){for(var i in t.layers)n.writeMessage(3,mm,t.layers[i])}(r,e),e.finish()}function mm(r,e){var t;e.writeVarintField(15,r.version||1),e.writeStringField(1,r.name||""),e.writeVarintField(5,r.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(t=0;t<r.length;t++)n.feature=r.feature(t),e.writeMessage(2,gm,n);var i=n.keys;for(t=0;t<i.length;t++)e.writeStringField(3,i[t]);var s=n.values;for(t=0;t<s.length;t++)e.writeMessage(4,bm,s[t])}function gm(r,e){var t=r.feature;t.id!==void 0&&e.writeVarintField(1,t.id),e.writeMessage(2,xm,r),e.writeVarintField(3,t.type),e.writeMessage(4,vm,t)}function xm(r,e){var t=r.feature,n=r.keys,i=r.values,s=r.keycache,a=r.valuecache;for(var o in t.properties){var l=t.properties[o],u=s[o];if(l!==null){u===void 0&&(n.push(o),s[o]=u=n.length-1),e.writeVarint(u);var c=typeof l;c!=="string"&&c!=="boolean"&&c!=="number"&&(l=JSON.stringify(l));var p=c+":"+l,h=a[p];h===void 0&&(i.push(l),a[p]=h=i.length-1),e.writeVarint(h)}}}function Do(r,e){return(e<<3)+(7&r)}function up(r){return r<<1^r>>31}function vm(r,e){for(var t=r.loadGeometry(),n=r.type,i=0,s=0,a=t.length,o=0;o<a;o++){var l=t[o],u=1;n===1&&(u=l.length),e.writeVarint(Do(1,u));for(var c=n===3?l.length-1:l.length,p=0;p<c;p++){p===1&&n!==1&&e.writeVarint(Do(2,c-1));var h=l[p].x-i,d=l[p].y-s;e.writeVarint(up(h)),e.writeVarint(up(d)),i+=h,s+=d}n===3&&e.writeVarint(Do(7,1))}}function bm(r,e){var t=typeof r;t==="string"?e.writeStringField(1,r):t==="boolean"?e.writeBooleanField(7,r):t==="number"&&(r%1!=0?e.writeDoubleField(3,r):r<0?e.writeSVarintField(6,r):e.writeVarintField(5,r))}function Bo(r,e,t,n,i,s){if(i-n<=t)return;const a=n+i>>1;cp(r,e,a,n,i,s%2),Bo(r,e,t,n,a-1,s+1),Bo(r,e,t,a+1,i,s+1)}function cp(r,e,t,n,i,s){for(;i>n;){if(i-n>600){const u=i-n+1,c=t-n+1,p=Math.log(u),h=.5*Math.exp(2*p/3),d=.5*Math.sqrt(p*h*(u-h)/u)*(c-u/2<0?-1:1);cp(r,e,t,Math.max(n,Math.floor(t-c*h/u+d)),Math.min(i,Math.floor(t+(u-c)*h/u+d)),s)}const a=e[2*t+s];let o=n,l=i;for(On(r,e,n,t),e[2*i+s]>a&&On(r,e,n,i);o<l;){for(On(r,e,o,l),o++,l--;e[2*o+s]<a;)o++;for(;e[2*l+s]>a;)l--}e[2*n+s]===a?On(r,e,n,l):(l++,On(r,e,l,i)),l<=t&&(n=l+1),t<=l&&(i=l-1)}}function On(r,e,t,n){Ro(r,t,n),Ro(e,2*t,2*n),Ro(e,2*t+1,2*n+1)}function Ro(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}function hp(r,e,t,n){const i=r-t,s=e-n;return i*i+s*s}hm.exports=zo,Wr.fromVectorTileJs=zo,Wr.fromGeojsonVt=function(r,e){e=e||{};var t={};for(var n in r)t[n]=new lp(r[n].features,e),t[n].name=n,t[n].version=e.version,t[n].extent=e.extent;return zo({layers:t})},Wr.GeoJSONWrapper=lp;const _m=r=>r[0],wm=r=>r[1];class pp{constructor(e,t=_m,n=wm,i=64,s=Float64Array){this.nodeSize=i,this.points=e;const a=e.length<65536?Uint16Array:Uint32Array,o=this.ids=new a(e.length),l=this.coords=new s(2*e.length);for(let u=0;u<e.length;u++)o[u]=u,l[2*u]=t(e[u]),l[2*u+1]=n(e[u]);Bo(o,l,i,0,o.length-1,0)}range(e,t,n,i){return function(s,a,o,l,u,c,p){const h=[0,s.length-1,0],d=[];let f,y;for(;h.length;){const m=h.pop(),g=h.pop(),b=h.pop();if(g-b<=p){for(let w=b;w<=g;w++)f=a[2*w],y=a[2*w+1],f>=o&&f<=u&&y>=l&&y<=c&&d.push(s[w]);continue}const x=Math.floor((b+g)/2);f=a[2*x],y=a[2*x+1],f>=o&&f<=u&&y>=l&&y<=c&&d.push(s[x]);const v=(m+1)%2;(m===0?o<=f:l<=y)&&(h.push(b),h.push(x-1),h.push(v)),(m===0?u>=f:c>=y)&&(h.push(x+1),h.push(g),h.push(v))}return d}(this.ids,this.coords,e,t,n,i,this.nodeSize)}within(e,t,n){return function(i,s,a,o,l,u){const c=[0,i.length-1,0],p=[],h=l*l;for(;c.length;){const d=c.pop(),f=c.pop(),y=c.pop();if(f-y<=u){for(let v=y;v<=f;v++)hp(s[2*v],s[2*v+1],a,o)<=h&&p.push(i[v]);continue}const m=Math.floor((y+f)/2),g=s[2*m],b=s[2*m+1];hp(g,b,a,o)<=h&&p.push(i[m]);const x=(d+1)%2;(d===0?a-l<=g:o-l<=b)&&(c.push(y),c.push(m-1),c.push(x)),(d===0?a+l>=g:o+l>=b)&&(c.push(m+1),c.push(f),c.push(x))}return p}(this.ids,this.coords,e,t,n,this.nodeSize)}}const Sm={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:r=>r},gs=Math.fround||(Vo=new Float32Array(1),r=>(Vo[0]=+r,Vo[0]));var Vo;class Am{constructor(e){this.options=jn(Object.create(Sm),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:n,maxZoom:i,nodeSize:s}=this.options;t&&console.time("total time");const a=`prepare ${e.length} points`;t&&console.time(a),this.points=e;let o=[];for(let l=0;l<e.length;l++)e[l].geometry&&o.push(Im(e[l],l));this.trees[i+1]=new pp(o,yp,mp,s,Float32Array),t&&console.timeEnd(a);for(let l=i;l>=n;l--){const u=+Date.now();o=this._cluster(o,l),this.trees[l]=new pp(o,yp,mp,s,Float32Array),t&&console.log("z%d: %d clusters in %dms",l,o.length,+Date.now()-u)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let s=e[2]===180?180:((e[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,s=180;else if(n>s){const c=this.getClusters([n,i,180,a],t),p=this.getClusters([-180,i,s,a],t);return c.concat(p)}const o=this.trees[this._limitZoom(t)],l=o.range(xs(n),vs(a),xs(s),vs(i)),u=[];for(const c of l){const p=o.points[c];u.push(p.numPoints?dp(p):this.points[p.index])}return u}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",s=this.trees[n];if(!s)throw new Error(i);const a=s.points[t];if(!a)throw new Error(i);const o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),l=s.within(a.x,a.y,o),u=[];for(const c of l){const p=s.points[c];p.parentId===e&&u.push(p.numPoints?dp(p):this.points[p.index])}if(u.length===0)throw new Error(i);return u}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],s=Math.pow(2,e),{extent:a,radius:o}=this.options,l=o/a,u=(n-l)/s,c=(n+1+l)/s,p={features:[]};return this._addTileFeatures(i.range((t-l)/s,u,(t+1+l)/s,c),i.points,t,n,s,p),t===0&&this._addTileFeatures(i.range(1-l/s,u,1,c),i.points,s,n,s,p),t===s-1&&this._addTileFeatures(i.range(0,u,l/s,c),i.points,-1,n,s,p),p.features.length?p:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,n.length!==1)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,s){const a=this.getChildren(t);for(const o of a){const l=o.properties;if(l&&l.cluster?s+l.point_count<=i?s+=l.point_count:s=this._appendLeaves(e,l.cluster_id,n,i,s):s<i?s++:e.push(o),e.length===n)break}return s}_addTileFeatures(e,t,n,i,s,a){for(const o of e){const l=t[o],u=l.numPoints;let c,p,h;if(u)c=fp(l),p=l.x,h=l.y;else{const y=this.points[l.index];c=y.properties,p=xs(y.geometry.coordinates[0]),h=vs(y.geometry.coordinates[1])}const d={type:1,geometry:[[Math.round(this.options.extent*(p*s-n)),Math.round(this.options.extent*(h*s-i))]],tags:c};let f;u?f=l.id:this.options.generateId?f=l.index:this.points[l.index].id&&(f=this.points[l.index].id),f!==void 0&&(d.id=f),a.features.push(d)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const n=[],{radius:i,extent:s,reduce:a,minPoints:o}=this.options,l=i/(s*Math.pow(2,t));for(let u=0;u<e.length;u++){const c=e[u];if(c.zoom<=t)continue;c.zoom=t;const p=this.trees[t+1],h=p.within(c.x,c.y,l),d=c.numPoints||1;let f=d;for(const y of h){const m=p.points[y];m.zoom>t&&(f+=m.numPoints||1)}if(f>d&&f>=o){let y=c.x*d,m=c.y*d,g=a&&d>1?this._map(c,!0):null;const b=(u<<5)+(t+1)+this.points.length;for(const x of h){const v=p.points[x];if(v.zoom<=t)continue;v.zoom=t;const w=v.numPoints||1;y+=v.x*w,m+=v.y*w,v.parentId=b,a&&(g||(g=this._map(c,!0)),a(g,this._map(v)))}c.parentId=b,n.push(km(y/f,m/f,b,f,g))}else if(n.push(c),f>1)for(const y of h){const m=p.points[y];m.zoom<=t||(m.zoom=t,n.push(m))}}return n}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?jn({},e.properties):e.properties;const n=this.points[e.index].properties,i=this.options.map(n);return t&&i===n?jn({},i):i}}function km(r,e,t,n,i){return{x:gs(r),y:gs(e),zoom:1/0,id:t,parentId:-1,numPoints:n,properties:i}}function Im(r,e){const[t,n]=r.geometry.coordinates;return{x:gs(xs(t)),y:gs(vs(n)),zoom:1/0,index:e,parentId:-1}}function dp(r){return{type:"Feature",id:r.id,properties:fp(r),geometry:{type:"Point",coordinates:[(e=r.x,360*(e-.5)),Mm(r.y)]}};var e}function fp(r){const e=r.numPoints,t=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return jn(jn({},r.properties),{cluster:!0,cluster_id:r.id,point_count:e,point_count_abbreviated:t})}function xs(r){return r/360+.5}function vs(r){const e=Math.sin(r*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function Mm(r){const e=(180-360*r)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function jn(r,e){for(const t in e)r[t]=e[t];return r}function yp(r){return r.x}function mp(r){return r.y}function Lo(r,e,t,n){for(var i,s=n,a=t-e>>1,o=t-e,l=r[e],u=r[e+1],c=r[t],p=r[t+1],h=e+3;h<t;h+=3){var d=Tm(r[h],r[h+1],l,u,c,p);if(d>s)i=h,s=d;else if(d===s){var f=Math.abs(h-a);f<o&&(i=h,o=f)}}s>n&&(i-e>3&&Lo(r,e,i,n),r[i+2]=s,t-i>3&&Lo(r,i,t,n))}function Tm(r,e,t,n,i,s){var a=i-t,o=s-n;if(a!==0||o!==0){var l=((r-t)*a+(e-n)*o)/(a*a+o*o);l>1?(t=i,n=s):l>0&&(t+=a*l,n+=o*l)}return(a=r-t)*a+(o=e-n)*o}function Nn(r,e,t,n){var i={id:r===void 0?null:r,type:e,geometry:t,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(s){var a=s.geometry,o=s.type;if(o==="Point"||o==="MultiPoint"||o==="LineString")Fo(s,a);else if(o==="Polygon"||o==="MultiLineString")for(var l=0;l<a.length;l++)Fo(s,a[l]);else if(o==="MultiPolygon")for(l=0;l<a.length;l++)for(var u=0;u<a[l].length;u++)Fo(s,a[l][u])}(i),i}function Fo(r,e){for(var t=0;t<e.length;t+=3)r.minX=Math.min(r.minX,e[t]),r.minY=Math.min(r.minY,e[t+1]),r.maxX=Math.max(r.maxX,e[t]),r.maxY=Math.max(r.maxY,e[t+1])}function Uo(r,e,t,n){if(e.geometry){var i=e.geometry.coordinates,s=e.geometry.type,a=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),o=[],l=e.id;if(t.promoteId?l=e.properties[t.promoteId]:t.generateId&&(l=n||0),s==="Point")gp(i,o);else if(s==="MultiPoint")for(var u=0;u<i.length;u++)gp(i[u],o);else if(s==="LineString")Oo(i,o,a,!1);else if(s==="MultiLineString"){if(t.lineMetrics){for(u=0;u<i.length;u++)Oo(i[u],o=[],a,!1),r.push(Nn(l,"LineString",o,e.properties));return}jo(i,o,a,!1)}else if(s==="Polygon")jo(i,o,a,!0);else{if(s!=="MultiPolygon"){if(s==="GeometryCollection"){for(u=0;u<e.geometry.geometries.length;u++)Uo(r,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},t,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var c=[];jo(i[u],c,a,!0),o.push(c)}}r.push(Nn(l,s,o,e.properties))}}function gp(r,e){e.push(xp(r[0])),e.push(vp(r[1])),e.push(0)}function Oo(r,e,t,n){for(var i,s,a=0,o=0;o<r.length;o++){var l=xp(r[o][0]),u=vp(r[o][1]);e.push(l),e.push(u),e.push(0),o>0&&(a+=n?(i*u-l*s)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-s,2))),i=l,s=u}var c=e.length-3;e[2]=1,Lo(e,0,c,t),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function jo(r,e,t,n){for(var i=0;i<r.length;i++){var s=[];Oo(r[i],s,t,n),e.push(s)}}function xp(r){return r/360+.5}function vp(r){var e=Math.sin(r*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function Bt(r,e,t,n,i,s,a,o){if(n/=e,s>=(t/=e)&&a<n)return r;if(a<t||s>=n)return null;for(var l=[],u=0;u<r.length;u++){var c=r[u],p=c.geometry,h=c.type,d=i===0?c.minX:c.minY,f=i===0?c.maxX:c.maxY;if(d>=t&&f<n)l.push(c);else if(!(f<t||d>=n)){var y=[];if(h==="Point"||h==="MultiPoint")Cm(p,y,t,n,i);else if(h==="LineString")bp(p,y,t,n,i,!1,o.lineMetrics);else if(h==="MultiLineString")No(p,y,t,n,i,!1);else if(h==="Polygon")No(p,y,t,n,i,!0);else if(h==="MultiPolygon")for(var m=0;m<p.length;m++){var g=[];No(p[m],g,t,n,i,!0),g.length&&y.push(g)}if(y.length){if(o.lineMetrics&&h==="LineString"){for(m=0;m<y.length;m++)l.push(Nn(c.id,h,y[m],c.tags));continue}h!=="LineString"&&h!=="MultiLineString"||(y.length===1?(h="LineString",y=y[0]):h="MultiLineString"),h!=="Point"&&h!=="MultiPoint"||(h=y.length===3?"Point":"MultiPoint"),l.push(Nn(c.id,h,y,c.tags))}}}return l.length?l:null}function Cm(r,e,t,n,i){for(var s=0;s<r.length;s+=3){var a=r[s+i];a>=t&&a<=n&&(e.push(r[s]),e.push(r[s+1]),e.push(r[s+2]))}}function bp(r,e,t,n,i,s,a){for(var o,l,u=_p(r),c=i===0?Em:Pm,p=r.start,h=0;h<r.length-3;h+=3){var d=r[h],f=r[h+1],y=r[h+2],m=r[h+3],g=r[h+4],b=i===0?d:f,x=i===0?m:g,v=!1;a&&(o=Math.sqrt(Math.pow(d-m,2)+Math.pow(f-g,2))),b<t?x>t&&(l=c(u,d,f,m,g,t),a&&(u.start=p+o*l)):b>n?x<n&&(l=c(u,d,f,m,g,n),a&&(u.start=p+o*l)):$o(u,d,f,y),x<t&&b>=t&&(l=c(u,d,f,m,g,t),v=!0),x>n&&b<=n&&(l=c(u,d,f,m,g,n),v=!0),!s&&v&&(a&&(u.end=p+o*l),e.push(u),u=_p(r)),a&&(p+=o)}var w=r.length-3;d=r[w],f=r[w+1],y=r[w+2],(b=i===0?d:f)>=t&&b<=n&&$o(u,d,f,y),w=u.length-3,s&&w>=3&&(u[w]!==u[0]||u[w+1]!==u[1])&&$o(u,u[0],u[1],u[2]),u.length&&e.push(u)}function _p(r){var e=[];return e.size=r.size,e.start=r.start,e.end=r.end,e}function No(r,e,t,n,i,s){for(var a=0;a<r.length;a++)bp(r[a],e,t,n,i,s,!1)}function $o(r,e,t,n){r.push(e),r.push(t),r.push(n)}function Em(r,e,t,n,i,s){var a=(s-e)/(n-e);return r.push(s),r.push(t+(i-t)*a),r.push(1),a}function Pm(r,e,t,n,i,s){var a=(s-t)/(i-t);return r.push(e+(n-e)*a),r.push(s),r.push(1),a}function wp(r,e){for(var t=[],n=0;n<r.length;n++){var i,s=r[n],a=s.type;if(a==="Point"||a==="MultiPoint"||a==="LineString")i=qo(s.geometry,e);else if(a==="MultiLineString"||a==="Polygon"){i=[];for(var o=0;o<s.geometry.length;o++)i.push(qo(s.geometry[o],e))}else if(a==="MultiPolygon")for(i=[],o=0;o<s.geometry.length;o++){for(var l=[],u=0;u<s.geometry[o].length;u++)l.push(qo(s.geometry[o][u],e));i.push(l)}t.push(Nn(s.id,a,i,s.tags))}return t}function qo(r,e){var t=[];t.size=r.size,r.start!==void 0&&(t.start=r.start,t.end=r.end);for(var n=0;n<r.length;n+=3)t.push(r[n]+e,r[n+1],r[n+2]);return t}function Sp(r,e){if(r.transformed)return r;var t,n,i,s=1<<r.z,a=r.x,o=r.y;for(t=0;t<r.features.length;t++){var l=r.features[t],u=l.geometry,c=l.type;if(l.geometry=[],c===1)for(n=0;n<u.length;n+=2)l.geometry.push(Ap(u[n],u[n+1],e,s,a,o));else for(n=0;n<u.length;n++){var p=[];for(i=0;i<u[n].length;i+=2)p.push(Ap(u[n][i],u[n][i+1],e,s,a,o));l.geometry.push(p)}}return r.transformed=!0,r}function Ap(r,e,t,n,i,s){return[Math.round(t*(r*n-i)),Math.round(t*(e*n-s))]}function zm(r,e,t,n,i){for(var s=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},o=0;o<r.length;o++){a.numFeatures++,Dm(a,r[o],s,i);var l=r[o].minX,u=r[o].minY,c=r[o].maxX,p=r[o].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),p>a.maxY&&(a.maxY=p)}return a}function Dm(r,e,t,n){var i=e.geometry,s=e.type,a=[];if(s==="Point"||s==="MultiPoint")for(var o=0;o<i.length;o+=3)a.push(i[o]),a.push(i[o+1]),r.numPoints++,r.numSimplified++;else if(s==="LineString")Go(a,i,r,t,!1,!1);else if(s==="MultiLineString"||s==="Polygon")for(o=0;o<i.length;o++)Go(a,i[o],r,t,s==="Polygon",o===0);else if(s==="MultiPolygon")for(var l=0;l<i.length;l++){var u=i[l];for(o=0;o<u.length;o++)Go(a,u[o],r,t,!0,o===0)}if(a.length){var c=e.tags||null;if(s==="LineString"&&n.lineMetrics){for(var p in c={},e.tags)c[p]=e.tags[p];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var h={geometry:a,type:s==="Polygon"||s==="MultiPolygon"?3:s==="LineString"||s==="MultiLineString"?2:1,tags:c};e.id!==null&&(h.id=e.id),r.features.push(h)}}function Go(r,e,t,n,i,s){var a=n*n;if(n>0&&e.size<(i?a:n))t.numPoints+=e.length/3;else{for(var o=[],l=0;l<e.length;l+=3)(n===0||e[l+2]>a)&&(t.numSimplified++,o.push(e[l]),o.push(e[l+1])),t.numPoints++;i&&function(u,c){for(var p=0,h=0,d=u.length,f=d-2;h<d;f=h,h+=2)p+=(u[h]-u[f])*(u[h+1]+u[f+1]);if(p>0===c)for(h=0,d=u.length;h<d/2;h+=2){var y=u[h],m=u[h+1];u[h]=u[d-2-h],u[h+1]=u[d-1-h],u[d-2-h]=y,u[d-1-h]=m}}(o,s),r.push(o)}}function bs(r,e){var t=(e=this.options=function(i,s){for(var a in s)i[a]=s[a];return i}(Object.create(this.options),e)).debug;if(t&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(i,s){var a=[];if(i.type==="FeatureCollection")for(var o=0;o<i.features.length;o++)Uo(a,i.features[o],s,o);else Uo(a,i.type==="Feature"?i:{geometry:i},s);return a}(r,e);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(i,s){var a=s.buffer/s.extent,o=i,l=Bt(i,1,-1-a,a,0,-1,2,s),u=Bt(i,1,1-a,2+a,0,-1,2,s);return(l||u)&&(o=Bt(i,1,-a,1+a,0,-1,2,s)||[],l&&(o=wp(l,1).concat(o)),u&&(o=o.concat(wp(u,-1)))),o}(n,e),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zo(r,e,t){return 32*((1<<r)*t+e)+r}function Bm(r,e){const t=r.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const n=this._geoJSONIndex.getTile(t.z,t.x,t.y);if(!n)return e(null,null);const i=new cm(n.features);let s=Wr(i);s.byteOffset===0&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),e(null,{vectorTile:i,rawData:s.buffer})}bs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},bs.prototype.splitTile=function(r,e,t,n,i,s,a){for(var o=[r,e,t,n],l=this.options,u=l.debug;o.length;){n=o.pop(),t=o.pop(),e=o.pop(),r=o.pop();var c=1<<e,p=Zo(e,t,n),h=this.tiles[p];if(!h&&(u>1&&console.time("creation"),h=this.tiles[p]=zm(r,e,t,n,l),this.tileCoords.push({z:e,x:t,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,t,n,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(h.source=r,i){if(e===l.maxZoom||e===i)continue;var f=1<<i-e;if(t!==Math.floor(s/f)||n!==Math.floor(a/f))continue}else if(e===l.indexMaxZoom||h.numPoints<=l.indexMaxPoints)continue;if(h.source=null,r.length!==0){u>1&&console.time("clipping");var y,m,g,b,x,v,w=.5*l.buffer/l.extent,_=.5-w,A=.5+w,S=1+w;y=m=g=b=null,x=Bt(r,c,t-w,t+A,0,h.minX,h.maxX,l),v=Bt(r,c,t+_,t+S,0,h.minX,h.maxX,l),r=null,x&&(y=Bt(x,c,n-w,n+A,1,h.minY,h.maxY,l),m=Bt(x,c,n+_,n+S,1,h.minY,h.maxY,l),x=null),v&&(g=Bt(v,c,n-w,n+A,1,h.minY,h.maxY,l),b=Bt(v,c,n+_,n+S,1,h.minY,h.maxY,l),v=null),u>1&&console.timeEnd("clipping"),o.push(y||[],e+1,2*t,2*n),o.push(m||[],e+1,2*t,2*n+1),o.push(g||[],e+1,2*t+1,2*n),o.push(b||[],e+1,2*t+1,2*n+1)}}},bs.prototype.getTile=function(r,e,t){var n=this.options,i=n.extent,s=n.debug;if(r<0||r>24)return null;var a=1<<r,o=Zo(r,e=(e%a+a)%a,t);if(this.tiles[o])return Sp(this.tiles[o],i);s>1&&console.log("drilling down to z%d-%d-%d",r,e,t);for(var l,u=r,c=e,p=t;!l&&u>0;)u--,c=Math.floor(c/2),p=Math.floor(p/2),l=this.tiles[Zo(u,c,p)];return l&&l.source?(s>1&&console.log("found parent tile z%d-%d-%d",u,c,p),s>1&&console.time("drilling down"),this.splitTile(l.source,u,c,p,r,e,t),s>1&&console.timeEnd("drilling down"),this.tiles[o]?Sp(this.tiles[o],i):null):null};class Rm extends Po{constructor(e,t,n,i,s){super(e,t,n,i,Bm),s&&(this.loadGeoJSON=s)}loadData(e,t){const n=e&&e.request,i=n&&n.collectResourceTiming;this.loadGeoJSON(e,(s,a)=>{if(s||!a)return t(s);if(typeof a!="object")return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{om(a,!0);try{if(e.filter){const l=rr(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(l.result==="error")throw new Error(l.value.map(c=>`${c.key}: ${c.message}`).join(", "));a={type:"FeatureCollection",features:a.features.filter(c=>l.value.evaluate({zoom:0},c))}}this._geoJSONIndex=e.cluster?new Am(function({superclusterOptions:l,clusterProperties:u}){if(!u||!l)return l;const c={},p={},h={accumulated:null,zoom:0},d={properties:null},f=Object.keys(u);for(const y of f){const[m,g]=u[y],b=rr(g),x=rr(typeof m=="string"?[m,["accumulated"],["get",y]]:m);c[y]=b.value,p[y]=x.value}return l.map=y=>{d.properties=y;const m={};for(const g of f)m[g]=c[g].evaluate(h,d);return m},l.reduce=(y,m)=>{d.properties=m;for(const g of f)h.accumulated=y[g],y[g]=p[g].evaluate(h,d)},l}(e)).load(a.features):function(l,u){return new bs(l,u)}(a,e.geojsonVtOptions)}catch(l){return t(l)}this.loaded={};const o={};if(i){const l=ru(n);l&&(o.resourceTiming={},o.resourceTiming[e.source]=JSON.parse(JSON.stringify(l)))}t(null,o)}})}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(e,t){if(e.request)(function(n,i){fi(Ve(n,{type:"json"}),i)})(e.request,t);else{if(typeof e.data!="string")return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return t(null,JSON.parse(e.data))}catch{return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(n){t(n)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(n){t(n)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(n){t(n)}}}class kp{constructor(e){this.self=e,this.actor=new bd(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=wo({name:"mercator"}),this.workerSourceTypes={vector:Po,geojson:Rm},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,n)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=n},this.self.registerRTLTextPlugin=t=>{if(Be.isParsed())throw new Error("RTL text plugin already registered.");Be.applyArabicShaping=t.applyArabicShaping,Be.processBidirectionalText=t.processBidirectionalText,Be.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,n){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],n()}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(e,t){this.isSpriteLoaded[e]=t;for(const n in this.workerSources[e]){const i=this.workerSources[e][n];for(const s in i)i[s]instanceof Po&&(i[s].isSpriteLoaded=t,i[s].fire(new kr("isSpriteLoaded")))}}setImages(e,t,n){this.availableImages[e]=t;for(const i in this.workerSources[e]){const s=this.workerSources[e][i];for(const a in s)s[a].availableImages=t}n()}enableTerrain(e,t,n){this.terrain=t,n()}setProjection(e,t){this.projections[e]=wo(t)}setLayers(e,t,n){this.getLayerIndex(e).replace(t),n()}updateLayers(e,t,n){this.getLayerIndex(e).update(t.layers,t.removedIds),n()}loadTile(e,t,n){const i=this.enableTerrain?Ve({enableTerrain:this.terrain},t):t;i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).loadTile(i,n)}loadDEMTile(e,t,n){const i=this.enableTerrain?Ve({buildQuadTree:this.terrain},t):t;this.getDEMWorkerSource(e,t.source).loadTile(i,n)}reloadTile(e,t,n){const i=this.enableTerrain?Ve({enableTerrain:this.terrain},t):t;i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).reloadTile(i,n)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source).removeTile(t,n)}removeSource(e,t,n){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const i=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],i.removeSource!==void 0?i.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(i){n(i.toString())}}syncRTLPluginState(e,t,n){try{Be.setState(t);const i=Be.getPluginURL();if(Be.isLoaded()&&!Be.isParsed()&&i!=null){this.self.importScripts(i);const s=Be.isParsed();n(s?void 0:new Error(`RTL Text Plugin failed to import scripts from ${i}`),s)}}catch(i){n(i.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new Ky),t}getWorkerSource(e,t,n){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][n]){const i={send:(s,a,o,l,u,c)=>{this.actor.send(s,a,o,e,u,c)},scheduler:this.actor.scheduler};this.workerSources[e][t][n]=new this.workerSourceTypes[t](i,this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])}return this.workerSources[e][t][n]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new am),this.demWorkerSources[e][t]}enforceCacheSizeLimit(e,t){(function(n){di(),kt&&kt.then(i=>{i.keys().then(s=>{for(let a=0;a<s.length-n;a++)i.delete(s[a])})})})(t)}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new kp(self)),kp})();
